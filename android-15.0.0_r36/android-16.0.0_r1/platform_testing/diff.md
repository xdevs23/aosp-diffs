```diff
diff --git a/Android.bp b/Android.bp
new file mode 100644
index 000000000..009f39083
--- /dev/null
+++ b/Android.bp
@@ -0,0 +1,218 @@
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+test_package {
+    name: "platform_tests",
+    tests: [
+        "ActivityManagerPerfTests",
+        "ActivityManagerPerfTestsStubApp1",
+        "ActivityManagerPerfTestsStubApp2",
+        "ActivityManagerPerfTestsStubApp3",
+        "ActivityManagerPerfTestsTestApp",
+        "AdServicesScenarioTests",
+        "AndroidAutomotiveDialScenarioTests",
+        "AndroidTVJankTests",
+        "AndroidXComposeStartupApp",
+        "ApiDemos",
+        "AppCompatibilityTest",
+        "AppLaunch",
+        "AppTransitionTests",
+        "BackgroundDexOptServiceIntegrationTests",
+        "BandwidthEnforcementTest",
+        "BandwidthTests",
+        "benchmarks",
+        "BootHelperApp",
+        "BusinessCard",
+        "CalendarTests",
+        "CellBroadcastReceiverTests",
+        "ConnectivityUIDTest",
+        "CtsCameraTestCases",
+        "CuttlefishRilTests",
+        "CuttlefishWifiTests",
+        "Development",
+        "DeviceHealthChecks",
+        "DialerJankTests",
+        "DynamicCodeLoggerIntegrationTests",
+        "FacebookAppsScenarioTests",
+        "FlickerTestApp",
+        "FrameworkPerf",
+        "FrameworkPermissionTests",
+        "FrameworksCoreSystemPropertiesTests",
+        "FrameworksCoreTests",
+        "FrameworksMockingCoreTests",
+        "FrameworksPrivacyLibraryTests",
+        "FrameworksSaxTests",
+        "FrameworksServicesTests",
+        "FrameworksUtilTests",
+        "FrameworkTestRunnerTests",
+        "ImageProcessing",
+        "JankMicroBenchmarkTests",
+        "LauncherIconsApp",
+        "mediaframeworktest",
+        "MemoryUsage",
+        "OverviewFunctionalTests",
+        "PerformanceAppTest",
+        "PerformanceLaunch",
+        "PermissionFunctionalTests",
+        "PermissionTestAppMV1",
+        "PermissionUtils",
+        "PlatformCommonScenarioTests",
+        "PlatformComposeSceneTransitionLayoutDemo",
+        "PMC",
+        "PowerPerfTest",
+        "SdkSandboxClient",
+        "SdkSandboxCodeProvider",
+        "SdkSandboxMediateeProvider",
+        "SdkSandboxPerfScenarioTests",
+        "SdkSandboxWebViewProvider",
+        "SettingsUITests",
+        "SimpleTestApp",
+        "sl4a",
+        "SmokeTest",
+        "SmokeTestApp",
+        "StubIME",
+        "UbSystemUiJankTests",
+        "UbWebViewJankTests",
+        "UiBench",
+        "UiBenchJankTests",
+        "UiBenchJankTestsWear",
+        "UiBenchMicrobenchmark",
+        "uwb_snippet",
+        "wifi_aware_snippet_new",
+        "wifi_direct_mobly_snippet",
+        "WifiStrengthScannerUtil",
+    ],
+    device_first_tests: [
+        "memory_per_process-avg_rss_and_swap.textproto",
+        "long_trace_binder_config.textproto",
+        "long_trace_config.textproto",
+        "total_runtime_per_slice_for_systemui_process.textproto",
+        "total_runtime_per_thread_for_systemui_process.textproto",
+        "trace_config.textproto",
+        "trace_config_boot_time.textproto",
+        "trace_config_boot_time_stop.textproto",
+        "trace_config_detailed.textproto",
+        "trace_config_detailed_heapdump.textproto",
+        "trace_config_experimental.textproto",
+        "trace_config_multi_user_cuj_tests.textproto",
+        "trace_config_post_boot.textproto",
+        "trace_config_power.textproto",
+    ] + select(soong_config_variable("perf", "board_perfsetup_script"), {
+        any: ["perf-setup"],
+        default: [],
+    }),
+    device_both_tests: [
+        "camera_client_test",
+        "camera_metadata_tests",
+        "flatland",
+        "hwuimacro",
+        "mmapPerf",
+        "xaVideoDecoderCapabilities",
+    ],
+    host_tests: [
+        "perfetto_trace_processor_shell",
+        "root-canal",
+    ],
+    tests_if_exist_common: [
+        "AndroidAutoScenarioTests",
+        "BiometricsMicrobenchmark",
+        "BootHelperAppInternal",
+        "CameraPerformanceTests",
+        "CastSignAPITest",
+        "ClickEnableAdb",
+        "ClockworkNotificationTests",
+        "CollectorsHelperTest",
+        "DialogDismissalUtil",
+        "DisplayMicrobenchTests",
+        "DrmMediaTests",
+        "ExternalStorageFunctionalTests",
+        "FitnessPowerTests",
+        "GCBench",
+        "GeppettoClockwork",
+        "GoogleAppsTestUtils",
+        "GoogleCameraTests",
+        "LauncherFunctionalTests",
+        "LocationSimulator",
+        "LockscreenFunctionalTests",
+        "MarkTest",
+        "MediaBenchmark",
+        "MediaDrmAPITest",
+        "MessagingTests",
+        "MetaTestPerformance",
+        "MetaTestPerformanceInner",
+        "ModemDiagnosticSystemTest",
+        "NetworkSimulation",
+        "OtaEndToEndTestApp",
+        "OtaFunctionalTests",
+        "OtaJankTests",
+        "OtaMigrationTests",
+        "PageCycler",
+        "PlacesPowerTests",
+        "PlatformScenarioTests",
+        "Power",
+        "power-tests",
+        "PowerCarrierTestsApp",
+        "PowerOrchestrator",
+        "PowerUtil",
+        "SetGoogleAccount",
+        "SettingsFunctionalTests",
+        "SystemAppJankTests",
+        "SystemUpdatesUtil",
+        "SystemUtils",
+    ],
+    tests_if_exist_device_both: select(soong_config_variable("ci_tests", "uses_widevine_tests"), {
+        true: [
+            "base64_test",
+            "buffer_reader_test",
+            "cdm_coverage_test",
+            "cdm_engine_metrics_decorator_unittest",
+            "cdm_engine_test",
+            "cdm_session_unittest",
+            "cdm_usage_table_unittest",
+            "certificate_provisioning_unittest",
+            "core_integration_test",
+            "counter_metric_unittest",
+            "crypto_session_unittest",
+            "device_files_unittest",
+            "distribution_unittest",
+            "duration_use_case_test",
+            "event_metric_unittest",
+            "file_store_unittest",
+            "file_utils_unittest",
+            "generic_crypto_unittest",
+            "hal_metrics_adapter_unittest",
+            "http_socket_test",
+            "initialization_data_unittest",
+            "keybox_ota_test",
+            "libwvdrmdrmplugin_hal_test",
+            "libwvdrmengine_hal_test",
+            "libwvdrmmediacrypto_hal_test",
+            "license_keys_unittest",
+            "license_unittest",
+            "metrics_collections_unittest",
+            "odk_test",
+            "oemcrypto_test",
+            "okp_fallback_policy_test",
+            "ota_keybox_provisioner_test",
+            "policy_engine_constraints_unittest",
+            "policy_engine_unittest",
+            "policy_integration_test",
+            "request_license_test",
+            "rw_lock_test",
+            "service_certificate_unittest",
+            "system_id_extractor_unittest",
+            "timer_unittest",
+            "value_metric_unittest",
+            "wv_cdm_metrics_test",
+            "wv_plugin_test",
+        ],
+        default: [],
+    }),
+
+    dist: {
+        targets: ["platform_tests"],
+        prepend_artifact_with_product: true,
+        dest: "tests-FILE_NAME_TAG_PLACEHOLDER.zip",
+    },
+}
diff --git a/PREUPLOAD.cfg b/PREUPLOAD.cfg
index b3cbaa145..88c60f785 100644
--- a/PREUPLOAD.cfg
+++ b/PREUPLOAD.cfg
@@ -1,4 +1,5 @@
 [Builtin Hooks]
+bpfmt = true
 google_java_format = true
 ktfmt = true
 
@@ -11,4 +12,4 @@ checkstyle_hook = ${REPO_ROOT}/prebuilts/checkstyle/checkstyle.py --sha ${PREUPL
 ktlint_hook = ${REPO_ROOT}/prebuilts/ktlint/ktlint.py --no-verify-format -f ${PREUPLOAD_FILES}
 
 [Tool Paths]
-ktfmt = ${REPO_ROOT}/external/ktfmt/ktfmt.sh
\ No newline at end of file
+ktfmt = ${REPO_ROOT}/external/ktfmt/ktfmt.sh
diff --git a/build/tasks/platform_tests.mk b/build/tasks/platform_tests.mk
deleted file mode 100644
index bb175c866..000000000
--- a/build/tasks/platform_tests.mk
+++ /dev/null
@@ -1,33 +0,0 @@
-# Copyright (C) 2016 The Android Open Source Project
-#
-# Licensed under the Apache License, Version 2.0 (the "License");
-# you may not use this file except in compliance with the License.
-# You may obtain a copy of the License at
-#
-#      http://www.apache.org/licenses/LICENSE-2.0
-#
-# Unless required by applicable law or agreed to in writing, software
-# distributed under the License is distributed on an "AS IS" BASIS,
-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-# See the License for the specific language governing permissions and
-# limitations under the License.
-
-# Rules to generate a zip file that included test modules
-# based on the configuration.
-#
-
-LOCAL_PATH := $(call my-dir)
-include $(LOCAL_PATH)/tests/platform_test_list.mk
--include $(wildcard vendor/*/build/tasks/tests/platform_test_list.mk)
-
-my_modules := $(platform_tests)
-
-my_package_name := platform_tests
-
-include $(BUILD_SYSTEM)/tasks/tools/package-modules.mk
-
-.PHONY: platform_tests
-platform_tests : $(my_package_zip)
-
-name := $(TARGET_PRODUCT)-tests-FILE_NAME_TAG_PLACEHOLDER
-$(call dist-for-goals, platform_tests, $(my_package_zip):$(name).zip)
diff --git a/build/tasks/tests/instrumentation_metric_test_list.mk b/build/tasks/tests/instrumentation_metric_test_list.mk
index 8a23a69d1..783867414 100644
--- a/build/tasks/tests/instrumentation_metric_test_list.mk
+++ b/build/tasks/tests/instrumentation_metric_test_list.mk
@@ -13,6 +13,7 @@
 # limitations under the License.
 
 instrumentation_metric_tests := \
+    AconfigPerfTests \
     ActivityManagerPerfTests \
     ActivityManagerPerfTestsTestApp \
     ActivityManagerPerfTestsStubApp1 \
diff --git a/build/tasks/tests/instrumentation_test_list.mk b/build/tasks/tests/instrumentation_test_list.mk
index e75c40d3c..ab1dbe7d5 100644
--- a/build/tasks/tests/instrumentation_test_list.mk
+++ b/build/tasks/tests/instrumentation_test_list.mk
@@ -24,6 +24,8 @@ instrumentation_tests := \
     BinderProxyCountingTestService \
     FrameworksNetTests \
     FrameworksUiServicesTests \
+    FrameworksUiServicesNotificationTests \
+    FrameworksUiServicesZenTests \
     BstatsTestApp \
     FrameworksServicesTests \
     FrameworksMockingServicesTests \
diff --git a/build/tasks/tests/native_metric_test_list.mk b/build/tasks/tests/native_metric_test_list.mk
index badd89c24..6d7dccfde 100644
--- a/build/tasks/tests/native_metric_test_list.mk
+++ b/build/tasks/tests/native_metric_test_list.mk
@@ -23,6 +23,7 @@ native_metric_tests := \
     libandroidfw_benchmarks \
     libhwbinder_benchmark \
     libjavacore-benchmarks \
+    libgui_benchmarks \
     libpowermanager_benchmarks \
     libvibratorservice_benchmarks \
     minikin_perftests \
@@ -30,7 +31,8 @@ native_metric_tests := \
     netd_benchmark \
     VibratorHalIntegrationBenchmark \
     librenderengine_bench \
-    statsd_benchmark
+    statsd_benchmark \
+    surfaceflinger_microbenchmarks
 
 ifneq ($(strip $(BOARD_PERFSETUP_SCRIPT)),)
 native_metric_tests += perf-setup
diff --git a/build/tasks/tests/native_test_list.mk b/build/tasks/tests/native_test_list.mk
index 11530607b..a311729d2 100644
--- a/build/tasks/tests/native_test_list.mk
+++ b/build/tasks/tests/native_test_list.mk
@@ -221,7 +221,7 @@ native_tests := \
     tokio-test_test_tests_macros \
     unicode-xid_test_src_lib \
     update_engine_unittests \
-    url_test_tests_data \
+    url_test_src_lib \
     url_test_tests_unit \
     vintf_object_test \
     wificond_unit_test \
diff --git a/build/tasks/tests/platform_test_list.mk b/build/tasks/tests/platform_test_list.mk
deleted file mode 100644
index cf889d8ce..000000000
--- a/build/tasks/tests/platform_test_list.mk
+++ /dev/null
@@ -1,128 +0,0 @@
-platform_tests += \
-    ActivityManagerPerfTests \
-    ActivityManagerPerfTestsStubApp1 \
-    ActivityManagerPerfTestsStubApp2 \
-    ActivityManagerPerfTestsStubApp3 \
-    ActivityManagerPerfTestsTestApp \
-    AdServicesScenarioTests \
-    AndroidTVJankTests \
-    AndroidXComposeStartupApp \
-    ApiDemos \
-    AppCompatibilityTest \
-    AppLaunch \
-    AppTransitionTests \
-    AutoLocTestApp \
-    AutoLocVersionedTestApp_v1 \
-    AutoLocVersionedTestApp_v2 \
-    BackgroundDexOptServiceIntegrationTests \
-    BandwidthEnforcementTest \
-    BandwidthTests \
-    BootHelperApp \
-    BusinessCard \
-    CalculatorFunctionalTests \
-    CalendarTests \
-    camera_client_test \
-    camera_metadata_tests \
-    CellBroadcastReceiverTests \
-    ConnectivityManagerTest \
-    ContactsTests \
-    CtsCameraTestCases \
-    CtsHardwareTestCases \
-    DataIdleTest \
-    Development \
-    DeviceHealthChecks \
-    DynamicCodeLoggerIntegrationTests \
-    DialerJankTests \
-    DownloadManagerTestApp \
-    StubIME \
-    ExternalLocAllPermsTestApp \
-    ExternalLocTestApp \
-    ExternalLocVersionedTestApp_v1 \
-    ExternalLocVersionedTestApp_v2 \
-    ExternalSharedPermsBTTestApp \
-    ExternalSharedPermsDiffKeyTestApp \
-    ExternalSharedPermsFLTestApp \
-    ExternalSharedPermsTestApp \
-    flatland \
-    FrameworkPerf \
-    FrameworkPermissionTests \
-    FrameworksCoreTests \
-    FrameworksMockingCoreTests \
-    FrameworksPrivacyLibraryTests \
-    FrameworksUtilTests \
-    InternalLocTestApp \
-    JankMicroBenchmarkTests \
-    LauncherIconsApp \
-    long_trace_binder_config.textproto \
-    long_trace_config.textproto \
-    MemoryUsage \
-    MultiDexLegacyTestApp \
-    MultiDexLegacyTestApp2 \
-    MultiDexLegacyTestServices \
-    MultiDexLegacyTestServicesTests \
-    MultiDexLegacyVersionedTestApp_v1 \
-    MultiDexLegacyVersionedTestApp_v2 \
-    MultiDexLegacyVersionedTestApp_v3 \
-    NoLocTestApp \
-    NoLocVersionedTestApp_v1 \
-    NoLocVersionedTestApp_v2 \
-    OverviewFunctionalTests \
-    perfetto_trace_processor_shell \
-    PerformanceAppTest \
-    PerformanceLaunch \
-    PermissionFunctionalTests \
-    PermissionTestAppMV1 \
-    PermissionUtils \
-    PlatformCommonScenarioTests \
-    PowerPerfTest \
-    SdkSandboxPerfScenarioTests \
-    SettingsUITests \
-    SimpleServiceTestApp1 \
-    SimpleServiceTestApp2 \
-    SimpleServiceTestApp3 \
-    SimpleTestApp \
-    sl4a \
-    SmokeTest \
-    SmokeTestApp \
-    trace_config.textproto \
-    trace_config_boot_time.textproto \
-    trace_config_boot_time_stop.textproto \
-    trace_config_detailed.textproto \
-    trace_config_detailed_heapdump.textproto \
-    trace_config_experimental.textproto \
-    trace_config_multi_user_cuj_tests.textproto \
-    trace_config_post_boot.textproto \
-    trace_config_power.textproto \
-    UbSystemUiJankTests \
-    UbWebViewJankTests \
-    UiBench \
-    UiBenchJankTests \
-    UiBenchJankTestsWear \
-    UiBenchMicrobenchmark \
-    UpdateExternalLocTestApp_v1_ext \
-    UpdateExternalLocTestApp_v2_none \
-    UpdateExtToIntLocTestApp_v1_ext \
-    UpdateExtToIntLocTestApp_v2_int \
-    uwb_snippet \
-    VersatileTestApp_Auto \
-    VersatileTestApp_External \
-    VersatileTestApp_Internal \
-    VersatileTestApp_None \
-    VoiceInteraction \
-    WifiStrengthScannerUtil \
-    wifi_direct_mobly_snippet \
-    wifi_aware_snippet_new \
-
-ifneq ($(strip $(BOARD_PERFSETUP_SCRIPT)),)
-platform_tests += perf-setup
-endif
-
-ifneq ($(filter vsoc_arm vsoc_arm64 vsoc_x86 vsoc_x86_64, $(TARGET_BOARD_PLATFORM)),)
-  platform_tests += \
-    CuttlefishRilTests \
-    CuttlefishWifiTests
-endif
-
-ifeq ($(HOST_OS),linux)
-platform_tests += root-canal
-endif
diff --git a/libraries/OWNERS b/libraries/OWNERS
index 613d55baa..f05b14edd 100644
--- a/libraries/OWNERS
+++ b/libraries/OWNERS
@@ -2,7 +2,6 @@ gelanchezhian@google.com
 guangzhu@google.com
 harrytczhang@google.com
 jdesprez@google.com
-moonk@google.com
 mrosenfeld@google.com
 sbasi@google.com
 tsu@google.com
diff --git a/libraries/annotations/__init__.py b/libraries/annotations/__init__.py
index d2e7e5291..f5f9849f5 100644
--- a/libraries/annotations/__init__.py
+++ b/libraries/annotations/__init__.py
@@ -16,6 +16,7 @@
 
 from .src.py.ApiTest import ApiTest
 from .src.py.CddTest import CddTest
+from .src.py.DesktopTest import DesktopTest
 from .src.py.GmsTest import GmsTest
 from .src.py.NonApiTest import NonApiTest
 from .src.py.ReasonType import ReasonType
diff --git a/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsDisabled.java b/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsDisabled.java
index 5d2b9d33e..8e86cca1f 100644
--- a/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsDisabled.java
+++ b/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsDisabled.java
@@ -17,6 +17,7 @@
 package android.platform.test.annotations;
 
 import java.lang.annotation.ElementType;
+import java.lang.annotation.Inherited;
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
 import java.lang.annotation.Target;
@@ -42,9 +43,12 @@ import java.lang.annotation.Target;
  * <p>Both {@code SetFlagsRule} and {@code CheckFlagsRule} will fail the test if a particular flag
  * is both set (with {@code EnableFlags} or {@code DisableFlags}) and required (with {@code
  * RequiresFlagsEnabled} or {@code RequiresFlagsDisabled}).
+ *
+ * <p>{@link Inherited} so that subclasses will inherit superclass value, especially for benchmarks.
  */
 @Retention(RetentionPolicy.RUNTIME)
 @Target({ElementType.METHOD, ElementType.TYPE})
+@Inherited
 public @interface RequiresFlagsDisabled {
     /**
      * The list of the feature flags that require to be disabled. Each item is the full flag name
diff --git a/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsEnabled.java b/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsEnabled.java
index 5b5271d85..bd544d5de 100644
--- a/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsEnabled.java
+++ b/libraries/annotations/src/android/platform/test/annotations/RequiresFlagsEnabled.java
@@ -17,6 +17,7 @@
 package android.platform.test.annotations;
 
 import java.lang.annotation.ElementType;
+import java.lang.annotation.Inherited;
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
 import java.lang.annotation.Target;
@@ -42,9 +43,12 @@ import java.lang.annotation.Target;
  * <p>Both {@code SetFlagsRule} and {@code CheckFlagsRule} will fail the test if a particular flag
  * is both set (with {@code EnableFlags} or {@code DisableFlags}) and required (with {@code
  * RequiresFlagsEnabled} or {@code RequiresFlagsDisabled}).
+ *
+ * <p>{@link Inherited} so that subclasses will inherit superclass value, especially for benchmarks.
  */
 @Retention(RetentionPolicy.RUNTIME)
 @Target({ElementType.METHOD, ElementType.TYPE})
+@Inherited
 public @interface RequiresFlagsEnabled {
     /**
      * The list of the feature flags that require to be enabled. Each item is the full flag name
diff --git a/libraries/annotations/src/py/DesktopTest.py b/libraries/annotations/src/py/DesktopTest.py
new file mode 100644
index 000000000..a6c31045e
--- /dev/null
+++ b/libraries/annotations/src/py/DesktopTest.py
@@ -0,0 +1,34 @@
+#  Copyright (C) 2024 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+"""DesktopTest decorator."""
+
+from typing import List
+
+
+class DesktopTest(object):
+  """Marks the type of test with purpose of asserting Desktop requirements.
+
+  Args:
+      requirements: the list of Desktop requirements.
+
+  Example:
+      @DesktopTest(requirements=['D-0-1', 'D-0-2'])
+  """
+
+  def __init__(self, requirements: List[str] = []):
+    self._requirements = requirements
+
+  def __call__(self, func):
+    return func
\ No newline at end of file
diff --git a/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper.java b/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper.java
index e3ab07c3f..bfa51fb95 100644
--- a/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper.java
+++ b/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper.java
@@ -19,8 +19,6 @@ package android.platform.helpers;
 import static android.content.pm.PackageManager.FLAG_PERMISSION_USER_SET;
 import static android.content.pm.PackageManager.PERMISSION_GRANTED;
 
-import static com.android.systemui.Flags.keyguardBottomAreaRefactor;
-
 import android.accounts.Account;
 import android.accounts.AccountManager;
 import android.app.ActivityManager;
@@ -113,9 +111,6 @@ public abstract class AbstractStandardAppHelper implements IAppHelper {
     private SpectatioConfigUtil mSpectatioConfigUtil;
     private SpectatioUiUtil mSpectatioUiUtil;
 
-    private static final BySelector KEYGUARD_BOTTOM_AREA_VIEW =
-            By.res("com.android.systemui", "keyguard_bottom_area");
-
     private static final BySelector KEYGUARD_ROOT_VIEW =
             By.res("com.android.systemui", "keyguard_root_view");
 
@@ -243,13 +238,7 @@ public abstract class AbstractStandardAppHelper implements IAppHelper {
         }
 
         BySelector screenLock;
-        // keyguardBottomAreaRefactor() needs READ_DEVICE_CONFIG permission
-        // which is only available for system app.
-        if (!mUnrootNonPixel && keyguardBottomAreaRefactor()) {
-            screenLock = KEYGUARD_ROOT_VIEW;
-        } else {
-            screenLock = KEYGUARD_BOTTOM_AREA_VIEW;
-        }
+        screenLock = KEYGUARD_ROOT_VIEW;
 
         // Unlock the screen if necessary.
         Trace.beginSection("unlock screen");
diff --git a/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper2.java b/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper2.java
index 73930656c..48da4bab5 100644
--- a/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper2.java
+++ b/libraries/app-helpers/core/src/android/platform/helpers/AbstractStandardAppHelper2.java
@@ -19,8 +19,6 @@ package android.platform.helpers;
 import static android.content.pm.PackageManager.FLAG_PERMISSION_USER_SET;
 import static android.content.pm.PackageManager.PERMISSION_GRANTED;
 
-import static com.android.systemui.Flags.keyguardBottomAreaRefactor;
-
 import android.accounts.Account;
 import android.accounts.AccountManager;
 import android.app.ActivityManager;
@@ -104,9 +102,6 @@ public abstract class AbstractStandardAppHelper2 implements IAppHelper {
     private SpectatioConfigUtil mSpectatioConfigUtil;
     private SpectatioUiUtil mSpectatioUiUtil;
 
-    private static final BySelector KEYGUARD_BOTTOM_AREA_VIEW =
-            By.res("com.android.systemui", "keyguard_bottom_area");
-
     private static final BySelector KEYGUARD_ROOT_VIEW =
             By.res("com.android.systemui", "keyguard_root_view");
 
@@ -234,13 +229,7 @@ public abstract class AbstractStandardAppHelper2 implements IAppHelper {
         }
 
         BySelector screenLock;
-        // keyguardBottomAreaRefactor() needs READ_DEVICE_CONFIG permission
-        // which is only available for system app.
-        if (!mUnrootNonPixel && keyguardBottomAreaRefactor()) {
-            screenLock = KEYGUARD_ROOT_VIEW;
-        } else {
-            screenLock = KEYGUARD_BOTTOM_AREA_VIEW;
-        }
+        screenLock = KEYGUARD_ROOT_VIEW;
 
         // Unlock the screen if necessary.
         Trace.beginSection("unlock screen");
diff --git a/libraries/app-helpers/interfaces/auto/OWNERS b/libraries/app-helpers/interfaces/auto/OWNERS
index 6285f3143..84dd7d9a3 100644
--- a/libraries/app-helpers/interfaces/auto/OWNERS
+++ b/libraries/app-helpers/interfaces/auto/OWNERS
@@ -3,3 +3,4 @@ smara@google.com
 rrwoods@google.com
 shubhras@google.com
 vitalidim@google.com
+rustamx@google.com
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoAccountsHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoAccountsHelper.java
index 720776b05..4a57bd7d4 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoAccountsHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoAccountsHelper.java
@@ -32,11 +32,10 @@ public interface IAutoAccountsHelper extends IAppHelper {
      */
     void removeAccount(String email);
 
-
     /**
      * Setup expectation: Accounts setting is open.
      *
-     * check if an email exists.
+     * <p>check if an email exists.
      */
-    boolean doesEmailExist(String email);
+    boolean isEmailExist(String email);
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoBluetoothSettingsHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoBluetoothSettingsHelper.java
index 92f5b9bb2..3a4fdc2aa 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoBluetoothSettingsHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoBluetoothSettingsHelper.java
@@ -104,6 +104,15 @@ public interface IAutoBluetoothSettingsHelper extends IAppHelper, Scrollable {
      */
     void pressDevice(String deviceName);
 
+    /**
+     * Waits until device connection status is changed
+     *
+     * <p>Setup Expectations: The bluetooth settings view is open.
+     *
+     * @param status - expected statuts to be displayed
+     */
+    void waitUntilConnectionStatus(String status);
+
     /**
      * Setup Expectations: A connected device bluetooth view is open ('level two')
      *
@@ -140,4 +149,11 @@ public interface IAutoBluetoothSettingsHelper extends IAppHelper, Scrollable {
      * <p>Setup Expectations: A connected device bluetooth view is open ('level two')
      */
     void goBackToBluetoothSettings();
+
+    /**
+     * Setup Expectations: A connected device bluetooth summary page is open ('level two')
+     *
+     * @return - Whether the phone profile is enabled
+     */
+    boolean isPhoneProfileEnabled();
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoCarSmsMessengerHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoCarSmsMessengerHelper.java
index b41e7022b..98d9a7d9e 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoCarSmsMessengerHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoCarSmsMessengerHelper.java
@@ -19,6 +19,13 @@ package android.platform.helpers;
 /** Car Sms Helper Interface */
 public interface IAutoCarSmsMessengerHelper extends IAppHelper, Scrollable {
 
+    /**
+     * Setup expectations: None
+     *
+     * <p>This method is used to close the SMS app.
+     */
+    void close();
+
     /**
      * Setup expectations: bluetooth off
      *
@@ -67,4 +74,19 @@ public interface IAutoCarSmsMessengerHelper extends IAppHelper, Scrollable {
      * <p>This method is used to verify microphone Transcription plate in status bar.
      */
     boolean isAssistantSMSTranscriptionPlateDisplayed();
+
+    /**
+     * Setup expectations: Mutes conversation in SMS app in the car's head unit.
+     *
+     * <p>This method is used to unmute the conversation with the given title.
+     */
+    void unmuteCurrentConversationWithTitle(String title);
+
+    /**
+     * Setup expectations: Mutes conversation in SMS app in the car's head unit.
+     *
+     * <p>This methods is used to unmute the conversation with the given title.
+     * Open the SMS app first. Performs unmute. Closes the SMS app.
+     */
+    void unmuteConversationWithTitle(String title);
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoDialHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoDialHelper.java
index 649d62a59..e22d65c63 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoDialHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoDialHelper.java
@@ -220,6 +220,13 @@ public interface IAutoDialHelper extends IAppHelper, Scrollable {
      */
     String getContactType();
 
+    /**
+     * Setup expectations: The app is open.
+     *
+     * <p>Search the contact specified by the `-e search-contact-name` command line parameter.
+     */
+    void searchContacts();
+
     /**
      * Setup expectations: The app is open.
      *
@@ -305,6 +312,13 @@ public interface IAutoDialHelper extends IAppHelper, Scrollable {
      */
     void openContacts();
 
+    /**
+     * Setup expectations: The contacts page is open.
+     *
+     * <p>This method is used to open favorite menu. Throws an error if no contacts are visible.
+     */
+    void openFavorites();
+
     /**
      * Setup expectations: The contacts page is open.
      *
@@ -398,4 +412,18 @@ public interface IAutoDialHelper extends IAppHelper, Scrollable {
      * <p>This method is used to check if Dialpad tab is present in dialer page
      */
     boolean verifyDialerDialpadTab();
+
+    /**
+     * Setup expectations: The dialer page is open
+     *
+     * <p>This method is used to check if search lens is present in dialer page
+     */
+    boolean verifyDialerSearchLens();
+
+    /**
+     * Setup expectations: The dialer page is open
+     *
+     * <p>This method is used to check if dialer settings is present in dialer page
+     */
+    boolean verifyDialerSettings();
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoHeadsUpNotificationHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoHeadsUpNotificationHelper.java
new file mode 100644
index 000000000..580ef99d3
--- /dev/null
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoHeadsUpNotificationHelper.java
@@ -0,0 +1,181 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.platform.helpers;
+
+import androidx.test.uiautomator.UiObject2;
+
+public interface IAutoHeadsUpNotificationHelper extends Scrollable, IAppHelper {
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     * Find the heads-up notification in the car's head unit.
+     * Returns the first heads-up notification found.
+     *
+     * @return UiObject2 representing the heads-up notification, or null if it's not found.
+     */
+    UiObject2 findHun();
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Return the heads-up notification object.
+     * Imlemented in case other notification pops up in the car's head unit while performing swipe, mute, etc.
+     *
+     * @param notification The UiObject2 representing the heads-up notification.
+     * @return UiObject2 representing the heads-up notification, or null if it's not found.
+     */
+    UiObject2 findHun(UiObject2 notification);
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Find the heads-up notification in the car's head unit with the given title.
+     * Returns the first heads-up notification found with the given title.
+     * Swipes all heads-up notifications in the car's head unit if there are
+     * multiple to find the one with the given title.
+     *
+     * @param text The text to match with the heads-up notification title.
+     * @return UiObject2 representing the heads-up notification, or null if it's not found.
+     */
+    UiObject2 findHunWithTitle(String text);
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Check if HUN is displayed in the car's head unit.
+     *
+     * @return True if the HUN is displayed, false otherwise.
+     */
+    boolean isHunDisplayed();
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Check if HUN is displayed in the car's head unit with the given title.
+     *
+     * @param text The text to match with the heads-up notification title.
+     * @return True if the HUN is displayed with the given title, false otherwise.
+     */
+    boolean isHunDisplayedWithTitle(String text);
+
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Swipe the heads-up notification in the car's head unit.
+     *
+     * @param notification The UiObject2 representing the heads-up notification.
+     */
+    void swipeHun(UiObject2 notification);
+
+    /**
+     * Setup expectations: Heads-up notification is posted.
+     *
+     * Swipe HUN with the given title in the car's head unit.
+     *
+     * @param text The text to match with the heads-up notification title.
+     */
+    void swipeHun(String text);
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Find the SMS heads-up notification in the car's head unit.
+     * Returns the first SMS heads-up notification found.
+     *
+     * @return UiObject2 representing the SMS heads-up notification, or null if it's not found.
+     */
+    UiObject2 findSmsHun();
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Find the SMS heads-up notification in the car's head unit with the given title.
+     * Returns the first SMS heads-up notification found with the given title.
+     * Swipes all heads-up notifications in the car's head unit if there are
+     * multiple to find the one with the given title.
+     *
+     * @param text The text to match with the heads-up notification title.
+     * @return UiObject2 representing the SMS heads-up notification, or null if it's not found.
+     */
+    UiObject2 findSmsHunWithTitle(String text);
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Check if SMS HUN is displayed in the car's head unit.
+     *
+     * @return True if the SMS HUN is displayed, false otherwise.
+     */
+    boolean isSmsHunDisplayed();
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Check if SMS HUN is displayed in the car's head unit with the given title.
+     *
+     * @param text The text to match with the heads-up notification title.
+     * @return True if the SMS HUN is displayed with the given title, false otherwise.
+     */
+    boolean isSmsHunDisplayedWithTitle(String text);
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Get the content of the SMS heads-up notification in the car's head unit.
+     *
+     * @param text The text to match with the heads-up notification title.
+     * @return The content of the SMS heads-up notification, or null if it's not found.
+     */
+    String getSmsHunContent(String text);
+
+    /**
+     * Setup expectations: SMS is sent to the paired phone which is connected to the car.
+     *
+     * Mute the SMS HUN with the given title in the car's head unit.
+     *
+     * @param text The text to match with the heads-up notification title.
+     */
+    void muteSmsHun(String text);
+
+    /**
+     * Setup expectations: SMS is sent to the paired phone which is connected to the car.
+     *
+     * Play the SMS HUN with the given title in the car's head unit.
+     *
+     * @param text The text to match with the heads-up notification title.
+     */
+    void playSmsHun(String text);
+
+    /**
+     * Setup expectations: SMS is sent to the paired phone which is connected to the car.
+     *
+     * Check whether SMS HUN is played in the car's head unit.
+     *
+     * @return True if the SMS HUN is played in the car's head unit, false otherwise.
+     */
+    boolean isSmsHunPlayedViaCarSpeaker();
+
+
+    /**
+     * Setup expectations: A heads-up notification (HUN) is posted.
+     *
+     * Wait for the heads-up notification in the car's head unit to disappear.
+     *     *
+     * @return True if the heads-up notification in the car's head unit disappears within the given timeout, false otherwise.
+     */
+    boolean waitForHunToDisappear();
+}
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoMediaHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoMediaHelper.java
index 49a4ff13f..2fab6d2fe 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoMediaHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoMediaHelper.java
@@ -131,6 +131,12 @@ public interface IAutoMediaHelper extends IAppHelper, Scrollable {
      */
     boolean isPlaying();
 
+    /**
+     * This method is used to check if media is currently Paused Returns true if media is paused
+     * else returns false
+     */
+    boolean isPaused();
+
     /**
      * Setup expectations: Media app is open.
      *
@@ -316,4 +322,10 @@ public interface IAutoMediaHelper extends IAppHelper, Scrollable {
      */
     void grantRestrictedPermissionsForBTMedia(String permission);
 
+    /**
+     * Setup expectations: Radio is open
+     *
+     * <p>This method verifies if the Radio app is Open
+     */
+    boolean isRadioAppLaunched();
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoNotificationHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoNotificationHelper.java
index 6c7cf62ef..ac7bf7564 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoNotificationHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoNotificationHelper.java
@@ -30,17 +30,36 @@ public interface IAutoNotificationHelper extends Scrollable, IAppHelper {
      * <p>Check whether notification has been posted.
      *
      * @param title of the notification to be checked.
-     */
+    */
     boolean checkNotificationExists(String title);
 
     /**
      * Setup expectations: A notification is received.
      *
-     * <p>Swipe away a received notification.
+     * <p>Check whether notification with specific title exists in notification center.
+     *
+     * @param title text of the notification.
+     */
+    boolean isNotificationDisplayedInCenterWithTitle(String title);
+
+    /**
+     * Setup expectations: A notification is received.
+     *
+     * <p>Check whether notification with specific content exists in notification center.
+     *
+     * @param content of the notification to be checked.
+     */
+    boolean isNotificationDisplayedInCenterWithContent(String content);
+
+    /**
+     * Setup expectations: A notification is received.
+     *
+     * <p>Swipe away a received notification to remove.
      *
      * @param title of the notification to be swiped.
      */
     void removeNotification(String title);
+
     /**
      * Setup expectations: Notification app is open and scrolled to the bottom.
      *
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoPrivacySettingsHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoPrivacySettingsHelper.java
index 87a9dbb68..16906ad80 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoPrivacySettingsHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoPrivacySettingsHelper.java
@@ -253,4 +253,17 @@ public interface IAutoPrivacySettingsHelper extends IAppHelper {
      */
     void skipImprovementCallingAndTextingPopUp();
 
+    /**
+     * Setup expectation: On Privacy Settings Page
+     *
+     * <p>Click on Location Text in the Right panel/ sub Settings page
+     */
+    void clickOnLocationInPrivacySettings();
+
+    /**
+     * Setup expectation: Home screen is open
+     *
+     * <p>Click on Mic
+     */
+    void clickMicroPhoneOnScreen();
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingHelper.java
index 022c9ce84..b4890d0fd 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingHelper.java
@@ -214,6 +214,13 @@ public interface IAutoSettingHelper extends IAppHelper {
      */
     String getPageTitleText();
 
+    /**
+     * Setup expectations: Setting is open.
+     *
+     * <p>Get the current page title text.
+     */
+    String getSettingsPageTitleText();
+
     /**
      * Setup expectations: Setting is open.
      *
@@ -221,6 +228,13 @@ public interface IAutoSettingHelper extends IAppHelper {
      */
     boolean checkMenuExists(String setting);
 
+    /**
+     * Setup expectations: Setting is displayed on scrolling.
+     *
+     * <p>scroll and check whether a setting menu in Settings is displayed or not .
+     */
+    boolean scrollAndCheckMenuExists(String setting);
+
     /**
      * Setup expectations: Setting is open.
      *
@@ -244,4 +258,11 @@ public interface IAutoSettingHelper extends IAppHelper {
      * <p>This method checks if Recently accessed apps is displayed in settings Location
      */
     boolean isRecentAppDisplayedInLocationSettings(String app);
+
+    /**
+     * Setup expectation: None
+     *
+     * <p>This method presses settings back
+     */
+    void pressSettingsBackNavIcon();
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingsLocationHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingsLocationHelper.java
index db36416dc..cb0e51483 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingsLocationHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoSettingsLocationHelper.java
@@ -53,4 +53,25 @@ public interface IAutoSettingsLocationHelper extends IAppHelper {
      * <p>Check if recently accessed options is present
      */
     boolean hasRecentlyAccessed();
+
+    /**
+     * Setup expectations: location settings page is opened
+     *
+     * <p>Opens app level permissions page
+     */
+    void openAppLevelPermissions();
+
+    /**
+     * Setup expectations: location settings page is opened
+     *
+     * <p>Opens maps in recently accessed page
+     */
+    void openMapsInRecentlyAccessed();
+
+    /**
+     * Setup expectations: location settings page is opened
+     *
+     * <p>Clicks View All in location settings
+     */
+    void clickViewAll();
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoStatusBarHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoStatusBarHelper.java
index dfacd6691..6a865ec99 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoStatusBarHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoStatusBarHelper.java
@@ -297,4 +297,19 @@ public interface IAutoStatusBarHelper extends IAppHelper {
      * <p>Get the Device current time Zone
      */
     String getDeviceCurrentTimeZone();
+
+    /**
+     * Setup expectations: Adaptive Brightness Palette Open Adaptive Brightness Toggle ON/OFF
+     *
+     * <p>Click on Adaptive Brightness toggle Switch
+     */
+    void clickOnAdaptiveBrightnessToggleSwitch();
+
+    /**
+     * Method Verifies the Adaptive brightness toggle switch value using API
+     *
+     * @return Boolean Value True if Adaptive brightness Switch is "ON" False if Adaptive brightness
+     *     Switch is "OFF"
+     */
+    boolean isAdaptiveBrightnessOn();
 }
diff --git a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoUserHelper.java b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoUserHelper.java
index 75e0b2d76..518bb38ab 100644
--- a/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoUserHelper.java
+++ b/libraries/app-helpers/interfaces/auto/src/android/platform/helpers/IAutoUserHelper.java
@@ -80,6 +80,13 @@ public interface IAutoUserHelper extends IAppHelper {
      */
     String getProfileNameFromSettings();
 
+    /**
+     * Setup expectation: Profiles and Accounts setting is open.
+     *
+     * <p>This method is to rename the current user.
+     */
+    void editUserName(String name);
+
     /**
      * Setup expectation: Profiles and Accounts setting is open.
      *
diff --git a/libraries/app-helpers/interfaces/handheld/src/android/platform/helpers/IGoogleHelper.java b/libraries/app-helpers/interfaces/handheld/src/android/platform/helpers/IGoogleHelper.java
index 59800e10e..e2a7b4d54 100644
--- a/libraries/app-helpers/interfaces/handheld/src/android/platform/helpers/IGoogleHelper.java
+++ b/libraries/app-helpers/interfaces/handheld/src/android/platform/helpers/IGoogleHelper.java
@@ -201,4 +201,11 @@ public interface IGoogleHelper extends IAppHelper {
     public default boolean clearSearchResult() {
         throw new UnsupportedOperationException("Not yet implemented.");
     }
+
+    /**
+     * Setup expectations: Feed open.
+     *
+     * <p>This method disable the autoplay video preivews
+     */
+    void disableAutoplayVideoPreviews();
 }
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/SetTextConfig.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/SetTextConfig.java
new file mode 100644
index 000000000..d88204601
--- /dev/null
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/SetTextConfig.java
@@ -0,0 +1,42 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package android.platform.spectatio.configs;
+
+import com.google.gson.annotations.SerializedName;
+
+/** Configuration specific to set-text workflow tasks */
+public class SetTextConfig {
+    @SerializedName("TEXT")
+    private String mText;
+
+    @SerializedName("COMMAND_LINE_KEY")
+    private String mCommandLineKey;
+
+    @SerializedName("DEFAULT_VALUE")
+    private String mDefaultValue;
+
+    public String getText() {
+        return mText;
+    }
+
+    public String getCommandLineKey() {
+        return mCommandLineKey;
+    }
+
+    public String getDefaultValue() {
+        return mDefaultValue;
+    }
+}
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/ValidationConfig.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/ValidationConfig.java
new file mode 100644
index 000000000..205cc0d39
--- /dev/null
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/ValidationConfig.java
@@ -0,0 +1,42 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package android.platform.spectatio.configs;
+
+import com.google.gson.annotations.SerializedName;
+
+/** Configuration specific to validate-value workflow tasks */
+public class ValidationConfig {
+    @SerializedName("PROPERTY")
+    private String mProperty;
+
+    @SerializedName("EXPECTED")
+    private String mExpected;
+
+    @SerializedName("EXPECTED_COMMAND_LINE_KEY")
+    private String mExpectedCommandLineKey;
+
+    public String getProperty() {
+        return mProperty;
+    }
+
+    public String getExpected() {
+        return mExpected;
+    }
+
+    public String getExpectedCommandLineKey() {
+        return mExpectedCommandLineKey;
+    }
+}
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTask.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTask.java
index c79e2c33e..d8d60ffc7 100644
--- a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTask.java
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTask.java
@@ -32,6 +32,8 @@ import androidx.test.uiautomator.UiObject2;
 import com.google.common.base.Strings;
 import com.google.gson.annotations.SerializedName;
 
+import java.util.List;
+
 /** Workflow Task For Workflows in Spectatio Config JSON Config */
 public class WorkflowTask {
     private static final String LOG_TAG = WorkflowTask.class.getSimpleName();
@@ -55,23 +57,35 @@ public class WorkflowTask {
     @SerializedName("SCROLL_CONFIG")
     private ScrollConfig mScrollConfig;
 
+    // If task sets text, provide SetText Config
+    @SerializedName("SET_TEXT_CONFIG")
+    private SetTextConfig mSetTextConfig;
+
     // If task needs swiping, provide Swipe Config
     @SerializedName("SWIPE_CONFIG")
     private SwipeConfig mSwipeConfig;
 
+    // If task validates a value, provide Validation Config
+    @SerializedName("VALIDATION_CONFIG")
+    private ValidationConfig mValidationConfig;
+
     public WorkflowTask(
             String name,
             String type,
             WorkflowTaskConfig taskConfig,
             int repeatCount,
             ScrollConfig scrollConfig,
-            SwipeConfig swipeConfig) {
+            SetTextConfig setTextConfig,
+            SwipeConfig swipeConfig,
+            ValidationConfig validationConfig) {
         mName = name;
         mType = type;
         mTaskConfig = taskConfig;
         mRepeatCount = repeatCount;
         mScrollConfig = scrollConfig;
+        mSetTextConfig = setTextConfig;
         mSwipeConfig = swipeConfig;
+        mValidationConfig = validationConfig;
     }
 
     public String getTaskName() {
@@ -94,11 +108,24 @@ public class WorkflowTask {
         return mScrollConfig;
     }
 
+    public SetTextConfig getSetTextConfig() {
+        return mSetTextConfig;
+    }
+
     public SwipeConfig getSwipeConfig() {
         return mSwipeConfig;
     }
 
-    public void executeTask(String workflowName, SpectatioUiUtil spectatioUiUtil) {
+    /**
+     * Execute this task.
+     *
+     * @param workflowName The name of the workflow this task is part of
+     * @param spectatioUiUtil Spectatio
+     * @param fullConfig The full configuration this task is from, for retrieving UI Elements
+     *     referenced by UI_ELEMENT_REFERENCE configuration
+     */
+    public void executeTask(
+            String workflowName, SpectatioUiUtil spectatioUiUtil, SpectatioConfig fullConfig) {
         Log.i(
                 LOG_TAG,
                 String.format(
@@ -112,7 +139,7 @@ public class WorkflowTask {
         int executionCount = 0;
         // Execute Task once by default. Repeat it again based on repeat count i.e. mRepeatCount > 0
         do {
-            executeTask(taskType, workflowName, spectatioUiUtil);
+            executeTask(taskType, workflowName, spectatioUiUtil, fullConfig);
             executionCount++;
             Log.i(
                     LOG_TAG,
@@ -131,7 +158,10 @@ public class WorkflowTask {
     }
 
     private void executeTask(
-            SupportedWorkFlowTasks taskType, String workflowName, SpectatioUiUtil spectatioUiUtil) {
+            SupportedWorkFlowTasks taskType,
+            String workflowName,
+            SpectatioUiUtil spectatioUiUtil,
+            SpectatioConfig fullConfig) {
         switch (taskType) {
             case COMMAND:
                 validateAndExecuteCommand(workflowName, spectatioUiUtil);
@@ -140,12 +170,13 @@ public class WorkflowTask {
                 validateAndVerifyPackage(workflowName, spectatioUiUtil);
                 break;
             case HAS_UI_ELEMENT_IN_FOREGROUND:
-                validateAndVerifyUiElement(workflowName, spectatioUiUtil);
+                validateAndVerifyUiElement(workflowName, spectatioUiUtil, fullConfig);
                 break;
             case CLICK:
                 validateAndClickUiElement(
                         workflowName,
                         spectatioUiUtil,
+                        fullConfig,
                         FindType.NONE,
                         /* isLongClick= */ false,
                         /* isOptional= */ false);
@@ -154,6 +185,7 @@ public class WorkflowTask {
                 validateAndClickUiElement(
                         workflowName,
                         spectatioUiUtil,
+                        fullConfig,
                         FindType.NONE,
                         /* isLongClick= */ false,
                         /* isOptional= */ true);
@@ -162,6 +194,7 @@ public class WorkflowTask {
                 validateAndClickUiElement(
                         workflowName,
                         spectatioUiUtil,
+                        fullConfig,
                         FindType.NONE,
                         /* isLongClick= */ true,
                         /* isOptional= */ false);
@@ -176,6 +209,7 @@ public class WorkflowTask {
                 validateAndClickUiElement(
                         workflowName,
                         spectatioUiUtil,
+                        fullConfig,
                         FindType.SCROLL,
                         /* isLongClick= */ false,
                         /* isOptional= */ false);
@@ -184,10 +218,14 @@ public class WorkflowTask {
                 validateAndClickUiElement(
                         workflowName,
                         spectatioUiUtil,
+                        fullConfig,
                         FindType.SCROLL,
                         /* isLongClick= */ false,
                         /* isOptional= */ true);
                 break;
+            case SET_TEXT:
+                validateAndSetTextOfUiElement(workflowName, spectatioUiUtil, fullConfig);
+                break;
             case SWIPE:
                 validateAndSwipe(workflowName, spectatioUiUtil);
                 break;
@@ -195,6 +233,7 @@ public class WorkflowTask {
                 validateAndClickUiElement(
                         workflowName,
                         spectatioUiUtil,
+                        fullConfig,
                         FindType.SWIPE,
                         /* isLongClick= */ false,
                         /* isOptional= */ false);
@@ -203,10 +242,14 @@ public class WorkflowTask {
                 validateAndClickUiElement(
                         workflowName,
                         spectatioUiUtil,
+                        fullConfig,
                         FindType.SWIPE,
                         /* isLongClick= */ false,
                         /* isOptional= */ true);
                 break;
+            case VALIDATE_VALUE:
+                validateElementHasProperty(workflowName, spectatioUiUtil, fullConfig);
+                break;
             case WAIT_MS:
                 validateAndWait(workflowName, spectatioUiUtil);
                 break;
@@ -215,6 +258,44 @@ public class WorkflowTask {
         }
     }
 
+    private void validateElementHasProperty(
+            String workflowName, SpectatioUiUtil spectatioUiUtil, SpectatioConfig fullConfig) {
+        UiElement uiElement = validateAndGetTaskConfigUiElement(workflowName, fullConfig);
+        BySelector selector = uiElement.getBySelectorForUiElement();
+        List<UiObject2> uiObjects = spectatioUiUtil.findUiObjects(selector);
+        if (uiObjects == null) {
+            throw new IllegalStateException(
+                    String.format("Could not find UI element for selector %s", selector));
+        }
+
+        ValidationConfig validationConfig = validateAndGetTaskValidationConfig(workflowName);
+        String property = validationConfig.getProperty();
+        String expected = validationConfig.getExpected();
+        if (expected == null) {
+            String expectedCommandLineKey = validationConfig.getExpectedCommandLineKey();
+            expected = CommandLineParameters.getValue(expectedCommandLineKey, null);
+        }
+
+        for (UiObject2 uiObject : uiObjects) {
+            if (spectatioUiUtil.validateUiObjectProperty(uiObject, property, expected)) {
+                return;
+            }
+        }
+        throwRuntimeException(
+                "UI Object Property",
+                property,
+                workflowName,
+                String.format("wrong value (should be %s)", expected));
+    }
+
+    private ValidationConfig validateAndGetTaskValidationConfig(String workflowName) {
+        if (mValidationConfig == null) {
+            throwRuntimeException(
+                    "Config", "VALIDATION_CONFIG", workflowName, "Missing or Invalid");
+        }
+        return mValidationConfig;
+    }
+
     private void validateAndWait(String workflowName, SpectatioUiUtil spectatioUiUtil) {
         String waitTime = validateAndGetTaskConfigText(workflowName);
         if (!isValidInteger(/* action= */ "WAIT_MS Value", waitTime, workflowName)) {
@@ -228,8 +309,9 @@ public class WorkflowTask {
         spectatioUiUtil.executeShellCommand(command);
     }
 
-    private void validateAndVerifyUiElement(String workflowName, SpectatioUiUtil spectatioUiUtil) {
-        UiElement uiElement = validateAndGetTaskConfigUiElement(workflowName);
+    private void validateAndVerifyUiElement(
+            String workflowName, SpectatioUiUtil spectatioUiUtil, SpectatioConfig fullConfig) {
+        UiElement uiElement = validateAndGetTaskConfigUiElement(workflowName, fullConfig);
         BySelector selector = uiElement.getBySelectorForUiElement();
         if (!spectatioUiUtil.hasUiElement(selector)) {
             throwRuntimeException(
@@ -264,10 +346,11 @@ public class WorkflowTask {
     private void validateAndClickUiElement(
             String workflowName,
             SpectatioUiUtil spectatioUiUtil,
+            SpectatioConfig fullConfig,
             FindType howToFind,
             boolean isLongClick,
             boolean isOptional) {
-        UiElement uiElement = validateAndGetTaskConfigUiElement(workflowName);
+        UiElement uiElement = validateAndGetTaskConfigUiElement(workflowName, fullConfig);
         BySelector selector = uiElement.getBySelectorForUiElement();
         UiObject2 uiObject = spectatioUiUtil.findUiObject(selector);
         if (howToFind == FindType.SCROLL && !isValidUiObject(uiObject)) {
@@ -355,6 +438,16 @@ public class WorkflowTask {
         }
     }
 
+    private void validateAndSetTextOfUiElement(
+            String workflowName, SpectatioUiUtil spectatioUiUtil, SpectatioConfig fullConfig) {
+        UiElement element = validateAndGetTaskConfigUiElement(workflowName, fullConfig);
+        BySelector selector = element.getBySelectorForUiElement();
+        UiObject2 object = spectatioUiUtil.findUiObject(selector);
+
+        String text = validateAndGetTaskSetText(workflowName);
+        object.setText(text);
+    }
+
     private void validateAndPressKey(
             String workflowName, SpectatioUiUtil spectatioUiUtil, boolean isLongPress) {
         String key = validateAndGetTaskConfigText(workflowName);
@@ -441,10 +534,19 @@ public class WorkflowTask {
         return taskConfigText.trim();
     }
 
-    private UiElement validateAndGetTaskConfigUiElement(String workflowName) {
+    private UiElement validateAndGetTaskConfigUiElement(
+            String workflowName, SpectatioConfig fullConfig) {
         UiElement uiElement = mTaskConfig.getUiElement();
-        if (uiElement == null) {
-            throwRuntimeException("Config", "UI_ELEMENT", workflowName, "Missing or Invalid");
+        String uiElementReference = mTaskConfig.getUiElementReference();
+        if (uiElement == null && uiElementReference == null) {
+            throwRuntimeException(
+                    "Config",
+                    "UI_ELEMENT or UI_ELEMENT_REFERENCE",
+                    workflowName,
+                    "Missing or Invalid");
+        }
+        if (uiElementReference != null) {
+            uiElement = fullConfig.getUiElementFromConfig(uiElementReference);
         }
         return uiElement;
     }
@@ -456,6 +558,25 @@ public class WorkflowTask {
         return mScrollConfig;
     }
 
+    private String validateAndGetTaskSetText(String workflowName) {
+        SetTextConfig setTextConfig = validateAndGetTaskSetTextConfig(workflowName);
+
+        String text = setTextConfig.getText();
+        if (text != null) {
+            return text;
+        }
+
+        String commandLineKey = setTextConfig.getCommandLineKey();
+        if (commandLineKey == null) {
+            throwRuntimeException(
+                    "SET_TEXT_CONFIG",
+                    "TEXT or COMMAND_LINE_KEY",
+                    workflowName,
+                    "Missing or Invalid");
+        }
+        return CommandLineParameters.getValue(commandLineKey, setTextConfig.getDefaultValue());
+    }
+
     private SwipeConfig validateAndGetTaskSwipeConfig(String workflowName) {
         if (mSwipeConfig == null) {
             throwRuntimeException("Config", "SWIPE_CONFIG", workflowName, "Missing or Invalid");
@@ -463,6 +584,13 @@ public class WorkflowTask {
         return mSwipeConfig;
     }
 
+    private SetTextConfig validateAndGetTaskSetTextConfig(String workflowName) {
+        if (mSetTextConfig == null) {
+            throwRuntimeException("Config", "SET_TEXT_CONFIG", workflowName, "Missing or Invalid");
+        }
+        return mSetTextConfig;
+    }
+
     private <E extends Enum<E>> E validateAndGetEnumValue(
             String workflowName, String property, Class<E> enumClass, String value) {
         E enumValue = null;
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTaskConfig.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTaskConfig.java
index 3f1dbb5ee..d2dc01cd2 100644
--- a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTaskConfig.java
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/WorkflowTaskConfig.java
@@ -28,9 +28,13 @@ public class WorkflowTaskConfig {
     @SerializedName("UI_ELEMENT")
     private UiElement mUiElement;
 
-    public WorkflowTaskConfig(String text, UiElement uiElement) {
+    @SerializedName("UI_ELEMENT_REFERENCE")
+    private String mUiElementReference;
+
+    public WorkflowTaskConfig(String text, UiElement uiElement, String uiElementReference) {
         mText = text;
         mUiElement = uiElement;
+        mUiElementReference = uiElementReference;
     }
 
     public String getText() {
@@ -40,4 +44,8 @@ public class WorkflowTaskConfig {
     public UiElement getUiElement() {
         return mUiElement;
     }
+
+    public String getUiElementReference() {
+        return mUiElementReference;
+    }
 }
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTask.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTask.java
index 6a93906a9..464d69e67 100644
--- a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTask.java
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTask.java
@@ -17,7 +17,9 @@
 package android.platform.spectatio.configs.validators;
 
 import android.platform.spectatio.configs.ScrollConfig;
+import android.platform.spectatio.configs.SetTextConfig;
 import android.platform.spectatio.configs.SwipeConfig;
+import android.platform.spectatio.configs.ValidationConfig;
 import android.platform.spectatio.configs.WorkflowTask;
 import android.platform.spectatio.configs.WorkflowTaskConfig;
 import android.platform.spectatio.constants.JsonConfigConstants;
@@ -51,7 +53,9 @@ public class ValidateWorkflowTask implements JsonDeserializer<WorkflowTask> {
                     JsonConfigConstants.CONFIG,
                     JsonConfigConstants.REPEAT_COUNT,
                     JsonConfigConstants.SCROLL_CONFIG,
-                    JsonConfigConstants.SWIPE_CONFIG);
+                    JsonConfigConstants.SET_TEXT_CONFIG,
+                    JsonConfigConstants.SWIPE_CONFIG,
+                    JsonConfigConstants.VALIDATION_CONFIG);
 
     @Override
     public WorkflowTask deserialize(
@@ -104,11 +108,13 @@ public class ValidateWorkflowTask implements JsonDeserializer<WorkflowTask> {
             case HAS_UI_ELEMENT_IN_FOREGROUND:
             case SCROLL_TO_FIND_AND_CLICK:
             case SCROLL_TO_FIND_AND_CLICK_IF_EXIST:
+            case SET_TEXT:
             case SWIPE_TO_FIND_AND_CLICK:
             case SWIPE_TO_FIND_AND_CLICK_IF_EXIST:
-                if (config.getUiElement() == null) {
+            case VALIDATE_VALUE:
+                if (config.getUiElement() == null && config.getUiElementReference() == null) {
                     throwRuntimeException(
-                            "Config UI_ELEMENT for Workflow Task Type",
+                            "Config UI_ELEMENT or UI_ELEMENT_REFERENCE for Workflow Task Type",
                             type,
                             jsonObject,
                             "Missing or Invalid");
@@ -123,7 +129,9 @@ public class ValidateWorkflowTask implements JsonDeserializer<WorkflowTask> {
 
         // Check if a valid type-specific config is provided when e.g. scrolling/swiping is required
         ScrollConfig scrollConfig = null;
+        SetTextConfig setTextConfig = null;
         SwipeConfig swipeConfig = null;
+        ValidationConfig validationConfig = null;
         switch (workflowTaskType) {
             case SCROLL_TO_FIND_AND_CLICK:
             case SCROLL_TO_FIND_AND_CLICK_IF_EXIST:
@@ -133,6 +141,13 @@ public class ValidateWorkflowTask implements JsonDeserializer<WorkflowTask> {
                                 jsonObject.get(JsonConfigConstants.SCROLL_CONFIG),
                                 ScrollConfig.class);
                 break;
+            case SET_TEXT:
+                validateNotNull(JsonConfigConstants.SET_TEXT_CONFIG, jsonObject);
+                setTextConfig =
+                        context.deserialize(
+                                jsonObject.get(JsonConfigConstants.SET_TEXT_CONFIG),
+                                SetTextConfig.class);
+                break;
             case SWIPE:
             case SWIPE_TO_FIND_AND_CLICK:
             case SWIPE_TO_FIND_AND_CLICK_IF_EXIST:
@@ -142,6 +157,13 @@ public class ValidateWorkflowTask implements JsonDeserializer<WorkflowTask> {
                                 jsonObject.get(JsonConfigConstants.SWIPE_CONFIG),
                                 SwipeConfig.class);
                 break;
+            case VALIDATE_VALUE:
+                validateNotNull(JsonConfigConstants.VALIDATION_CONFIG, jsonObject);
+                validationConfig =
+                        context.deserialize(
+                                jsonObject.get(JsonConfigConstants.VALIDATION_CONFIG),
+                                ValidationConfig.class);
+                break;
             default:
                 // Nothing To Do
                 break;
@@ -149,7 +171,15 @@ public class ValidateWorkflowTask implements JsonDeserializer<WorkflowTask> {
 
         int repeatCount = validateAndGetIntValue(JsonConfigConstants.REPEAT_COUNT, jsonObject);
 
-        return new WorkflowTask(name, type, config, repeatCount, scrollConfig, swipeConfig);
+        return new WorkflowTask(
+                name,
+                type,
+                config,
+                repeatCount,
+                scrollConfig,
+                setTextConfig,
+                swipeConfig,
+                validationConfig);
     }
 
     private int validateAndGetIntValue(String key, JsonObject jsonObject) {
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTaskConfig.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTaskConfig.java
index 55881619e..3be026a4c 100644
--- a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTaskConfig.java
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/configs/validators/ValidateWorkflowTaskConfig.java
@@ -40,7 +40,10 @@ import java.util.stream.Collectors;
  */
 public class ValidateWorkflowTaskConfig implements JsonDeserializer<WorkflowTaskConfig> {
     private Set<String> mSupportedProperties =
-            Set.of(JsonConfigConstants.CONFIG_TEXT, JsonConfigConstants.CONFIG_UI_ELEMENT);
+            Set.of(
+                    JsonConfigConstants.CONFIG_TEXT,
+                    JsonConfigConstants.CONFIG_UI_ELEMENT,
+                    JsonConfigConstants.CONFIG_UI_ELEMENT_REFERENCE);
 
     @Override
     public WorkflowTaskConfig deserialize(
@@ -56,13 +59,17 @@ public class ValidateWorkflowTaskConfig implements JsonDeserializer<WorkflowTask
                 validateAndGetUiElementValue(
                         JsonConfigConstants.CONFIG_UI_ELEMENT, jsonObject, context);
 
-        // One of the configurations ( TEXT or UI_ELEMENT ) must be present and must be valid
-        if (textValue == null && uiElementValue == null) {
+        String uiElementReferenceValue =
+                validateAndGetTextValue(
+                        JsonConfigConstants.CONFIG_UI_ELEMENT_REFERENCE, jsonObject);
+
+        // One of the configuration types must be present and must be valid
+        if (textValue == null && uiElementValue == null && uiElementReferenceValue == null) {
             throw new RuntimeException(
                     String.format("Workflow Task Config %s is invalid.", jsonObject));
         }
 
-        return new WorkflowTaskConfig(textValue, uiElementValue);
+        return new WorkflowTaskConfig(textValue, uiElementValue, uiElementReferenceValue);
     }
 
     private String validateAndGetTextValue(String key, JsonObject jsonObject) {
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/constants/JsonConfigConstants.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/constants/JsonConfigConstants.java
index b43483f3d..32fc4ac69 100644
--- a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/constants/JsonConfigConstants.java
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/constants/JsonConfigConstants.java
@@ -56,7 +56,9 @@ public class JsonConfigConstants {
     public static final String CONFIG = "CONFIG";
     public static final String REPEAT_COUNT = "REPEAT_COUNT";
     public static final String SCROLL_CONFIG = "SCROLL_CONFIG";
+    public static final String SET_TEXT_CONFIG = "SET_TEXT_CONFIG";
     public static final String SWIPE_CONFIG = "SWIPE_CONFIG";
+    public static final String VALIDATION_CONFIG = "VALIDATION_CONFIG";
 
     // Supported Workflow Tasks
     public static enum SupportedWorkFlowTasks {
@@ -83,6 +85,8 @@ public class JsonConfigConstants {
         // Finds the given UI Element by Scrolling and Click on it if found ( i.e. No Exception
         // even if UI Element is missing )
         SCROLL_TO_FIND_AND_CLICK_IF_EXIST,
+        // Sets the text of an element (used for quickly filling search boxes)
+        SET_TEXT,
         // Swipes once
         SWIPE,
         // Finds the given UI Element by Swiping and Click on it ( Throws an exception if
@@ -91,6 +95,9 @@ public class JsonConfigConstants {
         // Finds the given UI Element by Swiping and Click on it if found ( i.e. No Exception
         // even if UI Element is missing )
         SWIPE_TO_FIND_AND_CLICK_IF_EXIST,
+        // Confirm that the given value is what's expected, and fail the test by throwing an
+        // exception if it's not
+        VALIDATE_VALUE,
         // Wait For Given Time in milliseconds
         WAIT_MS;
     }
@@ -98,6 +105,7 @@ public class JsonConfigConstants {
     // Workflow Task Config
     public static final String CONFIG_TEXT = "TEXT";
     public static final String CONFIG_UI_ELEMENT = "UI_ELEMENT";
+    public static final String CONFIG_UI_ELEMENT_REFERENCE = "UI_ELEMENT_REFERENCE";
 
     // Scroll Config Constants
     // Supported Properties
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioConfigUtil.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioConfigUtil.java
index d54d36050..06af8b6be 100644
--- a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioConfigUtil.java
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioConfigUtil.java
@@ -258,7 +258,7 @@ public class SpectatioConfigUtil {
         Log.i(LOG_TAG, String.format("Executing Workflow %s", workflowName));
         List<WorkflowTask> tasks = mSpectatioConfig.getWorkflowFromConfig(workflowName);
         for (WorkflowTask task : tasks) {
-            task.executeTask(workflowName, spectatioUiUtil);
+            task.executeTask(workflowName, spectatioUiUtil, mSpectatioConfig);
         }
         Log.i(LOG_TAG, String.format("Done Executing Workflow %s", workflowName));
     }
diff --git a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioUiUtil.java b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioUiUtil.java
index 074631af2..59475c327 100644
--- a/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioUiUtil.java
+++ b/libraries/app-helpers/spectatio/spectatio-util/src/android/platform/spectatio/utils/SpectatioUiUtil.java
@@ -21,11 +21,10 @@ import android.graphics.Point;
 import android.graphics.Rect;
 import android.os.RemoteException;
 import android.os.SystemClock;
-import android.os.UserHandle;
+import android.platform.spectatio.constants.JsonConfigConstants;
 import android.platform.spectatio.exceptions.MissingUiElementException;
 import android.util.Log;
 import android.view.KeyEvent;
-import com.google.escapevelocity.Template;
 
 import androidx.test.uiautomator.By;
 import androidx.test.uiautomator.BySelector;
@@ -35,11 +34,11 @@ import androidx.test.uiautomator.UiObject2;
 import androidx.test.uiautomator.Until;
 
 import com.google.common.base.Strings;
+import com.google.escapevelocity.Template;
 
-import java.io.ByteArrayOutputStream;
 import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
 import java.io.IOException;
-import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.nio.charset.StandardCharsets;
 import java.util.ArrayList;
@@ -47,6 +46,7 @@ import java.util.HashMap;
 import java.util.List;
 import java.util.Locale;
 import java.util.Map;
+import java.util.Set;
 
 public class SpectatioUiUtil {
     private static final String LOG_TAG = SpectatioUiUtil.class.getSimpleName();
@@ -55,6 +55,7 @@ public class SpectatioUiUtil {
 
     private static final int SHORT_UI_RESPONSE_WAIT_MS = 1000;
     private static final int LONG_UI_RESPONSE_WAIT_MS = 5000;
+    private static final int TEN_SECONDS_WAIT = 10000;
     private static final int EXTRA_LONG_UI_RESPONSE_WAIT_MS = 15000;
     private static final int LONG_PRESS_DURATION_MS = 5000;
     private static final int MAX_SCROLL_COUNT = 100;
@@ -251,6 +252,22 @@ public class SpectatioUiUtil {
         wait1Second();
     }
 
+    public void clickAndWait(UiObject2 uiObject, int waitTime) {
+        validateUiObjectAndThrowIllegalArgumentException(uiObject, /* action= */ "Click");
+        uiObject.click();
+        waitNSeconds(waitTime);
+    }
+
+    /**
+     * Click and wait until new window opens, wait for the specified time. Usecases * Clicking a
+     * object that opens a new window * Navigating between screens * Clicking an object that can
+     * open a popup
+     */
+    public void clickAndWaitUntilNewWindowAppears(UiObject2 uiObject) {
+        validateUiObjectAndThrowIllegalArgumentException(uiObject, /* action= */ "Click");
+        uiObject.clickAndWait(Until.newWindow(), EXTRA_LONG_UI_RESPONSE_WAIT_MS);
+    }
+
     /**
      * Click at a specific location in the UI, and wait one second
      *
@@ -315,7 +332,11 @@ public class SpectatioUiUtil {
 
         // Map of supported substitutions
         Map<String, String> vars = new HashMap<>();
-        vars.put("user_id", String.valueOf(UserHandle.CURRENT.myUserId()));
+        try {
+            vars.put("user_id", mDevice.executeShellCommand("am get-current-user"));
+        } catch (IOException e) {
+            Log.e(LOG_TAG, "Could not execute `am get-current-user` to retrieve user id");
+        }
 
         try (InputStreamReader reader =
                 new InputStreamReader(
@@ -375,6 +396,37 @@ public class SpectatioUiUtil {
         return uiObject.findObject(selector);
     }
 
+    /**
+     * Waits for a UI element to appear within a specified timeout.
+     * Relpacement of findUiObject().
+     * Reference: https://developer.android.com/reference/androidx/test/uiautomator/UiDevice#wait
+     *
+     * @param selector The BySelector used to locate the element.
+     * @param timeout  The maximum time to wait in milliseconds.
+     * @return The UiObject2 representing the found element, or null if it's not found within the timeout.
+     */
+    public UiObject2 waitForUiObject(BySelector selector, int timeout) {
+        Log.i(LOG_TAG, "Waiting for UI element: " + selector);
+        validateSelector(selector, /* action= */ "Find UI Object");
+
+        UiObject2 uiObject = mDevice.wait(Until.findObject(selector), timeout);
+        if (uiObject == null) {
+            Log.w(LOG_TAG, "UI element not found within timeout: " + selector);
+        }
+
+        return uiObject;
+    }
+
+    /**
+     * Waits for a UI element to appear using the default timeout.
+     *
+     * @param selector The BySelector used to locate the element.
+     * @return The UiObject2 representing the found element, or null if it's not found within the default timeout.
+     */
+    public UiObject2 waitForUiObject(BySelector selector) {
+        return waitForUiObject(selector, TEN_SECONDS_WAIT);
+    }
+
     /**
      * Checks if given text is available on the Device UI. The text should be exactly same as seen
      * on the screen.
@@ -1163,6 +1215,59 @@ public class SpectatioUiUtil {
         return uiObject != null;
     }
 
+    private Set<String> mSupportedProperties =
+            Set.of(
+                    JsonConfigConstants.CLICKABLE,
+                    JsonConfigConstants.SCROLLABLE,
+                    JsonConfigConstants.TEXT,
+                    JsonConfigConstants.TEXT_CONTAINS,
+                    JsonConfigConstants.DESCRIPTION,
+                    JsonConfigConstants.DESCRIPTION_CONTAINS,
+                    JsonConfigConstants.CLASS,
+                    JsonConfigConstants.DISPLAY_ID,
+                    JsonConfigConstants.RESOURCE_ID);
+
+    /**
+     * Check a UI Object for a given property value.
+     *
+     * @param uiObject object to check
+     * @param property which property to check
+     * @param expected expected value of property
+     */
+    public boolean validateUiObjectProperty(UiObject2 uiObject, String property, String expected) {
+        if (!mSupportedProperties.contains(property)) {
+            throw new RuntimeException(
+                    String.format(
+                            "VALIDATE_VALUE property name %s in Spectatio JSON Config is invalid. "
+                                    + "Supported properties: [ RESOURCE_ID, TEXT, TEXT_CONTAINS, "
+                                    + "DESCRIPTION, DESCRIPTION_CONTAINS, CLASS, CLICKABLE, "
+                                    + "SCROLLABLE, DISPLAY_ID ]",
+                            property));
+        }
+        switch (property) {
+            case JsonConfigConstants.CLICKABLE:
+                return Boolean.toString(uiObject.isClickable()).equalsIgnoreCase(expected);
+            case JsonConfigConstants.SCROLLABLE:
+                return Boolean.toString(uiObject.isScrollable()).equalsIgnoreCase(expected);
+            case JsonConfigConstants.TEXT:
+                return uiObject.getText().equalsIgnoreCase(expected);
+            case JsonConfigConstants.TEXT_CONTAINS:
+                return uiObject.getText().contains(expected);
+            case JsonConfigConstants.DESCRIPTION:
+                return uiObject.getContentDescription().equalsIgnoreCase(expected);
+            case JsonConfigConstants.DESCRIPTION_CONTAINS:
+                return uiObject.getContentDescription().contains(expected);
+            case JsonConfigConstants.CLASS:
+                return uiObject.getClassName().equalsIgnoreCase(expected);
+            case JsonConfigConstants.DISPLAY_ID:
+                return Integer.toString(uiObject.getDisplayId()).equals(expected);
+            case JsonConfigConstants.RESOURCE_ID:
+                return uiObject.getResourceName().equals(expected);
+            default:
+                return false;
+        }
+    }
+
     private void validateUiObjectAndThrowIllegalArgumentException(
             UiObject2 uiObject, String action) {
         if (!isValidUiObject(uiObject)) {
diff --git a/libraries/automotive-helpers/auto-default-config/resources/assets/defaultSpectatioConfig.json b/libraries/automotive-helpers/auto-default-config/resources/assets/defaultSpectatioConfig.json
index 028764fe0..2d947e304 100644
--- a/libraries/automotive-helpers/auto-default-config/resources/assets/defaultSpectatioConfig.json
+++ b/libraries/automotive-helpers/auto-default-config/resources/assets/defaultSpectatioConfig.json
@@ -63,19 +63,21 @@
   },
   "COMMANDS": {
     "OPEN_DIAL_PAD_COMMAND": "am start -a android.intent.action.DIAL",
-    "OPEN_PHONE_ACTIVITY_COMMAND": "am start -n com.android.car.dialer/.ui.TelecomActivity",
+    "OPEN_PHONE_ACTIVITY_COMMAND": "am start --user $user_id -n com.android.car.dialer/.ui.TelecomActivity",
     "OPEN_SMS_ACTIVITY_COMMAND": "am start -n com.android.car.messenger/com.android.car.messenger.ui.launcher.MessageLauncherActivity",
-    "OPEN_APP_GRID_COMMAND": "am start -n com.android.car.carlauncher/.GASAppGridActivity",
+    "OPEN_APP_GRID_COMMAND": "am start --user $user_id -n com.android.car.carlauncher/.GASAppGridActivity",
     "OPEN_NOTIFICATIONS_COMMAND": "service call statusbar 1",
     "STOP_SETTING_APP_COMMAND": "am force-stop com.android.car.settings",
-    "OPEN_SETTINGS_COMMAND": "am start -a android.settings.SETTINGS --user $user_id",
-    "MEDIA_LAUNCH_COMMAND": "am start -a android.car.intent.action.MEDIA_TEMPLATE -e android.car.intent.extra.MEDIA_COMPONENT com.android.bluetooth/com.android.bluetooth.avrcpcontroller.BluetoothMediaBrowserService",
+    "OPEN_SETTINGS_COMMAND": "am start --user $user_id -a android.settings.SETTINGS",
+    "MEDIA_LAUNCH_COMMAND": "am start --user $user_id -a android.car.intent.action.MEDIA_TEMPLATE -e android.car.intent.extra.MEDIA_COMPONENT com.android.bluetooth/com.android.bluetooth.avrcpcontroller.BluetoothMediaBrowserService",
     "MEDIA_LAUNCH_BLUETOOTH_AUDIO_COMMAND": "am start -a android.car.intent.action.MEDIA_TEMPLATE -e android.car.intent.extra.MEDIA_COMPONENT com.google.android.bluetooth/com.android.bluetooth.avrcpcontroller.BluetoothMediaBrowserService",
     "NIGHT_MODE_COMMAND": "dumpsys activity service com.android.car/.CarService day-night-mode  night",
     "DAY_MODE_COMMAND": "dumpsys activity service com.android.car/.CarService day-night-mode  day",
     "OPEN_SYSTEM_UI": "am crash com.android.systemui",
     "OPEN_CAR_UI": "am crash com.android.car",
-    "DATE_COMMAND": "date"
+    "DATE_COMMAND": "date",
+    "ADAPTIVE_BRIGHTNESS_COMMAND": "settings get system screen_brightness_mode",
+    "LOCK_SCREEN_COMMAND": "input text %s"
   },
   "UI_ELEMENTS": {
     "MAKE_CALL": {
@@ -310,8 +312,8 @@
       ]
     },
     "DIALER_SETTINGS_BUTTON": {
-      "TYPE": "RESOURCE_ID",
-      "VALUE": "car_ui_toolbar_menu_item_icon_container"
+      "TYPE": "DESCRIPTION",
+      "VALUE": "Settings"
     },
     "SEARCH_CONTACT": {
       "TYPE": "RESOURCE_ID",
@@ -542,6 +544,11 @@
       "VALUE": "home",
       "PACKAGE": "com.android.systemui"
     },
+    "MICRO_PHONE_ON_SCREEN": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "assistant",
+      "PACKAGE": "com.android.systemui"
+    },
     "HOME_TEMPERATURE_BUTTON": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "hvac_temperature_text",
@@ -851,6 +858,14 @@
       "TYPE": "TEXT",
       "VALUE": "Confirm"
     },
+    "LOCK_SCREEN_PASSWORD": {
+      "TYPE": "TEXT",
+      "VALUE": "Enter your password"
+    },
+    "LOCK_SCREEN_EDIT_TEXT": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "passwordEntry"
+    },
     "NOTIFICATION_VIEW": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "notification_view",
@@ -871,12 +886,17 @@
       "VALUE": "notification_body_icon",
       "PACKAGE": "com.android.systemui"
     },
+    "NOTIFICATION_BODY": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "notification_body",
+      "PACKAGE": "com.android.systemui"
+    },
     "NOTIFICATION_TITLE": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "notification_body_title",
       "PACKAGE": "com.android.systemui"
     },
-    "NOTIFICATION_BODY": {
+    "NOTIFICATION_CONTENT": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "notification_body_content",
       "PACKAGE": "com.android.systemui"
@@ -906,6 +926,26 @@
       "TYPE": "TEXT",
       "VALUE": "Notifications"
     },
+    "HEADSUP_NOTIFICATION" : {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "notification_headsup"
+    },
+    "HEADSUP_NOTIFICATION_TITLE": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "notification_body_title"
+    },
+    "HEADSUP_NOTIFICATION_CONTENT": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "notification_body_content"
+    },
+    "HEADSUP_NOTIFICATION_PLAY_BUTTON": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "action_1"
+    },
+    "HEADSUP_NOTIFICATION_MUTE_BUTTON": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "action_3"
+    },
     "ABOUT_MENU": {
       "TYPE": "TEXT",
       "VALUE": "About",
@@ -1210,6 +1250,15 @@
       "TYPE": "TEXT",
       "VALUE": "Add.*profile"
     },
+    "USER_SETTINGS_RENAME": {
+      "TYPE": "TEXT",
+      "VALUE": "Rename"
+    },
+    "USER_SETTINGS_PROFILE_NAME_EDIT": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "profile_name_text_edit",
+      "PACKAGE": "com.android.car.settings"
+    },
     "USER_SETTINGS_DELETE": {
       "TYPE": "TEXT",
       "VALUE": "Delete"
@@ -1496,7 +1545,12 @@
     "MEDIA_APP_TITLE": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "car_ui_toolbar_title",
-      "PACKAGE": "com.android.car.media"
+      "PACKAGE": "com.chassis.car.ui.plugin"
+    },
+    "RADIO_APP_TITLE": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "car_ui_toolbar_logo",
+      "PACKAGE": "com.chassis.car.ui.plugin"
     },
     "MOW_PLAYING_LABEL": {
       "TYPE": "TEXT",
@@ -1514,12 +1568,11 @@
     },
     "MEDIA_APP_NAVIGATION_ICON": {
       "TYPE": "RESOURCE_ID",
-      "VALUE": "car_ui_toolbar_nav_icon_container",
-      "PACKAGE": "com.android.car.media"
+      "VALUE": "car_ui_toolbar_nav_icon_container"
     },
     "MEDIA_APPS_GRID_TITLE": {
       "TYPE": "RESOURCE_ID",
-      "VALUE": "car_ui_toolbar_title",
+      "VALUE": "app_name",
       "PACKAGE": "com.android.car.carlauncher"
     },
     "MEDIA_SCROLL_DOWN_BUTTON": {
@@ -1644,6 +1697,27 @@
         }
       ]
     },
+    "TOGGLE_PHONE": {
+      "TYPE": "MULTIPLE",
+      "SPECIFIERS": [
+        {
+          "TYPE": "CLASS",
+          "VALUE": "android.widget.Switch"
+        },
+        {
+          "TYPE": "HAS_ANCESTOR",
+          "MAX_DEPTH": 3,
+          "ANCESTOR": {
+            "TYPE": "HAS_DESCENDANT",
+            "MAX_DEPTH": 2,
+            "DESCENDANT": {
+              "TYPE": "TEXT",
+              "VALUE": "Phone Calls"
+            }
+          }
+        }
+      ]
+    },
     "SEARCH": {
       "TYPE": "DESCRIPTION",
       "VALUE": "Search"
@@ -1960,6 +2034,10 @@
       "TYPE": "TEXT",
       "VALUE": "App permissions"
     },
+    "APP_LEVEL_PERMISSION": {
+      "TYPE": "TEXT",
+      "VALUE": "App-level permissions"
+    },
     "INFOTAINMENT_SYSTEM_DATA": {
       "TYPE": "TEXT",
       "VALUE": "Infotainment system data"
@@ -2002,6 +2080,11 @@
       "VALUE": "error_message",
       "PACKAGE": "com.android.car.messenger"
     },
+    "SMS_CONVERSATION_TITLE": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "title",
+      "PACKAGE": "com.android.car.messenger"
+    },
     "SMS_UNREAD_BADGE": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "unread_badge",
@@ -2025,6 +2108,11 @@
       "TYPE": "RESOURCE_ID",
       "VALUE": "transcription_immersive_container"
     },
+    "SMS_CONVERSATION_MUTE_ACTION_BUTTON": {
+      "TYPE": "RESOURCE_ID",
+      "VALUE": "mute_action_button",
+      "PACKAGE": "com.android.car.messenger"
+    },
     "SMS_EMPTY_MESSAGE": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "empty_message",
@@ -2077,6 +2165,23 @@
         }
       ]
     },
+    "GOOGLE_ACCOUNT_BUTTON": {
+      "TYPE": "MULTIPLE",
+      "SPECIFIERS": [
+        {
+          "TYPE": "HAS_DESCENDANT",
+          "MAX_DEPTH": 2,
+          "DESCENDANT": {
+            "TYPE": "TEXT",
+            "VALUE": "Google"
+          }
+        },
+        {
+          "TYPE": "CLASS",
+          "VALUE": "android.widget.RelativeLayout"
+        }
+      ]
+    },
     "DISABLED_PHONE_PROFILE": {
       "TYPE": "MULTIPLE",
       "SPECIFIERS": [
@@ -2283,6 +2388,19 @@
     "USER_SETTINGS_USER_AVATAR": {
       "TYPE": "RESOURCE_ID",
       "VALUE": "user_avatar"
+    },
+    "ADAPTIVE_BRIGHTNESS_TOGGLE_SWITCH": {
+      "TYPE": "MULTIPLE",
+      "SPECIFIERS": [
+        {
+          "TYPE": "DESCRIPTION",
+          "VALUE": "Display brightness"
+        },
+        {
+          "TYPE": "CLASS",
+          "VALUE": "android.widget.Switch"
+        }
+      ]
     }
   },
   "WORKFLOWS": {
@@ -2299,6 +2417,66 @@
         }
       }
     ],
+    "OPEN_DIALER_WORKFLOW": [
+      {
+        "NAME": "Go to Home",
+        "TYPE": "PRESS",
+        "CONFIG": {
+          "TEXT": "HOME"
+        }
+      },
+      {
+        "NAME": "Wait 1 second",
+        "TYPE": "WAIT_MS",
+        "CONFIG": {
+          "TEXT": "1000"
+        }
+      },
+      {
+        "NAME": "Open dialer by activity",
+        "TYPE": "COMMAND",
+        "CONFIG": {
+          "TEXT": "am start -n com.android.car.dialer/.ui.TelecomActivity"
+        }
+      },
+      {
+        "NAME": "Wait 1 second",
+        "TYPE": "WAIT_MS",
+        "CONFIG": {
+          "TEXT": "1000"
+        }
+      }
+    ],
+    "SEARCH_CONTACTS_WORKFLOW": [
+      {
+        "NAME": "Open search",
+        "TYPE": "CLICK",
+        "CONFIG": {
+          "UI_ELEMENT_REFERENCE": "SEARCH_CONTACT"
+        }
+      },
+      {
+        "NAME": "Type contact name",
+        "TYPE": "SET_TEXT",
+        "CONFIG": {
+          "UI_ELEMENT_REFERENCE": "CONTACT_SEARCH_BAR"
+        },
+        "SET_TEXT_CONFIG": {
+          "COMMAND_LINE_KEY": "search-contact-name"
+        }
+      },
+      {
+        "NAME": "Check for searched contact",
+        "TYPE": "VALIDATE_VALUE",
+        "CONFIG": {
+          "UI_ELEMENT_REFERENCE": "CONTACT_SEARCH_RESULT_NAME"
+        },
+        "VALIDATION_CONFIG": {
+          "PROPERTY": "TEXT",
+          "EXPECTED_COMMAND_LINE_KEY": "search-contact-name"
+        }
+      }
+    ],
     "OPEN_LOCATION_SETTINGS_WORKFLOW": [
       {
         "NAME": "Go to Home",
diff --git a/libraries/automotive-helpers/auto-default-config/src/android/platform/helpers/AutomotiveConfigConstants.java b/libraries/automotive-helpers/auto-default-config/src/android/platform/helpers/AutomotiveConfigConstants.java
index f16d0539f..452ecdb93 100644
--- a/libraries/automotive-helpers/auto-default-config/src/android/platform/helpers/AutomotiveConfigConstants.java
+++ b/libraries/automotive-helpers/auto-default-config/src/android/platform/helpers/AutomotiveConfigConstants.java
@@ -173,6 +173,10 @@ public class AutomotiveConfigConstants {
     public static final String LOCK_TYPE_PASSWORD = "LOCK_TYPE_PASSWORD";
     public static final String LOCK_TYPE_PIN = "LOCK_TYPE_PIN";
     public static final String LOCK_SCREEN_CONTINUE_BUTTON = "LOCK_SCREEN_CONTINUE_BUTTON";
+    public static final String LOCK_SCREEN_PASSWORD = "LOCK_SCREEN_PASSWORD";
+    public static final String LOCK_SCREEN_COMMAND = "LOCK_SCREEN_COMMAND";
+    public static final String LOCK_SCREEN_EDIT_TEXT = "LOCK_SCREEN_EDIT_TEXT";
+    public static final String LOCK_SCREEN_CONFIRM_BUTTON = "LOCK_SCREEN_CONFIRM_BUTTON";
 
     // Notification App Constants
     public static final String OPEN_NOTIFICATIONS_COMMAND = "OPEN_NOTIFICATIONS_COMMAND";
@@ -180,8 +184,9 @@ public class AutomotiveConfigConstants {
     public static final String NOTIFICATION_VIEW = "NOTIFICATION_VIEW";
     public static final String CLEAR_ALL_BUTTON = "CLEAR_ALL_BUTTON";
     public static final String APP_ICON = "APP_ICON";
-    public static final String NOTIFICATION_TITLE = "NOTIFICATION_TITLE";
     public static final String NOTIFICATION_BODY = "NOTIFICATION_BODY";
+    public static final String NOTIFICATION_TITLE = "NOTIFICATION_TITLE";
+    public static final String NOTIFICATION_CONTENT = "NOTIFICATION_CONTENT";
     public static final String NOTIFICATION_LIST_EMPTY = "NOTIFICATION_LIST_EMPTY";
     public static final String NOTIFICATION_LIST_SCROLL_FORWARD_BUTTON =
             "NOTIFICATION_LIST_SCROLL_FORWARD_BUTTON";
@@ -193,6 +198,13 @@ public class AutomotiveConfigConstants {
     public static final String MANAGE_BUTTON = "MANAGE_BUTTON";
     public static final String NOTIFICATION_SETTINGS_LAYOUT = "NOTIFICATION_SETTINGS_LAYOUT";
     public static final String NOTIFICATION_SETTINGS_TITLE = "NOTIFICATION_SETTINGS_TITLE";
+    public static final String HEADSUP_NOTIFICATION = "HEADSUP_NOTIFICATION";
+    public static final String HEADSUP_NOTIFICATION_TITLE = "HEADSUP_NOTIFICATION_TITLE";
+    public static final String HEADSUP_NOTIFICATION_CONTENT = "HEADSUP_NOTIFICATION_CONTENT";
+    public static final String HEADSUP_NOTIFICATION_PLAY_BUTTON =
+            "HEADSUP_NOTIFICATION_PLAY_BUTTON";
+    public static final String HEADSUP_NOTIFICATION_MUTE_BUTTON =
+            "HEADSUP_NOTIFICATION_MUTE_BUTTON";
 
     // System Settings Constants
     public static final String SETTINGS_PACKAGE = "SETTINGS_PACKAGE";
@@ -313,6 +325,8 @@ public class AutomotiveConfigConstants {
     public static final String ALBUM_TITLE = "ALBUM_TITLE";
     public static final String CURRENT_SONG_TIME = "CURRENT_SONG_TIME";
     public static final String MAX_SONG_TIME = "MAX_SONG_TIME";
+    public static final String RADIO_APP_TITLE = "RADIO_APP_TITLE";
+
     // NEXT_BUTTON from Account Settings
     public static final String PREVIOUS_BUTTON = "PREVIOUS_BUTTON";
     public static final String SHUFFLE_BUTTON = "SHUFFLE_BUTTON";
@@ -322,6 +336,7 @@ public class AutomotiveConfigConstants {
     public static final String BACK_BUTTON = "BACK_BUTTON";
     public static final String ACCOUNT_SETTINGS_TRY_ANOTHER_WAY =
             "ACCOUNT_SETTINGS_TRY_ANOTHER_WAY";
+    public static final String GOOGLE_ACCOUNT_BUTTON = "GOOGLE_ACCOUNT_BUTTON";
     // Media Center On Home Screen
     public static final String PLAY_PAUSE_BUTTON_HOME_SCREEN = "PLAY_PAUSE_BUTTON_HOME_SCREEN";
     public static final String PREVIOUS_BUTTON_HOME_SCREEN = "PREVIOUS_BUTTON_HOME_SCREEN";
@@ -364,7 +379,7 @@ public class AutomotiveConfigConstants {
     public static final String DEVICE_HEADER_SUMMARY = "DEVICE_HEADER_SUMMARY";
     public static final String DEVICE_HEADER_TITLE = "DEVICE_HEADER_TITLE";
     public static final String DEVICE_CONNECTION_TEXT = "DEVICE_CONNECTION_TOGGLE";
-
+    public static final String TOGGLE_PHONE = "TOGGLE_PHONE";
     public static final String DEVICE_CONNECTION_BUTTON = "DEVICE_CONNECTION_BUTTON";
 
     public static final String DEVICE_CONNECTION_BACK_BUTTON = "DEVICE_CONNECTION_BACK_BUTTON";
@@ -375,6 +390,8 @@ public class AutomotiveConfigConstants {
     public static final String SEARCH_RESULTS = "SEARCH_RESULTS";
     public static final String PAGE_TITLE = "PAGE_TITLE";
     public static final String PERMISSIONS_PAGE_TITLE = "PERMISSIONS_PAGE_TITLE";
+    public static final String OPEN_DIALER_WORKFLOW = "OPEN_DIALER_WORKFLOW";
+    public static final String SEARCH_CONTACTS_WORKFLOW = "SEARCH_CONTACTS_WORKFLOW";
     public static final String DIAL_CONTACT_WORKFLOW = "DIAL_CONTACT_WORKFLOW";
     public static final String SOUND_SETTINGS = "OPEN_SOUND_SETTINGS_WORKFLOW";
     public static final String NETWORK_AND_INTERNET_SETTINGS =
@@ -460,6 +477,8 @@ public class AutomotiveConfigConstants {
     public static final String USER_SETTINGS_SCROLL_ACTION = "USER_SETTINGS_SCROLL_ACTION";
     public static final String USER_SETTINGS_SCROLL_DIRECTION = "USER_SETTINGS_SCROLL_DIRECTION";
     public static final String USER_SETTINGS_ADD_PROFILE = "USER_SETTINGS_ADD_PROFILE";
+    public static final String USER_SETTINGS_RENAME = "USER_SETTINGS_RENAME";
+    public static final String USER_SETTINGS_PROFILE_NAME_EDIT = "USER_SETTINGS_PROFILE_NAME_EDIT";
     public static final String USER_SETTINGS_DELETE = "USER_SETTINGS_DELETE";
     public static final String USER_SETTINGS_OK = "USER_SETTINGS_OK";
     public static final String USER_SETTINGS_DELETE_SELF = "USER_SETTINGS_DELETE_SELF";
@@ -515,6 +534,7 @@ public class AutomotiveConfigConstants {
     public static final String STATUS_BAR_WIFI_SETTINGS = "STATUS_BAR_WIFI_SETTINGS";
     public static final String STATUS_BAR_DISPLAY_SETTINGS = "STATUS_BAR_DISPLAY_SETTINGS";
     public static final String STATUS_BAR_SOUND_SETTINGS = "STATUS_BAR_SOUND_SETTINGS";
+    public static final String MICRO_PHONE_ON_SCREEN = "MICRO_PHONE_ON_SCREEN";
 
     // APP info Setting UI ELEMENTS
     public static final String RECENTLY_OPENED_UI_ELEMENT = "RECENTLY_OPENED_UI_ELEMENT";
@@ -563,6 +583,9 @@ public class AutomotiveConfigConstants {
     public static final String FORGET_WIFI = "FORGET_WIFI";
     public static final String CLOCK_TIME = "CLOCK_TIME";
     public static final String DATE_COMMAND = "DATE_COMMAND";
+    public static final String ADAPTIVE_BRIGHTNESS_COMMAND = "ADAPTIVE_BRIGHTNESS_COMMAND";
+    public static final String ADAPTIVE_BRIGHTNESS_TOGGLE_SWITCH =
+            "ADAPTIVE_BRIGHTNESS_TOGGLE_SWITCH";
 
     // Quick Controls
     public static final String HOME_BLUETOOTH_BUTTON = "HOME_BLUETOOTH_BUTTON";
@@ -601,6 +624,7 @@ public class AutomotiveConfigConstants {
     public static final String MICROPHONE = "MICROPHONE";
     public static final String LOCATION = "LOCATION";
     public static final String APP_PERMISSION = "APP_PERMISSION";
+    public static final String APP_LEVEL_PERMISSION = "APP_LEVEL_PERMISSION";
     public static final String INFOTAINMENT_SYSTEM_DATA = "INFOTAINMENT_SYSTEM_DATA";
     public static final String DATA_SHARING_WITH_GOOGLE = "DATA_SHARING_WITH_GOOGLE";
     public static final String SETTINGS_BACK_BUTTON = "SETTINGS_BACK_BUTTON";
@@ -622,10 +646,13 @@ public class AutomotiveConfigConstants {
     public static final String SMS_PACKAGE = "SMS_PACKAGE";
     public static final String OPEN_SMS_ACTIVITY_COMMAND = "OPEN_SMS_ACTIVITY_COMMAND";
     public static final String SMS_BLUETOOTH_ERROR = "SMS_BLUETOOTH_ERROR";
+    public static final String SMS_CONVERSATION_TITLE = "SMS_CONVERSATION_TITLE";
     public static final String SMS_UNREAD_BADGE = "SMS_UNREAD_BADGE";
     public static final String SMS_PREVIEW_TEXT = "SMS_PREVIEW_TEXT";
     public static final String SMS_PREVIEW_TIMESTAMP = "SMS_PREVIEW_TIMESTAMP";
     public static final String TAP_TO_READ_ALOUD = "TAP_TO_READ_ALOUD";
+    public static final String SMS_CONVERSATION_MUTE_ACTION_BUTTON =
+            "SMS_CONVERSATION_MUTE_ACTION_BUTTON";
     public static final String ASSISTANT_SMS_TRANSCRIPTION_PLATE =
             "ASSISTANT_SMS_TRANSCRIPTION_PLATE";
     public static final String SMS_EMPTY_MESSAGE = "SMS_EMPTY_MESSAGE";
diff --git a/libraries/automotive-helpers/car-sms-messenger-helper/src/android/platform/helpers/CarSmsMessengerHelperImpl.java b/libraries/automotive-helpers/car-sms-messenger-helper/src/android/platform/helpers/CarSmsMessengerHelperImpl.java
index dc77f43f2..811f03585 100644
--- a/libraries/automotive-helpers/car-sms-messenger-helper/src/android/platform/helpers/CarSmsMessengerHelperImpl.java
+++ b/libraries/automotive-helpers/car-sms-messenger-helper/src/android/platform/helpers/CarSmsMessengerHelperImpl.java
@@ -14,16 +14,21 @@
  * limitations under the License.
  */
 package android.platform.helpers;
+import android.util.Log;
 
 import android.app.Instrumentation;
 
 import androidx.test.uiautomator.BySelector;
 import androidx.test.uiautomator.UiObject2;
 
+import java.util.List;
+
 /** CarSmsMessengerHelperImpl class for Android Auto platform functional tests */
 public class CarSmsMessengerHelperImpl extends AbstractStandardAppHelper
         implements IAutoCarSmsMessengerHelper {
 
+    private static final String LOG_TAG = CarSmsMessengerHelperImpl.class.getSimpleName();
+
     public CarSmsMessengerHelperImpl(Instrumentation instr) {
         super(instr);
     }
@@ -49,6 +54,7 @@ public class CarSmsMessengerHelperImpl extends AbstractStandardAppHelper
     /** {@inheritDoc} */
     @Override
     public void open() {
+        Log.i(LOG_TAG, "Opening SMS app");
         getSpectatioUiUtil().pressHome();
         getSpectatioUiUtil().wait1Second();
         getSpectatioUiUtil()
@@ -57,6 +63,13 @@ public class CarSmsMessengerHelperImpl extends AbstractStandardAppHelper
         getSpectatioUiUtil().wait1Second();
     }
 
+    @Override
+    public void close() {
+        Log.i(LOG_TAG, "Closing SMS app");
+        getSpectatioUiUtil().pressHome();
+        getSpectatioUiUtil().wait1Second();
+    }
+
     @Override
     public boolean isSmsBluetoothErrorDisplayed() {
         BySelector bluetoothErrorSelector =
@@ -112,4 +125,36 @@ public class CarSmsMessengerHelperImpl extends AbstractStandardAppHelper
                 getUiElementFromConfig(AutomotiveConfigConstants.ASSISTANT_SMS_TRANSCRIPTION_PLATE);
         return (getSpectatioUiUtil().hasUiElement(assistantSMSPlateSelector));
     }
+
+    @Override
+    public void unmuteCurrentConversationWithTitle(String title) {
+        Log.i(LOG_TAG, "Unmute conversation with title: " + title);
+
+        BySelector smsConversationTitleSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.SMS_CONVERSATION_TITLE);
+        List<UiObject2> smsConversationsTitleObj =
+                getSpectatioUiUtil().findUiObjects(smsConversationTitleSelector);
+
+        // Unmute the conversation with the given title.
+        for (UiObject2 smsConversationTitle : smsConversationsTitleObj) {
+            String titleText = smsConversationTitle.getText().toLowerCase();
+            Log.i(LOG_TAG, "Title text: " + titleText);
+
+            if (titleText.contains(title.toLowerCase())) {
+                UiObject2 parentObject = smsConversationTitle.getParent();
+                UiObject2 muteButton = parentObject.findObject(
+                        getUiElementFromConfig(AutomotiveConfigConstants.SMS_CONVERSATION_MUTE_ACTION_BUTTON)
+                );
+                getSpectatioUiUtil().clickAndWait(muteButton);
+                break;
+            }
+        }
+    }
+
+    @Override
+    public void unmuteConversationWithTitle(String title) {
+        open();
+        unmuteCurrentConversationWithTitle(title);
+        close();
+    }
 }
diff --git a/libraries/automotive-helpers/dial-app-helper/src/android/platform/helpers/DialHelperImpl.java b/libraries/automotive-helpers/dial-app-helper/src/android/platform/helpers/DialHelperImpl.java
index 183b5854b..384a57444 100644
--- a/libraries/automotive-helpers/dial-app-helper/src/android/platform/helpers/DialHelperImpl.java
+++ b/libraries/automotive-helpers/dial-app-helper/src/android/platform/helpers/DialHelperImpl.java
@@ -130,13 +130,7 @@ public class DialHelperImpl extends AbstractStandardAppHelper implements IAutoDi
 
     /** {@inheritDoc} */
     public void open() {
-        getSpectatioUiUtil().pressHome();
-        getSpectatioUiUtil().wait1Second();
-        getSpectatioUiUtil()
-                .executeShellCommand(
-                        getCommandFromConfig(
-                                AutomotiveConfigConstants.OPEN_PHONE_ACTIVITY_COMMAND));
-        getSpectatioUiUtil().wait1Second();
+        executeWorkflow(AutomotiveConfigConstants.OPEN_DIALER_WORKFLOW);
     }
 
     /** {@inheritDoc} */
@@ -369,7 +363,7 @@ public class DialHelperImpl extends AbstractStandardAppHelper implements IAutoDi
     public void dialFromList(String contact) {
         UiObject2 contactToCall = getContactFromContactList(contact);
         getSpectatioUiUtil().clickAndWait(contactToCall);
-        executeWorkflow(AutomotiveConfigConstants.DIAL_CONTACT_WORKFLOW);
+        pressMobileCallOnContact();
     }
 
     /** {@inheritDoc} */
@@ -422,6 +416,12 @@ public class DialHelperImpl extends AbstractStandardAppHelper implements IAutoDi
         return contactType.getText();
     }
 
+    /** {@inheritDoc} */
+    @Override
+    public void searchContacts() {
+        executeWorkflow(AutomotiveConfigConstants.SEARCH_CONTACTS_WORKFLOW);
+    }
+
     /** {@inheritDoc} */
     public void searchContactsByName(String contact) {
         openSearchContact();
@@ -641,15 +641,7 @@ public class DialHelperImpl extends AbstractStandardAppHelper implements IAutoDi
     public void openDialerSettings() {
         BySelector settingsButtonSelector =
                 getUiElementFromConfig(AutomotiveConfigConstants.DIALER_SETTINGS_BUTTON);
-
-        ArrayList<UiObject2> buttonCandidates =
-                new ArrayList<>(getSpectatioUiUtil().findUiObjects(settingsButtonSelector));
-
-        // This is an awkward hard-coding to compensate for the fact that currently the
-        // search button and the settings button have identical metadata.
-        // (The Settings button is the second of the two, hence index 1)
-        // TODO: b/287706588 - Rewrite this UiObject selection to use a new Content Descriptor
-        UiObject2 contactMenuButton = buttonCandidates.get(1);
+        UiObject2 contactMenuButton = getSpectatioUiUtil().findUiObject(settingsButtonSelector);
 
         getSpectatioUiUtil()
                 .validateUiObject(
@@ -752,7 +744,8 @@ public class DialHelperImpl extends AbstractStandardAppHelper implements IAutoDi
     }
 
     /** This method opens the Favorites tab. */
-    private void openFavorites() {
+    @Override
+    public void openFavorites() {
         BySelector favoritesMenuSelector =
                 getUiElementFromConfig(AutomotiveConfigConstants.FAVORITES_MENU);
         UiObject2 favoritesMenuButton = getSpectatioUiUtil().findUiObject(favoritesMenuSelector);
@@ -916,4 +909,20 @@ public class DialHelperImpl extends AbstractStandardAppHelper implements IAutoDi
                 getUiElementFromConfig(AutomotiveConfigConstants.DIALER_DIALPAD);
         return getSpectatioUiUtil().hasUiElement(dialerDialpadSelector);
     }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean verifyDialerSearchLens() {
+        BySelector dialerSearchSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.SEARCH_CONTACT);
+        return getSpectatioUiUtil().hasUiElement(dialerSearchSelector);
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean verifyDialerSettings() {
+        BySelector dialerSettingsSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.DIALER_SETTINGS_BUTTON);
+        return getSpectatioUiUtil().hasUiElement(dialerSettingsSelector);
+    }
 }
diff --git a/libraries/automotive-helpers/lock-screen-helper/src/android/platform/helpers/LockScreenHelperImpl.java b/libraries/automotive-helpers/lock-screen-helper/src/android/platform/helpers/LockScreenHelperImpl.java
index c16be81a5..b137f5bb7 100644
--- a/libraries/automotive-helpers/lock-screen-helper/src/android/platform/helpers/LockScreenHelperImpl.java
+++ b/libraries/automotive-helpers/lock-screen-helper/src/android/platform/helpers/LockScreenHelperImpl.java
@@ -28,8 +28,8 @@ public class LockScreenHelperImpl extends AbstractStandardAppHelper
         implements IAutoLockScreenHelper {
 
     private static final int DEFAULT_WAIT_TIME = 5000;
+    private static final int TEN_SECONDS_WAIT_TIME = 10000;
     private static final int KEY_ENTER = 66;
-    private static final String UNLOCK_BY = "input text %s";
 
     private HelperAccessor<IAutoSecuritySettingsHelper> mSecuritySettingsHelper;
     private HelperAccessor<IAutoSettingHelper> mSettingHelper;
@@ -69,13 +69,16 @@ public class LockScreenHelperImpl extends AbstractStandardAppHelper
             mSecuritySettingsHelper.get().setLockByPassword(credential);
         }
         getSpectatioUiUtil().pressPower();
-        getSpectatioUiUtil().wait5Seconds();
+        getSpectatioUiUtil().waitForIdle();
     }
 
     @Override
     public void unlockScreenBy(LockType lockType, String credential) {
         getSpectatioUiUtil().pressPower();
-        getSpectatioUiUtil().wait5Seconds();
+        getSpectatioUiUtil().waitForIdle();
+        BySelector lockscreenSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.LOCK_SCREEN_PASSWORD);
+        getSpectatioUiUtil().waitForUiObject(lockscreenSelector, TEN_SECONDS_WAIT_TIME);
         if (lockType == LockType.PIN) {
             unlockByPin(credential);
         } else {
@@ -84,8 +87,18 @@ public class LockScreenHelperImpl extends AbstractStandardAppHelper
     }
 
     private void unlockByPassword(String password) {
-        getSpectatioUiUtil().executeShellCommand(String.format(UNLOCK_BY, password));
-        getSpectatioUiUtil().wait5Seconds();
+        BySelector lockscreenSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.LOCK_SCREEN_EDIT_TEXT);
+        UiObject2 editPasswordButtonObject = getSpectatioUiUtil().findUiObject(lockscreenSelector);
+        getSpectatioUiUtil()
+                .validateUiObject(
+                        editPasswordButtonObject, AutomotiveConfigConstants.LOCK_SCREEN_EDIT_TEXT);
+        getSpectatioUiUtil().clickAndWait(editPasswordButtonObject, DEFAULT_WAIT_TIME);
+        getSpectatioUiUtil()
+                .executeShellCommand(
+                        String.format(
+                                getCommandFromConfig(AutomotiveConfigConstants.LOCK_SCREEN_COMMAND),
+                                password));
         pressEnter();
         mSettingHelper.get().openSetting(SettingsConstants.SECURITY_SETTINGS);
     }
diff --git a/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/MediaCenterHelperImpl.java b/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/MediaCenterHelperImpl.java
index 86ae8c765..4052637bb 100644
--- a/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/MediaCenterHelperImpl.java
+++ b/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/MediaCenterHelperImpl.java
@@ -25,6 +25,7 @@ import android.media.session.PlaybackState;
 import android.platform.helpers.ScrollUtility.ScrollActions;
 import android.platform.helpers.ScrollUtility.ScrollDirection;
 import android.platform.helpers.exceptions.UnknownUiException;
+import android.util.Log;
 
 import androidx.test.uiautomator.By;
 import androidx.test.uiautomator.BySelector;
@@ -169,6 +170,9 @@ public class MediaCenterHelperImpl extends AbstractStandardAppHelper implements
      * {@inheritDoc}
      */
     public void pauseMedia() {
+        if (!isPlaying()) {
+            playMedia();
+        }
         BySelector pauseButtonSelector =
                 getUiElementFromConfig(AutomotiveConfigConstants.PLAY_PAUSE_BUTTON);
         UiObject2 pauseButton = getSpectatioUiUtil().findUiObject(pauseButtonSelector);
@@ -178,9 +182,7 @@ public class MediaCenterHelperImpl extends AbstractStandardAppHelper implements
         getSpectatioUiUtil().wait5Seconds();
     }
 
-    /**
-     * {@inheritDoc}
-     */
+    /** {@inheritDoc} */
     public void clickNextTrack() {
         BySelector nextTrackButtonSelector =
                 getUiElementFromConfig(AutomotiveConfigConstants.NEXT_BUTTON);
@@ -363,9 +365,12 @@ public class MediaCenterHelperImpl extends AbstractStandardAppHelper implements
      */
     @Override
     public void minimizeNowPlaying() {
+        Log.d("media_test", "Trying to minimize now");
+        getSpectatioUiUtil().wait5Seconds();
         BySelector trackNameSelector = getUiElementFromConfig(AutomotiveConfigConstants.TRACK_NAME);
         UiObject2 trackNameText = getSpectatioUiUtil().findUiObject(trackNameSelector);
         if (trackNameText != null) {
+            Log.d("media_test", "Trying to swipe now ");
             trackNameText.swipe(Direction.DOWN, 1.0f, 500);
         }
     }
@@ -413,6 +418,16 @@ public class MediaCenterHelperImpl extends AbstractStandardAppHelper implements
         return state.getState() == PlaybackState.STATE_PLAYING;
     }
 
+    @Override
+    public boolean isPaused() {
+        List<MediaController> controllers = mMediaSessionManager.getActiveSessions(null);
+        if (controllers.size() == 0) {
+            throw new RuntimeException("Unable to find Media Controller");
+        }
+        PlaybackState state = controllers.get(0).getPlaybackState();
+        return state.getState() == PlaybackState.STATE_PAUSED;
+    }
+
     /**
      * {@inheritDoc}
      */
@@ -426,6 +441,13 @@ public class MediaCenterHelperImpl extends AbstractStandardAppHelper implements
         return mediaAppTitle.getText();
     }
 
+    @Override
+    public boolean isRadioAppLaunched() {
+        BySelector radioAppSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.RADIO_APP_TITLE);
+        return getSpectatioUiUtil().hasUiElement(radioAppSelector);
+    }
+
     /**
      * {@inheritDoc}
      */
diff --git a/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/TestMediaAppHelperImpl.java b/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/TestMediaAppHelperImpl.java
index fc1146ec8..4eba6745e 100644
--- a/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/TestMediaAppHelperImpl.java
+++ b/libraries/automotive-helpers/media-center-app-helper/src/android/platform/helpers/TestMediaAppHelperImpl.java
@@ -109,7 +109,7 @@ public class TestMediaAppHelperImpl extends AbstractStandardAppHelper
 
         getSpectatioUiUtil()
                 .validateUiObject(
-                        mediaTestAppField, String.format("Test Media App field: %s " + fieldName));
+                        mediaTestAppField, String.format("Test Media App field: %s", fieldName));
         getSpectatioUiUtil().clickAndWait(mediaTestAppField);
         getSpectatioUiUtil().wait1Second();
     }
diff --git a/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoHeadsUpNotificationHelperImpl.java b/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoHeadsUpNotificationHelperImpl.java
new file mode 100644
index 000000000..c6545c478
--- /dev/null
+++ b/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoHeadsUpNotificationHelperImpl.java
@@ -0,0 +1,368 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.platform.helpers;
+
+import android.util.Log;
+import android.app.Instrumentation;
+import android.platform.helpers.ScrollUtility.ScrollActions;
+import android.platform.helpers.ScrollUtility.ScrollDirection;
+
+import androidx.test.uiautomator.By;
+import androidx.test.uiautomator.BySelector;
+import androidx.test.uiautomator.UiObject2;
+
+import java.util.List;
+import java.util.concurrent.*;
+import java.lang.Exception;
+
+/**
+ * Helper for heads-up notifications on Automotive device.
+ */
+public class AutoHeadsUpNotificationHelperImpl extends AbstractStandardAppHelper
+    implements IAutoHeadsUpNotificationHelper {
+
+    private static final String LOG_TAG = AutoHeadsUpNotificationHelperImpl.class.getSimpleName();
+    private static final int TIMEOUT_SECONDS = 10;
+    private static final int HUN_DISMISS_TIMEOUT_SECONDS = 15;
+
+    public AutoHeadsUpNotificationHelperImpl(Instrumentation instr) {
+        super(instr);
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public String getLauncherName() {
+        throw new UnsupportedOperationException("Operation not supported.");
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public String getPackage() {
+        throw new UnsupportedOperationException("Operation not supported.");
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void dismissInitialDialogs() {
+        // Nothing to dismiss
+    }
+
+    /**
+     * General heads-up notification related methods.
+     */
+
+    /** {@inheritDoc} */
+    @Override
+    public UiObject2 findHun() {
+        Log.i(LOG_TAG, "Searching for any heads-up notification in the car's head unit.");
+        BySelector notificationSelector = getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION);
+        UiObject2 notification = getSpectatioUiUtil().waitForUiObject(notificationSelector);
+        if (notification == null) {
+            Log.w(LOG_TAG, "Cannot find any heads-up notification in the car's head unit.");
+        }
+        return notification;
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public UiObject2 findHun(UiObject2 notification) {
+        Log.i(LOG_TAG, "Searching for specific heads-up notification in the car's head unit.");
+        return runWithTimeout(() -> {
+            UiObject2 currentNotification = findHun();
+            while (currentNotification != null && !currentNotification.equals(notification)) {
+                swipeHun(currentNotification);
+                currentNotification = findHun();
+            }
+            if (currentNotification == null) {
+                Log.w(LOG_TAG, "Cannot find specific heads-up notification in the car's head unit.");
+            }
+            return currentNotification;
+        });
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public UiObject2 findHunWithTitle(String text) {
+        Log.i(LOG_TAG, String.format("Searching for heads-up notification with title %s in the car's head unit.", text));
+        return runWithTimeout(() -> {
+            UiObject2 notification = findHun();
+            while (notification != null) {
+                if (isHunTitleMatched(notification, text)) {
+                    Log.i(LOG_TAG, String.format("Heads-up notification displayed with title %s.", text));
+                    return notification;
+                }
+                swipeHun(notification);
+                notification = findHun();
+            }
+            Log.i(LOG_TAG, String.format("Cannot find heads-up notification with title %s.", text));
+            return null;
+        });
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean isHunDisplayed() {
+        Log.i(LOG_TAG, "Checking if any heads-up notification is displayed in the car's head unit.");
+        UiObject2 notification = findHun();
+        return notification != null;
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean isHunDisplayedWithTitle(String text) {
+        Log.i(LOG_TAG, String.format("Checking if heads-up notification with title %s is displayed in the car's head unit.", text));
+        UiObject2 notification = findHunWithTitle(text);
+        return notification != null;
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void swipeHun(UiObject2 notification) {
+        Log.i(LOG_TAG, "Swiping the heads-up notification in the car's head unit.");
+        notification = findHun(notification);
+        getSpectatioUiUtil().swipeRight(notification);
+        // Wait for the notification to dismiss, if it takes more than 2 seconds to dismiss, it is a performance issue.
+        getSpectatioUiUtil().waitNSeconds(2000);
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void swipeHun(String text) {
+        UiObject2 notification = findHunWithTitle(text);
+        swipeHun(notification);
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean waitForHunToDisappear() {
+        return waitForHunToDisappear(HUN_DISMISS_TIMEOUT_SECONDS);
+    }
+
+    public boolean waitForHunToDisappear(int timeout) {
+        Log.i(LOG_TAG, "Waiting for heads-up notification to disappear.");
+
+        timeout = timeout * 1000; // Convert timeout to milliseconds.
+        long startTime = System.currentTimeMillis();
+        long elapsedTime = System.currentTimeMillis() - startTime;
+
+        while (elapsedTime < timeout) {
+            Log.i(LOG_TAG, "Start time: " + startTime);
+            Log.i(LOG_TAG, "Elapsed time: " + elapsedTime);
+
+            BySelector notificationSelector = getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION);
+            UiObject2 notification = getSpectatioUiUtil().waitForUiObject(notificationSelector, 0);
+
+            if (notification == null) {
+                Log.i(LOG_TAG, "Heads-up notification disappeared.");
+                return true;
+            }
+
+            try {
+                Thread.sleep(500);
+            } catch (InterruptedException e) {
+                Thread.currentThread().interrupt();
+                Log.e(LOG_TAG, "Thread interrupted while waiting for HUN to disappear.", e);
+            }
+
+            elapsedTime = System.currentTimeMillis() - startTime;
+        }
+
+        Log.w(LOG_TAG, "Timeout reached while waiting for heads-up notification to disappear.");
+        return false;
+    }
+
+    /**
+     * SMS heads-up notification related methods.
+     */
+
+    /** {@inheritDoc} */
+    @Override
+    public UiObject2 findSmsHun() {
+        Log.i(LOG_TAG, "Searching for SMS HUN in the car's head unit.");
+        return runWithTimeout(() -> {
+            UiObject2 notification = findHun();
+            while (notification != null) {
+                if (isSmsHun(notification)) {
+                    Log.i(LOG_TAG, "SMS HUN displayed.");
+                    return notification;
+                }
+                swipeHun(notification);
+                notification = findHun();
+            }
+            Log.w(LOG_TAG, "Cannot find SMS HUN in the car's head unit.");
+            return null;
+        });
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public UiObject2 findSmsHunWithTitle(String text) {
+        Log.i(LOG_TAG, String.format("Searching for SMS HUN with title %s in the car's head unit.", text));
+        return runWithTimeout(() -> {
+            UiObject2 notification = findSmsHun();
+            while (notification != null) {
+                if (isHunTitleMatched(notification, text)) {
+                    Log.i(LOG_TAG, String.format("SMS HUN displayed with title %s.", text));
+                    return notification;
+                }
+                swipeHun(notification);
+                notification = findSmsHun();
+            }
+            Log.i(LOG_TAG, String.format("Cannot find SMS HUN with title %s.", text));
+            return null;
+        });
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean isSmsHunDisplayed() {
+        Log.i(LOG_TAG, "Checking if SMS HUN is displayed in the car's head unit.");
+        UiObject2 notification = findSmsHun();
+        return notification != null;
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean isSmsHunDisplayedWithTitle(String text) {
+        Log.i(LOG_TAG, String.format("Checking if SMS HUN with title %s is displayed in the car's head unit.", text));
+        UiObject2 notification = findSmsHunWithTitle(text);
+        return notification != null;
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public String getSmsHunContent(String text) {
+        Log.i(LOG_TAG, "Getting the content of SMS HUN.");
+        UiObject2 notification = findHunWithTitle(text);
+        UiObject2 notificationContent = notification.findObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION_CONTENT)
+        );
+        if (notificationContent == null) {
+            Log.w(LOG_TAG, "Cannot to find SMS HUN content.");
+            return null;
+        }
+        return notificationContent.getText();
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void muteSmsHun(String text) {
+        Log.i(LOG_TAG, "Clicking on mute button of SMS HUN.");
+        UiObject2 notification = findHunWithTitle(text);
+        UiObject2 muteButton = notification.findObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION_MUTE_BUTTON)
+        );
+        getSpectatioUiUtil().clickAndWait(muteButton, 2000);
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void playSmsHun(String text) {
+        Log.i(LOG_TAG, "Clicking on play button of SMS HUN.");
+        UiObject2 notification = findHunWithTitle(text);
+        UiObject2 playButton = notification.findObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION_PLAY_BUTTON)
+        );
+        getSpectatioUiUtil().clickAndWait(playButton);
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean isSmsHunPlayedViaCarSpeaker() {
+        Log.i(LOG_TAG, "Checking if SMS HUN is played in the car's head unit.");
+        // TODO: Implement this method. Need to verify if the sound is played from special channel.
+        return true;
+    }
+
+    /**
+     * Check if the heads-up notification title is matched with the given text.
+     *
+     * @param text The text to match with the heads-up notification title.
+     * @return True if the heads-up notification title is matched with the given text, false
+     * otherwise.
+     */
+    private boolean isHunTitleMatched(UiObject2 notification, String text) {
+        UiObject2 notificationTitle = notification.findObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION_TITLE)
+        );
+        if (notificationTitle == null) {
+            Log.w(LOG_TAG, "Cannot find heads-up notification title in the car's head unit.");
+            return false;
+        }
+        String titleText = notificationTitle.getText().toLowerCase();
+        boolean isMatched = titleText != null && titleText.contains(text.toLowerCase());
+        if (!isMatched) {
+            Log.w(LOG_TAG, String.format("Warning: Heads-up notification title %s does not match the given text %s.", titleText, text));
+        }
+        return isMatched;
+    }
+
+    /**
+     * Check if the heads-up notification is an SMS heads-up notification.
+     * If play button, if mute button is present, then it is SMS HUN.
+     *
+     * @param notification UiObject2 representing the heads-up notification.
+     * @return True if the heads-up notification is an SMS heads-up notification, false otherwise.
+     */
+    private boolean isSmsHun(UiObject2 notification) {
+        UiObject2 playButton = notification.findObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION_PLAY_BUTTON)
+        );
+        UiObject2 muteButton = notification.findObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.HEADSUP_NOTIFICATION_MUTE_BUTTON)
+        );
+        if (playButton != null && muteButton != null) {
+            return true;
+        }
+        Log.i(LOG_TAG, "Warning: heads-up notification is not an SMS heads-up notification.");
+        return false;
+    }
+
+    /**
+     * Run the given task with a default timeout.
+     *
+     * @param task The task to run.
+     * @return The result of the task, or null if the task times out.
+     */
+    private static <T> T runWithTimeout(Callable<T> task) {
+        return runWithTimeout(task, TIMEOUT_SECONDS);
+    }
+
+    /**
+     * Run the given task with the given timeout.
+     *
+     * @param task The task to run.
+     * @param timeoutSeconds The timeout in seconds.
+     * @return The result of the task, or null if the task times out.
+     */
+    private static <T> T runWithTimeout(Callable<T> task, int timeoutSeconds) {
+        ExecutorService executor = Executors.newSingleThreadExecutor();
+        Future<T> future = executor.submit(task);
+        try {
+            return future.get(timeoutSeconds, TimeUnit.SECONDS);
+        } catch (TimeoutException e) {
+            Log.i(LOG_TAG, "Function execution exceeded time limit.");
+            return null;
+        } catch (Exception e) {
+            e.printStackTrace();
+            return null;
+        } finally {
+            future.cancel(true);
+            executor.shutdown();
+        }
+    }
+}
diff --git a/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationHelperImpl.java b/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationHelperImpl.java
index 94a350bdf..df93a8105 100644
--- a/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationHelperImpl.java
+++ b/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationHelperImpl.java
@@ -19,6 +19,7 @@ package android.platform.helpers;
 import android.app.Instrumentation;
 import android.platform.helpers.ScrollUtility.ScrollActions;
 import android.platform.helpers.ScrollUtility.ScrollDirection;
+import android.util.Log;
 
 import androidx.test.uiautomator.By;
 import androidx.test.uiautomator.BySelector;
@@ -33,6 +34,7 @@ import java.util.List;
 public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
         implements IAutoNotificationHelper {
 
+    private static final String LOG_TAG = AutoNotificationHelperImpl.class.getSimpleName();
     private ScrollUtility mScrollUtility;
     private ScrollActions mScrollAction;
     private BySelector mBackwardButtonSelector;
@@ -43,22 +45,21 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
     public AutoNotificationHelperImpl(Instrumentation instr) {
         super(instr);
         mScrollUtility = ScrollUtility.getInstance(getSpectatioUiUtil());
-        mScrollAction =
-                ScrollActions.valueOf(
-                        getActionFromConfig(
-                                AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_ACTION));
-        mBackwardButtonSelector =
-                getUiElementFromConfig(
-                        AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_BACKWARD_BUTTON);
-        mForwardButtonSelector =
-                getUiElementFromConfig(
-                        AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_FORWARD_BUTTON);
-        mScrollableElementSelector =
-                getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_LIST);
-        mScrollDirection =
-                ScrollDirection.valueOf(
-                        getActionFromConfig(
-                                AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_DIRECTION));
+        mScrollAction = ScrollActions.valueOf(
+            getActionFromConfig(AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_ACTION)
+        );
+        mBackwardButtonSelector = getUiElementFromConfig(
+            AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_BACKWARD_BUTTON
+        );
+        mForwardButtonSelector = getUiElementFromConfig(
+            AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_FORWARD_BUTTON
+        );
+        mScrollableElementSelector = getUiElementFromConfig(
+            AutomotiveConfigConstants.NOTIFICATION_LIST
+        );
+        mScrollDirection = ScrollDirection.valueOf(
+            getActionFromConfig(AutomotiveConfigConstants.NOTIFICATION_LIST_SCROLL_DIRECTION)
+        );
     }
 
     /** {@inheritDoc} */
@@ -85,6 +86,7 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
     public void dismissInitialDialogs() {
         // Nothing to dismiss
     }
+
     /**
      * Setup expectation: None.
      *
@@ -93,10 +95,9 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
     @Override
     public void open() {
         if (!isAppInForeground()) {
-            getSpectatioUiUtil()
-                    .executeShellCommand(
-                            getCommandFromConfig(
-                                    AutomotiveConfigConstants.OPEN_NOTIFICATIONS_COMMAND));
+            getSpectatioUiUtil().executeShellCommand(
+                getCommandFromConfig(AutomotiveConfigConstants.OPEN_NOTIFICATIONS_COMMAND)
+            );
             getSpectatioUiUtil().wait1Second();
         }
     }
@@ -108,8 +109,9 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
      */
     @Override
     public boolean isAppInForeground() {
-        BySelector notificationViewSelector =
-                getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_VIEW);
+        BySelector notificationViewSelector = getUiElementFromConfig(
+            AutomotiveConfigConstants.NOTIFICATION_VIEW
+        );
         return getSpectatioUiUtil().hasUiElement(notificationViewSelector);
     }
 
@@ -118,22 +120,20 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
     public void tapClearAllBtn() {
         open();
         getSpectatioUiUtil().wait5Seconds();
-        UiObject2 empty_notification =
-                getSpectatioUiUtil()
-                        .findUiObject(
-                                getUiElementFromConfig(
-                                        AutomotiveConfigConstants.NOTIFICATION_LIST_EMPTY));
-        if (empty_notification == null) {
-            BySelector clearButtonSelector =
-                    getUiElementFromConfig(AutomotiveConfigConstants.CLEAR_ALL_BUTTON);
-            if (checkIfClearAllButtonExist(clearButtonSelector)) {
-                UiObject2 clear_all_btn = getSpectatioUiUtil().findUiObject(clearButtonSelector);
-                getSpectatioUiUtil().clickAndWait(clear_all_btn);
-            } else {
-                throw new RuntimeException("Cannot find Clear All button");
-            }
-        }
 
+        UiObject2 empty_notification = getSpectatioUiUtil().findUiObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_LIST_EMPTY)
+        );
+        if (empty_notification != null)
+            return;
+
+        BySelector clearButtonSelector = getUiElementFromConfig(AutomotiveConfigConstants.CLEAR_ALL_BUTTON);
+        if (checkIfClearAllButtonExist(clearButtonSelector)) {
+            UiObject2 clear_all_btn = getSpectatioUiUtil().findUiObject(clearButtonSelector);
+            getSpectatioUiUtil().clickAndWait(clear_all_btn);
+        } else {
+            throw new RuntimeException("Cannot find Clear All button");
+        }
     }
 
     /** {@inheritDoc} */
@@ -141,20 +141,21 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
     public void clickManageBtn() {
         open();
         getSpectatioUiUtil().wait5Seconds();
-        UiObject2 empty_notification =
-                getSpectatioUiUtil()
-                        .findUiObject(
-                                getUiElementFromConfig(
-                                        AutomotiveConfigConstants.NOTIFICATION_LIST_EMPTY));
-        if (empty_notification == null) {
-            BySelector manageButtonSelector =
-                    getUiElementFromConfig(AutomotiveConfigConstants.MANAGE_BUTTON);
-            if (checkIfManageButtonExist(manageButtonSelector)) {
-                UiObject2 manage_btn = getSpectatioUiUtil().findUiObject(manageButtonSelector);
-                getSpectatioUiUtil().clickAndWait(manage_btn);
-            } else {
-                throw new RuntimeException("Cannot find Manage button");
-            }
+
+        UiObject2 empty_notification = getSpectatioUiUtil().findUiObject(
+            getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_LIST_EMPTY)
+        );
+        if (empty_notification != null)
+            return;
+
+        BySelector manageButtonSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.MANAGE_BUTTON);
+        if (checkIfManageButtonExist(manageButtonSelector)) {
+            UiObject2 manage_btn = getSpectatioUiUtil().findUiObject(manageButtonSelector);
+            getSpectatioUiUtil().clickAndWaitUntilNewWindowAppears(manage_btn);
+            Log.i(LOG_TAG, String.format("Clicked the manage button"));
+        } else {
+            throw new RuntimeException("Cannot find Manage button");
         }
     }
 
@@ -167,6 +168,54 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
         return postedNotification != null;
     }
 
+    /** {@inheritDoc} */
+    @Override
+    public boolean isNotificationDisplayedInCenterWithTitle(String title) {
+        Log.i(
+                LOG_TAG,
+                "Checking if notification with title: "
+                        + title
+                        + " is displayed in the notification center.");
+
+        List<UiObject2> notifications = getNotifications();
+        for (UiObject2 notification : notifications) {
+            UiObject2 titleObj = notification.findObject(
+                getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_TITLE)
+            );
+            String titleText = titleObj.getText().toLowerCase();
+            Log.i("Title: ", "" + titleText);
+            if (titleObj != null && titleText.contains(title.toLowerCase())) {
+                return true;
+            }
+        }
+
+        return false;
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public boolean isNotificationDisplayedInCenterWithContent(String content) {
+        Log.i(
+                LOG_TAG,
+                "Checking if notification with content: "
+                        + content
+                        + " is displayed in the notification center.");
+
+        List<UiObject2> notifications = getNotifications();
+        for (UiObject2 notification : notifications) {
+            UiObject2 contentObj = notification.findObject(
+                getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_CONTENT)
+            );
+            String contentText = contentObj.getText().toLowerCase();
+            Log.i("Content: ", "" + contentText);
+            if (contentObj != null && contentText.contains(content.toLowerCase())) {
+                return true;
+            }
+        }
+
+        return false;
+    }
+
     @Override
     public boolean checkAppPermissionsExists(String title) {
         return getSpectatioUiUtil().hasUiElement(title);
@@ -189,25 +238,14 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
                 .validateUiObject(
                         postedNotification,
                         String.format("Unable to get the posted notification."));
-        getSpectatioUiUtil().swipeLeft(postedNotification);
+        getSpectatioUiUtil().swipeRight(postedNotification);
         getSpectatioUiUtil().wait5Seconds();
     }
 
-    private boolean checkIfClearAllButtonExist(BySelector selector) {
-        open();
-        UiObject2 clr_btn = findInNotificationList(selector);
-        return clr_btn != null;
-    }
-
-    private boolean checkIfManageButtonExist(BySelector selector) {
-        open();
-        UiObject2 manage_btn = findInNotificationList(selector);
-        return manage_btn != null;
-    }
-
     /** {@inheritDoc} */
     @Override
     public boolean isNotificationSettingsOpened() {
+        Log.i(LOG_TAG, String.format("Verifying if the Notification Settings are opened"));
         BySelector notificationLayoutSelector =
                 getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_SETTINGS_LAYOUT);
         List<UiObject2> notificationLayoutList =
@@ -267,27 +305,6 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
         return swipeResult;
     }
 
-    private UiObject2 findInNotificationList(BySelector selector) {
-        UiObject2 notification_list = getSpectatioUiUtil().findUiObject(mScrollableElementSelector);
-        UiObject2 object = null;
-        if (isAppInForeground() && notification_list != null) {
-            object = getSpectatioUiUtil().findUiObject(selector);
-            if (object != null) return object;
-            if (notification_list.isScrollable()) {
-                object =
-                        mScrollUtility.scrollAndFindUiObject(
-                                mScrollAction,
-                                mScrollDirection,
-                                mForwardButtonSelector,
-                                mBackwardButtonSelector,
-                                mScrollableElementSelector,
-                                selector,
-                                String.format("Scroll on notification list to find %s", selector));
-            }
-        }
-        return object;
-    }
-
     @Override
     public boolean isRecentNotification() {
         BySelector recentNotificationsPanel =
@@ -322,4 +339,46 @@ public class AutoNotificationHelperImpl extends AbstractStandardAppHelper
         return testNotificationLayout != null;
     }
 
+    private List<UiObject2> getNotifications() {
+        open();
+        List<UiObject2> notifications = getSpectatioUiUtil().findUiObjects(
+            getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_BODY)
+        );
+        Log.i("Notifications: ", "" + notifications);
+        return notifications;
+    }
+
+    private UiObject2 findInNotificationList(BySelector selector) {
+        UiObject2 notification_list = getSpectatioUiUtil().findUiObject(mScrollableElementSelector);
+        UiObject2 object = null;
+        if (isAppInForeground() && notification_list != null) {
+            object = getSpectatioUiUtil().findUiObject(selector);
+            if (object != null) return object;
+            if (notification_list.isScrollable()) {
+                object =
+                        mScrollUtility.scrollAndFindUiObject(
+                                mScrollAction,
+                                mScrollDirection,
+                                mForwardButtonSelector,
+                                mBackwardButtonSelector,
+                                mScrollableElementSelector,
+                                selector,
+                                String.format("Scroll on notification list to find %s", selector));
+            }
+        }
+        return object;
+    }
+
+    private boolean checkIfClearAllButtonExist(BySelector selector) {
+        open();
+        UiObject2 clr_btn = findInNotificationList(selector);
+        return clr_btn != null;
+    }
+
+    private boolean checkIfManageButtonExist(BySelector selector) {
+        open();
+        UiObject2 manage_btn = findInNotificationList(selector);
+        return manage_btn != null;
+    }
+
 }
diff --git a/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationMockingHelperImpl.java b/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationMockingHelperImpl.java
index 04a6341a9..f5c01cc0f 100644
--- a/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationMockingHelperImpl.java
+++ b/libraries/automotive-helpers/notifications-app-helper/src/android/platform/helpers/AutoNotificationMockingHelperImpl.java
@@ -74,7 +74,7 @@ public class AutoNotificationMockingHelperImpl extends AbstractStandardAppHelper
         NOTIFICATION_REQUIRED_FIELDS.add(
                 getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_TITLE));
         NOTIFICATION_REQUIRED_FIELDS.add(
-                getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_BODY));
+                getUiElementFromConfig(AutomotiveConfigConstants.NOTIFICATION_CONTENT));
 
         mScrollUtility = ScrollUtility.getInstance(getSpectatioUiUtil());
         mScrollAction =
diff --git a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingHelperImpl.java b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingHelperImpl.java
index 32e3bd959..e24ffc3ea 100644
--- a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingHelperImpl.java
+++ b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingHelperImpl.java
@@ -31,6 +31,7 @@ import androidx.test.uiautomator.By;
 import androidx.test.uiautomator.BySelector;
 import androidx.test.uiautomator.UiObject2;
 
+import java.util.ArrayList;
 import java.util.List;
 import java.util.Locale;
 import java.util.regex.Pattern;
@@ -42,6 +43,9 @@ public class SettingHelperImpl extends AbstractStandardAppHelper implements IAut
     private static final String SCREEN_BRIGHTNESS = "screen_brightness";
 
     private ScrollUtility mScrollUtility;
+
+    private HelperAccessor<IAutoUISettingsHelper> mSettingUIHelper =
+            new HelperAccessor<>(IAutoUISettingsHelper.class);
     private ScrollActions mScrollAction;
     private BySelector mBackwardButtonSelector;
     private BySelector mForwardButtonSelector;
@@ -320,6 +324,19 @@ public class SettingHelperImpl extends AbstractStandardAppHelper implements IAut
         throw new RuntimeException("Unable to find page title");
     }
 
+    @Override
+    public String getSettingsPageTitleText() {
+        getSpectatioUiUtil().wait5Seconds();
+        BySelector selector = getUiElementFromConfig(AutomotiveConfigConstants.PAGE_TITLE);
+        List<UiObject2> pageTitles = getSpectatioUiUtil().findUiObjects(selector);
+        List<String> pageTitlesText = new ArrayList<String>();
+        for (UiObject2 pageTitle : pageTitles) {
+            pageTitlesText.add(pageTitle.getText());
+        }
+        pageTitlesText.remove("Settings");
+        return pageTitlesText.get(0);
+    }
+
     /** {@inheritDoc} */
     @Override
     public void goBackToSettingsScreen() {
@@ -337,7 +354,9 @@ public class SettingHelperImpl extends AbstractStandardAppHelper implements IAut
         }
     }
 
-    private void pressSettingsBackNavIcon() {
+    /** {@inheritDoc} */
+    @Override
+    public void pressSettingsBackNavIcon() {
         UiObject2 navIcon =
                 getSpectatioUiUtil()
                         .findUiObject(
@@ -420,6 +439,12 @@ public class SettingHelperImpl extends AbstractStandardAppHelper implements IAut
         return getSpectatioUiUtil().hasUiElement(setting);
     }
 
+    /** {@inheritDoc} */
+    @Override
+    public boolean scrollAndCheckMenuExists(String setting) {
+        return mSettingUIHelper.get().hasUIElement(setting);
+    }
+
     /**
      * TODO - Keeping the below empty functions for now, to avoid the compilation error in Vendor it
      * will be removed after vendor clean up (b/266450258)
diff --git a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingUserHelperImpl.java b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingUserHelperImpl.java
index 91991745a..ddbdde445 100644
--- a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingUserHelperImpl.java
+++ b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingUserHelperImpl.java
@@ -208,6 +208,18 @@ public class SettingUserHelperImpl extends AbstractStandardAppHelper implements
         return profileNameText;
     }
 
+    @Override
+    public void editUserName(String name) {
+        clickbutton(AutomotiveConfigConstants.USER_SETTINGS_RENAME);
+        BySelector profileNameEditSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.USER_SETTINGS_PROFILE_NAME_EDIT);
+        UiObject2 profileNameEdit = getSpectatioUiUtil().findUiObject(profileNameEditSelector);
+        profileNameEdit.setText(name);
+        getSpectatioUiUtil().wait1Second();
+        clickbutton(AutomotiveConfigConstants.USER_SETTINGS_OK);
+        getSpectatioUiUtil().wait1Second();
+    }
+
     // add User via quick settings
     @Override
     public void addUserQuickSettings(String userFrom) {
diff --git a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsBluetoothHelperImpl.java b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsBluetoothHelperImpl.java
index 456521b89..3ff50d277 100644
--- a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsBluetoothHelperImpl.java
+++ b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsBluetoothHelperImpl.java
@@ -29,6 +29,7 @@ public class SettingsBluetoothHelperImpl extends AbstractStandardAppHelper
         implements IAutoBluetoothSettingsHelper {
 
     private static final String LOG_TAG = SettingHelperImpl.class.getSimpleName();
+    private static final int WAIT_TIME_MAX = 15;
 
     private final ScrollUtility mScrollUtility;
     private final SeekUtility mSeekUtility;
@@ -157,21 +158,29 @@ public class SettingsBluetoothHelperImpl extends AbstractStandardAppHelper
     /** {@inheritDoc} */
     @Override
     public void pressDevice(String deviceName) {
-
         BySelector nameField = By.text(deviceName);
         BySelector clickable = By.hasDescendant(By.hasDescendant(nameField));
         UiObject2 clickableDevice = getSpectatioUiUtil().findUiObject(clickable);
+        getSpectatioUiUtil().waitForUiObject(clickable, WAIT_TIME_MAX);
         getSpectatioUiUtil()
                 .validateUiObject(clickableDevice, "Viewgroup ancestor of  " + deviceName);
         getSpectatioUiUtil().clickAndWait(clickableDevice);
     }
 
+    /** {@inheritDoc} */
+    @Override
+    public void waitUntilConnectionStatus(String status) {
+        BySelector statusSelector = By.text(status);
+        getSpectatioUiUtil().waitForUiObject(statusSelector);
+    }
+
     /** {@inheritDoc} */
     @Override
     public String getDeviceSummary() {
 
         BySelector statusSelector =
                 getUiElementFromConfig(AutomotiveConfigConstants.DEVICE_HEADER_SUMMARY);
+        getSpectatioUiUtil().waitForUiObject(statusSelector);
         UiObject2 statusField = getSpectatioUiUtil().findUiObject(statusSelector);
         getSpectatioUiUtil()
                 .validateUiObject(statusField, AutomotiveConfigConstants.DEVICE_HEADER_SUMMARY);
@@ -220,6 +229,17 @@ public class SettingsBluetoothHelperImpl extends AbstractStandardAppHelper
         getSpectatioUiUtil().clickAndWait(connectionButton);
     }
 
+    /** {@inheritDoc} */
+    @Override
+    public boolean isPhoneProfileEnabled() {
+        BySelector phoneToogleSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.TOGGLE_PHONE);
+        UiObject2 phoneToogleSwitch = getSpectatioUiUtil().findUiObject(phoneToogleSelector);
+        getSpectatioUiUtil()
+                .validateUiObject(phoneToogleSwitch, AutomotiveConfigConstants.TOGGLE_PHONE);
+        return phoneToogleSwitch.isChecked();
+    }
+
     /** {@inheritDoc} */
     @Override
     public String getPackage() {
diff --git a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsLocationHelperImpl.java b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsLocationHelperImpl.java
index 7214d48e4..64e64660f 100644
--- a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsLocationHelperImpl.java
+++ b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsLocationHelperImpl.java
@@ -101,4 +101,34 @@ public class SettingsLocationHelperImpl extends AbstractStandardAppHelper
         return (getSpectatioUiUtil().hasUiElement(mapsWidgetSelector));
     }
 
+    /** {@inheritDoc} */
+    @Override
+    public void openAppLevelPermissions() {
+        BySelector appPermissionsSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.APP_LEVEL_PERMISSION);
+        UiObject2 appLevelPermissions = getSpectatioUiUtil().findUiObject(appPermissionsSelector);
+        getSpectatioUiUtil().clickAndWait(appLevelPermissions);
+        getSpectatioUiUtil().wait5Seconds();
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void openMapsInRecentlyAccessed() {
+        BySelector mapsSelector =
+                getUiElementFromConfig(
+                        AutomotiveConfigConstants.LOCATION_SETTINGS_RECENTLY_ACCESSED_MAPS);
+        UiObject2 maps = getSpectatioUiUtil().findUiObject(mapsSelector);
+        getSpectatioUiUtil().clickAndWait(maps);
+        getSpectatioUiUtil().wait5Seconds();
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void clickViewAll() {
+        BySelector viewAllSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.LOCATION_SETTINGS_VIEW_ALL);
+        UiObject2 viewAll = getSpectatioUiUtil().findUiObject(viewAllSelector);
+        getSpectatioUiUtil().clickAndWait(viewAll);
+        getSpectatioUiUtil().wait5Seconds();
+    }
 }
diff --git a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsPrivacyHelperImpl.java b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsPrivacyHelperImpl.java
index 56ad1efe3..c2fd4077e 100644
--- a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsPrivacyHelperImpl.java
+++ b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsPrivacyHelperImpl.java
@@ -373,4 +373,36 @@ public class SettingsPrivacyHelperImpl extends AbstractStandardAppHelper
         getSpectatioUiUtil().clickAndWait(continueButton);
         getSpectatioUiUtil().waitForIdle();
     }
+
+    /** {@inheritDoc} */
+    @Override
+    public void clickOnLocationInPrivacySettings() {
+        UiObject2 subSettingsObject =
+                getSpectatioUiUtil()
+                        .findUiObject(
+                                getUiElementFromConfig(
+                                        AutomotiveConfigConstants
+                                                .SETTINGS_SUB_SETTING_SCROLL_ELEMENT));
+        UiObject2 locationObject =
+                getSpectatioUiUtil()
+                        .findUiObjectInGivenElement(
+                                subSettingsObject,
+                                getUiElementFromConfig(AutomotiveConfigConstants.PRIVACY_LOCATION));
+        getSpectatioUiUtil()
+                .validateUiObject(locationObject, AutomotiveConfigConstants.PRIVACY_LOCATION);
+        getSpectatioUiUtil().clickAndWait(locationObject);
+        getSpectatioUiUtil().waitForIdle();
+    }
+
+    /** {@inheritDoc} */
+    @Override
+    public void clickMicroPhoneOnScreen() {
+        UiObject2 homeMic =
+                getSpectatioUiUtil()
+                        .findUiObject(
+                                getUiElementFromConfig(
+                                        AutomotiveConfigConstants.MICRO_PHONE_ON_SCREEN));
+        getSpectatioUiUtil().clickAndWait(homeMic);
+        getSpectatioUiUtil().waitForIdle();
+    }
 }
diff --git a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsSecurityHelperImpl.java b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsSecurityHelperImpl.java
index c26067788..74075c5d0 100644
--- a/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsSecurityHelperImpl.java
+++ b/libraries/automotive-helpers/settings-app-helper/src/android/platform/helpers/SettingsSecurityHelperImpl.java
@@ -32,6 +32,7 @@ public class SettingsSecurityHelperImpl extends AbstractStandardAppHelper
 
     private static final String CHOOSE_LOCK_TYPE = "Choose a lock type";
     private static final int KEY_ENTER = 66;
+    private static final int DEFAULT_WAIT_TIME = 5000;
     private ScrollUtility mScrollUtility;
     private ScrollActions mScrollAction;
     private BySelector mBackwardButtonSelector;
@@ -89,6 +90,9 @@ public class SettingsSecurityHelperImpl extends AbstractStandardAppHelper
         pressEnter();
         typePasswordOnTextEditor(password);
         pressEnter();
+        BySelector profileLockSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.SECURITY_SETTINGS_PROFILE_LOCK);
+        getSpectatioUiUtil().waitForUiObject(profileLockSelector, DEFAULT_WAIT_TIME);
     }
 
     private void openChooseLockTypeMenu() {
@@ -120,7 +124,7 @@ public class SettingsSecurityHelperImpl extends AbstractStandardAppHelper
         getSpectatioUiUtil()
                 .validateUiObject(
                         textEditor, AutomotiveConfigConstants.SECURITY_SETTINGS_ENTER_PASSWORD);
-        textEditor.setText(password);
+        getSpectatioUiUtil().setTextForUiElement(textEditor, password);
     }
 
     /** {@inheritDoc} */
@@ -146,13 +150,7 @@ public class SettingsSecurityHelperImpl extends AbstractStandardAppHelper
         getSpectatioUiUtil().clickAndWait(continue_button);
         getSpectatioUiUtil().wait5Seconds();
         selectPinOnPinPad(pin);
-        BySelector confirm_buttonSelector =
-                getUiElementFromConfig(AutomotiveConfigConstants.SECURITY_SETTINGS_CONFIRM_BUTTON);
-        UiObject2 confirm_button = getSpectatioUiUtil().findUiObject(confirm_buttonSelector);
-        getSpectatioUiUtil()
-                .validateUiObject(
-                        confirm_button, AutomotiveConfigConstants.SECURITY_SETTINGS_CONFIRM_BUTTON);
-        getSpectatioUiUtil().clickAndWait(confirm_button);
+        clickOnConfirmButton();
         getSpectatioUiUtil().wait5Seconds();
     }
 
@@ -248,4 +246,14 @@ public class SettingsSecurityHelperImpl extends AbstractStandardAppHelper
     protected void pressEnter() {
         getSpectatioUiUtil().pressKeyCode(KEY_ENTER);
     }
+
+    private void clickOnConfirmButton() {
+        BySelector confirm_buttonSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.SECURITY_SETTINGS_CONFIRM_BUTTON);
+        UiObject2 confirm_button = getSpectatioUiUtil().findUiObject(confirm_buttonSelector);
+        getSpectatioUiUtil()
+                .validateUiObject(
+                        confirm_button, AutomotiveConfigConstants.SECURITY_SETTINGS_CONFIRM_BUTTON);
+        getSpectatioUiUtil().clickAndWait(confirm_button);
+    }
 }
diff --git a/libraries/automotive-helpers/status-bar-helper/src/android/platform/helpers/StatusBarHelperImpl.java b/libraries/automotive-helpers/status-bar-helper/src/android/platform/helpers/StatusBarHelperImpl.java
index 77f48c52e..7aaca83d4 100644
--- a/libraries/automotive-helpers/status-bar-helper/src/android/platform/helpers/StatusBarHelperImpl.java
+++ b/libraries/automotive-helpers/status-bar-helper/src/android/platform/helpers/StatusBarHelperImpl.java
@@ -452,6 +452,7 @@ public class StatusBarHelperImpl extends AbstractStandardAppHelper implements IA
                                 getCommandFromConfig(AutomotiveConfigConstants.DAY_MODE_COMMAND));
 
         boolean result = dayModeResult.contains("changed to: day");
+        getSpectatioUiUtil().wait5Seconds();
         return result;
     }
 
@@ -463,6 +464,7 @@ public class StatusBarHelperImpl extends AbstractStandardAppHelper implements IA
                         .executeShellCommand(
                                 getCommandFromConfig(AutomotiveConfigConstants.NIGHT_MODE_COMMAND));
         boolean result = nightModeResult.contains("changed to: night");
+        getSpectatioUiUtil().wait5Seconds();
         return result;
     }
 
@@ -531,4 +533,32 @@ public class StatusBarHelperImpl extends AbstractStandardAppHelper implements IA
                         AutomotiveConfigConstants.SOUND_PALETTE_SOUND_SETTINGS_PAGE_TITLE);
         return (getSpectatioUiUtil().hasUiElement(soundSettingsPageTitleSelector));
     }
+
+    /** {@inheritDoc} */
+    @Override
+    public void clickOnAdaptiveBrightnessToggleSwitch() {
+        BySelector adaptiveBrightnessSelector =
+                getUiElementFromConfig(AutomotiveConfigConstants.ADAPTIVE_BRIGHTNESS_TOGGLE_SWITCH);
+        UiObject2 adaptiveBrightnessToggleObject =
+                getSpectatioUiUtil().findUiObject(adaptiveBrightnessSelector);
+        getSpectatioUiUtil()
+                .validateUiObject(
+                        adaptiveBrightnessToggleObject,
+                        AutomotiveConfigConstants.ADAPTIVE_BRIGHTNESS_TOGGLE_SWITCH);
+        getSpectatioUiUtil().clickAndWait(adaptiveBrightnessToggleObject);
+    }
+
+    /**
+     * {@inheritDoc}
+     */
+    @Override
+    public boolean isAdaptiveBrightnessOn() {
+        String value =
+                getSpectatioUiUtil()
+                        .executeShellCommand(
+                                getCommandFromConfig(
+                                        AutomotiveConfigConstants.ADAPTIVE_BRIGHTNESS_COMMAND));
+        boolean isAdaptiveBrightnessOn = Integer.parseInt(value.replaceAll("\\s", "")) == 1;
+        return isAdaptiveBrightnessOn;
+    }
 }
diff --git a/libraries/collectors-helper/memory/test/src/com/android/helpers/tests/GarbageCollectionHelperTest.java b/libraries/collectors-helper/memory/test/src/com/android/helpers/tests/GarbageCollectionHelperTest.java
index 91665a1af..445add283 100644
--- a/libraries/collectors-helper/memory/test/src/com/android/helpers/tests/GarbageCollectionHelperTest.java
+++ b/libraries/collectors-helper/memory/test/src/com/android/helpers/tests/GarbageCollectionHelperTest.java
@@ -18,7 +18,7 @@ package com.android.helpers.tests;
 import static org.mockito.ArgumentMatchers.any;
 import static org.mockito.Mockito.doAnswer;
 import static org.mockito.Mockito.inOrder;
-import static org.mockito.Mockito.verifyZeroInteractions;
+import static org.mockito.Mockito.verifyNoMoreInteractions;
 
 import androidx.test.uiautomator.UiDevice;
 
@@ -68,7 +68,7 @@ public final class GarbageCollectionHelperTest {
     public void testNoSetUp() throws Throwable {
         mHelper.garbageCollect(TEST_POST_GC_WAIT_TIME_MS);
 
-        verifyZeroInteractions(mUiDevice);
+        verifyNoMoreInteractions(mUiDevice);
     }
 
     /**
diff --git a/libraries/collectors-helper/perfetto/src/com/android/helpers/PerfettoHelper.java b/libraries/collectors-helper/perfetto/src/com/android/helpers/PerfettoHelper.java
index 90ca854e1..60012c7d1 100644
--- a/libraries/collectors-helper/perfetto/src/com/android/helpers/PerfettoHelper.java
+++ b/libraries/collectors-helper/perfetto/src/com/android/helpers/PerfettoHelper.java
@@ -18,13 +18,11 @@ package com.android.helpers;
 
 import android.app.UiAutomation;
 import android.os.ParcelFileDescriptor;
-import android.os.ParcelFileDescriptor.AutoCloseInputStream;
-import android.os.ParcelFileDescriptor.AutoCloseOutputStream;
 import android.os.SystemClock;
 import android.util.Log;
 
 import androidx.annotation.VisibleForTesting;
-import androidx.test.platform.app.InstrumentationRegistry;
+import androidx.test.InstrumentationRegistry;
 import androidx.test.uiautomator.UiDevice;
 
 import java.io.File;
@@ -34,7 +32,6 @@ import java.io.PrintWriter;
 import java.nio.file.Path;
 import java.nio.file.Paths;
 import java.util.HashSet;
-import java.util.Locale;
 import java.util.Set;
 
 /**
@@ -52,8 +49,6 @@ public class PerfettoHelper {
     private static final String PERFETTO_START_BG_WAIT_CMD =
             "perfetto --background-wait -c %s%s -o %s";
     private static final String PERFETTO_START_CMD = "perfetto --background -c %s%s -o %s";
-    private static final String PERFETTO_TMP_OUTPUT_FILE =
-            "/data/misc/perfetto-traces/trace_output.perfetto-trace";
     // Additional arg to indicate that the perfetto config file is text format.
     private static final String PERFETTO_TXT_PROTO_ARG = " --txt";
     // Command to stop (i.e kill) the perfetto tracing.
@@ -64,8 +59,10 @@ public class PerfettoHelper {
     private static final String REMOVE_CMD = "rm %s";
     // Add the trace output file /data/misc/perfetto-traces/trace_output.perfetto-trace
     private static final String CREATE_FILE_CMD = "touch %s";
-    // Command to move the perfetto output trace file to given folder.
-    private static final String MOVE_CMD = "mv %s %s";
+    // Command to copy the perfetto output trace file to given folder.
+    private static final String COPY_CMD = "cp %s %s";
+    // Command to set the read permission for all users on the given file.
+    private static final String CHMOD_READ_CMD = "chmod a+r %s";
     // Max wait count for checking if perfetto is stopped successfully
     private static final int PERFETTO_KILL_WAIT_COUNT = 12;
     // Check if perfetto is stopped every 5 secs.
@@ -88,7 +85,22 @@ public class PerfettoHelper {
     private boolean mTrackPerfettoPidFlag;
     private String mTrackPerfettoRootDir = "sdcard/";
     private File mPerfettoPidFile;
-    private boolean mShouldUseContentProvider;
+
+    private String mTmpOutputFilePath = "";
+
+    public PerfettoHelper() {
+        this("");
+    }
+
+    /**
+     * Creates PerfettoHelper
+     * @param tmpFilePrefix prefix for the temporary perfetto trace, must be unique for all
+     *                      sessions happening at the same time
+     */
+    public PerfettoHelper(String tmpFilePrefix) {
+        mTmpOutputFilePath = "/data/misc/perfetto-traces/" + tmpFilePrefix
+                + "trace_output.perfetto-trace";
+    }
 
     /** Set content of the perfetto configuration to be used when tracing */
     public PerfettoHelper setTextProtoConfig(String value) {
@@ -158,7 +170,7 @@ public class PerfettoHelper {
                             mPerfettoStartBgWait ? PERFETTO_START_BG_WAIT_CMD : PERFETTO_START_CMD,
                             "- ",
                             "--txt",
-                            PERFETTO_TMP_OUTPUT_FILE);
+                            mTmpOutputFilePath);
 
             // Start perfetto tracing.
             Log.i(LOG_TAG, "Starting perfetto tracing.");
@@ -236,7 +248,7 @@ public class PerfettoHelper {
                             mPerfettoStartBgWait ? PERFETTO_START_BG_WAIT_CMD : PERFETTO_START_CMD,
                             mConfigRootDir,
                             configFileName,
-                            PERFETTO_TMP_OUTPUT_FILE);
+                            mTmpOutputFilePath);
 
             if (isTextProtoConfig) {
                 perfettoCmd = perfettoCmd + PERFETTO_TXT_PROTO_ARG;
@@ -275,13 +287,13 @@ public class PerfettoHelper {
     private boolean canSetupBeforeStartCollecting() throws IOException {
         // Remove already existing temporary output trace file if any.
         String output =
-                mUIDevice.executeShellCommand(String.format(REMOVE_CMD, PERFETTO_TMP_OUTPUT_FILE));
+                mUIDevice.executeShellCommand(String.format(REMOVE_CMD, mTmpOutputFilePath));
         Log.i(LOG_TAG, String.format("Perfetto output file cleanup - %s", output));
 
         // Create new temporary output trace file before tracing.
         output =
                 mUIDevice.executeShellCommand(
-                        String.format(CREATE_FILE_CMD, PERFETTO_TMP_OUTPUT_FILE));
+                        String.format(CREATE_FILE_CMD, mTmpOutputFilePath));
         if (output.isEmpty()) {
             Log.i(LOG_TAG, "Perfetto output file create success.");
         } else {
@@ -467,11 +479,6 @@ public class PerfettoHelper {
         return false;
     }
 
-    private int getCurrentUserId() throws IOException {
-        String userId = mUIDevice.executeShellCommand("am get-current-user");
-        return Integer.parseInt(userId.trim());
-    }
-
     /**
      * Copy the temporary perfetto trace output file from /data/misc/perfetto-traces/ to given
      * destinationFile.
@@ -480,100 +487,59 @@ public class PerfettoHelper {
      * @return true if the trace file copied successfully otherwise false.
      */
     private boolean copyFileOutput(String destinationFile) {
+        // Create the destination directory if it doesn't already exist.
         Path path = Paths.get(destinationFile);
         String destDirectory = path.getParent().toString();
-        // Check if the directory already exists
-        File directory = new File(destDirectory);
-        if (!directory.exists()) {
-            boolean success = directory.mkdirs();
-            if (!success) {
-                Log.e(LOG_TAG, String.format(
-                        "Result output directory %s not created successfully.", destDirectory));
-                return false;
-            }
+        try {
+            mUIDevice.executeShellCommand(String.format("mkdir -p %s", destDirectory));
+        } catch (IOException ioe) {
+            Log.e(
+                    LOG_TAG,
+                    String.format("Failed to create destination directory %s", destDirectory),
+                    ioe);
+            return false;
         }
 
         // Copy the collected trace from /data/misc/perfetto-traces/trace_output.perfetto-trace to
-        // destinationFile.
+        // destinationFile
+        // Note: Due to b/141386109, certain devices do not allow moving the files between
+        //       directories with different encryption policies, so manually copy and then
+        //       remove the original file
+        //       Moreover, the copied trace file may end up with different permissions, resulting
+        //       in b/162072200, to prevent this, ensure the files are readable after copying
         try {
-            int userId = getCurrentUserId();
-            // For user 0, move the file directly since the content provider is not installed (see
-            // aosp/3284729).
-            boolean useContentProvider = userId != 0 && mShouldUseContentProvider;
-            Log.v(
-                    LOG_TAG,
-                    String.format(
-                            "Going to use content provider to move temp perfetto file: %b. User id:"
-                                + " %d and mShouldUseContentProvider: %b",
-                            useContentProvider, userId, mShouldUseContentProvider));
-            if (!useContentProvider) {
-                String moveResult =
-                        mUIDevice.executeShellCommand(
-                                String.format(MOVE_CMD, PERFETTO_TMP_OUTPUT_FILE, destinationFile));
-                if (!moveResult.isEmpty()) {
-                    Log.e(
-                            LOG_TAG,
-                            String.format(
-                                    "Unable to move perfetto output file from %s to %s due to %s",
-                                    PERFETTO_TMP_OUTPUT_FILE, destinationFile, moveResult));
-                    return false;
-                }
-                return true;
+            String copyResult = mUIDevice.executeShellCommand(String.format(
+                    COPY_CMD, mTmpOutputFilePath, destinationFile));
+            if (!copyResult.isEmpty()) {
+                Log.e(LOG_TAG, String.format(
+                        "Unable to copy perfetto output file from %s to %s due to %s",
+                        mTmpOutputFilePath, destinationFile, copyResult));
+                return false;
             }
-
-            // For users other than 0, use the tradefed content provider.
-            UiAutomation uiAutomation =
-                    InstrumentationRegistry.getInstrumentation().getUiAutomation();
-
-            // cat the trace file. This is necessary because the test app doesn't have access to
-            // /data/misc/perfetto-traces.
-            String cmd = String.format("cat %s", PERFETTO_TMP_OUTPUT_FILE);
-            ParcelFileDescriptor fdCatStdout = uiAutomation.executeShellCommand(cmd);
-
-            // Use 'content write' to write the trace to the destination file.
-            String uri =
-                    String.format("content://android.tradefed.contentprovider/%s", destinationFile);
-            cmd = String.format(Locale.US, "content write --user %d --uri %s", userId, uri);
-            Log.i(LOG_TAG, String.format("Executing: %s", cmd));
-            ParcelFileDescriptor[] fds = uiAutomation.executeShellCommandRwe(cmd);
-            ParcelFileDescriptor fdStdout = fds[0];
-            ParcelFileDescriptor fdStdin = fds[1];
-            ParcelFileDescriptor fdStderr = fds[2];
-
-            // Transfer stdout of 'cat' to stdin of 'content write'.
-            try (AutoCloseOutputStream contentOutputStream = new AutoCloseOutputStream(fdStdin);
-                    AutoCloseInputStream catInputStream = new AutoCloseInputStream(fdCatStdout)) {
-                catInputStream.transferTo(contentOutputStream);
+            String chmodResult = mUIDevice.executeShellCommand(String.format(
+                    CHMOD_READ_CMD, destinationFile));
+            if (!chmodResult.isEmpty()) {
+                Log.e(LOG_TAG, String.format(
+                        "Unable to set read permission on perfetto output file %s due to %s",
+                        destinationFile, chmodResult));
+                return false;
             }
-
-            // Check stdout and stderr of 'content write'.
-            try (AutoCloseInputStream stdoutInputStream = new AutoCloseInputStream(fdStdout);
-                    AutoCloseInputStream stderrInputStream = new AutoCloseInputStream(fdStderr)) {
-                String stdout = new String(stdoutInputStream.readAllBytes());
-                String stderr = new String(stderrInputStream.readAllBytes());
-                if (!stdout.isEmpty() || !stderr.isEmpty()) {
-                    Log.e(
-                            LOG_TAG,
-                            String.format(
-                                    "'content write' failed:\nstdout: %s\nstderr: %s",
-                                    stdout, stderr));
-                    return false;
-                }
+            // This will silently fail on unrooted devices due to missing sepolicy for file writing,
+            // but it will be cleaned up by perfetto on the next run.
+            String removeResult = mUIDevice.executeShellCommand(String.format(
+                    REMOVE_CMD, mTmpOutputFilePath));
+            if (!removeResult.isEmpty()) {
+                Log.e(LOG_TAG, String.format(
+                        "Unable to remove temporary perfetto output file %s due to %s",
+                        mTmpOutputFilePath, removeResult));
+                return false;
             }
-
-            // Delete the trace file from the temporary location.
-            mUIDevice.executeShellCommand(String.format(REMOVE_CMD, PERFETTO_TMP_OUTPUT_FILE));
-
         } catch (IOException ioe) {
-            Log.e(
-                    LOG_TAG,
-                    String.format(
-                            "Unable to move the perfetto trace file from %s to %s",
-                            PERFETTO_TMP_OUTPUT_FILE, destinationFile),
-                    ioe);
+            Log.e(LOG_TAG,
+                    "Unable to copy the perfetto trace file to destination file."
+                            + ioe.getMessage());
             return false;
         }
-
         return true;
     }
 
@@ -616,8 +582,4 @@ public class PerfettoHelper {
     public String getPerfettoFilePrefix() {
         return PERFETTO_PID_FILE_PREFIX;
     }
-
-    public void setShouldUseContentProvider(boolean shouldUseContentProvider) {
-        mShouldUseContentProvider = shouldUseContentProvider;
-    }
 }
diff --git a/libraries/compatibility-common-util/src/com/android/compatibility/common/util/GmsTest.java b/libraries/compatibility-common-util/src/com/android/compatibility/common/util/GmsTest.java
index 003200003..63bebcea5 100644
--- a/libraries/compatibility-common-util/src/com/android/compatibility/common/util/GmsTest.java
+++ b/libraries/compatibility-common-util/src/com/android/compatibility/common/util/GmsTest.java
@@ -25,5 +25,11 @@ import java.lang.annotation.Target;
 @Retention(RetentionPolicy.RUNTIME)
 @Target({ElementType.METHOD, ElementType.TYPE})
 public @interface GmsTest {
-    String requirement();
+    /**
+     * @deprecated Use {@link #requirements()} instead.
+     */
+    @Deprecated
+    String requirement() default "";
+
+    String[] requirements() default {""};
 }
diff --git a/libraries/compatibility-common-util/src/com/android/compatibility/common/util/VersionCodes.java b/libraries/compatibility-common-util/src/com/android/compatibility/common/util/VersionCodes.java
index f75e377fc..097835135 100644
--- a/libraries/compatibility-common-util/src/com/android/compatibility/common/util/VersionCodes.java
+++ b/libraries/compatibility-common-util/src/com/android/compatibility/common/util/VersionCodes.java
@@ -53,4 +53,5 @@ public class VersionCodes {
     public static final int TIRAMISU = 33;
     public static final int UPSIDE_DOWN_CAKE = 34;
     public static final int VANILLA_ICE_CREAM = 35;
+    public static final int BAKLAVA = 36;
 }
diff --git a/libraries/desktop-test-lib/Android.bp b/libraries/desktop-test-lib/Android.bp
new file mode 100644
index 000000000..6737d7567
--- /dev/null
+++ b/libraries/desktop-test-lib/Android.bp
@@ -0,0 +1,32 @@
+//
+// Copyright (C) 2025 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+//
+
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+java_library {
+    name: "desktop-test-lib",
+    libs: [
+        "androidx.test.runner",
+        "androidx.test.rules",
+        "kotlin-stdlib",
+        "kotlinx_coroutines",
+    ],
+    srcs: [
+        "src/**/*.kt",
+    ],
+}
diff --git a/libraries/desktop-test-lib/OWNERS b/libraries/desktop-test-lib/OWNERS
new file mode 100644
index 000000000..5ece0475d
--- /dev/null
+++ b/libraries/desktop-test-lib/OWNERS
@@ -0,0 +1,3 @@
+nicomazz@google.com
+olb@google.com
+pbdr@google.com
diff --git a/libraries/desktop-test-lib/src/platform/android/test/desktop/SimulatedConnectedDisplayTestRule.kt b/libraries/desktop-test-lib/src/platform/android/test/desktop/SimulatedConnectedDisplayTestRule.kt
new file mode 100644
index 000000000..6ef049741
--- /dev/null
+++ b/libraries/desktop-test-lib/src/platform/android/test/desktop/SimulatedConnectedDisplayTestRule.kt
@@ -0,0 +1,172 @@
+/*
+ * Copyright 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package platform.test.desktop
+
+import android.graphics.Point
+import android.hardware.display.DisplayManager
+import android.hardware.display.DisplayManager.DisplayListener
+import android.os.Handler
+import android.os.Looper
+import android.provider.Settings
+import android.util.Log
+import androidx.test.platform.app.InstrumentationRegistry
+import kotlin.time.Duration.Companion.seconds
+import kotlinx.coroutines.channels.awaitClose
+import kotlinx.coroutines.flow.Flow
+import kotlinx.coroutines.flow.callbackFlow
+import kotlinx.coroutines.flow.take
+import kotlinx.coroutines.runBlocking
+import kotlinx.coroutines.withTimeoutOrNull
+import org.junit.rules.TestRule
+import org.junit.runner.Description
+import org.junit.runners.model.Statement
+
+/**
+ * A TestRule to manage multiple simulated connected overlay displays.
+ */
+class SimulatedConnectedDisplayTestRule : TestRule {
+
+    private val context = InstrumentationRegistry.getInstrumentation().targetContext
+    private val displayManager = context.getSystemService(DisplayManager::class.java)
+    private val addedDisplays = mutableListOf<Int>()
+
+    override fun apply(base: Statement, description: Description): Statement =
+        object : Statement() {
+            override fun evaluate() {
+                try {
+                    base.evaluate()
+                } finally {
+                    teardown()
+                }
+            }
+        }
+
+    private fun teardown() {
+        cleanupTestDisplays()
+    }
+
+    /**
+     * Adds multiple overlay displays with specified dimensions. Any existing overlay displays
+     * will be removed before adding the new ones.
+     *
+     * @param displays A list of [Point] objects, where each [Point] represents the
+     *                 width and height of a simulated display.
+     * @return List of displayIds of added displays.
+     */
+    fun setupTestDisplays(displays: List<Point>): List<Int> = runBlocking {
+        // Cleanup any existing overlay displays.
+        cleanupTestDisplays()
+
+        if (displays.isEmpty()) {
+            Log.w(TAG, "setupTestDisplays called with an empty list. No displays created.")
+            return@runBlocking emptyList()
+        }
+
+        val displayAddedFlow: Flow<Int> = callbackFlow {
+            val listener = object : DisplayListener {
+                override fun onDisplayAdded(displayId: Int) {
+                    trySend(displayId)
+                }
+
+                override fun onDisplayRemoved(displayId: Int) {}
+                override fun onDisplayChanged(displayId: Int) {}
+            }
+
+            val handler = Handler(Looper.getMainLooper())
+            displayManager.registerDisplayListener(listener, handler)
+
+            awaitClose {
+                displayManager.unregisterDisplayListener(listener)
+            }
+        }
+
+        val displaySettings = displays.joinToString(separator = ";") { size ->
+            "${size.x}x${size.y}/$DEFAULT_DENSITY"
+        }
+
+        // Add the overlay displays
+        Settings.Global.putString(
+            InstrumentationRegistry.getInstrumentation().context.contentResolver,
+            Settings.Global.OVERLAY_DISPLAY_DEVICES,
+            displaySettings
+        )
+        withTimeoutOrNull(TIMEOUT) {
+            displayAddedFlow.take(displays.size).collect { displayId ->
+                addedDisplays.add(displayId)
+            }
+        } ?: error("Timed out waiting for displays to be added.")
+        addedDisplays
+    }
+
+    /**
+     * Adds multiple overlay displays with default dimensions. Any existing overlay displays
+     * will be removed before adding the new ones.
+     *
+     * @param count number of displays to add.
+     * @return List of displayIds of added displays.
+     */
+    fun setupTestDisplays(count: Int): List<Int> {
+        val displays = List(count) { Point(DEFAULT_WIDTH, DEFAULT_HEIGHT) }
+        return setupTestDisplays(displays)
+    }
+
+    private fun cleanupTestDisplays() = runBlocking {
+        val displayRemovedFlow: Flow<Int> = callbackFlow {
+            val listener = object : DisplayListener {
+                override fun onDisplayAdded(displayId: Int) {}
+                override fun onDisplayRemoved(displayId: Int) {
+                    trySend(displayId)
+                }
+
+                override fun onDisplayChanged(displayId: Int) {}
+            }
+            val handler = Handler(Looper.getMainLooper())
+            displayManager.registerDisplayListener(listener, handler)
+
+            awaitClose {
+                displayManager.unregisterDisplayListener(listener)
+            }
+        }
+
+        // Remove overlay displays. We'll execute this regardless of addedDisplays just to
+        // ensure all overlay displays are removed before and after the test.
+        // Note: If we want to restore the original overlay display added before this test (and its
+        // topology), it will be complicated as re-adding overlay display would lead to different
+        // displayId and topology could not be restored easily.
+        Settings.Global.putString(
+            InstrumentationRegistry.getInstrumentation().context.contentResolver,
+            Settings.Global.OVERLAY_DISPLAY_DEVICES,
+            null
+        )
+
+        if (!addedDisplays.isEmpty()) {
+            withTimeoutOrNull(TIMEOUT) {
+                displayRemovedFlow.take(addedDisplays.size).collect { displayId ->
+                    addedDisplays.remove(displayId)
+                }
+            } ?: error("Timed out waiting for displays to be removed: $addedDisplays")
+        }
+    }
+
+    private companion object {
+        const val DEFAULT_WIDTH = 1280
+        const val DEFAULT_HEIGHT = 720
+        const val DEFAULT_DENSITY = 160
+        const val TAG = "SimulatedConnectedDisplayTestRule"
+        val TIMEOUT = 10.seconds
+    }
+}
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/BaseMetricListener.java b/libraries/device-collectors/src/main/java/android/device/collectors/BaseMetricListener.java
index ee1f61ea3..91ca9d3d2 100644
--- a/libraries/device-collectors/src/main/java/android/device/collectors/BaseMetricListener.java
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/BaseMetricListener.java
@@ -38,6 +38,7 @@ import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
 import java.io.PrintStream;
+import java.lang.annotation.Annotation;
 import java.nio.charset.StandardCharsets;
 import java.util.ArrayList;
 import java.util.Arrays;
@@ -45,6 +46,7 @@ import java.util.HashMap;
 import java.util.HashSet;
 import java.util.Map;
 import java.util.List;
+import java.util.Objects;
 import java.util.Set;
 
 /**
@@ -570,4 +572,52 @@ public class BaseMetricListener extends InstrumentationRunListener {
         }
         return true;
     }
+
+    /**
+     * Returns iteration number for the test or 0 if the test hasn't started executing yet
+     */
+    protected int getIteration(Description description) {
+        for (Annotation annotation : description.getAnnotations()) {
+            // If IterationMetadata annotation is present, return the iteration number from it
+            // As likely the test was renamed, so counting using mTestIdInvocationCount won't work
+            if (annotation instanceof IterationMetadata) {
+                return ((IterationMetadata) annotation).getIteration();
+            }
+        }
+        return mTestIdInvocationCount.getOrDefault(description.toString(), 0);
+    }
+
+    /**
+     * Special metadata annotation object that could indicate the original iteration number.
+     * It could be useful to retrieve the iteration number for a test if the test was renamed
+     * to include iteration number in the name.
+     */
+    public static class IterationMetadata implements Annotation {
+
+        private final int mIteration;
+
+        public IterationMetadata(int iteration) {
+            mIteration = iteration;
+        }
+
+        public int getIteration() {
+            return mIteration;
+        }
+
+        @Override
+        public Class<? extends Annotation> annotationType() {
+            return IterationMetadata.class;
+        }
+
+        @Override
+        public boolean equals(Object o) {
+            if (!(o instanceof IterationMetadata that)) return false;
+            return mIteration == that.mIteration;
+        }
+
+        @Override
+        public int hashCode() {
+            return Objects.hashCode(mIteration);
+        }
+    }
 }
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoListener.java b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoListener.java
index 38808508f..680d3ae07 100644
--- a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoListener.java
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoListener.java
@@ -20,12 +20,13 @@ import android.os.Bundle;
 
 import androidx.annotation.VisibleForTesting;
 
-import com.android.helpers.PerfettoHelper;
-
 import org.junit.runner.Description;
 import org.junit.runner.Result;
 import org.junit.runner.notification.Failure;
 
+import java.util.ArrayList;
+import java.util.List;
+
 /**
  * A {@link PerfettoListener} that captures the perfetto trace during each test method and save the
  * perfetto trace files under
@@ -35,8 +36,9 @@ import org.junit.runner.notification.Failure;
 public class PerfettoListener extends BaseMetricListener {
     public static final String COLLECT_PER_RUN = "per_run";
     public static final String COLLECT_PER_CLASS = "per_class";
+    public static final String COLLECT_BEFORE_AFTER = "perfetto_before_after_test";
 
-    private PerfettoTracingStrategy mTracingStrategy;
+    private List<PerfettoTracingStrategy> mTracingStrategies;
 
     public PerfettoListener() {
         super();
@@ -47,59 +49,65 @@ public class PerfettoListener extends BaseMetricListener {
      * for testing.
      */
     @VisibleForTesting
-    public PerfettoListener(Bundle args, PerfettoTracingStrategy strategy) {
+    public PerfettoListener(Bundle args, List<PerfettoTracingStrategy> strategies) {
         super(args);
-        mTracingStrategy = strategy;
-    }
-
-    protected PerfettoHelper getPerfettoHelper() {
-        return mTracingStrategy.getPerfettoHelper();
+        mTracingStrategies = strategies;
     }
 
     @Override
     public void onTestRunStart(DataRecord runData, Description description) {
-        mTracingStrategy.testRunStart(runData, description);
+        mTracingStrategies.forEach(strategy -> strategy.testRunStart(runData, description));
     }
 
     @Override
     public void onTestStart(DataRecord testData, Description description) {
-        mTracingStrategy.testStart(testData, description);
+        final int iteration = getIteration(description);
+        mTracingStrategies.forEach(strategy -> strategy.testStart(testData, description,
+                iteration));
     }
 
     @Override
     public void onTestFail(DataRecord testData, Description description, Failure failure) {
-        mTracingStrategy.testFail(testData, description, failure);
+        mTracingStrategies.forEach(strategy -> strategy.testFail(testData, description, failure));
     }
 
     @Override
     public void onTestEnd(DataRecord testData, Description description) {
-        mTracingStrategy.testEnd(testData, description);
+        final int iteration = getIteration(description);
+        mTracingStrategies.forEach(strategy -> strategy.testEnd(testData, description, iteration));
     }
 
     @Override
     public void onTestRunEnd(DataRecord runData, Result result) {
-        mTracingStrategy.testRunEnd(runData, result);
+        mTracingStrategies.forEach(strategy -> strategy.testRunEnd(runData, result));
     }
 
     @Override
     public void setupAdditionalArgs() {
         Bundle args = getArgsBundle();
 
-        if (mTracingStrategy == null) {
-            initTracingStrategy(args);
+        if (mTracingStrategies == null) {
+            initTracingStrategies(args);
         }
 
-        mTracingStrategy.setup(args);
+        mTracingStrategies.forEach(strategy -> strategy.setup(args));
     }
 
-    private void initTracingStrategy(Bundle args) {
+    private void initTracingStrategies(Bundle args) {
+        mTracingStrategies = new ArrayList<>();
+
         // Whether to collect the for the entire test run, per test, or per class.
         if (Boolean.parseBoolean(args.getString(COLLECT_PER_RUN))) {
-            mTracingStrategy = new PerfettoTracingPerRunStrategy(getInstrumentation());
+            mTracingStrategies.add(new PerfettoTracingPerRunStrategy(getInstrumentation()));
         } else if (Boolean.parseBoolean(args.getString(COLLECT_PER_CLASS))) {
-            mTracingStrategy = new PerfettoTracingPerClassStrategy(getInstrumentation());
+            mTracingStrategies.add(new PerfettoTracingPerClassStrategy(getInstrumentation()));
         } else {
-            mTracingStrategy = new PerfettoTracingPerTestStrategy(getInstrumentation());
+            mTracingStrategies.add(new PerfettoTracingPerTestStrategy(getInstrumentation()));
+        }
+
+        if (Boolean.parseBoolean(args.getString(COLLECT_BEFORE_AFTER))) {
+            mTracingStrategies.add(
+                    new PerfettoTracingBeforeAfterTestStrategy(getInstrumentation()));
         }
     }
 
@@ -110,6 +118,6 @@ public class PerfettoListener extends BaseMetricListener {
 
     @VisibleForTesting
     void runWithWakeLock(Runnable runnable) {
-        mTracingStrategy.runWithWakeLock(runnable);
+        mTracingStrategies.forEach(strategy -> strategy.runWithWakeLock(runnable));
     }
 }
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingBeforeAfterTestStrategy.java b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingBeforeAfterTestStrategy.java
new file mode 100644
index 000000000..5b909419d
--- /dev/null
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingBeforeAfterTestStrategy.java
@@ -0,0 +1,120 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.device.collectors;
+
+import android.annotation.SuppressLint;
+import android.app.Instrumentation;
+import android.os.PowerManager;
+import android.util.Log;
+
+import androidx.annotation.VisibleForTesting;
+
+import com.android.helpers.PerfettoHelper;
+
+import org.junit.runner.Description;
+
+import java.nio.file.Path;
+import java.nio.file.Paths;
+import java.util.function.Supplier;
+
+/**
+ * A strategy that allows capturing one-shot traces before and after each test
+ */
+public class PerfettoTracingBeforeAfterTestStrategy extends PerfettoTracingStrategy {
+    private static final String STRATEGY_IDENTIFIER = "before_after";
+
+    PerfettoTracingBeforeAfterTestStrategy(Instrumentation instr) {
+        super(instr, STRATEGY_IDENTIFIER);
+    }
+
+    @VisibleForTesting
+    public PerfettoTracingBeforeAfterTestStrategy(
+            PerfettoHelper helper,
+            Instrumentation instr) {
+        super(helper, instr, STRATEGY_IDENTIFIER);
+    }
+
+    /**
+     * Constructor to simulate receiving the instrumentation arguments. Should not be used except
+     * for testing.
+     */
+    @VisibleForTesting
+    PerfettoTracingBeforeAfterTestStrategy(
+            PerfettoHelper helper,
+            Instrumentation instr,
+            WakeLockContext wakeLockContext,
+            Supplier<PowerManager.WakeLock> wakelockSupplier,
+            WakeLockAcquirer wakeLockAcquirer,
+            WakeLockReleaser wakeLockReleaser) {
+        super(helper, instr, STRATEGY_IDENTIFIER, wakeLockContext, wakelockSupplier,
+                wakeLockAcquirer, wakeLockReleaser);
+    }
+
+    @Override
+    void testStart(DataRecord testData, Description description, int iteration) {
+        super.testStart(testData, description, iteration);
+        captureTrace("before", testData, description, iteration);
+    }
+
+    @Override
+    void testEnd(DataRecord testData, Description description, int iteration) {
+        super.testEnd(testData, description, iteration);
+        captureTrace("after", testData, description, iteration);
+    }
+
+    private void captureTrace(String tag, DataRecord testData, Description description,
+            int iteration) {
+        if (skipMetric(iteration)) {
+            return;
+        }
+
+        final String metricName = getFilePathKeyPrefix() + "_" + tag;
+
+        Log.i(getTag(), "Capturing trace '" + tag + "', for " +
+                getTestFileName(description));
+
+        Runnable task =
+                () -> {
+                    Log.i(getTag(), "Starting perfetto tracing.");
+                    startPerfettoTracing();
+
+                    if (!isPerfettoStartSuccess()) {
+                        return;
+                    }
+
+                    Log.i(getTag(), "Stopping perfetto tracing.");
+                    Path path = getOutputPathModeTest(tag, description, iteration);
+                    stopPerfettoTracingAndReportMetric(path, testData, metricName);
+                };
+
+        runTask(task, "Holding a wakelock at captureTrace");
+    }
+
+    @SuppressLint("DefaultLocale")
+    private Path getOutputPathModeTest(String tag, Description description, int iteration) {
+        return Paths.get(
+                getTestOutputRoot(),
+                getTestFileName(description),
+                this.getClass().getSimpleName(),
+                String.format(
+                        "%s%s-%s-%d.perfetto-trace",
+                        getOutputFilePrefix(),
+                        getTestFileName(description),
+                        tag,
+                        iteration));
+    }
+}
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerClassStrategy.java b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerClassStrategy.java
index 393649c26..3a59df931 100644
--- a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerClassStrategy.java
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerClassStrategy.java
@@ -39,11 +39,13 @@ import java.util.function.Supplier;
  * <root>/<test_name>/PerfettoTracingStrategy/<test class>.perfetto-trace
  */
 public class PerfettoTracingPerClassStrategy extends PerfettoTracingStrategy {
+    private static final String STRATEGY_IDENTIFIER = "per_class";
+
     private List<String> mFileList = new ArrayList<>();
     private Description mLastDescription;
 
     PerfettoTracingPerClassStrategy(Instrumentation instr) {
-        super(instr);
+        super(instr, STRATEGY_IDENTIFIER);
     }
 
     /**
@@ -52,7 +54,7 @@ public class PerfettoTracingPerClassStrategy extends PerfettoTracingStrategy {
      */
     @VisibleForTesting
     public PerfettoTracingPerClassStrategy(PerfettoHelper helper, Instrumentation instr) {
-        super(helper, instr);
+        super(helper, instr, STRATEGY_IDENTIFIER);
     }
 
     /**
@@ -67,11 +69,12 @@ public class PerfettoTracingPerClassStrategy extends PerfettoTracingStrategy {
             Supplier<PowerManager.WakeLock> wakelockSupplier,
             WakeLockAcquirer wakeLockAcquirer,
             WakeLockReleaser wakeLockReleaser) {
-        super(helper, instr, wakeLockContext, wakelockSupplier, wakeLockAcquirer, wakeLockReleaser);
+        super(helper, instr, STRATEGY_IDENTIFIER, wakeLockContext, wakelockSupplier,
+                wakeLockAcquirer, wakeLockReleaser);
     }
 
     @Override
-    void testStart(DataRecord testData, Description description) {
+    void testStart(DataRecord testData, Description description, int iteration) {
         boolean isClassChanging =
                 mLastDescription == null
                         || !description.getClassName().equals(mLastDescription.getClassName());
@@ -127,7 +130,7 @@ public class PerfettoTracingPerClassStrategy extends PerfettoTracingStrategy {
     private void uploadMetrics(DataRecord dataRecord) {
         int counter = 0;
         for (String filePath : mFileList) {
-            String metricName = PERFETTO_FILE_PATH + counter++;
+            String metricName = getFilePathKeyPrefix() + counter++;
             dataRecord.addStringMetric(metricName, filePath);
         }
     }
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerRunStrategy.java b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerRunStrategy.java
index ac413c597..237c155da 100644
--- a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerRunStrategy.java
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerRunStrategy.java
@@ -39,8 +39,10 @@ import java.util.function.Supplier;
  * <root>/<test_name>/PerfettoTracingStrategy/<random UUID>-<invocation_count>.perfetto-trace
  */
 public class PerfettoTracingPerRunStrategy extends PerfettoTracingStrategy {
+    private static final String STRATEGY_IDENTIFIER = "per_run";
+
     PerfettoTracingPerRunStrategy(Instrumentation instr) {
-        super(instr);
+        super(instr, STRATEGY_IDENTIFIER);
     }
 
     /**
@@ -49,7 +51,7 @@ public class PerfettoTracingPerRunStrategy extends PerfettoTracingStrategy {
      */
     @VisibleForTesting
     public PerfettoTracingPerRunStrategy(PerfettoHelper helper, Instrumentation instr) {
-        super(helper, instr);
+        super(helper, instr, STRATEGY_IDENTIFIER);
     }
 
     /**
@@ -64,7 +66,8 @@ public class PerfettoTracingPerRunStrategy extends PerfettoTracingStrategy {
             Supplier<PowerManager.WakeLock> wakelockSupplier,
             WakeLockAcquirer wakeLockAcquirer,
             WakeLockReleaser wakeLockReleaser) {
-        super(helper, instr, wakeLockContext, wakelockSupplier, wakeLockAcquirer, wakeLockReleaser);
+        super(helper, instr, STRATEGY_IDENTIFIER, wakeLockContext, wakelockSupplier,
+                wakeLockAcquirer, wakeLockReleaser);
     }
 
     @Override
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerTestStrategy.java b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerTestStrategy.java
index 1805bc1d7..8292bd420 100644
--- a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerTestStrategy.java
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingPerTestStrategy.java
@@ -39,10 +39,12 @@ import java.util.function.Supplier;
  * <root>/<test_name>/PerfettoTracingStrategy/<test_name>-<invocation_count>.perfetto-trace
  */
 public class PerfettoTracingPerTestStrategy extends PerfettoTracingStrategy {
+    private static final String STRATEGY_IDENTIFIER = "per_test";
+
     private Map<String, Integer> mTestIdInvocationCount = new HashMap<>();
 
     PerfettoTracingPerTestStrategy(Instrumentation instr) {
-        super(instr);
+        super(instr, STRATEGY_IDENTIFIER);
     }
 
     /**
@@ -51,7 +53,7 @@ public class PerfettoTracingPerTestStrategy extends PerfettoTracingStrategy {
      */
     @VisibleForTesting
     public PerfettoTracingPerTestStrategy(PerfettoHelper helper, Instrumentation instr) {
-        super(helper, instr);
+        super(helper, instr, STRATEGY_IDENTIFIER);
     }
 
     /**
@@ -67,7 +69,8 @@ public class PerfettoTracingPerTestStrategy extends PerfettoTracingStrategy {
             Supplier<PowerManager.WakeLock> wakelockSupplier,
             WakeLockAcquirer wakeLockAcquirer,
             WakeLockReleaser wakeLockReleaser) {
-        super(helper, instr, wakeLockContext, wakelockSupplier, wakeLockAcquirer, wakeLockReleaser);
+        super(helper, instr, STRATEGY_IDENTIFIER, wakeLockContext, wakelockSupplier,
+                wakeLockAcquirer, wakeLockReleaser);
         mTestIdInvocationCount = invocationMap;
     }
 
@@ -78,13 +81,13 @@ public class PerfettoTracingPerTestStrategy extends PerfettoTracingStrategy {
     @VisibleForTesting
     protected PerfettoTracingPerTestStrategy(
             PerfettoHelper helper, Instrumentation instr, Map invocationMap) {
-        super(instr);
+        super(instr, STRATEGY_IDENTIFIER);
         mTestIdInvocationCount = invocationMap;
     }
 
     @Override
-    void testStart(DataRecord testData, Description description) {
-        super.testStart(testData, description);
+    void testStart(DataRecord testData, Description description, int iteration) {
+        super.testStart(testData, description, iteration);
         Runnable task =
                 () -> {
                     mTestIdInvocationCount.compute(
@@ -98,7 +101,7 @@ public class PerfettoTracingPerTestStrategy extends PerfettoTracingStrategy {
     }
 
     @Override
-    void testEnd(DataRecord testData, Description description) {
+    void testEnd(DataRecord testData, Description description, int iteration) {
         if (!isPerfettoStartSuccess()) {
             Log.i(
                     getTag(),
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingStrategy.java b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingStrategy.java
index 00e11e617..0c738cda3 100644
--- a/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingStrategy.java
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/PerfettoTracingStrategy.java
@@ -68,8 +68,14 @@ public abstract class PerfettoTracingStrategy {
     public static final String SKIP_TEST_FAILURE_METRICS = "skip_test_failure_metrics";
     // Skip success metrics collection if this flag is set to true (i.e. collect only failures).
     public static final String SKIP_TEST_SUCCESS_METRICS = "skip_test_success_metrics";
-    // Perfetto file path key.
-    protected static final String PERFETTO_FILE_PATH = "perfetto_file_path";
+    // List of test iterations to capture, capture all if empty
+    public static final String ARGUMENT_ALLOW_ITERATIONS = "allow_iterations";
+    // Perfetto file path key argument name
+    public static final String ARGUMENT_FILE_PATH_KEY_PREFIX = "perfetto_file_path_key_prefix";
+    // Perfetto file path key prefix
+    protected static final String DEFAULT_FILE_PATH_KEY_PREFIX = "perfetto_file_path";
+    // Perfetto file path key prefix for failed tests
+    protected static final String FAILED_FILE_PATH_KEY_PREFIX = "perfetto_failed_file_path";
     // Argument to get custom time in millisecs to wait before dumping the trace.
     // This has to be at least the dump interval time set in the trace config file
     // or greater than that. Otherwise, we will miss trace information from the test.
@@ -81,7 +87,7 @@ public abstract class PerfettoTracingStrategy {
     // Destination directory to save the trace results.
     private static final String TEST_OUTPUT_ROOT = "test_output_root";
     // Default output folder to store the perfetto output traces.
-    private static final String DEFAULT_OUTPUT_ROOT = "/sdcard/test_results";
+    private static final String DEFAULT_OUTPUT_ROOT = "/data/local/tmp/perfetto-traces";
     // Default wait time before stopping the perfetto trace.
     private static final String DEFAULT_WAIT_TIME_MSECS = "0";
     // Argument to get custom time in millisecs to wait before starting the
@@ -95,11 +101,11 @@ public abstract class PerfettoTracingStrategy {
     public static final String SPACES_PATTERN = "\\s+";
     // Space replacement value
     public static final String REPLACEMENT_CHAR = "#";
+    // Separator character used to specify custom arguments for the strategy
+    public static final String STRATEGY_ARGUMENT_NAMESPACE_SEPARATOR = "#";
     // For USB disconnected cases you may want this option to be true. This option makes sure
     // the device does not go to sleep while collecting.
     public static final String PERFETTO_START_BG_WAIT = "perfetto_start_bg_wait";
-    // Argument to indicate whenever to move the temp trace using tf contend provider.
-    public static final String SHOULD_USE_CONTENT_PROVIDER = "perfetto_should_use_content_provider";
 
     @VisibleForTesting
     static final String HOLD_WAKELOCK_WHILE_COLLECTING = "hold_wakelock_while_collecting";
@@ -111,8 +117,8 @@ public abstract class PerfettoTracingStrategy {
     private final WakeLockAcquirer mWakeLockAcquirer;
     private final WakeLockReleaser mWakeLockReleaser;
     private final Instrumentation mInstr;
-
-    private PerfettoHelper mPerfettoHelper = new PerfettoHelper();
+    private final String mIdentifier;
+    private final PerfettoHelper mPerfettoHelper;
     // Wait time can be customized based on the dump interval set in the trace config.
     private long mWaitTimeInMs;
     // Wait time can be customized based on how much time to wait before starting the
@@ -130,12 +136,24 @@ public abstract class PerfettoTracingStrategy {
     private boolean mIsTestFailed = false;
     // Store the method name and invocation count to create unique file name for each trace.
     private boolean mPerfettoStartSuccess = false;
+    private String mFilePathKeyPrefix = DEFAULT_FILE_PATH_KEY_PREFIX;
     private String mOutputFilePrefix;
     private String mTrackPerfettoProcIdRootDir;
+    private final Set<Integer> mAllowedIterations = new HashSet<>();
 
-    PerfettoTracingStrategy(Instrumentation instr) {
+    /**
+     * @param instr Android instrumentation object
+     * @param identifier Unique strategy identifier, used for strategy specific configuration
+     *                   parameters and to track multiple parallel strategies running at the
+     *                   same time. For example, to pass Perfetto configuration to a specific
+     *                   strategy we could pass "[strategy_identifier]:perfetto_config_file"
+     *                   argument instead of "perfetto_config_file".
+     */
+    PerfettoTracingStrategy(Instrumentation instr, String identifier) {
         super();
         mInstr = instr;
+        mIdentifier = identifier;
+        mPerfettoHelper = new PerfettoHelper(identifier);
         mWakeLockContext = this::runWithWakeLock;
         mWakelockSupplier = this::getWakeLock;
         mWakeLockAcquirer = this::acquireWakelock;
@@ -147,10 +165,11 @@ public abstract class PerfettoTracingStrategy {
      * for testing.
      */
     @VisibleForTesting
-    PerfettoTracingStrategy(PerfettoHelper helper, Instrumentation instr) {
+    PerfettoTracingStrategy(PerfettoHelper helper, Instrumentation instr, String identifier) {
         super();
         mPerfettoHelper = helper;
         mInstr = instr;
+        mIdentifier = identifier;
         mWakeLockContext = this::runWithWakeLock;
         mWakelockSupplier = this::getWakeLock;
         mWakeLockAcquirer = this::acquireWakelock;
@@ -164,12 +183,14 @@ public abstract class PerfettoTracingStrategy {
     PerfettoTracingStrategy(
             PerfettoHelper helper,
             Instrumentation instr,
+            String identifier,
             WakeLockContext wakeLockContext,
             Supplier<PowerManager.WakeLock> wakelockSupplier,
             WakeLockAcquirer wakeLockAcquirer,
             WakeLockReleaser wakeLockReleaser) {
         super();
         mPerfettoHelper = helper;
+        mIdentifier = identifier;
         mInstr = instr;
         mWakeLockContext = wakeLockContext;
         mWakeLockAcquirer = wakeLockAcquirer;
@@ -246,11 +267,11 @@ public abstract class PerfettoTracingStrategy {
         }
     }
 
-    void testStart(DataRecord testData, Description description) {
+    void testStart(DataRecord testData, Description description, int iteration) {
         mIsTestFailed = false;
     }
 
-    void testEnd(DataRecord testData, Description description) {
+    void testEnd(DataRecord testData, Description description, int iteration) {
         // No-op
     }
 
@@ -294,8 +315,17 @@ public abstract class PerfettoTracingStrategy {
      * record with the path to the trace file.
      */
     protected void stopPerfettoTracingAndReportMetric(Path path, DataRecord record) {
+        stopPerfettoTracingAndReportMetric(path, record, mFilePathKeyPrefix);
+    }
+
+    protected void stopPerfettoTracingAndReportMetric(Path path, DataRecord record,
+            String metricName) {
         if (stopPerfettoTracing(path)) {
-            record.addStringMetric(PERFETTO_FILE_PATH, path.toString());
+            if (mIsTestFailed) {
+                record.addStringMetric(FAILED_FILE_PATH_KEY_PREFIX, path.toString());
+            } else {
+                record.addStringMetric(metricName, path.toString());
+            }
         }
     }
 
@@ -323,11 +353,30 @@ public abstract class PerfettoTracingStrategy {
         return mOutputFilePrefix;
     }
 
+    protected String getFilePathKeyPrefix() {
+        return mFilePathKeyPrefix;
+    }
+
     protected String getTestOutputRoot() {
         return mTestOutputRoot;
     }
 
     protected boolean skipMetric() {
+        return skipMetric(/* iteration= */ null);
+    }
+
+    protected boolean skipMetric(Integer iteration) {
+        if (iteration != null && !mAllowedIterations.isEmpty()) {
+            if (iteration.equals(0)) {
+                throw new IllegalStateException("Skip metric check was executed before "
+                        + "the test has started");
+            }
+
+            if (!mAllowedIterations.contains(iteration)) {
+                return true;
+            }
+        }
+
         return (mSkipTestFailureMetrics && mIsTestFailed)
                 || (mSkipTestSuccessMetrics && !mIsTestFailed);
     }
@@ -401,9 +450,8 @@ public abstract class PerfettoTracingStrategy {
     }
 
     void setup(Bundle args) {
-
-        boolean perfettoStartBgWait =
-                Boolean.parseBoolean(args.getString(PERFETTO_START_BG_WAIT, String.valueOf(true)));
+        boolean perfettoStartBgWait = Boolean.parseBoolean(getArgumentValue(args,
+                PERFETTO_START_BG_WAIT, String.valueOf(true)));
         mPerfettoHelper.setPerfettoStartBgWait(perfettoStartBgWait);
 
         // Root directory path containing the perfetto config file.
@@ -415,57 +463,71 @@ public abstract class PerfettoTracingStrategy {
         mPerfettoHelper.setPerfettoConfigRootDir(configRootDir);
 
         // Whether the config is text proto or not. By default set to false.
-        mIsConfigTextProto = Boolean.parseBoolean(args.getString(PERFETTO_CONFIG_TEXT_PROTO));
+        mIsConfigTextProto = Boolean.parseBoolean(getArgumentValue(args, PERFETTO_CONFIG_TEXT_PROTO,
+                String.valueOf(false)));
 
         // Perfetto config file has to be under /data/misc/perfetto-traces/
         // defaulted to DEFAULT_TEXT_CONFIG_FILE or DEFAULT_CONFIG_FILE if perfetto_config_file is
         // not passed.
-        mConfigFileName =
-                args.getString(
-                        PERFETTO_CONFIG_FILE_ARG,
-                        mIsConfigTextProto ? DEFAULT_TEXT_CONFIG_FILE : DEFAULT_CONFIG_FILE);
+        mConfigFileName = getArgumentValue(args, PERFETTO_CONFIG_FILE_ARG,
+                mIsConfigTextProto ? DEFAULT_TEXT_CONFIG_FILE : DEFAULT_CONFIG_FILE);
 
-        mConfigContent = args.getString(PERFETTO_CONFIG_TEXT_CONTENT, "");
+        mConfigContent = getArgumentValue(args, PERFETTO_CONFIG_TEXT_CONTENT, "");
 
-        mOutputFilePrefix =
-                args.getString(PERFETTO_CONFIG_OUTPUT_FILE_PREFIX, DEFAULT_PERFETTO_PREFIX);
+        mOutputFilePrefix = getArgumentValue(args, PERFETTO_CONFIG_OUTPUT_FILE_PREFIX,
+                DEFAULT_PERFETTO_PREFIX);
 
-        mPerfettoHelper.setTrackPerfettoPidFlag(
-                Boolean.parseBoolean(args.getString(PERFETTO_PERSIST_PID_TRACK, "true")));
+        mPerfettoHelper.setTrackPerfettoPidFlag(Boolean.parseBoolean(getArgumentValue(args,
+                PERFETTO_PERSIST_PID_TRACK, String.valueOf(true))));
         if (mPerfettoHelper.getTrackPerfettoPidFlag()) {
-            mPerfettoHelper.setTrackPerfettoRootDir(
-                    args.getString(PERFETTO_PID_TRACK_ROOT, DEFAULT_PERFETTO_PID_TRACK_ROOT));
+            mPerfettoHelper.setTrackPerfettoRootDir(getArgumentValue(args, PERFETTO_PID_TRACK_ROOT,
+                    DEFAULT_PERFETTO_PID_TRACK_ROOT));
         }
 
         // Whether to hold wakelocks on all Prefetto tracing functions. You may want to enable
         // this if your device is not USB connected. This option prevents the device from
         // going into suspend mode while this listener is running intensive tasks.
-        mHoldWakelockWhileCollecting =
-                Boolean.parseBoolean(args.getString(HOLD_WAKELOCK_WHILE_COLLECTING));
+        mHoldWakelockWhileCollecting = Boolean.parseBoolean(getArgumentValue(args,
+                HOLD_WAKELOCK_WHILE_COLLECTING, String.valueOf(false)));
 
         // Wait time before stopping the perfetto trace collection after the test
         // is completed. Defaulted to 0 msecs.
-        mWaitTimeInMs =
-                Long.parseLong(args.getString(PERFETTO_WAIT_TIME_ARG, DEFAULT_WAIT_TIME_MSECS));
+        mWaitTimeInMs = Long.parseLong(getArgumentValue(args, PERFETTO_WAIT_TIME_ARG,
+                DEFAULT_WAIT_TIME_MSECS));
 
         // Wait time before the perfetto trace is started.
-        mWaitStartTimeInMs =
-                Long.parseLong(
-                        args.getString(
-                                PERFETTO_START_WAIT_TIME_ARG, DEFAULT_START_WAIT_TIME_MSECS));
+        mWaitStartTimeInMs = Long.parseLong(getArgumentValue(args, PERFETTO_START_WAIT_TIME_ARG,
+                DEFAULT_START_WAIT_TIME_MSECS));
 
         // Destination folder in the device to save all the trace files.
         // Defaulted to /sdcard/test_results if test_output_root is not passed.
-        mTestOutputRoot = args.getString(TEST_OUTPUT_ROOT, DEFAULT_OUTPUT_ROOT);
+        mTestOutputRoot = getArgumentValue(args, TEST_OUTPUT_ROOT, DEFAULT_OUTPUT_ROOT);
 
         // By default, this flag is set to false to collect the metrics on test failure.
-        mSkipTestFailureMetrics = "true".equals(args.getString(SKIP_TEST_FAILURE_METRICS));
-        mSkipTestSuccessMetrics = "true".equals(args.getString(SKIP_TEST_SUCCESS_METRICS));
+        mSkipTestFailureMetrics = Boolean.parseBoolean(getArgumentValue(args,
+                SKIP_TEST_FAILURE_METRICS, String.valueOf(false)));
+        mSkipTestSuccessMetrics = Boolean.parseBoolean(getArgumentValue(args,
+                SKIP_TEST_SUCCESS_METRICS, String.valueOf(false)));
+
+        mFilePathKeyPrefix = getArgumentValue(args, ARGUMENT_FILE_PATH_KEY_PREFIX,
+                DEFAULT_FILE_PATH_KEY_PREFIX);
+
+        final String iterations = getArgumentValue(args, ARGUMENT_ALLOW_ITERATIONS, "");
+        for (String iteration : iterations.split(",")) {
+            if (!iteration.isEmpty()) {
+                mAllowedIterations.add(Integer.parseInt(iteration));
+            }
+        }
+    }
 
-        // By default, use content provider to move the trace file.
-        boolean shouldUseContentProvider =
-                Boolean.parseBoolean(args.getString(SHOULD_USE_CONTENT_PROVIDER, "true"));
-        mPerfettoHelper.setShouldUseContentProvider(shouldUseContentProvider);
+    /**
+     * Gets argument value, strategy-specific argument has a priority over global argument
+     */
+    private String getArgumentValue(Bundle args, String key, String defaultValue) {
+        String strategySpecificValue = args.getString(mIdentifier +
+                STRATEGY_ARGUMENT_NAMESPACE_SEPARATOR + key);
+        if (strategySpecificValue != null) return strategySpecificValue;
+        return args.getString(key, defaultValue);
     }
 
     /**
diff --git a/libraries/device-collectors/src/main/java/android/device/collectors/ScreenshotOnFailureCollector.java b/libraries/device-collectors/src/main/java/android/device/collectors/ScreenshotOnFailureCollector.java
index 2b6c9c9ad..702b62069 100644
--- a/libraries/device-collectors/src/main/java/android/device/collectors/ScreenshotOnFailureCollector.java
+++ b/libraries/device-collectors/src/main/java/android/device/collectors/ScreenshotOnFailureCollector.java
@@ -19,6 +19,7 @@ import android.device.collectors.annotations.OptionClass;
 import android.graphics.Bitmap;
 import android.os.Bundle;
 import android.util.Log;
+
 import androidx.annotation.VisibleForTesting;
 import androidx.test.uiautomator.UiDevice;
 
@@ -28,9 +29,8 @@ import org.junit.runner.notification.Failure;
 import java.io.File;
 import java.io.IOException;
 import java.io.OutputStream;
-import java.util.Map;
 import java.util.HashMap;
-
+import java.util.Map;
 
 /**
  * A {@link BaseMetricListener} that captures screenshots when a test fails.
@@ -109,8 +109,13 @@ public class ScreenshotOnFailureCollector extends BaseMetricListener {
         if (mDestDir == null) {
             return;
         }
+
+        // Update iteration separator from $ to _ as linux file system doesn't handle file
+        // names with $ correctly.
         final String fileNameBase =
-                String.format("%s.%s", description.getClassName(), description.getMethodName());
+                String.format(
+                        "%s.%s",
+                        description.getClassName(), description.getMethodName().replace('$', '_'));
         // Omit the iteration number for the first iteration.
         int iteration = mTestIterations.get(description.getDisplayName());
         final String fileName =
diff --git a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoListenerTest.java b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoListenerTest.java
index e77ce4b2a..d7573af11 100644
--- a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoListenerTest.java
+++ b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoListenerTest.java
@@ -48,7 +48,9 @@ import org.mockito.Mock;
 import org.mockito.MockitoAnnotations;
 import org.mockito.Spy;
 
+import java.util.ArrayList;
 import java.util.HashMap;
+import java.util.List;
 import java.util.Map;
 
 /**
@@ -96,39 +98,53 @@ public class PerfettoListenerTest {
                 .run(any());
     }
 
-    private PerfettoTracingStrategy initStrategy(Bundle b) {
+    private List<PerfettoTracingStrategy> initStrategies(Bundle b) {
+        final List<PerfettoTracingStrategy> strategies = new ArrayList<>();
         if (Boolean.parseBoolean(b.getString(PerfettoListener.COLLECT_PER_RUN))) {
-            return new PerfettoTracingPerRunStrategy(
+            strategies.add(new PerfettoTracingPerRunStrategy(
                     mPerfettoHelper,
                     mInstrumentation,
                     mWakeLockContext,
                     () -> null,
                     mWakelLockAcquirer,
-                    mWakeLockReleaser);
+                    mWakeLockReleaser));
         } else if (Boolean.parseBoolean(b.getString(PerfettoListener.COLLECT_PER_CLASS))) {
-            return new PerfettoTracingPerClassStrategy(
+            strategies.add(new PerfettoTracingPerClassStrategy(
                     mPerfettoHelper,
                     mInstrumentation,
                     mWakeLockContext,
                     () -> null,
                     mWakelLockAcquirer,
-                    mWakeLockReleaser);
+                    mWakeLockReleaser));
+        } else {
+            strategies.add(new PerfettoTracingPerTestStrategy(
+                    mPerfettoHelper,
+                    mInstrumentation,
+                    mInvocationCount,
+                    mWakeLockContext,
+                    () -> null,
+                    mWakelLockAcquirer,
+                    mWakeLockReleaser)
+            );
+        }
+
+        if (Boolean.parseBoolean(b.getString(PerfettoListener.COLLECT_BEFORE_AFTER))) {
+            strategies.add(new PerfettoTracingBeforeAfterTestStrategy(
+                    mPerfettoHelper,
+                    mInstrumentation,
+                    mWakeLockContext,
+                    () -> null,
+                    mWakelLockAcquirer,
+                    mWakeLockReleaser));
         }
 
-        return new PerfettoTracingPerTestStrategy(
-                mPerfettoHelper,
-                mInstrumentation,
-                mInvocationCount,
-                mWakeLockContext,
-                () -> null,
-                mWakelLockAcquirer,
-                mWakeLockReleaser);
+        return strategies;
     }
 
     private PerfettoListener initListener(Bundle b) {
         mInvocationCount = new HashMap<>();
 
-        PerfettoListener listener = spy(new PerfettoListener(b, initStrategy(b)));
+        PerfettoListener listener = spy(new PerfettoListener(b, initStrategies(b)));
 
         mDataRecord = listener.createDataRecord();
         listener.setInstrumentation(mInstrumentation);
@@ -155,7 +171,7 @@ public class PerfettoListenerTest {
                 .stopCollecting(
                         anyLong(),
                         eq(
-                                "/sdcard/test_results/run_test1/"
+                                "/data/local/tmp/perfetto-traces/run_test1/"
                                         + "PerfettoTracingPerTestStrategy/"
                                         + "perfetto_run_test1-1.perfetto-trace"));
     }
@@ -567,7 +583,7 @@ public class PerfettoListenerTest {
                 .stopCollecting(
                         anyLong(),
                         eq(
-                                "/sdcard/test_results/run#123_test1#456/"
+                                "/data/local/tmp/perfetto-traces/run#123_test1#456/"
                                         + "PerfettoTracingPerTestStrategy/"
                                         + "perfetto_run#123_test1#456-1.perfetto-trace"));
     }
diff --git a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingBeforeAfterStrategyTest.java b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingBeforeAfterStrategyTest.java
new file mode 100644
index 000000000..054ad73e2
--- /dev/null
+++ b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingBeforeAfterStrategyTest.java
@@ -0,0 +1,167 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.device.collectors;
+
+import static android.device.collectors.PerfettoTracingStrategy.ARGUMENT_ALLOW_ITERATIONS;
+
+import static org.mockito.ArgumentMatchers.any;
+import static org.mockito.ArgumentMatchers.anyLong;
+import static org.mockito.ArgumentMatchers.anyString;
+import static org.mockito.Mockito.clearInvocations;
+import static org.mockito.Mockito.doAnswer;
+import static org.mockito.Mockito.doReturn;
+import static org.mockito.Mockito.never;
+import static org.mockito.Mockito.spy;
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+
+import android.annotation.SuppressLint;
+import android.app.Instrumentation;
+import android.os.Bundle;
+
+import androidx.test.runner.AndroidJUnit4;
+
+import com.android.helpers.PerfettoHelper;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.Description;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.mockito.MockitoAnnotations;
+import org.mockito.Spy;
+
+/**
+ * Android Unit tests for {@link PerfettoTracingBeforeAfterTestStrategy}.
+ *
+ * <p>To run: atest
+ * CollectorDeviceLibTest:android.device.collectors.PerfettoTracingBeforeAfterStrategyTest.
+ */
+@RunWith(AndroidJUnit4.class)
+public class PerfettoTracingBeforeAfterStrategyTest {
+    private Description mRunDesc;
+    private Description mTest1Desc;
+    private Description mTest2Desc;
+    private DataRecord mDataRecord;
+
+    @Spy private PerfettoHelper mPerfettoHelper;
+    @Mock private Instrumentation mInstrumentation;
+
+    @Mock private PerfettoTracingStrategy.WakeLockContext mWakeLockContext;
+    @Mock private PerfettoTracingStrategy.WakeLockAcquirer mWakelLockAcquirer;
+    @Mock private PerfettoTracingStrategy.WakeLockReleaser mWakeLockReleaser;
+
+    @Before
+    public void setUp() {
+        MockitoAnnotations.initMocks(this);
+        mRunDesc = Description.createSuiteDescription("run");
+        mTest1Desc = Description.createTestDescription("run", "test1");
+        mTest2Desc = Description.createTestDescription("run", "test2");
+        mDataRecord = new DataRecord();
+
+        doReturn(true).when(mPerfettoHelper).startCollecting();
+        doReturn(true).when(mPerfettoHelper).stopCollecting(anyLong(), anyString());
+
+        doAnswer(
+                        invocation -> {
+                            Runnable runnable = invocation.getArgument(0);
+                            runnable.run();
+                            return null;
+                        })
+                .when(mWakeLockContext)
+                .run(any());
+    }
+
+    @SuppressLint("VisibleForTests")
+    private PerfettoTracingBeforeAfterTestStrategy initStrategy(Bundle b) {
+        PerfettoTracingBeforeAfterTestStrategy strategy =
+                spy(
+                        new PerfettoTracingBeforeAfterTestStrategy(
+                                mPerfettoHelper,
+                                mInstrumentation,
+                                mWakeLockContext,
+                                () -> null,
+                                mWakelLockAcquirer,
+                                mWakeLockReleaser));
+
+        strategy.setup(b);
+        return strategy;
+    }
+
+    @Test
+    public void testPerfettoTraceStartAndEndOnTestStart() {
+        Bundle b = new Bundle();
+        PerfettoTracingStrategy strategy = initStrategy(b);
+        strategy.testRunStart(mDataRecord, mRunDesc);
+        verify(mPerfettoHelper, never()).startCollecting();
+
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+
+        verify(mPerfettoHelper).startCollecting();
+        verify(mPerfettoHelper).stopCollecting(anyLong(), anyString());
+    }
+
+    @Test
+    public void testPerfettoTraceStartAndEndOnTestEnd() {
+        Bundle b = new Bundle();
+        PerfettoTracingStrategy strategy = initStrategy(b);
+        strategy.testRunStart(mDataRecord, mRunDesc);
+        verify(mPerfettoHelper, never()).startCollecting();
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        clearInvocations(mPerfettoHelper);
+
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
+
+        verify(mPerfettoHelper).startCollecting();
+        verify(mPerfettoHelper).stopCollecting(anyLong(), anyString());
+    }
+
+    @Test
+    public void testTwoTests_startsAndEndsPerfettoCollectionForAllExecutions() {
+        Bundle b = new Bundle();
+        PerfettoTracingStrategy strategy = initStrategy(b);
+        strategy.testRunStart(mDataRecord, mRunDesc);
+        verify(mPerfettoHelper, never()).startCollecting();
+
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testStart(mDataRecord, mTest2Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest2Desc, /* iteration= */ 1);
+
+        verify(mPerfettoHelper, times(4)).startCollecting();
+        verify(mPerfettoHelper, times(4)).stopCollecting(anyLong(), anyString());
+    }
+
+    @Test
+    public void testTwoIterations_onlySecondIsAllowed_collectsTraceOnlyForTheSecond() {
+        Bundle b = new Bundle();
+        b.putString(ARGUMENT_ALLOW_ITERATIONS, "2");
+        PerfettoTracingStrategy strategy = initStrategy(b);
+        strategy.testRunStart(mDataRecord, mRunDesc);
+        verify(mPerfettoHelper, never()).startCollecting();
+
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        // Should not collect traces for the first iteration
+        verify(mPerfettoHelper, never()).startCollecting();
+
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 2);
+
+        verify(mPerfettoHelper).startCollecting();
+        verify(mPerfettoHelper).stopCollecting(anyLong(), anyString());
+    }
+}
diff --git a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerClassStrategyTest.java b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerClassStrategyTest.java
index ad21f6bae..f0a0815e1 100644
--- a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerClassStrategyTest.java
+++ b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerClassStrategyTest.java
@@ -110,7 +110,7 @@ public class PerfettoTracingPerClassStrategyTest {
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
         verify(mPerfettoHelper, times(0)).startCollecting();
-        strategy.testStart(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).startCollecting();
     }
 
@@ -124,10 +124,10 @@ public class PerfettoTracingPerClassStrategyTest {
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
         verify(mPerfettoHelper, times(0)).startCollecting();
-        strategy.testStart(mDataRecord, mTest1Desc);
-        strategy.testEnd(mDataRecord, mTest1Desc);
-        strategy.testStart(mDataRecord, mTest2Desc);
-        strategy.testEnd(mDataRecord, mTest2Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testStart(mDataRecord, mTest2Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest2Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).startCollecting();
     }
 
@@ -140,10 +140,10 @@ public class PerfettoTracingPerClassStrategyTest {
         doReturn(true).when(mPerfettoHelper).stopCollecting(anyLong(), anyString());
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
-        strategy.testEnd(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(0)).stopCollecting(anyLong(), anyString());
-        strategy.testStart(mDataRecord, mTest3Desc);
+        strategy.testStart(mDataRecord, mTest3Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).stopCollecting(anyLong(), anyString());
         verify(mPerfettoHelper, times(2)).startCollecting();
     }
@@ -157,8 +157,8 @@ public class PerfettoTracingPerClassStrategyTest {
         doReturn(true).when(mPerfettoHelper).stopCollecting(anyLong(), anyString());
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
-        strategy.testEnd(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(0)).stopCollecting(anyLong(), anyString());
         strategy.testRunEnd(mDataRecord, new Result());
         verify(mPerfettoHelper, times(1)).stopCollecting(anyLong(), anyString());
@@ -174,8 +174,8 @@ public class PerfettoTracingPerClassStrategyTest {
         DataRecord dataRecord = spy(new DataRecord());
         // Test run start behavior
         strategy.testRunStart(dataRecord, mRunDesc);
-        strategy.testStart(dataRecord, mTest1Desc);
-        strategy.testEnd(dataRecord, mTest1Desc);
+        strategy.testStart(dataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(dataRecord, mTest1Desc, /* iteration= */ 1);
         verify(dataRecord, times(0)).addStringMetric(anyString(), anyString());
     }
 
@@ -189,8 +189,8 @@ public class PerfettoTracingPerClassStrategyTest {
         DataRecord dataRecord = spy(new DataRecord());
         // Test run start behavior
         strategy.testRunStart(dataRecord, mRunDesc);
-        strategy.testStart(dataRecord, mTest1Desc);
-        strategy.testEnd(dataRecord, mTest1Desc);
+        strategy.testStart(dataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(dataRecord, mTest1Desc, /* iteration= */ 1);
         strategy.testRunEnd(dataRecord, new Result());
         verify(dataRecord, times(1)).addStringMetric(anyString(), anyString());
     }
@@ -205,10 +205,10 @@ public class PerfettoTracingPerClassStrategyTest {
         DataRecord dataRecord = spy(new DataRecord());
         // Test run start behavior
         strategy.testRunStart(dataRecord, mRunDesc);
-        strategy.testStart(dataRecord, mTest1Desc);
-        strategy.testEnd(dataRecord, mTest1Desc);
-        strategy.testStart(dataRecord, mTest3Desc);
-        strategy.testEnd(dataRecord, mTest3Desc);
+        strategy.testStart(dataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(dataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testStart(dataRecord, mTest3Desc, /* iteration= */ 1);
+        strategy.testEnd(dataRecord, mTest3Desc, /* iteration= */ 1);
         verify(dataRecord, times(0)).addStringMetric(anyString(), anyString());
         strategy.testRunEnd(dataRecord, new Result());
         verify(dataRecord, times(2)).addStringMetric(anyString(), anyString());
diff --git a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerRunStrategyTest.java b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerRunStrategyTest.java
index d88c91765..252a7b3f4 100644
--- a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerRunStrategyTest.java
+++ b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerRunStrategyTest.java
@@ -164,11 +164,11 @@ public class PerfettoTracingPerRunStrategyTest {
         doReturn(true).when(mPerfettoHelper).stopCollecting(anyLong(), anyString());
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
-        strategy.testEnd(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(0)).stopCollecting(anyLong(), anyString());
-        strategy.testStart(mDataRecord, mTest2Desc);
-        strategy.testEnd(mDataRecord, mTest2Desc);
+        strategy.testStart(mDataRecord, mTest2Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest2Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(0)).stopCollecting(anyLong(), anyString());
         strategy.testRunEnd(mDataRecord, new Result());
         verify(mPerfettoHelper, times(1)).stopCollecting(anyLong(), anyString());
@@ -185,8 +185,8 @@ public class PerfettoTracingPerRunStrategyTest {
         doReturn(true).when(mPerfettoHelper).stopCollecting(anyLong(), anyString());
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
-        strategy.testEnd(mDataRecord, mRunDesc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mRunDesc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).startCollecting();
         verify(mPerfettoHelper, times(0)).stopCollecting(anyLong(), anyString());
     }
@@ -201,7 +201,7 @@ public class PerfettoTracingPerRunStrategyTest {
         doReturn(false).when(mPerfettoHelper).startCollecting();
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
 
         Failure failureDesc = new Failure(FAKE_TEST_DESCRIPTION, new Exception());
         strategy.testFail(mDataRecord, mTest1Desc, failureDesc);
diff --git a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerTestStrategyTest.java b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerTestStrategyTest.java
index 449e2277d..59b10583c 100644
--- a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerTestStrategyTest.java
+++ b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingPerTestStrategyTest.java
@@ -114,7 +114,7 @@ public class PerfettoTracingPerTestStrategyTest {
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
         verify(mPerfettoHelper, times(0)).startCollecting();
-        strategy.testStart(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).startCollecting();
     }
 
@@ -128,10 +128,10 @@ public class PerfettoTracingPerTestStrategyTest {
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
         verify(mPerfettoHelper, times(0)).startCollecting();
-        strategy.testStart(mDataRecord, mTest1Desc);
-        strategy.testEnd(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).startCollecting();
-        strategy.testStart(mDataRecord, mTest2Desc);
+        strategy.testStart(mDataRecord, mTest2Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(2)).startCollecting();
     }
 
@@ -144,9 +144,9 @@ public class PerfettoTracingPerTestStrategyTest {
         doReturn(true).when(mPerfettoHelper).stopCollecting(anyLong(), anyString());
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).startCollecting();
-        strategy.testEnd(mDataRecord, mTest1Desc);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(1)).stopCollecting(anyLong(), anyString());
         strategy.testRunEnd(mDataRecord, new Result());
         verify(mPerfettoHelper, times(1)).stopCollecting(anyLong(), anyString());
@@ -161,11 +161,11 @@ public class PerfettoTracingPerTestStrategyTest {
         doReturn(true).when(mPerfettoHelper).stopCollecting(anyLong(), anyString());
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
-        strategy.testEnd(mDataRecord, mTest1Desc);
-        strategy.testStart(mDataRecord, mTest2Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testEnd(mDataRecord, mTest1Desc, /* iteration= */ 1);
+        strategy.testStart(mDataRecord, mTest2Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(2)).startCollecting();
-        strategy.testEnd(mDataRecord, mTest2Desc);
+        strategy.testEnd(mDataRecord, mTest2Desc, /* iteration= */ 1);
         verify(mPerfettoHelper, times(2)).stopCollecting(anyLong(), anyString());
         strategy.testRunEnd(mDataRecord, new Result());
         verify(mPerfettoHelper, times(2)).stopCollecting(anyLong(), anyString());
@@ -197,7 +197,7 @@ public class PerfettoTracingPerTestStrategyTest {
         doReturn(false).when(mPerfettoHelper).startCollecting();
         // Test run start behavior
         strategy.testRunStart(mDataRecord, mRunDesc);
-        strategy.testStart(mDataRecord, mTest1Desc);
+        strategy.testStart(mDataRecord, mTest1Desc, /* iteration= */ 1);
 
         Failure failureDesc = new Failure(FAKE_TEST_DESCRIPTION, new Exception());
         strategy.testFail(mDataRecord, mTest1Desc, failureDesc);
diff --git a/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingStrategyTest.java b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingStrategyTest.java
new file mode 100644
index 000000000..ce6028ab5
--- /dev/null
+++ b/libraries/device-collectors/src/test/java/android/device/collectors/PerfettoTracingStrategyTest.java
@@ -0,0 +1,204 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.device.collectors;
+
+import static android.device.collectors.PerfettoTracingStrategy.ARGUMENT_ALLOW_ITERATIONS;
+import static android.device.collectors.PerfettoTracingStrategy.ARGUMENT_FILE_PATH_KEY_PREFIX;
+import static android.device.collectors.PerfettoTracingStrategy.STRATEGY_ARGUMENT_NAMESPACE_SEPARATOR;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertThrows;
+import static org.junit.Assert.assertTrue;
+import static org.mockito.ArgumentMatchers.any;
+import static org.mockito.Mockito.doAnswer;
+
+import android.annotation.SuppressLint;
+import android.app.Instrumentation;
+import android.os.Bundle;
+import android.os.PowerManager;
+
+import androidx.test.runner.AndroidJUnit4;
+
+import com.android.helpers.PerfettoHelper;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.Mock;
+import org.mockito.MockitoAnnotations;
+import org.mockito.Spy;
+
+import java.util.function.Supplier;
+
+/**
+ * Android Unit tests for {@link PerfettoTracingStrategy}.
+ *
+ * <p>To run: atest
+ * CollectorDeviceLibTest:android.device.collectors.PerfettoTracingStrategyTest
+ */
+@RunWith(AndroidJUnit4.class)
+public class PerfettoTracingStrategyTest {
+
+    private static final String TEST_STRATEGY_IDENTIFIER = "test_strategy";
+
+    @Spy
+    private PerfettoHelper mPerfettoHelper;
+    @Mock
+    private Instrumentation mInstrumentation;
+
+    @Mock
+    private PerfettoTracingStrategy.WakeLockContext mWakeLockContext;
+    @Mock
+    private PerfettoTracingStrategy.WakeLockAcquirer mWakelLockAcquirer;
+    @Mock
+    private PerfettoTracingStrategy.WakeLockReleaser mWakeLockReleaser;
+
+    @Before
+    public void setUp() {
+        MockitoAnnotations.initMocks(this);
+        doAnswer(
+                invocation -> {
+                    Runnable runnable = invocation.getArgument(0);
+                    runnable.run();
+                    return null;
+                })
+                .when(mWakeLockContext)
+                .run(any());
+    }
+
+    @SuppressLint("VisibleForTests")
+    private TestPerfettoTracingStrategy initStrategy(Bundle b) {
+        TestPerfettoTracingStrategy strategy =
+                new TestPerfettoTracingStrategy(mPerfettoHelper,
+                        mInstrumentation,
+                        mWakeLockContext,
+                        () -> null,
+                        mWakelLockAcquirer,
+                        mWakeLockReleaser
+                );
+        strategy.setup(b);
+        return strategy;
+    }
+
+    @Test
+    public void testGetParameter_noArgumentPassed_returnsDefaultValue() {
+        Bundle b = new Bundle();
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertEquals(strategy.getDefaultFilePathKeyPrefix(), strategy.getFilePathKeyPrefix());
+    }
+
+    @Test
+    public void testGetParameter_globalArgumentPassed_returnsProvidedValue() {
+        Bundle b = new Bundle();
+        b.putString(ARGUMENT_FILE_PATH_KEY_PREFIX, "overridden_file_path_key");
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertEquals("overridden_file_path_key", strategy.getFilePathKeyPrefix());
+    }
+
+    @Test
+    public void testGetParameter_strategySpecificArgumentPassed_returnsProvidedValue() {
+        Bundle b = new Bundle();
+        b.putString(TEST_STRATEGY_IDENTIFIER + STRATEGY_ARGUMENT_NAMESPACE_SEPARATOR
+                + ARGUMENT_FILE_PATH_KEY_PREFIX, "overridden_file_path_key");
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertEquals("overridden_file_path_key", strategy.getFilePathKeyPrefix());
+    }
+
+    @Test
+    public void testGetParameter_otherStrategySpecificArgumentPassed_returnsDefaultValue() {
+        Bundle b = new Bundle();
+        b.putString("some_other_strategy_identifier" + STRATEGY_ARGUMENT_NAMESPACE_SEPARATOR
+                + ARGUMENT_FILE_PATH_KEY_PREFIX, "overridden_file_path_key");
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertEquals(strategy.getDefaultFilePathKeyPrefix(), strategy.getFilePathKeyPrefix());
+    }
+
+    @Test
+    public void testNoIterationArgumentPassed_doesNotSkipMetrics() {
+        Bundle b = new Bundle();
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertFalse(strategy.skipMetric(/* iteration= */ 1));
+        assertFalse(strategy.skipMetric(/* iteration= */ 2));
+        assertFalse(strategy.skipMetric(/* iteration= */ 100));
+    }
+
+    @Test
+    public void testAllowIterationArgumentPassedWithOneIteration_skipMetricForOtherIterations() {
+        Bundle b = new Bundle();
+        b.putString(ARGUMENT_ALLOW_ITERATIONS, "42");
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertFalse(strategy.skipMetric(/* iteration= */ 42));
+        assertTrue(strategy.skipMetric(/* iteration= */ 1));
+        assertTrue(strategy.skipMetric(/* iteration= */ 2));
+        assertTrue(strategy.skipMetric(/* iteration= */ 100));
+    }
+
+    @Test
+    public void testAllowIterationArgumentPassedWithMultipleIterations_skipMetricForOthers() {
+        Bundle b = new Bundle();
+        b.putString(ARGUMENT_ALLOW_ITERATIONS, "1,2,3");
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertFalse(strategy.skipMetric(/* iteration= */ 1));
+        assertFalse(strategy.skipMetric(/* iteration= */ 2));
+        assertFalse(strategy.skipMetric(/* iteration= */ 3));
+        assertTrue(strategy.skipMetric(/* iteration= */ 4));
+    }
+
+    @Test
+    public void testCallSkipMetricForNotExecutedTest_throwException() {
+        Bundle b = new Bundle();
+        b.putString(ARGUMENT_ALLOW_ITERATIONS, "1");
+        TestPerfettoTracingStrategy strategy = initStrategy(b);
+
+        assertThrows(IllegalStateException.class, () -> strategy.skipMetric(/* iteration= */ 0));
+    }
+
+    private static class TestPerfettoTracingStrategy extends PerfettoTracingStrategy {
+
+        @SuppressLint("VisibleForTests")
+        TestPerfettoTracingStrategy(PerfettoHelper helper, Instrumentation instr,
+                WakeLockContext wakeLockContext,
+                Supplier<PowerManager.WakeLock> wakelockSupplier,
+                WakeLockAcquirer wakeLockAcquirer, WakeLockReleaser wakeLockReleaser) {
+            super(helper, instr, TEST_STRATEGY_IDENTIFIER, wakeLockContext, wakelockSupplier,
+                    wakeLockAcquirer,
+                    wakeLockReleaser);
+        }
+
+        @Override
+        public String getFilePathKeyPrefix() {
+            return super.getFilePathKeyPrefix();
+        }
+
+        @Override
+        public boolean skipMetric(Integer iteration) {
+            return super.skipMetric(iteration);
+        }
+
+        public String getDefaultFilePathKeyPrefix() {
+            return DEFAULT_FILE_PATH_KEY_PREFIX;
+        }
+    }
+}
diff --git a/libraries/device-collectors/src/test/java/android/device/collectors/ScreenshotOnFailureCollectorTest.java b/libraries/device-collectors/src/test/java/android/device/collectors/ScreenshotOnFailureCollectorTest.java
index 9d0c323ee..79d2981a2 100644
--- a/libraries/device-collectors/src/test/java/android/device/collectors/ScreenshotOnFailureCollectorTest.java
+++ b/libraries/device-collectors/src/test/java/android/device/collectors/ScreenshotOnFailureCollectorTest.java
@@ -31,15 +31,16 @@ import static org.mockito.Mockito.verify;
 import android.app.Instrumentation;
 import android.device.collectors.util.SendToInstrumentation;
 import android.os.Bundle;
+
 import androidx.test.runner.AndroidJUnit4;
 
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
 import org.junit.runner.Description;
-import org.junit.runner.notification.Failure;
 import org.junit.runner.Result;
 import org.junit.runner.RunWith;
+import org.junit.runner.notification.Failure;
 import org.mockito.ArgumentCaptor;
 import org.mockito.InOrder;
 import org.mockito.Mock;
@@ -78,7 +79,7 @@ public class ScreenshotOnFailureCollectorTest {
         mPngLogFile = new File("unique_png_log_file.log");
         mUixLogFile = new File("unique_uix_log_file.log");
         mRunDesc = Description.createSuiteDescription("run");
-        mTestDesc = Description.createTestDescription("run", "test");
+        mTestDesc = Description.createTestDescription("run", "test$1");
     }
 
     @After
@@ -240,10 +241,12 @@ public class ScreenshotOnFailureCollectorTest {
         // The first saved screenshot should not have an iteration number.
         screenshotSaveVerifier.verify(mListener).takeScreenshot(matches("^.*[^1].png$"));
         // The second and later saved screenshots should contain the iteration number.
+        // The iteraion number must be preceded by an underscore '_' instead of '$'
         for (int i = 1; i < NUM_TEST_CASE; i++) {
             screenshotSaveVerifier
                     .verify(mListener)
-                    .takeScreenshot(endsWith(String.format("%d-screenshot-on-failure.png", i + 1)));
+                    .takeScreenshot(
+                            endsWith(String.format("_1-%d-screenshot-on-failure.png", i + 1)));
         }
 
         // Verifies that XMLs are saved with iterations that start with 1.
diff --git a/libraries/device-collectors/src/test/java/android/device/preparers/GarbageCollectionPreparerTest.java b/libraries/device-collectors/src/test/java/android/device/preparers/GarbageCollectionPreparerTest.java
index ee9097a17..4d66e9910 100644
--- a/libraries/device-collectors/src/test/java/android/device/preparers/GarbageCollectionPreparerTest.java
+++ b/libraries/device-collectors/src/test/java/android/device/preparers/GarbageCollectionPreparerTest.java
@@ -23,7 +23,7 @@ import static android.device.preparers.GarbageCollectionPreparer.PROCESS_SEPARAT
 
 import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
-import static org.mockito.Mockito.verifyZeroInteractions;
+import static org.mockito.Mockito.verifyNoMoreInteractions;
 
 import android.app.Instrumentation;
 import android.os.Bundle;
@@ -78,7 +78,7 @@ public class GarbageCollectionPreparerTest {
         mPreparer.testStarted(mRunDesc);
         mPreparer.testFinished(mRunDesc);
 
-        verifyZeroInteractions(mGcHelper);
+        verifyNoMoreInteractions(mGcHelper);
     }
 
     @Test
diff --git a/libraries/flag-helpers/OWNERS b/libraries/flag-helpers/OWNERS
index 46390ad58..be6252e37 100644
--- a/libraries/flag-helpers/OWNERS
+++ b/libraries/flag-helpers/OWNERS
@@ -1,7 +1,7 @@
 wenshan@google.com
 
-per-file *SetFlagsRule* = wenshan@google.com, opg@google.com, tedbauer@google.com, zhidou@google.com
-per-file junit/test/src/android/platform/test/flag/junit/Flags.java = wenshan@google.com, opg@google.com, tedbauer@google.com, zhidou@google.com
-per-file junit/test/src/android/platform/test/flag/junit/FeatureFlags.java = wenshan@google.com, opg@google.com, tedbauer@google.com, zhidou@google.com
-per-file junit/test/src/android/platform/test/flag/junit/FakeFeatureFlagsImpl.java = wenshan@google.com, opg@google.com, tedbauer@google.com, zhidou@google.com
-per-file junit/test/src/android/platform/test/flag/junit/CustomFeatureFlags.java = wenshan@google.com, opg@google.com, tedbauer@google.com, zhidou@google.com
+per-file *SetFlagsRule* = wenshan@google.com, opg@google.com, zhidou@google.com
+per-file junit/test/src/android/platform/test/flag/junit/Flags.java = wenshan@google.com, opg@google.com, zhidou@google.com
+per-file junit/test/src/android/platform/test/flag/junit/FeatureFlags.java = wenshan@google.com, opg@google.com, zhidou@google.com
+per-file junit/test/src/android/platform/test/flag/junit/FakeFeatureFlagsImpl.java = wenshan@google.com, opg@google.com, zhidou@google.com
+per-file junit/test/src/android/platform/test/flag/junit/CustomFeatureFlags.java = wenshan@google.com, opg@google.com, zhidou@google.com
diff --git a/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/AnnotationsRetriever.java b/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/AnnotationsRetriever.java
index 84ebc7dc9..03e1fec1d 100644
--- a/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/AnnotationsRetriever.java
+++ b/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/AnnotationsRetriever.java
@@ -305,7 +305,7 @@ public class AnnotationsRetriever {
         @Nonnull
         Set<String> getFlagsSet(T annotation) {
             String[] flags = getFlags(annotation);
-            return flags == null ? Set.of() : Set.of(flags);
+            return flags == null ? Set.of() : new HashSet<>(List.of(flags));
         }
     }
 
diff --git a/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/SetFlagsRule.java b/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/SetFlagsRule.java
index 38fcbb55f..d652c13d3 100644
--- a/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/SetFlagsRule.java
+++ b/libraries/flag-helpers/junit/src_base/android/platform/test/flag/junit/SetFlagsRule.java
@@ -52,6 +52,7 @@ public final class SetFlagsRule implements TestRule {
     private static final String FLAG_CONSTANT_PREFIX = "FLAG_";
     private static final String SET_FLAG_METHOD_NAME = "setFlag";
     private static final String RESET_ALL_METHOD_NAME = "resetAll";
+    private static final String IS_FLAG_FINALIZED_METHOD_NAME = "isFlagFinalized";
     private static final String IS_FLAG_READ_ONLY_OPTIMIZED_METHOD_NAME = "isFlagReadOnlyOptimized";
 
     // Store instances for entire life of a SetFlagsRule instance
@@ -147,7 +148,6 @@ public final class SetFlagsRule implements TestRule {
      *
      * @param fullFlagNames The name of the flags in the flag class with the format
      *     {packageName}.{flagName}
-     *
      * @deprecated Annotate your test or class with <code>@EnableFlags(String...)</code> instead
      */
     @Deprecated
@@ -168,7 +168,6 @@ public final class SetFlagsRule implements TestRule {
      *
      * @param fullFlagNames The name of the flags in the flag class with the format
      *     {packageName}.{flagName}
-     *
      * @deprecated Annotate your test or class with <code>@DisableFlags(String...)</code> instead
      */
     @Deprecated
@@ -337,7 +336,8 @@ public final class SetFlagsRule implements TestRule {
         // TODO(b/337449119): SetFlagsRule should still run tests that are consistent with the
         // read-only values of flags. But be careful, if a ClassRule exists, the value returned by
         // the original FeatureFlags instance may be overridden, and reading it may not be allowed.
-        boolean isOptimized = verifyFlagReadOnlyAndOptimized(fakeFlagsImplInstance, flag);
+        boolean isOptimized =
+                verifyFlag(fakeFlagsImplInstance, flag, IS_FLAG_READ_ONLY_OPTIMIZED_METHOD_NAME);
         assumeFalse(
                 String.format(
                         "Flag %s is read_only, and the code is optimized. "
@@ -346,6 +346,16 @@ public final class SetFlagsRule implements TestRule {
                         flag.fullFlagName()),
                 isOptimized);
 
+        boolean isFinalized =
+                verifyFlag(fakeFlagsImplInstance, flag, IS_FLAG_FINALIZED_METHOD_NAME);
+        assumeFalse(
+                String.format(
+                        "Flag %s is finalized on this device. "
+                                + " The flag value should not be turned off on this device"
+                                + " Skip this test.",
+                        flag.fullFlagName()),
+                isFinalized && !value);
+
         // Set desired flag value in the FakeFeatureFlagsImpl
         setFlagValueInFakeFeatureFlagsImpl(fakeFlagsImplInstance, flag, value);
     }
@@ -443,15 +453,14 @@ public final class SetFlagsRule implements TestRule {
         }
     }
 
-    private static boolean verifyFlagReadOnlyAndOptimized(Object fakeFeatureFlagsImpl, Flag flag) {
+    private static boolean verifyFlag(Object fakeFeatureFlagsImpl, Flag flag, String methodName) {
         String fullFlagName = flag.fullFlagName();
         try {
             boolean result =
                     (Boolean)
                             fakeFeatureFlagsImpl
                                     .getClass()
-                                    .getMethod(
-                                            IS_FLAG_READ_ONLY_OPTIMIZED_METHOD_NAME, String.class)
+                                    .getMethod(methodName, String.class)
                                     .invoke(fakeFeatureFlagsImpl, fullFlagName);
             return result;
         } catch (NoSuchMethodException e) {
@@ -466,9 +475,9 @@ public final class SetFlagsRule implements TestRule {
             throw new FlagSetException(
                     fullFlagName,
                     String.format(
-                            "Cannot check whether flag is optimized. "
+                            "Cannot invoke %s. "
                                     + "Flag implementation %s is not fake implementation",
-                            fakeFeatureFlagsImpl.getClass().getName()),
+                            methodName, fakeFeatureFlagsImpl.getClass().getName()),
                     e);
         } catch (ReflectiveOperationException e) {
             throw new FlagSetException(fullFlagName, e);
diff --git a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/CustomFeatureFlags.java b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/CustomFeatureFlags.java
index 38b4b8056..17aaec88f 100644
--- a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/CustomFeatureFlags.java
+++ b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/CustomFeatureFlags.java
@@ -17,8 +17,10 @@
 package android.platform.test.flag.junit;
 
 import java.util.Arrays;
+import java.util.HashMap;
 import java.util.HashSet;
 import java.util.List;
+import java.util.Map;
 import java.util.Set;
 import java.util.function.BiPredicate;
 import java.util.function.Predicate;
@@ -58,21 +60,30 @@ public class CustomFeatureFlags implements FeatureFlags {
 
     public List<String> getFlagNames() {
         return Arrays.asList(
-            Flags.FLAG_FLAG_NAME3,
-            Flags.FLAG_FLAG_NAME4,
-            Flags.FLAG_RO_ENABLED,
-            Flags.FLAG_RO_DISABLED
-        );
+                Flags.FLAG_FLAG_NAME3,
+                Flags.FLAG_FLAG_NAME4,
+                Flags.FLAG_RO_ENABLED,
+                Flags.FLAG_RO_DISABLED,
+                Flags.FLAG_FLAG_FINALIZED);
     }
 
     public boolean isFlagReadOnlyOptimized(String flagName) {
         return mReadOnlyFlagSet.contains(flagName);
     }
 
-    private Set<String> mReadOnlyFlagSet = new HashSet<>(
-        Arrays.asList(
-            Flags.FLAG_RO_ENABLED,
-            Flags.FLAG_RO_DISABLED,
-            "")
-        );
+    private Set<String> mReadOnlyFlagSet =
+            new HashSet<>(Arrays.asList(Flags.FLAG_RO_ENABLED, Flags.FLAG_RO_DISABLED, ""));
+
+    private Map<String, Integer> mFinalizedFlags =
+            new HashMap<>(
+                    Map.ofEntries(
+                            Map.entry(Flags.FLAG_FLAG_FINALIZED, 36),
+                            Map.entry("", Integer.MAX_VALUE)));
+
+    public boolean isFlagFinalized(String flagName) {
+        if (!mFinalizedFlags.containsKey(flagName)) {
+            return false;
+        }
+        return 99 >= mFinalizedFlags.get(flagName);
+    }
 }
diff --git a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/DeviceFlagsValueProviderTest.java b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/DeviceFlagsValueProviderTest.java
index 4ac149b95..70a11bf1e 100644
--- a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/DeviceFlagsValueProviderTest.java
+++ b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/DeviceFlagsValueProviderTest.java
@@ -56,11 +56,6 @@ public final class DeviceFlagsValueProviderTest {
                 () -> mFlagsValueProvider.getBoolean("android.platfrm.test.flag.junit.flag1"));
     }
 
-    @Test
-    public void getBoolean_validFlag() throws Exception {
-        assertTrue(mFlagsValueProvider.getBoolean("android.platform.test.flag.junit.flag_name_1"));
-    }
-
     @Test
     public void getBoolean_notBooleanFlag_throwException() {
         assertThrows(
diff --git a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/Flags.java b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/Flags.java
index 6c0c886ef..74f4a5246 100644
--- a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/Flags.java
+++ b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/Flags.java
@@ -23,6 +23,8 @@ public class Flags {
     public static final String FLAG_FLAG_NAME4 = "android.platform.test.flag.junit.flag_name4";
     public static final String FLAG_RO_ENABLED = "android.platform.test.flag.junit.ro_enabled";
     public static final String FLAG_RO_DISABLED = "android.platform.test.flag.junit.ro_disabled";
+    public static final String FLAG_FLAG_FINALIZED =
+            "android.platform.test.flag.junit.flag_finalized";
 
     /** Returns the flag value. */
     public static boolean flagName3() {
diff --git a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/SetFlagsRuleTest.java b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/SetFlagsRuleTest.java
index 8c7117983..fe0a32304 100644
--- a/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/SetFlagsRuleTest.java
+++ b/libraries/flag-helpers/junit/test/src/android/platform/test/flag/junit/SetFlagsRuleTest.java
@@ -43,9 +43,11 @@ public final class SetFlagsRuleTest {
 
     public SetFlagsRuleTest(boolean isInitWithDefault) {
         this.mIsInitWithDefault = isInitWithDefault;
-        mSetFlagsRule = new SetFlagsRule(isInitWithDefault
-                ? SetFlagsRule.DefaultInitValueType.DEVICE_DEFAULT
-                : SetFlagsRule.DefaultInitValueType.NULL_DEFAULT);
+        mSetFlagsRule =
+                new SetFlagsRule(
+                        isInitWithDefault
+                                ? SetFlagsRule.DefaultInitValueType.DEVICE_DEFAULT
+                                : SetFlagsRule.DefaultInitValueType.NULL_DEFAULT);
     }
 
     @Test
@@ -125,4 +127,13 @@ public final class SetFlagsRuleTest {
                     mSetFlagsRule.disableFlags(Flags.FLAG_RO_DISABLED);
                 });
     }
+
+    @Test
+    public void skipFinalizedFlag() {
+        assertThrows(
+                AssumptionViolatedException.class,
+                () -> {
+                    mSetFlagsRule.disableFlags(Flags.FLAG_FLAG_FINALIZED);
+                });
+    }
 }
diff --git a/libraries/flicker/collector/src/android/tools/collectors/DefaultUITraceListener.java b/libraries/flicker/collector/src/android/tools/collectors/DefaultUITraceListener.java
index 07cf65ad8..ec0412b25 100644
--- a/libraries/flicker/collector/src/android/tools/collectors/DefaultUITraceListener.java
+++ b/libraries/flicker/collector/src/android/tools/collectors/DefaultUITraceListener.java
@@ -27,6 +27,7 @@ import androidx.test.platform.app.InstrumentationRegistry;
 
 import java.io.IOException;
 import java.io.InputStream;
+import java.util.List;
 
 /**
  * A {@link PerfettoListener} that captures the perfetto trace for UI traces during each test method
@@ -48,8 +49,8 @@ public class DefaultUITraceListener extends PerfettoListener {
      * for testing.
      */
     @VisibleForTesting
-    DefaultUITraceListener(Bundle args, PerfettoTracingStrategy strategy) {
-        super(args, strategy);
+    DefaultUITraceListener(Bundle args, List<PerfettoTracingStrategy> strategies) {
+        super(args, strategies);
     }
 
     @Override
diff --git a/libraries/flicker/collector/test/src/android/tools/collectors/DefaultUITraceListenerTest.java b/libraries/flicker/collector/test/src/android/tools/collectors/DefaultUITraceListenerTest.java
index f57d2683f..e122ea8bd 100644
--- a/libraries/flicker/collector/test/src/android/tools/collectors/DefaultUITraceListenerTest.java
+++ b/libraries/flicker/collector/test/src/android/tools/collectors/DefaultUITraceListenerTest.java
@@ -27,6 +27,7 @@ import static org.mockito.Mockito.verify;
 import android.app.Instrumentation;
 import android.device.collectors.DataRecord;
 import android.device.collectors.PerfettoListener;
+import android.device.collectors.PerfettoTracingBeforeAfterTestStrategy;
 import android.device.collectors.PerfettoTracingPerClassStrategy;
 import android.device.collectors.PerfettoTracingPerRunStrategy;
 import android.device.collectors.PerfettoTracingPerTestStrategy;
@@ -48,6 +49,8 @@ import org.mockito.MockitoAnnotations;
 import org.mockito.Spy;
 
 import java.io.IOException;
+import java.util.ArrayList;
+import java.util.List;
 
 /**
  * Android Unit tests for {@link DefaultUITraceListener}.
@@ -80,18 +83,26 @@ public class DefaultUITraceListenerTest {
         mTest2Desc = Description.createTestDescription("run2", "test2");
     }
 
-    private PerfettoTracingStrategy initStrategy(Bundle b) {
+    private List<PerfettoTracingStrategy> initStrategies(Bundle b) {
+        final List<PerfettoTracingStrategy> strategies = new ArrayList<>();
         if (Boolean.parseBoolean(b.getString(PerfettoListener.COLLECT_PER_RUN))) {
-            return new PerfettoTracingPerRunStrategy(mPerfettoHelper, mInstrumentation);
+            strategies.add(new PerfettoTracingPerRunStrategy(mPerfettoHelper, mInstrumentation));
         } else if (Boolean.parseBoolean(b.getString(PerfettoListener.COLLECT_PER_CLASS))) {
-            return new PerfettoTracingPerClassStrategy(mPerfettoHelper, mInstrumentation);
+            strategies.add(new PerfettoTracingPerClassStrategy(mPerfettoHelper, mInstrumentation));
+        } else {
+            strategies.add(new PerfettoTracingPerTestStrategy(mPerfettoHelper, mInstrumentation));
         }
 
-        return new PerfettoTracingPerTestStrategy(mPerfettoHelper, mInstrumentation);
+        if (Boolean.parseBoolean(b.getString(PerfettoListener.COLLECT_BEFORE_AFTER))) {
+            strategies.add(new PerfettoTracingBeforeAfterTestStrategy(mPerfettoHelper,
+                    mInstrumentation));
+        }
+
+        return strategies;
     }
 
     private DefaultUITraceListener initListener(Bundle b) {
-        DefaultUITraceListener listener = spy(new DefaultUITraceListener(b, initStrategy(b)));
+        DefaultUITraceListener listener = spy(new DefaultUITraceListener(b, initStrategies(b)));
 
         mDataRecord = new DataRecord();
         listener.setInstrumentation(mInstrumentation);
diff --git a/libraries/flicker/collector/trace_config/trace_config.textproto b/libraries/flicker/collector/trace_config/trace_config.textproto
index 6cd6fa15c..d440604b5 100644
--- a/libraries/flicker/collector/trace_config/trace_config.textproto
+++ b/libraries/flicker/collector/trace_config/trace_config.textproto
@@ -67,6 +67,7 @@ data_sources: {
       mode: MODE_ACTIVE
       trace_flags: TRACE_FLAG_INPUT
       trace_flags: TRACE_FLAG_BUFFERS
+      trace_flags: TRACE_FLAG_VIRTUAL_DISPLAYS
     }
   }
 }
@@ -94,3 +95,20 @@ data_sources: {
     }
   }
 }
+
+data_sources {
+  config {
+    name: "android.protolog"
+    protolog_config {
+      group_overrides {
+        group_name: "WM_ERROR"
+        log_from: PROTOLOG_LEVEL_VERBOSE
+      }
+      group_overrides {
+        group_name: "WM_DEBUG_ANIM"
+        log_from: PROTOLOG_LEVEL_INFO
+      }
+      default_log_from_level: PROTOLOG_LEVEL_DEBUG
+    }
+  }
+}
diff --git a/libraries/flicker/src/android/tools/flicker/FlickerServiceImpl.kt b/libraries/flicker/src/android/tools/flicker/FlickerServiceImpl.kt
index 6c1880f4b..c6ff2f520 100644
--- a/libraries/flicker/src/android/tools/flicker/FlickerServiceImpl.kt
+++ b/libraries/flicker/src/android/tools/flicker/FlickerServiceImpl.kt
@@ -23,6 +23,8 @@ import android.tools.withTracing
 /** Contains the logic for Flicker as a Service. */
 class FlickerServiceImpl(private val flickerConfig: FlickerConfig) : FlickerService {
     override fun detectScenarios(reader: Reader): Collection<ScenarioInstance> {
+        validateTrace(reader)
+
         return withTracing("FlickerService#detectScenarios") {
             flickerConfig.getEntries().flatMap { configEntry ->
                 configEntry.extractor.extract(reader).map { traceSlice ->
@@ -31,4 +33,18 @@ class FlickerServiceImpl(private val flickerConfig: FlickerConfig) : FlickerServ
             }
         }
     }
+
+    private fun validateTrace(reader: Reader) {
+        val layersTrace = reader.readLayersTrace()
+                ?: error("Missing layers trace: Cannot run Flicker Service without this trace!")
+        assert(layersTrace.entries.isNotEmpty()) {
+            "Layers trace is empty! Cannot run Flicker Service on this trace! " +
+                    "This is likely a bug! It shouldn't ever happen."
+        }
+        assert(layersTrace.entries.size > 1) {
+            "Layers trace must have at least only one entry. This is likely due to nothing " +
+                    "happening on the device while the trace is being collected. Please double " +
+                    "check that something is happening while the trace is being collected."
+        }
+    }
 }
diff --git a/libraries/flicker/src/android/tools/flicker/ScenarioInstanceImpl.kt b/libraries/flicker/src/android/tools/flicker/ScenarioInstanceImpl.kt
index 451591bfa..af197f069 100644
--- a/libraries/flicker/src/android/tools/flicker/ScenarioInstanceImpl.kt
+++ b/libraries/flicker/src/android/tools/flicker/ScenarioInstanceImpl.kt
@@ -28,6 +28,8 @@ import android.tools.traces.events.ICujType
 import android.tools.traces.wm.Transition
 import android.tools.withTracing
 
+import java.lang.IllegalStateException
+
 data class ScenarioInstanceImpl
 @JvmOverloads
 constructor(
@@ -82,25 +84,34 @@ constructor(
             reader: Reader,
             config: FlickerConfigEntry,
         ): ScenarioInstanceImpl {
-            val layersTrace = reader.readLayersTrace() ?: error("Missing layers trace")
-            val startTimestamp = traceSlice.startTimestamp
-            val endTimestamp = traceSlice.endTimestamp
+            try {
+                val layersTrace = reader.readLayersTrace() ?: error("Missing layers trace")
+                val startTimestamp = traceSlice.startTimestamp
+                val endTimestamp = traceSlice.endTimestamp
 
-            val displayAtStart =
-                Utils.getOnDisplayFor(layersTrace.getFirstEntryWithOnDisplayAfter(startTimestamp))
-            val displayAtEnd =
-                Utils.getOnDisplayFor(layersTrace.getLastEntryWithOnDisplayBefore(endTimestamp))
+                val displayAtStart =
+                    Utils.getOnDisplayFor(
+                        layersTrace.getFirstEntryWithOnDisplayAfter(startTimestamp))
+                val displayAtEnd =
+                    Utils.getOnDisplayFor(layersTrace.getLastEntryWithOnDisplayBefore(endTimestamp))
 
-            return ScenarioInstanceImpl(
-                config,
-                startRotation = displayAtStart.transform.getRotation(),
-                endRotation = displayAtEnd.transform.getRotation(),
-                startTimestamp = startTimestamp,
-                endTimestamp = endTimestamp,
-                associatedCuj = traceSlice.associatedCuj,
-                associatedTransition = traceSlice.associatedTransition,
-                reader = reader.slice(startTimestamp, endTimestamp),
-            )
+                return ScenarioInstanceImpl(
+                    config,
+                    startRotation = displayAtStart.transform.getRotation(),
+                    endRotation = displayAtEnd.transform.getRotation(),
+                    startTimestamp = startTimestamp,
+                    endTimestamp = endTimestamp,
+                    associatedCuj = traceSlice.associatedCuj,
+                    associatedTransition = traceSlice.associatedTransition,
+                    reader = reader.slice(startTimestamp, endTimestamp),
+                )
+            } catch (e: Exception) {
+                throw IllegalStateException(
+                    "Failed to create scenario (${config.scenarioId.name}) instance from slice: "
+                        + traceSlice,
+                    e,
+                )
+            }
         }
     }
 }
diff --git a/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppWindowHasDesktopModeInitialBoundsAtTheEnd.kt b/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppWindowHasDesktopModeInitialBoundsAtTheEnd.kt
index 3be9b2af2..59f4aef45 100644
--- a/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppWindowHasDesktopModeInitialBoundsAtTheEnd.kt
+++ b/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppWindowHasDesktopModeInitialBoundsAtTheEnd.kt
@@ -32,7 +32,7 @@ class AppWindowHasDesktopModeInitialBoundsAtTheEnd(private val component: Compon
         flicker.assertLayersEnd {
             val displayBounds =
                 entry.physicalDisplayBounds ?: error("Missing physical display bounds")
-            val stableBounds = WindowUtils.getInsetDisplayBounds(scenarioInstance.startRotation)
+            val stableBounds = WindowUtils.getInsetDisplayBounds(scenarioInstance.endRotation)
             val desktopModeInitialBoundsScale =
                 SystemProperties.getInt("persist.wm.debug.desktop_mode_initial_bounds_scale", 75) /
                     100f
diff --git a/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppWindowIsNeverVisible.kt b/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppWindowIsNeverVisible.kt
new file mode 100644
index 000000000..1f8aa893a
--- /dev/null
+++ b/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppWindowIsNeverVisible.kt
@@ -0,0 +1,35 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.tools.flicker.assertors.assertions
+
+import android.tools.flicker.ScenarioInstance
+import android.tools.flicker.assertions.FlickerTest
+import android.tools.flicker.assertors.ComponentTemplate
+
+/**
+ * Verifies that the [component] window is always invisible. If @param{mustExist}, it will fail when
+ * the component is not found
+ */
+class AppWindowIsNeverVisible(
+    private val component: ComponentTemplate,
+    private val mustExist: Boolean = false,
+) : AssertionTemplateWithComponent(component) {
+    /** {@inheritDoc} */
+    override fun doEvaluate(scenarioInstance: ScenarioInstance, flicker: FlickerTest) {
+        flicker.assertWm { this.isAppWindowInvisible(component.get(scenarioInstance), mustExist) }
+    }
+}
diff --git a/libraries/flicker/src/android/tools/flicker/assertors/assertions/BackgroundShowsInTransition.kt b/libraries/flicker/src/android/tools/flicker/assertors/assertions/BackgroundShowsInTransition.kt
new file mode 100644
index 000000000..059ed79ce
--- /dev/null
+++ b/libraries/flicker/src/android/tools/flicker/assertors/assertions/BackgroundShowsInTransition.kt
@@ -0,0 +1,73 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.tools.flicker.assertors.assertions
+
+import android.graphics.Region
+import android.tools.flicker.ScenarioInstance
+import android.tools.flicker.assertions.FlickerTest
+import android.tools.flicker.assertors.AssertionTemplate
+import android.tools.flicker.assertors.ComponentTemplate
+import android.tools.flicker.subject.layers.LayersTraceSubject
+import android.tools.traces.component.ComponentNameMatcher
+import android.tools.traces.component.IComponentMatcher
+import android.tools.traces.surfaceflinger.Layer
+
+/**
+ * Checks that:
+ * - The background layer becomes visible during the scenario and becomes invisible again by its end
+ * - The background layer has a color and covers the same region the closing layers are covering at
+ *   the start of the trace
+ */
+class BackgroundShowsInTransition(val startingChanges: ComponentTemplate) : AssertionTemplate() {
+    val animationBackgroundMatcher = ComponentNameMatcher("", "animation-background")
+
+    /** {@inheritDoc} */
+    override fun doEvaluate(scenarioInstance: ScenarioInstance, flicker: FlickerTest) {
+        val firstTraceEntry = scenarioInstance.reader.readLayersTrace()?.entries?.first()
+        val visibleLayers =
+            startingChanges
+                .get(scenarioInstance)
+                .filterLayers(
+                    firstTraceEntry?.visibleLayers
+                        ?: error("No visible layers have been found in $startingChanges")
+                )
+
+        flicker.assertLayers {
+            isInvisible(animationBackgroundMatcher)
+                .then()
+                .isVisible(animationBackgroundMatcher)
+                .coversAtLeast(animationBackgroundMatcher, transitionRegion(visibleLayers))
+                .hasColor(animationBackgroundMatcher)
+                .then()
+                .isInvisible(animationBackgroundMatcher)
+        }
+    }
+
+    private fun LayersTraceSubject.coversAtLeast(
+        component: IComponentMatcher,
+        expectedArea: Region,
+    ): LayersTraceSubject =
+        invoke("$component coversAtLeast $expectedArea") {
+            it.visibleRegion(component).coversAtLeast(expectedArea)
+        }
+
+    private fun transitionRegion(visibleLayers: Collection<Layer>): Region {
+        return visibleLayers.fold(Region()) { region, layer ->
+            region.apply { union(layer.visibleRegion.bounds) }
+        }
+    }
+}
diff --git a/libraries/flicker/src/android/tools/flicker/assertors/assertions/LayerIsNeverVisible.kt b/libraries/flicker/src/android/tools/flicker/assertors/assertions/LayerIsNeverVisible.kt
new file mode 100644
index 000000000..71fc926a6
--- /dev/null
+++ b/libraries/flicker/src/android/tools/flicker/assertors/assertions/LayerIsNeverVisible.kt
@@ -0,0 +1,35 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.tools.flicker.assertors.assertions
+
+import android.tools.flicker.ScenarioInstance
+import android.tools.flicker.assertions.FlickerTest
+import android.tools.flicker.assertors.ComponentTemplate
+
+/**
+ * Checks that the [component] layer is never visible. If @param{mustExist}, it will fail when the
+ * component is not found
+ */
+class LayerIsNeverVisible(
+    private val component: ComponentTemplate,
+    private val mustExist: Boolean = false,
+) : AssertionTemplateWithComponent(component) {
+    /** {@inheritDoc} */
+    override fun doEvaluate(scenarioInstance: ScenarioInstance, flicker: FlickerTest) {
+        flicker.assertLayers { this.isInvisible(component.get(scenarioInstance), mustExist) }
+    }
+}
diff --git a/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppLayerIncreasesInSize.kt b/libraries/flicker/src/android/tools/flicker/assertors/assertions/ResizeVeilKeepsIncreasingInSize.kt
similarity index 76%
rename from libraries/flicker/src/android/tools/flicker/assertors/assertions/AppLayerIncreasesInSize.kt
rename to libraries/flicker/src/android/tools/flicker/assertors/assertions/ResizeVeilKeepsIncreasingInSize.kt
index ad6ae97f8..b31588ffd 100644
--- a/libraries/flicker/src/android/tools/flicker/assertors/assertions/AppLayerIncreasesInSize.kt
+++ b/libraries/flicker/src/android/tools/flicker/assertors/assertions/ResizeVeilKeepsIncreasingInSize.kt
@@ -20,14 +20,21 @@ import android.tools.flicker.ScenarioInstance
 import android.tools.flicker.assertions.FlickerTest
 import android.tools.flicker.assertors.ComponentTemplate
 
-/** Checks that the visible region of [component] always increases during the animation */
-class AppLayerIncreasesInSize(private val component: ComponentTemplate) :
+/**
+ * Checks that the visible region of the [component]'s resize veil always increases during the
+ * animation
+ */
+class ResizeVeilKeepsIncreasingInSize(private val component: ComponentTemplate) :
     AssertionTemplateWithComponent(component) {
     /** {@inheritDoc} */
     override fun doEvaluate(scenarioInstance: ScenarioInstance, flicker: FlickerTest) {
         val layerMatcher = component.get(scenarioInstance)
         flicker.assertLayers {
-            val layerList = layers { layerMatcher.layerMatchesAnyOf(it) && it.isVisible }
+            val layerList = layers {
+                layerMatcher.layerMatchesAnyOf(it) &&
+                    it.isVisible &&
+                    it.name.contains("Resize veil")
+            }
             layerList.zipWithNext { previous, current ->
                 current.visibleRegion.coversAtLeast(previous.visibleRegion.region)
             }
diff --git a/libraries/flicker/src/android/tools/flicker/config/appclose/Components.kt b/libraries/flicker/src/android/tools/flicker/config/appclose/Components.kt
index 6923a8337..2156ba374 100644
--- a/libraries/flicker/src/android/tools/flicker/config/appclose/Components.kt
+++ b/libraries/flicker/src/android/tools/flicker/config/appclose/Components.kt
@@ -36,6 +36,13 @@ object Components {
             )
         }
 
+    val CLOSING_CHANGES =
+        ComponentTemplate("CLOSING_CHANGE(S)") { scenarioInstance: ScenarioInstance ->
+            closingChanges(
+                scenarioInstance.associatedTransition ?: error("Missing associated transition")
+            )
+        }
+
     private fun closingAppFrom(
         transition: Transition,
         layersTrace: LayersTrace?,
@@ -55,4 +62,17 @@ object Components {
             acc.or(matcher)
         }
     }
+
+    private fun closingChanges(transition: Transition): IComponentMatcher {
+        val changes =
+            transition.changes.filter {
+                it.transitMode == TransitionType.CLOSE || it.transitMode == TransitionType.TO_BACK
+            }
+
+        val matcher = changes.map { FullComponentIdMatcher(it.windowId, it.layerId) }
+
+        return matcher.reduce<IComponentMatcher, IComponentMatcher> { acc, matcher ->
+            acc.or(matcher)
+        }
+    }
 }
diff --git a/libraries/flicker/src/android/tools/flicker/config/applaunch/Components.kt b/libraries/flicker/src/android/tools/flicker/config/applaunch/Components.kt
index 34201dc13..39afc9fa0 100644
--- a/libraries/flicker/src/android/tools/flicker/config/applaunch/Components.kt
+++ b/libraries/flicker/src/android/tools/flicker/config/applaunch/Components.kt
@@ -36,6 +36,13 @@ object Components {
             )
         }
 
+    val OPENING_CHANGES =
+        ComponentTemplate("OPENING_CHANGE(S)") { scenarioInstance: ScenarioInstance ->
+            openingChanges(
+                scenarioInstance.associatedTransition ?: error("Missing associated transition")
+            )
+        }
+
     private fun openingAppFrom(
         transition: Transition,
         layersTrace: LayersTrace?,
@@ -55,4 +62,17 @@ object Components {
             acc.or(matcher)
         }
     }
+
+    private fun openingChanges(transition: Transition): IComponentMatcher {
+        val changes =
+            transition.changes.filter {
+                it.transitMode == TransitionType.OPEN || it.transitMode == TransitionType.TO_FRONT
+            }
+
+        val matcher = changes.map { FullComponentIdMatcher(it.windowId, it.layerId) }
+
+        return matcher.reduce<IComponentMatcher, IComponentMatcher> { acc, matcher ->
+            acc.or(matcher)
+        }
+    }
 }
diff --git a/libraries/flicker/src/android/tools/flicker/config/common/Components.kt b/libraries/flicker/src/android/tools/flicker/config/common/Components.kt
index c66d9390a..cedd023bb 100644
--- a/libraries/flicker/src/android/tools/flicker/config/common/Components.kt
+++ b/libraries/flicker/src/android/tools/flicker/config/common/Components.kt
@@ -23,4 +23,9 @@ object Components {
     val NAV_BAR = ComponentTemplate("Navbar") { ComponentNameMatcher.NAV_BAR }
     val STATUS_BAR = ComponentTemplate("StatusBar") { ComponentNameMatcher.STATUS_BAR }
     val LAUNCHER = ComponentTemplate("Launcher") { ComponentNameMatcher.LAUNCHER }
+    val WALLPAPER =
+        ComponentTemplate("Wallpaper") {
+            ComponentNameMatcher.WALLPAPER_BBQ_WRAPPER
+            ComponentNameMatcher.WALLPAPER_WINDOW_TOKEN
+        }
 }
diff --git a/libraries/flicker/src/android/tools/flicker/config/desktopmode/Components.kt b/libraries/flicker/src/android/tools/flicker/config/desktopmode/Components.kt
index e2b466109..86d53c780 100644
--- a/libraries/flicker/src/android/tools/flicker/config/desktopmode/Components.kt
+++ b/libraries/flicker/src/android/tools/flicker/config/desktopmode/Components.kt
@@ -79,26 +79,35 @@ object Components {
                     associatedTransition.changes.first { it.transitMode == TransitionType.CLOSE }
                 FullComponentIdMatcher(change.windowId, change.layerId)
             }
+            ScenarioId("OPEN_APP_WHEN_EXTERNAL_DISPLAY_CONNECTED"),
             ScenarioId("OPEN_UNLIMITED_APPS"),
             ScenarioId("CASCADE_APP") -> {
                 val change =
                     associatedTransition.changes.first { it.transitMode == TransitionType.OPEN }
                 FullComponentIdMatcher(change.windowId, change.layerId)
             }
-            ScenarioId("MINIMIZE_APP"),
-            ScenarioId("MINIMIZE_LAST_APP") -> {
+            ScenarioId("MINIMIZE_APP") -> {
                 val change =
                     associatedTransition.changes.first { it.transitMode == TransitionType.TO_BACK }
                 FullComponentIdMatcher(change.windowId, change.layerId)
             }
+            ScenarioId("MINIMIZE_LAST_APP") -> {
+                val change =
+                    associatedTransition.changes.last { it.transitMode == TransitionType.TO_BACK }
+                FullComponentIdMatcher(change.windowId, change.layerId)
+            }
             ScenarioId("CORNER_RESIZE"),
             ScenarioId("CORNER_RESIZE_TO_MINIMUM_SIZE"),
             ScenarioId("CORNER_RESIZE_TO_MAXIMUM_SIZE"),
             ScenarioId("EDGE_RESIZE"),
+            ScenarioId("ENTER_DESKTOP_FROM_KEYBOARD_SHORTCUT"),
+            ScenarioId("EXIT_DESKTOP_FROM_KEYBOARD_SHORTCUT"),
             ScenarioId("SNAP_RESIZE_LEFT_WITH_DRAG"),
             ScenarioId("SNAP_RESIZE_RIGHT_WITH_DRAG"),
             ScenarioId("SNAP_RESIZE_LEFT_WITH_BUTTON"),
             ScenarioId("SNAP_RESIZE_RIGHT_WITH_BUTTON"),
+            ScenarioId("SNAP_RESIZE_LEFT_WITH_KEYBOARD"),
+            ScenarioId("SNAP_RESIZE_RIGHT_WITH_KEYBOARD"),
             ScenarioId("MAXIMIZE_APP"),
             ScenarioId("MAXIMIZE_APP_NON_RESIZABLE"),
             ScenarioId("MINIMIZE_AUTO_PIP_APP") -> {
diff --git a/libraries/flicker/src/android/tools/flicker/extractors/TaggedScenarioExtractor.kt b/libraries/flicker/src/android/tools/flicker/extractors/TaggedScenarioExtractor.kt
index a150b46cb..2c14c4e7b 100644
--- a/libraries/flicker/src/android/tools/flicker/extractors/TaggedScenarioExtractor.kt
+++ b/libraries/flicker/src/android/tools/flicker/extractors/TaggedScenarioExtractor.kt
@@ -74,6 +74,12 @@ class TaggedScenarioExtractor(
                 cujEntry.startTimestamp.hasAllTimestamps && cujEntry.endTimestamp.hasAllTimestamps
             )
 
+            Log.d(
+                LOG_TAG,
+                "Estimating start timestamp for $cujEntry " +
+                    "with associated transition: $associatedTransition",
+            )
+
             val startTimestamp =
                 estimateScenarioStartTimestamp(cujEntry, associatedTransition, reader)
             val endTimestamp = estimateScenarioEndTimestamp(cujEntry, associatedTransition, reader)
diff --git a/libraries/flicker/src/android/tools/flicker/extractors/Utils.kt b/libraries/flicker/src/android/tools/flicker/extractors/Utils.kt
index 91512313a..a45671d09 100644
--- a/libraries/flicker/src/android/tools/flicker/extractors/Utils.kt
+++ b/libraries/flicker/src/android/tools/flicker/extractors/Utils.kt
@@ -22,24 +22,45 @@ import android.tools.io.Reader
 import android.tools.traces.surfaceflinger.Display
 import android.tools.traces.surfaceflinger.LayerTraceEntry
 import android.tools.traces.wm.Transition
+import android.util.Log
 import kotlin.math.abs
 
 object Utils {
+    const val LOG_TAG = "FlickerExtractorUtils"
+
     fun interpolateStartTimestampFromTransition(transition: Transition, reader: Reader): Timestamp {
         val wmTrace = reader.readWmTrace() ?: error("Missing WM trace")
         val layersTrace = reader.readLayersTrace() ?: error("Missing layers trace")
         val transactionsTrace =
             reader.readTransactionsTrace() ?: error("Missing transactions trace")
 
-        val lastWmEntryBeforeTransitionCreated = wmTrace.getEntryAt(transition.createTime)
-        val elapsedNanos = lastWmEntryBeforeTransitionCreated.timestamp.elapsedNanos
-        val unixNanos = lastWmEntryBeforeTransitionCreated.timestamp.unixNanos
+        val lastWmEntryBeforeTransitionWasSentToShell = try {
+            wmTrace.getEntryAt(transition.sendTime)
+        } catch (e: Exception) {
+            throw RuntimeException(
+                "Failed to get last WM entry before transition was sent to shell: $transition", e)
+        }
+        val elapsedNanos = lastWmEntryBeforeTransitionWasSentToShell.timestamp.elapsedNanos
+        val unixNanos = lastWmEntryBeforeTransitionWasSentToShell.timestamp.unixNanos
+
+        assert(elapsedNanos != 0L) {
+            "lastWmEntryBeforeTransitionWasSentToShell.timestamp.elapsedNanos is 0"
+        }
+        assert(unixNanos != 0L) {
+            "lastWmEntryBeforeTransitionWasSentToShell.timestamp.unixNanos is 0"
+        }
 
         val startTransactionAppliedTimestamp =
             transition.getStartTransaction(transactionsTrace)?.let {
                 layersTrace.getEntryForTransaction(it).timestamp
             }
 
+        if (startTransactionAppliedTimestamp != null) {
+            require(startTransactionAppliedTimestamp.systemUptimeNanos != 0L) {
+                "Start transaction applied timestamp is missing system uptime"
+            }
+        }
+
         // If we don't have a startTransactionAppliedTimestamp it's likely because the start
         // transaction was merged into another transaction so we can't match the id, so we need to
         // fallback on the send time reported on the WM side.
@@ -47,7 +68,17 @@ object Utils {
             startTransactionAppliedTimestamp?.systemUptimeNanos
                 ?: transition.createTime.systemUptimeNanos
 
-        // This fallback doesn't really work because then systemUptimeNanos is 0...
+        require(systemUptimeNanos != 0L) {
+            "Both startTransactionAppliedTimestamp and transition's create time are missing " +
+                "system uptime: $startTransactionAppliedTimestamp and $transition"
+        }
+
+        Log.d(
+            LOG_TAG,
+            "Interpolated start timestamp for $transition to: " +
+                "elapsed $elapsedNanos, uptime $systemUptimeNanos, unix $unixNanos",
+        )
+
         return Timestamps.from(elapsedNanos, systemUptimeNanos, unixNanos)
     }
 
@@ -119,6 +150,11 @@ object Utils {
                 layersTrace.getEntryAt(finishTransactionAppliedTimestamp).timestamp.unixNanos
         }
 
+        Log.d(
+            LOG_TAG,
+            "Interpolated finish timestamp for $transition to: " +
+                "elapsed $elapsedNanos, uptime $systemUptimeNanos, unix $unixNanos",
+        )
         return Timestamps.from(elapsedNanos, systemUptimeNanos, unixNanos)
     }
 
diff --git a/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceDecorator.kt b/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceDecorator.kt
index 22ad87f36..444685d8b 100644
--- a/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceDecorator.kt
+++ b/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceDecorator.kt
@@ -38,9 +38,14 @@ import com.google.common.truth.Truth
 import java.lang.reflect.Method
 import org.junit.After
 import org.junit.Before
+import org.junit.Rule
 import org.junit.Test
+import org.junit.rules.TestRule
 import org.junit.runner.Description
+import org.junit.runner.Description.createTestDescription
+import org.junit.runners.model.FrameworkMember
 import org.junit.runners.model.FrameworkMethod
+import org.junit.runners.model.MemberValueConsumer
 import org.junit.runners.model.Statement
 import org.junit.runners.model.TestClass
 
@@ -59,7 +64,7 @@ class FlickerServiceDecorator(
 
     override fun getChildDescription(method: FrameworkMethod): Description {
         return if (isMethodHandledByDecorator(method)) {
-            Description.createTestDescription(testClass.javaClass, method.name, *method.annotations)
+            createTestDescription(testClass.javaClass, method.name, *method.annotations)
         } else {
             inner?.getChildDescription(method) ?: error("No child descriptor found")
         }
@@ -69,64 +74,133 @@ class FlickerServiceDecorator(
         mutableMapOf<FrameworkMethod, Collection<InjectedTestCase>>()
     private val innerMethodsResults = mutableMapOf<FrameworkMethod, Throwable?>()
 
+    private fun getTestRules(): MutableList<TestRule> {
+        val collector = RuleCollector<TestRule>()
+        val instance = testClass.onlyConstructor.newInstance()
+        testClass.collectAnnotatedMethodValues<TestRule>(
+            instance,
+            Rule::class.java,
+            TestRule::class.java,
+            collector,
+        )
+        testClass.collectAnnotatedFieldValues<TestRule>(
+            instance,
+            Rule::class.java,
+            TestRule::class.java,
+            collector,
+        )
+        return collector.result
+    }
+
+    class RuleCollector<T> internal constructor() : MemberValueConsumer<T> {
+        val result: MutableList<T> = ArrayList()
+
+        override fun accept(member: FrameworkMember<*>, value: T) {
+            this.result.add(value)
+        }
+    }
+
     override fun getTestMethods(test: Any): List<FrameworkMethod> {
         val innerMethods =
             inner?.getTestMethods(test)
                 ?: error("FlickerServiceDecorator requires a non-null inner decorator")
         val testMethods = innerMethods.toMutableList()
 
+        val testRules = getTestRules()
+
+        val ruleContainer = RuleContainer()
+        for (rule in testRules) {
+            ruleContainer.add(rule)
+        }
+
         if (shouldComputeTestMethods()) {
             for (method in innerMethods) {
                 if (!innerMethodsResults.containsKey(method)) {
-                    var methodResult: Throwable? =
-                        null // TODO: Maybe don't use null but wrap in another object
-                    val reader =
-                        captureTrace(testClassName, getDefaultFlickerOutputDir()) { writer ->
-                            try {
-                                Utils.notifyRunnerProgress(
-                                    testClassName,
-                                    "Running setup",
-                                    instrumentation,
-                                )
-                                val befores = testClass.getAnnotatedMethods(Before::class.java)
-                                befores.forEach { it.invokeExplosively(test) }
-
-                                Utils.notifyRunnerProgress(
-                                    testClassName,
-                                    "Running transition",
-                                    instrumentation,
-                                )
-                                writer.setTransitionStartTime(now())
-                                method.invokeExplosively(test)
-                                writer.setTransitionEndTime(now())
-
-                                Utils.notifyRunnerProgress(
-                                    testClassName,
-                                    "Running teardown",
-                                    instrumentation,
-                                )
-                                val afters = testClass.getAnnotatedMethods(After::class.java)
-                                afters.forEach { it.invokeExplosively(test) }
-                            } catch (e: Throwable) {
-                                methodResult = e
-                            } finally {
-                                innerMethodsResults[method] = methodResult
+                    val description = createTestDescription(testClass.javaClass.name, method.name)
+                    val statement =
+                        object : Statement() {
+                            override fun evaluate() {
+                                var methodResult: Throwable? =
+                                    null // TODO: Maybe don't use null but wrap in another object
+                                val reader =
+                                    captureTrace(testClassName, getDefaultFlickerOutputDir()) {
+                                        writer ->
+                                        try {
+                                            Utils.notifyRunnerProgress(
+                                                testClassName,
+                                                "Running setup",
+                                                instrumentation,
+                                            )
+                                            val befores =
+                                                testClass.getAnnotatedMethods(Before::class.java)
+                                            befores.forEach { it.invokeExplosively(test) }
+
+                                            Utils.notifyRunnerProgress(
+                                                testClassName,
+                                                "Running transition",
+                                                instrumentation,
+                                            )
+
+                                            val traceStartTime = now()
+                                            Utils.notifyRunnerProgress(
+                                                testClassName,
+                                                "Setting trace start time to :: $traceStartTime",
+                                                instrumentation,
+                                            )
+
+                                            writer.setTransitionStartTime(traceStartTime)
+                                            method.invokeExplosively(test)
+
+                                            val traceEndTime = now()
+                                            Utils.notifyRunnerProgress(
+                                                testClassName,
+                                                "Setting trace end time to :: $traceEndTime",
+                                                instrumentation,
+                                            )
+                                            writer.setTransitionEndTime(traceEndTime)
+
+                                            Utils.notifyRunnerProgress(
+                                                testClassName,
+                                                "Running teardown",
+                                                instrumentation,
+                                            )
+                                            val afters =
+                                                testClass.getAnnotatedMethods(After::class.java)
+                                            afters.forEach { it.invokeExplosively(test) }
+                                        } catch (e: Throwable) {
+                                            methodResult = e
+                                        } finally {
+                                            innerMethodsResults[method] = methodResult
+                                        }
+                                    }
+                                if (methodResult == null) {
+                                    Utils.notifyRunnerProgress(
+                                        testClassName,
+                                        "Computing Flicker service tests",
+                                        instrumentation,
+                                    )
+                                    try {
+                                        flickerServiceMethodsFor[method] =
+                                            computeFlickerServiceTests(
+                                                reader,
+                                                testClassName,
+                                                method,
+                                            )
+                                    } catch (e: Throwable) {
+                                        // Failed to compute flicker service methods
+                                        innerMethodsResults[method] = e
+                                    }
+                                }
                             }
                         }
-                    if (methodResult == null) {
-                        Utils.notifyRunnerProgress(
-                            testClassName,
-                            "Computing Flicker service tests",
-                            instrumentation,
+                    ruleContainer
+                        .apply(
+                            method,
+                            description,
+                            testClass.onlyConstructor.newInstance(),
+                            statement,
                         )
-                        try {
-                            flickerServiceMethodsFor[method] =
-                                computeFlickerServiceTests(reader, testClassName, method)
-                        } catch (e: Throwable) {
-                            // Failed to compute flicker service methods
-                            innerMethodsResults[method] = e
-                        }
-                    }
+                        .evaluate()
                 }
 
                 if (innerMethodsResults[method] == null) {
diff --git a/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunner.kt b/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunner.kt
index 4409395cb..d24364c5f 100644
--- a/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunner.kt
+++ b/libraries/flicker/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunner.kt
@@ -31,7 +31,6 @@ import org.junit.internal.AssumptionViolatedException
 import org.junit.internal.runners.model.EachTestNotifier
 import org.junit.internal.runners.model.ReflectiveCallable
 import org.junit.internal.runners.statements.Fail
-import org.junit.rules.TestRule
 import org.junit.runner.Description
 import org.junit.runner.manipulation.Filter
 import org.junit.runner.manipulation.InvalidOrderingException
@@ -395,7 +394,6 @@ constructor(
             if (flickerDecorator.shouldRunAfterOn(method)) {
                 statement = withAfters(method, test, statement)
             }
-            statement = withRules(method, test, statement)
         }
 
         statement = withInterruptIsolation(statement)
@@ -406,25 +404,6 @@ constructor(
         return Comparator { o1, o2 -> sorter.compare(describeChild(o1), describeChild(o2)) }
     }
 
-    private fun withRules(method: FrameworkMethod, target: Any, statement: Statement): Statement? {
-        val ruleContainer = RuleContainer()
-        CURRENT_RULE_CONTAINER.set(ruleContainer)
-        try {
-            val testRules = getTestRules(target)
-            for (each in rules(target)) {
-                if (!(each is TestRule && testRules.contains(each))) {
-                    ruleContainer.add(each)
-                }
-            }
-            for (rule in testRules) {
-                ruleContainer.add(rule)
-            }
-        } finally {
-            CURRENT_RULE_CONTAINER.remove()
-        }
-        return ruleContainer.apply(method, describeChild(method), target, statement)
-    }
-
     companion object {
         private const val LOG_TAG = "$FLICKER_TAG-JunitRunner"
         private val CURRENT_RULE_CONTAINER = ThreadLocal<RuleContainer>()
diff --git a/libraries/flicker/src/android/tools/flicker/rules/ArtifactSaverRule.kt b/libraries/flicker/src/android/tools/flicker/rules/ArtifactSaverRule.kt
index cdb33ed5f..c00289abc 100644
--- a/libraries/flicker/src/android/tools/flicker/rules/ArtifactSaverRule.kt
+++ b/libraries/flicker/src/android/tools/flicker/rules/ArtifactSaverRule.kt
@@ -33,13 +33,13 @@ class ArtifactSaverRule : TestWatcher() {
 
         try {
             if (DeviceDumpParser.lastWmTraceData.isNotEmpty()) {
-                val fileName = getClassAndMethodName(description) + "lastWmTraceData.winscope"
+                val fileName = getClassAndMethodName(description) + "lastWmDump.winscope"
                 val file = ArtifactSaver.artifactFile(fileName)
                 file.writeBytes(DeviceDumpParser.lastWmTraceData)
             }
 
             if (DeviceDumpParser.lastLayersTraceData.isNotEmpty()) {
-                val fileName = getClassAndMethodName(description) + "lastLayersTraceData.perfetto"
+                val fileName = getClassAndMethodName(description) + "lastLayersDump.winscope"
                 val file = ArtifactSaver.artifactFile(fileName)
                 file.writeBytes(DeviceDumpParser.lastLayersTraceData)
             }
diff --git a/libraries/flicker/src/android/tools/flicker/subject/layers/ILayerSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/layers/ILayerSubject.kt
index 03c6ed8ea..880d156aa 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/layers/ILayerSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/layers/ILayerSubject.kt
@@ -63,12 +63,18 @@ interface ILayerSubject<LayerSubjectType, RegionSubjectType> {
      */
     fun isVisible(componentMatcher: IComponentMatcher): LayerSubjectType
 
+    /** Manual overload for java compatibility */
+    fun isInvisible(componentMatcher: IComponentMatcher): LayerSubjectType =
+        isInvisible(componentMatcher, false)
+
     /**
-     * Asserts that a [Layer] matching [componentMatcher] doesn't exist or is invisible.
+     * Asserts that a [Layer] matching [componentMatcher] is invisible or doesn't exist (only if
+     * !mustExist).
      *
      * @param componentMatcher Components to search
+     * @param mustExist when set to true, will fail if the component is not found
      */
-    fun isInvisible(componentMatcher: IComponentMatcher): LayerSubjectType
+    fun isInvisible(componentMatcher: IComponentMatcher, mustExist: Boolean): LayerSubjectType
 
     /**
      * Asserts that the entry contains a visible splash screen [Layer] for a [layer] matching
diff --git a/libraries/flicker/src/android/tools/flicker/subject/layers/LayerTraceEntrySubject.kt b/libraries/flicker/src/android/tools/flicker/subject/layers/LayerTraceEntrySubject.kt
index aa83a9a94..6f1cdbd5e 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/layers/LayerTraceEntrySubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/layers/LayerTraceEntrySubject.kt
@@ -194,7 +194,13 @@ constructor(
     }
 
     /** {@inheritDoc} */
-    override fun isInvisible(componentMatcher: IComponentMatcher): LayerTraceEntrySubject = apply {
+    override fun isInvisible(
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean,
+    ): LayerTraceEntrySubject = apply {
+        if (mustExist) {
+            contains(componentMatcher)
+        }
         val layers = subjects.map { it.layer }
         val hasInvisibleComponent =
             componentMatcher.check(layers) { componentLayers ->
diff --git a/libraries/flicker/src/android/tools/flicker/subject/layers/LayersTraceSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/layers/LayersTraceSubject.kt
index 7f37abc64..63e777e47 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/layers/LayersTraceSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/layers/LayersTraceSubject.kt
@@ -24,7 +24,6 @@ import android.tools.flicker.subject.region.RegionTraceSubject
 import android.tools.function.AssertionPredicate
 import android.tools.io.Reader
 import android.tools.traces.component.ComponentNameMatcher
-import android.tools.traces.component.EdgeExtensionComponentMatcher
 import android.tools.traces.component.IComponentMatcher
 import android.tools.traces.component.IComponentNameMatcher
 import android.tools.traces.component.SurfaceViewBackgroundMatcher
@@ -158,16 +157,21 @@ constructor(val trace: LayersTrace, override val reader: Reader? = null) :
         }
 
     /** {@inheritDoc} */
-    override fun isInvisible(componentMatcher: IComponentMatcher): LayersTraceSubject =
-        isInvisible(componentMatcher, isOptional = false)
+    override fun isInvisible(
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean,
+    ): LayersTraceSubject = isInvisible(componentMatcher, mustExist, isOptional = false)
 
     /** See [isInvisible] */
-    fun isInvisible(componentMatcher: IComponentMatcher, isOptional: Boolean): LayersTraceSubject =
-        apply {
-            addAssertion("isInvisible(${componentMatcher.toLayerIdentifier()})", isOptional) {
-                it.isInvisible(componentMatcher)
-            }
+    fun isInvisible(
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean = false,
+        isOptional: Boolean,
+    ): LayersTraceSubject = apply {
+        addAssertion("isInvisible(${componentMatcher.toLayerIdentifier()})", isOptional) {
+            it.isInvisible(componentMatcher, mustExist)
         }
+    }
 
     /** {@inheritDoc} */
     override fun isSplashScreenVisibleFor(
@@ -347,7 +351,6 @@ constructor(val trace: LayersTrace, override val reader: Reader? = null) :
                 ComponentNameMatcher.TRANSITION_SNAPSHOT,
                 ComponentNameMatcher.FLOATING_ROTATION_BUTTON,
                 ComponentNameMatcher.WIRED_CHARGING_ANIMATION,
-                EdgeExtensionComponentMatcher(),
                 SurfaceViewBackgroundMatcher(),
             )
     }
diff --git a/libraries/flicker/src/android/tools/flicker/subject/region/IRegionSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/region/IRegionSubject.kt
index faa26e136..24880d351 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/region/IRegionSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/region/IRegionSubject.kt
@@ -70,6 +70,13 @@ interface IRegionSubject {
      */
     fun isToTheRight(other: Region): IRegionSubject
 
+    /**
+     * Asserts that the left coordinates of [other] are lower or equal to those of region.
+     *
+     * @throws AssertionError
+     */
+    fun isLeftEdgeToTheRight(other: Region): IRegionSubject
+
     /**
      * Asserts that the top and bottom coordinates of [other] are smaller than those of region.
      *
diff --git a/libraries/flicker/src/android/tools/flicker/subject/region/RegionSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/region/RegionSubject.kt
index 80bbe1d16..d7c3c8fee 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/region/RegionSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/region/RegionSubject.kt
@@ -329,6 +329,26 @@ constructor(
         }
     }
 
+    /** {@inheritDoc} */
+    override fun isLeftEdgeToTheRight(other: Region): RegionSubject = apply {
+        val horizontallyPositionedToTheRight = other.bounds.left <= region.bounds.left
+        if (!horizontallyPositionedToTheRight) {
+            val errorMsgBuilder =
+                ExceptionMessageBuilder()
+                    .forSubject(this)
+                    .forIncorrectRegion(
+                        "region. left edge of $region area should be to the right of $other"
+                    )
+                    .setExpected(other)
+                    .setActual(regionEntry.region)
+                    .addExtraDescription(
+                        "Horizontally positioned to the right",
+                        horizontallyPositionedToTheRight,
+                    )
+            throw IncorrectRegionException(errorMsgBuilder)
+        }
+    }
+
     /** {@inheritDoc} */
     override fun regionsCenterPointInside(other: Rect): RegionSubject = apply {
         if (!other.contains(region.bounds.centerX(), region.bounds.centerY())) {
diff --git a/libraries/flicker/src/android/tools/flicker/subject/region/RegionTraceSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/region/RegionTraceSubject.kt
index 8b1da1f51..ab253a0b5 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/region/RegionTraceSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/region/RegionTraceSubject.kt
@@ -67,6 +67,13 @@ constructor(val trace: RegionTrace, override val reader: Reader? = null) :
         addAssertion("isToTheRight($other, $componentsAsString)") { it.isToTheRight(other) }
     }
 
+    /** {@inheritDoc} */
+    override fun isLeftEdgeToTheRight(other: Region): RegionTraceSubject = apply {
+        addAssertion("isLeftEdgeToTheRight($other, $componentsAsString)") {
+            it.isLeftEdgeToTheRight(other)
+        }
+    }
+
     /** {@inheritDoc} */
     override fun isHigher(other: Rect): RegionTraceSubject = isHigher(Region(other))
 
diff --git a/libraries/flicker/src/android/tools/flicker/subject/wm/IWindowManagerSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/wm/IWindowManagerSubject.kt
index 2bf145617..b53363149 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/wm/IWindowManagerSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/wm/IWindowManagerSubject.kt
@@ -176,6 +176,10 @@ interface IWindowManagerSubject<WMSubjectType, RegionSubjectType> {
     /** Asserts the state contains no visible app windows. */
     fun isKeyguardShowing(): WMSubjectType
 
+    /** Manual overload for java compatibility */
+    fun isAppWindowInvisible(componentMatcher: IComponentMatcher): WMSubjectType =
+        isAppWindowInvisible(componentMatcher, mustExist = false)
+
     /**
      * Asserts the state contains an invisible window [WindowState] matching [componentMatcher].
      *
@@ -183,8 +187,14 @@ interface IWindowManagerSubject<WMSubjectType, RegionSubjectType> {
      * that it contains an invisible [Activity] matching [componentMatcher].
      *
      * @param componentMatcher Components to search
+     * @param mustExist when true, the test will fail if the component doesn't exist. Otherwise, the
+     *   test will automatically pass when the component is not found
      */
-    fun isAppWindowInvisible(componentMatcher: IComponentMatcher): WMSubjectType
+    fun isAppWindowInvisible(componentMatcher: IComponentMatcher, mustExist: Boolean): WMSubjectType
+
+    /** Manual overload for java compatibility */
+    fun isNonAppWindowInvisible(componentMatcher: IComponentMatcher): WMSubjectType =
+        isNonAppWindowInvisible(componentMatcher, mustExist = false)
 
     /**
      * Asserts the state contains an invisible window matching [componentMatcher].
@@ -193,8 +203,13 @@ interface IWindowManagerSubject<WMSubjectType, RegionSubjectType> {
      * that it contains an invisible [Activity] matching [componentMatcher].
      *
      * @param componentMatcher Components to search
+     * @param mustExist when true, the test will fail if the component doesn't exist. Otherwise, the
+     *   test will automatically pass when the component is not found
      */
-    fun isNonAppWindowInvisible(componentMatcher: IComponentMatcher): WMSubjectType
+    fun isNonAppWindowInvisible(
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean,
+    ): WMSubjectType
 
     /** Asserts the state home activity is visible */
     fun isHomeActivityVisible(): WMSubjectType
diff --git a/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerStateSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerStateSubject.kt
index 6346b1369..02ab776a9 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerStateSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerStateSubject.kt
@@ -467,13 +467,25 @@ constructor(
 
     /** {@inheritDoc} */
     override fun isAppWindowInvisible(
-        componentMatcher: IComponentMatcher
-    ): WindowManagerStateSubject = apply { checkWindowIsInvisible(appWindows, componentMatcher) }
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean,
+    ): WindowManagerStateSubject = apply {
+        if (mustExist) {
+            containsAppWindow(componentMatcher)
+        }
+        checkWindowIsInvisible(appWindows, componentMatcher)
+    }
 
     /** {@inheritDoc} */
     override fun isNonAppWindowInvisible(
-        componentMatcher: IComponentMatcher
-    ): WindowManagerStateSubject = apply { checkWindowIsInvisible(nonAppWindows, componentMatcher) }
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean,
+    ): WindowManagerStateSubject = apply {
+        if (mustExist) {
+            containsNonAppWindow(componentMatcher)
+        }
+        checkWindowIsInvisible(nonAppWindows, componentMatcher)
+    }
 
     private fun checkWindowIsInvisible(
         subjectList: List<WindowStateSubject>,
diff --git a/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerTraceSubject.kt b/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerTraceSubject.kt
index 557fc8942..d4b40f1c7 100644
--- a/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerTraceSubject.kt
+++ b/libraries/flicker/src/android/tools/flicker/subject/wm/WindowManagerTraceSubject.kt
@@ -217,19 +217,22 @@ constructor(val trace: WindowManagerTrace, override val reader: Reader? = null)
 
     /** {@inheritDoc} */
     override fun isNonAppWindowInvisible(
-        componentMatcher: IComponentMatcher
-    ): WindowManagerTraceSubject = isNonAppWindowInvisible(componentMatcher, isOptional = false)
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean,
+    ): WindowManagerTraceSubject =
+        isNonAppWindowInvisible(componentMatcher, isOptional = false, mustExist)
 
     /** See [isNonAppWindowInvisible] */
     fun isNonAppWindowInvisible(
         componentMatcher: IComponentMatcher,
         isOptional: Boolean,
+        mustExist: Boolean = false,
     ): WindowManagerTraceSubject = apply {
         addAssertion(
             "isNonAppWindowInvisible(${componentMatcher.toWindowIdentifier()})",
             isOptional,
         ) {
-            it.isNonAppWindowInvisible(componentMatcher)
+            it.isNonAppWindowInvisible(componentMatcher, mustExist)
         }
     }
 
@@ -316,16 +319,19 @@ constructor(val trace: WindowManagerTrace, override val reader: Reader? = null)
 
     /** {@inheritDoc} */
     override fun isAppWindowInvisible(
-        componentMatcher: IComponentMatcher
-    ): WindowManagerTraceSubject = isAppWindowInvisible(componentMatcher, isOptional = false)
+        componentMatcher: IComponentMatcher,
+        mustExist: Boolean,
+    ): WindowManagerTraceSubject =
+        isAppWindowInvisible(componentMatcher, isOptional = false, mustExist)
 
     /** See [isAppWindowInvisible] */
     fun isAppWindowInvisible(
         componentMatcher: IComponentMatcher,
         isOptional: Boolean,
+        mustExist: Boolean = false,
     ): WindowManagerTraceSubject = apply {
         addAssertion("isAppWindowInvisible(${componentMatcher.toWindowIdentifier()})", isOptional) {
-            it.isAppWindowInvisible(componentMatcher)
+            it.isAppWindowInvisible(componentMatcher, mustExist)
         }
     }
 
diff --git a/libraries/flicker/test/src/android/tools/flicker/FlickerServiceRuleTest.kt b/libraries/flicker/test/src/android/tools/flicker/FlickerServiceRuleTest.kt
index 70ee1b544..040b29fad 100644
--- a/libraries/flicker/test/src/android/tools/flicker/FlickerServiceRuleTest.kt
+++ b/libraries/flicker/test/src/android/tools/flicker/FlickerServiceRuleTest.kt
@@ -216,7 +216,7 @@ class FlickerServiceRuleTest {
         testRule.failed(Throwable(), mockDescription)
         testRule.skipped(Mockito.mock(AssumptionViolatedException::class.java), mockDescription)
 
-        Mockito.verifyZeroInteractions(mockFlickerServiceResultsCollector)
+        Mockito.verifyNoMoreInteractions(mockFlickerServiceResultsCollector)
     }
 
     @Test
diff --git a/libraries/flicker/test/src/android/tools/flicker/extractor/ShellTransitionScenarioExtractorTest.kt b/libraries/flicker/test/src/android/tools/flicker/extractor/ShellTransitionScenarioExtractorTest.kt
index 00bd472d5..ff448cd8d 100644
--- a/libraries/flicker/test/src/android/tools/flicker/extractor/ShellTransitionScenarioExtractorTest.kt
+++ b/libraries/flicker/test/src/android/tools/flicker/extractor/ShellTransitionScenarioExtractorTest.kt
@@ -74,9 +74,9 @@ class ShellTransitionScenarioExtractorTest {
         Truth.assertThat(slices.first().startTimestamp)
             .isEqualTo(
                 Timestamps.from(
-                    unixNanos = 1682433264342452347,
+                    unixNanos = 1682433275377527157,
                     systemUptimeNanos = 2766599071189,
-                    elapsedNanos = 2755182606546,
+                    elapsedNanos = 2766217681356,
                 )
             )
         Truth.assertThat(slices.first().endTimestamp)
diff --git a/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceDecoratorTest.kt b/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceDecoratorTest.kt
index 5b78fde05..e4ec9def1 100644
--- a/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceDecoratorTest.kt
+++ b/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceDecoratorTest.kt
@@ -46,7 +46,7 @@ import org.mockito.Mockito
 
 class FlickerServiceDecoratorTest {
     @Test
-    fun sendsInstrumentationUpdatesOWhenComputingTestMethods() {
+    fun sendsInstrumentationUpdatesWhenComputingTestMethods() {
         val instrumentation = Mockito.mock(Instrumentation::class.java)
         val testClass = Mockito.mock(TestClass::class.java)
         val innerDecorator = Mockito.mock(IFlickerJUnitDecorator::class.java)
@@ -59,6 +59,9 @@ class FlickerServiceDecoratorTest {
             .thenReturn(listOf(method))
         Mockito.`when`(testClass.getAnnotatedMethods(FlickerConfigProvider::class.java))
             .thenReturn(listOf(flickerConfigProviderMethods))
+        Mockito.`when`(testClass.javaClass).thenReturn(FlickerServiceDecoratorTest::class.java)
+        Mockito.`when`(testClass.onlyConstructor)
+            .thenReturn(FlickerServiceDecoratorTest::class.java.constructors.first())
         Mockito.`when`(flickerConfigProviderMethods.invokeExplosively(testClass))
             .thenReturn(FlickerConfig().use(FlickerServiceConfig.DEFAULT))
         Mockito.`when`(method.annotations).thenReturn(emptyArray())
@@ -120,6 +123,9 @@ class FlickerServiceDecoratorTest {
             .thenReturn(listOf(method))
         Mockito.`when`(testClass.getAnnotatedMethods(FlickerConfigProvider::class.java))
             .thenReturn(listOf(flickerConfigProviderMethods))
+        Mockito.`when`(testClass.javaClass).thenReturn(FlickerServiceDecoratorTest::class.java)
+        Mockito.`when`(testClass.onlyConstructor)
+            .thenReturn(FlickerServiceDecoratorTest::class.java.constructors.first())
         Mockito.`when`(flickerConfigProviderMethods.invokeExplosively(testClass))
             .thenReturn(FlickerConfig().use(FlickerServiceConfig.DEFAULT))
         Mockito.`when`(method.annotations).thenReturn(emptyArray())
diff --git a/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunnerTest.kt b/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunnerTest.kt
index d4c5db571..be5ea7b92 100644
--- a/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunnerTest.kt
+++ b/libraries/flicker/test/src/android/tools/flicker/junit/FlickerServiceJUnit4ClassRunnerTest.kt
@@ -36,11 +36,13 @@ import android.tools.flicker.extractors.TraceSlice
 import android.tools.io.Reader
 import androidx.test.platform.app.InstrumentationRegistry
 import com.google.common.truth.Truth
+import java.time.Instant
 import org.junit.Rule
 import org.junit.Test
 import org.junit.rules.TestRule
 import org.junit.runner.RunWith
 import org.junit.runner.notification.RunNotifier
+import org.junit.runners.model.Statement
 import org.mockito.ArgumentMatchers
 import org.mockito.Mockito
 
@@ -54,6 +56,47 @@ class FlickerServiceJUnit4ClassRunnerTest {
         Truth.assertThat(testRuleRunCount).isEqualTo(1)
     }
 
+    @Test
+    fun runsTheTestRulesAtTheRightTime() {
+        var testRuleStartTs: Instant? = null
+        var testRuleEndTs: Instant? = null
+        var testStateTs: Instant? = null
+        var testRuleExecutionCount = 0
+        onTestRuleStart =
+            object : Runnable {
+                override fun run() {
+                    testRuleExecutionCount++
+                    testRuleStartTs = Instant.now()
+                }
+            }
+        onTestRuleEnd =
+            object : Runnable {
+                override fun run() {
+                    testRuleEndTs = Instant.now()
+                }
+            }
+        onTestStart =
+            object : Runnable {
+                override fun run() {
+                    testStateTs = Instant.now()
+                }
+            }
+
+        val runner = FlickerServiceJUnit4ClassRunner(SimpleTest::class.java)
+        runner.run(RunNotifier())
+
+        Truth.assertWithMessage("Test rule start running after test block")
+            .that(testRuleStartTs)
+            .isLessThan(testStateTs)
+        Truth.assertWithMessage("Test rule end running before test block")
+            .that(testStateTs)
+            .isLessThan(testRuleEndTs)
+
+        Truth.assertWithMessage("Test rule ran the wrong number of times")
+            .that(testRuleExecutionCount)
+            .isEqualTo(1)
+    }
+
     @Test
     fun skipsNonBlockingTestsIfRequested() {
         val arguments = Bundle()
@@ -100,13 +143,21 @@ class FlickerServiceJUnit4ClassRunnerTest {
 
         @get:Rule
         val myRule = TestRule { base, _ ->
-            testRuleRunCount++
-            base
+            object : Statement() {
+                @Throws(Throwable::class)
+                override fun evaluate() {
+                    onTestRuleStart?.run()
+                    testRuleRunCount++
+                    base.evaluate()
+                    onTestRuleEnd?.run()
+                }
+            }
         }
 
         @Test
         @ExpectedScenarios(["MY_CUSTOM_SCENARIO"])
         fun test() {
+            onTestStart?.run()
             testApp.open()
         }
 
@@ -160,5 +211,9 @@ class FlickerServiceJUnit4ClassRunnerTest {
 
     companion object {
         var testRuleRunCount = 0
+
+        var onTestRuleStart: Runnable? = null
+        var onTestStart: Runnable? = null
+        var onTestRuleEnd: Runnable? = null
     }
 }
diff --git a/libraries/flicker/test/src/android/tools/flicker/subject/region/RegionSubjectTest.kt b/libraries/flicker/test/src/android/tools/flicker/subject/region/RegionSubjectTest.kt
index 392d9a0e6..03e351a2d 100644
--- a/libraries/flicker/test/src/android/tools/flicker/subject/region/RegionSubjectTest.kt
+++ b/libraries/flicker/test/src/android/tools/flicker/subject/region/RegionSubjectTest.kt
@@ -98,10 +98,10 @@ class RegionSubjectTest {
     @Test
     fun detectCoversAtLeast() {
         val rectA = Rect(/* left */ 1, /* top */ 1, /* right */ 2, /* bottom */ 2)
-        val rectB = Rect(/* left */ 0, /* top */ 0, /* right */ 2, /* bottom */ 2)
+        val rectB = Rect(/* left */ 0, /* top */ 0, /* right */ 5, /* bottom */ 5)
         RegionSubject(rectA, timestamp = Timestamps.empty()).coversAtLeast(rectA)
         RegionSubject(rectB, timestamp = Timestamps.empty()).coversAtLeast(rectA)
-        assertFail("SkRegion((0,0,2,1)(0,1,1,2))") {
+        assertFail("SkRegion((0,0,5,1)(0,1,1,2)(2,1,5,2)(0,2,5,5))") {
             RegionSubject(rectA, timestamp = Timestamps.empty()).coversAtLeast(rectB)
         }
     }
diff --git a/libraries/flicker/test/src/android/tools/flicker/subject/surfaceflinger/LayerTraceEntrySubjectTest.kt b/libraries/flicker/test/src/android/tools/flicker/subject/surfaceflinger/LayerTraceEntrySubjectTest.kt
index bf2fbd02a..2ca160b43 100644
--- a/libraries/flicker/test/src/android/tools/flicker/subject/surfaceflinger/LayerTraceEntrySubjectTest.kt
+++ b/libraries/flicker/test/src/android/tools/flicker/subject/surfaceflinger/LayerTraceEntrySubjectTest.kt
@@ -406,6 +406,19 @@ class LayerTraceEntrySubjectTest {
         subject.visibleLayersShownMoreThanOneConsecutiveEntry()
     }
 
+    @Test
+    fun failsOnNonEsistingComponent_isInvisibleWithMustExist() {
+        val reader =
+            getLayerTraceReaderFromAsset("layers_trace_visible_outside_bounds.perfetto-trace")
+        val trace = reader.readLayersTrace() ?: error("Unable to read layers trace")
+        val subject =
+            LayersTraceSubject(trace, reader)
+                .getEntryBySystemUpTime(1253267561044, byElapsedTimestamp = true)
+        assertFail("ImaginaryWindow should exist") {
+            subject.isInvisible(TestComponents.IMAGINARY, mustExist = true)
+        }
+    }
+
     companion object {
         @ClassRule @JvmField val ENV_CLEANUP = CleanFlickerEnvironmentRule()
     }
diff --git a/libraries/flicker/test/src/android/tools/flicker/subject/wm/WindowManagerStateSubjectTest.kt b/libraries/flicker/test/src/android/tools/flicker/subject/wm/WindowManagerStateSubjectTest.kt
index b91ddc922..8165770ab 100644
--- a/libraries/flicker/test/src/android/tools/flicker/subject/wm/WindowManagerStateSubjectTest.kt
+++ b/libraries/flicker/test/src/android/tools/flicker/subject/wm/WindowManagerStateSubjectTest.kt
@@ -126,14 +126,14 @@ class WindowManagerStateSubjectTest {
         val subject =
             WindowManagerTraceSubject(trace, reader)
                 .getEntryByElapsedTimestamp(traceFirstFrameTimestamp)
-        assertFail("SkRegion((1440,0,1441,171))") {
+        assertFail("SkRegion((1440,0,1443,171))") {
             subject
                 .visibleRegion(ComponentNameMatcher.STATUS_BAR)
-                .coversAtLeast(Region(0, 0, 1441, 171))
+                .coversAtLeast(Region(0, 0, 1443, 171))
         }
 
-        assertFail("SkRegion((0,2960,1440,2961))") {
-            subject.visibleRegion(TestComponents.LAUNCHER).coversAtLeast(Region(0, 0, 1440, 2961))
+        assertFail("SkRegion((0,2960,1440,2963))") {
+            subject.visibleRegion(TestComponents.LAUNCHER).coversAtLeast(Region(0, 0, 1440, 2963))
         }
     }
 
@@ -168,14 +168,14 @@ class WindowManagerStateSubjectTest {
         val subject =
             WindowManagerTraceSubject(trace, reader)
                 .getEntryByElapsedTimestamp(traceFirstFrameTimestamp)
-        assertFail("Uncovered region: SkRegion((1440,0,1441,171))") {
+        assertFail("Uncovered region: SkRegion((1440,0,1443,171))") {
             subject
                 .visibleRegion(ComponentNameMatcher.STATUS_BAR)
-                .coversAtLeast(Region(0, 0, 1441, 171))
+                .coversAtLeast(Region(0, 0, 1443, 171))
         }
 
-        assertFail("Uncovered region: SkRegion((0,2960,1440,2961))") {
-            subject.visibleRegion(TestComponents.LAUNCHER).coversAtLeast(Region(0, 0, 1440, 2961))
+        assertFail("Uncovered region: SkRegion((0,2960,1440,2963))") {
+            subject.visibleRegion(TestComponents.LAUNCHER).coversAtLeast(Region(0, 0, 1440, 2963))
         }
     }
 
@@ -426,6 +426,18 @@ class WindowManagerStateSubjectTest {
         entry.isAppWindowInvisible(TestComponents.CHROME_SPLASH_SCREEN)
     }
 
+    @Test
+    fun failsOnNonExistingComponent_isInvisibleWithMustExist() {
+        val entry =
+            WindowManagerTraceSubject(trace, reader).getEntryByElapsedTimestamp(9215551505798L)
+        assertFail("ImaginaryWindow should exist") {
+            entry.isAppWindowInvisible(TestComponents.IMAGINARY, mustExist = true)
+        }
+        assertFail("ImaginaryWindow should exist") {
+            entry.isNonAppWindowInvisible(TestComponents.IMAGINARY, mustExist = true)
+        }
+    }
+
     companion object {
         @ClassRule @JvmField val ENV_CLEANUP = CleanFlickerEnvironmentRule()
     }
diff --git a/libraries/flicker/utils/src/android/tools/Trace.kt b/libraries/flicker/utils/src/android/tools/Trace.kt
index 34771d0c2..f86e714b2 100644
--- a/libraries/flicker/utils/src/android/tools/Trace.kt
+++ b/libraries/flicker/utils/src/android/tools/Trace.kt
@@ -42,7 +42,9 @@ interface Trace<Entry : TraceEntry> {
      * the provided [timestamp] is before all entries in the trace
      */
     fun getEntryAt(timestamp: Timestamp): Entry {
+        assert(entries.isNotEmpty()) { "No entries in the trace" }
         return entries.toList().dropLastWhile { it.timestamp > timestamp }.lastOrNull()
-            ?: error("No entry at or before timestamp $timestamp")
+            ?: error("No entry at or before timestamp $timestamp. "
+                    + "First entry is at ${entries.first().timestamp}")
     }
 }
diff --git a/libraries/flicker/utils/src/android/tools/datatypes/Utils.kt b/libraries/flicker/utils/src/android/tools/datatypes/Utils.kt
index 70a514fb7..d2c912b61 100644
--- a/libraries/flicker/utils/src/android/tools/datatypes/Utils.kt
+++ b/libraries/flicker/utils/src/android/tools/datatypes/Utils.kt
@@ -107,8 +107,22 @@ fun Region.uncoveredRegion(testRegion: Region): Region {
     return uncoveredRegion
 }
 
-fun Region.coversAtLeast(testRegion: Region): Boolean {
-    val intersection = Region(this)
+fun Region.coversAtLeast(testRegion: Region, tolerance: Int = 2): Boolean {
+    // Expand [this] by [tolerance] pixels in all directions
+    val expandedRegion =
+        Region(this).apply {
+            op(
+                Region(
+                    bounds.left - tolerance,
+                    bounds.top - tolerance,
+                    bounds.right + tolerance,
+                    bounds.bottom + tolerance,
+                ),
+                Region.Op.UNION,
+            )
+        }
+
+    val intersection = Region(expandedRegion)
     return intersection.op(testRegion, Region.Op.INTERSECT) &&
         !intersection.op(testRegion, Region.Op.XOR)
 }
diff --git a/libraries/flicker/utils/src/android/tools/helpers/WindowUtils.kt b/libraries/flicker/utils/src/android/tools/helpers/WindowUtils.kt
index 3a0eac518..266a1ed03 100644
--- a/libraries/flicker/utils/src/android/tools/helpers/WindowUtils.kt
+++ b/libraries/flicker/utils/src/android/tools/helpers/WindowUtils.kt
@@ -59,6 +59,14 @@ object WindowUtils {
             return currState.wmState.getRotation(PlatformConsts.DEFAULT_DISPLAY)
         }
 
+    /** Gets the default display ID. */
+    val defaultDisplayId: Int
+        get() =
+            getCurrentStateDump(clearCacheAfterParsing = false)
+                .wmState
+                .getDefaultDisplay()
+                ?.displayId ?: error("Missing physical display")
+
     /**
      * Get the display bounds when the device is at a specific rotation
      *
diff --git a/libraries/flicker/utils/src/android/tools/io/RunStatus.kt b/libraries/flicker/utils/src/android/tools/io/RunStatus.kt
index 7c5fdb961..6c889dbc8 100644
--- a/libraries/flicker/utils/src/android/tools/io/RunStatus.kt
+++ b/libraries/flicker/utils/src/android/tools/io/RunStatus.kt
@@ -35,6 +35,7 @@ enum class RunStatus(val prefix: String, val isFailure: Boolean) {
             append("_")
             append(counter)
         }
+        append(".winscope")
         append(".zip")
     }
 
diff --git a/libraries/flicker/utils/src/android/tools/traces/Utils.kt b/libraries/flicker/utils/src/android/tools/traces/Utils.kt
index 8e80bad3b..f5a76d5be 100644
--- a/libraries/flicker/utils/src/android/tools/traces/Utils.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/Utils.kt
@@ -123,7 +123,7 @@ fun getCurrentState(
 
     Log.d(LOG_TAG, "Requesting new device state dump")
 
-    val perfettoTrace =
+    val reader =
         PerfettoTraceMonitor.newBuilder()
             .also {
                 if (requestedWmDump && android.tracing.Flags.perfettoWmDump()) {
@@ -136,7 +136,9 @@ fun getCurrentState(
             }
             .build()
             .withTracing(resultReaderProvider = { ResultReader(it, SERVICE_TRACE_CONFIG) }) {}
-            .readBytes(TraceType.PERFETTO) ?: ByteArray(0)
+    val perfettoTrace = reader.readBytes(TraceType.PERFETTO) ?: ByteArray(0)
+
+    reader.artifact.deleteIfExists()
 
     val wmDump =
         if (android.tracing.Flags.perfettoWmDump()) {
@@ -198,20 +200,43 @@ fun busyWaitForDataSourceRegistration(
     busyWaitIntervalMs: Long = 100,
     timeoutMs: Long = 10000,
 ) {
-    var elapsedMs = 0L
+    busyWait(
+        busyWaitIntervalMs,
+        timeoutMs,
+        { isDataSourceAvailable(dataSourceName) },
+        { "Data source disn't  become available" },
+    )
+}
 
-    while (!isDataSourceAvailable(dataSourceName)) {
-        SystemClock.sleep(busyWaitIntervalMs)
-        elapsedMs += busyWaitIntervalMs
-        if (elapsedMs >= timeoutMs) {
-            throw java.lang.RuntimeException(
-                "Data source didn't become available. Waited for: $timeoutMs ms"
-            )
-        }
-    }
+@JvmOverloads
+fun busyWaitTracingSessionExists(
+    uniqueSessionName: String,
+    busyWaitIntervalMs: Long = 100,
+    timeoutMs: Long = 10000,
+) {
+    busyWait(
+        busyWaitIntervalMs,
+        timeoutMs,
+        { sessionExists(uniqueSessionName) },
+        { "Tracing session doesn't exist" },
+    )
 }
 
-fun isDataSourceAvailable(dataSourceName: String): Boolean {
+@JvmOverloads
+fun busyWaitTracingSessionDoesntExist(
+    uniqueSessionName: String,
+    busyWaitIntervalMs: Long = 100,
+    timeoutMs: Long = 10000,
+) {
+    busyWait(
+        busyWaitIntervalMs,
+        timeoutMs,
+        { !sessionExists(uniqueSessionName) },
+        { "Tracing session still exists" },
+    )
+}
+
+private fun isDataSourceAvailable(dataSourceName: String): Boolean {
     val proto = executeShellCommand("perfetto --query-raw")
 
     try {
@@ -241,3 +266,38 @@ fun isDataSourceAvailable(dataSourceName: String): Boolean {
 
     return false
 }
+
+private fun sessionExists(uniqueSessionName: String): Boolean {
+    val proto = executeShellCommand("perfetto --query-raw")
+
+    try {
+        val state = TracingServiceState.parseFrom(proto)
+
+        for (session in state.tracingSessionsList) {
+            if (session.uniqueSessionName.equals(uniqueSessionName)) {
+                return true
+            }
+        }
+    } catch (e: InvalidProtocolBufferException) {
+        throw RuntimeException(e)
+    }
+
+    return false
+}
+
+private fun busyWait(
+    busyWaitIntervalMs: Long,
+    timeoutMs: Long,
+    predicate: () -> Boolean,
+    errorMessage: () -> String,
+) {
+    var elapsedMs = 0L
+
+    while (!predicate()) {
+        SystemClock.sleep(busyWaitIntervalMs)
+        elapsedMs += busyWaitIntervalMs
+        if (elapsedMs >= timeoutMs) {
+            throw java.lang.RuntimeException(errorMessage())
+        }
+    }
+}
diff --git a/libraries/flicker/utils/src/android/tools/traces/WaitCondition.kt b/libraries/flicker/utils/src/android/tools/traces/WaitCondition.kt
index 1b6196380..e7e238827 100644
--- a/libraries/flicker/utils/src/android/tools/traces/WaitCondition.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/WaitCondition.kt
@@ -104,7 +104,9 @@ private constructor(
                 Pair(true, currState)
             } else {
                 val detailedMessage = condition.getMessage(currState)
-                onLog?.accept("***Waiting for $detailedMessage... retry=${retryNr + 1}", true)
+                val isError = retryNr + 1 >= retryLimit
+                onLog?.accept(
+                    "***Waiting for $detailedMessage... retry=${retryNr + 1}/$retryLimit", isError)
                 Pair(false, currState)
             }
         } finally {
diff --git a/libraries/flicker/utils/src/android/tools/traces/component/EdgeExtensionComponentMatcher.kt b/libraries/flicker/utils/src/android/tools/traces/component/EdgeExtensionComponentMatcher.kt
deleted file mode 100644
index 82b2c26e8..000000000
--- a/libraries/flicker/utils/src/android/tools/traces/component/EdgeExtensionComponentMatcher.kt
+++ /dev/null
@@ -1,74 +0,0 @@
-/*
- * Copyright (C) 2023 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package android.tools.traces.component
-
-import android.tools.traces.surfaceflinger.Layer
-import android.tools.traces.wm.Activity
-import android.tools.traces.wm.WindowContainer
-import java.util.function.Predicate
-
-class EdgeExtensionComponentMatcher : IComponentMatcher {
-    /** {@inheritDoc} */
-    override fun windowMatchesAnyOf(windows: Collection<WindowContainer>): Boolean {
-        // Doesn't have a window component only layers
-        return false
-    }
-
-    /** {@inheritDoc} */
-    override fun activityMatchesAnyOf(activities: Collection<Activity>): Boolean {
-        // Doesn't have a window component only layers
-        return false
-    }
-
-    /** {@inheritDoc} */
-    override fun layerMatchesAnyOf(layers: Collection<Layer>): Boolean {
-        return layers.any {
-            if (it.name.contains("bbq-wrapper")) {
-                val parent = it.parent ?: return false
-                return layerMatchesAnyOf(parent)
-            }
-
-            return it.name.contains("Left Edge Extension") ||
-                it.name.contains("Right Edge Extension")
-        }
-    }
-
-    /** {@inheritDoc} */
-    override fun check(
-        layers: Collection<Layer>,
-        condition: Predicate<Collection<Layer>>,
-    ): Boolean = condition.test(layers.filter { layerMatchesAnyOf(it) })
-
-    /** {@inheritDoc} */
-    override fun toActivityIdentifier(): String {
-        throw NotImplementedError(
-            "toActivityIdentifier() is not implemented on EdgeExtensionComponentMatcher"
-        )
-    }
-
-    /** {@inheritDoc} */
-    override fun toWindowIdentifier(): String {
-        throw NotImplementedError(
-            "toWindowName() is not implemented on EdgeExtensionComponentMatcher"
-        )
-    }
-
-    /** {@inheritDoc} */
-    override fun toLayerIdentifier(): String {
-        return "EdgeExtensionLayer"
-    }
-}
diff --git a/libraries/flicker/utils/src/android/tools/traces/events/CujType.kt b/libraries/flicker/utils/src/android/tools/traces/events/CujType.kt
index df20a2336..1edd6d64d 100644
--- a/libraries/flicker/utils/src/android/tools/traces/events/CujType.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/events/CujType.kt
@@ -137,7 +137,17 @@ enum class CujType(override val id: Int) : ICujType {
     CUJ_DESKTOP_MODE_EXIT_MODE(108),
     CUJ_DESKTOP_MODE_MINIMIZE_WINDOW(109),
     CUJ_DESKTOP_MODE_DRAG_WINDOW(110),
-    CUJ_DESKTOP_MODE_SNAP_RESIZE(118);
+    CUJ_DESKTOP_MODE_SNAP_RESIZE(118),
+    CUJ_DESKTOP_MODE_UNMAXIMIZE_WINDOW(119),
+    CUJ_DESKTOP_MODE_ENTER_FROM_OVERVIEW_MENU(120),
+    CUJ_LAUNCHER_OVERVIEW_TASK_DISMISS(121),
+    CUJ_DESKTOP_MODE_CLOSE_TASK(122),
+    CUJ_DESKTOP_MODE_APP_LAUNCH_FROM_INTENT(123),
+    CUJ_DESKTOP_MODE_APP_LAUNCH_FROM_ICON(124),
+    CUJ_DESKTOP_MODE_KEYBOARD_QUICK_SWITCH_APP_LAUNCH(125),
+    CUJ_LAUNCHER_WORK_UTILITY_VIEW_EXPAND(126),
+    CUJ_LAUNCHER_WORK_UTILITY_VIEW_SHRINK(127),
+    CUJ_DEFAULT_TASK_TO_TASK_ANIMATION(128);
 
     companion object {
         fun from(eventId: Int): ICujType =
diff --git a/libraries/flicker/utils/src/android/tools/traces/monitors/MonitorUtils.kt b/libraries/flicker/utils/src/android/tools/traces/monitors/MonitorUtils.kt
index 1d33a31c5..553abc6e1 100644
--- a/libraries/flicker/utils/src/android/tools/traces/monitors/MonitorUtils.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/monitors/MonitorUtils.kt
@@ -17,7 +17,7 @@
 @file:JvmName("MonitorUtils")
 @file:OptIn(
     androidx.benchmark.perfetto.ExperimentalPerfettoCaptureApi::class,
-    androidx.benchmark.perfetto.ExperimentalPerfettoTraceProcessorApi::class,
+    androidx.benchmark.traceprocessor.ExperimentalTraceProcessorApi::class,
 )
 
 package android.tools.traces.monitors
diff --git a/libraries/flicker/utils/src/android/tools/traces/monitors/PerfettoTraceMonitor.kt b/libraries/flicker/utils/src/android/tools/traces/monitors/PerfettoTraceMonitor.kt
index 4b597a0f4..5596ed8a8 100644
--- a/libraries/flicker/utils/src/android/tools/traces/monitors/PerfettoTraceMonitor.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/monitors/PerfettoTraceMonitor.kt
@@ -23,6 +23,8 @@ import java.io.File
 import java.util.concurrent.locks.ReentrantLock
 import perfetto.protos.PerfettoConfig
 import perfetto.protos.PerfettoConfig.DataSourceConfig
+import perfetto.protos.PerfettoConfig.FtraceConfig
+import perfetto.protos.PerfettoConfig.ProcessStatsConfig
 import perfetto.protos.PerfettoConfig.SurfaceFlingerLayersConfig
 import perfetto.protos.PerfettoConfig.SurfaceFlingerTransactionsConfig
 import perfetto.protos.PerfettoConfig.TraceConfig
@@ -79,6 +81,7 @@ open class PerfettoTraceMonitor(val config: TraceConfig) : TraceMonitor() {
 
         private val dataSourceConfigs = mutableSetOf<DataSourceConfig>()
         private var incrementalTimeoutMs: Int? = null
+        private var uniqueSessionName: String? = null
 
         fun enableImeTrace(): Builder = apply { enableCustomTrace(createImeDataSourceConfig()) }
 
@@ -189,6 +192,8 @@ open class PerfettoTraceMonitor(val config: TraceConfig) : TraceMonitor() {
 
         fun setIncrementalTimeout(timeoutMs: Int) = apply { incrementalTimeoutMs = timeoutMs }
 
+        fun setUniqueSessionName(name: String): Builder = apply { uniqueSessionName = name }
+
         fun build(): PerfettoTraceMonitor {
             val configBuilder =
                 TraceConfig.newBuilder()
@@ -199,6 +204,13 @@ open class PerfettoTraceMonitor(val config: TraceConfig) : TraceMonitor() {
                             .build()
                     )
 
+            if (uniqueSessionName != null) {
+                configBuilder.setUniqueSessionName(uniqueSessionName)
+            }
+
+            dataSourceConfigs.add(createProcessStatsDataSourceConfig())
+            dataSourceConfigs.add(createFtraceDataSourceConfig())
+
             for (dataSourceConfig in dataSourceConfigs) {
                 configBuilder.addDataSources(createDataSourceWithConfig(dataSourceConfig))
             }
@@ -298,6 +310,31 @@ open class PerfettoTraceMonitor(val config: TraceConfig) : TraceMonitor() {
                 .build()
         }
 
+        private fun createProcessStatsDataSourceConfig(): DataSourceConfig {
+            return DataSourceConfig.newBuilder()
+                .setName(PROCESS_STATS_DATA_SOURCE)
+                .setTargetBuffer(0)
+                .setProcessStatsConfig(
+                    ProcessStatsConfig.newBuilder().setScanAllProcessesOnStart(true).build()
+                )
+                .build()
+        }
+
+        private fun createFtraceDataSourceConfig(): DataSourceConfig {
+            val ftraceEvents = listOf("ftrace/print", "task/task_newtask", "task/task_rename")
+            val atraceCategories = listOf("ss", "wm")
+            return DataSourceConfig.newBuilder()
+                .setName(FTRACE_DATA_SOURCE)
+                .setTargetBuffer(0)
+                .setFtraceConfig(
+                    FtraceConfig.newBuilder()
+                        .apply { ftraceEvents.forEach { addFtraceEvents(it) } }
+                        .apply { atraceCategories.forEach { addAtraceCategories(it) } }
+                        .build()
+                )
+                .build()
+        }
+
         private fun createDataSourceWithConfig(
             dataSourceConfig: DataSourceConfig
         ): TraceConfig.DataSource {
@@ -315,6 +352,8 @@ open class PerfettoTraceMonitor(val config: TraceConfig) : TraceMonitor() {
         private const val PROTOLOG_DATA_SOURCE = "android.protolog"
         private const val VIEWCAPTURE_DATA_SOURCE = "android.viewcapture"
         private const val WINDOWMANAGER_DATA_SOURCE = "android.windowmanager"
+        private const val PROCESS_STATS_DATA_SOURCE = "linux.process_stats"
+        private const val FTRACE_DATA_SOURCE = "linux.ftrace"
 
         private val allPerfettoPids = mutableListOf<Int>()
         private val allPerfettoPidsLock = ReentrantLock()
@@ -353,7 +392,7 @@ open class PerfettoTraceMonitor(val config: TraceConfig) : TraceMonitor() {
         }
 
         private fun isPerfettoProcessUp(pid: Int): Boolean {
-            val out = String(executeShellCommand("ps -p $pid -o CMD"))
+            val out = String(executeShellCommand("ps -p $pid -o NAME"))
             return out.contains("perfetto")
         }
     }
diff --git a/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TraceProcessorSession.kt b/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TraceProcessorSession.kt
index c6520eb5c..ea088b4d7 100644
--- a/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TraceProcessorSession.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TraceProcessorSession.kt
@@ -16,21 +16,22 @@
 
 @file:OptIn(
     androidx.benchmark.perfetto.ExperimentalPerfettoCaptureApi::class,
-    androidx.benchmark.perfetto.ExperimentalPerfettoTraceProcessorApi::class,
+    androidx.benchmark.traceprocessor.ExperimentalTraceProcessorApi::class,
 )
 
 package android.tools.traces.parsers.perfetto
 
 import android.tools.io.TraceType
 import android.tools.withTracing
-import androidx.benchmark.perfetto.PerfettoTrace
-import androidx.benchmark.perfetto.PerfettoTraceProcessor
+import androidx.benchmark.traceprocessor.PerfettoTrace
+import androidx.benchmark.traceprocessor.TraceProcessor
+import androidx.benchmark.macro.runServer
 import java.io.File
 import java.io.FileOutputStream
 
 typealias Row = Map<String, Any?>
 
-class TraceProcessorSession(val session: PerfettoTraceProcessor.Session) {
+class TraceProcessorSession(val session: TraceProcessor.Session) {
 
     fun <T> query(sql: String, predicate: (List<Row>) -> T): T {
         return withTracing("TraceProcessorSession#query") {
@@ -46,7 +47,7 @@ class TraceProcessorSession(val session: PerfettoTraceProcessor.Session) {
                 val traceFile = File.createTempFile(TraceType.SF.fileName, "")
                 FileOutputStream(traceFile).use { it.write(trace) }
                 val result =
-                    PerfettoTraceProcessor.runServer {
+                    TraceProcessor.runServer {
                         loadTrace(PerfettoTrace(traceFile.absolutePath)) {
                             predicate(TraceProcessorSession(this))
                         }
@@ -55,4 +56,4 @@ class TraceProcessorSession(val session: PerfettoTraceProcessor.Session) {
             }
         }
     }
-}
+}
\ No newline at end of file
diff --git a/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TransitionsTraceParser.kt b/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TransitionsTraceParser.kt
index 132785b0f..f2de4310c 100644
--- a/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TransitionsTraceParser.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/parsers/perfetto/TransitionsTraceParser.kt
@@ -60,7 +60,7 @@ class TransitionsTraceParser :
                 }
 
             transitionRowsGrouped.values.forEach { transitionRows ->
-                transitions.add(buildTransition(transitionRows, handlerMapping))
+                transitions.add(buildTransition(input, transitionRows, handlerMapping))
             }
         }
 
@@ -86,6 +86,7 @@ class TransitionsTraceParser :
                 .trimIndent()
 
         private fun buildTransition(
+            input: TraceProcessorSession,
             transitionRows: List<Row>,
             handlerMapping: Map<Int, String>,
         ): Transition {
@@ -94,15 +95,16 @@ class TransitionsTraceParser :
                 id = args.getChild("id")?.getInt() ?: error("Missing transition id"),
                 wmData =
                     WmTransitionData(
-                        createTime = args.getChild("create_time_ns")?.getLong()?.toTimestamp(),
-                        sendTime = args.getChild("send_time_ns")?.getLong()?.toTimestamp(),
-                        abortTime = args.getChild("wm_abort_time_ns")?.getLong()?.toTimestamp(),
-                        finishTime = args.getChild("finish_time_ns")?.getLong()?.toTimestamp(),
+                        createTime = args.getChild("create_time_ns")?.getLong()?.toTimestamp(input),
+                        sendTime = args.getChild("send_time_ns")?.getLong()?.toTimestamp(input),
+                        abortTime =
+                            args.getChild("wm_abort_time_ns")?.getLong()?.toTimestamp(input),
+                        finishTime = args.getChild("finish_time_ns")?.getLong()?.toTimestamp(input),
                         startingWindowRemoveTime =
                             args
                                 .getChild("starting_window_remove_time_ns")
                                 ?.getLong()
-                                ?.toTimestamp(),
+                                ?.toTimestamp(input),
                         startTransactionId = args.getChild("start_transaction_id")?.getLong(),
                         finishTransactionId = args.getChild("finish_transaction_id")?.getLong(),
                         type = args.getChild("type")?.getInt()?.toTransitionType(),
@@ -125,24 +127,37 @@ class TransitionsTraceParser :
                     ),
                 shellData =
                     ShellTransitionData(
-                        dispatchTime = args.getChild("dispatch_time_ns")?.getLong()?.toTimestamp(),
+                        dispatchTime =
+                            args.getChild("dispatch_time_ns")?.getLong()?.toTimestamp(input),
                         mergeRequestTime =
-                            args.getChild("merge_request_time_ns")?.getLong()?.toTimestamp(),
-                        mergeTime = args.getChild("merge_time_ns")?.getLong()?.toTimestamp(),
-                        abortTime = args.getChild("shell_abort_time_ns")?.getLong()?.toTimestamp(),
+                            args.getChild("merge_request_time_ns")?.getLong()?.toTimestamp(input),
+                        mergeTime = args.getChild("merge_time_ns")?.getLong()?.toTimestamp(input),
+                        abortTime =
+                            args.getChild("shell_abort_time_ns")?.getLong()?.toTimestamp(input),
                         handler = args.getChild("handler")?.getInt()?.let { handlerMapping[it] },
                         mergeTarget = args.getChild("merge_target")?.getInt(),
                     ),
             )
         }
 
-        private fun Long.toTimestamp() =
+        private fun Long.toTimestamp(input: TraceProcessorSession): Timestamp? {
             if (this == 0L) {
-                null
-            } else {
-                Timestamps.from(elapsedNanos = this)
+                return null
             }
 
+            val ts = this
+            return input.query(
+                "SELECT TO_REALTIME($ts) as real_ts, TO_MONOTONIC($ts) as monotonic_ts"
+            ) {
+                require(it.size == 1)
+                Timestamps.from(
+                    unixNanos = it[0]["real_ts"] as Long,
+                    systemUptimeNanos = it[0]["monotonic_ts"] as Long,
+                    elapsedNanos = this,
+                )
+            }
+        }
+
         private fun Int.toTransitionType() = TransitionType.fromInt(this)
     }
 }
diff --git a/libraries/flicker/utils/src/android/tools/traces/wm/TransitionType.kt b/libraries/flicker/utils/src/android/tools/traces/wm/TransitionType.kt
index 3c24b21e3..41aea732b 100644
--- a/libraries/flicker/utils/src/android/tools/traces/wm/TransitionType.kt
+++ b/libraries/flicker/utils/src/android/tools/traces/wm/TransitionType.kt
@@ -43,11 +43,6 @@ enum class TransitionType(val value: Int) {
     SPLIT_DISMISS(FIRST_CUSTOM.value + 7),
     MAXIMIZE(FIRST_CUSTOM.value + 8),
     RESTORE_FROM_MAXIMIZE(FIRST_CUSTOM.value + 9),
-    DESKTOP_MODE_START_DRAG_TO_DESKTOP(FIRST_CUSTOM.value + 10),
-    DESKTOP_MODE_END_DRAG_TO_DESKTOP(FIRST_CUSTOM.value + 11),
-    EXIT_DESKTOP_MODE(FIRST_CUSTOM.value + 12),
-    DESKTOP_MODE_CANCEL_DRAG_TO_DESKTOP(FIRST_CUSTOM.value + 13),
-    DESKTOP_MODE_TOGGLE_RESIZE(FIRST_CUSTOM.value + 14),
     MOVE_TO_DESKTOP(FIRST_CUSTOM.value + 15),
     RESIZE_PIP(FIRST_CUSTOM.value + 16),
     TASK_FRAGMENT_DRAG_RESIZE(FIRST_CUSTOM.value + 17),
@@ -55,7 +50,23 @@ enum class TransitionType(val value: Int) {
     CLEANUP_PIP_EXIT(FIRST_CUSTOM.value + 19),
     MINIMIZE(FIRST_CUSTOM.value + 20),
     START_RECENTS_TRANSITION(FIRST_CUSTOM.value + 21),
-    END_RECENTS_TRANSITION(FIRST_CUSTOM.value + 22);
+    END_RECENTS_TRANSITION(FIRST_CUSTOM.value + 22),
+
+    // START OF DESKTOP MODE TYPES
+    // See com.android.wm.shell.transition.Transitions.TRANSIT_DESKTOP_MODE_TYPES
+    TRANSIT_DESKTOP_MODE_TYPES(FIRST_CUSTOM.value + 100),
+    // See com.android.wm.shell.desktopmode.DesktopModeTransitionTypes
+    ENTER_DESKTOP_FROM_APP_HANDLE_MENU_BUTTON(TRANSIT_DESKTOP_MODE_TYPES.value + 1),
+    ENTER_DESKTOP_FROM_APP_FROM_OVERVIEW(TRANSIT_DESKTOP_MODE_TYPES.value + 2),
+    ENTER_DESKTOP_FROM_KEYBOARD_SHORTCUT(TRANSIT_DESKTOP_MODE_TYPES.value + 3),
+    ENTER_DESKTOP_FROM_UNKNOWN(TRANSIT_DESKTOP_MODE_TYPES.value + 4),
+    EXIT_DESKTOP_MODE_HANDLE_MENU_BUTTON(TRANSIT_DESKTOP_MODE_TYPES.value + 6),
+    EXIT_DESKTOP_MODE_KEYBOARD_SHORTCUT(TRANSIT_DESKTOP_MODE_TYPES.value + 7),
+    EXIT_DESKTOP_MODE_UNKNOWN(TRANSIT_DESKTOP_MODE_TYPES.value + 8),
+    DESKTOP_MODE_START_DRAG_TO_DESKTOP(TRANSIT_DESKTOP_MODE_TYPES.value + 9),
+    DESKTOP_MODE_END_DRAG_TO_DESKTOP(TRANSIT_DESKTOP_MODE_TYPES.value + 10),
+    DESKTOP_MODE_CANCEL_DRAG_TO_DESKTOP(TRANSIT_DESKTOP_MODE_TYPES.value + 11),
+    DESKTOP_MODE_TOGGLE_RESIZE(TRANSIT_DESKTOP_MODE_TYPES.value + 12);
 
     companion object {
         fun fromInt(value: Int) = entries.first { it.value == value }
diff --git a/libraries/flicker/utils/test/src/android/tools/io/ArtifactBuilderTest.kt b/libraries/flicker/utils/test/src/android/tools/io/ArtifactBuilderTest.kt
index 48d5ff1d1..c64e63d87 100644
--- a/libraries/flicker/utils/test/src/android/tools/io/ArtifactBuilderTest.kt
+++ b/libraries/flicker/utils/test/src/android/tools/io/ArtifactBuilderTest.kt
@@ -87,7 +87,9 @@ class ArtifactBuilderTest {
         Truth.assertWithMessage("Different files")
             .that(artifact2.file.name)
             .isNotEqualTo(artifact1.file.name)
-        Truth.assertWithMessage("Artifact 2 name").that(artifact2.file.name).endsWith("_1.zip")
+        Truth.assertWithMessage("Artifact 2 name")
+            .that(artifact2.file.name)
+            .endsWith("_1.winscope.zip")
     }
 
     @Test
diff --git a/libraries/flicker/utils/test/src/android/tools/parsers/wm/TransitionsTraceParserTest.kt b/libraries/flicker/utils/test/src/android/tools/parsers/wm/TransitionsTraceParserTest.kt
new file mode 100644
index 000000000..af20edce4
--- /dev/null
+++ b/libraries/flicker/utils/test/src/android/tools/parsers/wm/TransitionsTraceParserTest.kt
@@ -0,0 +1,70 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.tools.parsers.wm
+
+import android.tools.Cache
+import android.tools.testutils.CleanFlickerEnvironmentRule
+import android.tools.testutils.readAsset
+import android.tools.traces.parsers.perfetto.TraceProcessorSession
+import android.tools.traces.parsers.perfetto.TransitionsTraceParser
+import com.google.common.truth.Truth
+import org.junit.Assume
+import org.junit.Before
+import org.junit.ClassRule
+import org.junit.Test
+
+/** Tests for [TransitionsTraceParser] */
+class TransitionsTraceParserTest {
+    @Before
+    fun before() {
+        Assume.assumeTrue(android.tracing.Flags.perfettoTransitionTracing())
+        Cache.clear()
+    }
+
+    @Test
+    fun canParse() {
+        TraceProcessorSession.loadPerfettoTrace(readAsset("transitions.perfetto-trace")) { session
+            ->
+            val trace = TransitionsTraceParser().parse(session)
+            Truth.assertWithMessage("Unable to parse dump").that(trace.entries).hasSize(4)
+        }
+    }
+
+    @Test
+    fun canParseTimestamps() {
+        TraceProcessorSession.loadPerfettoTrace(readAsset("transitions.perfetto-trace")) { session
+            ->
+            val trace = TransitionsTraceParser().parse(session)
+            Truth.assertWithMessage("Has all timestamps")
+                .that(trace.entries.first().timestamp.hasAllTimestamps)
+                .isTrue()
+            Truth.assertWithMessage("Has unix timestamps")
+                .that(trace.entries.first().timestamp.unixNanos)
+                .isEqualTo(1700573425428925648L)
+            Truth.assertWithMessage("Has elapsed timestamps")
+                .that(trace.entries.first().timestamp.elapsedNanos)
+                .isEqualTo(479583450794L)
+            Truth.assertWithMessage("Has uptime timestamps")
+                .that(trace.entries.first().timestamp.systemUptimeNanos)
+                .isEqualTo(479583450997L)
+        }
+    }
+
+    companion object {
+        @ClassRule @JvmField val ENV_CLEANUP = CleanFlickerEnvironmentRule()
+    }
+}
diff --git a/libraries/flicker/utils/test/src/android/tools/testutils/Utils.kt b/libraries/flicker/utils/test/src/android/tools/testutils/Utils.kt
index 181d65d61..8f3aa3c11 100644
--- a/libraries/flicker/utils/test/src/android/tools/testutils/Utils.kt
+++ b/libraries/flicker/utils/test/src/android/tools/testutils/Utils.kt
@@ -266,7 +266,7 @@ fun assertExceptionMessage(error: Throwable?, expectedValue: String) {
 }
 
 fun outputFileName(status: RunStatus) =
-    File("/sdcard/flicker/${status.prefix}__test_ROTATION_0_GESTURAL_NAV.zip")
+    File("/sdcard/flicker/${status.prefix}__test_ROTATION_0_GESTURAL_NAV.winscope.zip")
 
 fun createDefaultArtifactBuilder(
     status: RunStatus,
diff --git a/libraries/health/rules/src/android/platform/test/rule/BaseOrientationRule.kt b/libraries/health/rules/src/android/platform/test/rule/BaseOrientationRule.kt
index ead752812..9a28772a2 100644
--- a/libraries/health/rules/src/android/platform/test/rule/BaseOrientationRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/BaseOrientationRule.kt
@@ -23,7 +23,7 @@ import android.platform.test.rule.Orientation.PORTRAIT
 import android.platform.test.rule.RotationUtils.clearOrientationOverride
 import android.platform.test.rule.RotationUtils.setOrientationOverride
 import android.platform.test.util.HealthTestingUtils.waitForValueToSettle
-import android.platform.uiautomator_helpers.WaitUtils.ensureThat
+import android.platform.uiautomatorhelpers.WaitUtils.ensureThat
 import android.util.Log
 import androidx.test.InstrumentationRegistry
 import androidx.test.uiautomator.UiDevice
@@ -47,7 +47,7 @@ class NaturalOrientationRule : BaseOrientationRule(NATURAL)
 enum class Orientation {
     LANDSCAPE,
     PORTRAIT,
-    NATURAL
+    NATURAL,
 }
 
 /** Returns whether the device is landscape or portrait , based on display dimensions. */
@@ -78,7 +78,7 @@ private val UiDevice.stableOrientation: Orientation
             /* errorMessage= */ { "Device orientation didn't settle" },
             /* supplier */ { orientation },
             /* minimumSettleTime= */ 1_000,
-            /* timeoutMs= */ 5_000
+            /* timeoutMs= */ 5_000,
         )
 
 /** Uses launcher rect to decide which rotation to apply to match [expectedOrientation]. */
@@ -111,7 +111,7 @@ object RotationUtils {
      */
     fun setOrientationOverride(
         orientation: Orientation,
-        timeoutDuration: Duration = Duration.ofSeconds(10)
+        timeoutDuration: Duration = Duration.ofSeconds(10),
     ) {
         val expectedOrientation =
             if (orientation == NATURAL) device.naturalOrientation else orientation
@@ -125,7 +125,7 @@ object RotationUtils {
         ensureThat(
             "orientation is $expectedOrientation",
             timeout = timeoutDuration,
-            ignoreException = true
+            ignoreException = true,
         ) {
             changeOrientation()
             device.stableOrientation == expectedOrientation
diff --git a/libraries/health/rules/src/android/platform/test/rule/BubbleBarRule.kt b/libraries/health/rules/src/android/platform/test/rule/BubbleBarRule.kt
deleted file mode 100644
index 246b5f47c..000000000
--- a/libraries/health/rules/src/android/platform/test/rule/BubbleBarRule.kt
+++ /dev/null
@@ -1,49 +0,0 @@
-/*
- * Copyright (C) 2023 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package android.platform.test.rule
-
-import android.os.SystemProperties
-import org.junit.runner.Description
-
-/**
- * Test rule that enables the bubble bar flag.
- *
- * Note that for the bubble bar to be enabled, taskbar must be restarted in transient mode and
- * navigation mode must be set to NO_BUTTON.
- *
- * @see TaskbarModeSwitchRule
- * @see NavigationModeRule
- */
-class BubbleBarRule : TestWatcher() {
-
-    private var wasBubbleBarEnabled = false
-
-    override fun starting(description: Description?) {
-        wasBubbleBarEnabled = SystemProperties.get(BUBBLE_BAR_SYS_PROP) == "1"
-        if (!wasBubbleBarEnabled) {
-            SystemProperties.set(BUBBLE_BAR_SYS_PROP, "1")
-        }
-    }
-
-    override fun finished(description: Description?) {
-        if (!wasBubbleBarEnabled) {
-            SystemProperties.set(BUBBLE_BAR_SYS_PROP, "0")
-        }
-    }
-}
-
-private const val BUBBLE_BAR_SYS_PROP = "persist.wm.debug.bubble_bar"
diff --git a/libraries/health/rules/src/android/platform/test/rule/CustomClockRule.kt b/libraries/health/rules/src/android/platform/test/rule/CustomClockRule.kt
index 10cada44a..33acc4cbe 100644
--- a/libraries/health/rules/src/android/platform/test/rule/CustomClockRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/CustomClockRule.kt
@@ -16,13 +16,13 @@
 
 package android.platform.test.rule
 
-import android.platform.uiautomator_helpers.DeviceHelpers.context
+import android.platform.uiautomatorhelpers.DeviceHelpers.context
 import android.provider.Settings
 
 class CustomClockRule(private val customClock: CustomClock) :
     SecureSettingRule<String>(
         Settings.Secure.LOCK_SCREEN_CUSTOM_CLOCK_FACE,
-        initialValue = """{"clockId":"${customClock.name}"}"""
+        initialValue = """{"clockId":"${customClock.name}"}""",
     ) {
 
     fun isLockscreenCustomClockSet(): Boolean {
@@ -30,7 +30,7 @@ class CustomClockRule(private val customClock: CustomClock) :
         val customClockFace =
             Settings.Secure.getString(
                 contentResolver,
-                Settings.Secure.LOCK_SCREEN_CUSTOM_CLOCK_FACE
+                Settings.Secure.LOCK_SCREEN_CUSTOM_CLOCK_FACE,
             )
         return customClockFace == """{"clockId":"${customClock.name}"}"""
     }
@@ -40,7 +40,6 @@ class CustomClockRule(private val customClock: CustomClock) :
         ANALOG_CLOCK_BIGNUM,
         DIGITAL_CLOCK_WEATHER,
         DIGITAL_CLOCK_METRO,
-        DIGITAL_CLOCK_HANDWRITTEN,
         DIGITAL_CLOCK_GROWTH,
         DIGITAL_CLOCK_NUMBEROVERLAP,
         DIGITAL_CLOCK_CALLIGRAPHY,
diff --git a/libraries/health/rules/src/android/platform/test/rule/DisableAnimationsRule.kt b/libraries/health/rules/src/android/platform/test/rule/DisableAnimationsRule.kt
index bd714634d..f5d2f4bde 100644
--- a/libraries/health/rules/src/android/platform/test/rule/DisableAnimationsRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/DisableAnimationsRule.kt
@@ -16,11 +16,11 @@
 
 package android.platform.test.rule
 
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
 import org.junit.rules.TestWatcher
 import org.junit.runner.Description
 
-class DisableAnimationsRule: TestWatcher() {
+class DisableAnimationsRule : TestWatcher() {
     private var prevAnimationState: AnimationState = defaultAnimationState
     private var animationState: AnimationState
         get() =
@@ -52,4 +52,4 @@ class DisableAnimationsRule: TestWatcher() {
         val disabledAnimationState = AnimationState(transitions = 0f, windows = 0f, animators = 0f)
         val defaultAnimationState = AnimationState(transitions = 1f, windows = 1f, animators = 1f)
     }
-}
\ No newline at end of file
+}
diff --git a/libraries/health/rules/src/android/platform/test/rule/EnsureDeviceSettingsRule.kt b/libraries/health/rules/src/android/platform/test/rule/EnsureDeviceSettingsRule.kt
index ff64ee098..866de41fd 100644
--- a/libraries/health/rules/src/android/platform/test/rule/EnsureDeviceSettingsRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/EnsureDeviceSettingsRule.kt
@@ -1,7 +1,7 @@
 package android.platform.test.rule
 
 import android.os.SystemProperties
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
 import android.provider.Settings
 import org.junit.runner.Description
 
@@ -13,6 +13,7 @@ import org.junit.runner.Description
 class EnsureDeviceSettingsRule : TestWatcher() {
 
     private val setupErrors = mutableListOf<SetupError>()
+
     override fun starting(description: Description?) {
         checkAdbRootEnabled()
         checkTestHarnessEnabled()
@@ -27,7 +28,7 @@ class EnsureDeviceSettingsRule : TestWatcher() {
             setupErrors.add(
                 SetupError(
                     description = "ADB root access is required but disabled.",
-                    adbCommandToFixIt = "adb root"
+                    adbCommandToFixIt = "adb root",
                 )
             )
         }
@@ -56,13 +57,13 @@ class EnsureDeviceSettingsRule : TestWatcher() {
         val stayAwakeResult =
             Settings.Global.getInt(
                 context.contentResolver,
-                Settings.Global.STAY_ON_WHILE_PLUGGED_IN
+                Settings.Global.STAY_ON_WHILE_PLUGGED_IN,
             )
         if (stayAwakeResult == 0) {
             setupErrors.add(
                 SetupError(
                     description = "'Stay awake' option in developer settings should be enabled",
-                    adbCommandToFixIt = "adb shell settings put global stay_on_while_plugged_in 7"
+                    adbCommandToFixIt = "adb shell settings put global stay_on_while_plugged_in 7",
                 )
             )
         }
@@ -87,10 +88,7 @@ class EnsureDeviceSettingsRule : TestWatcher() {
         )
     }
 
-    private data class SetupError(
-        val description: String,
-        val adbCommandToFixIt: String,
-    )
+    private data class SetupError(val description: String, val adbCommandToFixIt: String)
 
     private companion object {
         const val TEST_HARNESS_PROP = "ro.test_harness"
diff --git a/libraries/health/rules/src/android/platform/test/rule/InputDeviceRule.kt b/libraries/health/rules/src/android/platform/test/rule/InputDeviceRule.kt
index e54f34caa..66ed72253 100644
--- a/libraries/health/rules/src/android/platform/test/rule/InputDeviceRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/InputDeviceRule.kt
@@ -18,7 +18,7 @@ package android.platform.test.rule
 import android.hardware.input.InputManager
 import android.os.ParcelFileDescriptor
 import android.platform.helpers.uinput.UInputDevice
-import android.platform.uiautomator_helpers.DeviceHelpers
+import android.platform.uiautomatorhelpers.DeviceHelpers
 import android.util.Log
 import android.view.InputDevice
 import androidx.core.content.getSystemService
@@ -86,7 +86,7 @@ class InputDeviceRule : TestWatcher(), UInputDevice.EventInjector {
 
         inputManager.registerInputDeviceListener(
             inputDeviceListenerDelegate,
-            DeviceHelpers.context.mainThreadHandler
+            DeviceHelpers.context.mainThreadHandler,
         )
     }
 
@@ -196,7 +196,7 @@ class InputDeviceRule : TestWatcher(), UInputDevice.EventInjector {
 
         Log.d(
             "InputDeviceRule",
-            "'$EVENT_REPLAY_COMPLETE_SYNC_TOKEN' sync token sent, waiting for it to be processed..."
+            "'$EVENT_REPLAY_COMPLETE_SYNC_TOKEN' sync token sent, waiting for it to be processed...",
         )
         var nextSyncToken: String? = null
         while (nextSyncToken != EVENT_REPLAY_COMPLETE_SYNC_TOKEN) {
diff --git a/libraries/health/rules/src/android/platform/test/rule/NoAppRenderingRule.java b/libraries/health/rules/src/android/platform/test/rule/NoAppRenderingRule.java
new file mode 100644
index 000000000..01af4056a
--- /dev/null
+++ b/libraries/health/rules/src/android/platform/test/rule/NoAppRenderingRule.java
@@ -0,0 +1,54 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package android.platform.test.rule;
+
+import androidx.annotation.VisibleForTesting;
+
+import org.junit.runner.Description;
+
+/**
+ * This rule will stop new rendering before/after running each test method.
+ *
+ * If an application is already open, then it will continue to be rendered. It's
+ * only for new applications that rendering will stop. This shouldn't restrict
+ * the use of UI automation.
+ *
+ * The current use of this rule is to test some performance user journeys on
+ * Cuttlefish, which has performance overhead under certain configurations.
+ */
+public class NoAppRenderingRule extends TestWatcher {
+
+    @VisibleForTesting
+    static final String STOP_NEW_RENDERING = "stop-new-rendering";
+
+    @Override
+    protected void starting(Description description) {
+        if (isEnabled()) {
+            executeShellCommand("setprop debug.hwui.drawing_enabled 0");
+        }
+    }
+
+    @Override
+    protected void finished(Description description) {
+        if (isEnabled()) {
+            executeShellCommand("setprop debug.hwui.drawing_enabled 1");
+        }
+    }
+
+    private boolean isEnabled() {
+        return Boolean.parseBoolean(getArguments().getString(STOP_NEW_RENDERING, "false"));
+    }
+}
diff --git a/libraries/health/rules/src/android/platform/test/rule/NotesRoleManagerSecondaryUserRule.kt b/libraries/health/rules/src/android/platform/test/rule/NotesRoleManagerSecondaryUserRule.kt
index 778ee49cf..ad9d43dc1 100644
--- a/libraries/health/rules/src/android/platform/test/rule/NotesRoleManagerSecondaryUserRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/NotesRoleManagerSecondaryUserRule.kt
@@ -24,7 +24,7 @@ import android.app.role.RoleManager
 import android.os.Build
 import android.os.UserHandle
 import android.platform.helpers.notesrole.NotesRoleUtil
-import android.platform.uiautomator_helpers.DeviceHelpers
+import android.platform.uiautomatorhelpers.DeviceHelpers
 import android.system.helpers.UserHelper
 import android.util.Log
 import androidx.core.content.getSystemService
@@ -68,7 +68,7 @@ constructor(
         // workaround to run the test on select few devices.
         notesRoleUtil.checkAndroidRolePackageAssumptions(
             requiredAndroidVersion,
-            requiredNotesRoleHolderPackage
+            requiredNotesRoleHolderPackage,
         )
 
         // Update original user's notes role holder to none. This helps with confidently verifying
@@ -138,7 +138,7 @@ constructor(
     private fun getCurrentUserId() =
         notesRoleUtil.callWithShellIdentityPermissions(
             INTERACT_ACROSS_USERS,
-            INTERACT_ACROSS_USERS_FULL
+            INTERACT_ACROSS_USERS_FULL,
         ) {
             ActivityManager.getCurrentUser()
         }
diff --git a/libraries/health/rules/src/android/platform/test/rule/ScreenRecordRule.kt b/libraries/health/rules/src/android/platform/test/rule/ScreenRecordRule.kt
index 1d13daf2c..08a45c962 100644
--- a/libraries/health/rules/src/android/platform/test/rule/ScreenRecordRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/ScreenRecordRule.kt
@@ -21,11 +21,11 @@ import android.os.ParcelFileDescriptor.AutoCloseInputStream
 import android.platform.test.rule.ScreenRecordRule.Companion.SCREEN_RECORDING_CLASS_LEVEL_OVERRIDE_KEY
 import android.platform.test.rule.ScreenRecordRule.Companion.SCREEN_RECORDING_TEST_LEVEL_OVERRIDE_KEY
 import android.platform.test.rule.ScreenRecordRule.ScreenRecord
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
-import android.platform.uiautomator_helpers.FailedEnsureException
-import android.platform.uiautomator_helpers.WaitUtils.ensureThat
-import android.platform.uiautomator_helpers.WaitUtils.waitFor
-import android.platform.uiautomator_helpers.WaitUtils.waitForValueToSettle
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.FailedEnsureException
+import android.platform.uiautomatorhelpers.WaitUtils.ensureThat
+import android.platform.uiautomatorhelpers.WaitUtils.waitFor
+import android.platform.uiautomatorhelpers.WaitUtils.waitForValueToSettle
 import android.util.Log
 import androidx.test.InstrumentationRegistry.getInstrumentation
 import androidx.test.platform.app.InstrumentationRegistry
@@ -118,8 +118,10 @@ constructor(
 
     private fun classLevelOverrideEnabled() =
         screenRecordOverrideEnabled(SCREEN_RECORDING_CLASS_LEVEL_OVERRIDE_KEY)
+
     private fun testLevelOverrideEnabled() =
         screenRecordOverrideEnabled(SCREEN_RECORDING_TEST_LEVEL_OVERRIDE_KEY)
+
     /**
      * This is needed to enable screen recording when a parameter is passed to the instrumentation,
      * avoid having to recompile the test.
@@ -141,7 +143,7 @@ constructor(
             Log.w(
                 TAG,
                 "Multiple screen recording in progress (pids=\"$screenrecordPids\"). " +
-                    "This might cause performance issues."
+                    "This might cause performance issues.",
             )
         }
         // --bugreport adds the timestamp as overlay
@@ -193,7 +195,7 @@ constructor(
             Log.w(
                 TAG,
                 "Other screen recordings are in progress after this is done. " +
-                    "(pids=\"$screenrecordPids\")."
+                    "(pids=\"$screenrecordPids\").",
             )
         }
     }
@@ -210,7 +212,7 @@ constructor(
         try {
             waitForValueToSettle(
                 "Screen recording output size",
-                minimumSettleTime = Duration.ofSeconds(5)
+                minimumSettleTime = Duration.ofSeconds(5),
             ) {
                 length()
             }
diff --git a/libraries/health/rules/src/android/platform/test/rule/SecureSettingRule.kt b/libraries/health/rules/src/android/platform/test/rule/SecureSettingRule.kt
index 054a652f7..fce6f8f7f 100644
--- a/libraries/health/rules/src/android/platform/test/rule/SecureSettingRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/SecureSettingRule.kt
@@ -1,13 +1,11 @@
 package android.platform.test.rule
 
-import android.platform.uiautomator_helpers.DeviceHelpers.context
+import android.platform.uiautomatorhelpers.DeviceHelpers.context
 import android.provider.Settings
 
 /** Base rule to set values in [Settings.Secure]. The value is then reset at the end of the test. */
-open class SecureSettingRule<T : Any>(
-    private val settingName: String,
-    initialValue: T? = null,
-) : SettingRule<T>(initialValue) {
+open class SecureSettingRule<T : Any>(private val settingName: String, initialValue: T? = null) :
+    SettingRule<T>(initialValue) {
 
     override fun getSettingValueAsString(): String? =
         Settings.Secure.getString(context.contentResolver, settingName)
diff --git a/libraries/health/rules/src/android/platform/test/rule/SetDefaultVolumeRule.kt b/libraries/health/rules/src/android/platform/test/rule/SetDefaultVolumeRule.kt
index 9ea69b98a..d33315be8 100644
--- a/libraries/health/rules/src/android/platform/test/rule/SetDefaultVolumeRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/SetDefaultVolumeRule.kt
@@ -17,7 +17,7 @@
 package android.platform.test.rule
 
 import android.media.AudioManager
-import android.platform.uiautomator_helpers.DeviceHelpers
+import android.platform.uiautomatorhelpers.DeviceHelpers
 import androidx.annotation.VisibleForTesting
 import org.junit.runner.Description
 
@@ -31,7 +31,7 @@ class SetDefaultVolumeRule(private val volumeIndex: Int) : TestWatcher() {
         mAudioManager.setStreamVolume(
             AudioManager.STREAM_MUSIC,
             volumeIndex,
-            0 // Do nothing, prevent opening UI.
+            0, // Do nothing, prevent opening UI.
         )
     }
 
diff --git a/libraries/health/rules/src/android/platform/test/rule/SettingRule.kt b/libraries/health/rules/src/android/platform/test/rule/SettingRule.kt
index 261a99b7e..c4034a0bc 100644
--- a/libraries/health/rules/src/android/platform/test/rule/SettingRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/SettingRule.kt
@@ -1,6 +1,6 @@
 package android.platform.test.rule
 
-import android.platform.uiautomator_helpers.WaitUtils.ensureThat
+import android.platform.uiautomatorhelpers.WaitUtils.ensureThat
 import android.provider.Settings
 import org.junit.rules.ExternalResource
 
@@ -8,9 +8,7 @@ private val supportedTypes =
     listOf(Boolean::class, Int::class, Long::class, Float::class, String::class)
 
 /** Base rule to set values in [Settings]. The value is then reset at the end of the test. */
-abstract class SettingRule<T>(
-    private val initialValue: T? = null,
-) : ExternalResource() {
+abstract class SettingRule<T>(private val initialValue: T? = null) : ExternalResource() {
 
     private var originalValueAsString: String? = null
 
diff --git a/libraries/health/rules/src/android/platform/test/rule/SystemSettingRule.kt b/libraries/health/rules/src/android/platform/test/rule/SystemSettingRule.kt
index 8e6f88938..371f03068 100644
--- a/libraries/health/rules/src/android/platform/test/rule/SystemSettingRule.kt
+++ b/libraries/health/rules/src/android/platform/test/rule/SystemSettingRule.kt
@@ -1,14 +1,12 @@
 package android.platform.test.rule
 
-import android.platform.uiautomator_helpers.DeviceHelpers.context
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.DeviceHelpers.context
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
 import android.provider.Settings
 
 /** Base rule to set values in [Settings.System]. The value is then reset at the end of the test. */
-open class SystemSettingRule<T : Any>(
-    private val settingName: String,
-    initialValue: T? = null,
-) : SettingRule<T>(initialValue) {
+open class SystemSettingRule<T : Any>(private val settingName: String, initialValue: T? = null) :
+    SettingRule<T>(initialValue) {
 
     override fun getSettingValueAsString(): String? =
         Settings.System.getString(context.contentResolver, settingName)
diff --git a/libraries/health/rules/src/android/platform/test/rule/UnlockScreenRule.java b/libraries/health/rules/src/android/platform/test/rule/UnlockScreenRule.java
index 1fbbd2a8e..3c7350d1c 100644
--- a/libraries/health/rules/src/android/platform/test/rule/UnlockScreenRule.java
+++ b/libraries/health/rules/src/android/platform/test/rule/UnlockScreenRule.java
@@ -15,9 +15,7 @@
  */
 package android.platform.test.rule;
 
-import static android.platform.uiautomator_helpers.DeviceHelpers.assertInvisible;
-
-import static com.android.systemui.Flags.keyguardBottomAreaRefactor;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.assertInvisible;
 
 import android.os.RemoteException;
 
@@ -26,6 +24,8 @@ import androidx.test.uiautomator.By;
 import androidx.test.uiautomator.BySelector;
 import androidx.test.uiautomator.UiDevice;
 
+import com.android.systemui.Flags;
+
 import org.junit.runner.Description;
 
 import java.time.Duration;
@@ -33,11 +33,10 @@ import java.time.Duration;
 /** This rule will unlock phone screen before a test case. */
 public class UnlockScreenRule extends TestWatcher {
 
-    protected static final BySelector KEYGUARD_BOTTOM_AREA_VIEW =
-            By.res("com.android.systemui", "keyguard_bottom_area");
-
     protected static final BySelector KEYGUARD_ROOT_VIEW =
-            By.res("com.android.systemui", "keyguard_root_view");
+            Flags.sceneContainer()
+                    ? By.res("element:lockscreen")
+                    : By.res("com.android.systemui", "keyguard_root_view");
 
     @Override
     protected void starting(Description description) {
@@ -57,11 +56,7 @@ public class UnlockScreenRule extends TestWatcher {
             }
 
             BySelector screenLock;
-            if (keyguardBottomAreaRefactor()) {
-                screenLock = KEYGUARD_ROOT_VIEW;
-            } else {
-                screenLock = KEYGUARD_BOTTOM_AREA_VIEW;
-            }
+            screenLock = KEYGUARD_ROOT_VIEW;
 
             if (uiDevice.hasObject(screenLock)) {
                 uiDevice.pressMenu();
diff --git a/libraries/health/rules/tests/src/android/platform/test/rule/NoAppRenderingRuleTest.java b/libraries/health/rules/tests/src/android/platform/test/rule/NoAppRenderingRuleTest.java
new file mode 100644
index 000000000..2b394a799
--- /dev/null
+++ b/libraries/health/rules/tests/src/android/platform/test/rule/NoAppRenderingRuleTest.java
@@ -0,0 +1,104 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package android.platform.test.rule;
+
+import static com.google.common.truth.Truth.assertThat;
+
+import static org.junit.runner.Description.createTestDescription;
+
+import android.os.Bundle;
+
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.junit.runners.JUnit4;
+import org.junit.runners.model.Statement;
+
+import java.util.ArrayList;
+import java.util.List;
+
+/** Unit test the logic for {@link NoAppRenderingRule} */
+@RunWith(JUnit4.class)
+public class NoAppRenderingRuleTest {
+    /** Tests the rule will not run any commands by default. */
+    @Test
+    public void testNoAppRenderingRule_disabledByDefault() throws Throwable {
+        Bundle empty = new Bundle();
+        TestableNoAppRenderingRule rule = new TestableNoAppRenderingRule(empty);
+
+        rule.apply(rule.getTestStatement(), createTestDescription("clzz", "mthd")).evaluate();
+        assertThat(rule.getOperations()).containsExactly("test");
+    }
+
+    /** Tests the rule will not run any commands when disabled. */
+    @Test
+    public void testNoAppRenderingRule_disabledByFlag() throws Throwable {
+        Bundle noAppRenderingBundle = new Bundle();
+        noAppRenderingBundle.putString(NoAppRenderingRule.STOP_NEW_RENDERING, "false");
+        TestableNoAppRenderingRule rule = new TestableNoAppRenderingRule(noAppRenderingBundle);
+
+        rule.apply(rule.getTestStatement(), createTestDescription("clzz", "mthd")).evaluate();
+        assertThat(rule.getOperations()).containsExactly("test");
+    }
+
+    /** Tests the rule will run the commands when enabled. */
+    @Test
+    public void testNoAppRenderingRule_enabledByFlag() throws Throwable {
+        Bundle noAppRenderingBundle = new Bundle();
+        noAppRenderingBundle.putString(NoAppRenderingRule.STOP_NEW_RENDERING, "true");
+        TestableNoAppRenderingRule rule = new TestableNoAppRenderingRule(noAppRenderingBundle);
+
+        rule.apply(rule.getTestStatement(), createTestDescription("clzz", "mthd")).evaluate();
+        assertThat(rule.getOperations())
+                .containsExactly(
+                        "setprop debug.hwui.drawing_enabled 0",
+                        "test",
+                        "setprop debug.hwui.drawing_enabled 1")
+                .inOrder();
+    }
+
+    private static class TestableNoAppRenderingRule extends NoAppRenderingRule {
+        private List<String> mOperations = new ArrayList<>();
+        private Bundle mBundle;
+
+        TestableNoAppRenderingRule(Bundle bundle) {
+            mBundle = bundle;
+        }
+
+        @Override
+        protected String executeShellCommand(String cmd) {
+            mOperations.add(cmd);
+            return "";
+        }
+
+        @Override
+        protected Bundle getArguments() {
+            return mBundle;
+        }
+
+        public List<String> getOperations() {
+            return mOperations;
+        }
+
+        public Statement getTestStatement() {
+            return new Statement() {
+                @Override
+                public void evaluate() throws Throwable {
+                    mOperations.add("test");
+                }
+            };
+        }
+    }
+}
diff --git a/libraries/health/rules/tests/src/android/platform/test/rule/UnlockScreenRuleTest.java b/libraries/health/rules/tests/src/android/platform/test/rule/UnlockScreenRuleTest.java
index 34561c81d..0379556c9 100644
--- a/libraries/health/rules/tests/src/android/platform/test/rule/UnlockScreenRuleTest.java
+++ b/libraries/health/rules/tests/src/android/platform/test/rule/UnlockScreenRuleTest.java
@@ -15,8 +15,6 @@
  */
 package android.platform.test.rule;
 
-import static com.android.systemui.Flags.keyguardBottomAreaRefactor;
-
 import static org.mockito.Mockito.times;
 import static org.mockito.Mockito.verify;
 import static org.mockito.Mockito.when;
@@ -99,11 +97,7 @@ public class UnlockScreenRuleTest {
         @Override
         protected UiDevice getUiDevice() {
             BySelector screenLock;
-            if (keyguardBottomAreaRefactor()) {
-                screenLock = KEYGUARD_ROOT_VIEW;
-            } else {
-                screenLock = KEYGUARD_BOTTOM_AREA_VIEW;
-            }
+            screenLock = KEYGUARD_ROOT_VIEW;
 
             try {
                 when(mUiDevice.isScreenOn()).thenReturn(mIsScreenOn);
diff --git a/libraries/health/runners/microbenchmark/src/android/platform/test/microbenchmark/Microbenchmark.java b/libraries/health/runners/microbenchmark/src/android/platform/test/microbenchmark/Microbenchmark.java
index 3fbedd3ff..e855c1488 100644
--- a/libraries/health/runners/microbenchmark/src/android/platform/test/microbenchmark/Microbenchmark.java
+++ b/libraries/health/runners/microbenchmark/src/android/platform/test/microbenchmark/Microbenchmark.java
@@ -19,6 +19,7 @@ import static android.content.Context.BATTERY_SERVICE;
 import static android.os.BatteryManager.BATTERY_PROPERTY_CAPACITY;
 import static android.os.BatteryManager.BATTERY_PROPERTY_CHARGE_COUNTER;
 
+import android.device.collectors.BaseMetricListener.IterationMetadata;
 import android.os.BatteryManager;
 import android.os.Bundle;
 import android.os.SystemClock;
@@ -52,7 +53,6 @@ import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
 import java.lang.annotation.Target;
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
@@ -231,22 +231,7 @@ public class Microbenchmark extends BlockJUnit4ClassRunner {
      */
     @Override
     protected Statement methodInvoker(FrameworkMethod method, Object test) {
-        // Iterate on the test method multiple times for more data. If unset, defaults to 1.
-        Iterate<Statement> methodIterator = new Iterate<Statement>();
-        methodIterator.setOptionName("method-iterations");
-        final List<Statement> testMethodStatement =
-                methodIterator.apply(
-                        mArguments,
-                        Arrays.asList(new Statement[] {super.methodInvoker(method, test)}));
-        Statement start =
-                new Statement() {
-                    @Override
-                    public void evaluate() throws Throwable {
-                        for (Statement method : testMethodStatement) {
-                            method.evaluate();
-                        }
-                    }
-                };
+        Statement start = super.methodInvoker(method, test);
         // Wrap the multiple-iteration test method with trace points.
         start = getTracePointRule().apply(start, describeChild(method));
         // Invoke special @TightMethodRules that wrap @Test methods.
@@ -337,13 +322,18 @@ public class Microbenchmark extends BlockJUnit4ClassRunner {
         if (!mRenameIterations) {
             return original;
         }
+
+        final int iteration = mIterations.getOrDefault(original, 0);
+        final List<Annotation> annotations = new ArrayList<>(original.getAnnotations());
+        annotations.add(new IterationMetadata(iteration));
+
         return Description.createTestDescription(
                 original.getTestClass(),
                 String.join(
                         mIterationSep,
                         original.getMethodName(),
-                        String.valueOf(mIterations.get(original))),
-                original.getAnnotations().toArray(Annotation[]::new));
+                        String.valueOf(iteration)),
+                annotations.toArray(Annotation[]::new));
     }
 
     /** Re-implement the private rules wrapper from {@link BlockJUnit4ClassRunner} in JUnit 4.12. */
diff --git a/libraries/health/runners/microbenchmark/tests/src/android/platform/test/microbenchmark/MicrobenchmarkTest.java b/libraries/health/runners/microbenchmark/tests/src/android/platform/test/microbenchmark/MicrobenchmarkTest.java
index 105a19a5c..acbb2e488 100644
--- a/libraries/health/runners/microbenchmark/tests/src/android/platform/test/microbenchmark/MicrobenchmarkTest.java
+++ b/libraries/health/runners/microbenchmark/tests/src/android/platform/test/microbenchmark/MicrobenchmarkTest.java
@@ -23,6 +23,8 @@ import static org.mockito.Mockito.doReturn;
 import static org.mockito.Mockito.never;
 import static org.mockito.Mockito.verify;
 
+import android.device.collectors.BaseMetricListener;
+import android.device.collectors.BaseMetricListener.IterationMetadata;
 import android.os.Bundle;
 import android.os.SystemClock;
 import android.platform.test.microbenchmark.Microbenchmark.NoMetricAfter;
@@ -53,6 +55,7 @@ import org.junit.runners.model.Statement;
 import org.mockito.ArgumentCaptor;
 import org.mockito.Mockito;
 
+import java.lang.annotation.Annotation;
 import java.lang.annotation.ElementType;
 import java.lang.annotation.Retention;
 import java.lang.annotation.RetentionPolicy;
@@ -263,49 +266,48 @@ public final class MicrobenchmarkTest {
                 .inOrder();
     }
 
-    /**
-     * Test iteration number are not added to the test name when explictly disabled.
-     *
-     * Before --> TightBefore --> Trace (begin) --> Test --> Trace(end) --> TightAfter
-     *  --> After
-     */
     @Test
-    public void testMultipleIterationsWithoutRename() throws InitializationError {
+    public void testMultipleIterationsWithRename_iterationAnnotationPresent()
+            throws InitializationError {
         Bundle args = new Bundle();
-        args.putString("iterations", "1");
-        args.putString("rename-iterations", "false");
-        LoggingMicrobenchmark loggingRunner = new LoggingMicrobenchmark(LoggingTest.class, args);
+        args.putString("iterations", "2");
+        args.putString("rename-iterations", "true");
+        args.putString("iteration-separator", "--");
+        LoggingMicrobenchmark loggingRunner = new LoggingMicrobenchmark(
+                LoggingTestIterationTest.class, args);
+
         Result result = new JUnitCore().run(loggingRunner);
+
         assertThat(result.wasSuccessful()).isTrue();
         assertThat(sLogs)
                 .containsExactly(
-                        "@NoMetricRule starting",
-                        "@NoMetricBefore",
-                        "@Before",
-                        "@TightMethodRule before",
-                        "begin: testMethod("
-                                + "android.platform.test.microbenchmark.MicrobenchmarkTest"
-                                + "$LoggingTest)",
-                        "@Test method body",
+                        "@Rule starting, iteration = 1",
+                        "begin: testMethod--1("
+                                + "android.platform.test.microbenchmark.MicrobenchmarkTest$"
+                                + "LoggingTestIterationTest)",
+                        "testMethod",
                         "end",
-                        "@TightMethodRule after",
-                        "@After",
-                        "@NoMetricAfter",
-                        "@NoMetricRule finished")
+                        "@Rule finished, iteration = 1",
+                        "@Rule starting, iteration = 2",
+                        "begin: testMethod--2("
+                                + "android.platform.test.microbenchmark.MicrobenchmarkTest$"
+                                + "LoggingTestIterationTest)",
+                        "testMethod",
+                        "end",
+                        "@Rule finished, iteration = 2")
                 .inOrder();
     }
 
     /**
-     * Test method iteration will iterate the inner-most test method N times.
+     * Test iteration number are not added to the test name when explictly disabled.
      *
-     * <p>Before --> TightBefore --> Trace (begin) --> Test x N --> Trace(end) --> TightAfter -->
-     * After
+     * Before --> TightBefore --> Trace (begin) --> Test --> Trace(end) --> TightAfter
+     *  --> After
      */
     @Test
-    public void testMultipleMethodIterations() throws InitializationError {
+    public void testMultipleIterationsWithoutRename() throws InitializationError {
         Bundle args = new Bundle();
         args.putString("iterations", "1");
-        args.putString("method-iterations", "10");
         args.putString("rename-iterations", "false");
         LoggingMicrobenchmark loggingRunner = new LoggingMicrobenchmark(LoggingTest.class, args);
         Result result = new JUnitCore().run(loggingRunner);
@@ -320,15 +322,6 @@ public final class MicrobenchmarkTest {
                                 + "android.platform.test.microbenchmark.MicrobenchmarkTest"
                                 + "$LoggingTest)",
                         "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
-                        "@Test method body",
                         "end",
                         "@TightMethodRule after",
                         "@After",
@@ -882,6 +875,38 @@ public final class MicrobenchmarkTest {
         }
     }
 
+    @RunWith(LoggingMicrobenchmark.class)
+    public static class LoggingTestIterationTest {
+        @Rule
+        public IterationLogRule rule = new IterationLogRule();
+
+        @Test
+        public void testMethod() {
+            sLogs.add("testMethod");
+        }
+
+        public static class IterationLogRule extends TestWatcher {
+            @Override
+            public void starting(Description description) {
+                sLogs.add("@Rule starting, iteration = " + extractIteration(description));
+            }
+
+            @Override
+            public void finished(Description description) {
+                sLogs.add("@Rule finished, iteration = " + extractIteration(description));
+            }
+
+            private int extractIteration(Description description) {
+                for (Annotation annotation : description.getAnnotations()) {
+                    if (annotation instanceof IterationMetadata) {
+                        return ((IterationMetadata) annotation).getIteration();
+                    }
+                }
+                return 0;
+            }
+        }
+    }
+
     public static class LoggingTestCreationFailure extends LoggingTest {
         public LoggingTestCreationFailure() {
             throw new RuntimeException("I failed.");
diff --git a/libraries/health/utils/src/android/platform/test/util/HealthTestingUtils.java b/libraries/health/utils/src/android/platform/test/util/HealthTestingUtils.java
index e8fb35dd2..2b8eb7f19 100644
--- a/libraries/health/utils/src/android/platform/test/util/HealthTestingUtils.java
+++ b/libraries/health/utils/src/android/platform/test/util/HealthTestingUtils.java
@@ -16,7 +16,7 @@
 
 package android.platform.test.util;
 
-import android.platform.uiautomator_helpers.WaitUtils;
+import android.platform.uiautomatorhelpers.WaitUtils;
 
 import androidx.test.uiautomator.StaleObjectException;
 
diff --git a/libraries/launcher-helper/src/android/support/test/launcherhelper/CommonLauncherHelper.java b/libraries/launcher-helper/src/android/support/test/launcherhelper/CommonLauncherHelper.java
index f3171ac64..196d5ef97 100644
--- a/libraries/launcher-helper/src/android/support/test/launcherhelper/CommonLauncherHelper.java
+++ b/libraries/launcher-helper/src/android/support/test/launcherhelper/CommonLauncherHelper.java
@@ -15,8 +15,6 @@
  */
 package android.support.test.launcherhelper;
 
-import static com.android.systemui.Flags.keyguardBottomAreaRefactor;
-
 import android.graphics.Rect;
 import android.os.RemoteException;
 import android.os.SystemClock;
@@ -46,9 +44,6 @@ public class CommonLauncherHelper {
     private static CommonLauncherHelper sInstance;
     private UiDevice mDevice;
 
-    private static final BySelector KEYGUARD_BOTTOM_AREA_VIEW =
-            By.res("com.android.systemui", "keyguard_bottom_area");
-
     private static final BySelector KEYGUARD_ROOT_VIEW =
             By.res("com.android.systemui", "keyguard_root_view");
 
@@ -252,11 +247,7 @@ public class CommonLauncherHelper {
         }
 
         BySelector screenLock;
-        if (keyguardBottomAreaRefactor()) {
-            screenLock = KEYGUARD_ROOT_VIEW;
-        } else {
-            screenLock = KEYGUARD_BOTTOM_AREA_VIEW;
-        }
+        screenLock = KEYGUARD_ROOT_VIEW;
 
         // Check for lock screen element
         if (mDevice.hasObject(screenLock)) {
diff --git a/libraries/launcher-helper/src/android/support/test/launcherhelper2/CommonLauncherHelper.java b/libraries/launcher-helper/src/android/support/test/launcherhelper2/CommonLauncherHelper.java
index 04515e289..4bae2dad4 100644
--- a/libraries/launcher-helper/src/android/support/test/launcherhelper2/CommonLauncherHelper.java
+++ b/libraries/launcher-helper/src/android/support/test/launcherhelper2/CommonLauncherHelper.java
@@ -15,8 +15,6 @@
  */
 package android.support.test.launcherhelper2;
 
-import static com.android.systemui.Flags.keyguardBottomAreaRefactor;
-
 import android.graphics.Rect;
 import android.os.RemoteException;
 import android.os.SystemClock;
@@ -45,9 +43,6 @@ public class CommonLauncherHelper {
     private static final int APP_LAUNCH_TIMEOUT = 10000;
     private static CommonLauncherHelper sInstance;
 
-    private static final BySelector KEYGUARD_BOTTOM_AREA_VIEW =
-            By.res("com.android.systemui", "keyguard_bottom_area");
-
     private static final BySelector KEYGUARD_ROOT_VIEW =
             By.res("com.android.systemui", "keyguard_root_view");
     private UiDevice mDevice;
@@ -262,11 +257,7 @@ public class CommonLauncherHelper {
         }
 
         BySelector screenLock;
-        if (keyguardBottomAreaRefactor()) {
-            screenLock = KEYGUARD_ROOT_VIEW;
-        } else {
-            screenLock = KEYGUARD_BOTTOM_AREA_VIEW;
-        }
+        screenLock = KEYGUARD_ROOT_VIEW;
 
         // Check for lock screen element
         if (mDevice.hasObject(screenLock)) {
diff --git a/libraries/motion/Android.bp b/libraries/motion/Android.bp
index 26331a683..5d66e6b6e 100644
--- a/libraries/motion/Android.bp
+++ b/libraries/motion/Android.bp
@@ -37,6 +37,21 @@ filegroup {
     ],
 }
 
+android_app {
+    name: "PlatformMotionTestingRoboApplication",
+
+    srcs: [
+        "src/com/**/*.java",
+        "com/**/*.kt",
+    ],
+    asset_dirs: ["compose/tests/goldens"],
+    platform_apis: true,
+    static_libs: [
+        "PlatformMotionTesting",
+        "PlatformMotionTestingCompose",
+    ],
+}
+
 android_library {
     name: "PlatformMotionTesting",
     manifest: "AndroidManifest.xml",
diff --git a/libraries/motion/AndroidTestTemplate.xml b/libraries/motion/AndroidTestTemplate.xml
index ec451ace1..9ef60f04a 100644
--- a/libraries/motion/AndroidTestTemplate.xml
+++ b/libraries/motion/AndroidTestTemplate.xml
@@ -18,6 +18,7 @@
 <configuration description="Android Motion Tests {MODULE}">
     <metrics_collector class="com.android.tradefed.device.metric.FilePullerLogCollector">
         <option name="directory-keys" value="/data/user/0/{PACKAGE}/files/goldens/" />
+        <option name="directory-keys" value="/data/user/10/{PACKAGE}/files/goldens/" />
         <option name="collect-on-run-ended-only" value="true" />
     </metrics_collector>
     {EXTRA_CONFIGS}
diff --git a/libraries/motion/compose/AndroidManifest.xml b/libraries/motion/compose/AndroidManifest.xml
index 760a88532..70049458b 100644
--- a/libraries/motion/compose/AndroidManifest.xml
+++ b/libraries/motion/compose/AndroidManifest.xml
@@ -17,4 +17,6 @@
 
 <manifest xmlns:android="http://schemas.android.com/apk/res/android"
     package="platform.test.motion.compose">
+
+  <application><activity android:name="androidx.activity.ComponentActivity" /></application>
 </manifest>
diff --git a/libraries/motion/compose/src/platform/test/motion/compose/ComposeToolkit.kt b/libraries/motion/compose/src/platform/test/motion/compose/ComposeToolkit.kt
index cae93756c..ccff58237 100644
--- a/libraries/motion/compose/src/platform/test/motion/compose/ComposeToolkit.kt
+++ b/libraries/motion/compose/src/platform/test/motion/compose/ComposeToolkit.kt
@@ -39,10 +39,12 @@ import androidx.compose.ui.test.performTouchInput
 import androidx.compose.ui.unit.Density
 import androidx.compose.ui.unit.IntSize
 import java.util.concurrent.TimeUnit
+import java.util.concurrent.TimeoutException
 import kotlin.math.roundToInt
 import kotlin.time.Duration
 import kotlin.time.Duration.Companion.milliseconds
 import kotlin.time.Duration.Companion.seconds
+import kotlinx.coroutines.Dispatchers
 import kotlinx.coroutines.ExperimentalCoroutinesApi
 import kotlinx.coroutines.Job
 import kotlinx.coroutines.flow.MutableStateFlow
@@ -54,6 +56,7 @@ import kotlinx.coroutines.test.TestScope
 import kotlinx.coroutines.test.runCurrent
 import kotlinx.coroutines.test.runTest
 import org.junit.rules.RuleChain
+import platform.test.motion.Defaults
 import platform.test.motion.MotionTestRule
 import platform.test.motion.RecordedMotion
 import platform.test.motion.RecordedMotion.Companion.create
@@ -72,8 +75,16 @@ import platform.test.screenshot.Displays
 import platform.test.screenshot.GoldenPathManager
 import platform.test.screenshot.captureToBitmapAsync
 
-/** Toolkit to support Compose-based [MotionTestRule] tests. */
-class ComposeToolkit(val composeContentTestRule: ComposeContentTestRule, val testScope: TestScope) {
+/**
+ * Toolkit to support Compose-based [MotionTestRule] tests.
+ *
+ * @param fixedConfiguration when non-null, applies the specified configuration to the content.
+ */
+class ComposeToolkit(
+    val composeContentTestRule: ComposeContentTestRule,
+    val testScope: TestScope,
+    val fixedConfiguration: FixedConfiguration? = null,
+) {
     internal companion object {
         const val TAG = "ComposeToolkit"
     }
@@ -101,7 +112,7 @@ fun createComposeMotionTestRule(
     deviceEmulationSpec: DeviceEmulationSpec = DeviceEmulationSpec(Displays.Phone),
 ): MotionTestRule<ComposeToolkit> {
     val deviceEmulationRule = DeviceEmulationRule(deviceEmulationSpec)
-    val composeRule = createComposeRule(testScope.coroutineContext)
+    val composeRule = createComposeRule(testScope.coroutineContext + Dispatchers.Main)
 
     return MotionTestRule(
         ComposeToolkit(composeRule, testScope),
@@ -158,20 +169,30 @@ interface MotionControlScope : SemanticsNodeInteractionsProvider {
  *   flipping the `play` parameter of the [recordMotion]'s content composable)
  * @param recordAfter Records the frame after the recording has ended (runs after awaiting idleness,
  *   after all animations have finished and no more recomposition is pending).
+ * @param captureScreenshots Whether to record screenshots on each frame. Must be `true` for
+ *   [filmstripMatchesGolden] to work. If `true`, the debug screenrecording will be created.
  * @param timeSeriesCapture produces the time-series, invoked on each animation frame.
  */
 data class ComposeRecordingSpec(
     val motionControl: MotionControl,
     val recordBefore: Boolean = true,
     val recordAfter: Boolean = true,
+    val captureScreenshots: Boolean = Defaults.captureScreenshots(),
     val timeSeriesCapture: TimeSeriesCaptureScope<SemanticsNodeInteractionsProvider>.() -> Unit,
 ) {
     constructor(
         recording: MotionControlFn,
         recordBefore: Boolean = true,
         recordAfter: Boolean = true,
+        captureScreenshots: Boolean = Defaults.captureScreenshots(),
         timeSeriesCapture: TimeSeriesCaptureScope<SemanticsNodeInteractionsProvider>.() -> Unit,
-    ) : this(MotionControl(recording = recording), recordBefore, recordAfter, timeSeriesCapture)
+    ) : this(
+        MotionControl(recording = recording),
+        recordBefore,
+        recordAfter,
+        captureScreenshots,
+        timeSeriesCapture,
+    )
 
     companion object {
         /** Record a time-series until [checkDone] returns true. */
@@ -179,12 +200,14 @@ data class ComposeRecordingSpec(
             checkDone: SemanticsNodeInteractionsProvider.() -> Boolean,
             recordBefore: Boolean = true,
             recordAfter: Boolean = true,
+            captureScreenshots: Boolean = Defaults.captureScreenshots(),
             timeSeriesCapture: TimeSeriesCaptureScope<SemanticsNodeInteractionsProvider>.() -> Unit,
         ): ComposeRecordingSpec {
             return ComposeRecordingSpec(
                 motionControl = MotionControl { awaitCondition { checkDone() } },
                 recordBefore,
                 recordAfter,
+                captureScreenshots,
                 timeSeriesCapture,
             )
         }
@@ -202,6 +225,8 @@ fun MotionTestRule<ComposeToolkit>.recordMotion(
     recordingSpec: ComposeRecordingSpec,
 ): RecordedMotion {
     with(toolkit.composeContentTestRule) {
+        val captureScreenshots = recordingSpec.captureScreenshots
+        Log.i(TAG, "recordMotion(captureScreenshots=$captureScreenshots)")
         val frameIdCollector = mutableListOf<FrameId>()
         val propertyCollector = mutableMapOf<String, MutableList<DataPoint<*>>>()
         val screenshotCollector = mutableListOf<ImageBitmap>()
@@ -211,16 +236,32 @@ fun MotionTestRule<ComposeToolkit>.recordMotion(
             frameIdCollector.add(frameId)
             recordingSpec.timeSeriesCapture.invoke(TimeSeriesCaptureScope(this, propertyCollector))
 
-            val view = (onRoot().fetchSemanticsNode().root as ViewRootForTest).view
-            val bitmap = view.captureToBitmapAsync().get(10, TimeUnit.SECONDS)
-            screenshotCollector.add(bitmap.asImageBitmap())
+            if (recordingSpec.captureScreenshots) {
+                val view = (onRoot().fetchSemanticsNode().root as ViewRootForTest).view
+                try {
+                    screenshotCollector.add(
+                        view.captureToBitmapAsync().get(10, TimeUnit.SECONDS).asImageBitmap()
+                    )
+                } catch (e: TimeoutException) {
+                    throw Exception("Capturing screenshot timed out, see b/260824883", e)
+                }
+            }
         }
 
         var playbackStarted by mutableStateOf(false)
 
         mainClock.autoAdvance = false
 
-        setContent { EnableMotionTestValueCollection { content(playbackStarted) } }
+        setContent {
+            EnableMotionTestValueCollection {
+                val fixedConfiguration = toolkit.fixedConfiguration
+                if (fixedConfiguration != null) {
+                    FixedConfigurationProvider(fixedConfiguration) { content(playbackStarted) }
+                } else {
+                    content(playbackStarted)
+                }
+            }
+        }
         Log.i(TAG, "recordMotion() created compose content")
 
         waitForIdle()
@@ -272,7 +313,12 @@ fun MotionTestRule<ComposeToolkit>.recordMotion(
                 propertyCollector.entries.map { entry -> Feature(entry.key, entry.value) },
             )
 
-        return create(timeSeries, screenshotCollector.map { it.asAndroidBitmap() })
+        return create(
+            timeSeries,
+            screenshotCollector
+                .takeIf { recordingSpec.captureScreenshots }
+                ?.map { it.asAndroidBitmap() },
+        )
     }
 }
 
@@ -304,6 +350,7 @@ private class MotionControlImpl(
             when (state) {
                 MotionControlState.Start,
                 MotionControlState.WaitingToPlay -> false
+
                 else -> true
             }
 
@@ -312,6 +359,7 @@ private class MotionControlImpl(
             when (state) {
                 MotionControlState.Recording,
                 MotionControlState.Ended -> true
+
                 else -> false
             }
 
@@ -323,6 +371,10 @@ private class MotionControlImpl(
             }
 
     fun nextFrame() {
+        // we wait for the main thread to get idle, required in robolectric tests as there was a
+        // delay of one frame between actual and expected golden.
+        // Need some more digging into why this is required for robolectric.
+        composeTestRule.waitForIdle()
         composeTestRule.mainClock.advanceTimeByFrame()
         composeTestRule.waitForIdle()
 
@@ -331,23 +383,27 @@ private class MotionControlImpl(
                 delayReadyToPlayJob = motionControl.delayReadyToPlay.launch()
                 state = MotionControlState.WaitingToPlay
             }
+
             MotionControlState.WaitingToPlay -> {
                 if (delayReadyToPlayJob.isCompleted) {
                     delayRecordingJob = motionControl.delayRecording.launch()
                     state = MotionControlState.WaitingToRecord
                 }
             }
+
             MotionControlState.WaitingToRecord -> {
                 if (delayRecordingJob.isCompleted) {
                     recordingJob = motionControl.recording.launch()
                     state = MotionControlState.Recording
                 }
             }
+
             MotionControlState.Recording -> {
                 if (recordingJob.isCompleted) {
                     state = MotionControlState.Ended
                 }
             }
+
             MotionControlState.Ended -> {}
         }
 
@@ -394,12 +450,16 @@ private class MotionControlImpl(
             when (entry) {
                 is TouchEventRecorderEntry.AdvanceTime ->
                     awaitDelay(entry.durationMillis.milliseconds)
+
                 is TouchEventRecorderEntry.Cancel ->
                     onNode.performTouchInput { cancel(delayMillis = 0) }
+
                 is TouchEventRecorderEntry.Down ->
                     onNode.performTouchInput { down(entry.pointerId, entry.position) }
+
                 is TouchEventRecorderEntry.Move ->
                     onNode.performTouchInput { move(delayMillis = 0) }
+
                 is TouchEventRecorderEntry.Up -> onNode.performTouchInput { up(entry.pointerId) }
                 is TouchEventRecorderEntry.UpdatePointerTo ->
                     onNode.performTouchInput { updatePointerTo(entry.pointerId, entry.position) }
diff --git a/libraries/motion/compose/src/platform/test/motion/compose/FixedConfiguration.kt b/libraries/motion/compose/src/platform/test/motion/compose/FixedConfiguration.kt
new file mode 100644
index 000000000..562bb6d0d
--- /dev/null
+++ b/libraries/motion/compose/src/platform/test/motion/compose/FixedConfiguration.kt
@@ -0,0 +1,137 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package platform.test.motion.compose
+
+import android.content.res.Configuration
+import android.util.DisplayMetrics
+import android.view.ContextThemeWrapper
+import androidx.compose.runtime.Composable
+import androidx.compose.runtime.CompositionLocalProvider
+import androidx.compose.runtime.remember
+import androidx.compose.ui.platform.LocalConfiguration
+import androidx.compose.ui.platform.LocalContext
+import androidx.compose.ui.platform.LocalDensity
+import androidx.compose.ui.platform.LocalViewConfiguration
+import androidx.compose.ui.platform.ViewConfiguration
+import androidx.compose.ui.test.ExperimentalTestApi
+import androidx.compose.ui.test.junit4.ComposeContentTestRule
+import androidx.compose.ui.test.junit4.createComposeRule
+import androidx.compose.ui.unit.Density
+import androidx.compose.ui.unit.Dp
+import androidx.compose.ui.unit.dp
+import kotlin.math.floor
+import kotlinx.coroutines.Dispatchers
+import kotlinx.coroutines.test.TestScope
+import org.junit.rules.RuleChain
+import platform.test.motion.MotionTestRule
+import platform.test.screenshot.GoldenPathManager
+
+/**
+ * @param density Sets the [LocalDensity], allowing for a deterministic calculation of `dp -> px ->
+ *   dp`.
+ * @param touchSlop Sets the [ViewConfiguration.touchSlop], allowing for a deterministic gesture
+ *   start.
+ */
+data class FixedConfiguration(
+    val density: Density = DefaultDensity,
+    val touchSlop: Dp = DefaultTouchSlop,
+) {
+
+    companion object {
+        /**
+         * Default density for tests.
+         *
+         * Using a uneven number to reveal issues with rounding.
+         */
+        val DefaultDensity = Density(2.5f)
+
+        /**
+         * Touch slop for gestures.
+         *
+         * Using the cuttlefish default value.
+         */
+        val DefaultTouchSlop = 12.dp
+    }
+}
+
+/**
+ * Convenience to create a [MotionTestRule], including the required setup.
+ *
+ * NOTE: The [configuration] applies to the complete content, EXCEPT the root node returned by the
+ * `isRoot()` [SemanticMatcher]. This can produce unexpected results when dispatching gestures on
+ * the root node. To work around this, dispatch the gestures on a node owned by the composable under
+ * test.
+ *
+ * In addition to the [MotionTestRule], this function also creates a [ComposeContentTestRule], which
+ * is run as part of the [MotionTestRule].
+ */
+@OptIn(ExperimentalTestApi::class)
+fun createFixedConfigurationComposeMotionTestRule(
+    goldenPathManager: GoldenPathManager,
+    testScope: TestScope = TestScope(),
+    configuration: FixedConfiguration = FixedConfiguration(),
+): MotionTestRule<ComposeToolkit> {
+    val composeRule = createComposeRule(testScope.coroutineContext + Dispatchers.Main)
+
+    return MotionTestRule(
+        ComposeToolkit(composeRule, testScope, configuration),
+        goldenPathManager,
+        extraRules = RuleChain.outerRule(composeRule),
+    )
+}
+
+@Composable
+internal fun FixedConfigurationProvider(
+    fixedConfiguration: FixedConfiguration,
+    content: @Composable () -> Unit,
+) {
+    val baseLocalConfiguration = LocalConfiguration.current
+    val configuration =
+        remember(baseLocalConfiguration, fixedConfiguration) {
+            Configuration().apply {
+                updateFrom(baseLocalConfiguration)
+                densityDpi =
+                    floor(fixedConfiguration.density.density * DisplayMetrics.DENSITY_DEFAULT)
+                        .toInt()
+                fontScale = fixedConfiguration.density.fontScale
+            }
+        }
+    val previousContext = LocalContext.current
+    val context =
+        remember(previousContext, configuration) {
+            ContextThemeWrapper(previousContext, 0).apply {
+                applyOverrideConfiguration(configuration)
+            }
+        }
+
+    val baseViewConfiguration = LocalViewConfiguration.current
+    val customViewConfiguration =
+        remember(baseViewConfiguration, fixedConfiguration) {
+            object : ViewConfiguration by baseViewConfiguration {
+                override val touchSlop: Float =
+                    with(fixedConfiguration.density) { fixedConfiguration.touchSlop.toPx() }
+            }
+        }
+
+    CompositionLocalProvider(
+        LocalContext provides context,
+        LocalDensity provides fixedConfiguration.density,
+        LocalConfiguration provides configuration,
+        LocalViewConfiguration provides customViewConfiguration,
+        content = content,
+    )
+}
diff --git a/libraries/motion/compose/src/platform/test/motion/compose/TransitionFeatureCapture.kt b/libraries/motion/compose/src/platform/test/motion/compose/TransitionFeatureCapture.kt
index 3b33d07fa..d51a954e5 100644
--- a/libraries/motion/compose/src/platform/test/motion/compose/TransitionFeatureCapture.kt
+++ b/libraries/motion/compose/src/platform/test/motion/compose/TransitionFeatureCapture.kt
@@ -108,7 +108,7 @@ fun <T> ComposeRecordingSpec.Companion.duringTransition(
             },
         recordBefore,
         recordAfter,
-        timeSeriesCapture,
+        timeSeriesCapture = timeSeriesCapture,
     )
 }
 
diff --git a/libraries/motion/compose/tests/Android.bp b/libraries/motion/compose/tests/Android.bp
index 6b2e23e33..8cfe721f5 100644
--- a/libraries/motion/compose/tests/Android.bp
+++ b/libraries/motion/compose/tests/Android.bp
@@ -43,3 +43,30 @@ android_test {
     ],
     test_suites: ["general-tests"],
 }
+
+android_robolectric_test {
+    enabled: true,
+
+    name: "PlatformMotionTestingComposeTestsRobo",
+
+    srcs: [
+        ":PlatformMotionTestingCompose-srcs",
+        "src/**/ComposeToolkitTest.kt",
+    ],
+
+    java_resource_dirs: ["config"],
+    static_libs: [
+        "PlatformMotionTesting",
+        "PlatformMotionTestingComposeValues",
+        "androidx.test.ext.junit",
+        "androidx.test.runner",
+        "androidx.compose.runtime_runtime",
+        "androidx.compose.material3_material3",
+        "androidx.compose.ui_ui-test-junit4",
+        "androidx.compose.ui_ui-test-manifest",
+        "truth",
+    ],
+
+    instrumentation_for: "PlatformMotionTestingRoboApplication",
+
+}
diff --git a/libraries/motion/compose/tests/config/robolectric.properties b/libraries/motion/compose/tests/config/robolectric.properties
new file mode 100644
index 000000000..8fbd9d6a5
--- /dev/null
+++ b/libraries/motion/compose/tests/config/robolectric.properties
@@ -0,0 +1,19 @@
+#
+# Copyright (C) 2025 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+sdk=NEWEST_SDK
+graphicsMode=NATIVE
+# make Robolectric match the device configuration on which instrumentation tests run.
+qualifiers=w480dp-h800dp-560dpi
diff --git a/libraries/motion/compose/tests/goldens/recordMotion_capturePosition.json b/libraries/motion/compose/tests/goldens/recordMotion_capturePosition.json
index f97fafee7..ce49cc13d 100644
--- a/libraries/motion/compose/tests/goldens/recordMotion_capturePosition.json
+++ b/libraries/motion/compose/tests/goldens/recordMotion_capturePosition.json
@@ -37,11 +37,11 @@
           "y": 0
         },
         {
-          "x": 11.428572,
+          "x": 11.6,
           "y": 0
         },
         {
-          "x": 31.714285,
+          "x": 31.6,
           "y": 0
         },
         {
@@ -49,47 +49,47 @@
           "y": 0
         },
         {
-          "x": 63.714287,
+          "x": 63.6,
           "y": 0
         },
         {
-          "x": 73.42857,
+          "x": 73.2,
           "y": 0
         },
         {
-          "x": 79.71429,
+          "x": 79.6,
           "y": 0
         },
         {
-          "x": 83.71429,
+          "x": 83.6,
           "y": 0
         },
         {
-          "x": 86.28571,
+          "x": 86.4,
           "y": 0
         },
         {
-          "x": 87.71429,
+          "x": 87.6,
           "y": 0
         },
         {
-          "x": 88.57143,
+          "x": 88.8,
           "y": 0
         },
         {
-          "x": 89.14286,
+          "x": 89.2,
           "y": 0
         },
         {
-          "x": 89.42857,
+          "x": 89.6,
           "y": 0
         },
         {
-          "x": 89.71429,
+          "x": 89.6,
           "y": 0
         },
         {
-          "x": 89.71429,
+          "x": 90,
           "y": 0
         },
         {
diff --git a/libraries/motion/compose/tests/goldens/recordMotion_captureSize.json b/libraries/motion/compose/tests/goldens/recordMotion_captureSize.json
index f8f576ac3..47eb68041 100644
--- a/libraries/motion/compose/tests/goldens/recordMotion_captureSize.json
+++ b/libraries/motion/compose/tests/goldens/recordMotion_captureSize.json
@@ -26,7 +26,6 @@
     352,
     368,
     384,
-    400,
     "after"
   ],
   "features": [
@@ -47,11 +46,11 @@
           "height": 10
         },
         {
-          "width": 13.428572,
+          "width": 13.2,
           "height": 10
         },
         {
-          "width": 20.857143,
+          "width": 20.8,
           "height": 10
         },
         {
@@ -59,7 +58,7 @@
           "height": 10
         },
         {
-          "width": 39.42857,
+          "width": 39.2,
           "height": 10
         },
         {
@@ -67,11 +66,11 @@
           "height": 10
         },
         {
-          "width": 55.714287,
+          "width": 55.6,
           "height": 10
         },
         {
-          "width": 62.285713,
+          "width": 62.4,
           "height": 10
         },
         {
@@ -79,67 +78,63 @@
           "height": 10
         },
         {
-          "width": 72.57143,
+          "width": 72.4,
           "height": 10
         },
         {
-          "width": 76.28571,
+          "width": 76.4,
           "height": 10
         },
         {
-          "width": 79.42857,
+          "width": 79.2,
           "height": 10
         },
         {
-          "width": 81.71429,
+          "width": 81.6,
           "height": 10
         },
         {
-          "width": 83.42857,
+          "width": 83.6,
           "height": 10
         },
         {
-          "width": 85.14286,
+          "width": 85.2,
           "height": 10
         },
         {
-          "width": 86.28571,
+          "width": 86,
           "height": 10
         },
         {
-          "width": 87.14286,
+          "width": 87.2,
           "height": 10
         },
         {
-          "width": 87.71429,
+          "width": 87.6,
           "height": 10
         },
         {
-          "width": 88.28571,
+          "width": 88.4,
           "height": 10
         },
         {
-          "width": 88.57143,
+          "width": 88.8,
           "height": 10
         },
         {
-          "width": 89.14286,
+          "width": 89.2,
           "height": 10
         },
         {
-          "width": 89.14286,
+          "width": 89.2,
           "height": 10
         },
         {
-          "width": 89.42857,
+          "width": 89.6,
           "height": 10
         },
         {
-          "width": 89.71429,
-          "height": 10
-        },
-        {
-          "width": 89.71429,
+          "width": 89.6,
           "height": 10
         },
         {
diff --git a/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGestureAsync.json b/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGestureAsync.json
index 17cd5b5a8..5ee11b21b 100644
--- a/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGestureAsync.json
+++ b/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGestureAsync.json
@@ -23,36 +23,36 @@
         "unspecified",
         "unspecified",
         {
-          "x": 525,
-          "y": 328.66016
+          "x": 375,
+          "y": 224.66016
         },
         {
-          "x": 525,
-          "y": 496.5
+          "x": 375,
+          "y": 344.5
         },
         {
-          "x": 525,
-          "y": 496.5
+          "x": 375,
+          "y": 344.5
         },
         {
-          "x": 525,
-          "y": 674.8301
+          "x": 375,
+          "y": 471.83008
         },
         {
-          "x": 525,
-          "y": 674.8301
+          "x": 375,
+          "y": 471.83008
         },
         {
-          "x": 525,
-          "y": 853.16016
+          "x": 375,
+          "y": 599.16016
         },
         {
-          "x": 525,
-          "y": 1021
+          "x": 375,
+          "y": 719
         },
         {
-          "x": 525,
-          "y": 1021
+          "x": 375,
+          "y": 719
         },
         "unspecified",
         "unspecified"
diff --git a/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGesture_sendIndividualEvents.json b/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGesture_sendIndividualEvents.json
index f836f8dec..fcd353d9c 100644
--- a/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGesture_sendIndividualEvents.json
+++ b/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performGesture_sendIndividualEvents.json
@@ -31,80 +31,80 @@
         "unspecified",
         "unspecified",
         {
-          "x": 525,
-          "y": 76.90039
+          "x": 375,
+          "y": 44.90039
         },
         {
-          "x": 525,
-          "y": 129.35059
+          "x": 375,
+          "y": 82.350586
         },
         {
-          "x": 525,
-          "y": 181.7998
+          "x": 375,
+          "y": 119.799805
         },
         {
-          "x": 525,
-          "y": 234.25
+          "x": 375,
+          "y": 157.25
         },
         {
-          "x": 525,
-          "y": 286.7002
+          "x": 375,
+          "y": 194.7002
         },
         {
-          "x": 525,
-          "y": 339.1504
+          "x": 375,
+          "y": 232.15039
         },
         {
-          "x": 525,
-          "y": 391.6006
+          "x": 375,
+          "y": 269.6006
         },
         {
-          "x": 525,
-          "y": 444.0498
+          "x": 375,
+          "y": 307.0498
         },
         {
-          "x": 525,
-          "y": 496.5
+          "x": 375,
+          "y": 344.5
         },
         {
-          "x": 525,
-          "y": 548.9502
+          "x": 375,
+          "y": 381.9502
         },
         {
-          "x": 525,
-          "y": 601.4004
+          "x": 375,
+          "y": 419.4004
         },
         {
-          "x": 525,
-          "y": 653.8506
+          "x": 375,
+          "y": 456.8506
         },
         {
-          "x": 525,
-          "y": 706.2998
+          "x": 375,
+          "y": 494.2998
         },
         {
-          "x": 525,
-          "y": 758.75
+          "x": 375,
+          "y": 531.75
         },
         {
-          "x": 525,
-          "y": 811.2002
+          "x": 375,
+          "y": 569.2002
         },
         {
-          "x": 525,
-          "y": 863.6504
+          "x": 375,
+          "y": 606.6504
         },
         {
-          "x": 525,
-          "y": 916.1006
+          "x": 375,
+          "y": 644.1006
         },
         {
-          "x": 525,
-          "y": 968.5498
+          "x": 375,
+          "y": 681.5498
         },
         {
-          "x": 525,
-          "y": 1021
+          "x": 375,
+          "y": 719
         },
         "unspecified"
       ]
diff --git a/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performTap.json b/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performTap.json
index 4e5a7365f..a246c22f3 100644
--- a/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performTap.json
+++ b/libraries/motion/compose/tests/goldens/recordMotion_motionControl_performTap.json
@@ -66,47 +66,47 @@
           "height": 20
         },
         {
-          "width": 22.571428,
+          "width": 22.4,
           "height": 20
         },
         {
-          "width": 27.142857,
+          "width": 27.2,
           "height": 20
         },
         {
-          "width": 31.142857,
+          "width": 31.2,
           "height": 20
         },
         {
-          "width": 34.285713,
+          "width": 34,
           "height": 20
         },
         {
-          "width": 36.285713,
+          "width": 36.4,
           "height": 20
         },
         {
-          "width": 37.714287,
+          "width": 37.6,
           "height": 20
         },
         {
-          "width": 38.57143,
+          "width": 38.8,
           "height": 20
         },
         {
-          "width": 39.142857,
+          "width": 39.2,
           "height": 20
         },
         {
-          "width": 39.42857,
+          "width": 39.6,
           "height": 20
         },
         {
-          "width": 39.714287,
+          "width": 39.6,
           "height": 20
         },
         {
-          "width": 39.714287,
+          "width": 40,
           "height": 20
         },
         {
@@ -138,47 +138,47 @@
           "height": 20
         },
         {
-          "width": 42.57143,
+          "width": 42.4,
           "height": 20
         },
         {
-          "width": 47.142857,
+          "width": 47.2,
           "height": 20
         },
         {
-          "width": 51.142857,
+          "width": 51.2,
           "height": 20
         },
         {
-          "width": 54.285713,
+          "width": 54,
           "height": 20
         },
         {
-          "width": 56.285713,
+          "width": 56.4,
           "height": 20
         },
         {
-          "width": 57.714287,
+          "width": 57.6,
           "height": 20
         },
         {
-          "width": 58.57143,
+          "width": 58.8,
           "height": 20
         },
         {
-          "width": 59.142857,
+          "width": 59.2,
           "height": 20
         },
         {
-          "width": 59.42857,
+          "width": 59.6,
           "height": 20
         },
         {
-          "width": 59.714287,
+          "width": 59.6,
           "height": 20
         },
         {
-          "width": 59.714287,
+          "width": 60,
           "height": 20
         },
         {
diff --git a/libraries/motion/compose/tests/multivalentTestsForDeviceless b/libraries/motion/compose/tests/multivalentTestsForDeviceless
new file mode 120000
index 000000000..f7ffeddf4
--- /dev/null
+++ b/libraries/motion/compose/tests/multivalentTestsForDeviceless
@@ -0,0 +1 @@
+./src
\ No newline at end of file
diff --git a/libraries/motion/compose/tests/src/platform/test/motion/compose/ComposeToolkitTest.kt b/libraries/motion/compose/tests/src/platform/test/motion/compose/ComposeToolkitTest.kt
index f89a1cabb..12204236e 100644
--- a/libraries/motion/compose/tests/src/platform/test/motion/compose/ComposeToolkitTest.kt
+++ b/libraries/motion/compose/tests/src/platform/test/motion/compose/ComposeToolkitTest.kt
@@ -52,12 +52,14 @@ import androidx.compose.ui.test.onNodeWithTag
 import androidx.compose.ui.test.performTouchInput
 import androidx.compose.ui.test.swipeDown
 import androidx.compose.ui.unit.dp
+import androidx.test.ext.junit.runners.AndroidJUnit4
 import com.google.common.truth.IterableSubject
 import com.google.common.truth.Truth.assertThat
 import kotlin.time.Duration.Companion.milliseconds
 import kotlinx.coroutines.launch
 import org.junit.Rule
 import org.junit.Test
+import org.junit.runner.RunWith
 import platform.test.motion.MotionTestRule
 import platform.test.motion.compose.DataPointTypes.offset
 import platform.test.motion.compose.values.MotionTestValueKey
@@ -68,10 +70,11 @@ import platform.test.motion.golden.NotFoundDataPoint
 import platform.test.motion.golden.ValueDataPoint
 import platform.test.motion.testing.createGoldenPathManager
 
+@RunWith(AndroidJUnit4::class)
 class ComposeToolkitTest {
     private val pathManager =
         createGoldenPathManager("platform_testing/libraries/motion/compose/tests/goldens")
-    @get:Rule val motionRule = createComposeMotionTestRule(pathManager)
+    @get:Rule val motionRule = createFixedConfigurationComposeMotionTestRule(pathManager)
 
     @Test
     fun recordMotion_capturePosition() =
diff --git a/libraries/motion/compose/tests/src/platform/test/motion/compose/FixedConfigurationTest.kt b/libraries/motion/compose/tests/src/platform/test/motion/compose/FixedConfigurationTest.kt
new file mode 100644
index 000000000..8b1305757
--- /dev/null
+++ b/libraries/motion/compose/tests/src/platform/test/motion/compose/FixedConfigurationTest.kt
@@ -0,0 +1,200 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package platform.test.motion.compose
+
+import androidx.compose.foundation.gestures.detectDragGestures
+import androidx.compose.foundation.layout.Box
+import androidx.compose.foundation.layout.size
+import androidx.compose.runtime.getValue
+import androidx.compose.runtime.mutableStateOf
+import androidx.compose.runtime.setValue
+import androidx.compose.ui.Modifier
+import androidx.compose.ui.input.pointer.pointerInput
+import androidx.compose.ui.platform.LocalConfiguration
+import androidx.compose.ui.platform.LocalDensity
+import androidx.compose.ui.platform.LocalViewConfiguration
+import androidx.compose.ui.platform.testTag
+import androidx.compose.ui.test.hasTestTag
+import androidx.compose.ui.test.junit4.ComposeContentTestRule
+import androidx.compose.ui.test.swipeDown
+import androidx.compose.ui.unit.Density
+import androidx.compose.ui.unit.DpSize
+import androidx.compose.ui.unit.IntSize
+import androidx.compose.ui.unit.dp
+import androidx.test.ext.junit.runners.AndroidJUnit4
+import com.google.common.base.Function
+import com.google.common.truth.Correspondence.transforming
+import com.google.common.truth.Truth.assertThat
+import org.junit.Rule
+import org.junit.Test
+import org.junit.runner.RunWith
+import platform.test.motion.golden.DataPoint
+import platform.test.motion.golden.FeatureCapture
+import platform.test.motion.golden.ValueDataPoint
+import platform.test.motion.golden.asDataPoint
+import platform.test.motion.testing.createGoldenPathManager
+
+@RunWith(AndroidJUnit4::class)
+class FixedConfigurationTest {
+    private val pathManager =
+        createGoldenPathManager("platform_testing/libraries/motion/compose/tests/goldens")
+
+    @get:Rule val motionRule = createFixedConfigurationComposeMotionTestRule(pathManager)
+
+    private val composeRule: ComposeContentTestRule
+        get() = motionRule.toolkit.composeContentTestRule
+
+    @Test
+    fun defaultFixedDensity_usesExpectedRatio() {
+        var actualPixels = Float.NaN
+
+        composeRule.setContent {
+            FixedConfigurationProvider(FixedConfiguration()) {
+                with(LocalDensity.current) { actualPixels = 10.dp.toPx() }
+            }
+        }
+
+        assertThat(actualPixels).isEqualTo(25)
+    }
+
+    @Test
+    fun fixedDensity_canSetAnyRatio() {
+        var actualPixels = Float.NaN
+
+        composeRule.setContent {
+            FixedConfigurationProvider(FixedConfiguration(density = Density(10f))) {
+                with(LocalDensity.current) { actualPixels = 10.dp.toPx() }
+            }
+        }
+
+        assertThat(actualPixels).isEqualTo(100f)
+    }
+
+    @Test
+    fun fixedDensity_reflectedInLocalConfiguration() {
+        var densityDpi = -1
+
+        composeRule.setContent {
+            FixedConfigurationProvider(FixedConfiguration(density = Density(2f))) {
+                densityDpi = LocalConfiguration.current.densityDpi
+            }
+        }
+
+        // Density of 1 is 160dpi, thus a density of 2 is 320dpi
+        assertThat(densityDpi).isEqualTo(320)
+    }
+
+    @Test
+    fun recordMotion_usedFixedDensity() =
+        motionRule.runTest {
+            val motion =
+                recordMotion(
+                    content = {
+                        Box(modifier = Modifier.testTag("foo").size(width = 10.dp, height = 20.dp))
+                    },
+                    ComposeRecordingSpec(
+                        MotionControl { awaitFrames(1) },
+                        recordBefore = false,
+                        recordAfter = false,
+                    ) {
+                        feature(hasTestTag("foo"), ComposeFeatureCaptures.dpSize, name = "dp_size")
+                        feature(hasTestTag("foo"), ComposeFeatureCaptures.size, name = "px_size")
+                    },
+                )
+
+            assertThat(motion.timeSeries.features["dp_size"]?.dataPoints)
+                .containsExactly(DpSize(10.dp, 20.dp).asDataPoint())
+
+            assertThat(motion.timeSeries.features["px_size"]?.dataPoints)
+                .containsExactly(IntSize(25, 50).asDataPoint())
+        }
+
+    @Test
+    fun fixedTouchSlop_reflectedInViewConfiguration_usesSuppliedDensity() {
+        var touchSlopPx = -1f
+
+        composeRule.setContent {
+            FixedConfigurationProvider(
+                FixedConfiguration(touchSlop = 10.dp, density = Density(4f))
+            ) {
+                touchSlopPx = LocalViewConfiguration.current.touchSlop
+            }
+        }
+
+        // Density of 1 is 160dpi, thus a density of 2 is 320dpi
+        assertThat(touchSlopPx).isEqualTo(40)
+    }
+
+    @Test
+    fun recordMotion_usesFixedTouchSlop() =
+        motionRule.runTest {
+            var yDragDistance by mutableStateOf(0f)
+
+            val dragStartThreshold = 30f // Defaults: 12.dp touchslop at a 2.5 density
+
+            val motion =
+                recordMotion(
+                    content = {
+                        Box(
+                            modifier =
+                                Modifier.pointerInput(Unit) {
+                                        detectDragGestures(
+                                            onDragStart = { yDragDistance = it.y }
+                                        ) { _, dragAmount ->
+                                            yDragDistance += dragAmount.y
+                                        }
+                                    }
+                                    .testTag("foo")
+                                    .size(width = 10.dp, height = 10.dp)
+                        )
+                    },
+                    ComposeRecordingSpec(
+                        MotionControl {
+                            performTouchInputAsync(onNode(hasTestTag("foo"))) {
+                                swipeDown(startY = 0f, endY = 40f, durationMillis = 128)
+                            }
+                        },
+                        recordBefore = false,
+                        recordAfter = false,
+                    ) {
+                        feature(FeatureCapture("yDragDistance") { yDragDistance.asDataPoint() })
+                    },
+                )
+
+            val dataPoints = checkNotNull(motion.timeSeries.features["yDragDistance"]?.dataPoints)
+
+            // recorded swipe is 8 frames long (128ms/16ms frames)
+            assertThat(dataPoints.size).isEqualTo(8)
+
+            // drag distance threshold is at 3/4 of the drag distance, swipe is 8 frames long, thus
+            // 6 elements must be 0
+            val firstNonZeroIndex = dataPoints.indexOfFirst { it != 0f.asDataPoint() }
+            assertThat(firstNonZeroIndex).isEqualTo(6)
+
+            // Of the remaining elements, they all must be at least dragStartThreshold.
+            assertThat(dataPoints.drop(firstNonZeroIndex))
+                .comparingElementsUsing(
+                    transforming(
+                        Function<DataPoint<Float>, Boolean> {
+                            ((it as? ValueDataPoint<Float>)?.value ?: 0f) >= dragStartThreshold
+                        },
+                        "is above touch slop threshold",
+                    )
+                )
+                .doesNotContain(false)
+        }
+}
diff --git a/libraries/motion/compose/tests/src/platform/test/motion/compose/MotionTestValuesTest.kt b/libraries/motion/compose/tests/src/platform/test/motion/compose/MotionTestValuesTest.kt
index 8be2d1c25..1d520f1a7 100644
--- a/libraries/motion/compose/tests/src/platform/test/motion/compose/MotionTestValuesTest.kt
+++ b/libraries/motion/compose/tests/src/platform/test/motion/compose/MotionTestValuesTest.kt
@@ -222,7 +222,7 @@ class MotionTestValuesTest {
             recording = { awaitFrames(1) },
             recordBefore = false,
             recordAfter = false,
-            timeSeriesCapture,
+            timeSeriesCapture = timeSeriesCapture,
         )
     }
 
diff --git a/libraries/motion/golden_updater/watch_local_tests.py b/libraries/motion/golden_updater/watch_local_tests.py
index aa2a3f2be..8f4f17f6a 100755
--- a/libraries/motion/golden_updater/watch_local_tests.py
+++ b/libraries/motion/golden_updater/watch_local_tests.py
@@ -34,6 +34,8 @@ import hashlib
 import shutil
 import secrets
 import datetime
+import glob
+import gzip
 
 
 from collections import defaultdict
@@ -50,6 +52,19 @@ def main():
         type=int,
         help="Port to run test at watcher web UI on.",
     )
+
+    parser.add_argument(
+        "--atest",
+        default=False,
+        help="Watches atest output",
+    )
+
+    parser.add_argument(
+         "--studioTest",
+         default=False,
+         help="Watch for artifacs generated when a deviceless test is run via SysUi Studio",
+    )
+
     parser.add_argument(
         "--serial",
         default=os.environ.get("ANDROID_SERIAL"),
@@ -74,33 +89,46 @@ def main():
         print("ANDROID_BUILD_TOP not set. Have you sourced envsetup.sh?")
         sys.exit(1)
 
-    serial = args.serial
-    if not serial:
-        devices_response = subprocess.run(
-            ["adb", "devices"], check=True, capture_output=True
-        ).stdout.decode("utf-8")
-        lines = [s for s in devices_response.splitlines() if s.strip()]
+    global android_build_top
+    android_build_top = args.android_build_top
 
-        if len(lines) == 1:
-            print("no adb devices found")
-            sys.exit(1)
+    with tempfile.TemporaryDirectory() as tmpdir:
+        global golden_watcher, this_server_address
 
-        if len(lines) > 2:
-            print("multiple adb devices found, specify --serial")
-            sys.exit(1)
+        if args.atest:
+            print("ATEST is running.")
+            user = os.environ.get("USER")
+            golden_watcher = AtestGoldenWatcher(
+                tmpdir, f"/tmp/atest_result_{user}/LATEST/"
+            )
 
-        serial = lines[1].split("\t")[0]
+        elif args.studioTest:
+            print("Running for devicess sysui studio test")
+            golden_watcher = StudioGoldenWatcher(
+                tmpdir, f"/tmp/motion/"
+            )
+        else:
+            serial = args.serial
+            if not serial:
+                devices_response = subprocess.run(
+                    ["adb", "devices"], check=True, capture_output=True
+                ).stdout.decode("utf-8")
+                lines = [s for s in devices_response.splitlines() if s.strip()]
 
-    adb_client = AdbClient(serial)
-    if not adb_client.run_as_root():
-        sys.exit(1)
+                if len(lines) == 1:
+                    print("no adb devices found")
+                    sys.exit(1)
 
-    global android_build_top
-    android_build_top = args.android_build_top
+                if len(lines) > 2:
+                    print("multiple adb devices found, specify --serial")
+                    sys.exit(1)
 
-    with tempfile.TemporaryDirectory() as tmpdir:
-        global golden_watcher, this_server_address
-        golden_watcher = GoldenFileWatcher(tmpdir, adb_client)
+                serial = lines[1].split("\t")[0]
+
+            adb_client = AdbClient(serial)
+            if not adb_client.run_as_root():
+                sys.exit(1)
+            golden_watcher = GoldenFileWatcher(tmpdir, adb_client)
 
         this_server_address = f"http://localhost:{args.port}"
 
@@ -157,12 +185,10 @@ class WatchWebAppRequestHandler(http.server.BaseHTTPRequestHandler):
         elif parsed.path.startswith("/golden/"):
             requested_file_start_index = parsed.path.find("/", len("/golden/") + 1)
             requested_file = parsed.path[requested_file_start_index + 1 :]
-            print(requested_file)
             self.serve_file(golden_watcher.temp_dir, requested_file)
             return
         elif parsed.path.startswith("/expected/"):
             golden_id = parsed.path[len("/expected/") :]
-            print(golden_id)
 
             goldens = golden_watcher.cached_goldens.values()
             for golden in goldens:
@@ -211,9 +237,6 @@ class WatchWebAppRequestHandler(http.server.BaseHTTPRequestHandler):
     def serve_file(self, root_directory, file_relative_to_root, mime_type=None):
         resolved_path = path.abspath(path.join(root_directory, file_relative_to_root))
 
-        print(resolved_path)
-        print(root_directory)
-
         if path.commonprefix(
             [resolved_path, root_directory]
         ) == root_directory and path.isfile(resolved_path):
@@ -277,10 +300,11 @@ class WatchWebAppRequestHandler(http.server.BaseHTTPRequestHandler):
                 print("skip", golden.id)
                 continue
 
-            shutil.copyfile(
-                golden.local_file,
-                path.join(android_build_top, golden.golden_repo_path),
-            )
+            dst = path.join(android_build_top, golden.golden_repo_path)
+            if not path.exists(path.dirname(dst)):
+                os.makedirs(path.dirname(dst))
+
+            shutil.copyfile(golden.local_file, dst)
 
             golden.updated = True
             self.send_json({"result": "OK"})
@@ -340,7 +364,10 @@ class GoldenFileWatcher:
             self.cached_goldens[golden_remote_file] = golden
 
     def adb_pull(self, remote_file):
-        local_file = os.path.join(self.temp_dir, os.path.basename(remote_file))
+        baseName = os.path.basename(remote_file)
+        filename, ext = os.path.splitext(baseName)
+        remoteFilenameHash = hashlib.md5(remote_file.encode("utf-8")).hexdigest()
+        local_file = os.path.join(self.temp_dir, f'{filename}_{remoteFilenameHash}{ext}')
         self.run_adb_command(["pull", remote_file, local_file])
         self.run_adb_command(["shell", "rm", remote_file])
         return local_file
@@ -357,6 +384,109 @@ class GoldenFileWatcher:
         return self.adb_client.run_adb_command(args)
 
 
+class StudioGoldenWatcher:
+
+    def __init__(self, temp_dir, latest_dir):
+        self.temp_dir = temp_dir
+        self.latest_dir = latest_dir
+        self.cached_goldens = {}
+        self.refresh_golden_files()
+
+    def refresh_golden_files(self):
+        for filename in glob.iglob(
+            f"{self.latest_dir}//**/*.actual.json", recursive=True
+        ):
+            baseName = os.path.basename(filename)
+            baseFilename, ext = os.path.splitext(baseName)
+            timeHash = hashlib.md5(datetime.datetime.now().isoformat().encode("utf-8")).hexdigest()
+            local_file = os.path.join(self.temp_dir, f'copy_{baseFilename}_{timeHash}{ext}')
+            self.copy_file(filename, local_file)
+            golden = CachedGolden(filename, local_file)
+            self.cached_goldens[filename] = golden
+
+    def copy_file(self, source, target):
+        os.makedirs(os.path.dirname(target), exist_ok=True)
+        shutil.copyfile(source, target)
+
+    def clean(self):
+        self.cached_goldens = {}
+
+class AtestGoldenWatcher:
+
+    def __init__(self, temp_dir, atest_latest_dir):
+        self.temp_dir = temp_dir
+        self.atest_latest_dir = atest_latest_dir
+
+        # name -> CachedGolden
+        self.cached_goldens = {}
+        self.refresh_golden_files()
+
+    def clean(self):
+        self.cached_goldens = {}
+
+    def refresh_golden_files(self):
+
+        # Atest writes the files with a wide variety of filenames. Examples
+        # log/stub/local_atest/inv_8184127433410125702/light_portrait_pagingRight.actual.json_4383267726505225616.txt.gz
+        # log/invocation_3042186109657619915/inv_5155363728971335727/recordMotion_captureCrossfade.actual_10536896158799342698.json
+        # log/stub/local_atest/inv_6860054371355660320/light_portrait_noOverscrollRight.actual_118505410949600545.json.gz
+
+        # log/stub/local_atest/inv_6860054371355660320/light_portrait_noOverscrollRight.actual_12613191689435798576.mp4
+        # log/invocation_3042186109657619915/inv_5155363728971335727/recordMotion_captureCrossfade.actual_1988198704080929506.mp4
+        # log/stub/local_atest/inv_8184127433410125702/light_portrait_pagingRight.actual.mp4_1617964025478041468.txt.gz
+
+        pattern_type = (
+            r".*/(?P<name>.*)\.actual((\.(?P<ext1>[a-zA-Z0-9]+)_(?P<hash1>\d+)\.txt)|(_(?P<hash2>\d+)\.(?P<ext2>[a-zA-Z0-9]+)))(?P<compressed>\.gz)?"
+        )
+
+        # Output from on-device runs
+        # Modifying the search regex to handle files not ending with json as given above.
+        for filename in glob.iglob(
+            f"{self.atest_latest_dir}//**/*.actual*json*", recursive=True
+        ):
+
+            match = re.search(pattern_type, filename)
+
+            if not match:
+                continue
+
+            golden_name = match.group("name")
+            ext = match.group("ext1") or match.group("ext2")
+            hash = match.group("hash1") or match.group("hash2")
+            is_compressed = match.group("compressed") == ".gz"
+
+            local_file = os.path.join(self.temp_dir, f"{golden_name}_{hash}.actual.json")
+            self.copy_file(filename, local_file, is_compressed)
+            golden = CachedGolden(filename, local_file)
+
+            if golden.video_location:
+                for video_filename in glob.iglob(
+                    f"{self.atest_latest_dir}/**/{golden_name}.actual*.mp4*",
+                    recursive=True,
+                ):
+
+                    local_video_file = os.path.join(
+                        self.temp_dir, golden.video_location
+                    )
+                    video_is_compressed = video_filename.endswith(".gz")
+                    self.copy_file(
+                        video_filename, local_video_file, video_is_compressed
+                    )
+
+                    break
+
+            self.cached_goldens[filename] = golden
+
+    def copy_file(self, source, target, is_compressed):
+        os.makedirs(os.path.dirname(target), exist_ok=True)
+
+        if is_compressed:
+            with gzip.open(source, "rb") as f_in:
+                with open(target, "wb") as f_out:
+                    shutil.copyfileobj(f_in, f_out)
+        else:
+            shutil.copyfile(source, target)
+
 class CachedGolden:
 
     def __init__(self, remote_file, local_file):
diff --git a/libraries/motion/src/platform/test/motion/Defaults.kt b/libraries/motion/src/platform/test/motion/Defaults.kt
new file mode 100644
index 000000000..7403e9791
--- /dev/null
+++ b/libraries/motion/src/platform/test/motion/Defaults.kt
@@ -0,0 +1,34 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package platform.test.motion
+
+import androidx.test.platform.app.InstrumentationRegistry
+
+object Defaults {
+
+    /**
+     * Whether the environment is configured to capture screenshots.
+     *
+     * To request debug screenshots when running tests, set the instrumentation argument
+     * `captureScreenshots=true`.
+     *
+     * See http://go/motion-testing#debug-video for instructions.
+     */
+    fun captureScreenshots(): Boolean {
+        return "true" == InstrumentationRegistry.getArguments().getString("captureScreenshots")
+    }
+}
diff --git a/libraries/motion/src/platform/test/motion/MotionTestRule.kt b/libraries/motion/src/platform/test/motion/MotionTestRule.kt
index 9e3c25d3a..d0213048f 100644
--- a/libraries/motion/src/platform/test/motion/MotionTestRule.kt
+++ b/libraries/motion/src/platform/test/motion/MotionTestRule.kt
@@ -126,12 +126,11 @@ class MotionTestRule<Toolkit>(
         result: TimeSeriesVerificationResult,
     ) {
         requireValidGoldenIdentifier(goldenIdentifier)
-
         val relativeGoldenPath =
             goldenPathManager.goldenIdentifierResolver(goldenIdentifier, JSON_ACTUAL_EXTENSION)
-        val deviceLocalPath = File(goldenPathManager.deviceLocalPath)
+        val goldenFilePath = getGoldenFilePath()
         val goldenFile =
-            deviceLocalPath.resolve(recordedMotion.testClassName).resolve(relativeGoldenPath)
+            goldenFilePath.resolve(recordedMotion.testClassName).resolve(relativeGoldenPath)
 
         val goldenFileDirectory = checkNotNull(goldenFile.parentFile)
         if (!goldenFileDirectory.exists()) {
@@ -147,7 +146,7 @@ class MotionTestRule<Toolkit>(
         metadata.put("goldenIdentifier", goldenIdentifier)
         metadata.put("testClassName", recordedMotion.testClassName)
         metadata.put("testMethodName", recordedMotion.testMethodName)
-        metadata.put("deviceLocalPath", deviceLocalPath)
+        metadata.put("deviceLocalPath", goldenFilePath)
         metadata.put("result", result.name)
 
         recordedMotion.videoRenderer?.let { videoRenderer ->
@@ -156,7 +155,7 @@ class MotionTestRule<Toolkit>(
                     goldenFile.resolveSibling("${goldenFile.nameWithoutExtension}.$VIDEO_EXTENSION")
 
                 videoRenderer.renderToFile(videoFile.absolutePath)
-                metadata.put("videoLocation", videoFile.relativeTo(deviceLocalPath))
+                metadata.put("videoLocation", videoFile.relativeTo(goldenFilePath))
             } catch (e: Exception) {
                 Log.e(TAG, "Failed to render motion test video", e)
             }
@@ -173,6 +172,11 @@ class MotionTestRule<Toolkit>(
         }
     }
 
+    private fun getGoldenFilePath(): File {
+        return if (isRobolectricRuntime()) File("/tmp/motion")
+        else File(goldenPathManager.deviceLocalPath)
+    }
+
     private fun requireValidGoldenIdentifier(goldenIdentifier: String) {
         require(goldenIdentifier.matches(GOLDEN_IDENTIFIER_REGEX)) {
             "Golden identifier '$goldenIdentifier' does not satisfy the naming " +
@@ -187,6 +191,10 @@ class MotionTestRule<Toolkit>(
         private const val JSON_INDENTATION = 2
         private val GOLDEN_IDENTIFIER_REGEX = "^[A-Za-z0-9_-]+$".toRegex()
         private const val TAG = "MotionTestRule"
+
+        fun isRobolectricRuntime(): Boolean {
+            return this::class.java.getClassLoader().javaClass.getName().contains("robolectric")
+        }
     }
 }
 
diff --git a/libraries/motion/src/platform/test/motion/RecordedMotion.kt b/libraries/motion/src/platform/test/motion/RecordedMotion.kt
index 37d1640fc..08f136986 100644
--- a/libraries/motion/src/platform/test/motion/RecordedMotion.kt
+++ b/libraries/motion/src/platform/test/motion/RecordedMotion.kt
@@ -47,7 +47,12 @@ internal constructor(
                     MotionScreenshot(frameId, bitmap)
                 }
             filmstrip = Filmstrip(motionScreenshots)
-            videoRenderer = VideoRenderer(motionScreenshots)
+            videoRenderer =
+                if (MotionTestRule.isRobolectricRuntime()) {
+                    null
+                } else {
+                    VideoRenderer(motionScreenshots)
+                }
         } else {
             filmstrip = null
             videoRenderer = null
diff --git a/libraries/motion/src/platform/test/motion/golden/DataPointTypes.kt b/libraries/motion/src/platform/test/motion/golden/DataPointTypes.kt
index f4961c664..bfd0ce08c 100644
--- a/libraries/motion/src/platform/test/motion/golden/DataPointTypes.kt
+++ b/libraries/motion/src/platform/test/motion/golden/DataPointTypes.kt
@@ -43,6 +43,10 @@ object DataPointTypes {
             valueToJson = { it },
         )
 
+    private const val NAN_STRING = "NaN"
+    private const val POSITIVE_INFINITY_STRING = "+"
+    private const val NEGATIVE_INFINITY_STRING = "-"
+
     val float: DataPointType<Float> =
         DataPointType(
             "float",
@@ -50,11 +54,22 @@ object DataPointTypes {
                 when (it) {
                     is Float -> it
                     is Number -> it.toFloat()
+                    NAN_STRING -> Float.NaN
+                    POSITIVE_INFINITY_STRING -> Float.POSITIVE_INFINITY
+                    NEGATIVE_INFINITY_STRING -> Float.NEGATIVE_INFINITY
                     is String -> it.toFloatOrNull() ?: throw UnknownTypeException()
                     else -> throw UnknownTypeException()
                 }
             },
-            valueToJson = { it },
+            valueToJson = {
+                when {
+                    it.isFinite() -> it
+                    it.isNaN() -> NAN_STRING
+                    it == Float.NEGATIVE_INFINITY -> NEGATIVE_INFINITY_STRING
+                    it == Float.POSITIVE_INFINITY -> POSITIVE_INFINITY_STRING
+                    else -> it
+                }
+            },
         )
 
     val int: DataPointType<Int> =
diff --git a/libraries/motion/tests/src/platform/test/motion/MotionTestRuleTest.kt b/libraries/motion/tests/src/platform/test/motion/MotionTestRuleTest.kt
index fa194b700..aa993890e 100644
--- a/libraries/motion/tests/src/platform/test/motion/MotionTestRuleTest.kt
+++ b/libraries/motion/tests/src/platform/test/motion/MotionTestRuleTest.kt
@@ -22,6 +22,7 @@ import android.graphics.Color
 import androidx.test.ext.junit.runners.AndroidJUnit4
 import com.google.common.truth.Truth.assertThat
 import java.io.File
+import java.util.regex.Pattern
 import org.json.JSONArray
 import org.json.JSONException
 import org.json.JSONObject
@@ -41,6 +42,10 @@ class MotionTestRuleTest {
 
     private val subject = MotionTestRule(Unit, goldenPathManager)
 
+    val goldenExportDirectory =
+        if (MotionTestRule.isRobolectricRuntime()) File("/tmp/motion")
+        else File(goldenPathManager.deviceLocalPath)
+
     private val emptyRecordedMotion =
         RecordedMotion(
             "FooClass",
@@ -78,9 +83,7 @@ class MotionTestRuleTest {
             emptyRecordedMotion,
             TimeSeriesVerificationResult.PASSED,
         )
-        val expectedFile =
-            File(goldenPathManager.deviceLocalPath).resolve("FooClass/updated_golden.actual.json")
-
+        val expectedFile = goldenExportDirectory.resolve("FooClass/updated_golden.actual.json")
         assertThat(expectedFile.exists()).isTrue()
     }
 
@@ -91,8 +94,7 @@ class MotionTestRuleTest {
             emptyRecordedMotion,
             TimeSeriesVerificationResult.PASSED,
         )
-        val expectedFile =
-            File(goldenPathManager.deviceLocalPath).resolve("FooClass/updated_golden.actual.json")
+        val expectedFile = goldenExportDirectory.resolve("FooClass/updated_golden.actual.json")
 
         val fileContentsWithoutMetadata =
             JSONObject(expectedFile.readText()).apply { remove("//metadata") }
@@ -113,20 +115,17 @@ class MotionTestRuleTest {
             emptyRecordedMotion,
             TimeSeriesVerificationResult.MISSING_REFERENCE,
         )
-        val expectedFile =
-            File(goldenPathManager.deviceLocalPath).resolve("FooClass/updated_golden.actual.json")
-
+        val expectedFile = goldenExportDirectory.resolve("FooClass/updated_golden.actual.json")
         val fileContents = JSONObject(expectedFile.readText())
         val metadataJson = fileContents.get("//metadata") as JSONObject
 
         assertThat(metadataJson.has("deviceLocalPath")).isTrue()
-        // should be `/data/user/0/platform.test.motion.tests/files/goldens`, but the gradle
-        // setup ends up using `platform.test.motion.test` (without the `s`), even though the
-        // testNamespace property is configured otherwise. Verifying the presence of this
-        // property manually, to ensure the test passes both on gradle and soong. The difference
-        // itself does not matter
         val deviceLocalPath = metadataJson.remove("deviceLocalPath") as String
-        assertThat(deviceLocalPath).startsWith("/data/user/0/platform.test.motion.test")
+        if (MotionTestRule.isRobolectricRuntime()) {
+            assertThat(deviceLocalPath).matches("/tmp/motion")
+        } else {
+            assertThat(deviceLocalPath).matches(DeviceLocalPathPattern)
+        }
 
         assertThat(metadataJson)
             .isEqualTo(
@@ -144,9 +143,7 @@ class MotionTestRuleTest {
     fun writeGeneratedTimeSeries_withScreenshots_writesVideoAndIncludesMetadata() {
         val w = 100
         val h = 200
-
-        subject.writeGeneratedTimeSeries(
-            "updated_golden",
+        val recordedMotion =
             RecordedMotion(
                 "FooClass",
                 "bar_test",
@@ -159,28 +156,30 @@ class MotionTestRuleTest {
                     mockScreenshot(Color.GREEN, w, h),
                     mockScreenshot(Color.BLUE, w, h),
                 ),
-            ),
+            )
+        subject.writeGeneratedTimeSeries(
+            "updated_golden",
+            recordedMotion,
             TimeSeriesVerificationResult.MISSING_REFERENCE,
         )
+        if (recordedMotion.videoRenderer != null) {
+            val expectedVideo =
+                File(goldenPathManager.deviceLocalPath)
+                    .resolve("FooClass/updated_golden.actual.mp4")
+            assertThat(expectedVideo.exists()).isTrue()
+        }
 
-        val expectedVideo =
-            File(goldenPathManager.deviceLocalPath).resolve("FooClass/updated_golden.actual.mp4")
-        assertThat(expectedVideo.exists()).isTrue()
-
-        val expectedFile =
-            File(goldenPathManager.deviceLocalPath).resolve("FooClass/updated_golden.actual.json")
+        val expectedFile = goldenExportDirectory.resolve("FooClass/updated_golden.actual.json")
         val fileContents = JSONObject(expectedFile.readText())
         val metadataJson = fileContents.get("//metadata") as JSONObject
 
         assertThat(metadataJson.has("deviceLocalPath")).isTrue()
-        // should be `/data/user/0/platform.test.motion.tests/files/goldens`, but the gradle
-        // setup ends up using `platform.test.motion.test` (without the `s`), even though the
-        // testNamespace property is configured otherwise. Verifying the presence of this
-        // property manually, to ensure the test passes both on gradle and soong. The difference
-        // itself does not matter
         val deviceLocalPath = metadataJson.remove("deviceLocalPath") as String
-        assertThat(deviceLocalPath).startsWith("/data/user/0/platform.test.motion.test")
-
+        if (!MotionTestRule.isRobolectricRuntime()) {
+            assertThat(deviceLocalPath).matches(DeviceLocalPathPattern)
+        } else {
+            assertThat(deviceLocalPath).matches("/tmp/motion")
+        }
         assertThat(metadataJson)
             .isEqualTo(
                 JSONObject().apply {
@@ -189,7 +188,9 @@ class MotionTestRuleTest {
                     put("testClassName", "FooClass")
                     put("testMethodName", "bar_test")
                     put("result", "MISSING_REFERENCE")
-                    put("videoLocation", "FooClass/updated_golden.actual.mp4")
+                    if (recordedMotion.videoRenderer != null) {
+                        put("videoLocation", "FooClass/updated_golden.actual.mp4")
+                    }
                 }
             )
     }
@@ -211,4 +212,16 @@ class MotionTestRuleTest {
         height: Int = 200,
         bitmapConfig: Bitmap.Config = Bitmap.Config.ARGB_8888,
     ) = Bitmap.createBitmap(width, height, bitmapConfig).also { Canvas(it).drawColor(color) }
+
+    companion object {
+        // The canonical path is `/data/user/0/platform.test.motion.tests/files/goldens`, however:
+        // - Running from gradle, the package name ends with `.test` (as opposed `.tests`)
+        // - Running from HSUM, the user might be different than 0 (10 usually)
+        val DeviceLocalPathPattern: Pattern =
+            Pattern.compile(
+                "/data/user/(?<userId>\\d+)/" +
+                    "platform\\.test\\.motion\\.test(?<gradlePackageNameFix>s?)" +
+                    "/files/goldens"
+            )
+    }
 }
diff --git a/libraries/motion/tests/src/platform/test/motion/golden/DataPointTypesTest.kt b/libraries/motion/tests/src/platform/test/motion/golden/DataPointTypesTest.kt
index e13a16687..c6695c054 100644
--- a/libraries/motion/tests/src/platform/test/motion/golden/DataPointTypesTest.kt
+++ b/libraries/motion/tests/src/platform/test/motion/golden/DataPointTypesTest.kt
@@ -73,6 +73,41 @@ class DataPointTypesTest {
             .isEqualTo(DataPoint.unknownType<Float>())
     }
 
+    @Test
+    fun float_fromJson_NaN() {
+        assertThat(DataPointTypes.float.fromJson("NaN")).isEqualTo(Float.NaN.asDataPoint())
+    }
+
+    @Test
+    fun float_fromJson_positiveInfinity() {
+        assertThat(DataPointTypes.float.fromJson("+"))
+            .isEqualTo(Float.POSITIVE_INFINITY.asDataPoint())
+    }
+
+    @Test
+    fun float_fromJson_negativeInfinity() {
+        assertThat(DataPointTypes.float.fromJson("-"))
+            .isEqualTo(Float.NEGATIVE_INFINITY.asDataPoint())
+    }
+
+    @Test
+    fun float_toJson_NaN() {
+        assertThat(Float.NaN.asDataPoint().asJson()).isEqualTo("NaN")
+    }
+
+    @Test
+    fun float_toJson_positiveInfinity() {
+        assertThat(Float.NaN.asDataPoint().asJson()).isEqualTo("NaN")
+        assertThat(DataPointTypes.float.fromJson("+"))
+            .isEqualTo(Float.POSITIVE_INFINITY.asDataPoint())
+    }
+
+    @Test
+    fun float_toJson_negativeInfinity() {
+        assertThat(DataPointTypes.float.fromJson("-"))
+            .isEqualTo(Float.NEGATIVE_INFINITY.asDataPoint())
+    }
+
     @Test
     fun int_fromJson_native() {
         assertThat(DataPointTypes.int.fromJson(1)).isEqualTo(1.asDataPoint())
diff --git a/libraries/notes-role-test-helper/src/android/platform/helpers/notesrole/NotesRoleUtil.kt b/libraries/notes-role-test-helper/src/android/platform/helpers/notesrole/NotesRoleUtil.kt
index f0aeb40e7..1a2af3287 100644
--- a/libraries/notes-role-test-helper/src/android/platform/helpers/notesrole/NotesRoleUtil.kt
+++ b/libraries/notes-role-test-helper/src/android/platform/helpers/notesrole/NotesRoleUtil.kt
@@ -21,7 +21,7 @@ import android.app.role.RoleManager
 import android.content.Context
 import android.os.Build
 import android.os.UserHandle
-import android.platform.uiautomator_helpers.DeviceHelpers
+import android.platform.uiautomatorhelpers.DeviceHelpers
 import android.util.Log
 import androidx.core.content.getSystemService
 import androidx.test.platform.app.InstrumentationRegistry
@@ -50,11 +50,11 @@ class NotesRoleUtil(private val context: Context) {
     ) {
         assumeTrue(
             "Build SDK should be at least $requiredAndroidVersion",
-            Build.VERSION.SDK_INT >= requiredAndroidVersion
+            Build.VERSION.SDK_INT >= requiredAndroidVersion,
         )
         assumeTrue(
             "Notes role should be enabled",
-            roleManager.isRoleAvailable(RoleManager.ROLE_NOTES)
+            roleManager.isRoleAvailable(RoleManager.ROLE_NOTES),
         )
         assumeTrue("$requiredPackage should be installed", isPackageInstalled(requiredPackage))
     }
@@ -85,7 +85,7 @@ class NotesRoleUtil(private val context: Context) {
                 /* flags= */ 0,
                 userHandle,
                 context.mainExecutor,
-                clearRoleHoldersFuture::complete
+                clearRoleHoldersFuture::complete,
             )
         }
 
@@ -93,7 +93,7 @@ class NotesRoleUtil(private val context: Context) {
         assert(
             clearRoleHoldersFuture.get(
                 ROLE_MANAGER_VERIFICATION_TIMEOUT_IN_SECONDS,
-                TimeUnit.SECONDS
+                TimeUnit.SECONDS,
             )
         ) {
             "Failed to clear notes role holder"
@@ -106,7 +106,7 @@ class NotesRoleUtil(private val context: Context) {
         Log.d(
             TAG,
             "Trying to set note role to $packageName. Current role holder: " +
-                "$currentRoleHolderPackageName"
+                "$currentRoleHolderPackageName",
         )
 
         // Return early if current role holder package is the same as supplied package name.
diff --git a/libraries/runner/Android.bp b/libraries/runner/Android.bp
index 280ad0862..269ece276 100644
--- a/libraries/runner/Android.bp
+++ b/libraries/runner/Android.bp
@@ -20,7 +20,7 @@ package {
 android_library {
     name: "platform-parametric-runner-lib",
     manifest: "AndroidManifest.xml",
-    platform_apis: true,
+    sdk_version: "test_current",
     min_sdk_version: "Tiramisu",
     lint: {
         test: true,
@@ -32,7 +32,7 @@ android_library {
         "src/main/java/**/*.java",
     ],
     libs: [
-        "Robolectric_all-target_upstream",
+        "Robolectric_all-target",
     ],
     static_libs: [],
 }
diff --git a/libraries/runner/OWNERS b/libraries/runner/OWNERS
index 9dfa2ff1b..5678e4418 100644
--- a/libraries/runner/OWNERS
+++ b/libraries/runner/OWNERS
@@ -2,4 +2,3 @@
 
 ihcinihsdk@google.com
 ramperi@google.com
-yuwu@google.com
diff --git a/libraries/screenshot/OWNERS b/libraries/screenshot/OWNERS
index 9dfa2ff1b..5678e4418 100644
--- a/libraries/screenshot/OWNERS
+++ b/libraries/screenshot/OWNERS
@@ -2,4 +2,3 @@
 
 ihcinihsdk@google.com
 ramperi@google.com
-yuwu@google.com
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/Android.bp b/libraries/screenshot/deviceless/layoutlib/tests/Android.bp
index d360f6dfc..8836f12ff 100644
--- a/libraries/screenshot/deviceless/layoutlib/tests/Android.bp
+++ b/libraries/screenshot/deviceless/layoutlib/tests/Android.bp
@@ -38,6 +38,8 @@ java_test_host {
         "objenesis",
         "sdk-common",
         "tools-common-prebuilt",
+        "tools-environment-services",
+        "tools-resource-repository",
         "trove-prebuilt",
     ],
 
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/FrameworkResources.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/FrameworkResources.java
deleted file mode 100644
index b7ec2bdd0..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/FrameworkResources.java
+++ /dev/null
@@ -1,199 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-
-import com.android.SdkConstants;
-import com.android.io.IAbstractFile;
-import com.android.io.IAbstractFolder;
-import com.android.resources.ResourceType;
-import com.android.tools.layoutlib.annotations.NotNull;
-import com.android.tools.layoutlib.annotations.Nullable;
-import com.android.utils.ILogger;
-
-import org.kxml2.io.KXmlParser;
-import org.xmlpull.v1.XmlPullParser;
-
-import java.io.BufferedReader;
-import java.io.InputStreamReader;
-import java.io.Reader;
-import java.util.ArrayList;
-import java.util.Collections;
-import java.util.EnumMap;
-import java.util.List;
-import java.util.Map;
-
-import com.google.common.base.Charsets;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public class FrameworkResources extends ResourceRepository {
-
-    /**
-     * Map of {@link ResourceType} to list of items. It is guaranteed to contain a list for all
-     * possible values of ResourceType.
-     */
-    private final Map<ResourceType, List<ResourceItem>> mPublicResourceMap =
-        new EnumMap<>(ResourceType.class);
-
-    public FrameworkResources(@NotNull TestFolderWrapper resFolder) {
-        super(resFolder, true /*isFrameworkRepository*/);
-    }
-
-    @Override
-    @NotNull
-    protected ResourceItem createResourceItem(@NotNull String name) {
-        return new ResourceItem(name);
-    }
-
-    /**
-     * Reads the public.xml file in data/res/values/ for a given resource folder and builds up
-     * a map of public resources.
-     *
-     * This map is a subset of the full resource map that only contains framework resources
-     * that are public.
-     *
-     * @param logger a logger to report issues to
-     */
-    public void loadPublicResources(@Nullable ILogger logger) {
-        IAbstractFolder valueFolder = getResFolder().getFolder(SdkConstants.FD_RES_VALUES);
-        if (!valueFolder.exists()) {
-            return;
-        }
-
-        IAbstractFile publicXmlFile = valueFolder.getFile("public.xml"); //$NON-NLS-1$
-        if (publicXmlFile.exists()) {
-            try (Reader reader = new BufferedReader(
-                    new InputStreamReader(publicXmlFile.getContents(), Charsets.UTF_8))) {
-                KXmlParser parser = new KXmlParser();
-                parser.setFeature(XmlPullParser.FEATURE_PROCESS_NAMESPACES, false);
-                parser.setInput(reader);
-
-                ResourceType lastType = null;
-                String lastTypeName = "";
-                while (true) {
-                    int event = parser.next();
-                    if (event == XmlPullParser.START_TAG) {
-                        // As of API 15 there are a number of "java-symbol" entries here
-                        if (!parser.getName().equals("public")) { //$NON-NLS-1$
-                            continue;
-                        }
-
-                        String name = null;
-                        String typeName = null;
-                        for (int i = 0, n = parser.getAttributeCount(); i < n; i++) {
-                            String attribute = parser.getAttributeName(i);
-
-                            if (attribute.equals("name")) { //$NON-NLS-1$
-                                name = parser.getAttributeValue(i);
-                                if (typeName != null) {
-                                    // Skip id attribute processing
-                                    break;
-                                }
-                            } else if (attribute.equals("type")) { //$NON-NLS-1$
-                                typeName = parser.getAttributeValue(i);
-                            }
-                        }
-
-                        if (name != null && typeName != null) {
-                            ResourceType type;
-                            if (typeName.equals(lastTypeName)) {
-                                type = lastType;
-                            } else {
-                                type = ResourceType.fromXmlValue(typeName);
-                                lastType = type;
-                                lastTypeName = typeName;
-                            }
-                            if (type != null) {
-                                ResourceItem match = null;
-                                Map<String, ResourceItem> map = mResourceMap.get(type);
-                                if (map != null) {
-                                    match = map.get(name);
-                                }
-
-                                if (match != null) {
-                                    List<ResourceItem> publicList = mPublicResourceMap.get(type);
-                                    if (publicList == null) {
-                                        // Pick initial size for the list to hold the public
-                                        // resources. We could just use map.size() here,
-                                        // but they're usually much bigger; for example,
-                                        // in one platform version, there are 1500 drawables
-                                        // and 1200 strings but only 175 and 25 public ones
-                                        // respectively.
-                                        int size;
-                                        switch (type) {
-                                            case STYLE:
-                                                size = 500;
-                                                break;
-                                            case ATTR:
-                                                size = 1050;
-                                                break;
-                                            case DRAWABLE:
-                                                size = 200;
-                                                break;
-                                            case ID:
-                                                size = 50;
-                                                break;
-                                            case LAYOUT:
-                                            case COLOR:
-                                            case STRING:
-                                            case ANIM:
-                                            case INTERPOLATOR:
-                                                size = 30;
-                                                break;
-                                            default:
-                                                size = 10;
-                                                break;
-                                        }
-                                        publicList = new ArrayList<>(size);
-                                        mPublicResourceMap.put(type, publicList);
-                                    }
-
-                                    publicList.add(match);
-                                }
-                            }
-                        }
-                    } else if (event == XmlPullParser.END_DOCUMENT) {
-                        break;
-                    }
-                }
-            } catch (Exception e) {
-                if (logger != null) {
-                    logger.error(e, "Can't read and parse public attribute list");
-                }
-            }
-        }
-
-        // put unmodifiable list for all res type in the public resource map
-        // this will simplify access
-        for (ResourceType type : ResourceType.values()) {
-            List<ResourceItem> list = mPublicResourceMap.get(type);
-            if (list == null) {
-                list = Collections.emptyList();
-            } else {
-                list = Collections.unmodifiableList(list);
-            }
-
-            // put the new list in the map
-            mPublicResourceMap.put(type, list);
-        }
-    }
-}
-
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/IdGeneratingResourceFile.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/IdGeneratingResourceFile.java
deleted file mode 100644
index 24f9e0b89..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/IdGeneratingResourceFile.java
+++ /dev/null
@@ -1,215 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.ide.common.rendering.api.DensityBasedResourceValueImpl;
-import com.android.ide.common.rendering.api.ResourceNamespace;
-import com.android.ide.common.rendering.api.ResourceReference;
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.rendering.api.ResourceValueImpl;
-import com.android.ide.common.resources.ResourceValueMap;
-import com.android.ide.common.resources.configuration.DensityQualifier;
-import com.android.ide.common.resources.configuration.ResourceQualifier;
-import com.android.ide.common.resources.deprecated.ValueResourceParser.IValueResourceRepository;
-import com.android.io.IAbstractFile;
-import com.android.io.StreamException;
-import com.android.resources.ResourceType;
-
-import java.io.IOException;
-import java.util.Collection;
-import java.util.EnumSet;
-import java.util.HashSet;
-import java.util.Set;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public final class IdGeneratingResourceFile extends ResourceFile
-        implements IValueResourceRepository {
-
-    private final ResourceValueMap mIdResources = ResourceValueMap.create();
-
-    private final Collection<ResourceType> mResourceTypeList;
-
-    private final String mFileName;
-
-    private final ResourceType mFileType;
-
-    private final ResourceValue mFileValue;
-
-    public IdGeneratingResourceFile(TestFileWrapper file, ResourceFolder folder, ResourceType type) {
-        super(file, folder);
-
-        mFileType = type;
-
-        // Set up our resource types
-        mResourceTypeList = EnumSet.of(mFileType, ResourceType.ID);
-
-        // compute the resource name
-        mFileName = getFileName();
-
-        // Get the resource value of this file as a whole layout
-        mFileValue = getFileValue(file, folder);
-    }
-
-    @Override
-    protected void load(ScanningContext context) {
-        // Parse the file and look for @+id/ entries
-        parseFileForIds();
-
-        // create the resource items in the repository
-        updateResourceItems(context);
-    }
-
-    @Override
-    protected void update(ScanningContext context) {
-        // Copy the previous list of ID names
-        Set<String> oldIdNames = new HashSet<>(mIdResources.keySet());
-
-        // reset current content.
-        mIdResources.clear();
-
-        // need to parse the file and find the IDs.
-        if (!parseFileForIds()) {
-            context.requestFullAapt();
-            // Continue through to updating the resource item here since it
-            // will make for example layout rendering more accurate until
-            // aapt is re-run
-        }
-
-        // We only need to update the repository if our IDs have changed
-        Set<String> keySet = mIdResources.keySet();
-        assert keySet != oldIdNames;
-        if (!oldIdNames.equals(keySet)) {
-            updateResourceItems(context);
-        }
-    }
-
-    @Override
-    public ResourceValue getValue(ResourceType type, String name) {
-        // Check to see if they're asking for one of the right types:
-        if (type != mFileType && type != ResourceType.ID) {
-            return null;
-        }
-
-        // If they're looking for a resource of this type with this name give them the whole file
-        if (type == mFileType && name.equals(mFileName)) {
-            return mFileValue;
-        } else {
-            // Otherwise try to return them an ID
-            // the map will return null if it's not found
-            return mIdResources.get(name);
-        }
-    }
-
-    /**
-     * Looks through the file represented for Ids and adds them to
-     * our id repository
-     *
-     * @return true if parsing succeeds and false if it fails
-     */
-    private boolean parseFileForIds() {
-        IdResourceParser parser = new IdResourceParser(this, isFramework());
-        try {
-            IAbstractFile file = getFile();
-            return parser.parse(file.getContents());
-        } catch (IOException | StreamException ignore) {}
-
-        return false;
-    }
-
-    /**
-     * Add the resources represented by this file to the repository
-     */
-    private void updateResourceItems(ScanningContext context) {
-        ResourceRepository repository = getRepository();
-
-        // remove this file from all existing ResourceItem.
-        repository.removeFile(mResourceTypeList, this);
-
-        // First add this as a layout file
-        ResourceItem item = repository.getResourceItem(mFileType, mFileName);
-        item.add(this);
-
-        // Now iterate through our IDs and add
-        for (String idName : mIdResources.keySet()) {
-            item = repository.getResourceItem(ResourceType.ID, idName);
-            // add this file to the list of files generating ID resources.
-            item.add(this);
-        }
-
-        //  Ask the repository for an ID refresh
-        context.requestFullAapt();
-    }
-
-    /**
-     * Returns the resource value associated with this whole file as a layout resource
-     * @param file the file handler that represents this file
-     * @param folder the folder this file is under
-     * @return a resource value associated with this layout
-     */
-    private ResourceValue getFileValue(IAbstractFile file, ResourceFolder folder) {
-        // test if there's a density qualifier associated with the resource
-        DensityQualifier qualifier = folder.getConfiguration().getDensityQualifier();
-
-        ResourceValue value;
-        if (!ResourceQualifier.isValid(qualifier)) {
-            value =
-                    new ResourceValueImpl(
-                            new ResourceReference(
-                                    ResourceNamespace.fromBoolean(isFramework()),
-                                    mFileType,
-                                    mFileName),
-                            file.getOsLocation());
-        } else {
-            value =
-                    new DensityBasedResourceValueImpl(
-                            new ResourceReference(
-                                    ResourceNamespace.fromBoolean(isFramework()),
-                                    mFileType,
-                                    mFileName),
-                            file.getOsLocation(),
-                            qualifier.getValue());
-        }
-        return value;
-    }
-
-
-    /**
-     * Returns the name of this resource.
-     */
-    private String getFileName() {
-        // get the name from the filename.
-        String name = getFile().getName();
-
-        int pos = name.indexOf('.');
-        if (pos != -1) {
-            name = name.substring(0, pos);
-        }
-
-        return name;
-    }
-
-    @Override
-    public void addResourceValue(ResourceValue value) {
-        // Just overwrite collisions. We're only interested in the unique
-        // IDs declared
-        mIdResources.put(value.getName(), value);
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/IdResourceParser.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/IdResourceParser.java
deleted file mode 100644
index f18c1f9c6..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/IdResourceParser.java
+++ /dev/null
@@ -1,122 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.SdkConstants;
-import com.android.ide.common.rendering.api.ResourceNamespace;
-import com.android.ide.common.rendering.api.ResourceReference;
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.rendering.api.ResourceValueImpl;
-import com.android.ide.common.resources.deprecated.ValueResourceParser.IValueResourceRepository;
-import com.android.resources.ResourceType;
-import com.android.tools.layoutlib.annotations.NotNull;
-
-import org.kxml2.io.KXmlParser;
-import org.xmlpull.v1.XmlPullParser;
-import org.xmlpull.v1.XmlPullParserException;
-
-import java.io.BufferedInputStream;
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.io.InputStream;
-
-import com.google.common.io.Closeables;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public class IdResourceParser {
-    private final IValueResourceRepository mRepository;
-    private final boolean mIsFramework;
-
-    /**
-     * Creates a new {@link com.android.ide.common.resources.deprecated.IdResourceParser}
-     *
-     * @param repository value repository for registering resource declaration
-     * @param isFramework true if scanning a framework resource
-     */
-    public IdResourceParser(
-            @NotNull ValueResourceParser.IValueResourceRepository repository,
-            boolean isFramework) {
-        mRepository = repository;
-        mIsFramework = isFramework;
-    }
-
-    /**
-     * Parse the given input and register ids with the given
-     * {@link IValueResourceRepository}.
-     *
-     * @param input the input stream of the XML to be parsed (will be closed by this method)
-     * @return true if parsing succeeds and false if it fails
-     * @throws IOException if reading the contents fails
-     */
-    public boolean parse(InputStream input)
-            throws IOException {
-        KXmlParser parser = new KXmlParser();
-        try {
-            parser.setFeature(XmlPullParser.FEATURE_PROCESS_NAMESPACES, true);
-
-            if (input instanceof FileInputStream) {
-                input = new BufferedInputStream(input);
-            }
-            parser.setInput(input, SdkConstants.UTF_8);
-
-            return parse(parser);
-        } catch (XmlPullParserException | RuntimeException e) {
-            return false;
-        } finally {
-            try {
-                Closeables.close(input, true /* swallowIOException */);
-            } catch (IOException e) {
-                // cannot happen
-            }
-        }
-    }
-
-    private boolean parse(KXmlParser parser)
-            throws XmlPullParserException, IOException {
-        while (true) {
-            int event = parser.next();
-            if (event == XmlPullParser.START_TAG) {
-                for (int i = 0, n = parser.getAttributeCount(); i < n; i++) {
-                    String attribute = parser.getAttributeName(i);
-                    String value = parser.getAttributeValue(i);
-                    assert value != null : attribute;
-
-                    if (value.startsWith("@+")) {       //$NON-NLS-1$
-                        // Strip out the @+id/ or @+android:id/ section
-                        String id = value.substring(value.indexOf('/') + 1);
-                        ResourceValue newId =
-                                new ResourceValueImpl(
-                                        new ResourceReference(
-                                                ResourceNamespace.fromBoolean(mIsFramework),
-                                                ResourceType.ID,
-                                                id),
-                                        null);
-                        mRepository.addResourceValue(newId);
-                    }
-                }
-            } else if (event == XmlPullParser.END_DOCUMENT) {
-                break;
-            }
-        }
-
-        return true;
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/MultiResourceFile.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/MultiResourceFile.java
deleted file mode 100644
index cb20b40d5..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/MultiResourceFile.java
+++ /dev/null
@@ -1,190 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.rendering.api.ResourceValueImpl;
-import com.android.ide.common.resources.ResourceValueMap;
-import com.android.ide.common.resources.deprecated.ValueResourceParser.IValueResourceRepository;
-import com.android.io.IAbstractFile;
-import com.android.io.StreamException;
-import com.android.resources.ResourceType;
-import com.android.utils.XmlUtils;
-
-import org.xml.sax.SAXException;
-
-import java.io.IOException;
-import java.util.Collection;
-import java.util.Collections;
-import java.util.EnumMap;
-import java.util.Map;
-
-import javax.xml.parsers.ParserConfigurationException;
-import javax.xml.parsers.SAXParser;
-import javax.xml.parsers.SAXParserFactory;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public final class MultiResourceFile extends ResourceFile implements IValueResourceRepository {
-
-    private static final SAXParserFactory sParserFactory = XmlUtils.configureSaxFactory(
-            SAXParserFactory.newInstance(), false, false);
-
-    private final Map<ResourceType, ResourceValueMap> mResourceItems =
-        new EnumMap<>(ResourceType.class);
-
-    private Collection<ResourceType> mResourceTypeList = null;
-
-    public MultiResourceFile(TestFileWrapper file, ResourceFolder folder) {
-        super(file, folder);
-    }
-
-    // Boolean flag to track whether a named element has been added or removed, thus requiring
-    // a new ID table to be generated
-    private boolean mNeedIdRefresh;
-
-    @Override
-    protected void load(ScanningContext context) {
-        // need to parse the file and find the content.
-        parseFile();
-
-        // create new ResourceItems for the new content.
-        mResourceTypeList = Collections.unmodifiableCollection(mResourceItems.keySet());
-
-        // We need an ID generation step
-        mNeedIdRefresh = true;
-
-        // create/update the resource items.
-        updateResourceItems(context);
-    }
-
-    @Override
-    protected void update(ScanningContext context) {
-        // Reset the ID generation flag
-        mNeedIdRefresh = false;
-
-        // Copy the previous version of our list of ResourceItems and types
-        Map<ResourceType, ResourceValueMap> oldResourceItems
-                        = new EnumMap<>(mResourceItems);
-
-        // reset current content.
-        mResourceItems.clear();
-
-        // need to parse the file and find the content.
-        parseFile();
-
-        // create new ResourceItems for the new content.
-        mResourceTypeList = Collections.unmodifiableCollection(mResourceItems.keySet());
-
-        // Check to see if any names have changed. If so, mark the flag so updateResourceItems
-        // can notify the ResourceRepository that an ID refresh is needed
-        if (oldResourceItems.keySet().equals(mResourceItems.keySet())) {
-            for (ResourceType type : mResourceTypeList) {
-                // We just need to check the names of the items.
-                // If there are new or removed names then we'll have to regenerate IDs
-                if (!mResourceItems.get(type).keySet().equals(oldResourceItems.get(type).keySet())) {
-                    mNeedIdRefresh = true;
-                }
-            }
-        } else {
-            // If our type list is different, obviously the names will be different
-            mNeedIdRefresh = true;
-        }
-        // create/update the resource items.
-        updateResourceItems(context);
-    }
-
-    private void updateResourceItems(ScanningContext context) {
-        ResourceRepository repository = getRepository();
-
-        // remove this file from all existing ResourceItem.
-        repository.removeFile(mResourceTypeList, this);
-
-        for (ResourceType type : mResourceTypeList) {
-            ResourceValueMap list = mResourceItems.get(type);
-
-            if (list != null) {
-                Collection<ResourceValue> values = list.values();
-                for (ResourceValue res : values) {
-                    ResourceItem item = repository.getResourceItem(type, res.getName());
-
-                    // add this file to the list of files generating this resource item.
-                    item.add(this);
-                }
-            }
-        }
-
-        // If we need an ID refresh, ask the repository for that now
-        if (mNeedIdRefresh) {
-            context.requestFullAapt();
-        }
-    }
-
-    /**
-     * Parses the file and creates a list of {@link ResourceType}.
-     */
-    private void parseFile() {
-        try {
-            SAXParser parser = XmlUtils.createSaxParser(sParserFactory);
-            parser.parse(getFile().getContents(), new ValueResourceParser(this, isFramework(), null));
-        } catch (ParserConfigurationException | IOException | StreamException | SAXException ignore) {
-        }
-    }
-
-    /**
-     * Adds a resource item to the list
-     * @param value The value of the resource.
-     */
-    @Override
-    public void addResourceValue(ResourceValue value) {
-        ResourceType resType = value.getResourceType();
-
-        ResourceValueMap list = mResourceItems.get(resType);
-
-        // if the list does not exist, create it.
-        if (list == null) {
-            list = ResourceValueMap.create();
-            mResourceItems.put(resType, list);
-        } else {
-            // look for a possible value already existing.
-            ResourceValue oldValue = list.get(value.getName());
-
-            if (oldValue instanceof ResourceValueImpl) {
-                ((ResourceValueImpl) oldValue).replaceWith(value);
-                return;
-            }
-        }
-
-        // empty list or no match found? add the given resource
-        list.put(value.getName(), value);
-    }
-
-    @Override
-    public ResourceValue getValue(ResourceType type, String name) {
-        // get the list for the given type
-        ResourceValueMap list = mResourceItems.get(type);
-
-        if (list != null) {
-            return list.get(name);
-        }
-
-        return null;
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceFile.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceFile.java
deleted file mode 100644
index a6af9fb8f..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceFile.java
+++ /dev/null
@@ -1,78 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.resources.configuration.Configurable;
-import com.android.ide.common.resources.configuration.FolderConfiguration;
-import com.android.resources.ResourceType;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public abstract class ResourceFile implements Configurable {
-
-    private final TestFileWrapper mFile;
-    private final ResourceFolder mFolder;
-
-    protected ResourceFile(TestFileWrapper file, ResourceFolder folder) {
-        mFile = file;
-        mFolder = folder;
-    }
-
-    protected abstract void load(ScanningContext context);
-    protected abstract void update(ScanningContext context);
-
-    @Override
-    public FolderConfiguration getConfiguration() {
-        return mFolder.getConfiguration();
-    }
-
-    /**
-     * Returns the IFile associated with the ResourceFile.
-     */
-    public final TestFileWrapper getFile() {
-        return mFile;
-    }
-
-    public final ResourceRepository getRepository() {
-        return mFolder.getRepository();
-    }
-
-    /**
-     * Returns whether the resource is a framework resource.
-     */
-    public final boolean isFramework() {
-        return mFolder.getRepository().isFrameworkRepository();
-    }
-
-    /**
-     * Returns the value of a resource generated by this file by {@link ResourceType} and name.
-     * <p>If no resource match, <code>null</code> is returned.
-     * @param type the type of the resource.
-     * @param name the name of the resource.
-     */
-    public abstract ResourceValue getValue(ResourceType type, String name);
-
-    @Override
-    public String toString() {
-        return mFile.toString();
-    }
-}
-
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceFolder.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceFolder.java
deleted file mode 100644
index fb98dc870..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceFolder.java
+++ /dev/null
@@ -1,151 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.SdkConstants;
-import com.android.ide.common.resources.configuration.Configurable;
-import com.android.ide.common.resources.configuration.FolderConfiguration;
-import com.android.io.IAbstractFile;
-import com.android.io.IAbstractFolder;
-import com.android.resources.FolderTypeRelationship;
-import com.android.resources.ResourceFolderType;
-import com.android.resources.ResourceType;
-import com.android.utils.SdkUtils;
-
-import java.util.List;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public final class ResourceFolder implements Configurable {
-    private final ResourceFolderType mType;
-    final FolderConfiguration mConfiguration;
-    IAbstractFolder mFolder;
-    private final ResourceRepository mRepository;
-
-    /**
-     * Creates a new {@link com.android.ide.common.resources.deprecated.ResourceFolder}
-     * @param type The type of the folder
-     * @param config The configuration of the folder
-     * @param folder The associated {@link IAbstractFolder} object.
-     * @param repository The associated {@link ResourceRepository}
-     */
-    protected ResourceFolder(ResourceFolderType type, FolderConfiguration config,
-            IAbstractFolder folder, ResourceRepository repository) {
-        mType = type;
-        mConfiguration = config;
-        mFolder = folder;
-        mRepository = repository;
-    }
-
-    /**
-     * Processes a file and adds it to its parent folder resource.
-     *
-     * @param file the underlying resource file.
-     * @param kind the file change kind.
-     * @param context a context object with state for the current update, such
-     *            as a place to stash errors encountered
-     * @return the {@link ResourceFile} that was created.
-     */
-    public ResourceFile processFile(TestFileWrapper file, ResourceDeltaKind kind,
-            ScanningContext context) {
-        // look for this file if it's already been created
-        ResourceFile resFile = getFile(file, context);
-
-        if (resFile == null) {
-            if (kind != ResourceDeltaKind.REMOVED) {
-                // create a ResourceFile for it.
-
-                resFile = createResourceFile(file);
-                resFile.load(context);
-            }
-        } else {
-            if (kind != ResourceDeltaKind.REMOVED) {
-                resFile.update(context);
-            }
-        }
-
-        return resFile;
-    }
-
-    private ResourceFile createResourceFile(TestFileWrapper file) {
-        // check if that's a single or multi resource type folder. We have a special case
-        // for ID generating resource types (layout/menu, and XML drawables, etc.).
-        // MultiResourceFile handles the case when several resource types come from a single file
-        // (values files).
-
-        ResourceFile resFile;
-        if (mType != ResourceFolderType.VALUES) {
-            if (FolderTypeRelationship.isIdGeneratingFolderType(mType) &&
-                SdkUtils.endsWithIgnoreCase(file.getName(), SdkConstants.DOT_XML)) {
-                List<ResourceType> types = FolderTypeRelationship.getRelatedResourceTypes(mType);
-                ResourceType primaryType = types.get(0);
-                resFile = new IdGeneratingResourceFile(file, this, primaryType);
-            } else {
-                resFile = new SingleResourceFile(file, this);
-            }
-        } else {
-            resFile = new MultiResourceFile(file, this);
-        }
-        return resFile;
-    }
-
-    /**
-     * Returns the {@link ResourceFolderType} of this object.
-     */
-    public ResourceFolderType getType() {
-        return mType;
-    }
-
-    public ResourceRepository getRepository() {
-        return mRepository;
-    }
-
-    @Override
-    public FolderConfiguration getConfiguration() {
-        return mConfiguration;
-    }
-
-    /**
-     * Returns the {@link ResourceFile} matching a {@link IAbstractFile} object.
-     *
-     * @param file The {@link IAbstractFile} object.
-     * @param context a context object with state for the current update, such
-     *            as a place to stash errors encountered
-     * @return the {@link ResourceFile} or null if no match was found.
-     */
-    private ResourceFile getFile(TestFileWrapper file, ScanningContext context) {
-        assert mFolder.equals(file.getParentFolder());
-
-        // If the file actually exists, the resource folder  may not have been
-        // scanned yet; add it lazily
-        if (file.exists()) {
-            ResourceFile resFile = createResourceFile(file);
-            resFile.load(context);
-            return resFile;
-        }
-
-        return null;
-    }
-
-    @Override
-    public String toString() {
-        return mFolder.toString();
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceItem.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceItem.java
deleted file mode 100644
index a7281e9db..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceItem.java
+++ /dev/null
@@ -1,107 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.resources.configuration.FolderConfiguration;
-import com.android.resources.ResourceType;
-
-import java.util.ArrayList;
-import java.util.List;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public class ResourceItem implements Comparable<ResourceItem> {
-    private final String mName;
-
-    /**
-     * List of files generating this ResourceItem.
-     */
-    private final List<ResourceFile> mFiles = new ArrayList<>();
-
-    /**
-     * Constructs a new ResourceItem.
-     * @param name the name of the resource as it appears in the XML and R.java files.
-     */
-    public ResourceItem(String name) {
-        mName = name;
-    }
-
-    /**
-     * Returns the name of the resource.
-     */
-    public final String getName() {
-        return mName;
-    }
-
-    /**
-     * Compares the {@link com.android.ide.common.resources.deprecated.ResourceItem} to another.
-     * @param other the ResourceItem to be compared to.
-     */
-    @Override
-    public int compareTo(com.android.ide.common.resources.deprecated.ResourceItem other) {
-        return mName.compareTo(other.mName);
-    }
-
-    /**
-     * Returns a {@link ResourceValue} for this item based on the given configuration.
-     * If the ResourceItem has several source files, one will be selected based on the config.
-     * @param type the type of the resource. This is necessary because ResourceItem doesn't embed
-     *     its type, but ResourceValue does.
-     * @param referenceConfig the config of the resource item.
-     * @return a ResourceValue or null if none match the config.
-     */
-    public ResourceValue getResourceValue(ResourceType type, FolderConfiguration referenceConfig) {
-        // look for the best match for the given configuration
-        // the match has to be of type ResourceFile since that's what the input list contains
-        ResourceFile match = referenceConfig.findMatchingConfigurable(mFiles);
-
-        if (match != null) {
-            // get the value of this configured resource.
-            return match.getValue(type, mName);
-        }
-
-        return null;
-    }
-
-    /**
-     * Adds a new source file.
-     * @param file the source file.
-     */
-    protected void add(ResourceFile file) {
-        mFiles.add(file);
-    }
-
-    /**
-     * Removes a file from the list of source files.
-     * @param file the file to remove
-     */
-    protected void removeFile(ResourceFile file) {
-        mFiles.remove(file);
-    }
-
-    /**
-     * Returns {@code true} if the item has no source file.
-     * @return true if the item has no source file.
-     */
-    protected boolean hasNoSourceFile() {
-        return mFiles.isEmpty();
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceRepository.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceRepository.java
deleted file mode 100644
index 61074b5a2..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceRepository.java
+++ /dev/null
@@ -1,393 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package com.android.ide.common.resources.deprecated;
-
-import com.android.SdkConstants;
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.resources.ResourceValueMap;
-import com.android.ide.common.resources.configuration.FolderConfiguration;
-import com.android.io.IAbstractFolder;
-import com.android.io.IAbstractResource;
-import com.android.resources.ResourceFolderType;
-import com.android.resources.ResourceType;
-import com.android.tools.layoutlib.annotations.NotNull;
-import com.android.tools.layoutlib.annotations.Nullable;
-
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.EnumMap;
-import java.util.HashMap;
-import java.util.List;
-import java.util.Map;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public abstract class ResourceRepository {
-    private final TestFolderWrapper mResourceFolder;
-
-    private Map<ResourceFolderType, List<ResourceFolder>> mFolderMap =
-            new EnumMap<>(ResourceFolderType.class);
-
-    protected Map<ResourceType, Map<String, ResourceItem>> mResourceMap =
-            new EnumMap<>(ResourceType.class);
-
-    private final boolean mFrameworkRepository;
-    private boolean mCleared = true;
-    private boolean mInitializing;
-
-    /**
-     * Makes a resource repository.
-     *
-     * @param resFolder the resource folder of the repository.
-     * @param isFrameworkRepository whether the repository is for framework resources.
-     */
-    protected ResourceRepository(@NotNull TestFolderWrapper resFolder,
-            boolean isFrameworkRepository) {
-        mResourceFolder = resFolder;
-        mFrameworkRepository = isFrameworkRepository;
-    }
-
-    public TestFolderWrapper getResFolder() {
-        return mResourceFolder;
-    }
-
-    public boolean isFrameworkRepository() {
-        return mFrameworkRepository;
-    }
-
-    private synchronized void clear() {
-        mCleared = true;
-        mFolderMap = new EnumMap<>(ResourceFolderType.class);
-        mResourceMap = new EnumMap<>(ResourceType.class);
-    }
-
-    /**
-     * Ensures that the repository has been initialized again after a call to
-     * {@link com.android.ide.common.resources.deprecated.ResourceRepository#clear()}.
-     *
-     * @return true if the repository was just re-initialized.
-     */
-    private synchronized boolean ensureInitialized() {
-        if (mCleared && !mInitializing) {
-            ScanningContext context = new ScanningContext();
-            mInitializing = true;
-
-            IAbstractResource[] resources = mResourceFolder.listMembers();
-
-            for (IAbstractResource res : resources) {
-                if (res instanceof TestFolderWrapper) {
-                    TestFolderWrapper folder = (TestFolderWrapper)res;
-                    ResourceFolder resFolder = processFolder(folder);
-
-                    if (resFolder != null) {
-                        // now we process the content of the folder
-                        IAbstractResource[] files = folder.listMembers();
-
-                        for (IAbstractResource fileRes : files) {
-                            if (fileRes instanceof TestFileWrapper) {
-                                TestFileWrapper file = (TestFileWrapper) fileRes;
-
-                                resFolder.processFile(file, ResourceDeltaKind.ADDED, context);
-                            }
-                        }
-                    }
-                }
-            }
-
-            mInitializing = false;
-            mCleared = false;
-            return true;
-        }
-
-        return false;
-    }
-
-    /**
-     * Adds a Folder Configuration to the project.
-     *
-     * @param type The resource type.
-     * @param config The resource configuration.
-     * @param folder The workspace folder object.
-     * @return the {@link ResourceFolder} object associated to this folder.
-     */
-    private ResourceFolder add(
-            @NotNull ResourceFolderType type,
-            @NotNull FolderConfiguration config,
-            @NotNull IAbstractFolder folder) {
-        // get the list for the resource type
-        List<ResourceFolder> list = mFolderMap.get(type);
-
-        if (list == null) {
-            list = new ArrayList<>();
-
-            ResourceFolder cf = new ResourceFolder(type, config, folder, this);
-            list.add(cf);
-
-            mFolderMap.put(type, list);
-
-            return cf;
-        }
-
-        // look for an already existing folder configuration.
-        for (ResourceFolder cFolder : list) {
-            if (cFolder.mConfiguration.equals(config)) {
-                // config already exist. Nothing to be done really, besides making sure
-                // the IAbstractFolder object is up to date.
-                cFolder.mFolder = folder;
-                return cFolder;
-            }
-        }
-
-        // If we arrive here, this means we didn't find a matching configuration.
-        // So we add one.
-        ResourceFolder cf = new ResourceFolder(type, config, folder, this);
-        list.add(cf);
-
-        return cf;
-    }
-
-    /**
-     * Returns a {@link ResourceItem} matching the given {@link ResourceType} and name. If none
-     * exist, it creates one.
-     *
-     * @param type the resource type
-     * @param name the name of the resource.
-     * @return A resource item matching the type and name.
-     */
-    @NotNull
-    public ResourceItem getResourceItem(@NotNull ResourceType type, @NotNull String name) {
-        ensureInitialized();
-
-        // looking for an existing ResourceItem with this type and name
-        ResourceItem item = findDeclaredResourceItem(type, name);
-
-        // create one if there isn't one already, or if the existing one is inlined, since
-        // clearly we need a non inlined one (the inline one is removed too)
-        if (item == null) {
-            item = createResourceItem(name);
-
-            Map<String, ResourceItem> map = mResourceMap.get(type);
-
-            if (map == null) {
-                if (isFrameworkRepository()) {
-                    // Pick initial size for the maps. Also change the load factor to 1.0
-                    // to avoid rehashing the whole table when we (as expected) get near
-                    // the known rough size of each resource type map.
-                    int size;
-                    switch (type) {
-                        // Based on counts in API 16. Going back to API 10, the counts
-                        // are roughly 25-50% smaller (e.g. compared to the top 5 types below
-                        // the fractions are 1107 vs 1734, 831 vs 1508, 895 vs 1255,
-                        // 733 vs 1064 and 171 vs 783.
-                        case PUBLIC:           size = 1734; break;
-                        case DRAWABLE:         size = 1508; break;
-                        case STRING:           size = 1255; break;
-                        case ATTR:             size = 1064; break;
-                        case STYLE:             size = 783; break;
-                        case ID:                size = 347; break;
-                        case STYLEABLE:
-                            size = 210;
-                            break;
-                        case LAYOUT:            size = 187; break;
-                        case COLOR:             size = 120; break;
-                        case ANIM:               size = 95; break;
-                        case DIMEN:              size = 81; break;
-                        case BOOL:               size = 54; break;
-                        case INTEGER:            size = 52; break;
-                        case ARRAY:              size = 51; break;
-                        case PLURALS:            size = 20; break;
-                        case XML:                size = 14; break;
-                        case INTERPOLATOR :      size = 13; break;
-                        case ANIMATOR:            size = 8; break;
-                        case RAW:                 size = 4; break;
-                        case MENU:                size = 2; break;
-                        case MIPMAP:              size = 2; break;
-                        case FRACTION:            size = 1; break;
-                        default:
-                            size = 2;
-                    }
-                    map = new HashMap<>(size, 1.0f);
-                } else {
-                    map = new HashMap<>();
-                }
-                mResourceMap.put(type, map);
-            }
-
-            map.put(item.getName(), item);
-        }
-
-        return item;
-    }
-
-    /**
-     * Creates a resource item with the given name.
-     * @param name the name of the resource
-     * @return a new ResourceItem (or child class) instance.
-     */
-    @NotNull
-    protected abstract ResourceItem createResourceItem(@NotNull String name);
-
-    /**
-     * Processes a folder and adds it to the list of existing folders.
-     * @param folder the folder to process
-     * @return the ResourceFolder created from this folder, or null if the process failed.
-     */
-    @Nullable
-    private ResourceFolder processFolder(@NotNull TestFolderWrapper folder) {
-        ensureInitialized();
-
-        // split the name of the folder in segments.
-        String[] folderSegments = folder.getName().split(SdkConstants.RES_QUALIFIER_SEP);
-
-        // get the enum for the resource type.
-        ResourceFolderType type = ResourceFolderType.getTypeByName(folderSegments[0]);
-
-        if (type != null) {
-            // get the folder configuration.
-            FolderConfiguration config = FolderConfiguration.getConfig(folderSegments);
-
-            if (config != null) {
-                return add(type, config, folder);
-            }
-        }
-
-        return null;
-    }
-
-    /**
-     * Returns the resources values matching a given {@link FolderConfiguration}.
-     *
-     * @param referenceConfig the configuration that each value must match.
-     * @return a map with guaranteed to contain an entry for each {@link ResourceType}
-     */
-    @NotNull
-    public Map<ResourceType, ResourceValueMap> getConfiguredResources(
-            @NotNull FolderConfiguration referenceConfig) {
-        ensureInitialized();
-
-        return doGetConfiguredResources(referenceConfig);
-    }
-
-    /**
-     * Returns the resources values matching a given {@link FolderConfiguration} for the current
-     * project.
-     *
-     * @param referenceConfig the configuration that each value must match.
-     * @return a map with guaranteed to contain an entry for each {@link ResourceType}
-     */
-    @NotNull
-    private Map<ResourceType, ResourceValueMap> doGetConfiguredResources(
-            @NotNull FolderConfiguration referenceConfig) {
-        ensureInitialized();
-
-        Map<ResourceType, ResourceValueMap> map =
-            new EnumMap<>(ResourceType.class);
-
-        for (ResourceType key : ResourceType.values()) {
-            // get the local results and put them in the map
-            map.put(key, getConfiguredResource(key, referenceConfig));
-        }
-
-        return map;
-    }
-
-    /**
-     * Loads the resources.
-     */
-    public void loadResources() {
-        clear();
-        ensureInitialized();
-    }
-
-    protected void removeFile(@NotNull Collection<ResourceType> types,
-            @NotNull ResourceFile file) {
-        ensureInitialized();
-
-        for (ResourceType type : types) {
-            removeFile(type, file);
-        }
-    }
-
-    private void removeFile(@NotNull ResourceType type, @NotNull ResourceFile file) {
-        Map<String, ResourceItem> map = mResourceMap.get(type);
-        if (map != null) {
-            Collection<ResourceItem> values = map.values();
-            List<ResourceItem> toDelete = null;
-            for (ResourceItem item : values) {
-                item.removeFile(file);
-                if (item.hasNoSourceFile()) {
-                    if (toDelete == null) {
-                        toDelete = new ArrayList<>(values.size());
-                    }
-                    toDelete.add(item);
-                }
-            }
-            if (toDelete != null) {
-                for (ResourceItem item : toDelete) {
-                    map.remove(item.getName());
-                }
-            }
-        }
-    }
-
-    /**
-     * Returns a map of (resource name, resource value) for the given {@link ResourceType}.
-     * <p>The values returned are taken from the resource files best matching a given
-     * {@link FolderConfiguration}.
-     *
-     * @param type the type of the resources.
-     * @param referenceConfig the configuration to best match.
-     */
-    @NotNull
-    private ResourceValueMap getConfiguredResource(@NotNull ResourceType type,
-            @NotNull FolderConfiguration referenceConfig) {
-        // get the resource item for the given type
-        Map<String, ResourceItem> items = mResourceMap.get(type);
-        if (items == null) {
-            return ResourceValueMap.create();
-        }
-
-        // create the map
-        ResourceValueMap map = ResourceValueMap.createWithExpectedSize(items.size());
-
-        for (ResourceItem item : items.values()) {
-            ResourceValue value = item.getResourceValue(type, referenceConfig);
-            if (value != null) {
-                map.put(item.getName(), value);
-            }
-        }
-
-        return map;
-    }
-
-    /**
-     * Looks up an existing {@link ResourceItem} by {@link ResourceType} and name.
-     *
-     * @param type the resource type.
-     * @param name the resource name.
-     * @return the existing ResourceItem or null if no match was found.
-     */
-    @Nullable
-    private ResourceItem findDeclaredResourceItem(
-            @NotNull ResourceType type, @NotNull String name) {
-        Map<String, ResourceItem> map = mResourceMap.get(type);
-        return map != null ? map.get(name) : null;
-    }
-}
-
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ScanningContext.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ScanningContext.java
deleted file mode 100644
index d26f63981..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ScanningContext.java
+++ /dev/null
@@ -1,44 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package com.android.ide.common.resources.deprecated;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public class ScanningContext {
-    private boolean mNeedsFullAapt;
-
-    /**
-     * Marks that a full aapt compilation of the resources is necessary because it has
-     * detected a change that cannot be incrementally handled.
-     */
-    protected void requestFullAapt() {
-        mNeedsFullAapt = true;
-    }
-
-    /**
-     * Returns whether this repository has been marked as "dirty"; if one or
-     * more of the constituent files have declared that the resource item names
-     * that they provide have changed.
-     *
-     * @return true if a full aapt compilation is required
-     */
-    public boolean needsFullAapt() {
-        return mNeedsFullAapt;
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/SingleResourceFile.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/SingleResourceFile.java
deleted file mode 100644
index f99b53f4b..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/SingleResourceFile.java
+++ /dev/null
@@ -1,150 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package com.android.ide.common.resources.deprecated;
-
-import com.android.ide.common.rendering.api.DensityBasedResourceValueImpl;
-import com.android.ide.common.rendering.api.ResourceNamespace;
-import com.android.ide.common.rendering.api.ResourceReference;
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.rendering.api.ResourceValueImpl;
-import com.android.ide.common.resources.configuration.DensityQualifier;
-import com.android.ide.common.resources.configuration.ResourceQualifier;
-import com.android.io.IAbstractFile;
-import com.android.resources.FolderTypeRelationship;
-import com.android.resources.ResourceType;
-import com.android.utils.SdkUtils;
-
-import java.util.List;
-
-
-import static com.android.SdkConstants.DOT_XML;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public class SingleResourceFile extends ResourceFile {
-    private final String mResourceName;
-    private final ResourceType mType;
-    private final ResourceValue mValue;
-
-    public SingleResourceFile(TestFileWrapper file, ResourceFolder folder) {
-        super(file, folder);
-
-        // we need to infer the type of the resource from the folder type.
-        // This is easy since this is a single Resource file.
-        List<ResourceType> types = FolderTypeRelationship.getRelatedResourceTypes(folder.getType());
-        mType = types.get(0);
-
-        // compute the resource name
-        mResourceName = getResourceName();
-
-        // test if there's a density qualifier associated with the resource
-        DensityQualifier qualifier = folder.getConfiguration().getDensityQualifier();
-
-        if (!ResourceQualifier.isValid(qualifier)) {
-            mValue =
-                    new ResourceValueImpl(
-                            new ResourceReference(
-                                    ResourceNamespace.fromBoolean(isFramework()),
-                                    mType,
-                                    getResourceName()),
-                            file.getOsLocation());
-        } else {
-            mValue =
-                    new DensityBasedResourceValueImpl(
-                            new ResourceReference(
-                                    ResourceNamespace.fromBoolean(isFramework()),
-                                    mType,
-                                    getResourceName()),
-                            file.getOsLocation(),
-                            qualifier.getValue());
-        }
-    }
-
-    @Override
-    protected void load(ScanningContext context) {
-        // get a resource item matching the given type and name
-        ResourceItem item = getRepository().getResourceItem(mType, mResourceName);
-
-        // add this file to the list of files generating this resource item.
-        item.add(this);
-
-        // Ask for an ID refresh since we're adding an item that will generate an ID
-        context.requestFullAapt();
-    }
-
-    @Override
-    protected void update(ScanningContext context) {
-        // when this happens, nothing needs to be done since the file only generates
-        // a single resources that doesn't actually change (its content is the file path)
-
-        // However, we should check for newly introduced errors
-        // Parse the file and look for @+id/ entries
-        validateAttributes(context);
-    }
-
-    /*
-     * (non-Javadoc)
-     * @see com.android.ide.eclipse.editors.resources.manager.ResourceFile#getValue(com.android.ide.eclipse.common.resources.ResourceType, java.lang.String)
-     *
-     * This particular implementation does not care about the type or name since a
-     * SingleResourceFile represents a file generating only one resource.
-     * The value returned is the full absolute path of the file in OS form.
-     */
-    @Override
-    public ResourceValue getValue(ResourceType type, String name) {
-        return mValue;
-    }
-
-    /**
-     * Returns the name of the resources.
-     */
-    private String getResourceName() {
-        // get the name from the filename.
-        String name = getFile().getName();
-
-        int pos = name.indexOf('.');
-        if (pos != -1) {
-            name = name.substring(0, pos);
-        }
-
-        return name;
-    }
-
-    /**
-     * Validates the associated resource file to make sure the attribute references are valid
-     *
-     * @return true if parsing succeeds and false if it fails
-     */
-    private boolean validateAttributes(ScanningContext context) {
-        // We only need to check if it's a non-framework file (and an XML file; skip .png's)
-        if (!isFramework() && SdkUtils.endsWith(getFile().getName(), DOT_XML)) {
-            ValidatingResourceParser parser = new ValidatingResourceParser(context, false);
-            try {
-                IAbstractFile file = getFile();
-                return parser.parse(file.getContents());
-            } catch (Exception e) {
-                context.needsFullAapt();
-            }
-
-            return false;
-        }
-
-        return true;
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/TestFileWrapper.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/TestFileWrapper.java
deleted file mode 100644
index 377282eee..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/TestFileWrapper.java
+++ /dev/null
@@ -1,36 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.io.FileWrapper;
-import com.android.io.IAbstractFolder;
-
-import java.io.File;
-
-public class TestFileWrapper extends FileWrapper {
-    public TestFileWrapper(File file) {
-        super(file);
-    }
-
-    public IAbstractFolder getParentFolder() {
-        String p = this.getParent();
-        if (p == null) {
-            return null;
-        }
-        return new TestFolderWrapper(p);
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/TestFolderWrapper.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/TestFolderWrapper.java
deleted file mode 100644
index 0ce93d04b..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/TestFolderWrapper.java
+++ /dev/null
@@ -1,56 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.io.FolderWrapper;
-import com.android.io.IAbstractResource;
-
-import java.io.File;
-
-public class TestFolderWrapper extends FolderWrapper {
-
-    public TestFolderWrapper(String pathname) {
-        super(pathname);
-    }
-
-    public TestFolderWrapper(File file) {
-        super(file.getAbsolutePath());
-    }
-
-    public IAbstractResource[] listMembers() {
-        File[] files = listFiles();
-        final int count = files == null ? 0 : files.length;
-        IAbstractResource[] afiles = new IAbstractResource[count];
-
-        if (files != null) {
-            for (int i = 0 ; i < count ; i++) {
-                File f = files[i];
-                if (f.isFile()) {
-                    afiles[i] = new TestFileWrapper(f);
-                } else if (f.isDirectory()) {
-                    afiles[i] = new TestFolderWrapper(f);
-                }
-            }
-        }
-
-        return afiles;
-    }
-
-    public TestFolderWrapper getFolder(String name) {
-        return new TestFolderWrapper(new File(this, name));
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ValidatingResourceParser.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ValidatingResourceParser.java
deleted file mode 100644
index 01523373d..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ValidatingResourceParser.java
+++ /dev/null
@@ -1,121 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package com.android.ide.common.resources.deprecated;
-
-import com.android.SdkConstants;
-import com.android.tools.layoutlib.annotations.NotNull;
-
-import org.kxml2.io.KXmlParser;
-import org.xmlpull.v1.XmlPullParser;
-import org.xmlpull.v1.XmlPullParserException;
-
-import java.io.BufferedInputStream;
-import java.io.FileInputStream;
-import java.io.IOException;
-import java.io.InputStream;
-
-import com.google.common.io.Closeables;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public class ValidatingResourceParser {
-    private final boolean mIsFramework;
-    private final ScanningContext mContext;
-
-    /**
-     * Creates a new {@link com.android.ide.common.resources.deprecated.ValidatingResourceParser}
-     *
-     * @param context a context object with state for the current update, such
-     *            as a place to stash errors encountered
-     * @param isFramework true if scanning a framework resource
-     */
-    public ValidatingResourceParser(
-            @NotNull ScanningContext context,
-            boolean isFramework) {
-        mContext = context;
-        mIsFramework = isFramework;
-    }
-
-    /**
-     * Parse the given input and return false if it contains errors, <b>or</b> if
-     * the context is already tagged as needing a full aapt run.
-     *
-     * @param input the input stream of the XML to be parsed (will be closed by this method)
-     * @return true if parsing succeeds and false if it fails
-     * @throws IOException if reading the contents fails
-     */
-    public boolean parse(InputStream input)
-            throws IOException {
-        // No need to validate framework files
-        if (mIsFramework) {
-            try {
-                Closeables.close(input, true /* swallowIOException */);
-            } catch (IOException e) {
-                // cannot happen
-            }
-            return true;
-        }
-        if (mContext.needsFullAapt()) {
-            try {
-                Closeables.close(input, true /* swallowIOException */);
-            } catch (IOException ignore) {
-                // cannot happen
-            }
-            return false;
-        }
-
-        KXmlParser parser = new KXmlParser();
-        try {
-            parser.setFeature(XmlPullParser.FEATURE_PROCESS_NAMESPACES, true);
-
-            if (input instanceof FileInputStream) {
-                input = new BufferedInputStream(input);
-            }
-            parser.setInput(input, SdkConstants.UTF_8);
-
-            return parse(parser);
-        } catch (XmlPullParserException | RuntimeException e) {
-            return false;
-        } finally {
-            try {
-                Closeables.close(input, true /* swallowIOException */);
-            } catch (IOException e) {
-                // cannot happen
-            }
-        }
-    }
-
-    private boolean parse(KXmlParser parser)
-            throws XmlPullParserException, IOException {
-        while (true) {
-            int event = parser.next();
-            if (event == XmlPullParser.START_TAG) {
-                for (int i = 0, n = parser.getAttributeCount(); i < n; i++) {
-                    String attribute = parser.getAttributeName(i);
-                    String value = parser.getAttributeValue(i);
-                    assert value != null : attribute;
-                }
-            } else if (event == XmlPullParser.END_DOCUMENT) {
-                break;
-            }
-        }
-
-        return true;
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ValueResourceParser.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ValueResourceParser.java
deleted file mode 100644
index 7bf3200ff..000000000
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ValueResourceParser.java
+++ /dev/null
@@ -1,227 +0,0 @@
-/*
- * Copyright (C) 2022 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package com.android.ide.common.resources.deprecated;
-
-import com.android.ide.common.rendering.api.ArrayResourceValueImpl;
-import com.android.ide.common.rendering.api.AttrResourceValueImpl;
-import com.android.ide.common.rendering.api.ResourceNamespace;
-import com.android.ide.common.rendering.api.ResourceReference;
-import com.android.ide.common.rendering.api.ResourceValue;
-import com.android.ide.common.rendering.api.ResourceValueImpl;
-import com.android.ide.common.rendering.api.StyleItemResourceValue;
-import com.android.ide.common.rendering.api.StyleItemResourceValueImpl;
-import com.android.ide.common.rendering.api.StyleResourceValueImpl;
-import com.android.ide.common.rendering.api.StyleableResourceValueImpl;
-import com.android.ide.common.resources.ValueXmlHelper;
-import com.android.resources.ResourceType;
-
-import org.xml.sax.Attributes;
-import org.xml.sax.SAXException;
-import org.xml.sax.helpers.DefaultHandler;
-
-import com.google.common.base.Strings;
-
-import static com.android.SdkConstants.ANDROID_NS_NAME_PREFIX;
-import static com.android.SdkConstants.ANDROID_NS_NAME_PREFIX_LEN;
-import static com.android.SdkConstants.ATTR_NAME;
-import static com.android.SdkConstants.ATTR_PARENT;
-import static com.android.SdkConstants.ATTR_VALUE;
-import static com.android.SdkConstants.TAG_RESOURCES;
-
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
- */
-@Deprecated
-public final class ValueResourceParser extends DefaultHandler {
-
-    private static final ResourceReference TMP_REF =
-            new ResourceReference(ResourceNamespace.RES_AUTO, ResourceType.STRING, "_tmp");
-
-    public interface IValueResourceRepository {
-        void addResourceValue(ResourceValue value);
-    }
-
-    private boolean inResources;
-    private int mDepth;
-    private ResourceValueImpl mCurrentValue;
-    private ArrayResourceValueImpl mArrayResourceValue;
-    private StyleResourceValueImpl mCurrentStyle;
-    private StyleableResourceValueImpl mCurrentDeclareStyleable;
-    private AttrResourceValueImpl mCurrentAttr;
-    private final IValueResourceRepository mRepository;
-    private final boolean mIsFramework;
-    private final String mLibraryName;
-
-    public ValueResourceParser(IValueResourceRepository repository, boolean isFramework, String libraryName) {
-        mRepository = repository;
-        mIsFramework = isFramework;
-        mLibraryName = libraryName;
-    }
-
-    @Override
-    public void endElement(String uri, String localName, String qName) throws SAXException {
-        if (mCurrentValue != null) {
-            String value = mCurrentValue.getValue();
-            value = value == null ? "" : ValueXmlHelper.unescapeResourceString(value, false, true);
-            mCurrentValue.setValue(value);
-        }
-
-        if (inResources && qName.equals(TAG_RESOURCES)) {
-            inResources = false;
-        } else if (mDepth == 2) {
-            mCurrentValue = null;
-            mCurrentStyle = null;
-            mCurrentDeclareStyleable = null;
-            mCurrentAttr = null;
-            mArrayResourceValue = null;
-        } else if (mDepth == 3) {
-            if (mArrayResourceValue != null && mCurrentValue != null) {
-                mArrayResourceValue.addElement(mCurrentValue.getValue());
-            }
-            mCurrentValue = null;
-            //noinspection VariableNotUsedInsideIf
-            if (mCurrentDeclareStyleable != null) {
-                mCurrentAttr = null;
-            }
-        }
-
-        mDepth--;
-        super.endElement(uri, localName, qName);
-    }
-
-    @Override
-    public void startElement(String uri, String localName, String qName, Attributes attributes)
-            throws SAXException {
-        try {
-            ResourceNamespace namespace = ResourceNamespace.fromBoolean(mIsFramework);
-            mDepth++;
-            if (!inResources && mDepth == 1) {
-                if (qName.equals(TAG_RESOURCES)) {
-                    inResources = true;
-                }
-            } else if (mDepth == 2 && inResources) {
-                ResourceType type =
-                        ResourceType.fromXmlTag(
-                                new Object(), (t) -> qName, (t, name) -> attributes.getValue(name));
-
-                if (type != null) {
-                    // get the resource name
-                    String name = attributes.getValue(ATTR_NAME);
-                    if (name != null) {
-                        switch (type) {
-                            case STYLE:
-                                String parent = attributes.getValue(ATTR_PARENT);
-                                mCurrentStyle =
-                                        new StyleResourceValueImpl(
-                                                namespace, name, parent, mLibraryName);
-                                mRepository.addResourceValue(mCurrentStyle);
-                                break;
-                            case STYLEABLE:
-                                mCurrentDeclareStyleable =
-                                        new StyleableResourceValueImpl(
-                                                namespace, name, null, mLibraryName);
-                                mRepository.addResourceValue(mCurrentDeclareStyleable);
-                                break;
-                            case ATTR:
-                                mCurrentAttr =
-                                        new AttrResourceValueImpl(namespace, name, mLibraryName);
-                                mRepository.addResourceValue(mCurrentAttr);
-                                break;
-                            case ARRAY:
-                                mArrayResourceValue =
-                                        new ArrayResourceValueImpl(namespace, name, mLibraryName);
-                                mRepository.addResourceValue(mArrayResourceValue);
-                                break;
-                            default:
-                                mCurrentValue =
-                                        new ResourceValueImpl(
-                                                namespace, type, name, null, mLibraryName);
-                                mRepository.addResourceValue(mCurrentValue);
-                                break;
-                        }
-                    }
-                }
-            } else if (mDepth == 3) {
-                // get the resource name
-                String name = attributes.getValue(ATTR_NAME);
-                if (!Strings.isNullOrEmpty(name)) {
-                    if (mCurrentStyle != null) {
-                        mCurrentValue =
-                                new StyleItemResourceValueImpl(
-                                        mCurrentStyle.getNamespace(), name, null, mLibraryName);
-                        mCurrentStyle.addItem((StyleItemResourceValue) mCurrentValue);
-                    } else if (mCurrentDeclareStyleable != null) {
-                        if (name.startsWith(ANDROID_NS_NAME_PREFIX)) {
-                            name = name.substring(ANDROID_NS_NAME_PREFIX_LEN);
-                        }
-
-                        mCurrentAttr = new AttrResourceValueImpl(namespace, name, mLibraryName);
-                        mCurrentDeclareStyleable.addValue(mCurrentAttr);
-
-                        // also add it to the repository.
-                        mRepository.addResourceValue(mCurrentAttr);
-
-                    } else if (mCurrentAttr != null) {
-                        // get the enum/flag value
-                        String value = attributes.getValue(ATTR_VALUE);
-
-                        try {
-                            // Integer.decode/parseInt can't deal with hex value > 0x7FFFFFFF so we
-                            // use Long.decode instead.
-                            mCurrentAttr.addValue(name, Long.decode(value).intValue(), null);
-                        } catch (NumberFormatException e) {
-                            // pass, we'll just ignore this value
-                        }
-                    }
-                } else //noinspection VariableNotUsedInsideIf
-                    if (mArrayResourceValue != null) {
-                    // Create a temporary resource value to hold the item's value. The value is
-                    // not added to the repository, since it's just a holder. The value will be set
-                    // in the `characters` method and then added to mArrayResourceValue in `endElement`.
-                    mCurrentValue = new ResourceValueImpl(TMP_REF, null);
-                    }
-            } else if (mDepth == 4 && mCurrentAttr != null) {
-                // get the enum/flag name
-                String name = attributes.getValue(ATTR_NAME);
-                String value = attributes.getValue(ATTR_VALUE);
-
-                try {
-                    // Integer.decode/parseInt can't deal with hex value > 0x7FFFFFFF so we
-                    // use Long.decode instead.
-                    mCurrentAttr.addValue(name, Long.decode(value).intValue(), null);
-                } catch (NumberFormatException e) {
-                    // pass, we'll just ignore this value
-                }
-            }
-        } finally {
-            super.startElement(uri, localName, qName, attributes);
-        }
-    }
-
-    @Override
-    public void characters(char[] ch, int start, int length) {
-        if (mCurrentValue != null) {
-            String value = mCurrentValue.getValue();
-            if (value == null) {
-                mCurrentValue.setValue(new String(ch, start, length));
-            } else {
-                mCurrentValue.setValue(value + new String(ch, start, length));
-            }
-        }
-    }
-}
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/RenderTestBase.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/RenderTestBase.java
index 80c22fb60..41f51f224 100644
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/RenderTestBase.java
+++ b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/RenderTestBase.java
@@ -28,10 +28,7 @@ import com.android.ide.common.rendering.api.RenderSession;
 import com.android.ide.common.rendering.api.Result;
 import com.android.ide.common.rendering.api.SessionParams;
 import com.android.ide.common.rendering.api.SessionParams.RenderingMode;
-import com.android.ide.common.resources.deprecated.FrameworkResources;
-import com.android.ide.common.resources.deprecated.ResourceItem;
-import com.android.ide.common.resources.deprecated.ResourceRepository;
-import com.android.ide.common.resources.deprecated.TestFolderWrapper;
+import com.android.ide.common.resources.ResourceRepository;
 import com.android.internal.lang.System_Delegate;
 import com.android.layoutlib.bridge.Bridge;
 import com.android.layoutlib.bridge.android.RenderParamsFlags;
@@ -42,6 +39,8 @@ import com.android.layoutlib.bridge.intensive.util.ImageUtils;
 import com.android.layoutlib.bridge.intensive.util.ModuleClassLoader;
 import com.android.layoutlib.bridge.intensive.util.SessionParamsBuilder;
 import com.android.layoutlib.bridge.intensive.util.TestAssetRepository;
+import com.android.resources.aar.AarSourceResourceRepository;
+import com.android.resources.aar.FrameworkResourceRepository;
 import com.android.utils.ILogger;
 
 import com.google.android.collect.Lists;
@@ -60,6 +59,7 @@ import java.io.IOException;
 import java.net.URL;
 import java.util.ArrayList;
 import java.util.Arrays;
+import java.util.Collections;
 import java.util.concurrent.TimeUnit;
 
 /**
@@ -125,7 +125,7 @@ public class RenderTestBase {
     /** List of log messages generated by a render call. It can be used to find specific errors */
     protected static ArrayList<String> sRenderMessages = Lists.newArrayList();
     private static ILayoutLog sLayoutLibLog;
-    private static FrameworkResources sFrameworkRepo;
+    private static FrameworkResourceRepository sFrameworkRepo;
     private static ResourceRepository sProjectResources;
     private static ILogger sLogger;
 
@@ -388,20 +388,14 @@ public class RenderTestBase {
     public static void beforeClass() {
         File data_dir = new File(PLATFORM_DIR, "data");
         File res = new File(data_dir, "res");
-        sFrameworkRepo = new FrameworkResources(new TestFolderWrapper(res));
-        sFrameworkRepo.loadResources();
-        sFrameworkRepo.loadPublicResources(getLogger());
+        sFrameworkRepo =
+                FrameworkResourceRepository.create(
+                        res.getAbsoluteFile().toPath(), Collections.emptySet(), null, false);
 
+        File projectRes = new File(TEST_RES_DIR + "/" + APP_TEST_RES);
         sProjectResources =
-                new ResourceRepository(new TestFolderWrapper(TEST_RES_DIR + "/" + APP_TEST_RES),
-                        false) {
-                    @NonNull
-                    @Override
-                    protected ResourceItem createResourceItem(@NonNull String name) {
-                        return new ResourceItem(name);
-                    }
-                };
-        sProjectResources.loadResources();
+                AarSourceResourceRepository.create(
+                        projectRes.getAbsoluteFile().toPath(), "Application");
 
         File fontLocation = new File(FONT_DIR);
         File buildProp = new File(PLATFORM_DIR, "build.prop");
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/util/SessionParamsBuilder.java b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/util/SessionParamsBuilder.java
index 0a0d5c739..7f30af89c 100644
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/util/SessionParamsBuilder.java
+++ b/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/layoutlib/bridge/intensive/util/SessionParamsBuilder.java
@@ -16,6 +16,8 @@
 
 package com.android.layoutlib.bridge.intensive.util;
 
+import android.annotation.NonNull;
+
 import com.android.SdkConstants;
 import com.android.ide.common.rendering.api.AssetRepository;
 import com.android.ide.common.rendering.api.IImageFactory;
@@ -25,21 +27,20 @@ import com.android.ide.common.rendering.api.ResourceNamespace;
 import com.android.ide.common.rendering.api.ResourceReference;
 import com.android.ide.common.rendering.api.SessionParams;
 import com.android.ide.common.rendering.api.SessionParams.RenderingMode;
+import com.android.ide.common.resources.ResourceRepository;
+import com.android.ide.common.resources.ResourceRepositoryUtil;
 import com.android.ide.common.resources.ResourceResolver;
+import com.android.ide.common.resources.ResourceValueMap;
 import com.android.ide.common.resources.configuration.FolderConfiguration;
-import com.android.ide.common.resources.deprecated.ResourceRepository;
-import com.android.layoutlib.bridge.android.RenderParamsFlags;
 import com.android.layoutlib.bridge.intensive.setup.ConfigGenerator;
 import com.android.layoutlib.bridge.intensive.setup.LayoutPullParser;
 import com.android.resources.ResourceType;
 
-import android.annotation.NonNull;
+import com.google.common.collect.Table;
 
 import java.util.HashMap;
 import java.util.Map;
 
-import com.google.common.collect.ImmutableMap;
-
 /**
  * Builder to help setting up {@link SessionParams} objects.
  */
@@ -62,7 +63,6 @@ public class SessionParamsBuilder {
     private boolean mDecor = true;
     private IImageFactory mImageFactory = null;
     private boolean enableLayoutValidator = false;
-    private boolean enableLayoutValidatorImageCheck = false;
     private boolean transparentBackground = false;
 
     @NonNull
@@ -169,12 +169,6 @@ public class SessionParamsBuilder {
         this.enableLayoutValidator = true;
         return this;
     }
-
-    @NonNull
-    public SessionParamsBuilder enableLayoutValidationImageCheck() {
-        this.enableLayoutValidatorImageCheck = true;
-        return this;
-    }
     
     @NonNull
     public SessionParamsBuilder setTransparentBackground() {
@@ -191,22 +185,29 @@ public class SessionParamsBuilder {
         assert mLayoutlibCallback != null;
 
         FolderConfiguration config = mConfigGenerator.getFolderConfig();
-        ResourceResolver resourceResolver = ResourceResolver.create(
-                ImmutableMap.of(
-                        ResourceNamespace.ANDROID, mFrameworkResources.getConfiguredResources(config),
-                        ResourceNamespace.TODO(), mProjectResources.getConfiguredResources(config)),
-                new ResourceReference(
-                        ResourceNamespace.fromBoolean(!isProjectTheme),
-                        ResourceType.STYLE,
-                        mThemeName));
+        Map<ResourceType, ResourceValueMap> frameworkConfigResources =
+                ResourceRepositoryUtil.getConfiguredResources(mFrameworkResources, config)
+                        .row(ResourceNamespace.ANDROID);
+        Table<ResourceNamespace, ResourceType, ResourceValueMap> projectConfigResources =
+                ResourceRepositoryUtil.getConfiguredResources(mProjectResources, config);
+        Map<ResourceNamespace, Map<ResourceType, ResourceValueMap>> allResourcesMap =
+                new HashMap<>();
+        allResourcesMap.put(ResourceNamespace.ANDROID, frameworkConfigResources);
+        for (ResourceNamespace namespace : projectConfigResources.rowKeySet()) {
+            allResourcesMap.put(namespace, projectConfigResources.row(namespace));
+        }
+        ResourceResolver resourceResolver =
+                ResourceResolver.create(
+                        allResourcesMap,
+                        new ResourceReference(
+                                ResourceNamespace.fromBoolean(!isProjectTheme),
+                                ResourceType.STYLE,
+                                mThemeName));
 
         SessionParams params = new SessionParams(mLayoutParser, mRenderingMode, mProjectKey /* for
         caching */, mConfigGenerator.getHardwareConfig(), resourceResolver, mLayoutlibCallback,
                 mMinSdk, mTargetSdk, mLayoutLog);
-        params.setFlag(RenderParamsFlags.FLAG_ENABLE_LAYOUT_VALIDATOR, enableLayoutValidator);
-        params.setFlag(
-                RenderParamsFlags.FLAG_ENABLE_LAYOUT_VALIDATOR_IMAGE_CHECK,
-                enableLayoutValidatorImageCheck);
+        params.setLayoutValidationChecker(() -> enableLayoutValidator);
         if (mImageFactory != null) {
             params.setImageFactory(mImageFactory);
         }
diff --git a/libraries/screenshot/src/androidTest/java/platform/test/screenshot/ScreenshotTestRuleTest.kt b/libraries/screenshot/src/androidTest/java/platform/test/screenshot/ScreenshotTestRuleTest.kt
index aeca31e6c..39a57eced 100644
--- a/libraries/screenshot/src/androidTest/java/platform/test/screenshot/ScreenshotTestRuleTest.kt
+++ b/libraries/screenshot/src/androidTest/java/platform/test/screenshot/ScreenshotTestRuleTest.kt
@@ -19,7 +19,7 @@ package platform.test.screenshot
 import android.content.Context
 import android.graphics.Bitmap
 import android.graphics.Rect
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
 import android.provider.Settings.System
 import androidx.test.ext.junit.runners.AndroidJUnit4
 import androidx.test.filters.MediumTest
@@ -56,7 +56,7 @@ class ScreenshotTestRuleTest {
     val rule =
         ScreenshotTestRule(
             CustomGoldenPathManager(InstrumentationRegistry.getInstrumentation().context),
-            diffEscrowStrategy = fakeDiffEscrow
+            diffEscrowStrategy = fakeDiffEscrow,
         )
 
     @Test
@@ -75,7 +75,7 @@ class ScreenshotTestRuleTest {
         val first =
             bitmapWithMaterialYouColorsSimulation(
                 loadBitmap("defaultClock_largeClock_regionSampledColor_original"),
-                /* isDarkTheme= */ true
+                /* isDarkTheme= */ true,
             )
 
         first.assertAgainstGolden(rule, goldenIdentifier, matcher = PixelPerfectMatcher())
@@ -86,14 +86,14 @@ class ScreenshotTestRuleTest {
     fun performDiff_noPixelCompared() {
         val first = loadBitmap("round_rect_gray")
         val regions = ArrayList<Rect>()
-        regions.add(Rect(/* left= */ 1, /* top= */ 1, /* right= */ 2, /* bottom=*/ 2))
+        regions.add(Rect(/* left= */ 1, /* top= */ 1, /* right= */ 2, /* bottom= */ 2))
 
         val goldenIdentifier = "round_rect_green"
         first.assertAgainstGolden(
             rule,
             goldenIdentifier,
             matcher = MSSIMMatcher(),
-            regions = regions
+            regions = regions,
         )
 
         assertThat(fakeDiffEscrow.reports).isEmpty()
@@ -141,7 +141,7 @@ class ScreenshotTestRuleTest {
                     DiffResult.Status.FAILED,
                     hasExpected = true,
                     hasDiff = true,
-                    comparisonStatistics = compStatistics
+                    comparisonStatistics = compStatistics,
                 )
             )
     }
@@ -168,7 +168,7 @@ class ScreenshotTestRuleTest {
                     DiffResult.Status.FAILED,
                     hasExpected = true,
                     hasDiff = true,
-                    comparisonStatistics = compStatistics
+                    comparisonStatistics = compStatistics,
                 )
             )
     }
@@ -185,8 +185,9 @@ class ScreenshotTestRuleTest {
                 .build()
 
         expectErrorMessage(
-            "Sizes are different! Expected: [48, 48], Actual: [720, 1184]. Force aligned "
-                + "at (0, 0). Comparison stats: '${compStatistics}'") {
+            "Sizes are different! Expected: [48, 48], Actual: [720, 1184]. Force aligned " +
+                "at (0, 0). Comparison stats: '${compStatistics}'"
+        ) {
             first.assertAgainstGolden(rule, goldenIdentifier)
         }
 
@@ -197,7 +198,7 @@ class ScreenshotTestRuleTest {
                     DiffResult.Status.FAILED,
                     hasExpected = true,
                     hasDiff = true,
-                    comparisonStatistics = compStatistics
+                    comparisonStatistics = compStatistics,
                 )
             )
     }
@@ -228,8 +229,8 @@ class ScreenshotTestRuleTest {
                     DiffResult.Status.MISSING_REFERENCE,
                     hasExpected = false,
                     hasDiff = false,
-                    comparisonStatistics = null
-                ),
+                    comparisonStatistics = null,
+                )
             )
     }
 
@@ -353,6 +354,7 @@ class ScreenshotTestRuleTest {
 
     class FakeDiffResultExport : DiffResultExportStrategy {
         val reports = mutableListOf<ReportedDiffResult>()
+
         override fun reportResult(
             testIdentifier: String,
             goldenIdentifier: String,
@@ -360,7 +362,7 @@ class ScreenshotTestRuleTest {
             status: DiffResult.Status,
             comparisonStatistics: DiffResult.ComparisonStatistics?,
             expected: Bitmap?,
-            diff: Bitmap?
+            diff: Bitmap?,
         ) {
             reports.add(
                 ReportedDiffResult(
@@ -368,11 +370,12 @@ class ScreenshotTestRuleTest {
                     status,
                     hasExpected = expected != null,
                     hasDiff = diff != null,
-                    comparisonStatistics
+                    comparisonStatistics,
                 )
             )
         }
     }
+
     private companion object {
         var prevPointerLocationSetting: Int = 0
         var prevShowTouchesSetting: Int = 0
diff --git a/libraries/screenshot/src/main/java/platform/test/screenshot/DialogScreenshotTest.kt b/libraries/screenshot/src/main/java/platform/test/screenshot/DialogScreenshotTest.kt
index de141c474..e1469e5d9 100644
--- a/libraries/screenshot/src/main/java/platform/test/screenshot/DialogScreenshotTest.kt
+++ b/libraries/screenshot/src/main/java/platform/test/screenshot/DialogScreenshotTest.kt
@@ -30,6 +30,7 @@ fun <A : Activity> dialogScreenshotTest(
     goldenIdentifier: String,
     waitForIdle: () -> Unit = {},
     dialogProvider: (A) -> Dialog,
+    frameLimit: Int = 10,
     checkDialog: (Dialog) -> Boolean = { _ -> false },
 ) {
     var dialog: Dialog? = null
@@ -61,7 +62,7 @@ fun <A : Activity> dialogScreenshotTest(
     // laying out and drawing its content.
     var waitForActivity = true
     var iterCount = 0
-    while (waitForActivity && iterCount < 10) {
+    while (waitForActivity && iterCount < frameLimit) {
         activityRule.scenario.onActivity { waitForActivity = checkDialog(dialog!!) }
         iterCount++
     }
diff --git a/libraries/screenshot/src/main/java/platform/test/screenshot/ExternalViewScreenshotTestRule.kt b/libraries/screenshot/src/main/java/platform/test/screenshot/ExternalViewScreenshotTestRule.kt
index 480c9e09e..db1b558ef 100644
--- a/libraries/screenshot/src/main/java/platform/test/screenshot/ExternalViewScreenshotTestRule.kt
+++ b/libraries/screenshot/src/main/java/platform/test/screenshot/ExternalViewScreenshotTestRule.kt
@@ -19,7 +19,7 @@ package platform.test.screenshot
 import android.app.Activity
 import android.graphics.Color
 import android.os.Build
-import android.platform.uiautomator_helpers.WaitUtils.waitForValueToSettle
+import android.platform.uiautomatorhelpers.WaitUtils.waitForValueToSettle
 import android.view.View
 import android.view.Window
 import android.view.WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES
@@ -39,7 +39,7 @@ import org.junit.runners.model.Statement
 class ExternalViewScreenshotTestRule(
     emulationSpec: DeviceEmulationSpec,
     pathManager: GoldenPathManager,
-    private val screenshotRule: ScreenshotTestRule = ScreenshotTestRule(pathManager)
+    private val screenshotRule: ScreenshotTestRule = ScreenshotTestRule(pathManager),
 ) : TestRule, BitmapDiffer by screenshotRule, ScreenshotAsserterFactory by screenshotRule {
 
     private val colorsRule = MaterialYouColorsRule()
@@ -74,10 +74,7 @@ class ExternalViewScreenshotTestRule(
      * Compare the content of the [activity] with the golden image identified by [goldenIdentifier]
      * in the context of [emulationSpec].
      */
-    fun activityScreenshotTest(
-        goldenIdentifier: String,
-        activity: Activity,
-    ) {
+    fun activityScreenshotTest(goldenIdentifier: String, activity: Activity) {
         val rootView = activity.window.decorView
 
         // Hide system bars, remove insets, focus and make sure device-specific cutouts
diff --git a/libraries/screenshot/src/main/java/platform/test/screenshot/ScreenshotTestRule.kt b/libraries/screenshot/src/main/java/platform/test/screenshot/ScreenshotTestRule.kt
index 15b4ab7fc..73539a3c9 100644
--- a/libraries/screenshot/src/main/java/platform/test/screenshot/ScreenshotTestRule.kt
+++ b/libraries/screenshot/src/main/java/platform/test/screenshot/ScreenshotTestRule.kt
@@ -22,7 +22,7 @@ import android.graphics.Bitmap
 import android.graphics.BitmapFactory
 import android.graphics.Color
 import android.graphics.Rect
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
 import android.provider.Settings.System
 import androidx.annotation.VisibleForTesting
 import androidx.test.platform.app.InstrumentationRegistry
@@ -56,7 +56,7 @@ internal constructor(
     val goldenPathManager: GoldenPathManager,
     /** Strategy to report diffs to external systems. */
     private val diffEscrowStrategy: DiffResultExportStrategy,
-    private val disableIconPool: Boolean = true
+    private val disableIconPool: Boolean = true,
 ) : TestRule, BitmapDiffer, ScreenshotAsserterFactory {
 
     @JvmOverloads
@@ -66,13 +66,15 @@ internal constructor(
     ) : this(
         goldenPathManager,
         DiffResultExportStrategy.createDefaultStrategy(goldenPathManager),
-        disableIconPool
+        disableIconPool,
     )
 
     private val doesCollectScreenshotParityStats =
-        "yes".equals(
-            java.lang.System.getProperty("screenshot.collectScreenshotParityStats"),
-            ignoreCase = true)
+        "yes"
+            .equals(
+                java.lang.System.getProperty("screenshot.collectScreenshotParityStats"),
+                ignoreCase = true,
+            )
     private lateinit var testIdentifier: String
 
     companion object {
@@ -102,7 +104,7 @@ internal constructor(
     open fun getTestIdentifier(description: Description): String =
         "${description.className}_${description.methodName}"
 
-    private fun fetchExpectedImage(goldenIdentifier: String): Bitmap? {
+    open fun fetchExpectedImage(goldenIdentifier: String): Bitmap? {
         val instrument = InstrumentationRegistry.getInstrumentation()
         return listOf(instrument.targetContext.applicationContext, instrument.context)
             .map { context ->
@@ -140,14 +142,14 @@ internal constructor(
     fun assertBitmapAgainstGolden(
         actual: Bitmap,
         goldenIdentifier: String,
-        matcher: BitmapMatcher
+        matcher: BitmapMatcher,
     ) {
         try {
             assertBitmapAgainstGolden(
                 actual = actual,
                 goldenIdentifier = goldenIdentifier,
                 matcher = matcher,
-                regions = emptyList<Rect>()
+                regions = emptyList<Rect>(),
             )
         } finally {
             actual.recycle()
@@ -176,7 +178,7 @@ internal constructor(
         actual: Bitmap,
         goldenIdentifier: String,
         matcher: BitmapMatcher,
-        regions: List<Rect>
+        regions: List<Rect>,
     ) {
         if (!goldenIdentifier.matches("^[A-Za-z0-9_-]+$".toRegex())) {
             throw IllegalArgumentException(
@@ -191,7 +193,7 @@ internal constructor(
                 testIdentifier = testIdentifier,
                 goldenIdentifier = goldenIdentifier,
                 status = ScreenshotResultProto.DiffResult.Status.MISSING_REFERENCE,
-                actual = actual
+                actual = actual,
             )
             throw AssertionError(
                 "Missing golden image " +
@@ -211,7 +213,8 @@ internal constructor(
                         .build()
                 parityStatsCollector.collectTestStats(
                     testIdentifier,
-                    MatchResult(matches = true, diff = null, comparisonStatistics = stats))
+                    MatchResult(matches = true, diff = null, comparisonStatistics = stats),
+                )
                 parityStatsCollector.report()
             }
             expected.recycle()
@@ -226,7 +229,7 @@ internal constructor(
                     expectedWidth = expected.width,
                     expectedHeight = expected.height,
                     actualWidth = actual.width,
-                    actualHeight = actual.height
+                    actualHeight = actual.height,
                 )
             diffEscrowStrategy.reportResult(
                 testIdentifier = testIdentifier,
@@ -235,7 +238,7 @@ internal constructor(
                 actual = actual,
                 comparisonStatistics = comparisonResult.comparisonStatistics,
                 expected = expected,
-                diff = comparisonResult.diff
+                diff = comparisonResult.diff,
             )
             if (doesCollectScreenshotParityStats) {
                 parityStatsCollector.collectTestStats(testIdentifier, comparisonResult)
@@ -260,7 +263,7 @@ internal constructor(
                 given = actual.toIntArray(),
                 width = actual.width,
                 height = actual.height,
-                regions = regions
+                regions = regions,
             )
         if (doesCollectScreenshotParityStats) {
             parityStatsCollector.collectTestStats(testIdentifier, comparisonResult)
@@ -283,7 +286,7 @@ internal constructor(
                 actual = actual,
                 comparisonStatistics = comparisonResult.comparisonStatistics,
                 expected = expectedWithHighlight,
-                diff = comparisonResult.diff
+                diff = comparisonResult.diff,
             )
 
             expectedWithHighlight.recycle()
@@ -370,6 +373,7 @@ class ScreenshotRuleAsserter private constructor(private val rule: ScreenshotTes
 
     private var prevPointerLocationSetting: Int? = null
     private var prevShowTouchesSetting: Int? = null
+
     @Suppress("DEPRECATION")
     override fun assertGoldenImage(goldenId: String) {
         runBeforeScreenshot()
@@ -397,6 +401,9 @@ class ScreenshotRuleAsserter private constructor(private val rule: ScreenshotTes
     }
 
     private fun runBeforeScreenshot() {
+        // Disable Sensitive Content Redaction
+        shell("settings put secure disable_secure_windows 1")
+
         prevPointerLocationSetting = pointerLocationSetting
         prevShowTouchesSetting = showTouchesSetting
 
@@ -407,6 +414,8 @@ class ScreenshotRuleAsserter private constructor(private val rule: ScreenshotTes
     }
 
     private fun runAfterScreenshot() {
+        // Enable Sensitive Content Redaction
+        shell("settings put secure disable_secure_windows 0")
         afterScreenshot?.run()
 
         prevPointerLocationSetting?.let { pointerLocationSetting = it }
@@ -416,6 +425,7 @@ class ScreenshotRuleAsserter private constructor(private val rule: ScreenshotTes
     @Deprecated("Use ScreenshotAsserterFactory instead")
     class Builder(private val rule: ScreenshotTestRule) {
         private var asserter = ScreenshotRuleAsserter(rule)
+
         fun withMatcher(matcher: BitmapMatcher): Builder = apply { asserter.matcher = matcher }
 
         /**
@@ -460,12 +470,12 @@ fun Bitmap.assertAgainstGolden(
     bitmapDiffer: BitmapDiffer,
     goldenIdentifier: String,
     matcher: BitmapMatcher = MSSIMMatcher(),
-    regions: List<Rect> = emptyList()
+    regions: List<Rect> = emptyList(),
 ) {
     bitmapDiffer.assertBitmapAgainstGolden(
         this,
         goldenIdentifier,
         matcher = matcher,
-        regions = regions
+        regions = regions,
     )
 }
diff --git a/libraries/screenshot/src/main/java/platform/test/screenshot/ViewScreenshotTestRule.kt b/libraries/screenshot/src/main/java/platform/test/screenshot/ViewScreenshotTestRule.kt
index e6127b711..4afeaac78 100644
--- a/libraries/screenshot/src/main/java/platform/test/screenshot/ViewScreenshotTestRule.kt
+++ b/libraries/screenshot/src/main/java/platform/test/screenshot/ViewScreenshotTestRule.kt
@@ -179,6 +179,7 @@ open class ViewScreenshotTestRule(
             goldenIdentifier,
             waitForIdle,
             dialogProvider,
+            frameLimit,
             waitingForDialog,
         )
     }
diff --git a/libraries/screenshot/utils/compose/res/values/themes.xml b/libraries/screenshot/utils/compose/res/values/themes.xml
index c0802c791..83d9524be 100644
--- a/libraries/screenshot/utils/compose/res/values/themes.xml
+++ b/libraries/screenshot/utils/compose/res/values/themes.xml
@@ -27,11 +27,6 @@
 
         <!-- Make sure that device specific cutouts don't impact the outcome of screenshot tests -->
         <item name="android:windowLayoutInDisplayCutoutMode">always</item>
-
-        <!--
-            TODO(b/309578419): Make activities handle insets properly and then remove this.
-        -->
-        <item name="android:windowOptOutEdgeToEdgeEnforcement">true</item>
     </style>
 
     <style name="Theme.PlatformUi.Dialog.Screenshot" parent="Theme.SystemUI.Dialog" />
diff --git a/libraries/screenshot/utils/compose/src/platform/test/screenshot/utils/compose/ComposeScreenshotTestRule.kt b/libraries/screenshot/utils/compose/src/platform/test/screenshot/utils/compose/ComposeScreenshotTestRule.kt
index 466c5411c..d5fb8da99 100644
--- a/libraries/screenshot/utils/compose/src/platform/test/screenshot/utils/compose/ComposeScreenshotTestRule.kt
+++ b/libraries/screenshot/utils/compose/src/platform/test/screenshot/utils/compose/ComposeScreenshotTestRule.kt
@@ -53,7 +53,7 @@ import platform.test.screenshot.dialogScreenshotTest
 class ComposeScreenshotTestRule(
     private val emulationSpec: DeviceEmulationSpec,
     pathManager: GoldenPathManager,
-    private val screenshotRule: ScreenshotTestRule = ScreenshotTestRule(pathManager)
+    private val screenshotRule: ScreenshotTestRule = ScreenshotTestRule(pathManager),
 ) : TestRule, BitmapDiffer by screenshotRule, ScreenshotAsserterFactory by screenshotRule {
     private val colorsRule = MaterialYouColorsRule()
     private val fontsRule = FontsRule()
@@ -62,9 +62,7 @@ class ComposeScreenshotTestRule(
     val composeRule = createAndroidComposeRule<ScreenshotActivity>()
 
     private val commonRule =
-        RuleChain.outerRule(deviceEmulationRule)
-            .around(screenshotRule)
-            .around(composeRule)
+        RuleChain.outerRule(deviceEmulationRule).around(screenshotRule).around(composeRule)
 
     // As denoted in `MaterialYouColorsRule` and `FontsRule`, these two rules need to come first,
     // though their relative orders are not critical.
@@ -108,9 +106,7 @@ class ComposeScreenshotTestRule(
                 val focusManager = LocalFocusManager.current.also { focusManager = it }
 
                 PlatformTheme {
-                    Surface(
-                        color = MaterialTheme.colorScheme.background,
-                    ) {
+                    Surface(color = MaterialTheme.colorScheme.background) {
                         content()
 
                         // Clear the focus early. This disposable effect will run after any
@@ -141,15 +137,19 @@ class ComposeScreenshotTestRule(
 
     fun dialogScreenshotTest(
         goldenIdentifier: String,
+        waitForIdle: () -> Unit = {},
         dialogProvider: (Activity) -> Dialog,
     ) {
         dialogScreenshotTest(
-            composeRule.activityRule,
-            screenshotRule,
-            matcher,
-            goldenIdentifier,
-            waitForIdle = { composeRule.waitForIdle() },
-            dialogProvider,
+            activityRule = composeRule.activityRule,
+            bitmapDiffer = screenshotRule,
+            matcher = matcher,
+            goldenIdentifier = goldenIdentifier,
+            waitForIdle = {
+                composeRule.waitForIdle()
+                waitForIdle()
+            },
+            dialogProvider = dialogProvider,
         )
     }
 }
diff --git a/libraries/sts-common-util/autorepro/example/settings.gradle.kts b/libraries/sts-common-util/autorepro/example/settings.gradle.kts
index 77e1cd38d..c9b346f3c 100644
--- a/libraries/sts-common-util/autorepro/example/settings.gradle.kts
+++ b/libraries/sts-common-util/autorepro/example/settings.gradle.kts
@@ -50,6 +50,6 @@ fileTree(rootDir) {
     }
     .forEach {
         val path = rootDir.toPath().relativize(it.toPath().getParent())
-        val gradlePath = path.toString().replace('/', ':')
+        val gradlePath = ":${path.joinToString(":")}"
         include(gradlePath)
     }
diff --git a/libraries/sts-common-util/host-side/res/ghidra-scripts/FunctionOffsetPostScript.java b/libraries/sts-common-util/host-side/res/ghidra-scripts/FunctionOffsetPostScript.java
index 8aa5649c1..e49df4a61 100644
--- a/libraries/sts-common-util/host-side/res/ghidra-scripts/FunctionOffsetPostScript.java
+++ b/libraries/sts-common-util/host-side/res/ghidra-scripts/FunctionOffsetPostScript.java
@@ -24,21 +24,23 @@ import java.net.Socket;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.List;
+import java.util.regex.Pattern;
 
 public class FunctionOffsetPostScript extends GhidraScript {
 
     public void run() throws Exception {
-        String spaceSeparatedFunctionNames = propertiesFileParams.getValue("functionNames");
-        List<String> listOfFunctions = Arrays.asList(spaceSeparatedFunctionNames.split("\\s+"));
+        String spaceSeparatedFunctionPatterns = propertiesFileParams.getValue("functionPatterns");
+        List<String> listOfFunctions = Arrays.asList(spaceSeparatedFunctionPatterns.split("\\s+"));
         List<BigInteger> output = new ArrayList<>();
 
         // Find the function offsets
         for (String function : listOfFunctions) {
             FunctionIterator functionIterator = currentProgram.getListing().getFunctions(true);
+            Pattern pattern = Pattern.compile(function);
             BigInteger offset = null;
             while (functionIterator.hasNext()) {
                 Function nextFunction = functionIterator.next();
-                if (!nextFunction.getName().equals(function)) {
+                if (!pattern.matcher(nextFunction.getName()).find()) {
                     continue; // Skip to the next iteration if the function name doesn't match
                 }
 
diff --git a/libraries/sts-common-util/host-side/src/com/android/sts/common/FridaUtils.java b/libraries/sts-common-util/host-side/src/com/android/sts/common/FridaUtils.java
index a904b4e95..e3ce6cd05 100644
--- a/libraries/sts-common-util/host-side/src/com/android/sts/common/FridaUtils.java
+++ b/libraries/sts-common-util/host-side/src/com/android/sts/common/FridaUtils.java
@@ -368,10 +368,21 @@ public class FridaUtils extends BaseTargetPreparer implements AutoCloseable {
             throws IOException, IllegalArgumentException, DeviceNotAvailableException,
                     TargetSetupError {
         // Get version from Frida binary
-        ByteArrayOutputStream output = runFrida(List.of("--version"));
+        ByteArrayOutputStream output =
+                runFrida(List.of("--version", "2>/dev/null" /* discard stderr */));
         poll(() -> output.size() > 0);
         String version = output.toString(StandardCharsets.UTF_8).trim();
-        CLog.d("Current version is: %s", version);
+        CLog.d("Output of frida version query command is: %s", version);
+
+        // Throw if unable to parse the version
+        try {
+            parseVersion(version);
+        } catch (Exception e) {
+            throw new TargetSetupError(
+                    "Unable to get the Frida version. Please run the Frida binary with '--version'"
+                        + " on the device and check for any SELinux policy errors. To disable"
+                        + " SELinux, use the command: 'adb shell setenforce 0'.");
+        }
 
         // Get version threshold
         Optional<String> minVersionFromBl = FridaUtilsBusinessLogicHandler.getFridaVersion();
@@ -425,9 +436,10 @@ public class FridaUtils extends BaseTargetPreparer implements AutoCloseable {
             throws FileNotFoundException, TargetSetupError {
         throw new TargetSetupError(
                 String.format(
-                        "Could not download Frida. Please manually download %s and"
-                                + " extract to '%s' renaming the extracted file to '%s' exactly."
-                                + " Incorrect naming will cause a setup failure.",
+                        "Could not download Frida. Please manually download %s and extract to '%s'"
+                            + " renaming the extracted file to '%s' exactly. Incorrect naming will"
+                            + " cause a setup failure. If this issue persists, please review the"
+                            + " error details below for further clarity.",
                         fridaUrl != null
                                 ? fridaUrl
                                 : String.format(
diff --git a/libraries/sts-common-util/host-side/src/com/android/sts/common/ghidra/GhidraFunctionOffsets.java b/libraries/sts-common-util/host-side/src/com/android/sts/common/ghidra/GhidraFunctionOffsets.java
index 8468550fe..cbfcf4ca4 100644
--- a/libraries/sts-common-util/host-side/src/com/android/sts/common/ghidra/GhidraFunctionOffsets.java
+++ b/libraries/sts-common-util/host-side/src/com/android/sts/common/ghidra/GhidraFunctionOffsets.java
@@ -53,7 +53,7 @@ public class GhidraFunctionOffsets {
      *
      * @param ghidra An instance of Ghidra.
      * @param binaryFile The binary file in device.
-     * @param functions The list of function names.
+     * @param functions The list of function patterns.
      * @return A string containing space separated function offsets.
      */
     public static String getFunctionOffsetsAsCmdLineArgs(
@@ -70,7 +70,7 @@ public class GhidraFunctionOffsets {
      *
      * @param ghidra An instance of Ghidra.
      * @param binaryFile The binary file in device.
-     * @param functions The list of function names.
+     * @param functions The list of function patterns.
      * @return A list of BigIntegers containing function offsets in the same order as @param
      *     functions.
      */
@@ -117,7 +117,7 @@ public class GhidraFunctionOffsets {
                                 readResource(POST_SCRIPT_CONTENT_RESOURCE_PATH),
                                 new HashMap<String, String>(
                                         ImmutableMap.of(
-                                                "functionNames",
+                                                "functionPatterns",
                                                 String.join(" ", functions),
                                                 "port",
                                                 String.valueOf(port))));
diff --git a/libraries/system-helpers/sysui-helper/src/android/system/helpers/LockscreenHelper.java b/libraries/system-helpers/sysui-helper/src/android/system/helpers/LockscreenHelper.java
index 039842780..87b3b3f4b 100644
--- a/libraries/system-helpers/sysui-helper/src/android/system/helpers/LockscreenHelper.java
+++ b/libraries/system-helpers/sysui-helper/src/android/system/helpers/LockscreenHelper.java
@@ -16,8 +16,6 @@
 
 package android.system.helpers;
 
-import static com.android.systemui.Flags.keyguardBottomAreaRefactor;
-
 import static junit.framework.Assert.assertTrue;
 
 import android.app.KeyguardManager;
@@ -55,9 +53,6 @@ public class LockscreenHelper {
     private static final int DEFAULT_FLING_STEPS = 5;
     private static final int DEFAULT_SCROLL_STEPS = 15;
     private static final long MAX_SCREEN_LOCK_WAIT_TIME_MS = 5_000;
-    private static final BySelector KEYGUARD_BOTTOM_AREA_VIEW =
-            By.res("com.android.systemui", "keyguard_bottom_area");
-
     protected static final BySelector KEYGUARD_ROOT_VIEW =
             By.res("com.android.systemui", "keyguard_root_view");
     private static final String PIN_ENTRY = "com.android.systemui:id/pinEntry";
@@ -425,11 +420,7 @@ public class LockscreenHelper {
     }
 
     public void waitLockscreenVisible() {
-        if (keyguardBottomAreaRefactor()) {
-            assertTrue(mDevice.wait(Until.hasObject(KEYGUARD_ROOT_VIEW), MAX_SCREEN_LOCK_WAIT_TIME_MS));
-        } else {
-            assertTrue(mDevice.wait(Until.hasObject(KEYGUARD_BOTTOM_AREA_VIEW), MAX_SCREEN_LOCK_WAIT_TIME_MS));
-        }
+        assertTrue(mDevice.wait(Until.hasObject(KEYGUARD_ROOT_VIEW), MAX_SCREEN_LOCK_WAIT_TIME_MS));
     }
 
     /* Returns screen coordinates for each pattern dot
diff --git a/libraries/systemui-helper/src/android/platform/helpers/LockscreenUtils.java b/libraries/systemui-helper/src/android/platform/helpers/LockscreenUtils.java
index 48285149e..605ed7674 100644
--- a/libraries/systemui-helper/src/android/platform/helpers/LockscreenUtils.java
+++ b/libraries/systemui-helper/src/android/platform/helpers/LockscreenUtils.java
@@ -58,7 +58,8 @@ public class LockscreenUtils {
     private static final String SET_PATTERN_COMMAND = "locksettings set-pattern";
     private static final String SET_SWIPE_COMMAND = "locksettings set-disabled false";
     private static final String SET_LOCK_AS_NONE_COMMAND = "locksettings set-disabled true";
-    private static final int MAX_LOCKSCREEN_TIMEOUT_IN_SEC = 10;
+    // The SysUI/WM goingAway timeout is 10s. Give that time to process before timing out.
+    private static final int MAX_LOCKSCREEN_TIMEOUT_IN_SEC = 15;
 
     public static int sPreviousAodSetting;
 
diff --git a/libraries/systemui-helper/src/android/platform/helpers/SysuiRestarter.kt b/libraries/systemui-helper/src/android/platform/helpers/SysuiRestarter.kt
index f674c28cd..91f05accb 100644
--- a/libraries/systemui-helper/src/android/platform/helpers/SysuiRestarter.kt
+++ b/libraries/systemui-helper/src/android/platform/helpers/SysuiRestarter.kt
@@ -36,14 +36,7 @@ object SysuiRestarter {
         if (Flags.sceneContainer()) {
             By.res("element:lockscreen")
         } else {
-            By.res(
-                "com.android.systemui",
-                if (Flags.migrateClocksToBlueprint()) {
-                    "keyguard_indication_area"
-                } else {
-                    "keyguard_clock_container"
-                },
-            )
+            By.res("com.android.systemui", "keyguard_indication_area")
         }
 
     /**
diff --git a/libraries/systemui-helper/src/android/platform/helpers/features/common/HomeLockscreenPage.java b/libraries/systemui-helper/src/android/platform/helpers/features/common/HomeLockscreenPage.java
index 5125adb89..6b4cf353e 100644
--- a/libraries/systemui-helper/src/android/platform/helpers/features/common/HomeLockscreenPage.java
+++ b/libraries/systemui-helper/src/android/platform/helpers/features/common/HomeLockscreenPage.java
@@ -18,7 +18,6 @@ package android.platform.helpers.features.common;
 
 import static android.platform.helpers.ui.UiAutomatorUtils.getUiDevice;
 
-import static com.android.systemui.Flags.migrateClocksToBlueprint;
 import static com.android.systemui.Flags.sceneContainer;
 
 import static com.google.common.truth.Truth.assertWithMessage;
@@ -57,8 +56,7 @@ public class HomeLockscreenPage implements Page {
                             : "notification_panel");
     // https://hsv.googleplex.com/5130837462876160?node=117
 
-    public static final String PAGE_TITLE_ID =
-            migrateClocksToBlueprint() ? "keyguard_indication_area" : "keyguard_clock_container";
+    public static final String PAGE_TITLE_ID = "keyguard_indication_area";
     private static final BySelector PAGE_TITLE_SELECTOR =
             sceneContainer()
                     ? By.res("element:lockscreen")
diff --git a/libraries/systemui-helper/src/android/platform/helpers/media/MediaInstrumentation.java b/libraries/systemui-helper/src/android/platform/helpers/media/MediaInstrumentation.java
index ddb469afe..38f2f5bfe 100644
--- a/libraries/systemui-helper/src/android/platform/helpers/media/MediaInstrumentation.java
+++ b/libraries/systemui-helper/src/android/platform/helpers/media/MediaInstrumentation.java
@@ -138,6 +138,7 @@ public final class MediaInstrumentation {
                     WAIT_TIME_MILLIS);
             assertNotNull("Unable to scroll the QS container.", qsScrollView);
             qsScrollView.scroll(Direction.DOWN, 1.0f, 100);
+            InstrumentationRegistry.getInstrumentation().getUiAutomation().clearCache();
             notification = mDevice.wait(Until.findObject(umoSelector), WAIT_TIME_MILLIS);
         }
         assertNotNull("Unable to find UMO.", notification);
@@ -164,6 +165,7 @@ public final class MediaInstrumentation {
         UiObject2 scrollable = mDevice.wait(Until.findObject(By.scrollable(true)), WAIT_TIME_MILLIS);
         scrollable.scroll(
                 Direction.DOWN, (float)distance / scrollable.getVisibleBounds().height(), 100);
+        InstrumentationRegistry.getInstrumentation().getUiAutomation().clearCache();
         return mDevice.wait(Until.findObject(By.res(umo.getResourceName())), WAIT_TIME_MILLIS);
     }
 
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BigTextNotificationController.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BigTextNotificationController.kt
index 1d959c277..22528052f 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BigTextNotificationController.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BigTextNotificationController.kt
@@ -21,7 +21,7 @@ import android.app.Notification
 import android.app.PendingIntent
 import android.content.Intent
 import android.platform.systemui_tapl.ui.Notification.Companion.NOTIFICATION_BIG_TEXT
-import android.platform.uiautomator_helpers.DeviceHelpers
+import android.platform.uiautomatorhelpers.DeviceHelpers
 
 object BigTextNotificationController {
     /** Id of the high importance channel created by the controller. */
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BubbleSettingsController.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BubbleSettingsController.java
index 89c5c3c46..e071ff77b 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BubbleSettingsController.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/BubbleSettingsController.java
@@ -17,7 +17,7 @@
 package android.platform.systemui_tapl.controller;
 
 import static android.content.Context.STATUS_BAR_SERVICE;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getContext;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getContext;
 
 import android.app.INotificationManager;
 import android.app.NotificationManager;
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/DockController.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/DockController.kt
index 712641682..6fc25ee98 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/DockController.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/DockController.kt
@@ -20,9 +20,9 @@ import android.content.BroadcastReceiver
 import android.content.Context
 import android.content.Intent
 import android.content.IntentFilter
-import android.platform.uiautomator_helpers.DeviceHelpers.context
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
-import android.platform.uiautomator_helpers.WaitUtils.ensureThat
+import android.platform.uiautomatorhelpers.DeviceHelpers.context
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.WaitUtils.ensureThat
 import android.util.Log
 import java.time.Duration
 import org.junit.rules.ExternalResource
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/LockscreenController.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/LockscreenController.java
index ba650aaa8..ba3e56b65 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/LockscreenController.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/LockscreenController.java
@@ -23,10 +23,10 @@ import static android.platform.helpers.LockscreenUtils.LockscreenType.PATTERN;
 import static android.platform.helpers.LockscreenUtils.LockscreenType.PIN;
 import static android.platform.helpers.LockscreenUtils.LockscreenType.SWIPE;
 import static android.platform.test.util.HealthTestingUtils.waitForCondition;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getContext;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getUiDevice;
-import static android.platform.uiautomator_helpers.DeviceHelpers.isScreenOnSettled;
-import static android.platform.uiautomator_helpers.WaitUtils.ensureThat;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getContext;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getUiDevice;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.isScreenOnSettled;
+import static android.platform.uiautomatorhelpers.WaitUtils.ensureThat;
 
 import static com.google.common.truth.Truth.assertThat;
 
@@ -107,31 +107,50 @@ public class LockscreenController {
      * @return whether AOD was enabled.
      */
     public boolean setAodEnabled(boolean enableAod) {
+        return setSecureSetting(
+                Settings.Secure.DOZE_ALWAYS_ON, enableAod, false);
+    }
+
+    /**
+     * Enables or disables glanceale hub.
+     *
+     * @param enableHub Whether to enable glanceable hub?
+     * @return whether the hub was previously enabled before calling this method.
+     */
+    public boolean setGlanceableHubEnabled(boolean enableHub) {
+        return setSecureSetting(
+                Settings.Secure.GLANCEABLE_HUB_ENABLED, enableHub, true);
+    }
+
+    private boolean setSecureSetting(String key, boolean value, boolean defaultValue) {
         final ContentResolver contentResolver = getContext().getContentResolver();
-        final boolean aodWasEnabled =
-                Settings.Secure.getInt(contentResolver, Settings.Secure.DOZE_ALWAYS_ON, 0) == 1;
+        final boolean previousValue =
+                Settings.Secure.getInt(contentResolver, key, defaultValue ? 1 : 0) == 1;
 
-        if (enableAod != aodWasEnabled) {
+        if (value != previousValue) {
             assertThat(
                             Settings.Secure.putInt(
                                     contentResolver,
-                                    Settings.Secure.DOZE_ALWAYS_ON,
-                                    enableAod ? 1 : 0))
+                                    key,
+                                    value ? 1 : 0))
                     .isTrue();
         }
 
-        return aodWasEnabled;
+        return previousValue;
     }
 
     /** Turns screen off by going to sleep. */
     public void turnScreenOff() {
         try {
             getUiDevice().sleep();
+
+            if (getUiDevice().isScreenOn()) {
+                SystemClock.sleep(SLEEP_INTERVAL_MS * 4);
+                waitForCondition(() -> "Screen didn't turn off", () -> !getUiDevice().isScreenOn());
+            }
         } catch (RemoteException e) {
             throw new RuntimeException(e);
         }
-        SystemClock.sleep(SLEEP_INTERVAL_MS * 4);
-        waitForCondition(() -> "Screen didn't turn off", () -> !getUiDevice().isScreenOn());
     }
 
     /** Turns screen on by waking up from sleep. */
@@ -140,11 +159,14 @@ public class LockscreenController {
         try {
             try {
                 getUiDevice().wakeUp();
+
+                if (!getUiDevice().isScreenOn()) {
+                    SystemClock.sleep(SLEEP_INTERVAL_MS * 4);
+                    ensureThat("Screen is on", () -> isScreenOnSettled(getUiDevice()));
+                }
             } catch (RemoteException e) {
                 throw new RuntimeException(e);
             }
-            SystemClock.sleep(SLEEP_INTERVAL_MS * 4);
-            ensureThat("Screen is on", () -> isScreenOnSettled(getUiDevice()));
         } finally {
             Trace.endSection();
         }
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/NotificationController.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/NotificationController.java
index 6e405953f..d80dfba94 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/NotificationController.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/NotificationController.java
@@ -16,6 +16,7 @@
 
 package android.platform.systemui_tapl.controller;
 
+import static android.app.Flags.FLAG_API_RICH_ONGOING;
 import static android.app.Notification.CATEGORY_SYSTEM;
 import static android.app.NotificationManager.IMPORTANCE_DEFAULT;
 import static android.app.NotificationManager.IMPORTANCE_HIGH;
@@ -24,12 +25,13 @@ import static android.app.NotificationManager.IMPORTANCE_MIN;
 import static android.app.PendingIntent.FLAG_IMMUTABLE;
 import static android.platform.systemui_tapl.ui.Notification.NOTIFICATION_BIG_TEXT;
 import static android.platform.test.util.HealthTestingUtils.waitForCondition;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getContext;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getUiDevice;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getContext;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getUiDevice;
 
 import static androidx.test.platform.app.InstrumentationRegistry.getInstrumentation;
 
 import android.R;
+import android.annotation.FlaggedApi;
 import android.app.Notification;
 import android.app.Notification.Builder;
 import android.app.Notification.MessagingStyle;
@@ -384,6 +386,60 @@ public class NotificationController {
                 /* pkg= */ null);
     }
 
+    /**
+     * Posts a notification using {@link android.app.Notification.ProgressStyle}.
+     *
+     * @param pkg App to launch, when clicking on notification.
+     */
+    @NonNull
+    @FlaggedApi(FLAG_API_RICH_ONGOING)
+    public NotificationIdentity postProgressStyleNotification(@Nullable String pkg) {
+        final Bitmap bitmap = Bitmap.createBitmap(400, 400, Bitmap.Config.ARGB_8888);
+        new Canvas(bitmap).drawColor(Color.BLUE);
+        postNotificationSync(
+                getNextNotificationId(),
+                getBuilder(pkg)
+                        .setStyle(
+                                new Notification.ProgressStyle()
+                                        .setProgress(50)
+                                        .setProgressStartIcon(
+                                                Icon.createWithResource("", R.drawable.btn_star))
+                                        .setProgressEndIcon(
+                                                Icon.createWithResource("", R.drawable.btn_minus))
+                                        .addProgressPoint(
+                                                new Notification.ProgressStyle.Point(10)
+                                                        .setColor(Color.RED))
+                                        .addProgressPoint(
+                                                new Notification.ProgressStyle.Point(50)
+                                                        .setColor(Color.BLUE))
+                                        .addProgressPoint(
+                                                new Notification.ProgressStyle.Point(90)
+                                                        .setColor(Color.GREEN))
+                                        .addProgressSegment(
+                                                new Notification.ProgressStyle.Segment(20)
+                                                        .setColor(Color.RED))
+                                        .addProgressSegment(
+                                                new Notification.ProgressStyle.Segment(30)
+                                                        .setColor(Color.YELLOW))
+                                        .addProgressSegment(
+                                                new Notification.ProgressStyle.Segment(50)
+                                                        .setColor(Color.BLUE))
+                                        .setProgressTrackerIcon(
+                                                Icon.createWithResource(
+                                                        "", R.drawable.ic_menu_send)))
+                        .setContentText(NOTIFICATION_CONTENT_TEXT)
+                        .setLargeIcon(bitmap));
+
+        return new NotificationIdentity(
+                /* type= */ NotificationIdentity.Type.BIG_PICTURE,
+                /* title= */ null,
+                /* text= */ NOTIFICATION_TITLE_TEXT,
+                /* summary= */ null,
+                /* textWhenExpanded= */ null,
+                /* contentIsVisibleInCollapsedState= */ true,
+                /* pkg= */ null);
+    }
+
     /**
      * Posts a notification using {@link android.app.Notification.BigPictureStyle}.
      *
@@ -1171,9 +1227,20 @@ public class NotificationController {
      * notification via NOTIFICATION_MANAGER.notify, this count isn't guaranteed to be correct
      * unless you've waited for it to arrive. If the notification is posted by postNotificationSync,
      * the count will be correct after posting. Use only postNotificationSync to post notifications.
+     * Filter out autogroup notifications created by the NotificationManager.
      */
     private static int getNotificationCount() {
-        return NOTIFICATION_MANAGER.getActiveNotifications().length;
+        StatusBarNotification[] notifications = NOTIFICATION_MANAGER.getActiveNotifications();
+        int filteredNotificationCount = 0;
+        for (StatusBarNotification notification : notifications) {
+
+            // ignore the auto-group notifications created by the NotificationManager.
+            if ((notification.getNotification().flags & Notification.FLAG_AUTOGROUP_SUMMARY)
+                    == 0x0) {
+                filteredNotificationCount++;
+            }
+        }
+        return filteredNotificationCount;
     }
 
     private static boolean hasNotification(int id) {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/PowerController.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/PowerController.java
index 9aaea6294..9b782e9c7 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/PowerController.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/PowerController.java
@@ -17,7 +17,7 @@
 package android.platform.systemui_tapl.controller;
 
 import static android.platform.helpers.CommonUtils.executeShellCommand;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getContext;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getContext;
 import static android.view.KeyEvent.KEYCODE_POWER;
 
 import static com.google.common.truth.Truth.assertThat;
@@ -29,8 +29,24 @@ import android.util.Log;
 /** Controller for manipulating power button behavior and actions. */
 public class PowerController {
     private static final String TAG = "PowerController";
+
+    /**
+     * To simulate a long press, set the duration of the key press to be the long-press timeout plus
+     * a 10% threshold. This ensures that the duration of the key press is greater than the
+     * device's long-press timeout.
+     */
+    private static final int POWER_PRESS_DURATION =
+            (int) (1.1 * getContext().getResources().getInteger(
+                    com.android.internal.R.integer.config_globalActionsKeyTimeout));
+
+    /**
+     * For the power button, the long press timeout is higher on tablets than on phones. By using
+     * --duration instead of --longpress for the command, it ensures the power key is pressed for
+     * long enough to trigger a long press given the specific device.
+     */
     private static final String POWER_COMMAND =
-            String.format("input keyevent --longpress  %s", KEYCODE_POWER);
+            String.format("input keyevent --duration %d %s", POWER_PRESS_DURATION, KEYCODE_POWER);
+
     private static final String POWER_BUTTON_LONG_PRESS_BEHAVIOR = "power_button_long_press";
 
     /** Returns an instance of PowerController. */
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/QuickSettingsController.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/QuickSettingsController.java
index be047468e..9cf97e5be 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/QuickSettingsController.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/QuickSettingsController.java
@@ -16,7 +16,7 @@
 
 package android.platform.systemui_tapl.controller;
 
-import static android.platform.uiautomator_helpers.DeviceHelpers.getUiDevice;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getUiDevice;
 
 import static androidx.test.platform.app.InstrumentationRegistry.getInstrumentation;
 
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/StatusBarController.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/StatusBarController.java
index bcaa1da1f..61e02db7e 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/StatusBarController.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/StatusBarController.java
@@ -16,8 +16,8 @@
 
 package android.platform.systemui_tapl.controller;
 
-import static android.platform.uiautomator_helpers.DeviceHelpers.getUiDevice;
-import static android.platform.uiautomator_helpers.DeviceHelpers.shell;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getUiDevice;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.shell;
 
 /** Controller for manipulating status bar state. */
 public class StatusBarController {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/SysUiFlagController.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/SysUiFlagController.kt
index fe2b4c1bb..550db8e1e 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/SysUiFlagController.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/SysUiFlagController.kt
@@ -16,8 +16,8 @@
 
 package android.platform.systemui_tapl.controller
 
-import android.platform.uiautomator_helpers.DeviceHelpers.shell
-import android.platform.uiautomator_helpers.DeviceHelpers.uiDevice
+import android.platform.uiautomatorhelpers.DeviceHelpers.shell
+import android.platform.uiautomatorhelpers.DeviceHelpers.uiDevice
 
 private const val BASE_FLAG_COMMAND = "cmd statusbar flag"
 
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/UserController.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/UserController.java
index b8dc5d802..015f271e4 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/UserController.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/UserController.java
@@ -18,9 +18,9 @@ package android.platform.systemui_tapl.controller;
 
 import static android.platform.helpers.CommonUtils.executeShellCommand;
 import static android.platform.test.util.HealthTestingUtils.waitForCondition;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getContext;
-import static android.platform.uiautomator_helpers.DeviceHelpers.getUiDevice;
-import static android.platform.uiautomator_helpers.DeviceHelpers.shell;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getContext;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.getUiDevice;
+import static android.platform.uiautomatorhelpers.DeviceHelpers.shell;
 
 import static com.google.common.truth.Truth.assertThat;
 import static com.google.common.truth.Truth.assertWithMessage;
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/VolumeController.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/VolumeController.kt
index b0c0f9826..14b1dd061 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/VolumeController.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/controller/VolumeController.kt
@@ -20,9 +20,9 @@ import android.Manifest.permission
 import android.content.ContentResolver
 import android.media.AudioManager
 import android.os.VibratorManager
-import android.platform.uiautomator_helpers.DeviceHelpers.context
-import android.platform.uiautomator_helpers.ShellPrivilege
-import android.platform.uiautomator_helpers.WaitUtils.ensureThat
+import android.platform.uiautomatorhelpers.DeviceHelpers.context
+import android.platform.uiautomatorhelpers.ShellPrivilege
+import android.platform.uiautomatorhelpers.WaitUtils.ensureThat
 import android.provider.Settings
 
 /** Controller for adjusting the device volume. */
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bouncer.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bouncer.kt
index 6d32f2486..bc7e7cb47 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bouncer.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bouncer.kt
@@ -24,7 +24,7 @@ import android.platform.helpers.LockscreenUtils
 import android.platform.helpers.LockscreenUtils.LockscreenType
 import android.platform.systemui_tapl.utils.DeviceUtils.sysuiResSelector
 import android.platform.systemui_tapl.utils.SYSUI_PACKAGE
-import android.platform.uiautomatorhelpers.BetterSwipe.from
+import android.platform.uiautomatorhelpers.BetterSwipe
 import android.platform.uiautomatorhelpers.DeviceHelpers.assertInvisible
 import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisibility
 import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisible
@@ -85,9 +85,7 @@ class Bouncer internal constructor(private val notification: Notification?) {
                 }.toPoint()
             )
         }
-        val swipe = from(centerPoint)
-        points.forEach { swipe.to(it) }
-        swipe.release()
+        BetterSwipe.swipe(centerPoint) { points.forEach { to(it) } }
     }
 
     private fun Pair<Int, Int>.toPoint() = Point(first, second)
@@ -242,10 +240,7 @@ class Bouncer internal constructor(private val notification: Notification?) {
 
         /** The compose bouncer_text_entry isn't the same as pin_container, but close enough */
         private val PIN_CONTAINER_SELECTOR =
-            arrayOf(
-                sysuiResSelector("bouncer_text_entry"),
-                sysuiResSelector("pin_container"),
-            )
+            arrayOf(sysuiResSelector("bouncer_text_entry"), sysuiResSelector("pin_container"))
         /** https://hsv.googleplex.com/5225465733185536?node=54 */
         private val PIN_BOUNCER_DELETE_BUTTON = sysuiResSelector("delete_button")
         /** https://hsv.googleplex.com/5554629610831872?node=52 */
@@ -253,7 +248,7 @@ class Bouncer internal constructor(private val notification: Notification?) {
 
         // https://hsv.googleplex.com/5130837462876160?node=117
         private val PAGE_TITLE_SELECTOR_PATTERN =
-            Pattern.compile(String.format("%s:id/%s", SYSUI_PACKAGE, "keyguard_clock_container"))
+            Pattern.compile(String.format("%s:id/%s", SYSUI_PACKAGE, "keyguard_indication_area"))
 
         public val PATTERN_SELECTOR =
             if (IS_COMPOSE_BOUNCER_ENABLED) {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BrightnessSlider.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BrightnessSlider.kt
index 71d73e149..32d16f579 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BrightnessSlider.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BrightnessSlider.kt
@@ -16,9 +16,10 @@
 package android.platform.systemui_tapl.ui
 
 import android.graphics.PointF
+import android.graphics.Rect
 import android.platform.systemui_tapl.utils.DeviceUtils.LONG_WAIT
 import android.platform.systemui_tapl.utils.DeviceUtils.sysuiResSelector
-import android.platform.uiautomatorhelpers.BetterSwipe.from
+import android.platform.uiautomatorhelpers.BetterSwipe
 import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisibility
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import android.platform.uiautomatorhelpers.PRECISE_GESTURE_INTERPOLATOR
@@ -40,6 +41,11 @@ class BrightnessSlider internal constructor() {
 
     /** Slides from left to right */
     fun swipeFromLeftToRight() {
+        swipeFromLeftToRight(Duration.ofMillis(500))
+    }
+
+    /** Slides from left to right with specifying [swipeDuration] */
+    fun swipeFromLeftToRight(swipeDuration: Duration) {
         val sliderBounds = slider.visibleBounds
         val pointFrom =
             PointF(
@@ -51,21 +57,25 @@ class BrightnessSlider internal constructor() {
                 (sliderBounds.centerX() + sliderBounds.width() / 3).toFloat(),
                 sliderBounds.centerY().toFloat(),
             )
-        val swipe =
-            from(pointFrom).to(pointTo, Duration.ofMillis(500), PRECISE_GESTURE_INTERPOLATOR)
+        // NOTE: This control logic is less than clean.
         if (Flags.qsUiRefactorComposeFragment()) {
-            // In this case, the slider is moved to an overlay, then we verify:
-            // The notification shade is not visible, but
-            assertVisibility(sysuiResSelector(UI_NOTIFICATION_SHADE_ID), visible = false)
-            // The actual slider is visible, and
-            assertVisibility(sysuiResSelector(UI_BRIGHTNESS_SLIDER_ID), visible = true)
-            // The bounds haven't changed.
-            assertThat(slider.visibleBounds).isEqualTo(sliderBounds)
-            swipe.release()
+            BetterSwipe.swipe(pointFrom, pointTo, swipeDuration, PRECISE_GESTURE_INTERPOLATOR)
+            if (Flags.qsUiRefactorComposeFragment()) {
+                // In this case, the slider is moved to an overlay, then we verify:
+                // The notification shade is not visible, but
+                assertVisibility(sysuiResSelector(UI_NOTIFICATION_SHADE_ID), visible = false)
+                // The actual slider is visible, and
+                assertVisibility(sysuiResSelector(UI_BRIGHTNESS_SLIDER_ID), visible = true)
+                // The bounds haven't changed.
+                assertThat(slider.visibleBounds).isEqualTo(sliderBounds)
+            }
         } else {
-            val mirrorBounds = brightnessSliderMirror.visibleBounds
-            assertThat(sliderBounds).isEqualTo(mirrorBounds)
-            swipe.release()
+            var mirrorBounds: Rect? = null
+            BetterSwipe.swipe(pointFrom) {
+                to(pointTo, swipeDuration, PRECISE_GESTURE_INTERPOLATOR)
+                mirrorBounds = brightnessSliderMirror.visibleBounds
+                assertThat(sliderBounds).isEqualTo(mirrorBounds)
+            }
             assertThat(mirrorBounds).isEqualTo(slider.visibleBounds)
         }
     }
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bubble.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bubble.kt
index 718d03161..c18c69026 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bubble.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Bubble.kt
@@ -16,7 +16,7 @@
 
 package android.platform.systemui_tapl.ui
 
-import android.graphics.PointF
+import android.graphics.Point
 import android.os.SystemClock
 import android.platform.helpers.CommonUtils
 import android.platform.systemui_tapl.utils.DeviceUtils.launcherResSelector
@@ -30,6 +30,7 @@ import android.platform.uiautomatorhelpers.PRECISE_GESTURE_INTERPOLATOR
 import android.view.WindowInsets
 import android.view.WindowManager
 import androidx.test.uiautomator.UiObject2
+import com.android.wm.shell.Flags
 import com.google.common.truth.Truth.assertWithMessage
 import java.time.Duration
 import java.time.temporal.ChronoUnit
@@ -99,17 +100,21 @@ class Bubble internal constructor(private val bubbleView: UiObject2) {
                     WindowInsets.Type.displayCutout()
             )
         val destination =
-            PointF(
-                windowMetrics.bounds.width() / 2f,
-                (windowMetrics.bounds.height() - insets.bottom).toFloat(),
-            )
-        BetterSwipe.from(bubbleView.visibleCenter)
-            .to(
-                destination,
-                duration = Duration.of(700, ChronoUnit.MILLIS),
-                interpolator = PRECISE_GESTURE_INTERPOLATOR,
-            )
-            .release()
+            Point(windowMetrics.bounds.width() / 2, (windowMetrics.bounds.height() - insets.bottom))
+        BetterSwipe.swipe(
+            bubbleView.visibleCenter,
+            destination,
+            duration = Duration.of(700, ChronoUnit.MILLIS),
+            interpolator = PRECISE_GESTURE_INTERPOLATOR,
+        )
+    }
+
+    override fun equals(other: Any?): Boolean {
+        if (this === other) return true
+        if (other !is Bubble) return false
+        // Bubbles are equal if the backing bubbleView is the same.
+        // This ensures that Bubble objects can be used as targets for waitForValueToSettle.
+        return this.bubbleView == other.bubbleView
     }
 
     companion object {
@@ -123,7 +128,7 @@ class Bubble internal constructor(private val bubbleView: UiObject2) {
         internal val bubbleViews: List<UiObject2>
             get() {
                 val bubbleViews =
-                    if (CommonUtils.isLargeScreen()) {
+                    if (CommonUtils.isLargeScreen() && Flags.enableBubbleBar()) {
                         // Check bubble bar first if we're large screen
                         waitForPossibleEmpty(BUBBLE_BAR_VIEWS, timeout = FIND_OBJECT_TIMEOUT)
                             .ifEmpty {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BubbleBar.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BubbleBar.kt
index 774cf891e..7c85d44ca 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BubbleBar.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BubbleBar.kt
@@ -75,9 +75,10 @@ class BubbleBar {
         // we want to swipe to the point that is twice as far from the bottom of the screen as the
         // bubble bar center Y coordinate
         val destinationY = 2 * bubbleBarCenter.y - windowHeight
-        BetterSwipe.from(Point(bubbleBarCenter.x, windowHeight))
-            .to(Point(bubbleBarCenter.x, destinationY))
-            .release()
+        BetterSwipe.swipe(
+            Point(bubbleBarCenter.x, windowHeight),
+            Point(bubbleBarCenter.x, destinationY),
+        )
         return ExpandedBubbleBar(selectedBubble)
     }
 
@@ -86,14 +87,14 @@ class BubbleBar {
      * gone.
      */
     fun dragToDismiss() {
-        BetterSwipe.from(waitForObj(BUBBLE_BAR_VIEW).visibleCenter)
-            .pause()
-            .to(
+        BetterSwipe.swipe(waitForObj(BUBBLE_BAR_VIEW).visibleCenter) {
+            pause()
+            to(
                 waitForObj(DISMISS_VIEW).visibleCenter,
                 Duration.of(500, ChronoUnit.MILLIS),
                 PRECISE_GESTURE_INTERPOLATOR,
             )
-            .release()
+        }
 
         BUBBLE_BAR_VIEW.assertInvisible {
             "Failed while waiting for bubble bar to become invisible"
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BubbleBarFlyout.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BubbleBarFlyout.kt
new file mode 100644
index 000000000..7583d2c59
--- /dev/null
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/BubbleBarFlyout.kt
@@ -0,0 +1,43 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.platform.systemui_tapl.ui
+
+import android.platform.systemui_tapl.utils.DeviceUtils.launcherResSelector
+import android.platform.uiautomatorhelpers.DeviceHelpers.assertInvisible
+import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisible
+import android.platform.uiautomatorhelpers.DeviceHelpers.click
+
+/**
+ * Provides an API for interacting with the bubble bar flyout within launcher in UI automation
+ * tests.
+ */
+class BubbleBarFlyout {
+
+    init {
+        BUBBLE_BAR_FLYOUT_VIEW.assertVisible()
+    }
+
+    /** Taps on the bubble bar flyout to expand it into the expanded bubble. */
+    fun expand() {
+        BUBBLE_BAR_FLYOUT_VIEW.click()
+        BUBBLE_BAR_FLYOUT_VIEW.assertInvisible()
+    }
+
+    companion object {
+        internal val BUBBLE_BAR_FLYOUT_VIEW = launcherResSelector("bubble_bar_flyout_view")
+    }
+}
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/CommunalHub.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/CommunalHub.kt
index 433eaf002..14d2086a0 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/CommunalHub.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/CommunalHub.kt
@@ -21,7 +21,6 @@ import android.platform.uiautomatorhelpers.BetterSwipe
 import android.platform.uiautomatorhelpers.DeviceHelpers.assertInvisible
 import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisible
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
-import android.platform.uiautomatorhelpers.FLING_GESTURE_INTERPOLATOR
 import androidx.test.uiautomator.By
 
 /** System UI test automation object representing the communal hub. */
@@ -40,12 +39,10 @@ class CommunalHub internal constructor() {
     private fun swipeRight() {
         val bounds = waitForObj(COMMUNAL_SELECTOR).visibleBounds
         val swipeY = bounds.top + bounds.height() / 2f
-        BetterSwipe.from(PointF(bounds.left + 1f, swipeY))
-            .to(
-                PointF(bounds.left + bounds.width() / 2f, swipeY),
-                interpolator = FLING_GESTURE_INTERPOLATOR,
-            )
-            .release()
+        BetterSwipe.swipe(
+            PointF(bounds.left + 1f, swipeY),
+            PointF(bounds.left + bounds.width() / 2f, swipeY),
+        )
     }
 
     companion object {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ComposeQuickSettingsTile.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ComposeQuickSettingsTile.kt
index f0fb99861..109971972 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ComposeQuickSettingsTile.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ComposeQuickSettingsTile.kt
@@ -153,7 +153,7 @@ abstract class ComposeQuickSettingsTile private constructor() {
         }
 
         fun UiObject2.assertIsTile() {
-            assertWithMessage("Tile has id ${resourceName} which is not a tile id")
+            assertWithMessage("Tile has id $resourceName which is not a tile id")
                 .that(
                     resourceName?.endsWith(SMALL_TILE_TAG) ?: false ||
                         resourceName?.endsWith(LARGE_TILE_TAG) ?: false
@@ -239,12 +239,9 @@ private class LongPressableImpl(private val tile: UiObject2) : LongPressable {
     }
 
     override fun longPress(expectedSettingsPackage: String?) {
-        val longClick = Gestures.longClickDown(tile, "Quick settings tile")
-        try {
+        Gestures.longClickDownUp(tile, "Quick settings tile") {
             val packageName = expectedSettingsPackage ?: SETTINGS_PACKAGE
             By.pkg(packageName).assertVisible { "$packageName didn't appear" }
-        } finally {
-            longClick.up()
         }
     }
 }
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleBarBubble.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleBarBubble.kt
index ebd9aba00..e4728b9d3 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleBarBubble.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleBarBubble.kt
@@ -44,12 +44,11 @@ class ExpandedBubbleBarBubble internal constructor() {
             DeviceHelpers.context.getSystemService(WindowManager::class.java)!!.currentWindowMetrics
         val displayCenter = Point(windowMetrics.bounds.centerX(), windowMetrics.bounds.centerY())
 
-        BetterSwipe.from(waitForObj(HANDLE_VIEW).visibleCenter)
+        BetterSwipe.swipe(waitForObj(HANDLE_VIEW).visibleCenter) {
             // First drag to the center of the display, dismiss view only shows up after drag starts
-            .to(displayCenter, interpolator = PRECISE_GESTURE_INTERPOLATOR)
-            .to(waitForObj(DISMISS_VIEW).visibleCenter, interpolator = PRECISE_GESTURE_INTERPOLATOR)
-            .release()
-
+            to(displayCenter, interpolator = PRECISE_GESTURE_INTERPOLATOR)
+            to(waitForObj(DISMISS_VIEW).visibleCenter, interpolator = PRECISE_GESTURE_INTERPOLATOR)
+        }
         BUBBLE_EXPANDED_VIEW.assertInvisible {
             "Failed while waiting for expanded bubble to become invisible"
         }
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleStack.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleStack.kt
index 8186aeeb4..b840de137 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleStack.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/ExpandedBubbleStack.kt
@@ -67,16 +67,19 @@ class ExpandedBubbleStack internal constructor() {
         // To middle of screen
         val to = PointF(x, startY / 2)
         // Use a custom duration for bubble swipe to reduce flakiness on slow device.
-        BetterSwipe.from(from)
-            .to(to, duration = Duration.of(700, MILLIS), interpolator = FLING_GESTURE_INTERPOLATOR)
-            .release()
-        Root.get().verifyNoExpandedBubbleStackIsVisible()
+        BetterSwipe.swipe(
+            from,
+            to,
+            duration = Duration.of(700, MILLIS),
+            interpolator = FLING_GESTURE_INTERPOLATOR,
+        )
+        Root.get().verifyNoExpandedBubbleIsVisible()
     }
 
     /** Closes the stack by the "back" gesture. */
     fun closeByBackGesture() {
         LauncherInstrumentation().pressBack()
-        Root.get().verifyNoExpandedBubbleStackIsVisible()
+        Root.get().verifyNoExpandedBubbleIsVisible()
     }
 
     /** Closes the stack by clicking outside. */
@@ -88,7 +91,7 @@ class ExpandedBubbleStack internal constructor() {
         val clickX = gestureInsets.left
         val clickY = gestureInsets.top
         uiDevice.click(clickX, clickY)
-        Root.get().verifyNoExpandedBubbleStackIsVisible()
+        Root.get().verifyNoExpandedBubbleIsVisible()
     }
 
     /** Dismiss Manage education to proceed with expanded bubbles */
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/LockScreen.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/LockScreen.kt
index f03b824fd..6c51a69d9 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/LockScreen.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/LockScreen.kt
@@ -28,8 +28,8 @@ import android.platform.uiautomatorhelpers.DeviceHelpers.uiDevice
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import android.platform.uiautomatorhelpers.FLING_GESTURE_INTERPOLATOR
 import androidx.test.uiautomator.By
+import com.android.launcher3.tapl.LauncherInstrumentation
 import com.android.launcher3.tapl.Workspace
-import com.android.systemui.Flags.migrateClocksToBlueprint
 import com.android.systemui.Flags.sceneContainer
 import com.google.common.truth.Truth.assertWithMessage
 
@@ -75,6 +75,21 @@ class LockScreen internal constructor() {
         return Root.get().goHomeViaKeycode()
     }
 
+    /** Uses home key to get to the unlocked state, skipping potentially flaky gesture. */
+    fun unlockDirectly() {
+        uiDevice.pressMenu()
+        LOCKSCREEN_SELECTOR.assertInvisible { "Lockscreen still visible after swiping up." }
+        assertWithMessage("Device is still locked after swiping up")
+            .that(LockscreenController.get().isDeviceLocked)
+            .isFalse()
+
+        // Without this part, the launcher might not be ready when tests start to exercise it.
+        uiDevice.pressHome()
+        val instrumentation = LauncherInstrumentation()
+        instrumentation.setExpectedRotation(uiDevice.displayRotation)
+        instrumentation.waitForLauncherInitialized()
+    }
+
     /** Swipes left to access the Communal Hub */
     fun swipeLeftToCommunal(): CommunalHub {
         swipeLeft()
@@ -121,9 +136,7 @@ class LockScreen internal constructor() {
         //   this can be removed if b/229696938 gets resolved to allow for swiping on the icon
         val bounds = swipeableArea.visibleBounds
         val swipeX = bounds.left + bounds.width() / 4f
-        BetterSwipe.from(PointF(swipeX, bounds.bottom - 1f))
-            .to(PointF(swipeX, bounds.top.toFloat()), interpolator = FLING_GESTURE_INTERPOLATOR)
-            .release()
+        BetterSwipe.swipe(PointF(swipeX, bounds.bottom - 1f), PointF(swipeX, bounds.top.toFloat()))
     }
 
     private fun swipeLeft() {
@@ -131,12 +144,10 @@ class LockScreen internal constructor() {
         val swipeableArea = waitForObj(SWIPEABLE_AREA) { "Swipeable area not found" }
         val bounds = swipeableArea.visibleBounds
         val swipeY = bounds.top + bounds.height() / 2f
-        BetterSwipe.from(PointF(bounds.right - 1f, swipeY))
-            .to(
-                PointF(bounds.left + bounds.width() / 2f, swipeY),
-                interpolator = FLING_GESTURE_INTERPOLATOR,
-            )
-            .release()
+        BetterSwipe.swipe(
+            PointF(bounds.right - 1f, swipeY),
+            PointF(bounds.left + bounds.width() / 2f, swipeY),
+        )
     }
 
     companion object {
@@ -147,13 +158,8 @@ class LockScreen internal constructor() {
             if (sceneContainer()) {
                 By.res("element:lockscreen")
             } else {
-                sysuiResSelector(
-                    if (migrateClocksToBlueprint()) {
-                        "keyguard_indication_area"
-                    } else {
-                        "keyguard_clock_container"
-                    }
-                )
+
+                sysuiResSelector("keyguard_indication_area")
             }
         private val SWIPEABLE_AREA =
             if (com.android.systemui.Flags.sceneContainer()) {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/MediaProjectionPermissionDialog.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/MediaProjectionPermissionDialog.kt
index 1ae41293b..f098f176e 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/MediaProjectionPermissionDialog.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/MediaProjectionPermissionDialog.kt
@@ -111,8 +111,7 @@ class MediaProjectionPermissionDialog internal constructor() {
         private val POP_UP = By.clazz("android.widget.ListView")
         private val SINGLE_APP_SELECTOR = By.text("Share one app")
         private val ENTIRE_SCREEN_SELECTOR = By.text("Share entire screen")
-        private val ENTIRE_SCREEN_RECORD_SECONDARY_SELECTOR =
-            By.text("Record entire screen: Overlay #1")
+        private val ENTIRE_SCREEN_RECORD_SECONDARY_SELECTOR = By.text("Record Overlay #1")
         private val SINGLE_APP_START_SELECTOR = By.text("Next")
         private val CANCEL_SELECTOR = By.text("Cancel")
         private val SINGLE_APP_DISABLED_SELECTOR = By.textEndsWith("has disabled this option")
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Notification.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Notification.kt
index 9898058d4..8f5485354 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Notification.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Notification.kt
@@ -225,7 +225,7 @@ internal constructor(
                 startX = center.x,
                 startY = center.y,
                 endX = center.x,
-                endY = center.y + 300,
+                endY = center.y + 280,
                 interpolator = FLING_GESTURE_INTERPOLATOR,
             )
         } else {
@@ -274,15 +274,19 @@ internal constructor(
 
     /** Long press on notification to show its hidden menu (a.k.a. guts) */
     fun showGuts(): NotificationGuts {
-        val longClick = Gestures.longClickDown(notification, "Notification")
-        val guts = notification.waitForObj(GUTS_SELECTOR, UI_RESPONSE_TIMEOUT)
-        guts.assertVisibility(By.text(APP_NAME), true)
-        guts.assertVisibility(By.text(NOTIFICATION_CHANNEL_NAME), true)
-
-        // Confirmation/Settings buttons
-        guts.assertVisibility(GUTS_SETTINGS_SELECTOR, true)
-        guts.assertVisibility(GUTS_CLOSE_SELECTOR, true)
-        longClick.up()
+        Gestures.longClickDownUp(
+            notification,
+            "Notification",
+            whileHoldingFn = {
+                val guts = notification.waitForObj(GUTS_SELECTOR)
+                guts.assertVisibility(By.text(APP_NAME), true)
+                guts.assertVisibility(By.text(NOTIFICATION_CHANNEL_NAME), true)
+
+                // Confirmation/Settings buttons
+                guts.assertVisibility(GUTS_SETTINGS_SELECTOR, true)
+                guts.assertVisibility(GUTS_CLOSE_SELECTOR, true)
+            },
+        )
         return NotificationGuts(notification)
     }
 
@@ -305,7 +309,7 @@ internal constructor(
         check(
             uiDevice.wait(Until.hasObject(By.pkg(pkg!!).depth(0)), LAUNCH_APP_TIMEOUT.toMillis())
         ) {
-            "Did not find application, ${pkg}, in foreground"
+            "Did not find application, $pkg, in foreground"
         }
     }
 
@@ -318,6 +322,15 @@ internal constructor(
         Root.get().bubble
     }
 
+    /** Clicks the "show bubble" button to show a bubble bar bubble. */
+    fun showBubbleBarBubble() {
+        // Create bubble from the notification
+        TaplUiDevice.waitForObject(BUBBLE_BUTTON_SELECTOR, "Show bubble button").click()
+
+        // Verify that a bubble is visible
+        Root.get().bubbleBar
+    }
+
     /** Taps the snooze button on the notification */
     fun snooze(): Notification = also {
         ensureThat { notification.isLongClickable }
@@ -438,9 +451,10 @@ internal constructor(
     private fun swipeRightOnNotification() {
         val bounds = notification.visibleBounds
         val centerY = (bounds.top + bounds.bottom) / 2f
-        BetterSwipe.from(PointF(bounds.left.toFloat(), centerY))
-            .to(PointF(bounds.right.toFloat(), centerY), interpolator = FLING_GESTURE_INTERPOLATOR)
-            .release()
+        BetterSwipe.swipe(
+            PointF(bounds.left.toFloat(), centerY),
+            PointF(bounds.right.toFloat(), centerY),
+        )
     }
 
     companion object {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QSHeader.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QSHeader.kt
index 9d123a266..186ac7812 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QSHeader.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QSHeader.kt
@@ -24,6 +24,8 @@ import android.platform.uiautomatorhelpers.DeviceHelpers.uiDevice
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForFirstObj
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import androidx.test.uiautomator.By
+import com.android.settingslib.flags.Flags.newStatusBarIcons
+import com.android.systemui.Flags.statusBarRootModernization
 import java.text.SimpleDateFormat
 import java.util.Date
 import java.util.Locale
@@ -74,9 +76,13 @@ class QSHeader internal constructor() {
         verifySilentIconIsVisible()
     }
 
-    /** Verifies the battery percentage is visible. Throws otherwise. Experimental. */
+    /** Verifies the battery view is visible. Throws otherwise. Experimental. */
     fun verifyBatteryMeterVisible() {
-        "battery_percentage_view".assertVisible()
+        if (statusBarRootModernization() && newStatusBarIcons()) {
+            "battery_meter_composable_view".assertVisible()
+        } else {
+            "battery_percentage_view".assertVisible()
+        }
     }
 
     /** Verifies that dock defend icon is visible. */
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettings.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettings.kt
index 297357376..0c8881b53 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettings.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettings.kt
@@ -27,12 +27,10 @@ import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisible
 import android.platform.uiautomatorhelpers.DeviceHelpers.uiDevice
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForFirstObj
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
-import android.platform.uiautomatorhelpers.FLING_GESTURE_INTERPOLATOR
 import android.platform.uiautomatorhelpers.scrollUntilFound
 import androidx.test.uiautomator.By
 import androidx.test.uiautomator.Direction
 import androidx.test.uiautomator.UiSelector
-import java.time.Duration
 import java.util.regex.Pattern
 
 /** System UI test automation object representing quick settings in the notification shade. */
@@ -122,13 +120,10 @@ class QuickSettings internal constructor() {
     private fun swipeUp() {
         val displayWidth = uiDevice.displayWidth
         val displayHeight = uiDevice.displayHeight
-        BetterSwipe.from(PointF((displayWidth / 2).toFloat(), displayHeight.toFloat() - 1f))
-            .to(
-                PointF((displayWidth / 2).toFloat(), 0f),
-                Duration.ofMillis(500),
-                FLING_GESTURE_INTERPOLATOR,
-            )
-            .release()
+        BetterSwipe.swipe(
+            PointF((displayWidth / 2).toFloat(), displayHeight.toFloat() - 1f),
+            PointF((displayWidth / 2).toFloat(), 0f),
+        )
     }
 
     private companion object {
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettingsTileBase.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettingsTileBase.kt
index 145bbc1fa..b2a977f65 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettingsTileBase.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/QuickSettingsTileBase.kt
@@ -144,12 +144,9 @@ sealed class QuickSettingsTileBase {
 
     /** Long-clicks the tile and verifies that Settings app appears, unless otherwise specified */
     fun longClick(expectedSettingsPackage: String? = null) {
-        val longClick = Gestures.longClickDown(tile, "Quick settings tile")
-        try {
+        Gestures.longClickDownUp(tile, "Quick settings tile") {
             val packageName = expectedSettingsPackage ?: SETTINGS_PACKAGE
             By.pkg(packageName).assertVisible { "$packageName didn't appear" }
-        } finally {
-            longClick.up()
         }
     }
 
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/RecentMediaCard.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/RecentMediaCard.kt
deleted file mode 100644
index 97988f1fb..000000000
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/RecentMediaCard.kt
+++ /dev/null
@@ -1,42 +0,0 @@
-/*
- * Copyright (C) 2024 The Android Open Source Project
- *
- * Licensed under the Apache License, Version 2.0 (the "License");
- * you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-package android.platform.systemui_tapl.ui
-
-import android.platform.systemui_tapl.utils.DeviceUtils.sysuiResSelector
-import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisible
-import android.platform.uiautomatorhelpers.DeviceHelpers.waitForPossibleEmpty
-
-/**
- * Recommend Media Card on the Universal Media Object.
- *
- * **See:** [HSV](https://hsv.googleplex.com/6195547053490176?node=86)
- */
-class RecentMediaCard internal constructor() {
-
-    init {
-        sysuiResSelector("media_recommendations_updated").assertVisible {
-            "Can't find recent media card."
-        }
-    }
-
-    /**
-     * The titles of recommended recent medias. The layout of the card is defined in
-     * [RecommendationViewHolder].
-     */
-    val mediaTitles: List<String>
-        get() = waitForPossibleEmpty(sysuiResSelector("media_title")).map { it.text }
-}
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Root.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Root.kt
index 8e531437f..fa11ea248 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Root.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/Root.kt
@@ -32,8 +32,6 @@ import android.platform.uiautomatorhelpers.DeviceHelpers.assertInvisible
 import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisible
 import android.platform.uiautomatorhelpers.DeviceHelpers.betterSwipe
 import android.platform.uiautomatorhelpers.DeviceHelpers.uiDevice
-import android.platform.uiautomatorhelpers.FLING_GESTURE_INTERPOLATOR
-import android.platform.uiautomatorhelpers.TracingUtils.trace
 import android.view.InputDevice
 import android.view.InputEvent
 import android.view.KeyCharacterMap
@@ -45,6 +43,7 @@ import androidx.test.platform.app.InstrumentationRegistry
 import androidx.test.uiautomator.By
 import androidx.test.uiautomator.UiSelector
 import androidx.test.uiautomator.Until
+import com.android.app.tracing.traceSection
 import com.android.launcher3.tapl.LauncherInstrumentation
 import com.android.launcher3.tapl.Workspace
 import com.google.common.truth.Truth.assertThat
@@ -70,7 +69,7 @@ class Root private constructor() {
 
     /** Opens the notification shade via AccessibilityService.GLOBAL_ACTION_NOTIFICATIONS. */
     fun openNotificationShadeViaGlobalAction(): NotificationShade {
-        trace("Opening notification shade via global action") {
+        traceSection("Opening notification shade via global action") {
             uiDevice.openNotification()
             waitForShadeToOpen()
             return NotificationShade()
@@ -100,13 +99,15 @@ class Root private constructor() {
         swipeDuration: Duration = Duration.ofMillis(500),
         heightFraction: Float = 0.1F,
     ): NotificationShade {
-        trace("Opening notification shade via swipe") {
+        traceSection("Opening notification shade via swipe") {
             val device = uiDevice
             val width = device.displayWidth.toFloat()
             val height = device.displayHeight.toFloat()
-            BetterSwipe.from(PointF(width / 2, height * heightFraction))
-                .to(PointF(width / 2, height), swipeDuration, FLING_GESTURE_INTERPOLATOR)
-                .release()
+            BetterSwipe.swipe(
+                PointF(width / 2, height * heightFraction),
+                PointF(width / 2, height),
+                swipeDuration,
+            )
             waitForShadeToOpen()
             return NotificationShade()
         }
@@ -121,13 +122,7 @@ class Root private constructor() {
         // Swipe in first quarter to avoid desktop windowing app handle interactions.
         val swipeXCoordinate = (device.displayWidth / 4).toFloat()
         val height = device.displayHeight.toFloat()
-        BetterSwipe.from(PointF(swipeXCoordinate, 0f))
-            .to(
-                PointF(swipeXCoordinate, height),
-                Duration.ofMillis(500),
-                FLING_GESTURE_INTERPOLATOR,
-            )
-            .release()
+        BetterSwipe.swipe(PointF(swipeXCoordinate, 0f), PointF(swipeXCoordinate, height))
         waitForShadeToOpen()
         return NotificationShade()
     }
@@ -274,6 +269,10 @@ class Root private constructor() {
     val bubbleBar: BubbleBar
         get() = BubbleBar()
 
+    /** Gets the bubble bar flyout in launcher. */
+    val bubbleBarFlyout: BubbleBarFlyout
+        get() = BubbleBarFlyout()
+
     /** Verifies that the bubble bar is hidden. */
     fun verifyBubbleBarIsHidden() {
         BubbleBar.BUBBLE_BAR_VIEW.assertInvisible(LONG_WAIT)
@@ -282,11 +281,11 @@ class Root private constructor() {
     /** Verifies that no bubbles or an expanded bubble stack are visible. */
     fun verifyNoBubbleIsVisible() {
         Bubble.BUBBLE_VIEW.assertInvisible(timeout = Bubble.FIND_OBJECT_TIMEOUT)
-        verifyNoExpandedBubbleStackIsVisible()
+        verifyNoExpandedBubbleIsVisible()
     }
 
-    /** Verifies that expanded bubble stack is not visible. */
-    fun verifyNoExpandedBubbleStackIsVisible() {
+    /** Verifies that expanded bubble stack (or bar) is not visible. */
+    fun verifyNoExpandedBubbleIsVisible() {
         BUBBLE_EXPANDED_VIEW.assertInvisible(timeout = Bubble.FIND_OBJECT_TIMEOUT)
     }
 
@@ -485,7 +484,7 @@ class Root private constructor() {
 
         private fun waitForShadeToOpen() {
             // Note that this duplicates the tracing done by assertVisible, but with a better name.
-            trace("waitForShadeToOpen") {
+            traceSection("waitForShadeToOpen") {
                 QS_HEADER_SELECTOR.assertVisible(
                     timeout = NOTIFICATION_SHADE_OPEN_TIMEOUT,
                     errorProvider = { "Notification shade didn't open" },
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/StatusBar.java b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/StatusBar.java
index c2e888d71..00bed69e2 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/StatusBar.java
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/StatusBar.java
@@ -26,6 +26,7 @@ import static android.platform.uiautomatorhelpers.WaitUtils.ensureThat;
 import static androidx.test.uiautomator.Until.findObject;
 
 import static com.android.settingslib.flags.Flags.newStatusBarIcons;
+import static com.android.systemui.Flags.statusBarChipsModernization;
 
 import static com.google.common.truth.Truth.assertThat;
 import static com.google.common.truth.Truth.assertWithMessage;
@@ -71,6 +72,8 @@ public class StatusBar {
     static final String DND_ICON_DESC = Flags.modesUi() ? "Do Not Disturb is on" : "Do Not Disturb";
     private static final String WIFI_ICON_ID = "wifi_combo";
     private static final String ONGOING_ACTIVITY_CHIP_ICON_ID = "ongoing_activity_chip_primary";
+    // Corresponds to ScreenRecordChipViewModel.KEY
+    private static final String SCREEN_RECORDING_CHIP_ID = "ScreenRecord";
     static final String SCREEN_RECORD_DESC_STRING = "Recording screen";
     static final String SILENT_ICON_DESC_PREFIX_STRING = "Ringer silent";
     static final String VIBRATE_ICON_DESC_PREFIX_STRING = "Ringer vibrate";
@@ -238,7 +241,7 @@ public class StatusBar {
                                 .wait(
                                         Until.hasObject(
                                                 sysuiResSelector(UI_SYSTEM_ICONS_ID)
-                                                        .hasChild(
+                                                        .hasDescendant(
                                                                 By.descContains(
                                                                         DOCK_DEFEND_ICON_SUFFIX_STRING))),
                                         SHORT_WAIT.toMillis()))
@@ -326,8 +329,14 @@ public class StatusBar {
 
     /** Assert that the screen record chip is visible. */
     public void verifyScreenRecordChipIsVisible() {
+        String resSelector;
+        if (statusBarChipsModernization()) {
+            resSelector = SCREEN_RECORDING_CHIP_ID;
+        } else {
+            resSelector = ONGOING_ACTIVITY_CHIP_ICON_ID;
+        }
         DeviceHelpers.INSTANCE.assertVisible(
-                sysuiResSelector(ONGOING_ACTIVITY_CHIP_ICON_ID)
+                sysuiResSelector(resSelector)
                         .hasDescendant(By.descContains(SCREEN_RECORD_DESC_STRING)),
                 LONG_WAIT,
                 () -> "Recording chip should be visible in status bar.");
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/UniversalMediaObject.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/UniversalMediaObject.kt
index a322ffcc7..134fd0c8e 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/UniversalMediaObject.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/UniversalMediaObject.kt
@@ -30,7 +30,7 @@ import com.google.common.truth.Truth.assertWithMessage
 /**
  * Represents the universal media object(UMO) displayed in the [NotificationShade]. UMO is not the
  * same as a media player. It contains a scrollable view called the Carousel, which can contain
- * multiple media players and recent media cards.
+ * multiple media players.
  */
 class UniversalMediaObject internal constructor() {
 
@@ -62,8 +62,4 @@ class UniversalMediaObject internal constructor() {
     companion object {
         val MEDIA_CAROUSEL_SCROLLER: BySelector = sysuiResSelector("media_carousel_scroller")
     }
-
-    /** Get the recommend media card on the UMO, or fail if it's not visible */
-    val recentMediaCard: RecentMediaCard
-        get() = RecentMediaCard()
 }
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeDialog.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeDialog.kt
index 580fb82d1..63e7ba8db 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeDialog.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeDialog.kt
@@ -16,7 +16,6 @@
 package android.platform.systemui_tapl.ui
 
 import android.graphics.Point
-import android.graphics.PointF
 import android.platform.systemui_tapl.utils.DeviceUtils.sysuiResSelector
 import android.platform.systemui_tapl.volume.panel.ui.VolumePanel
 import android.platform.uiautomatorhelpers.BetterSwipe
@@ -25,6 +24,8 @@ import android.platform.uiautomatorhelpers.DeviceHelpers.click
 import android.platform.uiautomatorhelpers.DeviceHelpers.uiDevice
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import android.platform.uiautomatorhelpers.PRECISE_GESTURE_INTERPOLATOR
+import androidx.test.uiautomator.BySelector
+import com.android.systemui.Flags
 import com.google.common.truth.Truth
 
 /** System UI test automation object representing the dialog for adjusting the device volume. */
@@ -48,9 +49,14 @@ class VolumeDialog internal constructor() {
 
     /** Open the ringer drawer by clicking the ringer mode icon on the volume dialog. */
     fun openRingerDrawer(): VolumeRingerDrawer {
-        val ringerIconSel = sysuiResSelector("volume_new_ringer_active_icon_container")
-        waitForObj(ringerIconSel).click()
-        return VolumeRingerDrawer()
+        val ringerIconSelector =
+            if (Flags.volumeRedesign()) {
+                sysuiResSelector("ringer_buttons_background")
+            } else {
+                sysuiResSelector("volume_new_ringer_active_icon_container")
+            }
+        waitForObj(ringerIconSelector).click()
+        return VolumeRingerDrawer.get()
     }
 
     /** Open the volume setting panel by clicking the setting icon on the volume dialog. */
@@ -59,13 +65,21 @@ class VolumeDialog internal constructor() {
         replaceWith = ReplaceWith("openNewVolumePanel"),
     )
     fun openVolumePanel(): VolumePanelDialog {
-        sysuiResSelector("settings").click()
+        if (Flags.volumeRedesign()) {
+            sysuiResSelector("volume_dialog_settings").click()
+        } else {
+            sysuiResSelector("settings").click()
+        }
         return VolumePanelDialog()
     }
 
     /** Open the volume setting panel by clicking the setting icon on the volume dialog. */
     fun openNewVolumePanel(): VolumePanel {
-        waitForObj(sysuiResSelector("settings")).click()
+        if (Flags.volumeRedesign()) {
+            waitForObj(sysuiResSelector("volume_dialog_settings")).click()
+        } else {
+            waitForObj(sysuiResSelector("settings")).click()
+        }
         return VolumePanel()
     }
 
@@ -82,7 +96,6 @@ class VolumeDialog internal constructor() {
     }
 
     companion object {
-        private val SLIDER = sysuiResSelector("volume_row_slider")
         val PAGE_TITLE_SELECTOR = sysuiResSelector("volume_dialog")
         private const val MAX_VOLUME = 26
         private const val MIN_VOLUME = -1
@@ -94,11 +107,19 @@ class VolumeDialog internal constructor() {
          * @param volume value for volume to changed
          */
         private fun dragAndChangeVolume(volume: Int) {
-            val coordinates = getDragCoordinates(volume)
+            val slider =
+                if (Flags.volumeRedesign()) {
+                    sysuiResSelector("volume_dialog_slider")
+                } else {
+                    sysuiResSelector("volume_row_slider")
+                }
+            val coordinates = getDragCoordinates(slider, volume)
             assertVolumeDialogVisible()
-            BetterSwipe.from(waitForObj(SLIDER).visibleCenter)
-                .to(PointF(coordinates), interpolator = PRECISE_GESTURE_INTERPOLATOR)
-                .release()
+            BetterSwipe.swipe(
+                waitForObj(slider).visibleCenter,
+                coordinates,
+                interpolator = PRECISE_GESTURE_INTERPOLATOR,
+            )
         }
 
         /** Asserts that the volume dialog is visible. */
@@ -131,10 +152,10 @@ class VolumeDialog internal constructor() {
          * @param volume value for volume to changed
          * @return an of Point which is the coordinate of the slider to be moved too.
          */
-        private fun getDragCoordinates(volume: Int): Point {
+        private fun getDragCoordinates(slider: BySelector, volume: Int): Point {
             Truth.assertThat(volume).isLessThan(MAX_VOLUME)
             Truth.assertThat(volume).isGreaterThan(MIN_VOLUME)
-            val dimension = uiDevice.waitForObj(SLIDER).visibleBounds
+            val dimension = uiDevice.waitForObj(slider).visibleBounds
             val top = dimension.top
             val left = dimension.left
             val right = dimension.right
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeRingerDrawer.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeRingerDrawer.kt
index 5a6c47474..415dd19e1 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeRingerDrawer.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/ui/VolumeRingerDrawer.kt
@@ -20,6 +20,25 @@ import android.platform.systemui_tapl.utils.DeviceUtils.sysuiResSelector
 import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import androidx.test.uiautomator.BySelector
 import androidx.test.uiautomator.UiObject2
+import com.android.systemui.Flags
+
+interface VolumeRingerDrawer {
+
+    val selectedMode: RingerMode
+
+    fun selectRingerMode(mode: RingerMode)
+
+    companion object {
+
+        fun get(): VolumeRingerDrawer {
+            return if (Flags.volumeRedesign()) {
+                VolumeRingerDrawerImpl()
+            } else {
+                VolumeRingerDrawerLegacy()
+            }
+        }
+    }
+}
 
 /**
  * Ringer drawer is a container which is opened after clicking ringer mode button.
@@ -28,26 +47,26 @@ import androidx.test.uiautomator.UiObject2
  *
  * Ringer drawer: https://hsv.googleplex.com/5102770609717248
  */
-class VolumeRingerDrawer internal constructor() {
+private class VolumeRingerDrawerLegacy : VolumeRingerDrawer {
 
     private val container: UiObject2
 
     init {
-        val containerSel = sysuiResSelector("volume_drawer_container")
-        this.container = waitForObj(containerSel) { "Can't find the ringer drawer." }
+        val containerSelector = sysuiResSelector("volume_drawer_container")
+        this.container = waitForObj(containerSelector) { "Can't find the ringer drawer." }
     }
 
     /**
      * Detect the current selected mode by checking the highlighted ringer icon. The highlighted
      * icon is the one with the active icon container on the top.
      */
-    val selectedMode: RingerMode
+    override val selectedMode: RingerMode
         get() {
             val activeIconSel = sysuiResSelector("volume_new_ringer_active_icon_container")
             val activeIcon =
                 waitForObj(activeIconSel) { "Can't find any active icon on the drawer." }
             val center = activeIcon.visibleCenter
-            return RingerMode.values()
+            return RingerMode.entries
                 .filter { it.isAvailable }
                 .first {
                     val icon =
@@ -59,9 +78,8 @@ class VolumeRingerDrawer internal constructor() {
         }
 
     /** Click the given ringer icon in the drawer. */
-    fun selectRingerMode(mode: RingerMode): VolumeDialog {
+    override fun selectRingerMode(mode: RingerMode) {
         waitForObj(mode.getIconSelector()) { "$mode icon not found" }.click()
-        return VolumeDialog()
     }
 
     private fun RingerMode.getIconSelector(): BySelector {
@@ -72,3 +90,44 @@ class VolumeRingerDrawer internal constructor() {
         }.let { sysuiResSelector(it) }
     }
 }
+
+class VolumeRingerDrawerImpl : VolumeRingerDrawer {
+
+    private val container: UiObject2 =
+        waitForObj(sysuiResSelector("volume_ringer_drawer")) { "Can't find the ringer drawer." }
+
+    /**
+     * Detect the current selected mode by checking the highlighted ringer icon. The highlighted
+     * icon is the one with the active icon container on the top.
+     */
+    override val selectedMode: RingerMode
+        get() {
+            val selectedIndex =
+                container.children
+                    .mapIndexedNotNull { index, uiObject2 -> index.takeIf { uiObject2.isSelected } }
+                    .single()
+            return RingerMode.entries.single { it.getIndex() == selectedIndex }
+        }
+
+    /** Click the given ringer icon in the drawer. */
+    override fun selectRingerMode(mode: RingerMode) {
+        val index = mode.getIndex() ?: error("ringer mode is unavailable")
+        container.children[index].click()
+    }
+
+    private fun RingerMode.getIndex(): Int? {
+        return if (!RingerMode.VIBRATE.isAvailable) {
+            when (this) {
+                RingerMode.NORMAL -> 2
+                RingerMode.SILENT -> 1
+                RingerMode.VIBRATE -> null
+            }
+        } else {
+            when (this) {
+                RingerMode.NORMAL -> 3
+                RingerMode.SILENT -> 2
+                RingerMode.VIBRATE -> 1
+            }
+        }
+    }
+}
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/utils/UserUtils.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/utils/UserUtils.kt
index f19703b03..f2fdf0c8b 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/utils/UserUtils.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/utils/UserUtils.kt
@@ -20,8 +20,8 @@ import android.app.ActivityManager
 import android.app.IUserSwitchObserver
 import android.app.UserSwitchObserver
 import android.platform.helpers.CommonUtils.println
-import android.platform.uiautomator_helpers.DeviceHelpers.assertInvisible
-import android.platform.uiautomator_helpers.TracingUtils.trace
+import android.platform.uiautomatorhelpers.DeviceHelpers.assertInvisible
+import android.platform.uiautomatorhelpers.TracingUtils.trace
 import android.util.Log
 import androidx.test.uiautomator.By
 import androidx.test.uiautomator.StaleObjectException
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanel.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanel.kt
index eb6846ec7..443379bd3 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanel.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanel.kt
@@ -19,9 +19,9 @@ package android.platform.systemui_tapl.volume.panel.ui
 import android.platform.systemui_tapl.utils.DeviceUtils.LONG_WAIT
 import android.platform.systemui_tapl.utils.DeviceUtils.sysuiResSelector
 import android.platform.systemui_tapl.utils.SYSUI_PACKAGE
-import android.platform.uiautomator_helpers.DeviceHelpers.assertInvisible
-import android.platform.uiautomator_helpers.DeviceHelpers.assertVisible
-import android.platform.uiautomator_helpers.DeviceHelpers.waitForObj
+import android.platform.uiautomatorhelpers.DeviceHelpers.assertInvisible
+import android.platform.uiautomatorhelpers.DeviceHelpers.assertVisible
+import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import androidx.test.uiautomator.By
 import androidx.test.uiautomator.UiObject2
 
diff --git a/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanelSlider.kt b/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanelSlider.kt
index af4246600..5c6fb2b8a 100644
--- a/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanelSlider.kt
+++ b/libraries/systemui-tapl/src/android/platform/systemui_tapl/volume/panel/ui/VolumePanelSlider.kt
@@ -17,7 +17,7 @@
 package android.platform.systemui_tapl.volume.panel.ui
 
 import android.platform.systemui_tapl.utils.DeviceUtils
-import android.platform.uiautomator_helpers.DeviceHelpers.waitForObj
+import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import android.view.accessibility.AccessibilityNodeInfo
 import androidx.test.uiautomator.Direction
 import androidx.test.uiautomator.UiObject2
diff --git a/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/Gestures.kt b/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/Gestures.kt
index 1df82463b..31727c514 100644
--- a/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/Gestures.kt
+++ b/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/Gestures.kt
@@ -15,8 +15,12 @@
  */
 package android.platform.test.scenario.tapl_common
 
-import android.platform.uiautomator_helpers.BetterSwipe
-import android.platform.uiautomator_helpers.WaitUtils.ensureThat
+import android.os.SystemClock.sleep
+import android.platform.uiautomatorhelpers.BetterSwipe
+import android.platform.uiautomatorhelpers.BetterSwipe.Swipe
+import android.platform.uiautomatorhelpers.WaitUtils.ensureThat
+import android.provider.Settings
+import androidx.test.platform.app.InstrumentationRegistry
 import androidx.test.uiautomator.StaleObjectException
 import androidx.test.uiautomator.UiObject2
 import java.time.Duration
@@ -32,12 +36,12 @@ object Gestures {
     private fun waitForObjectCondition(
         objectName: String,
         conditionName: String,
-        condition: () -> Boolean
+        condition: () -> Boolean,
     ) {
         ensureThat(
             condition = condition,
             description = "UI object '$objectName' becomes $conditionName",
-            timeout = WAIT_TIME
+            timeout = WAIT_TIME,
         )
     }
 
@@ -72,38 +76,41 @@ object Gestures {
         } catch (e: StaleObjectException) {
             throw AssertionError(
                 "UI object '$objectName' has disappeared from the screen during the click gesture.",
-                e
+                e,
             )
         }
     }
 
-    /** The result of [longClickDown]. The caller has to call the [up] method. */
-    class LongClick internal constructor(swipe: BetterSwipe.Swipe) {
-        private val mSwipe: BetterSwipe.Swipe = swipe
-
-        fun up() {
-            mSwipe.release()
-        }
-    }
-
     /**
      * Waits for the object to become long-clickable and enabled, then presses the object down.
      *
      * @param [uiObject] The object to click
      * @param [objectName] Name of the object for diags
-     * @return the object with [LongClick.up] method that needs to be called.
+     * @param [whileHoldingFn] lambda to call between press and release.
      */
     @JvmStatic
-    fun longClickDown(uiObject: UiObject2, objectName: String): LongClick {
+    fun longClickDownUp(
+        uiObject: UiObject2,
+        objectName: String,
+        whileHoldingFn: (Swipe.() -> Unit),
+    ) {
         try {
             waitForObjectEnabled(uiObject, objectName)
             waitForObjectLongClickable(uiObject, objectName)
-            return LongClick(BetterSwipe.from(uiObject.visibleCenter))
+            val context = InstrumentationRegistry.getInstrumentation().targetContext
+            BetterSwipe.swipe(uiObject.visibleCenter) {
+
+                // press for twice the long press timeout, just to make sure.
+                val longPressMsec =
+                    Settings.Secure.getInt(context.contentResolver, "long_press_timeout")
+                sleep(longPressMsec.toLong() * 2)
+                whileHoldingFn()
+            }
         } catch (e: StaleObjectException) {
             throw AssertionError(
                 "UI object '$objectName' has disappeared from " +
                     "the screen during the long click gesture.",
-                e
+                e,
             )
         }
     }
@@ -116,6 +123,6 @@ object Gestures {
      * attempted.
      */
     private fun clickNow(uiObject: UiObject2) {
-        BetterSwipe.from(uiObject.visibleCenter).release()
+        BetterSwipe.swipe(uiObject.visibleCenter)
     }
 }
diff --git a/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiDevice.kt b/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiDevice.kt
index 4ec313d6d..fe0498ce3 100644
--- a/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiDevice.kt
+++ b/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiDevice.kt
@@ -15,7 +15,7 @@
  */
 package android.platform.test.scenario.tapl_common
 
-import android.platform.uiautomator_helpers.DeviceHelpers.waitForObj
+import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import androidx.test.uiautomator.BySelector
 
 /** Wrapper of UiDevice for finding TAPL UI objects and performing flake-free gestures. */
diff --git a/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiObject.kt b/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiObject.kt
index 309404cc0..407d94959 100644
--- a/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiObject.kt
+++ b/libraries/tapl-common/src/android/platform/test/scenario/tapl_common/TaplUiObject.kt
@@ -16,9 +16,9 @@
 package android.platform.test.scenario.tapl_common
 
 import android.graphics.Rect
-import android.platform.uiautomator_helpers.BetterFling
-import android.platform.uiautomator_helpers.BetterScroll
-import android.platform.uiautomator_helpers.DeviceHelpers.waitForObj
+import android.platform.uiautomatorhelpers.BetterFling
+import android.platform.uiautomatorhelpers.BetterScroll
+import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import androidx.test.uiautomator.By
 import androidx.test.uiautomator.Direction
 import androidx.test.uiautomator.UiObject2
@@ -114,7 +114,7 @@ class TaplUiObject constructor(val uiObject: UiObject2, private val name: String
     fun scrollWithFling(
         scrollDirection: Direction,
         percent: Float,
-        verifyIsScrollable: Boolean = false
+        verifyIsScrollable: Boolean = false,
     ) {
         // To scroll, we fling in the opposite direction
         fling(Direction.reverse(scrollDirection), percent, verifyIsScrollable)
diff --git a/libraries/tradefed-error-prone/OWNERS b/libraries/tradefed-error-prone/OWNERS
index e9eb82d5a..c4aff6452 100644
--- a/libraries/tradefed-error-prone/OWNERS
+++ b/libraries/tradefed-error-prone/OWNERS
@@ -3,5 +3,4 @@ dshi@google.com
 frankfeng@google.com
 guangzhu@google.com
 jdesprez@google.com
-murj@google.com
 tsu@google.com
diff --git a/libraries/uiautomator-helpers/OWNERS b/libraries/uiautomator-helpers/OWNERS
index cac9021f1..049d40fc7 100644
--- a/libraries/uiautomator-helpers/OWNERS
+++ b/libraries/uiautomator-helpers/OWNERS
@@ -1,2 +1,3 @@
 nicomazz@google.com
 uwaisashraf@google.com
+saff@google.com
\ No newline at end of file
diff --git a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterFling.kt b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterFling.kt
index c117fd2a7..2b61569d5 100644
--- a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterFling.kt
+++ b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterFling.kt
@@ -59,9 +59,9 @@ object BetterFling {
 
         trace("Fling $start -> $stop") {
             uiDevice.performActionAndWait(
-                { BetterSwipe.from(start).to(stop, duration).release() },
+                { BetterSwipe.swipe(start, stop, duration) },
                 Until.scrollFinished(Direction.reverse(direction)),
-                DEFAULT_WAIT_TIMEOUT.toMillis()
+                DEFAULT_WAIT_TIMEOUT.toMillis(),
             )
         }
     }
diff --git a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterScroll.kt b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterScroll.kt
index 27dc45cca..86bdd773d 100644
--- a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterScroll.kt
+++ b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterScroll.kt
@@ -41,18 +41,14 @@ object BetterScroll {
      */
     @JvmStatic
     @JvmOverloads
-    fun scroll(
-        rect: Rect,
-        direction: Direction,
-        percentage: Float = DEFAULT_PERCENTAGE,
-    ) {
+    fun scroll(rect: Rect, direction: Direction, percentage: Float = DEFAULT_PERCENTAGE) {
         val (start, stop) = calculateStartEndPoint(rect, direction, percentage)
 
         trace("Scrolling $start -> $stop") {
             uiDevice.performActionAndWait(
-                { BetterSwipe.from(start).to(stop).pause().release() },
+                { BetterSwipe.swipe(start, stop) { pause() } },
                 Until.scrollFinished(Direction.reverse(direction)),
-                DEFAULT_WAIT_TIMEOUT.toMillis()
+                DEFAULT_WAIT_TIMEOUT.toMillis(),
             )
         }
     }
diff --git a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterSwipe.kt b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterSwipe.kt
index a6bb07b17..d9a879be3 100644
--- a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterSwipe.kt
+++ b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/BetterSwipe.kt
@@ -23,7 +23,6 @@ import android.os.SystemClock
 import android.os.SystemClock.sleep
 import android.platform.uiautomatorhelpers.DeviceHelpers.context
 import android.platform.uiautomatorhelpers.TracingUtils.trace
-import android.platform.uiautomatorhelpers.WaitUtils.ensureThat
 import android.util.Log
 import android.view.Display.DEFAULT_DISPLAY
 import android.view.InputDevice
@@ -35,6 +34,7 @@ import androidx.test.platform.app.InstrumentationRegistry.getInstrumentation
 import com.google.common.truth.Truth.assertThat
 import java.time.Duration
 import java.time.temporal.ChronoUnit.MILLIS
+import java.util.concurrent.CopyOnWriteArrayList
 import java.util.concurrent.atomic.AtomicInteger
 
 private val DEFAULT_DURATION: Duration = Duration.of(500, MILLIS)
@@ -59,26 +59,124 @@ private val PAUSE_DURATION: Duration = Duration.of(250, MILLIS)
  * ```
  */
 object BetterSwipe {
+    val TAG = "BetterSwipe"
 
+    /** The swipes that have currently not been released, with most recent first. */
+    private val currentSwipes = CopyOnWriteArrayList<Swipe>()
+    // TODO(b/388022364): can this be replaced by currentSwipes?
     private val lastPointerId = AtomicInteger(0)
 
-    /** Starts a swipe from [start] at the current time. */
-    @JvmStatic fun from(start: PointF) = Swipe(start)
+    /**
+     * Release all currently-held swipes, starting with the most recently initiated swipes. (due to
+     * issues like b/383365751, we may sometimes "leak" swipes, and this can be called to state that
+     * all fingers should be up)
+     */
+    @JvmStatic
+    fun releaseAll() {
+        while (currentSwipes.isNotEmpty()) {
+            Log.e(TAG, "releasing, ${currentSwipes.size} current swipes remaining")
+            // Should remove this swipe from the list
+            currentSwipes[0].release()
+        }
+    }
 
     /** Starts a swipe from [start] at the current time. */
-    @JvmStatic fun from(start: Point) = Swipe(PointF(start.x.toFloat(), start.y.toFloat()))
+    // @JvmStatic fun from(start: PointF) = Swipe(start)
+    /**
+     * Swipe from [start] to [end] in time [duration] using [interpolator] and calling [swipeFn]
+     * before the swipe is released. The try/finally forces the release() call, so InputDispatcher
+     * doesn't get confused. (b/377512109).
+     *
+     * @param [start] starting point of swipe.
+     * @param [end] end of swipe
+     * @param [duration] duration of swipe
+     * @param [interpolator] to use (fling or scroll, usually.
+     * @param [swipeFn] lambda on Swipe to send from()/to(), pause(), before release() is called.
+     */
+    @JvmOverloads
+    @JvmStatic
+    fun swipe(
+        start: PointF,
+        end: PointF,
+        duration: Duration = DEFAULT_DURATION,
+        interpolator: TimeInterpolator = FLING_GESTURE_INTERPOLATOR,
+        swipeFn: (Swipe.() -> Unit) = {},
+    ) {
+        var swipe: Swipe? = null
+        try {
+            swipe = Swipe(start)
+            swipe.from()
+            swipe.swipeFn()
+            swipe.to(end, duration, interpolator)
+        } finally {
+            swipe?.release()
+        }
+    }
+
+    /** Variant which takes integer points. */
+    @JvmOverloads
+    @JvmStatic
+    fun swipe(
+        start: Point,
+        end: Point,
+        duration: Duration = DEFAULT_DURATION,
+        interpolator: TimeInterpolator = FLING_GESTURE_INTERPOLATOR,
+        swipeFn: (Swipe.() -> Unit) = {},
+    ) {
+        swipe(
+            PointF(start.x.toFloat(), start.y.toFloat()),
+            PointF(end.x.toFloat(), end.y.toFloat()),
+            duration,
+            interpolator,
+            swipeFn,
+        )
+    }
+
+    /**
+     * This variant of swipe only specifies the from point, and delegates the actual swipe to inside
+     * the lambda, for special cases such as BrightnessSlider, which asserts after the first touch,
+     * but before the actual swipe/slide happens.
+     *
+     * @param [start] starting point.
+     * @param [swipeFn] lambda to call after touch down, but before swipe.
+     */
+    @JvmStatic
+    fun swipe(start: PointF, swipeFn: (Swipe.() -> Unit)) {
+        var swipe: Swipe? = null
+        try {
+            swipe = Swipe(start)
+            swipe.from()
+            swipe.swipeFn()
+        } finally {
+            swipe?.release()
+        }
+    }
+
+    /** Variant which takes an integer point. */
+    @JvmOverloads
+    @JvmStatic
+    fun swipe(start: Point, swipeFn: (Swipe.() -> Unit) = {}) {
+        swipe(PointF(start.x.toFloat(), start.y.toFloat()), swipeFn)
+    }
 
-    class Swipe internal constructor(start: PointF) {
+    class Swipe internal constructor(val start: PointF) {
 
-        private val downTime = SystemClock.uptimeMillis()
+        private var downTime = -1L
         private val pointerId = lastPointerId.incrementAndGet()
         private var lastPoint: PointF = start
         private var lastTime: Long = downTime
         private var released = false
 
         init {
+            currentSwipes.add(0, this)
             log("Touch $pointerId started at $start")
+        }
+
+        internal fun from(): Swipe {
+            throwIfReleased()
+            downTime = SystemClock.uptimeMillis()
             sendPointer(currentTime = downTime, action = MotionEvent.ACTION_DOWN, point = start)
+            return this
         }
 
         /**
@@ -92,8 +190,9 @@ object BetterSwipe {
         fun to(
             end: PointF,
             duration: Duration = DEFAULT_DURATION,
-            interpolator: TimeInterpolator = FLING_GESTURE_INTERPOLATOR
+            interpolator: TimeInterpolator = FLING_GESTURE_INTERPOLATOR,
         ): Swipe {
+            throwIfNotDown()
             throwIfReleased()
             val stepTime = calculateStepTime()
             log(
@@ -118,7 +217,7 @@ object BetterSwipe {
         fun to(
             end: Point,
             duration: Duration = DEFAULT_DURATION,
-            interpolator: TimeInterpolator = FLING_GESTURE_INTERPOLATOR
+            interpolator: TimeInterpolator = FLING_GESTURE_INTERPOLATOR,
         ): Swipe {
             return to(PointF(end.x.toFloat(), end.y.toFloat()), duration, interpolator)
         }
@@ -130,14 +229,19 @@ object BetterSwipe {
 
         /** Moves the pointer up, finishing the swipe. Further calls will result in an exception. */
         @JvmOverloads
+        /*
         fun release(sync: Boolean = true) {
+            currentSwipes.remove(this)
+        */
+        internal fun release(sync: Boolean = true) {
+            currentSwipes.remove(this)
             throwIfReleased()
             log("Touch $pointerId released at $lastPoint")
             sendPointer(
                 currentTime = lastTime,
                 action = MotionEvent.ACTION_UP,
                 point = lastPoint,
-                sync = sync
+                sync = sync,
             )
             lastPointerId.decrementAndGet()
             released = true
@@ -155,11 +259,17 @@ object BetterSwipe {
             check(!released) { "Trying to perform a swipe operation after pointer released" }
         }
 
+        private fun throwIfNotDown() {
+            check(downTime != -1L) {
+                "Trying to perform a swipe operation with pointer not down $downTime"
+            }
+        }
+
         private fun sendPointer(
             currentTime: Long,
             action: Int,
             point: PointF,
-            sync: Boolean = true
+            sync: Boolean = true,
         ) {
             val event = getMotionEvent(downTime, currentTime, action, point, pointerId)
 
@@ -171,23 +281,19 @@ object BetterSwipe {
         }
 
         private fun trySendMotionEvent(event: MotionEvent, sync: Boolean) {
-            ensureThat(
-                    "Injecting motion event",
-                    /* timeout= */ Duration.ofMillis(INJECT_EVENT_TIMEOUT_MILLIS),
-                    /* errorProvider= */ {
-                        "Injecting motion event $event failed after retrying for 10 seconds, " +
-                            "see logcat for the error"
-                    }
-                )
-                /* condition= */ {
-                    try {
-                        return@ensureThat getInstrumentation()
-                            .uiAutomation
-                            .injectInputEvent(event, sync, /* waitForAnimations= */ false)
-                    } catch (t: Throwable) {
-                        throw RuntimeException(t)
-                    }
-                }
+
+            // Do not re-attempt to send ACTION_DOWN and ACTION_UP events
+            // because the InputDispatcher retains state between test runs and
+            // expects an ACTION_UP after each ACTION_DOWN, even if it rejects
+            // the event.
+
+            try {
+                getInstrumentation()
+                    .uiAutomation
+                    .injectInputEvent(event, sync, /* waitForAnimations= */ false)
+            } catch (t: Throwable) {
+                throw RuntimeException(t)
+            }
         }
 
         /** Returns the time when movement finished. */
@@ -196,7 +302,7 @@ object BetterSwipe {
             from: PointF,
             to: PointF,
             interpolator: TimeInterpolator,
-            stepTime: Duration
+            stepTime: Duration,
         ): Long {
             val stepTimeMs = stepTime.toMillis()
             val durationMs = duration.toMillis()
@@ -294,7 +400,7 @@ private fun getMotionEvent(
         /* deviceId= */ 0,
         /* edgeFlags= */ 0,
         /* source= */ InputDevice.SOURCE_TOUCHSCREEN,
-        /* flags= */ 0
+        /* flags= */ 0,
     )
 }
 
diff --git a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/DeviceHelpers.kt b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/DeviceHelpers.kt
index 343f8266e..0822d9c67 100644
--- a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/DeviceHelpers.kt
+++ b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/DeviceHelpers.kt
@@ -94,12 +94,10 @@ object DeviceHelpers {
         errorProvider: () -> String = { "No object found for any $selectors" },
     ): Pair<UiObject2, BySelector> {
         return waitFor("$selectors objects", timeout, errorProvider) {
-                selectors.firstNotNullOfOrNull { selector ->
-                    uiDevice.findObject(selector)?.let {
-                        it to selector
-                    }
-                }
+            selectors.firstNotNullOfOrNull { selector ->
+                uiDevice.findObject(selector)?.let { it to selector }
             }
+        }
     }
 
     /**
@@ -126,9 +124,7 @@ object DeviceHelpers {
     ): Pair<UiObject2, BySelector> {
         return waitFor("$selectors objects", timeout, errorProvider) {
             selectors.firstNotNullOfOrNull { selector ->
-                findObject(selector)?.let {
-                    it to selector
-                }
+                findObject(selector)?.let { it to selector }
             }
         }
     }
@@ -375,9 +371,11 @@ object DeviceHelpers {
         interpolator: TimeInterpolator = FLING_GESTURE_INTERPOLATOR,
     ) {
         trace("Swiping ($startX,$startY) -> ($endX,$endY)") {
-            BetterSwipe.from(PointF(startX.toFloat(), startY.toFloat()))
-                .to(PointF(endX.toFloat(), endY.toFloat()), interpolator = interpolator)
-                .release()
+            BetterSwipe.swipe(
+                PointF(startX.toFloat(), startY.toFloat()),
+                PointF(endX.toFloat(), endY.toFloat()),
+                interpolator = interpolator,
+            )
         }
     }
 
diff --git a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/LongPressTimeoutExtender.kt b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/LongPressTimeoutExtender.kt
new file mode 100644
index 000000000..1f96256d8
--- /dev/null
+++ b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/LongPressTimeoutExtender.kt
@@ -0,0 +1,111 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package android.platform.uiautomatorhelpers
+
+import android.os.Build
+import android.platform.uiautomatorhelpers.DeviceHelpers.context
+import android.provider.Settings
+import android.util.Log
+import org.junit.runners.model.MultipleFailureException
+
+/**
+ * Functions to set and restore state around a code-block, using a try-finally. The primary purpose
+ * of this utility is to mitigate issues where GestureDetector confuses swipes for long presses due
+ * to the severe performance limitations of Cuttlefish devices. This utility is similar to
+ * [com.android.launcher3.util.rule.ExtendedLongPressTimeoutRule], but it only applies to CF devices
+ * and allows for more fine grained usage.
+ *
+ * @see com.android.launcher3.util.rule.ExtendedLongPressTimeoutRule
+ */
+object LongPressTimeoutExtender {
+
+    /**
+     * Utility to wrap a lambda in before/after. Basically a try/finally, but with lambdas for
+     * before/code block/after. Similar to the @Before/@After annotations but can be used at
+     * code-block level granularity.
+     *
+     * @param before lambda to execute before the code block.
+     * @param codeBlock code block to execute.
+     * @param after lambda to execute after the code block in a try/finally
+     */
+    fun doFinally(before: () -> Unit, codeBlock: () -> Unit, after: () -> Unit) {
+        val errors = mutableListOf<Throwable>()
+        try {
+            before()
+            codeBlock()
+        } catch (t: Throwable) {
+            errors.add(t)
+        } finally {
+            try {
+                after()
+            } catch (t: Throwable) {
+                errors.add(t)
+            }
+        }
+        MultipleFailureException.assertEmpty(errors)
+    }
+
+    /**
+     * Workaround the hack in GestureDetector which forces a long press if the next move event
+     * doesn't arrive before the long press timeout, which seems to happen occaisonally in the
+     * emulator.
+     *
+     * @param codeBlock code block to execute.
+     * @see com.android.launcher3.util.rule.ExtendedLongPressTimeoutRule
+     */
+    fun executeWithExtendedLongPressTimeout(codeBlock: () -> Unit) {
+        val longPressMsec = Settings.Secure.getInt(context.contentResolver, "long_press_timeout")
+
+        doFinally(
+            {
+                if (Build.HARDWARE == CUTTLEFISH_DEVICE) {
+                    Log.d(
+                        TAG,
+                        "set long press timeout to $CUTTLEFISH_LONGPRESS_MSEC, was $longPressMsec",
+                    )
+                    Settings.Secure.putInt(
+                        context.contentResolver,
+                        "long_press_timeout",
+                        CUTTLEFISH_LONGPRESS_MSEC,
+                    )
+                }
+            },
+            { codeBlock() },
+            {
+                if (Build.HARDWARE == CUTTLEFISH_DEVICE) {
+                    Settings.Secure.putInt(
+                        context.contentResolver,
+                        "long_press_timeout",
+                        longPressMsec,
+                    )
+                    val msg =
+                        "restore long press timeout to $longPressMsec, " +
+                            "was $CUTTLEFISH_LONGPRESS_MSEC"
+                    Log.d(TAG, msg)
+                }
+            },
+        )
+    }
+
+    private const val TAG = "StateRestore"
+
+    // Extend the long press timeout to force GestureDetector to recognize swipes
+    // on slow (Cuttlefish) devices.
+    private const val CUTTLEFISH_LONGPRESS_MSEC = 30000
+
+    // Cuttlefish device Build.HARDWARE string.
+    private const val CUTTLEFISH_DEVICE = "cutf_cvm"
+}
diff --git a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/UiObjectUtils.kt b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/UiObjectUtils.kt
index 1fa3e8439..47c94d035 100644
--- a/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/UiObjectUtils.kt
+++ b/libraries/uiautomator-helpers/src/android/platform/uiautomatorhelpers/UiObjectUtils.kt
@@ -136,13 +136,13 @@ private const val MAX_FIND_ELEMENT_ATTEMPT = 15
 fun UiObject2.scrollUntilFound(
     selector: BySelector,
     direction: Direction = Direction.DOWN,
-    condition: (UiObject2) -> Boolean = { true }
+    condition: (UiObject2) -> Boolean = { true },
 ): UiObject2? {
     val (from, to) = getPointsToScroll(direction)
     (0 until MAX_FIND_ELEMENT_ATTEMPT).forEach { _ ->
         val f = findObject(selector)
         if (f?.let { condition(it) } == true) return f
-        BetterSwipe.from(from).to(to, interpolator = FLING_GESTURE_INTERPOLATOR).release()
+        BetterSwipe.swipe(from, to)
     }
     return null
 }
@@ -154,25 +154,25 @@ private fun UiObject2.getPointsToScroll(direction: Direction): Vector2F {
         Direction.DOWN -> {
             Vector2F(
                 PointF(visibleBounds.exactCenterX(), visibleBounds.bottom.toFloat() - 1f),
-                PointF(visibleBounds.exactCenterX(), visibleBounds.top.toFloat() + 1f)
+                PointF(visibleBounds.exactCenterX(), visibleBounds.top.toFloat() + 1f),
             )
         }
         Direction.UP -> {
             Vector2F(
                 PointF(visibleBounds.exactCenterX(), visibleBounds.top.toFloat() + 1f),
-                PointF(visibleBounds.exactCenterX(), visibleBounds.bottom.toFloat() - 1f)
+                PointF(visibleBounds.exactCenterX(), visibleBounds.bottom.toFloat() - 1f),
             )
         }
         Direction.LEFT -> {
             Vector2F(
                 PointF(visibleBounds.left.toFloat() + 1f, visibleBounds.exactCenterY()),
-                PointF(visibleBounds.right.toFloat() - 1f, visibleBounds.exactCenterY())
+                PointF(visibleBounds.right.toFloat() - 1f, visibleBounds.exactCenterY()),
             )
         }
         Direction.RIGHT -> {
             Vector2F(
                 PointF(visibleBounds.right.toFloat() - 1f, visibleBounds.exactCenterY()),
-                PointF(visibleBounds.left.toFloat() + 1f, visibleBounds.exactCenterY())
+                PointF(visibleBounds.left.toFloat() + 1f, visibleBounds.exactCenterY()),
             )
         }
     }
diff --git a/libraries/uinput-device-test-helper/src/android/platform/helpers/uinput/UInputStylus.kt b/libraries/uinput-device-test-helper/src/android/platform/helpers/uinput/UInputStylus.kt
index dbd8f2f63..e76571716 100644
--- a/libraries/uinput-device-test-helper/src/android/platform/helpers/uinput/UInputStylus.kt
+++ b/libraries/uinput-device-test-helper/src/android/platform/helpers/uinput/UInputStylus.kt
@@ -15,7 +15,7 @@
  */
 package android.platform.helpers.uinput
 
-import android.platform.uiautomator_helpers.DeviceHelpers.waitForObj
+import android.platform.uiautomatorhelpers.DeviceHelpers.waitForObj
 import androidx.test.uiautomator.BySelector
 import androidx.test.uiautomator.UiObject2
 
@@ -142,6 +142,7 @@ class UInputStylus(
             sendEventWithValues(inputDeviceId, EV_KEY, BTN_TOUCH, KEY_UP)
         }
     }
+
     private companion object {
         const val KEY_UP = 0
         const val KEY_DOWN = 1
@@ -149,25 +150,14 @@ class UInputStylus(
         const val EV_KEY = 1
         const val EV_ABS = 3
         // EV_KEY
-        val SUPPORTED_ENVBITS =
-            listOf(
-                EV_KEY,
-                EV_ABS,
-            )
+        val SUPPORTED_ENVBITS = listOf(EV_KEY, EV_ABS)
         const val ABS_X = 0
         const val ABS_Y = 1
         const val ABS_PRESSURE = 24
         const val ABS_TILT_X = 26
         const val ABS_TILT_Y = 27
         // UI_SET_ABSBIT
-        val SUPPORTED_ABSBITS =
-            listOf(
-                ABS_X,
-                ABS_Y,
-                ABS_PRESSURE,
-                ABS_TILT_X,
-                ABS_TILT_Y,
-            )
+        val SUPPORTED_ABSBITS = listOf(ABS_X, ABS_Y, ABS_PRESSURE, ABS_TILT_X, ABS_TILT_Y)
         const val BTN_TOOL_PEN = 320
         const val BTN_TOUCH = 330
         const val BTN_STYLUS = 331
@@ -175,13 +165,7 @@ class UInputStylus(
         const val KEY_JOURNAL = 578
         // UI_SET_KEYBIT
         val SUPPORTED_KEYBITS =
-            listOf(
-                BTN_TOOL_PEN,
-                BTN_TOUCH,
-                BTN_STYLUS,
-                BTN_STYLUS2,
-                KEY_JOURNAL,
-            )
+            listOf(BTN_TOOL_PEN, BTN_TOUCH, BTN_STYLUS, BTN_STYLUS2, KEY_JOURNAL)
         // Using the below combination of product and vendor ID allows us to remap KEY_JOURNAL to
         // STYLUS_BUTTON_TAIL. This is because STYLUS_BUTTON_TAIL is not a proper Linux input event
         // code yet and we remap the buttons for generic android stylus which is represented by the
diff --git a/robolab/OWNERS b/robolab/OWNERS
index 197c425de..328e070f8 100644
--- a/robolab/OWNERS
+++ b/robolab/OWNERS
@@ -1,5 +1,4 @@
-yuwu@google.com
 rexhoffman@google.com
 congxiliu@google.com
 ramperi@google.com
-ihcinihsdk@google.com
\ No newline at end of file
+ihcinihsdk@google.com
diff --git a/robolab/roboStandaloneProj/tests/Android.bp b/robolab/roboStandaloneProj/tests/Android.bp
index c782722a4..1821d1881 100644
--- a/robolab/roboStandaloneProj/tests/Android.bp
+++ b/robolab/roboStandaloneProj/tests/Android.bp
@@ -40,8 +40,6 @@ android_robolectric_test {
 
     instrumentation_for: "MyRoboApplication",
 
-    upstream: true,
-
     strict_mode: false,
 }
 
@@ -64,5 +62,4 @@ android_robolectric_test {
 
     instrumentation_for: "MyRoboApplication",
 
-    upstream: true,
 }
diff --git a/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityStrictTest.java b/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityStrictTest.java
index cc0e4f748..3ca463916 100644
--- a/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityStrictTest.java
+++ b/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityStrictTest.java
@@ -34,6 +34,9 @@ public class WelcomeActivityStrictTest {
 
     @Test
     public void checkMath() throws Exception {
+        System.out.println("\n\nSystem Properties:");
+        System.getProperties().forEach((key, value) -> System.out.println(key + ": " + value));
+        assertEquals(System.getProperty("robolectric.strict.mode"), "true");
         assertEquals(1 + 1, 2);
     }
 }
diff --git a/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityTest.java b/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityTest.java
index f0e1b2a53..6fbaeffa4 100644
--- a/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityTest.java
+++ b/robolab/roboStandaloneProj/tests/src/com/android/myroboapplication/WelcomeActivityTest.java
@@ -17,6 +17,7 @@
 package com.android.myroboapplication;
 
 import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNotEquals;
 
 import android.content.Intent;
 
@@ -36,11 +37,14 @@ public class WelcomeActivityTest {
 
     @Test
     public void clickingLogin_shouldStartLoginActivity() throws Exception {
-        ActivityController<WelcomeActivity> controller =
+        System.out.println("\n\nSystem Properties:");
+        System.getProperties().forEach((key, value) -> System.out.println(key + ": " + value));
+        assertNotEquals(System.getProperty("robolectric.strict.mode"), "true");
+
+       ActivityController<WelcomeActivity> controller =
                 Robolectric.buildActivity(WelcomeActivity.class);
         controller.setup(); // Moves Activity to RESUMED state
         WelcomeActivity activity = controller.get();
-
         activity.findViewById(R.id.login).performClick();
         Intent expectedIntent = new Intent(activity, LoginActivity.class);
         Intent actual = ShadowApplication.getInstance().getNextStartedActivity();
diff --git a/tests/apphealth/scenarios/OWNERS b/tests/apphealth/scenarios/OWNERS
index d1109a70f..b7c393c6e 100644
--- a/tests/apphealth/scenarios/OWNERS
+++ b/tests/apphealth/scenarios/OWNERS
@@ -1,5 +1,4 @@
 # Use this reviewer by default.
-android-crystalball-eng+reviews@google.com
 
 # If direct review needed.
 gelanchezhian@google.com
diff --git a/tests/automotive/OWNERS b/tests/automotive/OWNERS
index 141351fa9..b3254c698 100644
--- a/tests/automotive/OWNERS
+++ b/tests/automotive/OWNERS
@@ -1 +1,7 @@
 # Bug component: 95300
+
+schinchalkar@google.com
+rrwoods@google.com
+zhaomingyin@google.com
+rustamx@google.com
+per-file health/* = ravigutala@google.com, ivankozlov@google.com
\ No newline at end of file
diff --git a/tests/automotive/functional/dialer/src/android/platform/tests/DialTest.java b/tests/automotive/functional/dialer/src/android/platform/tests/DialTest.java
index 8af2cd8fe..dfdac513e 100644
--- a/tests/automotive/functional/dialer/src/android/platform/tests/DialTest.java
+++ b/tests/automotive/functional/dialer/src/android/platform/tests/DialTest.java
@@ -197,12 +197,7 @@ public class DialTest {
     @Test
     public void testSearchContactByName() {
         mDialerHelper.get().open();
-        String dialContactByName = mSearchContactName.get();
-        mDialerHelper.get().searchContactsByName(dialContactByName);
-        assertEquals(
-                "Cannot find contact",
-                dialContactByName,
-                mDialerHelper.get().getFirstSearchResult());
+        mDialerHelper.get().searchContacts();
     }
 
     @Test
diff --git a/tests/automotive/functional/locationstatusbar/src/android/platform/tests/LocationAccessTest.java b/tests/automotive/functional/locationstatusbar/src/android/platform/tests/LocationAccessTest.java
new file mode 100644
index 000000000..6b27804ca
--- /dev/null
+++ b/tests/automotive/functional/locationstatusbar/src/android/platform/tests/LocationAccessTest.java
@@ -0,0 +1,85 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.platform.tests;
+
+import static junit.framework.Assert.assertTrue;
+
+import android.platform.helpers.HelperAccessor;
+import android.platform.helpers.IAutoSettingHelper;
+import android.platform.helpers.IAutoSettingsLocationHelper;
+import android.platform.helpers.SettingsConstants;
+
+import androidx.test.runner.AndroidJUnit4;
+
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+@RunWith(AndroidJUnit4.class)
+public class LocationAccessTest {
+
+    private HelperAccessor<IAutoSettingsLocationHelper> mSettingLocationHelper;
+    private HelperAccessor<IAutoSettingHelper> mSettingHelper;
+
+    public LocationAccessTest() {
+        mSettingHelper = new HelperAccessor<>(IAutoSettingHelper.class);
+        mSettingLocationHelper = new HelperAccessor<>(IAutoSettingsLocationHelper.class);
+    }
+
+    @Before
+    public void setup() {
+        mSettingHelper.get().openSetting(SettingsConstants.LOCATION_SETTINGS);
+        assertTrue(
+                "Location settings did not open",
+                mSettingHelper.get().checkMenuExists("Location access"));
+        mSettingLocationHelper.get().locationAccess();
+        boolean defaultState = mSettingLocationHelper.get().isLocationOn();
+        mSettingLocationHelper.get().toggleLocation(!defaultState);
+        mSettingLocationHelper.get().toggleLocation(defaultState);
+        mSettingHelper.get().pressSettingsBackNavIcon();
+    }
+
+    @Test
+    public void testAppLevelPermission() {
+        mSettingLocationHelper.get().openAppLevelPermissions();
+        assertTrue(
+                "App level permission is not displayed",
+                mSettingHelper.get().checkMenuExists("Allowed all the time"));
+        assertTrue(
+                "Recently accessed app is not displaying",
+                mSettingHelper.get().checkMenuExists("Maps"));
+    }
+
+    @Test
+    public void testMapsLocationPermissionPage() {
+        mSettingLocationHelper.get().openMapsInRecentlyAccessed();
+        assertTrue(
+                "Maps location permission page in recently accessed is not displayed",
+                mSettingHelper.get().checkMenuExists("Location permission"));
+    }
+
+    @Test
+    public void testViewAll() {
+        mSettingLocationHelper.get().clickViewAll();
+        assertTrue(
+                "Recently accessed view all page is not launched",
+                mSettingHelper.get().checkMenuExists("Recently accessed"));
+        assertTrue(
+                "Recently accessed app is not displaying",
+                mSettingHelper.get().checkMenuExists("Maps"));
+    }
+}
diff --git a/tests/automotive/functional/mediacenter/src/android/platform/tests/MediaTestAppTest.java b/tests/automotive/functional/mediacenter/src/android/platform/tests/MediaTestAppTest.java
index c2f5317d3..0270a0b3d 100644
--- a/tests/automotive/functional/mediacenter/src/android/platform/tests/MediaTestAppTest.java
+++ b/tests/automotive/functional/mediacenter/src/android/platform/tests/MediaTestAppTest.java
@@ -29,6 +29,7 @@ import android.platform.test.option.StringOption;
 
 import androidx.test.runner.AndroidJUnit4;
 
+import org.junit.After;
 import org.junit.BeforeClass;
 import org.junit.ClassRule;
 import org.junit.Test;
@@ -38,11 +39,14 @@ import org.junit.runner.RunWith;
 public class MediaTestAppTest {
     private static final String MEDIA_APP = "media-app";
     private static final String TEST_MEDIA_APP = "Test Media App";
+    private static final String DEFAULT_SONG_NAME = "A normal 1H song";
 
     @ClassRule
     public static StringOption mMediaTestApp =
             new StringOption(MEDIA_APP).setRequired(false);
 
+    public static String mDefaultSongName = new String(DEFAULT_SONG_NAME);
+
     private static HelperAccessor<IAutoMediaHelper> sMediaCenterHelper =
             new HelperAccessor<>(IAutoMediaHelper.class);
     private static HelperAccessor<IAutoTestMediaAppHelper> sTestMediaAppHelper =
@@ -61,27 +65,38 @@ public class MediaTestAppTest {
             mediaAppName = mMediaTestApp.get();
         }
         sMediaCenterHelper.get().openApp(mediaAppName);
-        assertTrue("Not a media app",
-                sMediaCenterHelper.get().getMediaAppTitle().equals(mediaAppName));
         sMediaCenterHelper.get().openMediaAppSettingsPage();
         sTestMediaAppHelper.get().loadMediaInLocalMediaTestApp();
     }
 
+    @After
+    public void goMinimizeNowPlaying() {
+        sMediaCenterHelper.get().minimizeNowPlaying();
+    }
+
     @Test
     public void testPlayPauseMedia() {
         sMediaCenterHelper.get().playMedia();
         assertTrue("Song not playing.", sMediaCenterHelper.get().isPlaying());
+        sMediaCenterHelper.get().minimizeNowPlaying();
+        sMediaCenterHelper.get().selectMediaTrack(mDefaultSongName);
         sMediaCenterHelper.get().pauseMedia();
         assertFalse("Song not paused.", sMediaCenterHelper.get().isPlaying());
     }
 
     @Test
-    public void testNextTrack() {
+    public void testNextPreviousTrack() {
         String currentSong = sMediaCenterHelper.get().getMediaTrackName();
         sMediaCenterHelper.get().clickNextTrack();
         assertNotEquals(
                 "Song playing has not been changed",
                 currentSong,
                 sMediaCenterHelper.get().getMediaTrackName());
+        currentSong = sMediaCenterHelper.get().getMediaTrackName();
+        sMediaCenterHelper.get().clickPreviousTrack();
+        assertNotEquals(
+                "Song playing has not been changed",
+                currentSong,
+                sMediaCenterHelper.get().getMediaTrackName());
     }
 }
diff --git a/tests/automotive/functional/mediacenter/src/android/platform/tests/OpenAppFromMediaCenterTest.java b/tests/automotive/functional/mediacenter/src/android/platform/tests/OpenAppFromMediaCenterTest.java
index 2ec7d11e3..873dec959 100644
--- a/tests/automotive/functional/mediacenter/src/android/platform/tests/OpenAppFromMediaCenterTest.java
+++ b/tests/automotive/functional/mediacenter/src/android/platform/tests/OpenAppFromMediaCenterTest.java
@@ -26,6 +26,7 @@ import android.platform.test.option.StringOption;
 
 import androidx.test.runner.AndroidJUnit4;
 
+import org.junit.After;
 import org.junit.ClassRule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -57,9 +58,19 @@ public class OpenAppFromMediaCenterTest {
         mAutoAppGridHelper = new HelperAccessor<>(IAutoAppGridHelper.class);
     }
 
+    @After
+    public void goBackToHomeScreen() {
+        mMediaCenterHelper.get().exit();
+    }
 
     @Test
     public void testOpenMediaAppFromMediaWidget() {
+        mAutoHomeHelper.get().openMediaWidget();
+        assertTrue("Radio app not launched", mMediaCenterHelper.get().isRadioAppLaunched());
+    }
+
+    @Test
+    public void testOpenMediaAppFromMediaAppAppgrid() {
         // Use preinstalled "Bluetooth Audio" app
         mAutoAppGridHelper.get().open();
         assertTrue("AppGrid is not open", mAutoAppGridHelper.get().isAppInForeground());
diff --git a/tests/automotive/functional/multiuser/src/android/platform/tests/EditAdminName.java b/tests/automotive/functional/multiuser/src/android/platform/tests/EditAdminName.java
new file mode 100644
index 000000000..839f32ce9
--- /dev/null
+++ b/tests/automotive/functional/multiuser/src/android/platform/tests/EditAdminName.java
@@ -0,0 +1,68 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package android.platform.tests;
+
+import static junit.framework.Assert.assertTrue;
+
+import android.content.pm.UserInfo;
+import android.platform.helpers.HelperAccessor;
+import android.platform.helpers.IAutoSettingHelper;
+import android.platform.helpers.IAutoUserHelper;
+import android.platform.helpers.MultiUserHelper;
+import android.platform.helpers.SettingsConstants;
+
+import androidx.test.runner.AndroidJUnit4;
+
+import org.junit.After;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+
+@RunWith(AndroidJUnit4.class)
+public class EditAdminName {
+
+    public String INITIAL_USERNAME;
+    public static final String EDIT_USERNAME = "editedName";
+    private final MultiUserHelper mMultiUserHelper = MultiUserHelper.getInstance();
+    private HelperAccessor<IAutoUserHelper> mUsersHelper;
+    private HelperAccessor<IAutoSettingHelper> mSettingHelper;
+
+    public EditAdminName() {
+        mUsersHelper = new HelperAccessor<>(IAutoUserHelper.class);
+        mSettingHelper = new HelperAccessor<>(IAutoSettingHelper.class);
+    }
+
+    @Before
+    public void getUserNameFromSettings() {
+        UserInfo initialUser = mMultiUserHelper.getCurrentForegroundUserInfo();
+        INITIAL_USERNAME = initialUser.name;
+    }
+
+    @After
+    public void goBackToHomeScreen() {
+        mUsersHelper.get().editUserName(INITIAL_USERNAME);
+        mSettingHelper.get().goBackToSettingsScreen();
+    }
+
+    @Test
+    public void testEditAdminName() {
+        mSettingHelper.get().openSetting(SettingsConstants.PROFILE_ACCOUNT_SETTINGS);
+        mUsersHelper.get().editUserName(EDIT_USERNAME);
+        UserInfo newUser = mMultiUserHelper.getCurrentForegroundUserInfo();
+        assertTrue("Username is not changed", EDIT_USERNAME.equals(newUser.name));
+    }
+}
diff --git a/tests/automotive/functional/navigationbar/Android.bp b/tests/automotive/functional/navigationbar/Android.bp
index 704125c63..0f9e6ad67 100644
--- a/tests/automotive/functional/navigationbar/Android.bp
+++ b/tests/automotive/functional/navigationbar/Android.bp
@@ -27,6 +27,7 @@ android_test {
         "automotive-facet-bar-helper",
         "automotive-utility-helper",
         "app-helpers-auto-interfaces",
+        "automotive-status-bar-helper",
         "androidx.test.uiautomator_uiautomator",
         "hamcrest-library",
         "automotive-home-helper",
diff --git a/tests/automotive/functional/navigationbar/src/android/platform/tests/BrightnessPaletteTest.java b/tests/automotive/functional/navigationbar/src/android/platform/tests/BrightnessPaletteTest.java
index 10ade2a65..661fc5992 100644
--- a/tests/automotive/functional/navigationbar/src/android/platform/tests/BrightnessPaletteTest.java
+++ b/tests/automotive/functional/navigationbar/src/android/platform/tests/BrightnessPaletteTest.java
@@ -16,10 +16,12 @@
 
 package android.platform.tests;
 
+import static junit.framework.Assert.assertFalse;
 import static junit.framework.Assert.assertTrue;
 
 import android.platform.helpers.HelperAccessor;
 import android.platform.helpers.IAutoHomeHelper;
+import android.platform.helpers.IAutoStatusBarHelper;
 
 import androidx.test.runner.AndroidJUnit4;
 
@@ -32,9 +34,11 @@ import org.junit.runner.RunWith;
 public class BrightnessPaletteTest {
 
     private HelperAccessor<IAutoHomeHelper> mHomeHelper;
+    private HelperAccessor<IAutoStatusBarHelper> mStatusBarHelper;
 
     public BrightnessPaletteTest() {
         mHomeHelper = new HelperAccessor<>(IAutoHomeHelper.class);
+        mStatusBarHelper = new HelperAccessor<>(IAutoStatusBarHelper.class);
     }
 
     @Before
@@ -43,16 +47,36 @@ public class BrightnessPaletteTest {
     }
 
     @Test
-    public void testIfBrightnessPaletteExist() {
+    public void testBrightnessPaletteIsDisplayed() {
         assertTrue(
                 "Brightness palette did not open", mHomeHelper.get().hasDisplayBrightessPalette());
     }
 
     @Test
-    public void testIfAdaptiveBrightnessSettingExist() {
+    public void testAdaptiveBrightnessSettingIsDisplayed() {
         assertTrue("Adaptive brightness did not open", mHomeHelper.get().hasAdaptiveBrightness());
     }
 
+    @Test
+    public void testAdaptiveBrightnessToggleSwitch() {
+        // Default Adaptive brightness is OFF
+        assertFalse(
+                "Adaptive brightness toggle switch in ON ",
+                mStatusBarHelper.get().isAdaptiveBrightnessOn());
+        // Turn On Adaptive Brightness Toggle Switch
+        mStatusBarHelper.get().clickOnAdaptiveBrightnessToggleSwitch();
+        // Verify the Adaptive brightness Turned ON
+        assertTrue(
+                "Adaptive brightness toggle switch in OFF",
+                mStatusBarHelper.get().isAdaptiveBrightnessOn());
+        // return the Adaptive brightness switch to default state "OFF"
+        mStatusBarHelper.get().clickOnAdaptiveBrightnessToggleSwitch();
+        // Verify Default Adaptive brightness state is "OFF"
+        assertFalse(
+                "Adaptive brightness toggle switch in ON ",
+                mStatusBarHelper.get().isAdaptiveBrightnessOn());
+    }
+
     @After
     public void goToHomeScreen() {
         mHomeHelper.get().open();
diff --git a/tests/automotive/functional/notifications/src/android/platform/tests/NotificationTest.java b/tests/automotive/functional/notifications/src/android/platform/tests/NotificationTest.java
index 7f6c82c11..0c8be2128 100644
--- a/tests/automotive/functional/notifications/src/android/platform/tests/NotificationTest.java
+++ b/tests/automotive/functional/notifications/src/android/platform/tests/NotificationTest.java
@@ -69,7 +69,7 @@ public class NotificationTest {
         mNotificationHelper.get().exit();
         assertFalse(
                 "Notifications were not cleared.",
-                mNotificationHelper.get().checkNotificationExists(NOTIFICATION_TITLE));
+                mNotificationHelper.get().isNotificationDisplayedInCenterWithTitle(NOTIFICATION_TITLE));
     }
 
     @Test
@@ -90,7 +90,7 @@ public class NotificationTest {
         mNotificationHelper.get().removeNotification(NOTIFICATION_TITLE);
         assertFalse(
                 "Notifications were not cleared.",
-                mNotificationHelper.get().checkNotificationExists(NOTIFICATION_TITLE));
+                mNotificationHelper.get().isNotificationDisplayedInCenterWithTitle(NOTIFICATION_TITLE));
     }
 
     @Test
diff --git a/tests/automotive/functional/settings/src/android/platform/tests/PrivacySettingVerifyUIElementsTest.java b/tests/automotive/functional/settings/src/android/platform/tests/PrivacySettingVerifyUIElementsTest.java
index 0fabff2c7..98c352311 100644
--- a/tests/automotive/functional/settings/src/android/platform/tests/PrivacySettingVerifyUIElementsTest.java
+++ b/tests/automotive/functional/settings/src/android/platform/tests/PrivacySettingVerifyUIElementsTest.java
@@ -16,7 +16,6 @@
 
 package android.platform.tests;
 
-import static junit.framework.Assert.assertFalse;
 import static junit.framework.Assert.assertTrue;
 
 import android.platform.helpers.AutomotiveConfigConstants;
@@ -65,10 +64,6 @@ public class PrivacySettingVerifyUIElementsTest {
         assertTrue(
                 "Microphone settings did not open",
                 mSettingHelper.get().checkMenuExists("Microphone"));
-        String currentTitle = mSettingHelper.get().getPageTitleText();
-        mSettingsUIHelper.get().pressBackButton();
-        String newTitle = mSettingHelper.get().getPageTitleText();
-        assertFalse("Back button is not working", currentTitle.equals(newTitle));
     }
 
     @Test
@@ -80,10 +75,6 @@ public class PrivacySettingVerifyUIElementsTest {
         assertTrue(
                 "Location settings did not open",
                 mSettingHelper.get().checkMenuExists("Location access"));
-        String currentTitle = mSettingHelper.get().getPageTitleText();
-        mSettingsUIHelper.get().pressBackButton();
-        String newTitle = mSettingHelper.get().getPageTitleText();
-        assertFalse("Back button is not working", currentTitle.equals(newTitle));
     }
 
     @Test
@@ -95,10 +86,6 @@ public class PrivacySettingVerifyUIElementsTest {
         assertTrue(
                 "App permissions settings did not open",
                 mSettingHelper.get().checkMenuExists("Privacy dashboard"));
-        String currentTitle = mSettingHelper.get().getPageTitleText();
-        mSettingsUIHelper.get().pressBackButton();
-        String newTitle = mSettingHelper.get().getPageTitleText();
-        assertFalse("Back button is not working", currentTitle.equals(newTitle));
     }
 
     @Test
@@ -112,10 +99,6 @@ public class PrivacySettingVerifyUIElementsTest {
         assertTrue(
                 "Infotainment system data settings did not open",
                 mSettingHelper.get().checkMenuExists("Delete your profile"));
-        String currentTitle = mSettingHelper.get().getPageTitleText();
-        mSettingsUIHelper.get().pressBackButton();
-        String newTitle = mSettingHelper.get().getPageTitleText();
-        assertFalse("Back button is not working", currentTitle.equals(newTitle));
     }
 
     @Test
diff --git a/tests/automotive/functional/settings/src/android/platform/tests/SettingTest.java b/tests/automotive/functional/settings/src/android/platform/tests/SettingTest.java
index ee41f2cea..cc6cf87da 100644
--- a/tests/automotive/functional/settings/src/android/platform/tests/SettingTest.java
+++ b/tests/automotive/functional/settings/src/android/platform/tests/SettingTest.java
@@ -19,9 +19,11 @@ package android.platform.tests;
 import static junit.framework.Assert.assertFalse;
 import static junit.framework.Assert.assertTrue;
 
+import android.platform.helpers.AutomotiveConfigConstants;
 import android.platform.helpers.HelperAccessor;
 import android.platform.helpers.IAutoAppInfoSettingsHelper;
 import android.platform.helpers.IAutoSettingHelper;
+import android.platform.helpers.IAutoUISettingsHelper;
 import android.platform.helpers.SettingsConstants;
 
 import androidx.test.runner.AndroidJUnit4;
@@ -35,8 +37,10 @@ public class SettingTest {
     private static final int DAY_MODE_VALUE = 0;
     private HelperAccessor<IAutoAppInfoSettingsHelper> mAppInfoSettingsHelper;
     private HelperAccessor<IAutoSettingHelper> mSettingHelper;
+    private HelperAccessor<IAutoUISettingsHelper> mSettingsUIHelper;
 
     public SettingTest() throws Exception {
+        mSettingsUIHelper = new HelperAccessor<>(IAutoUISettingsHelper.class);
         mAppInfoSettingsHelper = new HelperAccessor<>(IAutoAppInfoSettingsHelper.class);
         mSettingHelper = new HelperAccessor<>(IAutoSettingHelper.class);
     }
@@ -60,7 +64,9 @@ public class SettingTest {
         mSettingHelper.get().openSetting(SettingsConstants.SOUND_SETTINGS);
         assertTrue(
                 "Sound setting did not open",
-                mSettingHelper.get().checkMenuExists("In-call volume"));
+                mSettingsUIHelper
+                        .get()
+                        .hasUIElement(AutomotiveConfigConstants.SOUND_SETTING_INCALL));
     }
 
     @Test
diff --git a/tests/automotive/functional/statusbar/src/android/platform/tests/CurrentDateTimeTest.java b/tests/automotive/functional/statusbar/src/android/platform/tests/CurrentDateTimeTest.java
index ff2b39396..f8fa809ba 100644
--- a/tests/automotive/functional/statusbar/src/android/platform/tests/CurrentDateTimeTest.java
+++ b/tests/automotive/functional/statusbar/src/android/platform/tests/CurrentDateTimeTest.java
@@ -20,14 +20,19 @@ import static junit.framework.Assert.assertEquals;
 
 import android.platform.helpers.HelperAccessor;
 import android.platform.helpers.IAutoStatusBarHelper;
+import android.platform.test.rules.ConditionalIgnore;
+import android.platform.test.rules.ConditionalIgnoreRule;
+import android.platform.test.rules.IgnoreOnPortrait;
 
 import androidx.test.runner.AndroidJUnit4;
 
+import org.junit.Rule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 
 @RunWith(AndroidJUnit4.class)
 public class CurrentDateTimeTest {
+    @Rule public ConditionalIgnoreRule rule = new ConditionalIgnoreRule();
 
     private HelperAccessor<IAutoStatusBarHelper> mStatusBarHelper;
 
@@ -36,6 +41,7 @@ public class CurrentDateTimeTest {
     }
 
     @Test
+    @ConditionalIgnore(condition = IgnoreOnPortrait.class)
     public void testCurrentTime() {
         assertEquals(
                 "Current local Time",
diff --git a/tests/automotive/functional/uxrestriction/src/android/platform/tests/UxRestrictionTest.java b/tests/automotive/functional/uxrestriction/src/android/platform/tests/UxRestrictionTest.java
index 29e3b4f2f..6d6177ebb 100644
--- a/tests/automotive/functional/uxrestriction/src/android/platform/tests/UxRestrictionTest.java
+++ b/tests/automotive/functional/uxrestriction/src/android/platform/tests/UxRestrictionTest.java
@@ -19,6 +19,7 @@ package android.platform.tests;
 import static junit.framework.Assert.assertFalse;
 import static junit.framework.Assert.assertTrue;
 
+import android.platform.helpers.AutomotiveConfigConstants;
 import android.platform.helpers.HelperAccessor;
 import android.platform.helpers.IAutoAppGridHelper;
 import android.platform.helpers.IAutoSettingHelper;
@@ -64,12 +65,14 @@ public class UxRestrictionTest {
     @Test
     public void testRestrictedSoundSettings() {
         mSettingHelper.get().openSetting(SettingsConstants.SOUND_SETTINGS);
-        String currentTitle = mSettingHelper.get().getPageTitleText();
+        String currentTitle = mSettingHelper.get().getSettingsPageTitleText();
         assertTrue(
                 "Sound setting did not open",
-                mSettingHelper.get().checkMenuExists("In-call volume"));
+                mSettingHelper
+                        .get()
+                        .scrollAndCheckMenuExists(AutomotiveConfigConstants.SOUND_SETTING_INCALL));
         mSettingHelper.get().openMenuWith("In-call Volume");
-        String newTitle = mSettingHelper.get().getPageTitleText();
+        String newTitle = mSettingHelper.get().getSettingsPageTitleText();
         assertTrue("Phone ringtone setting is not disabled", currentTitle.equals(newTitle));
     }
 
@@ -92,55 +95,55 @@ public class UxRestrictionTest {
         assertTrue(
                 "Bluetooth Setting did not open",
                 mSettingHelper.get().checkMenuExists("Pair new device"));
-        String currentTitle = mSettingHelper.get().getPageTitleText();
+        String currentTitle = mSettingHelper.get().getSettingsPageTitleText();
         mSettingHelper.get().openMenuWith("Pair new device");
-        String newTitle = mSettingHelper.get().getPageTitleText();
+        String newTitle = mSettingHelper.get().getSettingsPageTitleText();
         assertTrue("Bluetooth setting is not disabled", currentTitle.equals(newTitle));
     }
 
     @Test
     public void testRestrictedAppSettings() {
         mSettingHelper.get().openFullSettings();
-        String currentTitle = mSettingHelper.get().getPageTitleText();
+        String currentTitle = mSettingHelper.get().getSettingsPageTitleText();
         mSettingHelper.get().openSetting(SettingsConstants.APPS_SETTINGS);
         assertFalse("Apps is not disabled", mSettingHelper.get().checkMenuExists("View all"));
-        String newTitle = mSettingHelper.get().getPageTitleText();
+        String newTitle = mSettingHelper.get().getSettingsPageTitleText();
         assertTrue("Apps & notification settings is not disabled", currentTitle.equals(newTitle));
     }
 
     @Test
     public void testRestrictedProfilesAndAccountsSettings() {
         mSettingHelper.get().openFullSettings();
-        String currentTitle = mSettingHelper.get().getPageTitleText();
+        String currentTitle = mSettingHelper.get().getSettingsPageTitleText();
         mSettingHelper.get().openSetting(SettingsConstants.PROFILE_ACCOUNT_SETTINGS);
         assertFalse(
                 "Profiles and accounts settings is not disabled",
                 mSettingHelper.get().checkMenuExists("Add a profile"));
-        String newTitle = mSettingHelper.get().getPageTitleText();
+        String newTitle = mSettingHelper.get().getSettingsPageTitleText();
         assertTrue("Profiles and accounts settings is not disabled", currentTitle.equals(newTitle));
     }
 
     @Test
     public void testRestrictedSecuritySettings() {
         mSettingHelper.get().openFullSettings();
-        String currentTitle = mSettingHelper.get().getPageTitleText();
+        String currentTitle = mSettingHelper.get().getSettingsPageTitleText();
         mSettingHelper.get().openSetting(SettingsConstants.SECURITY_SETTINGS);
         assertFalse(
                 "Security settings is not disabled",
                 mSettingHelper.get().checkMenuExists("Profile lock"));
-        String newTitle = mSettingHelper.get().getPageTitleText();
+        String newTitle = mSettingHelper.get().getSettingsPageTitleText();
         assertTrue("Security settings is not disabled", currentTitle.equals(newTitle));
     }
 
     @Test
     public void testRestrictedSystemSettings() {
         mSettingHelper.get().openFullSettings();
-        String currentTitle = mSettingHelper.get().getPageTitleText();
+        String currentTitle = mSettingHelper.get().getSettingsPageTitleText();
         mSettingHelper.get().openSetting(SettingsConstants.SYSTEM_SETTINGS);
         assertFalse(
                 "System settings is not disabled",
                 mSettingHelper.get().checkMenuExists("Languages & input"));
-        String newTitle = mSettingHelper.get().getPageTitleText();
+        String newTitle = mSettingHelper.get().getSettingsPageTitleText();
         assertTrue("System settings is not disabled", currentTitle.equals(newTitle));
     }
 }
diff --git a/tests/automotive/health/boottime/src/android/boottime/BootTimeTest.java b/tests/automotive/health/boottime/src/android/boottime/BootTimeTest.java
index b46729cae..72e657cb4 100644
--- a/tests/automotive/health/boottime/src/android/boottime/BootTimeTest.java
+++ b/tests/automotive/health/boottime/src/android/boottime/BootTimeTest.java
@@ -132,6 +132,11 @@ public class BootTimeTest extends BaseHostJUnit4Test {
                             + "and not needed for the second run especially in local testing.")
     private boolean mSkipPinSetup = false;
 
+    @Option(
+            name = "enable-perfetto-trace",
+            description = "Enable perfetto trace collection during the reboot. True by default.")
+    private boolean mEnablePerfettoTrace = true;
+
     private LogcatReceiver mRebootLogcatReceiver = null;
     private IRemoteAndroidTestRunner mPostBootTestRunner = null;
 
@@ -193,7 +198,9 @@ public class BootTimeTest extends BaseHostJUnit4Test {
         CLog.v("Successive boot iteration %d", iteration);
         getDevice().enableAdbRoot();
         // Property used for collecting the perfetto trace file on boot.
-        getDevice().executeShellCommand("setprop persist.debug.perfetto.boottrace 1");
+        String setPerfettoPropValue = mEnablePerfettoTrace ? "1" : "\"\"";
+        String perfettoPropCmd = String.format("setprop persist.debug.perfetto.boottrace %s", setPerfettoPropValue);
+        getDevice().executeShellCommand(perfettoPropCmd);
         if (mForceF2FsShutdown) {
             forseF2FsShutdown();
         }
diff --git a/tests/automotive/health/multiuser/tests/Android.bp b/tests/automotive/health/multiuser/tests/Android.bp
index 6bf87b3f9..c6ee422d6 100644
--- a/tests/automotive/health/multiuser/tests/Android.bp
+++ b/tests/automotive/health/multiuser/tests/Android.bp
@@ -17,6 +17,13 @@ package {
     default_applicable_licenses: ["Android-Apache-2.0"],
 }
 
+filegroup {
+    name: "perfetto_configs",
+    srcs: [
+        "configs/*",
+    ],
+}
+
 android_test {
     name: "AndroidAutomotiveMultiuserScenarioTests",
     min_sdk_version: "24",
@@ -46,5 +53,8 @@ android_test {
         "ats",
     ],
     privileged: true,
-    data: [":perfetto_artifacts"],
+    data: [
+        ":perfetto_artifacts",
+        ":perfetto_configs",
+    ],
 }
diff --git a/tests/automotive/health/multiuser/tests/configs/trace_config_light.textproto b/tests/automotive/health/multiuser/tests/configs/trace_config_light.textproto
new file mode 100644
index 000000000..1cf6765b6
--- /dev/null
+++ b/tests/automotive/health/multiuser/tests/configs/trace_config_light.textproto
@@ -0,0 +1,63 @@
+# Copyright (C) 2024 The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+
+# proto-message: TraceConfig
+
+buffers: {
+  size_kb: 260096
+  fill_policy: RING_BUFFER
+}
+buffers: {
+  size_kb: 2048
+  fill_policy: RING_BUFFER
+}
+data_sources: {
+  config {
+    name: "linux.process_stats"
+    target_buffer: 1
+    process_stats_config {
+      scan_all_processes_on_start: true
+      proc_stats_poll_ms: 200
+    }
+  }
+}
+data_sources: {
+  config {
+    name: "android.log"
+    android_log_config {
+    }
+  }
+}
+data_sources: {
+  config {
+    name: "linux.ftrace"
+    ftrace_config {
+      atrace_categories: "am"
+      atrace_categories: "ss"
+      ftrace_events: "sched/sched_switch"
+      ftrace_events: "sched/sched_wakeup"
+      ftrace_events: "sched/sched_wakeup_new"
+    }
+  }
+}
+# No recording time limit (press CTRL+C to stop recording).
+# Alternatively: uncomment the line below to set a time limit.
+# duration_ms: 15000
+write_into_file: true
+file_write_period_ms: 5000
+max_file_size_bytes: 100000000000
+flush_period_ms: 30000
+incremental_state_config {
+  clear_period_ms: 5000
+}
diff --git a/tests/automotive/health/property/src/android/platform/test/scenario/stress/CarPropertyManagerBenchmarkTest.java b/tests/automotive/health/property/src/android/platform/test/scenario/stress/CarPropertyManagerBenchmarkTest.java
index 7b41bda91..fabbf5a23 100644
--- a/tests/automotive/health/property/src/android/platform/test/scenario/stress/CarPropertyManagerBenchmarkTest.java
+++ b/tests/automotive/health/property/src/android/platform/test/scenario/stress/CarPropertyManagerBenchmarkTest.java
@@ -39,6 +39,7 @@ import org.junit.runner.RunWith;
 
 import java.io.File;
 import java.io.FileWriter;
+import java.util.List;
 import java.util.Random;
 import java.util.concurrent.ConcurrentLinkedQueue;
 import java.util.concurrent.CountDownLatch;
@@ -51,8 +52,6 @@ public class CarPropertyManagerBenchmarkTest {
     private static final String TAG = CarPropertyManagerBenchmarkTest.class.getSimpleName();
     private static final int NUM_TASKS = 30;
     private static final int NUM_RUNS = 30;
-    private static final int MIN_TEMP = 16;
-    private static final int MAX_TEMP = 25;
     private CarPropertyManager mCarPropertyManager;
     private Context mContext;
     @Rule public TestLogData logs = new TestLogData();
@@ -106,6 +105,17 @@ public class CarPropertyManagerBenchmarkTest {
                 mCarPropertyManager.getCarPropertyConfig(HVAC_TEMPERATURE_SET);
         assumeTrue("Cannot set hvacTemp", hvacTempSetConfig != null);
         int areaId = hvacTempSetConfig.getAreaIdConfigs().get(0).getAreaId();
+        List<Integer> configArray = hvacTempSetConfig.getConfigArray();
+        Float minTemp;
+        Float maxTemp;
+        if (configArray.isEmpty()) {
+            minTemp = (Float) hvacTempSetConfig.getMinValue(areaId);
+            maxTemp = (Float) hvacTempSetConfig.getMaxValue(areaId);
+        } else {
+            minTemp = configArray.get(0) / 10f;
+            maxTemp = configArray.get(1) / 10f;
+        }
+
         for (int i = 0; i < NUM_TASKS; i++) {
             executorService.execute(
                     () -> {
@@ -113,16 +123,14 @@ public class CarPropertyManagerBenchmarkTest {
                             Random rd = new Random();
                             long timeBeforeRun = System.nanoTime();
                             try {
-                                mCarPropertyManager.setProperty(
-                                        Float.class,
+                                mCarPropertyManager.setFloatProperty(
                                         HVAC_TEMPERATURE_SET,
                                         /* areaId= */ areaId,
-                                        /* val= */ MIN_TEMP
-                                                + rd.nextFloat() * (MAX_TEMP - MIN_TEMP));
+                                        /* val= */ minTemp + rd.nextFloat() * (maxTemp - minTemp));
                             } catch (IllegalStateException e) {
                                 // This is expected because car service only allows up to 16 sync
                                 // get/set operations happening at the same time.
-                                Log.i(TAG, "getProperty threw an error", e);
+                                Log.i(TAG, "setProperty threw an error", e);
                             }
                             concurrentLinkedQueue.add((System.nanoTime() - timeBeforeRun));
                         }
diff --git a/tests/automotive/mobly_tests/Android.bp b/tests/automotive/mobly_tests/Android.bp
index 4059e1972..3e73d1e3a 100644
--- a/tests/automotive/mobly_tests/Android.bp
+++ b/tests/automotive/mobly_tests/Android.bp
@@ -4,18 +4,13 @@ python_library_host {
     srcs: ["bluetooth_base_test.py"],
     libs: [
         "mobly",
-        "utilities"
+        "utilities",
     ],
     device_common_data: [
         // Package the snippet with the mobly test
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -25,7 +20,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -38,11 +33,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_library_host {
@@ -52,16 +42,11 @@ python_library_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     device_common_data: [
         // Package the snippet with the mobly test
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
-}
\ No newline at end of file
+}
diff --git a/tests/automotive/mobly_tests/bluetooth_base_test.py b/tests/automotive/mobly_tests/bluetooth_base_test.py
index a86aedda6..4bcf4cec3 100644
--- a/tests/automotive/mobly_tests/bluetooth_base_test.py
+++ b/tests/automotive/mobly_tests/bluetooth_base_test.py
@@ -10,10 +10,11 @@ import logging
 
 from mobly import base_test
 from mobly.controllers import android_device
+from mobly.controllers.android_device_lib.snippet_client_v2 import Config
 
 from utilities import spectatio_utils
 from utilities import bt_utils
-from utilities.main_utils import common_main
+from utilities.main_utils import common_main, get_test_args
 from utilities.video_utils_service import VideoRecording
 
 
@@ -33,9 +34,14 @@ class BluetoothBaseTest(base_test.BaseTestClass):
         # The device that is expected to be discovered
         self.target = android_device.get_device(self.ads, label='phone')
         self.target.debug_tag = 'target'
-        logging.info("\tLoading Snippets.")
-        self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
-        self.discoverer.load_snippet('mbs', android_device.MBS_PACKAGE)
+
+        test_args = get_test_args(shell_escape=True)
+        logging.info("\tLoading Snippets.  Test args = {}".format(test_args))
+        snippet_config = Config(am_instrument_options=test_args)
+        logging.info("\tSnippet config: {}".format(snippet_config))
+        self.target.load_snippet('mbs', android_device.MBS_PACKAGE, config=snippet_config)
+        self.discoverer.load_snippet('mbs', android_device.MBS_PACKAGE, config=snippet_config)
+
         logging.info("\tInitializing Utilities")
         self.call_utils = (spectatio_utils.CallUtils(self.discoverer))
         self.bt_utils = (bt_utils.BTUtils(self.discoverer, self.target))
diff --git a/tests/automotive/mobly_tests/bluetooth_palette/Android.bp b/tests/automotive/mobly_tests/bluetooth_palette/Android.bp
index 3c7dcb2a0..43fa13e14 100644
--- a/tests/automotive/mobly_tests/bluetooth_palette/Android.bp
+++ b/tests/automotive/mobly_tests/bluetooth_palette/Android.bp
@@ -37,11 +37,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -51,8 +46,8 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
-        ],
+        "bluetooth_test",
+    ],
     test_suites: [
         "catbox",
     ],
@@ -64,11 +59,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -91,11 +81,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -105,8 +90,8 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
-        ],
+        "bluetooth_test",
+    ],
     test_suites: [
         "catbox",
     ],
@@ -118,9 +103,26 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
+}
+
+python_test_host {
+    name: "BluetoothReconnectingBTPalette",
+    main: "bluetooth_reconnecting_bt_palette_test.py",
+    srcs: ["bluetooth_reconnecting_bt_palette_test.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
     },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
 }
diff --git a/tests/automotive/mobly_tests/bluetooth_palette/bluetooth_reconnecting_bt_palette_test.py b/tests/automotive/mobly_tests/bluetooth_palette/bluetooth_reconnecting_bt_palette_test.py
new file mode 100644
index 000000000..51eff9dca
--- /dev/null
+++ b/tests/automotive/mobly_tests/bluetooth_palette/bluetooth_reconnecting_bt_palette_test.py
@@ -0,0 +1,75 @@
+#  Copyright (C) 2024 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+"""
+Test Steps:
+(0. Flash device)
+1. Launch Home - Action Bar - Tap Bluetooth button - Bluetooth Palette with be displayed
+2. Toggle Off On 'Bluetooth' button in Bluetooth palette
+3. Verification:-Bluetooth Device disconnected displayed in the Bluetooth Palette
+-Status in Bluetooth palette is 'To see your devices, turn on Bluetooth'
+4. Toggle On Bluetooth Button in Bluetooth palette
+5. Verification:- Bluetooth Device reconnected, and showing as Connected with Bluetooth Profiles button showing as enabled
+6. Toggle Off/On 'Use Bluetooth' in Bluetooth Palette Multiple times
+
+"""
+
+from bluetooth_test import bluetooth_base_test
+from mobly import asserts
+
+from utilities import constants
+from utilities.main_utils import common_main
+
+
+class BluetoothReconnectingBTPalette(bluetooth_base_test.BluetoothBaseTest):
+    """Enable and Disable Bluetooth from Bluetooth Palette."""
+
+    def setup_test(self):
+        """Setup steps before any test is executed."""
+        # Pair the devices
+        self.bt_utils.pair_primary_to_secondary()
+        super().enable_recording()
+        self.call_utils.press_home()
+
+    def test_enable_disable_bluetooth_toggle_on_palette(self):
+        """Tests enable and disable functionality of bluetooth."""
+        self.call_utils.open_bluetooth_palette()
+        self.call_utils.wait_with_log(10)
+        """Verify BT profile button and status on the Bluetooth Palette when Bluetooth is ON"""
+        asserts.assert_true(self.call_utils.is_bluetooth_toggle_switch_in_palette_on(), "Bluetooth Toggle Switch is on in Bluetooth palette")
+        asserts.assert_true(self.call_utils.is_bluetooth_button_enabled(), "Bluetooth profile button is Enabled")
+        asserts.assert_true(self.call_utils.is_bluetooth_connected(), "Bluetooth Connected status is displayed")
+        self.call_utils.turn_on_off_bluetooth_switch_on_palette(False)
+        """Verify BT profile button and status on the Bluetooth Palette when Bluetooth is OFF"""
+        self.call_utils.wait_with_log(5)
+        asserts.assert_false(self.call_utils.is_bluetooth_toggle_switch_in_palette_on(), "Bluetooth Toggle Switch is on in Bluetooth palette")
+        asserts.assert_true(self.call_utils.has_bluetooth_toggle_off_message_displayed(), "Bluetooth OFF Message is displayed")
+        """Turning Bluetooth switch ON to repeat the verification """
+        self.call_utils.turn_on_off_bluetooth_switch_on_palette(True)
+        self.call_utils.wait_with_log(5)
+        """Verify BT profile button and status on the Bluetooth Palette when Bluetooth is ON"""
+        asserts.assert_true(self.call_utils.is_bluetooth_toggle_switch_in_palette_on(), "Bluetooth Toggle Switch is on in Bluetooth palette")
+        asserts.assert_true(self.call_utils.is_bluetooth_button_enabled(), "Bluetooth profile button is Enabled")
+        asserts.assert_true(self.call_utils.is_bluetooth_connected(), "Bluetooth Connected status is displayed")
+        self.call_utils.turn_on_off_bluetooth_switch_on_palette(False)
+        """Verify BT profile button and status on the Bluetooth Palette when Bluetooth is OFF"""
+        self.call_utils.wait_with_log(5)
+        asserts.assert_false(self.call_utils.is_bluetooth_toggle_switch_in_palette_on(), "Bluetooth Toggle Switch is on in Bluetooth palette")
+        asserts.assert_true(self.call_utils.has_bluetooth_toggle_off_message_displayed(), "Bluetooth OFF Message is displayed")
+        """Turning Bluetooth switch ON """
+        self.call_utils.turn_on_off_bluetooth_switch_on_palette(True)
+        self.call_utils.wait_with_log(5)
+
+if __name__ == '__main__':
+    common_main()
diff --git a/tests/automotive/mobly_tests/bluetooth_sms_base_test.py b/tests/automotive/mobly_tests/bluetooth_sms_base_test.py
index ed53c5c5d..906828b21 100644
--- a/tests/automotive/mobly_tests/bluetooth_sms_base_test.py
+++ b/tests/automotive/mobly_tests/bluetooth_sms_base_test.py
@@ -1,58 +1,65 @@
-"""
-Bluetooth ThreeDeviceTestBed Base Test
+"""Bluetooth ThreeDeviceTestBed Base Test
 
 This test class serves as a base class for tests which needs three devices
-
 """
 
 import logging
-import sys
 
-from mobly import test_runner
+from bluetooth_test import bluetooth_base_test
 from mobly.controllers import android_device
-
-from utilities import spectatio_utils
 from utilities import bt_utils
-from bluetooth_test import bluetooth_base_test
+from utilities import spectatio_utils
+from utilities.main_utils import common_main
 from utilities.video_utils_service import VideoRecording
 
+
 class BluetoothSMSBaseTest(bluetooth_base_test.BluetoothBaseTest):
 
+  def setup_class(self):
+    # Registering android_device controller module and declaring the three devices.
+    self.ads = self.register_controller(android_device, min_number=3)
+
+    # The dicoverers is the car head unit.
+    self.discoverer = android_device.get_device(self.ads, label='auto')
+    self.discoverer.debug_tag = 'discoverer'
+    self.discoverer.load_snippet('mbs', android_device.MBS_PACKAGE)
 
-    def setup_class(self):
-        # Registering android_device controller module and declaring the three devices
+    # The phone device used to connect to the car.
+    self.target = android_device.get_device(self.ads, label='phone')
+    self.target.debug_tag = 'target'
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
 
-        self.ads = self.register_controller(android_device, min_number=3)
-        # The device used to discover Bluetooth devices.
-        self.discoverer = android_device.get_device(
-            self.ads, label='auto')
-        # Sets the tag that represents this device in logs.
-        self.discoverer.debug_tag = 'discoverer'
-        # The device that is expected to be discovered
-        self.target = android_device.get_device(self.ads, label='phone')
-        self.target.debug_tag = 'target'
-        self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
-        self.discoverer.load_snippet('mbs', android_device.MBS_PACKAGE)
+    # The extra phone device used to perform actions (make calls, send SMS).
+    self.phone_notpaired = android_device.get_device(
+        self.ads,
+        label='phone_notpaired',
+    )
+    self.phone_notpaired.debug_tag = 'phone_notpaired'
+    self.phone_notpaired.load_snippet('mbs', android_device.MBS_PACKAGE)
 
-        self.phone_notpaired = android_device.get_device(self.ads, label='phone_notpaired')
-        self.phone_notpaired.debug_tag = 'phone_notpaired'
-        self.phone_notpaired.load_snippet('mbs', android_device.MBS_PACKAGE)
+    self.call_utils = spectatio_utils.CallUtils(self.discoverer)
+    self.bt_utils = bt_utils.BTUtils(self.discoverer, self.target)
 
-        self.call_utils = (spectatio_utils.CallUtils(self.discoverer))
-        self.bt_utils = (bt_utils.BTUtils(self.discoverer, self.target))
+    logging.info('Initializing video services')
+    self.video_utils_service = VideoRecording(
+        self.discoverer,
+        self.__class__.__name__,
+    )
+    self.video_utils_service_target = VideoRecording(
+        self.target,
+        self.__class__.__name__,
+    )
 
-        logging.info("\tInitializing video services")
-        self.video_utils_service = VideoRecording(self.discoverer, self.__class__.__name__)
-        logging.info("Enabling video recording for Discoverer device")
-        self.video_utils_service.enable_screen_recording()
+    logging.info('Enabling video recording for Discoverer device')
+    self.video_utils_service.enable_screen_recording()
 
-        logging.info("\tInitializing video services")
-        self.video_utils_service_target = VideoRecording(self.target, self.__class__.__name__)
-        logging.info("Enabling video recording for Target device")
-        self.video_utils_service_target.enable_screen_recording()
+    logging.info('Enabling video recording for Target device')
+    self.video_utils_service_target.enable_screen_recording()
 
-        self.call_utils.press_phone_home_icon_using_adb_command(self.phone_notpaired)
+    self.call_utils.press_phone_home_icon_using_adb_command(
+        self.phone_notpaired
+    )
 
 
 if __name__ == '__main__':
-    common_main()
+  common_main()
diff --git a/tests/automotive/mobly_tests/certification/Android.bp b/tests/automotive/mobly_tests/certification/Android.bp
new file mode 100644
index 000000000..0b41cbf8a
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/Android.bp
@@ -0,0 +1,161 @@
+package {
+    default_team: "trendy_team_aaos_framework",
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+python_test_host {
+    name: "FlashTest",
+    main: "flash.py",
+    srcs: [
+        "flash.py",
+        "devices/*.py",
+    ],
+    libs: [
+        "mobly",
+        "utilities",
+    ],
+    test_suites: ["catbox"],
+    test_options: {
+        unit_test: false,
+    },
+    data: [
+        "device.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "RebootTest",
+    main: "reboot.py",
+    srcs: ["reboot.py"],
+    libs: [
+        "mobly",
+        "utilities",
+    ],
+    test_suites: ["catbox"],
+    test_options: {
+        unit_test: false,
+    },
+    data: [
+        "device.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "FastbootWipeTest",
+    main: "fastboot_wipe.py",
+    srcs: ["fastboot_wipe.py"],
+    libs: [
+        "mobly",
+        "utilities",
+    ],
+    test_suites: ["catbox"],
+    test_options: {
+        unit_test: false,
+    },
+    data: [
+        "device.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "WifiTest",
+    main: "wifi.py",
+    srcs: ["wifi.py"],
+    libs: [
+        "mobly",
+        "utilities",
+    ],
+    test_suites: ["catbox"],
+    test_options: {
+        unit_test: false,
+    },
+    data: [
+        "device.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "BluetoothTest",
+    main: "bluetooth.py",
+    srcs: ["bluetooth.py"],
+    libs: [
+        "mobly",
+        "utilities",
+    ],
+    test_suites: ["catbox"],
+    test_options: {
+        unit_test: false,
+    },
+    data: [
+        "device.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "LocationTest",
+    main: "location.py",
+    srcs: ["location.py"],
+    libs: [
+        "mobly",
+        "utilities",
+    ],
+    test_suites: ["catbox"],
+    test_options: {
+        unit_test: false,
+    },
+    data: [
+        "device.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "VhalTest",
+    main: "vhal.py",
+    srcs: ["vhal.py"],
+    libs: [
+        "mobly",
+        "utilities",
+    ],
+    test_suites: ["catbox"],
+    test_options: {
+        unit_test: false,
+    },
+    data: [
+        "device.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
diff --git a/tests/automotive/mobly_tests/certification/bluetooth.py b/tests/automotive/mobly_tests/certification/bluetooth.py
new file mode 100644
index 000000000..5c658d123
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/bluetooth.py
@@ -0,0 +1,77 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+import time
+from mobly import base_test
+from mobly import test_runner
+from mobly.controllers import android_device
+from utilities.main_utils import common_main
+
+class BluetoothValidationTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        self.android_devices = self.register_controller(android_device)
+
+    def bluetooth_toggle(self, enable):
+        """Enables or disables the Bluetooth on the device.
+
+        Args:
+            enable (bool): True to enable Bluetooth, False to disable.
+        """
+        state = 'enable' if enable else 'disable'
+        cmd = f'cmd bluetooth_manager {state}'
+        output = self.android_devices[0].adb.shell(cmd)
+        logging.info(f'Bluetooth {state} command output: {output}')
+
+    def check_bluetooth_status(self, expected_status):
+        """Checks the current Bluetooth status against the expected status.
+
+        Args:
+            expected_status (int): The expected Bluetooth status, 1 for 'enabled' or 0 for 'disabled'.
+
+        Returns:
+            bool: True if the actual and expected statuses match, False otherwise.
+        """
+        status_output_bytes = self.android_devices[0].adb.shell('settings list global | grep ^bluetooth_on')
+        # The output will be a string like 'bluetooth_on=1' or 'bluetooth_on=0'.
+        status_output = status_output_bytes.decode('utf-8').strip()
+        current_status = status_output.split('=')[-1]
+        logging.info(f'Current Bluetooth status: {status_output}')
+        return str(expected_status) == current_status
+
+    def test_bluetooth_validation(self):
+        # Ensure at least one device is available
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered.')
+
+        # Check the current status of Bluetooth
+        logging.info("check bluetooth")
+        bluetooth_enabled = self.check_bluetooth_status(1)
+
+        # If Bluetooth is originally enabled, disable it
+        if bluetooth_enabled:
+            logging.info("turn off bluetooth")
+            self.bluetooth_toggle(enable=False)
+            assert not self.check_bluetooth_status(1), 'Failed to disable Bluetooth'
+
+        # Enable Bluetooth and check status
+        logging.info("enable bluetooth")
+        self.bluetooth_toggle(enable=True)
+        time.sleep(2)
+        assert self.check_bluetooth_status(1), 'Failed to enable Bluetooth'
+
+
+if __name__ == '__main__':
+    common_main()
diff --git a/tests/automotive/mobly_tests/certification/device.yaml b/tests/automotive/mobly_tests/certification/device.yaml
new file mode 100644
index 000000000..fae5bd50c
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/device.yaml
@@ -0,0 +1,16 @@
+TestBeds:
+  # A test bed where adb will find Android devices.
+  - Name: SampleTestBed
+    Controllers:
+        AndroidDevice: '*'
+    TestParams:
+        device: seahawk
+        serial: serial_number
+        image_dir: /usr/local/google/home/zhaomingyin/seahakw
+        wipe: True
+        hw_variant: 2s
+        b: False
+        diag: False
+        preserve_keys: False
+        num_reboots: 2
+        total_flashes: 2
diff --git a/tests/automotive/mobly_tests/certification/devices/__init__.py b/tests/automotive/mobly_tests/certification/devices/__init__.py
new file mode 100644
index 000000000..a75bf9bb3
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/devices/__init__.py
@@ -0,0 +1,24 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+from .seahawk import DeviceSeahawk
+
+class DeviceFactory:
+    @staticmethod
+    def get_device(device_name: str):
+        """Factory method to get the corresponding DeviceType based on device name."""
+        if device_name == 'seahawk':
+            return DeviceSeahawk
+
+        raise ValueError(f"No such device with name: {device_name}")
diff --git a/tests/automotive/mobly_tests/certification/devices/seahawk.py b/tests/automotive/mobly_tests/certification/devices/seahawk.py
new file mode 100644
index 000000000..03c979e78
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/devices/seahawk.py
@@ -0,0 +1,58 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import subprocess
+import os
+import logging
+
+from .types import DeviceType
+
+class DeviceSeahawk(DeviceType):
+
+  @staticmethod
+  def flash(serial, imagedir, wipe, hwVariant, b, diag, preserveKeys):
+    scriptName = 'fastboot_complete_seahawk.py'
+    flashScript = imagedir / scriptName
+    if not flashScript.exists():
+      print('Flashing script was not downloaded, therefore aborting. Try again to run '
+          + 'aae image pull')
+      sys.exit(-1)
+
+    args = ['python3', str(flashScript)]
+    os.environ['ANDROID_PRODUCT_OUT'] = str(imagedir)
+    os.environ['ANDROID_SERIAL'] = serial
+    args.append('2s')
+    if not wipe:
+      args.append('--no-wipe')
+    if not b:
+      args.append('--no-b')
+    if diag:
+      args.append('--enable-diag')
+    if preserveKeys:
+      args.append('--preserve-keys')
+    logging.info(args)
+    command = " ".join(str(x) for x in args)
+    try:
+      # Start the subprocess with Popen and stream the output
+      with subprocess.Popen(command, shell=True, executable='/bin/bash', stdout=subprocess.PIPE, stderr=subprocess.STDOUT, text=True) as proc:
+        logging.info('Flashing the device...')
+        # Stream the output line by line
+        for line in iter(proc.stdout.readline, ''):
+          logging.info(line.rstrip())  # Log the output lines in real-time
+        proc.wait()  # Wait for the subprocess to finish
+        if proc.returncode != 0:
+          raise subprocess.CalledProcessError(proc.returncode, command)
+    except subprocess.CalledProcessError as e:
+      logging.error('Flash command failed with return code %s', e.returncode)
+      raise
diff --git a/tests/automotive/mobly_tests/certification/devices/types.py b/tests/automotive/mobly_tests/certification/devices/types.py
new file mode 100644
index 000000000..225eb448e
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/devices/types.py
@@ -0,0 +1,18 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+class DeviceType:
+  @staticmethod
+  def flash(serial, imagedir, wipe, hwVariant, b, diag, preserveKeys):
+    raise NotImplementedError()
diff --git a/tests/automotive/mobly_tests/certification/fastboot_wipe.py b/tests/automotive/mobly_tests/certification/fastboot_wipe.py
new file mode 100644
index 000000000..d1393c8e4
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/fastboot_wipe.py
@@ -0,0 +1,62 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+from mobly import base_test
+from mobly import test_runner
+from mobly.controllers import android_device
+from utilities.main_utils import common_main
+
+class AndroidFastbootWipeTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        self.android_devices = self.register_controller(android_device)
+
+    def test_fastboot_wipe(self):
+        # Check that there is at least one device available.
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered. Please make '
+                                'sure at least one device is connected and '
+                                'configured properly.')
+        ad = self.android_devices[0]  # Get the first device object.
+
+        # Reboot the device into fastboot mode using adb.
+        logging.info('Rebooting device into fastboot mode.')
+        ad.adb.reboot('bootloader')
+
+        # Wait for the device to enter fastboot mode.
+        ad.fastboot.wait_for_device()
+
+        # Wipe device using fastboot.
+        logging.info('Wiping device...')
+        ad.fastboot.wipe()
+
+        # Reboot the device after the wipe.
+        logging.info('Rebooting device...')
+        ad.fastboot.reboot()
+
+        # Wait for the device to complete its booting process.
+        ad.wait_for_boot_completion()
+
+        # Check the status of the device.
+        fingerprint = ad.adb.shell('getprop ro.build.fingerprint')
+        logging.info('Build fingerprint: %s', fingerprint)
+        if not fingerprint:
+            raise AssertionError('After wiping and rebooting, the build fingerprint could not be found.')
+
+        logging.info('Fastboot wipe test completed successfully.')
+
+
+if __name__ == '__main__':
+    common_main()
diff --git a/tests/automotive/mobly_tests/certification/flash.py b/tests/automotive/mobly_tests/certification/flash.py
new file mode 100644
index 000000000..a6f9ca9e0
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/flash.py
@@ -0,0 +1,69 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+import os
+import subprocess
+from mobly import base_test
+from mobly import test_runner
+from mobly import config_parser
+from mobly.controllers import android_device
+from devices import DeviceFactory
+from pathlib import Path
+from utilities.main_utils import common_main
+
+class AndroidFlashTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        # Setup required for the entire test class.
+        logging.info('Setting up test class.')
+        # Registers the android devices controllers with Mobly.
+        self.android_devices = self.register_controller(android_device)
+        # Retrieves the build path from the test configuration.
+        self.device = self.user_params['device']
+        self.serial = self.user_params['serial']
+        self.image_dir = Path(self.user_params['image_dir'])
+        self.wipe = self.user_params['wipe']
+        self.hw_variant = self.user_params['hw_variant']
+        self.b = self.user_params['b']
+        self.diag = self.user_params['diag']
+        self.preserve_keys = self.user_params['preserve_keys']
+
+    def test_flash_device(self):
+        # Check that there is at least one device available.
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered. Please make '
+                                 'sure at least one device is connected and '
+                                 'configured properly.')
+        ad = self.android_devices[0]  # Get the first device object.
+
+        # Record the build fingerprint before flashing.
+        before_flash_fingerprint = ad.adb.getprop('ro.build.fingerprint')
+        logging.info('Fingerprint before flash: %s', before_flash_fingerprint)
+
+        # Command to source your custom bashrc file and then run the flash command.
+        Device = DeviceFactory.get_device(self.device)
+        flash_result = Device.flash(ad.serial, self.image_dir, self.wipe, self.hw_variant, self.b, self.diag, self.preserve_keys)
+
+        # Reboot the device and wait until it's back online.
+        ad.reboot()
+        ad.wait_for_boot_completion()
+
+        # Check the build fingerprint after flashing.
+        after_flash_fingerprint = ad.adb.getprop('ro.build.fingerprint')
+        logging.info('Fingerprint after flash: %s', after_flash_fingerprint)
+
+if __name__ == '__main__':
+    common_main()
+
diff --git a/tests/automotive/mobly_tests/certification/flash_stability.py b/tests/automotive/mobly_tests/certification/flash_stability.py
new file mode 100644
index 000000000..28e49b34c
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/flash_stability.py
@@ -0,0 +1,92 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+import os
+import subprocess
+from mobly import base_test
+from mobly import test_runner
+from mobly import config_parser
+from mobly.controllers import android_device
+from devices import DeviceFactory
+from pathlib import Path
+from utilities.main_utils import common_main
+
+class AndroidFlashTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        # Setup required for the entire test class.
+        logging.info('Setting up test class.')
+        # Registers the android devices controllers with Mobly.
+        self.android_devices = self.register_controller(android_device)
+        # Retrieves the build path from the test configuration.
+        self.device = self.user_params['device']
+        self.serial = self.user_params['serial']
+        self.image_dir = Path(self.user_params['image_dir'])
+        self.wipe = self.user_params['wipe']
+        self.hw_variant = self.user_params['hw_variant']
+        self.b = self.user_params['b']
+        self.diag = self.user_params['diag']
+        self.preserve_keys = self.user_params['preserve_keys']
+        self.total_flashes = self.user_params['total_flashes']
+
+    def test_flash_device_stability(self):
+        # Check that there is at least one device available.
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered. Please make '
+                                 'sure at least one device is connected and '
+                                 'configured properly.')
+        ad = self.android_devices[0]  # Get the first device object.
+
+        total_flashes = self.total_flashes 
+        successful_flashes = 0
+
+        for i in range(total_flashes):
+            logging.info('Flash attempt #%d', i + 1)
+
+            # Get the build fingerprint before flashing.
+            before_flash_fingerprint = ad.adb.getprop('ro.build.fingerprint')
+
+            try:
+
+                Device = DeviceFactory.get_device(self.device)
+                flash_result = Device.flash(self.serial, self.image_dir, self.wipe, self.hw_variant, self.b, self.diag, self.preserve_keys)
+                # Reboot the device and wait for it to come back online.
+                ad.reboot()
+                ad.wait_for_boot_completion()
+
+                # Get the build fingerprint after flashing.
+                after_flash_fingerprint = ad.adb.getprop('ro.build.fingerprint')
+
+                # Check if the flash was successful by comparing fingerprints.
+                if before_flash_fingerprint == after_flash_fingerprint:
+                    successful_flashes += 1
+                else:
+                    logging.error('Flash attempt #%d failed: fingerprint did not change.', i + 1)
+
+            except subprocess.CalledProcessError as e:
+                logging.error('Flash attempt #%d failed with return code %s', i + 1, e.returncode)
+
+            # It's a good idea to have some delay between flashes to avoid overloading the device.
+            # You can add sleep here if needed.
+
+        # After the loop, log the results of the stability test.
+        logging.info('Completed %d flash attempts with %d successes.', total_flashes, successful_flashes)
+
+        # Optionally, assert that all flashes were successful to mark the test as passed.
+        assert successful_flashes == total_flashes, 'Not all flash attempts were successful.'
+
+if __name__ == '__main__':
+    common_main()
+
diff --git a/tests/automotive/mobly_tests/certification/location.py b/tests/automotive/mobly_tests/certification/location.py
new file mode 100644
index 000000000..638a383da
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/location.py
@@ -0,0 +1,91 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+from mobly import base_test
+from mobly import test_runner
+from mobly.controllers import android_device
+from utilities.main_utils import common_main
+
+class GPSLocationValidationTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        self.android_devices = self.register_controller(android_device)
+
+    def toggle_location_settings(self, enable):
+        """Enables or disables the location settings on the device.
+
+        Args:
+            enable (bool): True to enable location settings, False to disable.
+        """
+        state = 'true' if enable else 'false'
+        cmd = f'cmd location set-location-enabled {state}'
+        output = self.android_devices[0].adb.shell(cmd).decode('utf-8')
+        if 'Error' in output:
+            raise Exception(f'Unable to {state} location services: {output}')
+        logging.info(f'Location services {state} command output: {output}')
+
+    def check_location_status(self):
+        """Checks if the user has enabled location on the device.
+
+        Returns:
+            bool: True if the location is enabled for the user, False otherwise.
+        """
+        try:
+            status_output_bytes = self.android_devices[0].adb.shell('dumpsys location -a | grep "location \[u10\]"')
+        except Exception as e:
+            logging.warning("Received an AdbError: %s", e)
+            # You can inspect e.stdout and e.stderr for more details if needed
+            return False
+
+        status_str = status_output_bytes.decode('utf-8')
+        status_line = status_str.strip().split('\n')[-1]
+        logging.info(status_line)
+        location_enabled = "enabled" in status_line
+        logging.info(f'User location status: {"enabled" if location_enabled else "disabled"}')
+        return location_enabled
+
+    def validate_last_location(self):
+        """Validates if the longitude and latitude of the device is captured successfully.
+
+        Returns:
+            bool: True if valid GNSS location data is obtained, False otherwise.
+        """
+        location_output_bytes = self.android_devices[0].adb.shell('dumpsys location | grep "last location"')
+        location_info = location_output_bytes.decode('utf-8').strip()
+        logging.info(f'Last known location: {location_info}')
+        return 'gps:' in location_info and 'long=' in location_info and 'lat=' in location_info
+
+    def test_location_validation(self):
+        """Runs the GPS and location validation test case."""
+        # Ensure at least one device is available
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered.')
+
+        # Toggle off location and verify it's off
+        logging.info("Toggle off location and verify")
+        self.toggle_location_settings(enable=False)
+        assert not self.check_location_status(), 'Failed to disable location services'
+
+        # Toggle on location and verify it's on
+        logging.info("Toggle on location and verify")
+        self.toggle_location_settings(enable=True)
+        assert self.check_location_status(), 'Failed to enable location services'
+
+        logging.info("verify last location")
+        # Validate that the device captures a valid last known location
+        assert self.validate_last_location(), 'Failed to capture a valid last known location'
+
+if __name__ == '__main__':
+    common_main()
diff --git a/tests/automotive/mobly_tests/certification/reboot.py b/tests/automotive/mobly_tests/certification/reboot.py
new file mode 100644
index 000000000..84f80b571
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/reboot.py
@@ -0,0 +1,57 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+from mobly import base_test
+from mobly import test_runner
+from mobly.controllers import android_device
+from utilities.main_utils import common_main
+
+class AndroidRebootTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        # Setup required for the entire test class. This executes
+        # before any test cases are run.
+        self.android_devices = self.register_controller(android_device)
+
+    def test_reboot_and_check_fingerprint(self):
+        # Check that there is at least one device available.
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered. Please make '
+                                 'sure at least one device is connected and '
+                                 'configured properly.')
+
+        ad = self.android_devices[0]  # Get the first device object.
+
+        # Record the fingerprint before the reboot.
+        before_reboot_fingerprint = ad.adb.shell('getprop ro.build.fingerprint')
+        logging.info('Fingerprint before reboot: %s', before_reboot_fingerprint)
+
+        # Reboot the device and wait until it's back online.
+        ad.reboot()
+        ad.wait_for_boot_completion()
+
+        # Check the fingerprint after the reboot.
+        after_reboot_fingerprint = ad.adb.shell('getprop ro.build.fingerprint')
+        logging.info('Fingerprint after reboot: %s', after_reboot_fingerprint)
+
+        # Verify that the fingerprint remains the same after the reboot
+        if before_reboot_fingerprint != after_reboot_fingerprint:
+            raise AssertionError('The ro.build.fingerprint has changed after '
+                                 'reboot. Before: %s, after: %s' %
+                                 (before_reboot_fingerprint, after_reboot_fingerprint))
+
+if __name__ == '__main__':
+    common_main()
+
diff --git a/tests/automotive/mobly_tests/certification/reboot_stability.py b/tests/automotive/mobly_tests/certification/reboot_stability.py
new file mode 100644
index 000000000..89a4d3b60
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/reboot_stability.py
@@ -0,0 +1,69 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+from mobly import base_test
+from mobly import test_runner
+from mobly.controllers import android_device
+from utilities.main_utils import common_main
+
+class AndroidRebootTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        # Setup required for the entire test class. This executes
+        # before any test cases are run.
+        self.android_devices = self.register_controller(android_device)
+        self.num_reboots = self.user_params['num_reboots']
+
+    def test_reboot_and_check_fingerprint_stability(self):
+        # Number of times the reboot operation will be performed.
+        num_reboots = self.num_reboots
+        num_successful_reboots = 0
+
+        # Ensure there is at least one device available.
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered. Please make '
+                                 'sure at least one device is connected and '
+                                 'configured properly.')
+
+        ad = self.android_devices[0]  # Get the first device object.
+        # Record the fingerprint before the first reboot.
+        initial_fingerprint = ad.adb.shell('getprop ro.build.fingerprint')
+        logging.info('Initial fingerprint: %s', initial_fingerprint)
+
+        for i in range(num_reboots):
+            logging.info('Rebooting: Attempt #%d', i + 1)
+
+            # Reboot the device and wait until it's back online.
+            ad.reboot()
+            ad.wait_for_boot_completion()
+
+            # Check the fingerprint after the reboot.
+            current_fingerprint = ad.adb.shell('getprop ro.build.fingerprint')
+            logging.info('Fingerprint after reboot #%d: %s', i + 1, current_fingerprint)
+
+            # Verify that the fingerprint remains the same after each reboot.
+            if initial_fingerprint != current_fingerprint:
+                raise AssertionError('The ro.build.fingerprint has changed after '
+                                     'reboot #%d. Initial: %s, after: %s' %
+                                     (i + 1, initial_fingerprint, current_fingerprint))
+            else:
+                num_successful_reboots += 1
+
+        logging.info('Reboot Stability Test: %d/%d successful reboots.',
+                     num_successful_reboots, num_reboots)
+
+if __name__ == '__main__':
+    common_main()
+
diff --git a/tests/automotive/mobly_tests/certification/vhal.py b/tests/automotive/mobly_tests/certification/vhal.py
new file mode 100644
index 000000000..a5f7a7fd8
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/vhal.py
@@ -0,0 +1,66 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+from mobly import base_test
+from mobly import test_runner
+from mobly.controllers import android_device
+from utilities.main_utils import common_main
+
+class VhalValidationTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        # Registers Android device controllers.
+        self.android_devices = self.register_controller(android_device)
+
+    def check_vhal_properties(self):
+        """Checks if VHAL is listing expected properties.
+
+        Returns:
+            bool: True if the properties are listed as expected, False otherwise.
+        """
+        cmd = 'dumpsys android.hardware.automotive.vehicle.IVehicle/default --list'
+        output_bytes = self.android_devices[0].adb.shell(cmd)
+        output = output_bytes.decode('utf-8')
+        #logging.info('Current VHAL properties: {}'.format(output))
+
+        # Extract property ids from the output.
+        properties_list = []
+        for line in output.splitlines()[1:]:  # Skip the first line which contains "listing xx properties"
+            if ':' in line:
+                try:
+                    property_id = int(line.split(':')[1].strip())
+                    properties_list.append(property_id)
+                except ValueError:
+                    logging.error('Failed to parse property id from line: {}'.format(line))
+
+        # Define expected properties, replace this with the actual list you're expecting.
+        expected_properties = set([356582673,356517131]) # Example, properties 0 through 96.
+
+        # Create a set of properties found in the output.
+        found_properties = set(properties_list)
+
+        # Check if any expected properties are missing.
+        missing_properties = expected_properties - found_properties
+        if missing_properties:
+            logging.error('Missing VHAL properties: {}'.format(missing_properties))
+
+        return not missing_properties
+
+    def test_vhal_properties_validation(self):
+        if not self.check_vhal_properties():
+            raise AssertionError('VHAL properties are not as expected.')
+
+if __name__ == '__main__':
+    common_main()
diff --git a/tests/automotive/mobly_tests/certification/wifi.py b/tests/automotive/mobly_tests/certification/wifi.py
new file mode 100644
index 000000000..ce85b3e97
--- /dev/null
+++ b/tests/automotive/mobly_tests/certification/wifi.py
@@ -0,0 +1,72 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+from mobly import base_test
+from mobly import test_runner
+from mobly.controllers import android_device
+from utilities.main_utils import common_main
+
+class WifiValidationTest(base_test.BaseTestClass):
+
+    def setup_class(self):
+        self.android_devices = self.register_controller(android_device)
+
+    def wifi_toggle(self, enable):
+        """Enables or disables the Wi-Fi on the device.
+
+        Args:
+            enable (bool): True to enable Wi-Fi, False to disable.
+        """
+        state = 'enable' if enable else 'disable'
+        cmd = f'svc wifi {state}'
+        output = self.android_devices[0].adb.shell(cmd)
+        logging.info(f'Wi-Fi {state} command output: {output}')
+
+    def check_wifi_status(self, expected_status):
+        """Checks the current Wi-Fi status against the expected status.
+
+        Args:
+            expected_status (str): The expected Wi-Fi status, 'enabled' or 'disabled'.
+
+        Returns:
+            bool: True if the actual and expected statuses match, False otherwise.
+        """
+        status_output_bytes = self.android_devices[0].adb.shell('dumpsys wifi | grep "Wi-Fi is"')
+        # Decode the bytes object to a string using UTF-8 or appropriate encoding
+        status_output = status_output_bytes.decode('utf-8')
+        logging.info(f'Current Wi-Fi status: {status_output}')
+        # Comparing only the tail part of the line to have a match like 'Wi-Fi is enabled/disabled'
+        return expected_status in status_output.split()[-1]
+
+    def test_wifi_validation(self):
+        # Ensure at least one device is available
+        if not self.android_devices:
+            raise AssertionError('No Android devices are registered.')
+
+        # Check the current status of WiFi
+        wifi_enabled = self.check_wifi_status('enabled')
+
+        # If WiFi is originally enabled, disable it
+        if wifi_enabled:
+            self.wifi_toggle(enable=False)
+            assert not self.check_wifi_status('enabled'), 'Failed to disable Wi-Fi'
+
+        # Enable WiFi and check status
+        self.wifi_toggle(enable=True)
+        assert self.check_wifi_status('enabled'), 'Failed to enable Wi-Fi'
+
+
+if __name__ == '__main__':
+    common_main()
diff --git a/tests/automotive/mobly_tests/connectivity/Android.bp b/tests/automotive/mobly_tests/connectivity/Android.bp
index 7a9b064a8..54783264e 100644
--- a/tests/automotive/mobly_tests/connectivity/Android.bp
+++ b/tests/automotive/mobly_tests/connectivity/Android.bp
@@ -37,11 +37,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -64,11 +59,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -91,11 +81,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -118,11 +103,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -145,11 +125,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -172,11 +147,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -199,11 +169,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
diff --git a/tests/automotive/mobly_tests/connectivity/connectivity_test_status_displayed_in_l2.py b/tests/automotive/mobly_tests/connectivity/connectivity_test_status_displayed_in_l2.py
index 20967a282..8f61d2d7f 100644
--- a/tests/automotive/mobly_tests/connectivity/connectivity_test_status_displayed_in_l2.py
+++ b/tests/automotive/mobly_tests/connectivity/connectivity_test_status_displayed_in_l2.py
@@ -1,29 +1,30 @@
 """
-  Copyright (C) 2023 The Android Open Source Project
+ Copyright (C) 2023 The Android Open Source Project
 
-  Licensed under the Apache License, Version 2.0 (the "License");
-  you may not use this file except in compliance with the License.
-  You may obtain a copy of the License at
+ Licensed under the Apache License, Version 2.0 (the "License");
+ you may not use this file except in compliance with the License.
+ You may obtain a copy of the License at
 
-       http://www.apache.org/licenses/LICENSE-2.0
+      http://www.apache.org/licenses/LICENSE-2.0
 
-  Unless required by applicable law or agreed to in writing, software
-  distributed under the License is distributed on an "AS IS" BASIS,
-  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-  See the License for the specific language governing permissions and
-  limitations under the License.
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
 
 
 
-  Test Steps:
-  (0. Flash device)
-    1. Navigate to the Bluetooth settings page
-    2. Disconnect - Connect Mobile Device via Layer1 - via Bluetooth Button
-    3. Tap Device to see DisconnectedStatus in Layer2
-    4. Reconnect - Via layer 1
-    5. Tap device to see Connected status in Layer2
+ Test Steps:
+ (0. Flash device)
+   1. Navigate to the Bluetooth settings page
+   2. Disconnect - Connect Mobile Device via Layer1 - via Bluetooth Button
+   3. Tap Device to see DisconnectedStatus in Layer2
+   4. Reconnect - Via layer 1
+   5. Tap device to see Connected status in Layer2
+   6. Disconnect - Connect BT device multiple times from L1 and Verify Device status Connected - Disconnected displayed in L2
 
-    "Layer Two" represents the device-specific screen (the screen you see when clicking the device in the bluetooth settings page.
+   "Layer Two" represents the device-specific screen (the screen you see when clicking the device in the bluetooth settings page.
 
 """
 
@@ -33,43 +34,57 @@ from utilities.main_utils import common_main
 from utilities import constants
 import logging
 
-MOBILE_DEVICE_NAME = 'target'
-AUTOMOTIVE_DEVICE_NAME = 'discoverer'
-
 class BluetoothConnectionStatusOnLevelTwo(bluetooth_base_test.BluetoothBaseTest):
 
 
-    def setup_test(self):
-        # Pair the devices
-        self.bt_utils.pair_primary_to_secondary()
-        super().enable_recording()
+   def setup_test(self):
+       # Pair the devices
+       self.bt_utils.pair_primary_to_secondary()
+       super().enable_recording()
+
+   def test_connection_status_displayed_on_device_screen(self):
+       # Log BT Connection State after pairing
+       bt_connection_state=self.call_utils.get_bt_connection_status_using_adb_command(self.discoverer)
+       logging.info("BT State after pairing: <%s>", bt_connection_state)
+
+       for i in range(0, 2):
+           # Open bluetooth settings.
+           self.call_utils.open_bluetooth_settings()
+
+           # Find the target device and disconnect it on the Level One page
+           target_name = self.target.mbs.btGetName()
+           self.call_utils.press_bluetooth_toggle_on_device(target_name)
+           self.discoverer.mbs.waitUntilConnectionStatus("Disconnected")
 
-    def test_connection_status_displayed_on_device_screen(self):
-        # Log BT Connection State after pairing
-        bt_connection_state=self.call_utils.get_bt_connection_status_using_adb_command(self.discoverer)
-        logging.info("BT State after pairing : <%s>", bt_connection_state)
+           # Click on the target device.
+           self.discoverer.mbs.pressDeviceInBluetoothSettings(target_name)
 
-        # Open bluetooth settings.
-        self.call_utils.open_bluetooth_settings()
+           # Confirm that target device displays "disconnected"
+           summary = self.discoverer.mbs.getDeviceSummary()
+           asserts.assert_true(
+               constants.DISCONNECTED_SUMMARY_STATUS in summary,
+               "Expected \'%s\' in device summary after disconnecting, but found none"
+               % constants.DISCONNECTED_SUMMARY_STATUS
+           )
 
-        # Find the target device and disconnect it on the Level One page
-        target_name = self.target.mbs.btGetName()
-        self.call_utils.press_bluetooth_toggle_on_device(target_name)
-        self.call_utils.wait_with_log(10)
 
-        # Click on the target device.
-        self.discoverer.mbs.pressDeviceInBluetoothSettings(target_name)
+           # Open bluetooth settings and connect device on Level one page
+           self.call_utils.open_bluetooth_settings()
+           self.call_utils.press_bluetooth_toggle_on_device(target_name)
+           self.discoverer.mbs.waitUntilConnectionStatus("Connected")
 
-        # Confirm that target device displays "disconnected"
-        self.call_utils.wait_with_log(10)
-        summary = self.discoverer.mbs.getDeviceSummary()
-        asserts.assert_true(
-            constants.DISCONNECTED_SUMMARY_STATUS in summary,
-            "Expected \'%s\' in device summary after disconnecting, but found none"
-            % constants.DISCONNECTED_SUMMARY_STATUS
-        )
+           # Click on the target device.
+           self.call_utils.open_bluetooth_settings()
+           self.discoverer.mbs.pressDeviceInBluetoothSettings(target_name)
 
+           # Confirm that target device displays "connected"
+           summary = self.discoverer.mbs.getDeviceSummary()
+           asserts.assert_true(
+               constants.CONNECTED_SUMMARY_STATUS in summary,
+               "Expected \'%s\' in device summary after connecting, but found none"
+               % constants.CONNECTED_SUMMARY_STATUS
+           )
 
 if __name__ == '__main__':
-    # Take test args
-    common_main()
\ No newline at end of file
+   # Take test args
+   common_main()
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/dialer/Android.bp b/tests/automotive/mobly_tests/dialer/Android.bp
index dc68643f4..7606fbe31 100644
--- a/tests/automotive/mobly_tests/dialer/Android.bp
+++ b/tests/automotive/mobly_tests/dialer/Android.bp
@@ -24,7 +24,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -37,11 +37,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -51,7 +46,29 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
+
+python_test_host {
+    name: "BluetoothDialerOptionsTest",
+    main: "dialer_test_dialer_options_test.py",
+    srcs: ["dialer_test_dialer_options_test.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -70,6 +87,7 @@ python_test_host {
         },
     },
 }
+
 python_test_host {
     name: "BTContactSortTest",
     main: "dialer_test_sort_contacts_by_last_name.py",
@@ -77,7 +95,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -90,11 +108,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -104,7 +117,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -117,11 +130,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -131,7 +139,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -144,11 +152,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -171,11 +174,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -198,11 +196,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -212,7 +205,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -225,11 +218,28 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
+}
+
+python_test_host {
+    name: "SearchContactTest",
+    main: "dialer_test_search_contacts.py",
+    srcs: ["dialer_test_search_contacts.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
     },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
 }
 
 python_test_host {
@@ -252,11 +262,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -279,12 +284,8 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
+
 python_test_host {
     name: "CallingDeclineBtTest",
     main: "dialer_test_basic_calling_test_with_reject_call.py",
@@ -292,7 +293,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "BluetoothSMSTestLibrary"
+        "BluetoothSMSTestLibrary",
     ],
     test_suites: [
         "catbox",
@@ -304,16 +305,10 @@ python_test_host {
         // Package the snippet with the mobly test
         ":AutomotiveSnippet",
         ":PhoneSnippet",
-        "bt_3device_config.yaml"
+        "bt_3device_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
-
 python_test_host {
     name: "BluetoothMuteUnmuteCallTest",
     main: "dialer_test_mute_unmute_call.py",
@@ -334,11 +329,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -361,38 +351,28 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
-       name: "DialerCallFromHistoryTest",
-       main: "dialer_test_call_from_history.py",
-       srcs: ["dialer_test_call_from_history.py"],
-       libs: [
-           "mobly",
-           "utilities",
-           "bluetooth_test",
-       ],
-       test_suites: [
-           "catbox",
-       ],
-       test_options: {
-           unit_test: false,
-       },
-       device_common_data: [
-           // Package the snippet with the mobly test
-           ":AutomotiveSnippet",
-           ":PhoneSnippet",
-       ],
-       version: {
-           py3: {
-               embedded_launcher: true,
-           },
-       }
+    name: "DialerCallFromHistoryTest",
+    main: "dialer_test_call_from_history.py",
+    srcs: ["dialer_test_call_from_history.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
 }
 
 python_test_host {
@@ -402,7 +382,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -415,11 +395,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -429,7 +404,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -442,14 +417,8 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
-
 python_test_host {
     name: "BTContactSearchByFirstNameTest",
     main: "dialer_test_search_contacts_by_first_name.py",
@@ -457,7 +426,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -470,11 +439,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -484,7 +448,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -497,11 +461,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -511,7 +470,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -524,11 +483,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -536,9 +490,9 @@ python_test_host {
     main: "dialer_test_search_contacts_and_call.py",
     srcs: ["dialer_test_search_contacts_and_call.py"],
     libs: [
-            "mobly",
-            "utilities",
-            "bluetooth_test"
+        "mobly",
+        "utilities",
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -551,11 +505,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -566,7 +515,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -579,15 +528,8 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
-
-
 python_test_host {
     name: "BTDialerBluetoothSettingsReflection",
     main: "dialer_test_bluetooth_settings_reflection.py",
@@ -596,7 +538,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "bluetooth_test"
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -609,11 +551,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -624,7 +561,7 @@ python_test_host {
         "mobly",
         "utilities",
         "bluetooth_test",
-        "BluetoothSMSTestLibrary"
+        "BluetoothSMSTestLibrary",
     ],
     test_suites: [
         "catbox",
@@ -637,11 +574,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -653,7 +585,7 @@ python_test_host {
         "mobly",
         "utilities",
         "bluetooth_test",
-        "BluetoothSMSTestLibrary"
+        "BluetoothSMSTestLibrary",
     ],
     test_suites: [
         "catbox",
@@ -666,11 +598,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -682,7 +609,7 @@ python_test_host {
         "mobly",
         "utilities",
         "bluetooth_test",
-        "BluetoothSMSTestLibrary"
+        "BluetoothSMSTestLibrary",
     ],
     test_suites: [
         "catbox",
@@ -695,11 +622,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -711,7 +633,30 @@ python_test_host {
         "mobly",
         "utilities",
         "bluetooth_test",
-        "BluetoothSMSTestLibrary"
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
+
+python_test_host {
+    name: "BTDialerHFPProfile",
+    main: "dialer_test_profile_hfp_enabled_after_pair.py",
+    srcs: ["dialer_test_profile_hfp_enabled_after_pair.py"],
+
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
     ],
     test_suites: [
         "catbox",
@@ -729,4 +674,4 @@ python_test_host {
             embedded_launcher: true,
         },
     },
-}
\ No newline at end of file
+}
diff --git a/tests/automotive/mobly_tests/dialer/dialer_test_add_remove_favorite_contact.py b/tests/automotive/mobly_tests/dialer/dialer_test_add_remove_favorite_contact.py
index c68d85180..13736a3c4 100644
--- a/tests/automotive/mobly_tests/dialer/dialer_test_add_remove_favorite_contact.py
+++ b/tests/automotive/mobly_tests/dialer/dialer_test_add_remove_favorite_contact.py
@@ -52,6 +52,8 @@ class AddRemoveFavoriteContact(bluetooth_base_test.BluetoothBaseTest):
     # Adding the contacts to favorites from the favorites tab and verifying it
     self.call_utils.add_favorites_from_favorites_tab(
         contact_name)
+    self.call_utils.open_contacts()
+    self.call_utils.open_favorites()
     asserts.assert_true(self.discoverer.mbs.hasUIElementWithText(contact_name),
                         'Favorite contact should be displayed on Favorites Tab')
     self.discoverer.mbs.clickUIElementWithText(contact_name)
diff --git a/tests/automotive/mobly_tests/dialer/dialer_test_dialer_options_test.py b/tests/automotive/mobly_tests/dialer/dialer_test_dialer_options_test.py
new file mode 100644
index 000000000..f7658648f
--- /dev/null
+++ b/tests/automotive/mobly_tests/dialer/dialer_test_dialer_options_test.py
@@ -0,0 +1,67 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+
+
+
+from bluetooth_test import bluetooth_base_test
+from utilities.main_utils import common_main
+from mobly import asserts
+
+
+class BluetoothDialerOptionsTest(bluetooth_base_test.BluetoothBaseTest):
+
+
+   def setup_test(self):
+       # Pair the devices
+       self.bt_utils.pair_primary_to_secondary()
+       super().enable_recording()
+
+
+   def test_dialer_options(self):
+       """Test of dialer options
+        Steps include:
+        1. Launch Dialer app from App Launcher
+        2. Verify: Dialer Launches
+        3. Record Dialer Categories
+        Verify: 'Recents','Contacts','Favorites',Dialpad'  tabs are  showing
+        4. Verify: Search Lens, Settings displayed
+        5. Tap on Recents, Contacts, Favorites, Dialpad"""
+
+       self.call_utils.open_phone_app()
+       asserts.assert_true(self.discoverer.mbs.hasUIElementWithText("Recents"),
+                       'Recents menu is not displayed')
+       asserts.assert_true(self.discoverer.mbs.hasUIElementWithText("Contacts"),
+                           'Contacts menu is not displayed')
+       asserts.assert_true(self.discoverer.mbs.hasUIElementWithText("Favorites"),
+                           'Favorites menu is not displayed')
+       asserts.assert_true(self.discoverer.mbs.hasUIElementWithText("Dialpad"),
+                           'Dialpad menu is not displayed')
+       self.call_utils.verify_dialer_recents_tab()
+       self.call_utils.open_contacts()
+       self.call_utils.verify_dialer_contacts_tab()
+       self.call_utils.open_favorites()
+       self.call_utils.verify_dialer_favorites_tab()
+       self.call_utils.open_dialpad()
+       self.call_utils.verify_dialer_dialpad_tab()
+       self.call_utils.verify_dialer_search_lens()
+       self.call_utils.verify_dialer_settings()
+
+   def teardown_test(self):
+       self.call_utils.wait_with_log(5)
+       self.call_utils.press_home()
+       super().teardown_test()
+
+if __name__ == '__main__':
+   common_main()
diff --git a/tests/automotive/mobly_tests/dialer/dialer_test_profile_hfp_enabled_after_pair.py b/tests/automotive/mobly_tests/dialer/dialer_test_profile_hfp_enabled_after_pair.py
new file mode 100644
index 000000000..30dfa736c
--- /dev/null
+++ b/tests/automotive/mobly_tests/dialer/dialer_test_profile_hfp_enabled_after_pair.py
@@ -0,0 +1,58 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+"""Test of hfp profile after pairing
+ Steps include:
+        1) Pair the devices
+        3) Check the HfpClientConnectionService
+        4) Make a Phone call
+        5) End call on IVI device
+        6) Assert dialed number on the IVI device same as called ten digits number
+"""
+from mobly import asserts
+from bluetooth_test import bluetooth_base_test
+import logging
+from utilities import constants
+from utilities.main_utils import common_main
+
+
+class BluetoothHFPDialTest(bluetooth_base_test.BluetoothBaseTest):
+
+    def setup_test(self):
+        logging.info("Pairing phone to car head unit.")
+        self.bt_utils.pair_primary_to_secondary()
+        super().enable_recording()
+        self.target_name = self.target.mbs.btGetName()
+
+    def test_hfp_enabled_after_pairing(self):
+       logging.info("Validating HFP Profile after pairing")
+       bt_hfp_status_txt = self.call_utils.get_bt_profile_status_using_adb_command(self.discoverer, constants.BLUETOOTH_HFP)
+       logging.info("BT HFP Status: <%s>", bt_hfp_status_txt)
+       asserts.assert_true('HfpClientDeviceBlock' in bt_hfp_status_txt, 'HFP Profile is not mapped')
+
+       logging.info("Navigate to Bluetooth Settings")
+       self.call_utils.open_bluetooth_settings()
+       self.call_utils.wait_with_log(10)
+
+       logging.info("Navigate to Bluetooth Summary Screen")
+       self.discoverer.mbs.pressDeviceInBluetoothSettings(self.target_name)
+       asserts.assert_true(self.call_utils.is_phone_profile_enabled(), 'HFP Profile is not enabled on Summary Page')
+
+    def teardown_test(self):
+        self.call_utils.wait_with_log(5)
+        self.call_utils.press_home()
+        super().teardown_test()
+
+if __name__ == '__main__':
+    common_main()
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/dialer/dialer_test_search_contacts.py b/tests/automotive/mobly_tests/dialer/dialer_test_search_contacts.py
new file mode 100644
index 000000000..f6c0b01b2
--- /dev/null
+++ b/tests/automotive/mobly_tests/dialer/dialer_test_search_contacts.py
@@ -0,0 +1,52 @@
+"""
+  Copyright (C) 2025 The Android Open Source Project
+
+  Licensed under the Apache License, Version 2.0 (the "License");
+  you may not use this file except in compliance with the License.
+  You may obtain a copy of the License at
+
+       http://www.apache.org/licenses/LICENSE-2.0
+
+  Unless required by applicable law or agreed to in writing, software
+  distributed under the License is distributed on an "AS IS" BASIS,
+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  See the License for the specific language governing permissions and
+  limitations under the License.
+
+
+
+  Test Steps:
+1. Tap on Phone icon from facet rail or App launcher to launch Dialer app
+2. Go to Settings under Dialer-> Contact order
+3. Select Contact order with 'First name'
+4. Go to contacts and see that contact list sorted with Firstname ,Lastname
+
+"""
+
+from utilities import constants
+from utilities.main_utils import common_main
+from bluetooth_test import bluetooth_base_test
+
+
+class ContactSearchByFirstNameTest(bluetooth_base_test.BluetoothBaseTest):
+
+  def setup_test(self):
+    #Upload contacts to phone device
+    file_path = constants.PATH_TO_CONTACTS_VCF_FILE
+    #TODO- retest again after (b/308018112) is fixed.
+    #contacts were loadding manually fpr testing
+    self.call_utils.upload_vcf_contacts_to_device(self.target, file_path)
+
+    # Pair the devices
+    self.bt_utils.pair_primary_to_secondary()
+    super().enable_recording()
+
+  def test_sort_contacts_by_first_name(self):
+    # Navigate to the Contacts page
+    self.call_utils.open_phone_app()
+    self.call_utils.open_contacts()
+    self.call_utils.wait_with_log(constants.DEFAULT_WAIT_TIME_FIVE_SECS)
+    self.call_utils.search_contacts()
+
+if __name__ == '__main__':
+  common_main()
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/media/Android.bp b/tests/automotive/mobly_tests/media/Android.bp
index 989c7e5b0..1685972c9 100644
--- a/tests/automotive/mobly_tests/media/Android.bp
+++ b/tests/automotive/mobly_tests/media/Android.bp
@@ -37,11 +37,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -64,11 +59,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -91,11 +81,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -118,11 +103,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -145,11 +125,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -172,11 +147,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -199,11 +169,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -226,198 +191,158 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
     name: "BTMediaIsSongPlayingTest",
     main: "media_test_song_is_playing.py",
     srcs: ["media_test_song_is_playing.py"],
-     libs: [
-         "mobly",
-         "utilities",
-         "bluetooth_test",
-     ],
-     test_suites: [
-         "catbox",
-     ],
-     test_options: {
-         unit_test: false,
-     },
-     device_common_data: [
-         // Package the snippet with the mobly test
-         ":AutomotiveSnippet",
-         ":PhoneSnippet",
-     ],
-     version: {
-         py3: {
-             embedded_launcher: true,
-         },
-     },
- }
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
 
 python_test_host {
-     name: "BTMediaIsAbleToSwitchAppTest",
-     main: "media_test_switch_app_validation.py",
-     srcs: ["media_test_switch_app_validation.py"],
-      libs: [
-          "mobly",
-          "utilities",
-          "bluetooth_test",
-      ],
-      test_suites: [
-          "catbox",
-      ],
-      test_options: {
-          unit_test: false,
-      },
-      device_common_data: [
-          // Package the snippet with the mobly test
-          ":AutomotiveSnippet",
-          ":PhoneSnippet",
-      ],
-      version: {
-          py3: {
-              embedded_launcher: true,
-          },
-      },
-  }
+    name: "BTMediaIsAbleToSwitchAppTest",
+    main: "media_test_switch_app_validation.py",
+    srcs: ["media_test_switch_app_validation.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
 
- python_test_host {
-     name: "BTMediaSynchronizedAfterReconnect",
-     main: "media_test_synchronized_device_disconnected_connected.py",
-     srcs: ["media_test_synchronized_device_disconnected_connected.py"],
-      libs: [
-          "mobly",
-          "utilities",
-          "bluetooth_test"
-      ],
-      test_suites: [
-          "catbox",
-      ],
-      test_options: {
-          unit_test: false,
-      },
-      device_common_data: [
-          // Package the snippet with the mobly test
-          ":AutomotiveSnippet",
-          ":PhoneSnippet",
-      ],
-      version: {
-          py3: {
-              embedded_launcher: true,
-          },
-      },
-  }
+python_test_host {
+    name: "BTMediaSynchronizedAfterReconnect",
+    main: "media_test_synchronized_device_disconnected_connected.py",
+    srcs: ["media_test_synchronized_device_disconnected_connected.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
 
- python_test_host {
-     name: "BTMediaIsSongPlayingAfterReboot",
-     main: "media_test_play_status_after_reboot.py",
-     srcs: ["media_test_play_status_after_reboot.py"],
-      libs: [
-          "mobly",
-          "utilities",
-          "bluetooth_test"
-      ],
-      test_suites: [
-          "catbox",
-      ],
-      test_options: {
-          unit_test: false,
-      },
-      device_common_data: [
-          // Package the snippet with the mobly test
-          ":AutomotiveSnippet",
-          ":PhoneSnippet",
-      ],
-      version: {
-          py3: {
-              embedded_launcher: true,
-          },
-      },
-  }
+python_test_host {
+    name: "BTMediaIsSongPlayingAfterReboot",
+    main: "media_test_play_status_after_reboot.py",
+    srcs: ["media_test_play_status_after_reboot.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
 
- python_test_host {
-     name: "BTMediaIsMediaMetadataValidOnHu",
-     main: "media_test_song_metadata_validation.py",
-     srcs: ["media_test_song_metadata_validation.py"],
-      libs: [
-          "mobly",
-          "utilities",
-          "bluetooth_test"
-      ],
-      test_suites: [
-          "catbox",
-      ],
-      test_options: {
-          unit_test: false,
-      },
-      device_common_data: [
-          // Package the snippet with the mobly test
-          ":AutomotiveSnippet",
-          ":PhoneSnippet",
-      ],
-      version: {
-          py3: {
-              embedded_launcher: true,
-          },
-      },
-  }
+python_test_host {
+    name: "BTMediaIsMediaMetadataValidOnHu",
+    main: "media_test_song_metadata_validation.py",
+    srcs: ["media_test_song_metadata_validation.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
 
-   python_test_host {
-       name: "BTMediaIsNoePlayingLabelDisplayedOnHu",
-       main: "media_test_now_playing_label_displayed.py",
-       srcs: ["media_test_now_playing_label_displayed.py"],
-        libs: [
-            "mobly",
-            "utilities",
-            "bluetooth_test"
-        ],
-        test_suites: [
-            "catbox",
-        ],
-        test_options: {
-            unit_test: false,
-        },
-        device_common_data: [
-            // Package the snippet with the mobly test
-            ":AutomotiveSnippet",
-            ":PhoneSnippet",
-        ],
-        version: {
-            py3: {
-                embedded_launcher: true,
-            },
-        },
-    }
+python_test_host {
+    name: "BTMediaIsNoePlayingLabelDisplayedOnHu",
+    main: "media_test_now_playing_label_displayed.py",
+    srcs: ["media_test_now_playing_label_displayed.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
 
-   python_test_host {
-       name: "BTMediaPlaylistRenderingOnHu",
-       main: "media_test_playlist_rendering.py",
-       srcs: ["media_test_playlist_rendering.py"],
-        libs: [
-            "mobly",
-            "utilities",
-            "bluetooth_test"
-        ],
-        test_suites: [
-            "catbox",
-        ],
-        test_options: {
-            unit_test: false,
-        },
-        device_common_data: [
-            // Package the snippet with the mobly test
-            ":AutomotiveSnippet",
-            ":PhoneSnippet",
-        ],
-        version: {
-            py3: {
-                embedded_launcher: true,
-            },
-        },
-    }
+python_test_host {
+    name: "BTMediaPlaylistRenderingOnHu",
+    main: "media_test_playlist_rendering.py",
+    srcs: ["media_test_playlist_rendering.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "bluetooth_test",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+    ],
+}
diff --git a/tests/automotive/mobly_tests/notifications/Android.bp b/tests/automotive/mobly_tests/notifications/Android.bp
new file mode 100644
index 000000000..ef4f8f039
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/Android.bp
@@ -0,0 +1,213 @@
+// Copyright (C) 2024 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+python_test_host {
+    name: "NotificationsSmsHunDisplayed",
+    main: "test_sms_hun_displayed.py",
+    srcs: ["test_sms_hun_displayed.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+        "bt_notifications_config.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "NotificationsSmsHunDisplayedInDrivingMode",
+    main: "test_sms_hun_displayed_in_driving_mode.py",
+    srcs: ["test_sms_hun_displayed_in_driving_mode.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+        "bt_notifications_config.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "NotificationsSmsHunPlayInDrivingMode",
+    main: "test_sms_hun_play_in_driving_mode.py",
+    srcs: ["test_sms_hun_play_in_driving_mode.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+        "bt_notifications_config.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "NotificationsSmsHunMute",
+    main: "test_sms_hun_mute.py",
+    srcs: ["test_sms_hun_mute.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+        "bt_notifications_config.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "NotificationsSmsHunMutedNotDisplayed",
+    main: "test_sms_hun_muted_not_displayed.py",
+    srcs: ["test_sms_hun_muted_not_displayed.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+        "bt_notifications_config.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "NotificationsSmsHunUnmute",
+    main: "test_sms_hun_unmute.py",
+    srcs: ["test_sms_hun_unmute.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+        "bt_notifications_config.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
+
+python_test_host {
+    name: "NotificationsSmsHunSwipe",
+    main: "test_sms_hun_swipe.py",
+    srcs: ["test_sms_hun_swipe.py"],
+    libs: [
+        "mobly",
+        "utilities",
+        "BluetoothSMSTestLibrary",
+    ],
+    test_suites: [
+        "catbox",
+    ],
+    test_options: {
+        unit_test: false,
+    },
+    device_common_data: [
+        // Package the snippet with the mobly test
+        ":AutomotiveSnippet",
+        ":PhoneSnippet",
+        "bt_notifications_config.yaml",
+    ],
+    version: {
+        py3: {
+            embedded_launcher: true,
+        },
+    },
+}
diff --git a/tests/automotive/mobly_tests/notifications/bt_notifications_config.yaml b/tests/automotive/mobly_tests/notifications/bt_notifications_config.yaml
new file mode 100644
index 000000000..72ef70c81
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/bt_notifications_config.yaml
@@ -0,0 +1,10 @@
+TestBeds:
+  - Name: ThreeDeviceTestBed
+    Controllers:
+      AndroidDevice:
+      - serial: serial_number
+        label: auto
+      - serial: serial_number
+        label: phone
+      - serial: serial_number
+        label: phone_notpaired
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/notifications/test_sms_hun_displayed.py b/tests/automotive/mobly_tests/notifications/test_sms_hun_displayed.py
new file mode 100644
index 000000000..3596e0219
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/test_sms_hun_displayed.py
@@ -0,0 +1,92 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+
+from bluetooth_sms_test import bluetooth_sms_base_test
+from mobly.controllers import android_device
+from utilities import constants
+from utilities.common_utils import CommonUtils
+from utilities.faker import fake
+from utilities.main_utils import common_main
+
+
+class NotificationsSmsHunDisplayed(
+    bluetooth_sms_base_test.BluetoothSMSBaseTest
+):
+
+  def setup_class(self):
+    super().setup_class()
+    self.common_utils = CommonUtils(self.target, self.discoverer)
+
+  def setup_test(self):
+    logging.info("Pairing phone to car head unit.")
+    self.bt_utils.pair_primary_to_secondary()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.common_utils.click_on_ui_element_with_text("Allow")
+
+    logging.info("Clearing the sms from the phone.")
+    self.call_utils.clear_sms_app(self.target)
+
+    logging.info("Removing mbs snippet and rebooting the phone.")
+    self.target.unload_snippet('mbs')
+    self.target.reboot()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+    super().enable_recording()
+
+  def test_sms_hun_displayed(self):
+    """
+    GIVEN the phone which is paired to the car,
+    WHEN the SMS is sent to paired phone,
+    THEN the SMS appears as a heads-up notification on the car's head unit.
+    """
+    receiver_phone_number = self.target.mbs.getPhoneNumber()
+    sender_phone_number = self.phone_notpaired.mbs.getPhoneNumber()
+    sms_text = fake.string
+
+    logging.info(f"Act: Sending SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: SMS is displayed as a heads-up notification in the car's head unit.")
+    assert self.discoverer.mbs.isSmsHunDisplayed() is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification with the correct title."
+    )
+
+  def teardown_test(self):
+    self.call_utils.press_home()
+
+    try:
+      super().teardown_test()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to teardown test: %s", e)
+
+
+if __name__ == "__main__":
+  common_main()
diff --git a/tests/automotive/mobly_tests/notifications/test_sms_hun_displayed_in_driving_mode.py b/tests/automotive/mobly_tests/notifications/test_sms_hun_displayed_in_driving_mode.py
new file mode 100644
index 000000000..8c2d608c2
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/test_sms_hun_displayed_in_driving_mode.py
@@ -0,0 +1,112 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+
+from bluetooth_sms_test import bluetooth_sms_base_test
+from mobly.controllers import android_device
+from utilities import constants
+from utilities.common_utils import CommonUtils
+from utilities.faker import fake
+from utilities.main_utils import common_main
+
+
+class NotificationsSmsHunDisplayedInDrivingMode(
+    bluetooth_sms_base_test.BluetoothSMSBaseTest
+):
+
+  def setup_class(self):
+    super().setup_class()
+    self.common_utils = CommonUtils(self.target, self.discoverer)
+
+  def setup_test(self):
+    logging.info("Pairing phone to car head unit.")
+    self.bt_utils.pair_primary_to_secondary()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.common_utils.click_on_ui_element_with_text("Allow")
+
+    logging.info("Clearing the sms from the phone.")
+    self.call_utils.clear_sms_app(self.target)
+
+    logging.info("Enabling driving mode.")
+    self.call_utils.enable_driving_mode()
+
+    logging.info("Removing mbs snippet and rebooting the phone.")
+    self.target.unload_snippet('mbs')
+    self.target.reboot()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+    super().enable_recording()
+
+  def test_sms_hun_displayed_in_driving_mode(self):
+    """
+    GIVEN the phone which is paired to the car,
+    WHEN the SMS is sent to paired phone,
+    THEN the SMS appears as a heads-up notification on the car's head unit,
+    AND the SMS appears in the notification center on the car.
+    """
+    receiver_phone_number = self.target.mbs.getPhoneNumber()
+    sender_phone_number = self.phone_notpaired.mbs.getPhoneNumber()
+    sms_text = fake.string
+
+    logging.info(f"Act: Sending SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: SMS is displayed as a heads-up notification in the car's head unit.")
+    assert self.discoverer.mbs.isSmsHunDisplayed() is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification with the correct title."
+    )
+
+    logging.info("Assert: Verify the content is not displayed in HUN.")
+    assert self.discoverer.mbs.getSmsHunContent(sender_phone_number) == "New message", (
+        "New SMS is displayed as a heads-up notification with the correct content."
+    )
+
+    logging.info("Assert: SMS is displayed in the notification center on the car.")
+    self.discoverer.mbs.waitForHunToDisappear()
+    assert self.discoverer.mbs.isNotificationDisplayedInCenterWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed in the notification center."
+    )
+
+  def teardown_test(self):
+    self.call_utils.press_home()
+
+    try:
+      self.call_utils.disable_driving_mode()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to disable driving mode: %s", e)
+
+    try:
+      super().teardown_test()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to teardown test: %s", e)
+
+
+if __name__ == "__main__":
+  common_main()
diff --git a/tests/automotive/mobly_tests/notifications/test_sms_hun_mute.py b/tests/automotive/mobly_tests/notifications/test_sms_hun_mute.py
new file mode 100644
index 000000000..32b91ed20
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/test_sms_hun_mute.py
@@ -0,0 +1,101 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+
+from bluetooth_sms_test import bluetooth_sms_base_test
+from mobly.controllers import android_device
+from utilities import constants
+from utilities.common_utils import CommonUtils
+from utilities.faker import fake
+from utilities.main_utils import common_main
+
+
+class NotificationsSmsHunMute(
+    bluetooth_sms_base_test.BluetoothSMSBaseTest
+):
+
+  def setup_class(self):
+    super().setup_class()
+    self.common_utils = CommonUtils(self.target, self.discoverer)
+
+  def setup_test(self):
+    logging.info("Pairing phone to car head unit.")
+    self.bt_utils.pair_primary_to_secondary()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.common_utils.click_on_ui_element_with_text("Allow")
+
+    logging.info("Clearing the sms from the phone.")
+    self.call_utils.clear_sms_app(self.target)
+
+    logging.info("Removing mbs snippet and rebooting the phone.")
+    self.target.unload_snippet('mbs')
+    self.target.reboot()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+    super().enable_recording()
+
+  def test_sms_hun_mute(self):
+    """
+    GIVEN a SMS HUN is displayed in the car's head unit,
+    WHEN the SMS HUN is muted,
+    THEN the notification should dismiss.
+    """
+    logging.info("Arrange: Get the phone number of phone to send the SMS.")
+    receiver_phone_number = self.target.mbs.getPhoneNumber()
+    sender_phone_number = self.phone_notpaired.mbs.getPhoneNumber()
+    sms_text = fake.string
+
+    logging.info(f"Act: Sending new SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: New SMS is displayed as a heads-up notification.")
+    assert self.discoverer.mbs.isSmsHunDisplayed() is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification with the correct title."
+    )
+
+    logging.info("Act: Mute the SMS in the car's head unit.")
+    self.discoverer.mbs.muteSmsHun(sender_phone_number)
+
+    logging.info("Assert: SMS HUN is dismissed.")
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is False, (
+        "SMS HUN is not dismissed after mute."
+    )
+
+  def teardown_test(self):
+    self.call_utils.press_home()
+
+    try:
+      super().teardown_test()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to teardown test: %s", e)
+
+
+if __name__ == "__main__":
+  common_main()
diff --git a/tests/automotive/mobly_tests/notifications/test_sms_hun_muted_not_displayed.py b/tests/automotive/mobly_tests/notifications/test_sms_hun_muted_not_displayed.py
new file mode 100644
index 000000000..d55c19abd
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/test_sms_hun_muted_not_displayed.py
@@ -0,0 +1,104 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+
+from bluetooth_sms_test import bluetooth_sms_base_test
+from mobly.controllers import android_device
+from utilities import constants
+from utilities.common_utils import CommonUtils
+from utilities.faker import fake
+from utilities.main_utils import common_main
+
+
+class NotificationsSmsHunMutedNotDisplayed(
+    bluetooth_sms_base_test.BluetoothSMSBaseTest
+):
+
+  def setup_class(self):
+    super().setup_class()
+    self.common_utils = CommonUtils(self.target, self.discoverer)
+
+  def setup_test(self):
+    logging.info("Pairing phone to car head unit.")
+    self.bt_utils.pair_primary_to_secondary()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.common_utils.click_on_ui_element_with_text("Allow")
+
+    logging.info("Clearing the sms from the phone.")
+    self.call_utils.clear_sms_app(self.target)
+
+    logging.info("Removing mbs snippet and rebooting the phone.")
+    self.target.unload_snippet('mbs')
+    self.target.reboot()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+    super().enable_recording()
+
+  def test_sms_hun_muted_not_displayed(self):
+    """
+    GIVEN a SMS HUN is displayed in the car's head unit,
+    WHEN the SMS HUN is muted,
+    THEN the new SMS HUN should not be displayed in the car's head unit for this conversation.
+    """
+    logging.info("Arrange: Get the phone number of phone to send the SMS.")
+    receiver_phone_number = self.target.mbs.getPhoneNumber()
+    sender_phone_number = self.phone_notpaired.mbs.getPhoneNumber()
+    sms_text = fake.string
+
+    logging.info(f"Act: Sending new SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: New SMS is displayed as a heads-up notification.")
+    assert self.discoverer.mbs.isSmsHunDisplayed() is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification with the correct title."
+    )
+
+    logging.info("Act: Mute the SMS in the car's head unit.")
+    self.discoverer.mbs.muteSmsHun(sender_phone_number)
+
+    logging.info("Act: Sending new SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: New SMS is not displayed as a heads-up notification.")
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is False, (
+        "New SMS is displayed as a heads-up notification even after mute."
+    )
+
+  def teardown_test(self):
+    self.call_utils.press_home()
+
+    try:
+      super().teardown_test()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to teardown test: %s", e)
+
+
+if __name__ == "__main__":
+  common_main()
diff --git a/tests/automotive/mobly_tests/notifications/test_sms_hun_play_in_driving_mode.py b/tests/automotive/mobly_tests/notifications/test_sms_hun_play_in_driving_mode.py
new file mode 100644
index 000000000..e0d71f46f
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/test_sms_hun_play_in_driving_mode.py
@@ -0,0 +1,112 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+
+from bluetooth_sms_test import bluetooth_sms_base_test
+from mobly.controllers import android_device
+from utilities import constants
+from utilities.common_utils import CommonUtils
+from utilities.faker import fake
+from utilities.main_utils import common_main
+
+
+class NotificationsSmsHunPlayInDrivingMode(
+    bluetooth_sms_base_test.BluetoothSMSBaseTest
+):
+
+  def setup_class(self):
+    super().setup_class()
+    self.common_utils = CommonUtils(self.target, self.discoverer)
+
+  def setup_test(self):
+    logging.info("Pairing phone to car head unit.")
+    self.bt_utils.pair_primary_to_secondary()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.common_utils.click_on_ui_element_with_text("Allow")
+
+    logging.info("Clearing the sms from the phone.")
+    self.call_utils.clear_sms_app(self.target)
+
+    logging.info("Enabling driving mode.")
+    self.call_utils.enable_driving_mode()
+
+    logging.info("Removing mbs snippet and rebooting the phone.")
+    self.target.unload_snippet('mbs')
+    self.target.reboot()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+    super().enable_recording()
+
+  def test_sms_hun_play_in_driving_mode(self):
+    """
+    GIVEN the phone which is paired to the car,
+    WHEN the SMS is sent to paired phone,
+    THEN the SMS appears as a heads-up notification on the car's head unit,
+    WHEN the SMS is played,
+    THEN the SMS is played on the car's head unit via car's speaker.
+    """
+
+    logging.info("Arrange: Get the phone number of phone to send the SMS.")
+    receiver_phone_number = self.target.mbs.getPhoneNumber()
+    sender_phone_number = self.phone_notpaired.mbs.getPhoneNumber()
+    sms_text = fake.string
+
+    logging.info(f"Act: Sending new SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: New SMS is displayed as a heads-up notification.")
+    assert self.discoverer.mbs.isSmsHunDisplayed() is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification with the correct title."
+    )
+
+    logging.info("Act: Playing the SMS in the car's head unit.")
+    self.discoverer.mbs.playSmsHun(sender_phone_number)
+
+    logging.info("Assert: SMS is played on the car's head unit via car's speaker.")
+    assert self.discoverer.mbs.isSmsHunPlayedViaCarSpeaker() is True, (
+        "SMS is not played on the car's head unit via car's speaker."
+    )
+
+  def teardown_test(self):
+    self.call_utils.press_home()
+
+    try:
+      self.call_utils.disable_driving_mode()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to disable driving mode: %s", e)
+
+    try:
+      super().teardown_test()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to teardown test: %s", e)
+
+
+if __name__ == "__main__":
+  common_main()
diff --git a/tests/automotive/mobly_tests/notifications/test_sms_hun_swipe.py b/tests/automotive/mobly_tests/notifications/test_sms_hun_swipe.py
new file mode 100644
index 000000000..264a437e8
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/test_sms_hun_swipe.py
@@ -0,0 +1,101 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+
+from bluetooth_sms_test import bluetooth_sms_base_test
+from mobly.controllers import android_device
+from utilities import constants
+from utilities.common_utils import CommonUtils
+from utilities.faker import fake
+from utilities.main_utils import common_main
+
+
+class NotificationsSmsHunSwipe(
+    bluetooth_sms_base_test.BluetoothSMSBaseTest
+):
+
+  def setup_class(self):
+    super().setup_class()
+    self.common_utils = CommonUtils(self.target, self.discoverer)
+
+  def setup_test(self):
+    logging.info("Pairing phone to car head unit.")
+    self.bt_utils.pair_primary_to_secondary()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.common_utils.click_on_ui_element_with_text("Allow")
+
+    logging.info("Clearing the sms from the phone.")
+    self.call_utils.clear_sms_app(self.target)
+
+    logging.info("Removing mbs snippet and rebooting the phone.")
+    self.target.unload_snippet('mbs')
+    self.target.reboot()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+    super().enable_recording()
+
+  def test_sms_hun_swipe(self):
+    """
+    GIVEN a SMS HUN is displayed in the car's head unit,
+    WHEN the SMS HUN is swiped,
+    THEN the notification should dismiss.
+    """
+    logging.info("Arrange: Get the phone number of phone to send the SMS.")
+    receiver_phone_number = self.target.mbs.getPhoneNumber()
+    sender_phone_number = self.phone_notpaired.mbs.getPhoneNumber()
+    sms_text = fake.string
+
+    logging.info(f"Act: Sending new SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: New SMS is displayed as a heads-up notification.")
+    assert self.discoverer.mbs.isSmsHunDisplayed() is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification with the correct title."
+    )
+
+    logging.info("Act: Swipe the SMS in the car's head unit.")
+    self.discoverer.mbs.swipeHun(sender_phone_number)
+
+    logging.info("Assert: SMS HUN is dismissed.")
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is False, (
+        "SMS HUN is not dismissed after swipe."
+    )
+
+  def teardown_test(self):
+    self.call_utils.press_home()
+
+    try:
+      super().teardown_test()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to teardown test: %s", e)
+
+
+if __name__ == "__main__":
+  common_main()
diff --git a/tests/automotive/mobly_tests/notifications/test_sms_hun_unmute.py b/tests/automotive/mobly_tests/notifications/test_sms_hun_unmute.py
new file mode 100644
index 000000000..16aa22cd4
--- /dev/null
+++ b/tests/automotive/mobly_tests/notifications/test_sms_hun_unmute.py
@@ -0,0 +1,128 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+import logging
+
+from bluetooth_sms_test import bluetooth_sms_base_test
+from mobly.controllers import android_device
+from utilities import constants
+from utilities.common_utils import CommonUtils
+from utilities.faker import fake
+from utilities.main_utils import common_main
+
+
+class NotificationsSmsHunUnmute(
+    bluetooth_sms_base_test.BluetoothSMSBaseTest
+):
+
+  def setup_class(self):
+    super().setup_class()
+    self.common_utils = CommonUtils(self.target, self.discoverer)
+
+  def setup_test(self):
+    logging.info("Pairing phone to car head unit.")
+    self.bt_utils.pair_primary_to_secondary()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.common_utils.click_on_ui_element_with_text("Allow")
+
+    logging.info("Clearing the sms from the phone.")
+    self.call_utils.clear_sms_app(self.target)
+
+    logging.info("Removing mbs snippet and rebooting the phone.")
+    self.target.unload_snippet('mbs')
+    self.target.reboot()
+    self.call_utils.wait_with_log(constants.DEVICE_CONNECT_WAIT_TIME)
+    self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+    super().enable_recording()
+
+  def test_sms_hun_unmute(self):
+    """
+    GIVEN a SMS HUN is displayed in the car's head unit,
+    WHEN the SMS HUN is muted,
+    THEN the new SMS HUN should not be displayed in the car's head unit for this conversation,
+    AND the SMS HUN should be be displayed in notification center in the car's head unit.
+    WHEN the SMS HUN is unmuted in SMS app in the car's head unit,
+    THEN the new SMS HUN should be displayed in the car's head unit for this conversation.
+    AND the SMS HUN should be be displayed in notification center in the car's head unit.
+    """
+    logging.info("Arrange: Get the phone number of phone to send the SMS.")
+    receiver_phone_number = self.target.mbs.getPhoneNumber()
+    sender_phone_number = self.phone_notpaired.mbs.getPhoneNumber()
+    sms_text = fake.string
+
+    logging.info(f"Act: Sending new SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text)
+
+    logging.info("Assert: New SMS is displayed as a heads-up notification.")
+    assert self.discoverer.mbs.isSmsHunDisplayed() is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification with the correct title."
+    )
+
+    logging.info("Act: Mute the SMS in the car's head unit.")
+    self.discoverer.mbs.muteSmsHun(sender_phone_number)
+
+    logging.info("Assert: SMS HUN is dismissed.")
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is False, (
+        "SMS HUN is not dismissed after mute."
+    )
+
+    logging.info("Assert: SMS is not displayed in notification center.")
+    self.discoverer.mbs.waitForHunToDisappear()
+    assert self.discoverer.mbs.isNotificationDisplayedInCenterWithTitle(sender_phone_number) is False, (
+        "SMS is still displayed in the notification center after mute."
+    )
+
+    logging.info(f"Act: Unmute the conversation from the SMS app in the car's head unit with title {sender_phone_number}.")
+    self.discoverer.mbs.unmuteConversationWithTitle(sender_phone_number)
+
+    logging.info(f"Act: Sending new SMS to {receiver_phone_number}")
+    self.phone_notpaired.mbs.sendSms(receiver_phone_number, sms_text + "2")
+
+    logging.info("Assert: New SMS is displayed as a heads-up notification.")
+    assert self.discoverer.mbs.isSmsHunDisplayedWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed as a heads-up notification."
+    )
+
+    logging.info("Assert: New SMS is displayed in notification center.")
+    self.discoverer.mbs.waitForHunToDisappear()
+    assert self.discoverer.mbs.isNotificationDisplayedInCenterWithTitle(sender_phone_number) is True, (
+        "New SMS is not displayed in the notification center."
+    )
+
+  def teardown_test(self):
+    self.call_utils.press_home()
+
+    try:
+      super().teardown_test()
+    except Exception as e:  # pylint: disable=broad-except
+      logging.info("Failed to teardown test: %s", e)
+
+
+if __name__ == "__main__":
+  common_main()
diff --git a/tests/automotive/mobly_tests/pairing/Android.bp b/tests/automotive/mobly_tests/pairing/Android.bp
index 63e446fe8..1e4f77ac6 100644
--- a/tests/automotive/mobly_tests/pairing/Android.bp
+++ b/tests/automotive/mobly_tests/pairing/Android.bp
@@ -38,9 +38,4 @@ python_test_host {
         ":PhoneSnippet",
         "bt_discovery_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
diff --git a/tests/automotive/mobly_tests/perfromance/Android.bp b/tests/automotive/mobly_tests/perfromance/Android.bp
index 830416ecd..71ef35efe 100644
--- a/tests/automotive/mobly_tests/perfromance/Android.bp
+++ b/tests/automotive/mobly_tests/perfromance/Android.bp
@@ -37,9 +37,4 @@ python_test_host {
         ":PhoneSnippet",
         "bt_performance_10_iterations.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
diff --git a/tests/automotive/mobly_tests/sms/Android.bp b/tests/automotive/mobly_tests/sms/Android.bp
index 1923b292b..a579751a9 100644
--- a/tests/automotive/mobly_tests/sms/Android.bp
+++ b/tests/automotive/mobly_tests/sms/Android.bp
@@ -36,11 +36,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -63,11 +58,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -91,11 +81,6 @@ python_test_host {
         ":PhoneSnippet",
         "bt_sms_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -119,11 +104,6 @@ python_test_host {
         ":PhoneSnippet",
         "bt_sms_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -147,11 +127,6 @@ python_test_host {
         ":PhoneSnippet",
         "bt_sms_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -175,11 +150,6 @@ python_test_host {
         ":PhoneSnippet",
         "bt_sms_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -203,11 +173,6 @@ python_test_host {
         ":PhoneSnippet",
         "bt_sms_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -231,11 +196,6 @@ python_test_host {
         ":PhoneSnippet",
         "bt_sms_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -259,9 +219,4 @@ python_test_host {
         ":PhoneSnippet",
         "bt_sms_config.yaml",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
diff --git a/tests/automotive/mobly_tests/sms/bt_sms_new_unread_sms_auto_sync_test.py b/tests/automotive/mobly_tests/sms/bt_sms_new_unread_sms_auto_sync_test.py
index 04709b119..bc8200582 100644
--- a/tests/automotive/mobly_tests/sms/bt_sms_new_unread_sms_auto_sync_test.py
+++ b/tests/automotive/mobly_tests/sms/bt_sms_new_unread_sms_auto_sync_test.py
@@ -1,4 +1,4 @@
-#  Copyright (C) 2023 The Android Open Source Project
+#  Copyright (C) 2025 The Android Open Source Project
 #
 #  Licensed under the Apache License, Version 2.0 (the "License");
 #  you may not use this file except in compliance with the License.
@@ -24,7 +24,9 @@
 #  See the License for the specific language governing permissions and
 #  limitations under the License.
 
+import logging
 
+from mobly import asserts
 from utilities import constants
 from utilities.main_utils import common_main
 from utilities.common_utils import CommonUtils
@@ -42,21 +44,22 @@ class SMSNewUnreadSMSAutoSyncTest(bluetooth_sms_base_test.BluetoothSMSBaseTest):
 
     def setup_test(self):
 
-        # pair the devices
+        logging.info("Pairing phone to car head unit.")
         self.bt_utils.pair_primary_to_secondary()
 
-        # wait for user permissions popup & give contacts and sms permissions
+        logging.info("wait for user permissions popup & give contacts and sms permissions")
         self.call_utils.wait_with_log(20)
         self.common_utils.click_on_ui_element_with_text('Allow')
 
-        # Clearing the sms from the phone
+        logging.info("Clearing the sms from the phone.")
         self.call_utils.clear_sms_app(self.target)
-        # Reboot Phone
+        self.call_utils.wait_with_log(10)
+
+        logging.info("Rebooting the phone.")
         self.target.unload_snippet('mbs')
         self.target.reboot()
         self.call_utils.wait_with_log(30)
         self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
-        super().enable_recording()
 
     def test_new_unread_sms_auto_sync(self):
         # To test that new unread sms appear on HU
@@ -64,23 +67,29 @@ class SMSNewUnreadSMSAutoSyncTest(bluetooth_sms_base_test.BluetoothSMSBaseTest):
         # Open the sms app
         self.call_utils.open_sms_app()
 
-        # Verify that there is no new sms currently
-        self.call_utils.verify_sms_app_unread_message(False)
+        logging.info("Verifying that there is no existing test sms ")
+        asserts.assert_false(self.common_utils.has_ui_element_with_text(constants.SMS_TEXT),
+            'Messages app should not contain old test msg, app did not clear.')
 
-        # send a new sms
+        logging.info("Sending the sms from unpaired phone to paired phone")
         target_phone_number = self.target.mbs.getPhoneNumber()
+        logging.info(target_phone_number)
         self.phone_notpaired.mbs.sendSms(target_phone_number,constants.SMS_TEXT)
         self.call_utils.wait_with_log(constants.BT_DEFAULT_TIMEOUT)
 
-        # perform the verifications
-        self.call_utils.verify_sms_app_unread_message(True)
-        self.call_utils.verify_sms_preview_text(True, constants.SMS_TEXT)
-        self.call_utils.verify_sms_preview_timestamp(True)
+        logging.info("Performing the verifications")
+        asserts.assert_true(self.call_utils.verify_sms_preview_text(constants.SMS_TEXT),
+            'Messages app should contain new test message but found none')
+        asserts.assert_true(self.call_utils.verify_sms_app_unread_message(),
+            'Messages app should have unread badge, but found none')
+        asserts.assert_true(self.call_utils.verify_sms_preview_timestamp(),
+            'Messages app contain the timestamp')
 
     def teardown_test(self):
         # Go to home screen
         self.call_utils.press_home()
-        super().teardown_test()
+        self.call_utils.open_sms_app()
+        super().teardown_no_video_recording()
 
 if __name__ == '__main__':
     common_main()
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/sms/bt_sms_no_messages_test.py b/tests/automotive/mobly_tests/sms/bt_sms_no_messages_test.py
index e29c82358..2ee9d89b8 100644
--- a/tests/automotive/mobly_tests/sms/bt_sms_no_messages_test.py
+++ b/tests/automotive/mobly_tests/sms/bt_sms_no_messages_test.py
@@ -1,4 +1,4 @@
-#  Copyright (C) 2023 The Android Open Source Project
+#  Copyright (C) 2025 The Android Open Source Project
 #
 #  Licensed under the Apache License, Version 2.0 (the "License");
 #  you may not use this file except in compliance with the License.
@@ -24,7 +24,8 @@
 #  See the License for the specific language governing permissions and
 #  limitations under the License.
 
-
+import logging
+from mobly import asserts
 from bluetooth_sms_test import bluetooth_sms_base_test
 from mobly.controllers import android_device
 from utilities.main_utils import common_main
@@ -33,23 +34,25 @@ from utilities.common_utils import CommonUtils
 # Number of seconds for the target to stay discoverable on Bluetooth.
 DISCOVERABLE_TIME = 60
 
-class SMSNewUnreadSMSAutoSyncTest(bluetooth_sms_base_test.BluetoothSMSBaseTest):
+class SMSNoSMSTest(bluetooth_sms_base_test.BluetoothSMSBaseTest):
 
     def setup_class(self):
       super().setup_class()
       self.common_utils = CommonUtils(self.target, self.discoverer)
+
     def setup_test(self):
 
-      # pair the devices
+      logging.info("Pairing phone to car head unit.")
       self.bt_utils.pair_primary_to_secondary()
 
-      # wait for user permissions popup & give contacts and sms permissions
+      logging.info("wait for user permissions popup & give contacts and sms permissions")
       self.call_utils.wait_with_log(20)
       self.common_utils.click_on_ui_element_with_text('Allow')
 
-      # Clearing the sms from the phone
+      logging.info("Clearing the sms from the phone.")
       self.call_utils.clear_sms_app(self.target)
-      # Reboot Phone
+
+      logging.info("Rebooting the phone.")
       self.target.unload_snippet('mbs')
       self.target.reboot()
       self.call_utils.wait_with_log(30)
@@ -57,13 +60,15 @@ class SMSNewUnreadSMSAutoSyncTest(bluetooth_sms_base_test.BluetoothSMSBaseTest):
       super().enable_recording()
 
     def test_no_messages_sms(self):
-      # To test 'No messages' appears on HU, when there is no sms
+      # To test 'No messages text' appears on HU, when there is no sms
 
       # Open the sms app
       self.call_utils.open_sms_app()
 
-      # Verify that there is no new sms currently
-      self.call_utils.verify_sms_no_messages_displayed(True)
+      logging.info("Verifying that there is no sms currently")
+      asserts.assert_true(self.call_utils.verify_sms_no_messages_displayed(),
+              'Message app should be empty and <<No Messages>> should be displayed, but found existing messages.')
+
 
     def teardown_test(self):
       # Go to home screen
diff --git a/tests/automotive/mobly_tests/sms/bt_sms_read_auto_sync_test.py b/tests/automotive/mobly_tests/sms/bt_sms_read_auto_sync_test.py
index 36807137b..1923de1d8 100644
--- a/tests/automotive/mobly_tests/sms/bt_sms_read_auto_sync_test.py
+++ b/tests/automotive/mobly_tests/sms/bt_sms_read_auto_sync_test.py
@@ -1,4 +1,4 @@
-#  Copyright (C) 2023 The Android Open Source Project
+#  Copyright (C) 2025 The Android Open Source Project
 #
 #  Licensed under the Apache License, Version 2.0 (the "License");
 #  you may not use this file except in compliance with the License.
@@ -24,6 +24,9 @@
 #  See the License for the specific language governing permissions and
 #  limitations under the License.
 
+import logging
+from mobly import asserts
+
 from utilities import constants
 from utilities.main_utils import common_main
 from utilities.common_utils import CommonUtils
@@ -38,47 +41,51 @@ class SMSReadAutoSync(bluetooth_sms_base_test.BluetoothSMSBaseTest):
 
     def setup_test(self):
 
-        # pair the devices
+        logging.info("Pairing phone to car head unit.")
         self.bt_utils.pair_primary_to_secondary()
 
-        # wait for user permissions popup & give contacts and sms permissions
+        logging.info("wait for user permissions popup & give contacts and sms permissions")
         self.call_utils.wait_with_log(20)
         self.common_utils.click_on_ui_element_with_text('Allow')
 
-        # Clearing the sms from the phone
+        logging.info("Clearing the sms from the phone.")
         self.call_utils.clear_sms_app(self.target)
-        # Reboot Phone
+
+        logging.info("Rebooting the phone.")
         self.target.unload_snippet('mbs')
         self.target.reboot()
         self.call_utils.wait_with_log(30)
         self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
 
-        # send a new sms
+        logging.info("Sending the sms from unpaired phone to paired phone")
         target_phone_number = self.target.mbs.getPhoneNumber()
         self.phone_notpaired.mbs.sendSms(target_phone_number,constants.SMS_TEXT)
         self.call_utils.wait_with_log(10)
-        super().enable_recording()
 
     def test_read_sms_auto_sync(self):
 
-        # Verify the new UNREAD sms in IVI device
+        logging.info("Verify the new UNREAD sms in IVI device")
         self.call_utils.open_sms_app()
-        self.call_utils.verify_sms_app_unread_message(True)
+        asserts.assert_true(self.call_utils.verify_sms_app_unread_message(),
+            'Message app should contain an unread msg, but there are no unread messages')
 
-        # READ the message on paired phone
+        logging.info("READ the message on paired phone")
         self.call_utils.open_notification_on_phone(self.target)
         self.call_utils.wait_with_log(5)
         self.target.mbs.clickUIElementWithText(constants.SMS_TEXT)
         self.call_utils.wait_with_log(5)
 
         # Verify the SYNC READ sms in IVI device
-        self.call_utils.verify_sms_app_unread_message(False)
-        self.call_utils.verify_sms_preview_timestamp(True)
+        asserts.assert_false(self.call_utils.verify_sms_app_unread_message(),
+              'Message app should not contain the unread msg, but contains one')
+        asserts.assert_true(self.call_utils.verify_sms_preview_timestamp(),
+            'Messages app contain the timestamp')
 
     def teardown_test(self):
          # Go to home screen
          self.call_utils.press_home()
-         super().teardown_test()
+         self.call_utils.open_sms_app()
+         super().teardown_no_video_recording()
 
 if __name__ == '__main__':
   common_main()
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/sms/bt_sms_read_messagebd_sync_test.py b/tests/automotive/mobly_tests/sms/bt_sms_read_messagebd_sync_test.py
index ef0b4fc34..37c5ca3ab 100644
--- a/tests/automotive/mobly_tests/sms/bt_sms_read_messagebd_sync_test.py
+++ b/tests/automotive/mobly_tests/sms/bt_sms_read_messagebd_sync_test.py
@@ -1,4 +1,4 @@
-#  Copyright (C) 2023 The Android Open Source Project
+#  Copyright (C) 2025 The Android Open Source Project
 #
 #  Licensed under the Apache License, Version 2.0 (the "License");
 #  you may not use this file except in compliance with the License.
@@ -24,6 +24,9 @@
 #  See the License for the specific language governing permissions and
 #  limitations under the License.
 
+import logging
+
+from mobly import asserts
 from utilities import constants
 from utilities.main_utils import common_main
 from utilities.common_utils import CommonUtils
@@ -38,53 +41,50 @@ class SMSReadMessageDBSync(bluetooth_sms_base_test.BluetoothSMSBaseTest):
 
     def setup_test(self):
 
-        # pair the devices
-        self.bt_utils.pair_primary_to_secondary()
-
-        # wait for user permissions popup & give contacts and sms permissions
-        self.call_utils.wait_with_log(20)
-        self.common_utils.click_on_ui_element_with_text('Allow')
-
-        # Clearing the sms from the phone
+        logging.info("Clearing the sms from the phone.")
         self.call_utils.clear_sms_app(self.target)
-        # Reboot Phone
+
+        logging.info("Rebooting the phone.")
         self.target.unload_snippet('mbs')
         self.target.reboot()
         self.call_utils.wait_with_log(30)
         self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
-        super().enable_recording()
 
-    def test_read_sms_messagedb_sync(self):
-        # Open the sms app
-        self.call_utils.open_sms_app()
-
-        # Verify that there is no new sms currently
-        #self.call_utils.verify_sms_app_unread_message(False)
-
-        # send a new sms
+        logging.info("Sending the sms from unpaired phone to paired phone")
         target_phone_number = self.target.mbs.getPhoneNumber()
         self.phone_notpaired.mbs.sendSms(target_phone_number,constants.SMS_TEXT)
         self.call_utils.wait_with_log(10)
 
-        # Verify the new UNREAD sms in IVI device
-        self.call_utils.open_sms_app()
-        self.call_utils.verify_sms_app_unread_message(True)
-
         # READ the message on paired phone
         self.call_utils.open_notification_on_phone(self.target)
         self.call_utils.wait_with_log(5)
         self.target.mbs.clickUIElementWithText(constants.SMS_TEXT)
 
-        # Verify the SYNC READ sms in IVI device
-        self.call_utils.press_home()
+        # pair the devices
+        self.bt_utils.pair_primary_to_secondary()
+        super().enable_recording()
+
+        logging.info("wait for user permissions popup & give contacts and sms permissions")
+        self.call_utils.wait_with_log(20)
+        self.common_utils.click_on_ui_element_with_text('Allow')
+
+
+    def test_read_sms_message_db_sync(self):
+        # Open the sms app
         self.call_utils.open_sms_app()
-        self.call_utils.verify_sms_app_unread_message(False)
-        self.call_utils.verify_sms_preview_timestamp(True)
+
+        logging.info("Performing the verifications")
+        asserts.assert_true(self.call_utils.verify_sms_preview_text(constants.SMS_TEXT),
+            'Messages app should contain new test message but found none')
+        asserts.assert_false(self.call_utils.verify_sms_app_unread_message(),
+            'Message app should not contain the unread msg, but contains one')
+        asserts.assert_true(self.call_utils.verify_sms_preview_timestamp(),
+            'Messages app contain the timestamp')
 
     def teardown_test(self):
-         # Go to home screen
-         self.call_utils.press_home()
-         super().teardown_test()
+        # Go to home screen
+        self.call_utils.press_home()
+        super().teardown_test()
 
 if __name__ == '__main__':
   common_main()
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/sms/bt_sms_reply_from_phone_sync_test.py b/tests/automotive/mobly_tests/sms/bt_sms_reply_from_phone_sync_test.py
index 77e4e293f..5b5235e2f 100644
--- a/tests/automotive/mobly_tests/sms/bt_sms_reply_from_phone_sync_test.py
+++ b/tests/automotive/mobly_tests/sms/bt_sms_reply_from_phone_sync_test.py
@@ -1,4 +1,4 @@
-#  Copyright (C) 2023 The Android Open Source Project
+#  Copyright (C) 2025 The Android Open Source Project
 #
 #  Licensed under the Apache License, Version 2.0 (the "License");
 #  you may not use this file except in compliance with the License.
@@ -20,6 +20,9 @@
         3) Reply to the sms from paired phone
         4) Verify the reply sms sync in IVI device
 """
+import logging
+
+from mobly import asserts
 from utilities import constants
 from utilities.main_utils import common_main
 from utilities.common_utils import CommonUtils
@@ -34,39 +37,55 @@ class SMSReplyFromPhoneSync(bluetooth_sms_base_test.BluetoothSMSBaseTest):
 
     def setup_test(self):
 
-        # pair the devices
+        logging.info("Pairing phone to car head unit.")
         self.bt_utils.pair_primary_to_secondary()
 
-    def test_reply_from_phone_sms_sync(self):
-
-        # wait for user permissions popup & give contacts and sms permissions
+        logging.info("wait for user permissions popup & give contacts and sms permissions")
         self.call_utils.wait_with_log(20)
         self.common_utils.click_on_ui_element_with_text('Allow')
 
-        # send a new sms
+        logging.info("Clearing the sms from the phone.")
+        self.call_utils.clear_sms_app(self.target)
+
+        logging.info("Rebooting the phone.")
+        self.target.unload_snippet('mbs')
+        self.target.reboot()
+        self.call_utils.wait_with_log(30)
+        self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
+
+    def test_reply_from_phone_sms_sync(self):
+
+        logging.info("Sending the sms from unpaired phone to paired phone")
         target_phone_number = self.target.mbs.getPhoneNumber()
         self.phone_notpaired.mbs.sendSms(target_phone_number,constants.SMS_REPLY_TEXT)
         self.call_utils.wait_with_log(10)
+
         # Verify the new UNREAD sms in IVI device
         self.call_utils.open_sms_app()
-        self.call_utils.verify_sms_app_unread_message(True)
+        asserts.assert_true(self.call_utils.verify_sms_preview_text(constants.SMS_REPLY_TEXT),
+                    'Messages app should contain new test message but found none')
+        asserts.assert_true(self.call_utils.verify_sms_app_unread_message(),
+            'Message app should contain an unread test msg, but there are no unread messages')
 
         # REPLY to the message on paired phone
         self.call_utils.open_notification_on_phone(self.target)
         self.call_utils.wait_with_log(3)
+        self.target.mbs.clickUIElementWithText(constants.SMS_REPLY_TEXT)
         self.target.mbs.clickUIElementWithText(constants.REPLY_SMS)
+        self.call_utils.wait_with_log(3)
 
         # Verify the SYNC Reply sms in IVI device
         self.call_utils.press_home()
         self.call_utils.open_sms_app()
-        self.call_utils.verify_sms_app_unread_message(False)
-        self.call_utils.verify_sms_preview_text(True, constants.REPLY_SMS)
-        super().enable_recording()
+        asserts.assert_false(self.call_utils.verify_sms_app_unread_message(),
+            'Message app should not contain the unread badge.')
+        asserts.assert_true(self.call_utils.verify_sms_preview_text(constants.REPLY_SMS),
+            'Messages app should the contain the reply message.')
 
     def teardown_test(self):
          # Go to home screen
          self.call_utils.press_home()
-         super().teardown_test()
+         super().teardown_no_video_recording()
 
 if __name__ == '__main__':
   common_main()
\ No newline at end of file
diff --git a/tests/automotive/mobly_tests/sms/bt_sms_time_sync_test.py b/tests/automotive/mobly_tests/sms/bt_sms_time_sync_test.py
index d04fcbbab..95ff1f1c4 100644
--- a/tests/automotive/mobly_tests/sms/bt_sms_time_sync_test.py
+++ b/tests/automotive/mobly_tests/sms/bt_sms_time_sync_test.py
@@ -13,6 +13,7 @@
 #  limitations under the License.
 
 import logging
+from mobly import asserts
 
 from utilities import constants
 from bluetooth_test import bluetooth_base_test
@@ -32,6 +33,11 @@ class SMSTimeSyncTest(bluetooth_base_test.BluetoothBaseTest):
         self.call_utils.update_device_timezone(constants.TIMEZONE_DICT[expected_timezone])
         # TODO: Add extra verifications after sms unread tests are merged.
 
+    def teardown_test(self):
+        # Go to home screen
+        self.call_utils.press_home()
+        self.call_utils.open_sms_app()
+        super().teardown_no_video_recording()
 
 if __name__ == '__main__':
     common_main()
diff --git a/tests/automotive/mobly_tests/sms/bt_sms_unread_sms_messagedb_sync_test.py b/tests/automotive/mobly_tests/sms/bt_sms_unread_sms_messagedb_sync_test.py
index 1049e2788..6ff60fc53 100644
--- a/tests/automotive/mobly_tests/sms/bt_sms_unread_sms_messagedb_sync_test.py
+++ b/tests/automotive/mobly_tests/sms/bt_sms_unread_sms_messagedb_sync_test.py
@@ -1,4 +1,4 @@
-#  Copyright (C) 2023 The Android Open Source Project
+#  Copyright (C) 2025 The Android Open Source Project
 #
 #  Licensed under the Apache License, Version 2.0 (the "License");
 #  you may not use this file except in compliance with the License.
@@ -24,6 +24,9 @@
 #  See the License for the specific language governing permissions and
 #  limitations under the License.
 
+import logging
+
+from mobly import asserts
 from utilities import constants
 from utilities.main_utils import common_main
 from utilities.common_utils import CommonUtils
@@ -37,36 +40,40 @@ class SMSUnreadMessageDBSyncTest(bluetooth_sms_base_test.BluetoothSMSBaseTest):
         self.common_utils = CommonUtils(self.target, self.discoverer)
 
     def setup_test(self):
-
-        # pair the devices
-        self.bt_utils.pair_primary_to_secondary()
-
-        # wait for user permissions popup & give contacts and sms permissions
-        self.call_utils.wait_with_log(20)
-        self.common_utils.click_on_ui_element_with_text('Allow')
-
-        # Clearing the sms from the phone
+        logging.info("Clearing the sms from the phone.")
         self.call_utils.clear_sms_app(self.target)
-        # Reboot Phone
+
+        logging.info("Rebooting the phone.")
         self.target.unload_snippet('mbs')
         self.target.reboot()
         self.call_utils.wait_with_log(30)
         self.target.load_snippet('mbs', android_device.MBS_PACKAGE)
-        # send a new sms
+
+        logging.info("Sending the sms from unpaired phone to paired phone")
         target_phone_number = self.target.mbs.getPhoneNumber()
         self.phone_notpaired.mbs.sendSms(target_phone_number,constants.SMS_TEXT)
         self.call_utils.wait_with_log(10)
+
+        # pair the devices
+        self.bt_utils.pair_primary_to_secondary()
         super().enable_recording()
 
+        logging.info("wait for user permissions popup & give contacts and sms permissions")
+        self.call_utils.wait_with_log(20)
+        self.common_utils.click_on_ui_element_with_text('Allow')
+
     def test_unread_sms_message_db_sync(self):
-        # to test that the unread sms appears on phone after pairing
+        # to test that the preexisting unread sms appears on phone after pairing
 
         # Open the sms app
         self.call_utils.open_sms_app()
-        # Perform the verifications
-        self.call_utils.verify_sms_app_unread_message(True)
-        self.call_utils.verify_sms_preview_text(True, constants.SMS_TEXT)
-        self.call_utils.verify_sms_preview_timestamp(True)
+        logging.info("Verifying the preexisting unread messages appears on the phone.")
+        asserts.assert_true(self.call_utils.verify_sms_preview_text(constants.SMS_TEXT),
+            'Messages app should contain new test message but found none')
+        asserts.assert_true(self.call_utils.verify_sms_app_unread_message(),
+            'Messages app should have unread badge, but found none')
+        asserts.assert_true(self.call_utils.verify_sms_preview_timestamp(),
+            'Messages app contain the timestamp')
 
     def teardown_test(self):
         # Go to home screen
diff --git a/tests/automotive/mobly_tests/utilities/constants.py b/tests/automotive/mobly_tests/utilities/constants.py
index 349535090..7c1626419 100644
--- a/tests/automotive/mobly_tests/utilities/constants.py
+++ b/tests/automotive/mobly_tests/utilities/constants.py
@@ -127,7 +127,7 @@ DUMPSYS_POWER= 'dumpsys power|grep mWakefulness'
 YOUTUBE_MUSIC_PACKAGE = 'com.google.android.apps.youtube.music'
 START_YOUTUBE_MEDIA_SHELL = 'am start ' + YOUTUBE_MUSIC_PACKAGE
 STOP_YOUTUBE_MEDIA_SHELL = 'am force-stop ' + YOUTUBE_MUSIC_PACKAGE
-GET_DUMPSYS_METADATA = 'dumpsys media_session'
+GET_MEDIA_DUMPSYS_METADATA = 'dumpsys media_session'
 GET_DUMPSYS_METADATA = 'dumpsys bluetooth_manager'
 SONG_METADATA_PATTERN = r"description=.[^\n]+"
 DEFAULT_YOUTUBE_MUSIC_PLAYLIST = 'am start -a android.intent.action.VIEW -d https://music.youtube.com/watch?v=nkBJzfHpq_A'
diff --git a/tests/automotive/mobly_tests/utilities/faker.py b/tests/automotive/mobly_tests/utilities/faker.py
new file mode 100644
index 000000000..788133510
--- /dev/null
+++ b/tests/automotive/mobly_tests/utilities/faker.py
@@ -0,0 +1,47 @@
+#  Copyright (C) 2025 The Android Open Source Project
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+#
+#  Licensed under the Apache License, Version 2.0 (the "License");
+#  you may not use this file except in compliance with the License.
+#  You may obtain a copy of the License at
+#
+#       http://www.apache.org/licenses/LICENSE-2.0
+#
+#  Unless required by applicable law or agreed to in writing, software
+#  distributed under the License is distributed on an "AS IS" BASIS,
+#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+#  See the License for the specific language governing permissions and
+#  limitations under the License.
+
+
+import random
+import string
+
+
+class Faker:
+  @property
+  def string(self, length: int = 10) -> str:
+    """Generates a random string of the given length.
+
+    Args:
+      length (int): The length of the string to generate. By default, it is 10.
+
+    Returns:
+      A random string of the given length.
+    """
+    characters = string.ascii_letters + string.digits + string.punctuation
+    return ''.join(random.choices(characters, k=length))
+
+
+fake = Faker()
diff --git a/tests/automotive/mobly_tests/utilities/main_utils.py b/tests/automotive/mobly_tests/utilities/main_utils.py
index 49e2e5a6d..ffb8a1105 100644
--- a/tests/automotive/mobly_tests/utilities/main_utils.py
+++ b/tests/automotive/mobly_tests/utilities/main_utils.py
@@ -18,6 +18,7 @@ import sys
 # from absl import flags
 from mobly import test_runner
 
+import logging
 
 """
 Get Test Args
@@ -37,7 +38,7 @@ Returns: Dictionary with key-value pair
     k2: v2
   }
 """
-def get_test_args():
+def get_test_args(shell_escape=False):
     parser = argparse.ArgumentParser(description='Parse Test Args.')
     group = parser.add_mutually_exclusive_group(required=False)
     group.add_argument('--test_args',
@@ -56,6 +57,10 @@ def get_test_args():
         for test_arg in test_args
     ]
     test_args = {test_arg.split("=")[0]: test_arg.split("=")[1] for test_arg in test_args_list}
+    if shell_escape:
+        def escape(s):
+            return "'" + s.replace("'", "\\'") + "'"
+        test_args = {escape(k): escape(v) for k, v in test_args.items()}
     return test_args
 
 """Pass test arguments after '--' to the test runner. Needed for Mobly Test Runner.
diff --git a/tests/automotive/mobly_tests/utilities/media_utils.py b/tests/automotive/mobly_tests/utilities/media_utils.py
index 5b9851301..09c3b19eb 100644
--- a/tests/automotive/mobly_tests/utilities/media_utils.py
+++ b/tests/automotive/mobly_tests/utilities/media_utils.py
@@ -98,8 +98,9 @@ class MediaUtils:
     def get_song_metadata(self):
         logging.info("Getting song metadata from phone device")
         # get dumpsys
-        dumpsys_metadata = self.execute_shell_on_device(constants.GET_DUMPSYS_METADATA).decode(
+        dumpsys_metadata = self.execute_shell_on_device(constants.GET_MEDIA_DUMPSYS_METADATA).decode(
             'utf8')
+        logging.debug("Song metadata on phone device before matching regex: %s", dumpsys_metadata)
 
         # compile regex
         regex_pattern = re.compile(constants.SONG_METADATA_PATTERN)
diff --git a/tests/automotive/mobly_tests/utilities/spectatio_utils.py b/tests/automotive/mobly_tests/utilities/spectatio_utils.py
index 999432286..8b997c191 100644
--- a/tests/automotive/mobly_tests/utilities/spectatio_utils.py
+++ b/tests/automotive/mobly_tests/utilities/spectatio_utils.py
@@ -19,19 +19,18 @@ import time
 from mobly.controllers import android_device
 from utilities import constants
 
-""" This exception may be expanded in the future to provide better error discoverability."""
-
 
 class CallUtilsError(Exception):
+    """This exception may be expanded in the future to provide better error discoverability."""
     pass
+
+
 class CallUtils:
     """Calling sequence utility for BT calling test using Spectatio UI APIs.
 
     This class provides functions that execute generic call sequences. Specific
-    methods
-    (e.g., verify_precall_state) are left to that implementation, and thus the
+    methods (e.g., verify_precall_state) are left to that implementation, and thus the
     utilities housed here are meant to describe generic sequences of actions.
-
     """
 
     def __init__(self, device):
@@ -41,10 +40,12 @@ class CallUtils:
         """Assumes the device bluetooth connection settings page is open"""
         logging.info('Checking whether device is connected.')
         self.device.mbs.deviceIsConnected()
+
     def open_app_grid(self):
         """Opens app Grid """
         logging.info("Opening app grid")
         self.device.mbs.openAppGrid()
+
     def dial_a_number(self, callee_number):
         """Dial phone number"""
         logging.info("Dial phone number <%s>", callee_number)
@@ -72,7 +73,6 @@ class CallUtils:
         """Get user phone number"""
         return self.device.mbs.getUserProfilePhoneNumber()
 
-
     def get_home_address_from_details(self):
         """Return the home address of the contact whose details are currently being displayed"""
         return self.device.mbs.getHomeAddress()
@@ -81,6 +81,10 @@ class CallUtils:
         """Assumes the device summary page is open."""
         return self.device.mbs.getDeviceSummary()
 
+    def is_phone_profile_enabled(self):
+        """Returns if phone profile is enabled on Bluetooth Summary Screen."""
+        return self.device.mbs.isPhoneProfileEnabled()
+
     def import_contacts_from_vcf_file(self, device_target):
         """Importing contacts from VCF file"""
         logging.info("Importing contacts from VCF file to device Contacts")
@@ -99,12 +103,16 @@ class CallUtils:
         logging.info("Open call history")
         self.device.mbs.openCallHistory()
 
-
     def open_contacts(self):
         """Open contacts"""
         logging.info("Opening contacts")
         self.device.mbs.openContacts()
 
+    def open_favorites(self):
+        """Open favorites"""
+        logging.info("Opening favorites")
+        self.device.mbs.openFavorites()
+
     def open_dialpad(self):
         """Open the dial pad from the dialer main screen"""
         logging.info("Opening the dialpad")
@@ -141,7 +149,6 @@ class CallUtils:
         self.device.mbs.pressActiveCallToggle()
 
     def open_dialer_settings(self):
-        """Open dialer settings"""
         logging.info('Opening Dialer settings')
         self.device.mbs.openDialerSettings()
 
@@ -191,8 +198,7 @@ class CallUtils:
         self.device.mbs.pressHome()
 
     def press_enter_on_device(self, device_target):
-        """Press ENTER on device"""
-        logging.info("Pressing ENTER on device: ")
+        logging.info("Pressing ENTER on device.")
         self.execute_shell_on_device(device_target, "input keyevent KEYCODE_ENTER")
         self.wait_with_log(constants.ONE_SEC)
 
@@ -209,7 +215,7 @@ class CallUtils:
         )
 
     def validate_three_preference_buttons(self, bluetooth_enabled):
-        """ Checks each of the three preference buttons (bluetooth, phone, audio).
+        """Checks each of the three preference buttons (bluetooth, phone, audio).
 
         If bluetooth is enabled, all three buttons should be enabled, and the bluetooth
         button should be checked.
@@ -236,7 +242,6 @@ class CallUtils:
 
         return True
 
-
     def upload_vcf_contacts_to_device(self, device_target, path_to_contacts_file):
         """Upload contacts do device"""
         self.import_contacts_from_vcf_file(device_target)
@@ -258,23 +263,23 @@ class CallUtils:
         """Wait for specific time for debugging"""
         logging.info("Sleep for %s seconds", wait_time)
         time.sleep(wait_time)
-    # Open contacts detais page
+
     def open_details_page(self, contact_name):
         logging.info('open contacts details page')
         self.device.mbs.openDetailsPage(contact_name)
-    # Close contact details page
+
     def close_details_page(self):
         logging.info('close contacts details page')
         self.device.mbs.closeDetailsPage()
-    # Add Remove Favorite contact
+
     def add_remove_favorite_contact(self):
         logging.info('add remove favorite contact')
         self.device.mbs.addRemoveFavoriteContact()
-    # Add Favorites from Favorite Tab
+
     def add_favorites_from_favorites_tab(self, contact_name):
         logging.info('add favorites from favorites tab')
         self.device.mbs.addFavoritesFromFavoritesTab(contact_name)
-    # Add Remove Favorite contact
+
     def is_contact_in_favorites(self, contact_name, expected_result):
         logging.info('check if contact is in favorites')
         actual_result =self.device.mbs.isContactInFavorites(contact_name)
@@ -288,15 +293,12 @@ class CallUtils:
         if expected_result == 'False' and expected_result != actual_result:
             raise CallUtilsError('Contact not removed from favorites')
 
-
     def open_bluetooth_media_app(self):
-        """ Open Bluetooth Audio app """
         logging.info('Open Bluetooth Audio app')
         self.device.mbs.openBluetoothMediaApp();
         self.wait_with_log(1)
 
     def open_bluetooth_sms_app(self):
-        """ Open Bluetooth SMS app """
         logging.info('Open Bluetooth SMS app')
         self.device.mbs.openSmsApp();
         self.wait_with_log(1)
@@ -329,6 +331,15 @@ class CallUtils:
         logging.info("Checks if dialpad is displayed")
         return self.device.mbs.verifyDialerDialpadTab()
 
+    def verify_dialer_search_lens(self):
+        logging.info("Checks if Search lens is displayed")
+        return self.device.mbs.verifyDialerSearchLens()
+
+
+    def verify_dialer_settings(self):
+        logging.info("Checks if dialer settings is displayed")
+        return self.device.mbs.verifyDialerSettings()
+
     def open_sms_app(self):
         """Open sms app"""
         logging.info('Opening sms app')
@@ -348,7 +359,7 @@ class CallUtils:
         return is_connected
 
     def is_bluetooth_audio_disconnected_label_visible(self):
-        """ Return is <Bluetooth Audio disconnected> label present """
+        """Return is <Bluetooth Audio disconnected> label present """
         logging.info('Checking is <Bluetooth Audio disconnected> label present')
         actual_disconnected_label_status = self.device.mbs.isBluetoothAudioDisconnectedLabelVisible()
         logging.info('<Bluetooth Audio disconnected> label is present: %s',
@@ -356,19 +367,19 @@ class CallUtils:
         return actual_disconnected_label_status
 
     def is_connect_to_bluetooth_label_visible_on_bluetooth_audio_page(self):
-        """ Return is <Connect to Bluetooth> label present """
+        """Return is <Connect to Bluetooth> label present """
         logging.info('Checking is <Connect to Bluetooth> label present')
         actual_status = self.device.mbs.isBluetoothAudioDisconnectedLabelVisible()
         logging.info('<Connect to Bluetooth> label is present: %s',actual_status)
         return actual_status
 
     def click_cancel_label_visible_on_bluetooth_audio_page(self):
-        """ Clicks on <Cancel> label present on bluetooth Audio page"""
+        """Clicks on <Cancel> label present on bluetooth Audio page"""
         self.device.mbs.cancelBluetoothAudioConncetion()
         logging.info('Clicked on <Cancel> label present on bluetooth Audio page')
 
     def handle_bluetooth_audio_pop_up(self):
-        """ Close on BT audio popup if present on bluetooth Audio page"""
+        """Close on BT audio popup if present on bluetooth Audio page"""
         logging.info('Adding wait to check the Bluetooth Audio popup')
         time.sleep(constants.DEFAULT_WAIT_TIME_FIVE_SECS)
         is_bluetooth_media_popup_present = self.is_connect_to_bluetooth_label_visible_on_bluetooth_audio_page()
@@ -376,7 +387,6 @@ class CallUtils:
           logging.info('BT Audio popup present, cancelling that.')
           self.click_cancel_label_visible_on_bluetooth_audio_page()
 
-
     def update_device_timezone(self, expected_timezone):
         logging.info('Update the device timezone to %s',
                      expected_timezone)
@@ -394,6 +404,10 @@ class CallUtils:
                      'when bluetooth is disconnected')
         return self.device.mbs.isBluetoothHfpErrorDisplayed()
 
+    def search_contacts(self):
+        logging.info('Searching contacts using SEARCH_CONTACTS_WORKFLOW')
+        self.device.mbs.searchContacts()
+
     def search_contacts_name(self, contact_name):
         logging.info('Searching <%s> in contacts', contact_name)
         self.device.mbs.searchContactsByName(contact_name)
@@ -421,14 +435,13 @@ class CallUtils:
             raise CallUtilsError("Actual and Expected sorting orders don't match.")
 
     def is_bluetooth_sms_disconnected_label_visible(self):
-        """ Return is <Bluetooth SMS disconnected> label present """
+        """Return is <Bluetooth SMS disconnected> label present"""
         logging.info('Checking is <Bluetooth SMS disconnected> label present')
         actual_disconnected_label_status = self.device.mbs.isSmsBluetoothErrorDisplayed()
         logging.info('<Bluetooth SMS disconnected> label is present: %s',
                      actual_disconnected_label_status)
         return actual_disconnected_label_status
 
-    # Verify dialing number the same as expected
     def verify_dialing_number(self, expected_dialing_number):
         """Replace all non-digits characters to null"""
         actual_dialing_number = re.sub(r'\D', '', str(self.get_dialing_number()))
@@ -442,8 +455,6 @@ class CallUtils:
             raise CallUtilsError(
                 "Actual and Expected dialing numbers don't match.")
 
-
-    # Verify dialing number the same as expected
     def verify_user_phone_number(self, expected_dialing_number):
         """Replace all non-digits characters to null"""
         actual_dialing_number = re.sub(r'\D', '', str(self.get_user_phone_number()))
@@ -494,19 +505,16 @@ class CallUtils:
         logging.info('Open Phone from Home Screen card.')
         self.device.mbs.openPhoneAppFromHome()
 
-    # Search contact by name
     def search_contact_by_name(self, search_contact_name):
         logging.info('Searching <%s> in contacts', search_contact_name)
         self.device.mbs.searchContactsByName(search_contact_name)
 
-    # Get first search result
     def get_first_search_result(self):
         logging.info('Getting first search result')
         actual_first_search_result = self.device.mbs.getFirstSearchResult()
         logging.info('Actual first search result: <%s>', actual_first_search_result)
         return actual_first_search_result
 
-    # Verify search result contains expected searach input
     def verify_search_results_contain_target_search(self, expected_search_result):
         actual_search_result = self.get_first_search_result()
         logging.info(
@@ -517,34 +525,15 @@ class CallUtils:
         if expected_search_result not in actual_search_result:
             raise CallUtilsError('Actual search result does not contain Expected.')
 
-
-    def verify_sms_app_unread_message(self, expected):
-        """Verify unread message on sms app"""
+    def verify_sms_app_unread_message(self):
+        """Verify unread message badge on sms app"""
         logging.info('Verify Unread Message on SMS app')
-        actual_unread_message_badge_displayed = self.device.mbs.isUnreadSmsDisplayed()
-        logging.info(
-            'Unread message Expected: <%s>, Actual: <%s>',
-            expected,
-            actual_unread_message_badge_displayed,
-        )
-        if actual_unread_message_badge_displayed != expected:
-            raise CallUtilsError(
-                "SMS Unread messages - Actual and Expected doesn't match."
-            )
+        return self.device.mbs.isUnreadSmsDisplayed()
 
-    def verify_sms_preview_text(self, expected, text):
+    def verify_sms_preview_text(self, text):
         """Verify sms preview text"""
         logging.info('Verify SMS Preview Text')
-        actual_message_preview_displayed = self.device.mbs.isSmsPreviewTextDisplayed(text)
-        logging.info(
-            'SMS Preview Text Expected: <%s>, Actual: <%s>',
-            expected,
-            actual_message_preview_displayed,
-        )
-        if actual_message_preview_displayed != expected:
-            raise CallUtilsError(
-                "SMS Preview Text- Actual and Expected doesn't match."
-            )
+        return self.device.mbs.isSmsPreviewTextDisplayed(text)
 
     def tap_to_read_aloud(self):
         """Tap on Received Text message"""
@@ -558,35 +547,18 @@ class CallUtils:
             logging.info("Assistant SMS Transcription plate has opened upon tapping the SMS.")
         return visibility_status
 
-    def verify_sms_preview_timestamp(self, expected):
+    def verify_sms_preview_timestamp(self):
         """Verify sms preview timestamp"""
         logging.info('Verify SMS Preview TimeStamp')
-        actual_message_preview_timestamp = self.device.mbs.isSmsTimeStampDisplayed()
-        logging.info(
-            'SMS Preview TimeStamp Expected: <%s>, Actual: <%s>',
-            expected,
-            actual_message_preview_timestamp,
-        )
-        if actual_message_preview_timestamp != expected:
-            raise CallUtilsError(
-                "SMS Preview TimeStamp - Actual and Expected doesn't match."
-            )
+        return self.device.mbs.isSmsTimeStampDisplayed()
+
+    def verify_sms_no_messages_displayed(self):
+        """Verify no messages text is displayed"""
+        logging.info('Verify No Messages Text displayed')
+        return self.device.mbs.isNoMessagesDisplayed()
 
-    def verify_sms_no_messages_displayed(self, expected):
-        """Verify sms preview timestamp"""
-        logging.info('Verify No Msg displayed')
-        actual_message_preview_timestamp = self.device.mbs.isNoMessagesDisplayed()
-        logging.info(
-            'SMS No Messages Expected: <%s>, Actual: <%s>',
-            expected,
-            actual_message_preview_timestamp,
-        )
-        if actual_message_preview_timestamp != expected:
-            raise CallUtilsError(
-                "No messages - Actual and Expected doesn't match."
-            )
     def clear_sms_app(self, device_target):
-        """Verify sms preview timestamp"""
+        """Clearing the sms app"""
         logging.debug('clearing the sms app')
         # self.execute_shell_on_device(device_target, constants.ROOT)
         self.execute_shell_on_device(device_target, constants.DELETE_MESSAGING_DB)
@@ -615,6 +587,23 @@ class CallUtils:
         logging.info('Is Bluetooth Button Enabled')
         return self.device.mbs.isBluetoothButtonEnabled()
 
+    def has_bluetooth_toggle_on_message_displayed(self):
+        logging.info('Has Bluetooth Toggle On Message Displayed')
+        return self.device.mbs.hasBluetoothPaletteToggleOnMessage()
+
+    def has_bluetooth_toggle_off_message_displayed(self):
+        logging.info('Has Bluetooth Toggle Off Message Displayed')
+        return self.device.mbs.hasBluetoothPaletteToggleOffMessage()
+
+    def turn_on_off_bluetooth_switch_on_palette(self, switchstate):
+        self.device.mbs.turnOnOffBluetoothSwitchOnPalette(switchstate)
+        logging.info('Expected bluetooth toggle switch status: <%s>',
+                     switchstate)
+
+    def is_bluetooth_toggle_switch_in_palette_on(self):
+        logging.info('Verify whether bluetooth toggle button is enabled in Bluetooth palette')
+        return self.device.mbs.isBluetoothToggleSwitchInPaletteOn()
+
     def is_active_call_enabled(self):
         logging.info("Verifying whether active call is enabled")
         return self.device.mbs.isActiveCallEnabled()
@@ -634,7 +623,6 @@ class CallUtils:
     def get_dial_in_number(self):
         return self.device.mbs.getNumberInDialPad()
 
-    # Verify dialed number on Dial Pad the same as expected
     def verify_dialed_number_on_dial_pad(self, expected_dialed_number):
         actual_dialed_number = self.get_dial_in_number()
         logging.info('Expected number on Dial Pad: <%s>, Actual: <%s>',
@@ -645,27 +633,22 @@ class CallUtils:
             raise CallUtilsError(
                 "Actual and Expected dialing numbers on dial pad don't match.")
 
-    # Delete dialed number on Dial Pad
     def delete_dialed_number_on_dial_pad(self):
         logging.info('Deleting dialed number on Dial Pad')
         self.device.mbs.deleteDialedNumber()
 
-    # End call on IVI using adb shell command
     def end_call_using_adb_command(self, device_target):
         self.execute_shell_on_device(device_target, 'input keyevent KEYCODE_ENDCALL')
         self.execute_shell_on_device(device_target, 'input keyevent KEYCODE_POWER')
 
-    # Make a call most recent history
     def call_most_recent_call_history(self):
         logging.info('Calling most recent call in history')
         self.device.mbs.callMostRecentHistory()
 
-    # Change audio source to PHONE
     def change_audio_source_to_phone(self):
         logging.info('Changing audio source to PHONE')
         self.device.mbs.changeAudioSourceToPhone()
 
-    # Change audio source to CAR SPEAKERS
     def change_audio_source_to_car_speakers(self):
         logging.info('Changing audio source to CAR SPEAKERS')
         self.device.mbs.changeAudioSourceToCarSpeakers()
@@ -678,26 +661,23 @@ class CallUtils:
         logging.info('Disabling the drive mode')
         self.device.mbs.disableDrivingMode()
 
-    # Check if microphone chip is displayed on status bar
     def is_microphone_displayed_on_status_bar(self, expected_result):
-       logging.info('Mute the call, verify microphone on status bar')
-       actual_result = self.device.mbs.isMicChipPresentOnStatusBar()
-       logging.info(
-           'Microphone Chip on status bar expected : <%s>, Actual : <%s>',
-           expected_result,
-           actual_result,
-       )
-       if expected_result != actual_result:
-         raise CallUtilsError(
-             'MicroPhone Chip not in sync with call status'
-         )
-
-    # Mute call
+        logging.info('Mute the call, verify microphone on status bar')
+        actual_result = self.device.mbs.isMicChipPresentOnStatusBar()
+        logging.info(
+            'Microphone Chip on status bar expected : <%s>, Actual : <%s>',
+            expected_result,
+            actual_result,
+        )
+        if expected_result != actual_result:
+            raise CallUtilsError(
+                'MicroPhone Chip not in sync with call status'
+            )
+
     def mute_call(self):
         logging.info('Muting call')
         self.device.mbs.muteCall()
 
-    # Unmute call
     def unmute_call(self):
         logging.info('Unmuting call')
         self.device.mbs.unmuteCall()
@@ -724,9 +704,9 @@ class CallUtils:
            logging.info("Adb returned null")
 
     def get_bt_connection_status_using_adb_command(self, device_target):
-            try:
-               bt_connection_status = self.execute_shell_on_device(device_target, constants.BLUETOOTH_CONNECTION_STATE).decode('utf8')
-               logging.debug(bt_connection_status)
-               return bt_connection_status
-            except adb.AdbError:
-               logging.info("Adb returned null")
\ No newline at end of file
+        try:
+            bt_connection_status = self.execute_shell_on_device(device_target, constants.BLUETOOTH_CONNECTION_STATE).decode('utf8')
+            logging.debug(bt_connection_status)
+            return bt_connection_status
+        except adb.AdbError:
+            logging.info("Adb returned null")
diff --git a/tests/automotive/mobly_tests/uxrestriction/Android.bp b/tests/automotive/mobly_tests/uxrestriction/Android.bp
index 139ee06cd..c7f21bd25 100644
--- a/tests/automotive/mobly_tests/uxrestriction/Android.bp
+++ b/tests/automotive/mobly_tests/uxrestriction/Android.bp
@@ -36,11 +36,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -63,11 +58,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -77,7 +67,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "BluetoothSMSTestLibrary"
+        "BluetoothSMSTestLibrary",
     ],
     test_suites: [
         "catbox",
@@ -90,11 +80,6 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
 
 python_test_host {
@@ -104,7 +89,7 @@ python_test_host {
     libs: [
         "mobly",
         "utilities",
-        "BluetoothSMSTestLibrary"
+        "BluetoothSMSTestLibrary",
     ],
     test_suites: [
         "catbox",
@@ -117,10 +102,4 @@ python_test_host {
         ":AutomotiveSnippet",
         ":PhoneSnippet",
     ],
-    version: {
-        py3: {
-            embedded_launcher: true,
-        },
-    },
 }
-
diff --git a/tests/automotive/snippets/phone/Android.bp b/tests/automotive/snippets/phone/Android.bp
index 3b7530c3f..1be15b9ff 100644
--- a/tests/automotive/snippets/phone/Android.bp
+++ b/tests/automotive/snippets/phone/Android.bp
@@ -30,6 +30,7 @@ android_test {
         "automotive-status-bar-helper",
         "automotive-media-center-app-helper",
         "android-support-multidex",
+        "automotive-notifications-app-helper",
     ],
     srcs: ["src/**/*.java"],
     manifest: "AndroidAutomotiveManifest.xml",
diff --git a/tests/automotive/snippets/phone/AndroidAutomotiveManifest.xml b/tests/automotive/snippets/phone/AndroidAutomotiveManifest.xml
index 9ef6df016..f9c0c53e2 100644
--- a/tests/automotive/snippets/phone/AndroidAutomotiveManifest.xml
+++ b/tests/automotive/snippets/phone/AndroidAutomotiveManifest.xml
@@ -46,6 +46,7 @@
                        com.google.android.mobly.snippet.bundled.MediaSnippet,
                        com.google.android.mobly.snippet.bundled.NetworkingSnippet,
                        com.google.android.mobly.snippet.bundled.NotificationSnippet,
+                       com.google.android.mobly.snippet.bundled.HeadsUpNotificationSnippet,
                        com.google.android.mobly.snippet.bundled.PrivacySettingsSnippet,
                        com.google.android.mobly.snippet.bundled.SettingsSnippet,
                        com.google.android.mobly.snippet.bundled.SmsSnippet,
diff --git a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/CarSmsMessengerSnippet.java b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/CarSmsMessengerSnippet.java
index 20ddab09b..08a1a96ca 100644
--- a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/CarSmsMessengerSnippet.java
+++ b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/CarSmsMessengerSnippet.java
@@ -75,6 +75,11 @@ public class CarSmsMessengerSnippet implements Snippet {
         return mCarSmsMessengerHelper.get().isAssistantSMSTranscriptionPlateDisplayed();
     }
 
+    @Rpc(description = "Unmute conversation with title")
+    public void unmuteConversationWithTitle(String title) {
+        mCarSmsMessengerHelper.get().unmuteConversationWithTitle(title);
+    }
+
     @Override
     public void shutdown() {}
 }
diff --git a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/DialerSnippet.java b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/DialerSnippet.java
index 085dde37b..7b26f2295 100644
--- a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/DialerSnippet.java
+++ b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/DialerSnippet.java
@@ -195,6 +195,12 @@ public class DialerSnippet implements Snippet {
         return mDialerHelper.get().getContactType();
     }
 
+    /** Search contacts using the SEARCH_CONTACTS_WORKFLOW. */
+    @Rpc(description = "Search contacts using SEARCH_CONTACTS_WORKFLOW.")
+    public void searchContacts() {
+        mDialerHelper.get().searchContacts();
+    }
+
     @Rpc(description = "Search contact by name.")
     public void searchContactsByName(String contact) {
         mDialerHelper.get().searchContactsByName(contact);
@@ -250,6 +256,12 @@ public class DialerSnippet implements Snippet {
         mDialerHelper.get().openContacts();
     }
 
+    /** Open favorite menu in dialer */
+    @Rpc(description = "Open Favorites.")
+    public void openFavorites() {
+        mDialerHelper.get().openFavorites();
+    }
+
     /** Press 'Device' prompt which comes up when trying to transfer files to a device. */
     @Rpc(description = "Press 'Device' on a prompt, if present.")
     public void pressDevice() {
@@ -315,6 +327,18 @@ public class DialerSnippet implements Snippet {
         return mDialerHelper.get().verifyDialerDialpadTab();
     }
 
+    /** Validates whether Search leans is displayed or not */
+    @Rpc(description = "is Dialpad search lens in Dialer page ")
+    public boolean verifyDialerSearchLens() {
+        return mDialerHelper.get().verifyDialerSearchLens();
+    }
+
+    /** Validates whether dialer settings is displayed or not */
+    @Rpc(description = "is Dialpad settings in Dialer page ")
+    public boolean verifyDialerSettings() {
+        return mDialerHelper.get().verifyDialerSettings();
+    }
+
     @Override
     public void shutdown() {}
 }
diff --git a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/HeadsUpNotificationSnippet.java b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/HeadsUpNotificationSnippet.java
new file mode 100644
index 000000000..e132c0762
--- /dev/null
+++ b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/HeadsUpNotificationSnippet.java
@@ -0,0 +1,104 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.google.android.mobly.snippet.bundled;
+
+import android.platform.helpers.HelperAccessor;
+import android.platform.helpers.IAutoHeadsUpNotificationHelper;
+
+import androidx.test.uiautomator.UiObject2;
+import com.google.android.mobly.snippet.Snippet;
+import com.google.android.mobly.snippet.rpc.Rpc;
+
+/** Snippet for heads-up notification. */
+public class HeadsUpNotificationSnippet implements Snippet {
+
+    private final HelperAccessor<IAutoHeadsUpNotificationHelper> mHeadsUpNotificationHelper;
+
+    public HeadsUpNotificationSnippet() {
+        mHeadsUpNotificationHelper = new HelperAccessor<>(IAutoHeadsUpNotificationHelper.class);
+    }
+
+    @Rpc(description = "Find the HUN in the car's head unit.")
+    public UiObject2 findHun() {
+        return mHeadsUpNotificationHelper.get().findHun();
+    }
+
+    @Rpc(description = "Find the HUN in the car's head unit with the given title.")
+    public UiObject2 findHunWithTitle(String text) {
+        return mHeadsUpNotificationHelper.get().findHunWithTitle(text);
+    }
+
+    @Rpc(description = "Check if HUN is displayed in the car's head unit.")
+    public boolean isHunDisplayed() {
+        return mHeadsUpNotificationHelper.get().isHunDisplayed();
+    }
+
+    @Rpc(description = "Check if HUN with the given title is displayed in the car's head unit.")
+    public boolean isHunDisplayedWithTitle(String text) {
+        return mHeadsUpNotificationHelper.get().isHunDisplayedWithTitle(text);
+    }
+
+    @Rpc(description = "Swipe the HUN in the car's head unit.")
+    public void swipeHun(String text) {
+        mHeadsUpNotificationHelper.get().swipeHun(text);
+    }
+
+    @Rpc(description = "Find the SMS HUN in the car's head unit.")
+    public UiObject2 findSmsHun() {
+        return mHeadsUpNotificationHelper.get().findSmsHun();
+    }
+
+    @Rpc(description = "Find the SMS HUN in the car's head unit with the given title.")
+    public UiObject2 findSmsHunWithTitle(String text) {
+        return mHeadsUpNotificationHelper.get().findSmsHunWithTitle(text);
+    }
+
+    @Rpc(description = "Check if SMS HUN is displayed in the car's head unit.")
+    public boolean isSmsHunDisplayed() {
+        return mHeadsUpNotificationHelper.get().isSmsHunDisplayed();
+    }
+
+    @Rpc(description = "Check if SMS HUN from the given title is displayed in the car's head unit.")
+    public boolean isSmsHunDisplayedWithTitle(String text) {
+        return mHeadsUpNotificationHelper.get().isSmsHunDisplayedWithTitle(text);
+    }
+
+    @Rpc(description = "Get the content of the SMS HUN in the car's head unit.")
+    public String getSmsHunContent(String text) {
+        return mHeadsUpNotificationHelper.get().getSmsHunContent(text);
+    }
+
+    @Rpc(description = "Mute the SMS HUN with the given title in the car's head unit.")
+    public void muteSmsHun(String text) {
+        mHeadsUpNotificationHelper.get().muteSmsHun(text);
+    }
+
+    @Rpc(description = "Play the SMS HUN with the given title in the car's head unit.")
+    public void playSmsHun(String text) {
+        mHeadsUpNotificationHelper.get().playSmsHun(text);
+    }
+
+    @Rpc(description = "Check if the SMS is played on the car's head unit via car's speaker.")
+    public boolean isSmsHunPlayedViaCarSpeaker() {
+        return mHeadsUpNotificationHelper.get().isSmsHunPlayedViaCarSpeaker();
+    }
+
+    @Rpc(description = "Wait for the HUN in the car's head unit to disappear.")
+    public boolean waitForHunToDisappear() {
+        return mHeadsUpNotificationHelper.get().waitForHunToDisappear();
+    }
+}
diff --git a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/NotificationSnippet.java b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/NotificationSnippet.java
new file mode 100644
index 000000000..b11cbb121
--- /dev/null
+++ b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/NotificationSnippet.java
@@ -0,0 +1,38 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.google.android.mobly.snippet.bundled;
+
+import android.platform.helpers.HelperAccessor;
+import android.platform.helpers.IAutoNotificationHelper;
+
+import com.google.android.mobly.snippet.Snippet;
+import com.google.android.mobly.snippet.rpc.Rpc;
+
+/** Snippet for notification center. */
+public class NotificationSnippet implements Snippet {
+
+    private final HelperAccessor<IAutoNotificationHelper> mNotificationHelper;
+
+    public NotificationSnippet() {
+        mNotificationHelper = new HelperAccessor<>(IAutoNotificationHelper.class);
+    }
+
+    @Rpc(description = "Check whether notification is displayed in the car's notification center.")
+    public boolean isNotificationDisplayedInCenterWithTitle(String title) {
+        return mNotificationHelper.get().isNotificationDisplayedInCenterWithTitle(title);
+    }
+}
diff --git a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/SettingsSnippet.java b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/SettingsSnippet.java
index 84153c99a..1198042b8 100644
--- a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/SettingsSnippet.java
+++ b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/SettingsSnippet.java
@@ -68,6 +68,11 @@ public class SettingsSnippet implements Snippet {
         return mBluetoothSettingsHelper.get().isPhonePreferenceEnabled();
     }
 
+    @Rpc(description = "Returns whether the phone profile switch is enabled on Summary Page")
+    public boolean isPhoneProfileEnabled() {
+        return mBluetoothSettingsHelper.get().isPhoneProfileEnabled();
+    }
+
     @Rpc(
             description =
                     "Get the device summary of a device "
@@ -123,6 +128,12 @@ public class SettingsSnippet implements Snippet {
         mBluetoothSettingsHelper.get().pressDevice(deviceName);
     }
 
+    /** waits until deice connection status is changed in bluetooth settings */
+    @Rpc(description = "Waits until device connection status is changed in bluetooth settings")
+    public void waitUntilConnectionStatus(String status) {
+        mBluetoothSettingsHelper.get().waitUntilConnectionStatus(status);
+    }
+
     @Rpc(description = "Press an entry listed under 'Paired Devices'")
     public void pressDeviceName(String deviceName) {
         mBluetoothSettingsHelper.get().pressDevice(deviceName);
diff --git a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/StatusBarSnippet.java b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/StatusBarSnippet.java
index ab29b185b..15afd8a39 100644
--- a/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/StatusBarSnippet.java
+++ b/tests/automotive/snippets/phone/src/com/google/android/mobly/snippet/bundled/StatusBarSnippet.java
@@ -105,6 +105,30 @@ public class StatusBarSnippet implements Snippet {
         return mStatusBarHelper.get().hasBluetoothPaletteMediaButton();
     }
 
+    /** Toggle On or OFF bluetooth from Bluetooth Palette */
+    @Rpc(description = "Palette Bluetooth toggle switch ")
+    public void turnOnOffBluetoothSwitchOnPalette(boolean onOff) {
+        mStatusBarHelper.get().turnOnOffBluetooth(onOff);
+    }
+
+    /** Is bluetooth toggle On or OFF from Bluetooth Palette */
+    @Rpc(description = "is Bluetooth toggle switch in Bluetooth Palette is 'ON'")
+    public boolean isBluetoothToggleSwitchInPaletteOn() {
+        return mStatusBarHelper.get().isBluetoothOn();
+    }
+
+    /** Toggle On bluetooth Message in Bluetooth Palette */
+    @Rpc(description = "Has Bluetooth Toggle ON Message Displayed")
+    public boolean hasBluetoothPaletteToggleOnMessage() {
+        return mStatusBarHelper.get().hasToggleOnMessage();
+    }
+
+    /** Toggle Off bluetooth Message in Bluetooth Palette */
+    @Rpc(description = "Has Bluetooth Toggle Off Message Displayed")
+    public boolean hasBluetoothPaletteToggleOffMessage() {
+        return mStatusBarHelper.get().hasToggleOffMessage();
+    }
+
     @Override
     public void shutdown() {}
 }
diff --git a/tests/display/hcct/atest_wrapper/Android.bp b/tests/display/hcct/atest_wrapper/Android.bp
new file mode 100644
index 000000000..2d1e04eb6
--- /dev/null
+++ b/tests/display/hcct/atest_wrapper/Android.bp
@@ -0,0 +1,71 @@
+// Copyright (C) 2025 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+cc_binary {
+    name: "setup_vkms_connectors_for_atest",
+    defaults: ["atester_cmds_defaults"],
+    srcs: [
+        "setup_vkms_connectors_for_atest.cpp",
+    ],
+}
+
+cc_binary {
+    name: "teardown_vkms",
+    defaults: ["atester_cmds_defaults"],
+    srcs: [
+        "teardown_vkms.cpp",
+    ],
+}
+
+cc_defaults {
+    name: "atester_cmds_defaults",
+    static_libs: [
+        "vkms_tester",
+    ],
+    shared_libs: [
+        "libbase",
+        "libcutils",
+        "liblog",
+    ],
+    compile_multilib: "both",
+    multilib: {
+        lib32: {
+            suffix: "32",
+        },
+        lib64: {
+            suffix: "",
+        },
+    },
+}
+
+cc_defaults {
+    name: "atester_wrapper_defaults",
+    data_bins: [
+        "//platform_testing/tests/display/hcct/atest_wrapper:setup_vkms_connectors_for_atest",
+        "//platform_testing/tests/display/hcct/atest_wrapper:teardown_vkms",
+    ],
+    compile_multilib: "both",
+    multilib: {
+        lib32: {
+            suffix: "32",
+        },
+        lib64: {
+            suffix: "",
+        },
+    },
+}
diff --git a/tests/display/hcct/atest_wrapper/Vkms2_VtsHalGraphicsComposer3/Android.bp b/tests/display/hcct/atest_wrapper/Vkms2_VtsHalGraphicsComposer3/Android.bp
new file mode 100644
index 000000000..b7e4a3f21
--- /dev/null
+++ b/tests/display/hcct/atest_wrapper/Vkms2_VtsHalGraphicsComposer3/Android.bp
@@ -0,0 +1,28 @@
+// Copyright (C) 2025 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+cc_test {
+    name: "Vkms2VtsHalGraphicsComposer3",
+    defaults: ["atester_wrapper_defaults"],
+    data_bins: [
+        "//hardware/interfaces/graphics/composer/aidl/vts:VtsHalGraphicsComposer3_TargetTest",
+    ],
+    cppflags: [
+        "-std=c++14",
+    ],
+}
diff --git a/tests/display/hcct/atest_wrapper/Vkms2_VtsHalGraphicsComposer3/AndroidTest.xml b/tests/display/hcct/atest_wrapper/Vkms2_VtsHalGraphicsComposer3/AndroidTest.xml
new file mode 100644
index 000000000..774d87b56
--- /dev/null
+++ b/tests/display/hcct/atest_wrapper/Vkms2_VtsHalGraphicsComposer3/AndroidTest.xml
@@ -0,0 +1,41 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2025 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<configuration description="Config for Vkms with 2 Connectors running VtsHalGraphicsComposer3_TargetTest">
+    <option name="test-suite-tag" value="hcct"/>
+    <target_preparer class="com.android.tradefed.targetprep.RootTargetPreparer"/>
+
+    <target_preparer class="com.android.compatibility.common.tradefed.targetprep.FilePusher">
+        <option name="append-bitness" value="false"/>
+        <option name="push-file" key="VtsHalGraphicsComposer3_TargetTest" value="/data/local/tmp/VtsHalGraphicsComposer3_TargetTest"/>
+        <option name="push-file" key="setup_vkms_connectors_for_atest" value="/data/local/tmp/setup_vkms_connectors_for_atest"/>
+        <option name="push-file" key="teardown_vkms" value="/data/local/tmp/teardown_vkms"/>
+    </target_preparer>
+
+    <target_preparer class="com.android.tradefed.targetprep.RunCommandTargetPreparer">
+        <option name="run-command" value="stop"/>
+        <option name="run-command" value="stop vendor.hwcomposer-3"/>
+        <option name="run-command" value="./data/local/tmp/setup_vkms_connectors_for_atest 2"/>
+        <option name="teardown-command" value="./data/local/tmp/teardown_vkms"/>
+        <option name="teardown-command" value="start vendor.hwcomposer-3"/>
+        <option name="teardown-command" value="start"/>
+    </target_preparer>
+
+    <test class="com.android.tradefed.testtype.GTest" >
+        <option name="native-test-device-path" value="/data/local/tmp" />
+        <option name="module-name" value="VtsHalGraphicsComposer3_TargetTest" />
+        <option name="native-test-timeout" value="900000"/>
+    </test>
+</configuration>
diff --git a/tests/display/hcct/atest_wrapper/Vkms5WithConfig_VtsHalGraphicsComposer3/Android.bp b/tests/display/hcct/atest_wrapper/Vkms5WithConfig_VtsHalGraphicsComposer3/Android.bp
new file mode 100644
index 000000000..1cb994c83
--- /dev/null
+++ b/tests/display/hcct/atest_wrapper/Vkms5WithConfig_VtsHalGraphicsComposer3/Android.bp
@@ -0,0 +1,28 @@
+// Copyright (C) 2025 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+cc_test {
+    name: "Vkms5WithConfig_VtsHalGraphicsComposer3",
+    defaults: ["atester_wrapper_defaults"],
+    data_bins: [
+        "//hardware/interfaces/graphics/composer/aidl/vts:VtsHalGraphicsComposer3_TargetTest",
+    ],
+    cppflags: [
+        "-std=c++14",
+    ],
+}
diff --git a/tests/display/hcct/atest_wrapper/Vkms5WithConfig_VtsHalGraphicsComposer3/AndroidTest.xml b/tests/display/hcct/atest_wrapper/Vkms5WithConfig_VtsHalGraphicsComposer3/AndroidTest.xml
new file mode 100644
index 000000000..fdb4616a1
--- /dev/null
+++ b/tests/display/hcct/atest_wrapper/Vkms5WithConfig_VtsHalGraphicsComposer3/AndroidTest.xml
@@ -0,0 +1,41 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2025 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<configuration description="Config for Vkms with 5 Connectors with explicit configuration running VtsHalGraphicsComposer3_TargetTest">
+    <option name="test-suite-tag" value="hcct"/>
+    <target_preparer class="com.android.tradefed.targetprep.RootTargetPreparer"/>
+
+    <target_preparer class="com.android.compatibility.common.tradefed.targetprep.FilePusher">
+        <option name="append-bitness" value="false"/>
+        <option name="push-file" key="VtsHalGraphicsComposer3_TargetTest" value="/data/local/tmp/VtsHalGraphicsComposer3_TargetTest"/>
+        <option name="push-file" key="setup_vkms_connectors_for_atest" value="/data/local/tmp/setup_vkms_connectors_for_atest"/>
+        <option name="push-file" key="teardown_vkms" value="/data/local/tmp/teardown_vkms"/>
+    </target_preparer>
+
+    <target_preparer class="com.android.tradefed.targetprep.RunCommandTargetPreparer">
+        <option name="run-command" value="stop"/>
+        <option name="run-command" value="stop vendor.hwcomposer-3"/>
+        <option name="run-command" value="/data/local/tmp/setup_vkms_connectors_for_atest --config eDP,0,REDRIX DP,1,HP_Spectre32_4K_DP HDMIA,2,ACI_9155_ASUS_VH238_HDMI HDMIA,3,HWP_12447_HP_Z24i_HDMI DP,4,DEL_61463_DELL_U2410_DP"/>
+        <option name="teardown-command" value="/data/local/tmp/teardown_vkms"/>
+        <option name="teardown-command" value="start vendor.hwcomposer-3"/>
+        <option name="teardown-command" value="start"/>
+    </target_preparer>
+
+    <test class="com.android.tradefed.testtype.GTest" >
+        <option name="native-test-device-path" value="/data/local/tmp" />
+        <option name="module-name" value="VtsHalGraphicsComposer3_TargetTest" />
+        <option name="native-test-timeout" value="900000"/>
+    </test>
+</configuration>
diff --git a/tests/display/hcct/atest_wrapper/setup_vkms_connectors_for_atest.cpp b/tests/display/hcct/atest_wrapper/setup_vkms_connectors_for_atest.cpp
new file mode 100644
index 000000000..b7c7e017b
--- /dev/null
+++ b/tests/display/hcct/atest_wrapper/setup_vkms_connectors_for_atest.cpp
@@ -0,0 +1,218 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include "edid_helper.h"
+#include "vkms_tester.h"
+#include <log/log.h>
+#include <sstream>
+#include <stdlib.h>
+#include <string>
+#include <unistd.h>
+#include <vector>
+
+// clang-format off
+/*
+ * A binary that turns on vkms and creates connectors.
+ *
+ * Usage:
+ *   Simple mode:
+ *     ./setup_vkms_connectors_for_atest <number_of_connectors>
+ *
+ *   Advanced mode:
+ *     ./setup_vkms_connectors_for_atest --config TYPE,NUMBER_OF_OVERLAY_PLANES[,EDID_NAME]
+ * TYPE,NUMBER_OF_OVERLAY_PLANES[,EDID_NAME] ...
+ *
+ *   Where:
+ *     TYPE = connector type (DP, HDMIA, HDMIB, eDP, DSI, VGA, VIRTUAL, etc.)
+ *     NUMBER_OF_OVERLAY_PLANES = number of additional overlay planes (integer)
+ *     EDID_NAME = optional EDID profile name (e.g., ACI_9713_ASUS_VE258_DP)
+ *
+ * Examples:
+ *   ./setup_vkms_connectors_for_atest 3                      # Creates 3 virtual connectors
+ *   ./setup_vkms_connectors_for_atest --config DP,2 HDMIA,1  # Creates 2 connectors with specific configs
+ *   ./setup_vkms_connectors_for_atest --config DP,2,ACI_9713_ASUS_VE258_DP HDMIA,1,ACI_9155_ASUS_VH238_HDMI
+ *      # Creates connectors with specific EDID profiles
+ *
+ * The binary will set up the vkms (virtual kernel mode setting) driver
+ * with the specified configuration. It disables cleanup on destruction
+ * so that the vkms setup persists after program termination.
+ */
+// clang-format on
+
+bool stringToMonitorName(const std::string &edidName,
+                         hcct::edid::MonitorName &monitorName) {
+  if (edidName.empty()) {
+    return false;
+  }
+
+  // Check if it's an eDP
+#define CHECK_EDP_MONITOR(monitor)                                             \
+  if (edidName == #monitor) {                                                  \
+    monitorName =                                                              \
+        hcct::edid::MonitorName(hcct::edid::EdpMonitorName::monitor);          \
+    return true;                                                               \
+  }
+  // Generate checks for eDPs
+  EDP_MONITOR_LIST(CHECK_EDP_MONITOR)
+
+  // Check if it's a DP monitor
+#define CHECK_DP_MONITOR(monitor)                                              \
+  if (edidName == #monitor) {                                                  \
+    monitorName = hcct::edid::MonitorName(hcct::edid::DpMonitorName::monitor); \
+    return true;                                                               \
+  }
+  // Generate checks for all DP monitors
+  DP_MONITOR_LIST(CHECK_DP_MONITOR)
+
+  // Check if it's an HDMI monitor
+#define CHECK_HDMI_MONITOR(monitor)                                            \
+  if (edidName == #monitor) {                                                  \
+    monitorName =                                                              \
+        hcct::edid::MonitorName(hcct::edid::HdmiMonitorName::monitor);         \
+    return true;                                                               \
+  }
+  // Generate checks for all HDMI monitors
+  HDMI_MONITOR_LIST(CHECK_HDMI_MONITOR)
+
+  return false;
+}
+
+hcct::VkmsTester::VkmsConnectorBuilder parseConnectorConfig(
+    const std::string &configStr) {
+  std::istringstream ss(configStr);
+  std::string typeStr, planesStr, edidStr;
+
+  auto builder = hcct::VkmsTester::VkmsConnectorBuilder::create();
+
+  // Parse type
+  if (std::getline(ss, typeStr, ',')) {
+    builder.withType(typeStr);
+  }
+
+  // Parse additional planes
+  if (std::getline(ss, planesStr, ',')) {
+    char *endptr;
+    int planes = strtol(planesStr.c_str(), &endptr, 10);
+    if (*endptr != '\0' || planes < 0) {
+      ALOGE("Invalid number of planes: %s", planesStr.c_str());
+    } else {
+      builder.withAdditionalOverlayPlanes(planes);
+    }
+  }
+
+  // Parse optional EDID name
+  if (std::getline(ss, edidStr, ',')) {
+    hcct::edid::MonitorName monitorName;
+    if (stringToMonitorName(edidStr, monitorName)) {
+      builder.withMonitor(monitorName);
+    } else {
+      ALOGE("Unknown EDID profile name: %s", edidStr.c_str());
+    }
+  }
+
+  return builder;
+}
+
+// Helper function to parse all connector configurations
+std::vector<hcct::VkmsTester::VkmsConnectorBuilder> parseConnectorConfigs(
+    int argc, char *argv[], int startIndex) {
+  std::vector<hcct::VkmsTester::VkmsConnectorBuilder> builders;
+
+  for (int i = startIndex; i < argc; i++) {
+    std::string configStr(argv[i]);
+    builders.push_back(parseConnectorConfig(configStr));
+  }
+
+  return builders;
+}
+
+void printUsage(const char *programName) {
+  // clang-format off
+  ALOGI("Usage:");
+  ALOGI("  Simple mode:   %s <number_of_connectors>", programName);
+  ALOGI("  Advanced mode: %s --config TYPE,NUMBER_OF_OVERLAY_PLANES[,EDID_NAME] TYPE,NUMBER_OF_OVERLAY_PLANES[,EDID_NAME] ...", programName);
+  ALOGI("  Where:");
+  ALOGI("    TYPE = connector type (DP, HDMIA, HDMIB, eDP, DSI, VGA, VIRTUAL, "
+        "WRITEBACK, DPI)");
+  ALOGI("    NUMBER_OF_OVERLAY_PLANES = number of additional overlay planes "
+        "(integer)");
+  ALOGI("Examples:");
+  ALOGI("  %s 3", programName);
+  ALOGI("  %s --config DP,2 HDMIA,1", programName);
+  ALOGI("  %s --config DP,2,ACI_9713_ASUS_VE258_DP HDMIA,1,ACI_9155_ASUS_VH238_HDMI", programName);
+  // clang-format on
+}
+
+int main(int argc, char *argv[]) {
+  if (argc <= 1) {
+    ALOGE("Error: No arguments provided");
+    printUsage(argv[0]);
+    return -1;
+  }
+
+  std::unique_ptr<hcct::VkmsTester> vkmsTester;
+
+  // Check for advanced mode with --config flag
+  if (strcmp(argv[1], "--config") == 0) {
+    if (argc <= 2) {
+      ALOGE("Error: No configuration parameters provided after --config");
+      printUsage(argv[0]);
+      return -1;
+    }
+
+    // Parse configs from multiple arguments starting from index 2
+    auto builders = parseConnectorConfigs(argc, argv, 2);
+    if (builders.empty()) {
+      ALOGE("Failed to parse connector configurations");
+      return -1;
+    }
+
+    ALOGI("Setting up vkms with %zu custom connectors", builders.size());
+    vkmsTester = hcct::VkmsTester::CreateWithBuilders(builders);
+  } else {
+    // Simple mode - just a number of connectors
+    char *endptr;
+    int numConnectors = strtol(argv[1], &endptr, 10);
+
+    if (*endptr != '\0' || numConnectors <= 0) {
+      ALOGE("Error: Invalid number of connectors: %s. Must be a positive "
+            "integer.",
+            argv[1]);
+      printUsage(argv[0]);
+      return -1;
+    }
+
+    ALOGI("Setting up vkms with %d generic connectors", numConnectors);
+    vkmsTester = hcct::VkmsTester::CreateWithGenericConnectors(numConnectors);
+  }
+
+  if (!vkmsTester) {
+    ALOGE("Failed to create VkmsTester");
+    return -1;
+  }
+
+  vkmsTester->DisableCleanupOnDestruction();
+
+  // Enable all connectors to run tests on them
+  for (int i = 0; i < vkmsTester->getActiveConnectorsCount(); i++) {
+    if (!vkmsTester->ToggleConnector(i, true)) {
+      ALOGE("Failed to enable connector %d", i);
+      return -1;
+    }
+  }
+
+  return 0;
+}
\ No newline at end of file
diff --git a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceDeltaKind.java b/tests/display/hcct/atest_wrapper/teardown_vkms.cpp
similarity index 57%
rename from libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceDeltaKind.java
rename to tests/display/hcct/atest_wrapper/teardown_vkms.cpp
index d9509a203..414aad497 100644
--- a/libraries/screenshot/deviceless/layoutlib/tests/src/com/android/ide/common/resources/deprecated/ResourceDeltaKind.java
+++ b/tests/display/hcct/atest_wrapper/teardown_vkms.cpp
@@ -1,5 +1,5 @@
 /*
- * Copyright (C) 2022 The Android Open Source Project
+ * Copyright (C) 2025 The Android Open Source Project
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -14,13 +14,22 @@
  * limitations under the License.
  */
 
-package com.android.ide.common.resources.deprecated;
+#include "vkms_tester.h"
+#include <log/log.h>
+#include <stdlib.h>
+#include <unistd.h>
 
-/**
- * @deprecated This class is part of an obsolete resource repository system that is no longer used
- *     in production code. The class is preserved temporarily for LayoutLib tests.
+/*
+ * A simple binary that turns off vkms and deletes the vkms directory.
+ *
+ * Usage:
+ *   ./teardown_vkms
+ *
+ * The binary will turn off the vkms (virtual kernel mode setting) driver
+ * and delete the vkms directory.
  */
-@Deprecated
-public enum ResourceDeltaKind {
-    CHANGED, ADDED, REMOVED
-}
+
+int main() {
+  hcct::VkmsTester::ForceDeleteVkmsDir();
+  return 0;
+}
\ No newline at end of file
diff --git a/tests/display/hcct/tests/Android.bp b/tests/display/hcct/tests/Android.bp
new file mode 100644
index 000000000..58e0989c1
--- /dev/null
+++ b/tests/display/hcct/tests/Android.bp
@@ -0,0 +1,38 @@
+// Copyright (C) 2025 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+cc_test {
+    name: "test_hotplugs",
+    srcs: ["hotplugs.cpp"],
+    defaults: ["hwc_deps"],
+    shared_libs: [
+        "libcutils",
+        "liblog",
+    ],
+    static_libs: [
+        "libgtest",
+        "libgtest_main",
+        "hwc_tester",
+        "vkms_tester",
+    ],
+    cflags: [
+        "-Wall",
+        "-Werror",
+    ],
+    test_config_template: "hcct_config_template.xml",
+}
diff --git a/tests/display/hcct/tests/hcct_config_template.xml b/tests/display/hcct/tests/hcct_config_template.xml
new file mode 100644
index 000000000..4cb1ac1c2
--- /dev/null
+++ b/tests/display/hcct/tests/hcct_config_template.xml
@@ -0,0 +1,36 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2025 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+          http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<configuration description="Config for HWC Compliance Tests">
+    <option name="test-suite-tag" value="HCCT" />
+    <target_preparer class="com.android.tradefed.targetprep.RootTargetPreparer"/>
+
+    <target_preparer class="com.android.tradefed.targetprep.RunCommandTargetPreparer">
+        <option name="run-command" value="stop" />
+        <option name="run-command" value="stop vendor.hwcomposer-3" />
+        <option name="teardown-command" value="start vendor.hwcomposer-3" />
+        <option name="teardown-command" value="start" />
+    </target_preparer>
+
+    <target_preparer class="com.android.tradefed.targetprep.PushFilePreparer">
+        <option name="cleanup" value="true" />
+        <option name="push" value="{MODULE}->/data/local/tmp/{MODULE}" />
+    </target_preparer>
+
+    <test class="com.android.tradefed.testtype.GTest" >
+        <option name="native-test-device-path" value="/data/local/tmp" />
+        <option name="module-name" value="{MODULE}" />
+    </test>
+</configuration>
diff --git a/tests/display/hcct/tests/hotplugs.cpp b/tests/display/hcct/tests/hotplugs.cpp
new file mode 100644
index 000000000..7884295ef
--- /dev/null
+++ b/tests/display/hcct/tests/hotplugs.cpp
@@ -0,0 +1,162 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include "hwc_tester.h"
+#include "vkms_tester.h"
+#include <gtest/gtest.h>
+#include <log/log.h>
+#include <unordered_set>
+
+namespace {
+
+constexpr int kMaxRetries = 5;
+constexpr int kInitialSetupConnectors = 2;
+
+class VkmsHotplugTest : public ::testing::Test {
+protected:
+  void SetUp() override {
+    mVkmsTester =
+        hcct::VkmsTester::CreateWithGenericConnectors(kInitialSetupConnectors);
+    ASSERT_TRUE(mVkmsTester) << "Failed to create VkmsTester";
+    mHwcTester = std::make_unique<hcct::HwcTester>();
+  }
+
+  void TearDown() override {
+    mHwcTester.reset();
+    mVkmsTester.reset();
+  }
+
+  std::unique_ptr<hcct::VkmsTester> mVkmsTester;
+  std::unique_ptr<hcct::HwcTester> mHwcTester;
+};
+
+TEST_F(VkmsHotplugTest, DetectSingleHotplugs) {
+  std::unordered_set<int64_t> hotpluggedDisplays;
+
+  for (int i = 0; i < kInitialSetupConnectors; ++i) {
+    mVkmsTester->ToggleConnector(i, false);
+    mHwcTester->getAndClearLatestHotplugs();
+    ASSERT_TRUE(mHwcTester->getAndClearLatestHotplugs().empty())
+        << "Hotplugs should have been cleared";
+
+    mVkmsTester->ToggleConnector(i, true);
+
+    int retryCount = 0;
+    std::vector<std::pair<int64_t, hcct::common::DisplayHotplugEvent>>
+        receivedHotplugs;
+    while ((receivedHotplugs.empty()) && retryCount++ < kMaxRetries) {
+      sleep(1);
+      receivedHotplugs = mHwcTester->getAndClearLatestHotplugs();
+    }
+    EXPECT_EQ(1, receivedHotplugs.size())
+        << "Hotplug event not received for connector " << i << " after "
+        << retryCount << " seconds";
+    EXPECT_EQ(receivedHotplugs[0].second,
+              hcct::common::DisplayHotplugEvent::CONNECTED)
+        << "Received Disconnect event instead of Connect event for connector "
+        << i;
+
+    hotpluggedDisplays.insert(receivedHotplugs[0].first);
+  }
+
+  EXPECT_EQ(kInitialSetupConnectors, hotpluggedDisplays.size())
+      << "Expected " << kInitialSetupConnectors
+      << " unique hotplug events, but got " << hotpluggedDisplays.size();
+}
+
+TEST_F(VkmsHotplugTest, DetectSingleDisconnectHotplugs) {
+  std::unordered_set<int64_t> hotpluggedDisplays;
+
+  for (int i = 0; i < kInitialSetupConnectors; ++i) {
+    mHwcTester->getAndClearLatestHotplugs();
+    mVkmsTester->ToggleConnector(i, true);
+    // Leave time for the hotplug event to be processed and clear the hotplug
+    int retryCount = 0;
+    std::vector<std::pair<int64_t, hcct::common::DisplayHotplugEvent>>
+        receivedHotplugs;
+    while ((receivedHotplugs.empty()) && retryCount++ < kMaxRetries) {
+      sleep(1);
+      receivedHotplugs = mHwcTester->getAndClearLatestHotplugs();
+    }
+    ASSERT_EQ(receivedHotplugs.size(), 1)
+        << "Hotplug event not received for connector " << i << " after "
+        << retryCount << " seconds";
+    ASSERT_TRUE(mHwcTester->getAndClearLatestHotplugs().empty())
+        << "Hotplugs should have been cleared";
+
+    mVkmsTester->ToggleConnector(i, false);
+
+    retryCount = 0;
+    receivedHotplugs.clear();
+    while ((receivedHotplugs.empty()) && retryCount++ < kMaxRetries) {
+      sleep(1);
+      receivedHotplugs = mHwcTester->getAndClearLatestHotplugs();
+    }
+    EXPECT_EQ(1, receivedHotplugs.size())
+        << "Hotplug event not received for connector " << i << " after "
+        << retryCount << " seconds";
+    if (receivedHotplugs.empty()) {
+      continue;
+    }
+
+    EXPECT_EQ(receivedHotplugs[0].second,
+              hcct::common::DisplayHotplugEvent::DISCONNECTED)
+        << "Received Connect event instead of Disconnect event for connector "
+        << i;
+
+    hotpluggedDisplays.insert(receivedHotplugs[0].first);
+  }
+
+  EXPECT_EQ(kInitialSetupConnectors, hotpluggedDisplays.size())
+      << "Expected " << kInitialSetupConnectors
+      << " unique hotplug events, but got " << hotpluggedDisplays.size();
+}
+
+TEST_F(VkmsHotplugTest, DetectMultipleHotplugs) {
+  for (int i = 0; i < kInitialSetupConnectors; ++i) {
+    mVkmsTester->ToggleConnector(i, false);
+  }
+  mHwcTester->getAndClearLatestHotplugs();
+  ASSERT_TRUE(mHwcTester->getAndClearLatestHotplugs().empty())
+      << "Hotplugs should have been cleared";
+
+  for (int i = 0; i < kInitialSetupConnectors; ++i) {
+    mVkmsTester->ToggleConnector(i, true);
+  }
+
+  int retryCount = 0;
+  std::vector<std::pair<int64_t, hcct::common::DisplayHotplugEvent>>
+      receivedHotplugs;
+  while ((receivedHotplugs.empty()) && retryCount++ < kMaxRetries) {
+    sleep(1);
+    receivedHotplugs = mHwcTester->getAndClearLatestHotplugs();
+  }
+  EXPECT_EQ(kInitialSetupConnectors, receivedHotplugs.size())
+      << "Hotplug event not received after kMaxRetries seconds";
+
+  std::unordered_set<int64_t> hotpluggedDisplays;
+  for (const auto &hotplug : receivedHotplugs) {
+    EXPECT_EQ(hotplug.second, hcct::common::DisplayHotplugEvent::CONNECTED)
+        << "Received Disconnect event instead of Connect event for connector "
+        << hotplug.first;
+    hotpluggedDisplays.insert(hotplug.first);
+  }
+  EXPECT_EQ(kInitialSetupConnectors, hotpluggedDisplays.size())
+      << "Expected " << kInitialSetupConnectors << " unique hotplug"
+      << " events, but got " << hotpluggedDisplays.size();
+}
+
+} // namespace
diff --git a/tests/display/hcct/utils/Android.bp b/tests/display/hcct/utils/Android.bp
new file mode 100644
index 000000000..283e85fef
--- /dev/null
+++ b/tests/display/hcct/utils/Android.bp
@@ -0,0 +1,82 @@
+// Copyright (C) 2025 The Android Open Source Project
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//      http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+
+package {
+    default_applicable_licenses: ["Android-Apache-2.0"],
+}
+
+cc_defaults {
+    name: "hwc_deps",
+    defaults: [
+        "VtsHalTargetTestDefaults",
+        "android.hardware.graphics.common-ndk_static",
+        "android.hardware.graphics.composer3-ndk_static",
+        "librenderengine_deps",
+        "use_libaidlvintf_gtest_helper_static",
+    ],
+    shared_libs: [
+        "libandroid",
+        "libbinder",
+        "libbinder_ndk",
+        "libc++",
+        "liblog",
+        "libnativehelper",
+        "libui",
+    ],
+    static_libs: [
+        "android.hardware.common-V2-ndk",
+        "android.hardware.common.fmq-V1-ndk",
+        "android.hardware.graphics.common@1.2",
+        "libaidlcommonsupport",
+        "libarect",
+        "libbase",
+        "libbase_ndk",
+        "libfmq",
+        "libgtest",
+        "libgtest_main",
+        "libhwc_aidl_test",
+        "librenderengine",
+        "libsync",
+    ],
+    header_libs: [
+        "android.hardware.graphics.composer3-command-buffer",
+    ],
+}
+
+cc_library_static {
+    name: "hwc_tester",
+    defaults: ["hwc_deps"],
+    srcs: [
+        "hwc_tester.cpp",
+    ],
+    export_include_dirs: [
+        ".",
+    ],
+}
+
+cc_library_static {
+    name: "vkms_tester",
+    srcs: [
+        "vkms_tester.cpp",
+        "edid_helper.cpp",
+    ],
+    export_include_dirs: [
+        ".",
+    ],
+    shared_libs: [
+        "libbase",
+        "libcutils",
+        "liblog",
+    ],
+}
diff --git a/tests/display/hcct/utils/edid_helper.cpp b/tests/display/hcct/utils/edid_helper.cpp
new file mode 100644
index 000000000..91eeb1cfb
--- /dev/null
+++ b/tests/display/hcct/utils/edid_helper.cpp
@@ -0,0 +1,219 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include "edid_helper.h"
+
+#include <android-base/parseint.h>
+#include <string>
+#include <unordered_map>
+#include <vector>
+
+namespace hcct {
+namespace edid {
+
+namespace {
+
+std::unordered_map<EdpMonitorName, std::string> edpMonitorNameToEdidHex = {
+  {EdpMonitorName::REDRIX,
+    "00ffffffffffff0009e5760a00000000"
+    "191f0104a51c137803ee95a3544c9926"
+    "0f505400000001010101010101010101"
+    "010101010101125cd01881e02d503020"
+    "36001dbe1000001a623dd01881e02d50"
+    "302036001dbe1000001a000000000000"
+    "00000000000000000000000000000002"
+    "000d28ff0a3cc80f0b23c800000000cc"},
+};
+
+std::unordered_map<DpMonitorName, std::string> dpMonitorNameToEdidHex = {
+  {DpMonitorName::ACI_9713_ASUS_VE258_DP,
+    "00ffffffffffff000469f125f3c60100"
+    "1d150104a5371f783a7695a5544ba226"
+    "115054bfef00714f81c0814081809500"
+    "950fb300d1c0023a801871382d40582c"
+    "450029372100001e000000ff0042374c"
+    "4d54463131363436370a000000fd0032"
+    "4b185311041100f0f838f03c000000fc"
+    "00415355532056453235380a202001b7"
+    "020322714f0102031112130414051f90"
+    "0e0f1d1e2309170783010000656e0c00"
+    "10008c0ad08a20e02d10103e96002937"
+    "21000018011d007251d01e206e285500"
+    "29372100001e011d00bc52d01e20b828"
+    "554029372100001e8c0ad09020403120"
+    "0c405500293721000018000000000000"
+    "000000000000000000000000000000aa"},
+
+  {DpMonitorName::DEL_61463_DELL_U2410_DP,
+    "00ffffffffffff0010ac17f04c334a31"
+    "08150104b53420783a1ec5ae4f34b126"
+    "0e5054a54b008180a940d100714f0101"
+    "010101010101283c80a070b023403020"
+    "360006442100001a000000ff00463532"
+    "354d313247314a334c0a000000fc0044"
+    "454c4c2055323431300a2020000000fd"
+    "00384c1e5111000a20202020202001ff"
+    "02031df15090050403020716011f1213"
+    "14201511062309070783010000023a80"
+    "1871382d40582c450006442100001e01"
+    "1d8018711c1620582c25000644210000"
+    "9e011d007251d01e206e285500064421"
+    "00001e8c0ad08a20e02d10103e960006"
+    "44210000180000000000000000000000"
+    "00000000000000000000000000000021"},
+
+    {DpMonitorName::HP_Spectre32_4K_DP,
+    "00FFFFFFFFFFFF0022F01A3200000000"
+    "2E180104B54728783A87D5A8554D9F25"
+    "0E5054210800D1C0A9C081C0D100B300"
+    "9500A94081804DD000A0F0703E803020"
+    "3500C48F2100001A000000FD00183C1E"
+    "873C000A202020202020000000FC0048"
+    "502053706563747265203332000000FF"
+    "00434E43393430303030310A2020018F"
+    "020318F14B101F041303120211010514"
+    "2309070783010000A36600A0F0701F80"
+    "30203500C48F2100001A565E00A0A0A0"
+    "295030203500C48F2100001AEF5100A0"
+    "F070198030203500C48F2100001AB339"
+    "00A080381F4030203A00C48F2100001A"
+    "283C80A070B0234030203600C48F2100"
+    "001A00000000000000000000000000C4"},
+
+  {DpMonitorName::HWP_12446_HP_Z24i_DP,
+    "00ffffffffffff0022f09e3000000000"
+    "15180104a5342078264ca5a7554da226"
+    "105054a10800b30095008100a9408180"
+    "d1c081c00101283c80a070b023403020"
+    "360006442100001a000000fd00324c18"
+    "5e11000a202020202020000000fc0048"
+    "50205a3234690a2020202020000000ff"
+    "00434e343432313050334b0a2020006f"},
+};
+
+std::unordered_map<HdmiMonitorName, std::string> hdmiMonitorNameToEdidHex = {
+  {HdmiMonitorName::ACI_9155_ASUS_VH238_HDMI,
+    "00ffffffffffff000469c323fccc0000"
+    "2017010380331d782add45a3554fa027"
+    "125054bfef00714f814081809500b300"
+    "d1c001010101023a801871382d40582c"
+    "4500fd1e1100001e000000ff0044384c"
+    "4d54463035323437360a000000fd0032"
+    "4b1e5011000a202020202020000000fc"
+    "00415355532056483233380a202000be"},
+
+  {HdmiMonitorName::DEL_61462_DELL_U2410_HDMI,
+    "00ffffffffffff0010ac16f04c4e4332"
+    "1f13010380342078ea1ec5ae4f34b126"
+    "0e5054a54b008180a940d100714f0101"
+    "010101010101283c80a070b023403020"
+    "360006442100001a000000ff00463532"
+    "354d39375332434e4c0a000000fc0044"
+    "454c4c2055323431300a2020000000fd"
+    "00384c1e5111000a202020202020012e"
+    "020329f15090050403020716011f1213"
+    "14201511062309070767030c00100038"
+    "2d83010000e3050301023a801871382d"
+    "40582c450006442100001e011d801871"
+    "1c1620582c250006442100009e011d00"
+    "7251d01e206e28550006442100001e8c"
+    "0ad08a20e02d10103e96000644210000"
+    "1800000000000000000000000000003e"},
+
+  {HdmiMonitorName::HP_Spectre32_4K_HDMI,
+    "00ffffffffffff0022f01c3201010101"
+    "04190103804728782a87d5a8554d9f25"
+    "0e5054210800d1c0a9c081c0d100b300"
+    "9500a94081804dd000a0f0703e803020"
+    "3500c48f2100001a000000fd00183c1b"
+    "873c000a202020202020000000fc0048"
+    "702053706563747265203332000000ff"
+    "00434e43393430303030310a202001fb"
+    "02033df15361605f5d101f0413031202"
+    "11010514070616152309070783010000"
+    "6c030c001000383c200040010367d85d"
+    "c401788000e40f030000e2002b047400"
+    "30f2705a80b0588a00c48f2100001a56"
+    "5e00a0a0a0295030203500c48f210000"
+    "1eef5100a0f070198030203500c48f21"
+    "00001e000000000000000000000000a8"},
+
+  {HdmiMonitorName::HWP_12447_HP_Z24i_HDMI,
+    "00ffffffffffff0022f09f3001010101"
+    "1a180103803420782e3c50a7544da226"
+    "105054a1080081009500b3008180a940"
+    "81c0d1c00101283c80a070b023403020"
+    "360006442100001a000000fd00324c18"
+    "5e11000a202020202020000000fc0048"
+    "50205a3234690a2020202020000000ff"
+    "00434e4b343236304c47320a202000d6"},
+};
+
+std::vector<uint8_t> hexStringToBinary(const std::string &hexStr) {
+  std::vector<uint8_t> binary;
+  binary.reserve(hexStr.length() / 2);
+
+  for (size_t i = 0; i < hexStr.length(); i += 2) {
+    if (i + 1 < hexStr.length()) {
+      std::string byteString = hexStr.substr(i, 2);
+      uint8_t value = 0;
+      char c1 = byteString[0];
+      char c2 = byteString[1];
+
+      // Convert first hex digit
+      if (isdigit(c1)) {
+        value = (c1 - '0') << 4;
+      } else if (isxdigit(c1)) {
+        value = (tolower(c1) - 'a' + 10) << 4;
+      }
+
+      // Convert second hex digit
+      if (isdigit(c2)) {
+        value |= (c2 - '0');
+      } else if (isxdigit(c2)) {
+        value |= (tolower(c2) - 'a' + 10);
+      }
+      binary.push_back(value);
+    }
+  }
+
+  return binary;
+}
+
+std::string getEdidHexForMonitor(const MonitorName &monitorName) {
+  switch (monitorName.type) {
+  case MonitorName::Type::EDP: {
+    return edpMonitorNameToEdidHex.at(monitorName.edp);
+  }
+  case MonitorName::Type::DP: {
+    return dpMonitorNameToEdidHex.at(monitorName.dp);
+  }
+  case MonitorName::Type::HDMI: {
+    return hdmiMonitorNameToEdidHex.at(monitorName.hdmi);
+  }
+  default:
+    return "";
+  }
+}
+} // namespace
+
+std::vector<uint8_t> getBinaryEdidForMonitor(const MonitorName &monitorName) {
+  std::string edidHex = getEdidHexForMonitor(monitorName);
+  return hexStringToBinary(edidHex);
+}
+
+} // namespace edid
+} // namespace hcct
diff --git a/tests/display/hcct/utils/edid_helper.h b/tests/display/hcct/utils/edid_helper.h
new file mode 100644
index 000000000..a27bf6f1e
--- /dev/null
+++ b/tests/display/hcct/utils/edid_helper.h
@@ -0,0 +1,75 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#pragma once
+
+#include <cstdint>
+#include <vector>
+
+namespace hcct {
+namespace edid {
+
+#define EDP_MONITOR_LIST(X)                                                     \
+  X(REDRIX)                                                    \
+
+#define DP_MONITOR_LIST(X)                                                     \
+  X(ACI_9713_ASUS_VE258_DP)                                                    \
+  X(DEL_61463_DELL_U2410_DP)                                                   \
+  X(HP_Spectre32_4K_DP)                                                        \
+  X(HWP_12446_HP_Z24i_DP)
+
+#define HDMI_MONITOR_LIST(X)                                                   \
+  X(ACI_9155_ASUS_VH238_HDMI)                                                  \
+  X(DEL_61462_DELL_U2410_HDMI)                                                 \
+  X(HP_Spectre32_4K_HDMI)                                                      \
+  X(HWP_12447_HP_Z24i_HDMI)
+
+enum class EdpMonitorName {
+  #define X(monitor) monitor,
+    EDP_MONITOR_LIST(X)
+  #undef X
+};
+
+enum class DpMonitorName {
+#define X(monitor) monitor,
+  DP_MONITOR_LIST(X)
+#undef X
+};
+
+enum class HdmiMonitorName {
+#define X(monitor) monitor,
+  HDMI_MONITOR_LIST(X)
+#undef X
+};
+
+// Unified type to use for function arguments to handle both DP and HDMI.
+struct MonitorName {
+  enum class Type { UNSET, EDP, DP, HDMI } type;
+  union {
+    EdpMonitorName edp;
+    DpMonitorName dp;
+    HdmiMonitorName hdmi;
+  };
+  MonitorName() : type(Type::UNSET) {}
+  MonitorName(EdpMonitorName name) : type(Type::EDP), edp(name) {}
+  MonitorName(DpMonitorName name) : type(Type::DP), dp(name) {}
+  MonitorName(HdmiMonitorName name) : type(Type::HDMI), hdmi(name) {}
+};
+
+std::vector<uint8_t> getBinaryEdidForMonitor(const MonitorName &monitorName);
+
+} // namespace edid
+} // namespace hcct
diff --git a/tests/display/hcct/utils/hwc_tester.cpp b/tests/display/hcct/utils/hwc_tester.cpp
new file mode 100644
index 000000000..663c6e8b2
--- /dev/null
+++ b/tests/display/hcct/utils/hwc_tester.cpp
@@ -0,0 +1,147 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include "hwc_tester.h"
+#include <inttypes.h>
+#include <log/log.h>
+
+namespace hcct {
+
+namespace {
+static constexpr uint32_t kBufferSlotCount = 64;
+} // namespace
+
+HwcTester::HwcTester() {
+  // Add thread pool configuration for Binder IPC
+  android::ProcessState::self()->setThreadPoolMaxThreadCount(4);
+  android::ProcessState::self()->startThreadPool();
+
+  mComposerClient = std::make_unique<libhwc_aidl_test::ComposerClientWrapper>(
+      IComposer::descriptor + std::string("/default"));
+  if (!mComposerClient) {
+    ALOGE("Failed to create HWC client");
+  }
+
+  if (!mComposerClient->createClient().isOk()) {
+    ALOGE("Failed to create HWC client connection");
+  }
+
+  const auto &[status, displays] = mComposerClient->getDisplays();
+  if (!status.isOk() || displays.empty()) {
+    ALOGE("Failed to get displays");
+    return;
+  }
+
+  for (const auto &display : displays) {
+    mDisplays.emplace(display.getDisplayId(), std::move(display));
+  }
+}
+
+HwcTester::~HwcTester() {
+  std::unordered_map<int64_t, ComposerClientWriter *> displayWriters;
+  for (const auto &[id, _] : mDisplays) {
+    displayWriters.emplace(id, &GetWriter(id));
+  }
+  mComposerClient->tearDown(displayWriters);
+  mComposerClient.reset();
+}
+
+std::vector<int64_t> HwcTester::GetAllDisplayIds() const {
+  std::vector<int64_t> displayIds(mDisplays.size());
+
+  for (const auto &[id, _] : mDisplays) {
+    displayIds.push_back(id);
+  }
+
+  return displayIds;
+}
+
+std::vector<std::pair<int64_t, common::DisplayHotplugEvent>>
+HwcTester::getAndClearLatestHotplugs() {
+  return mComposerClient->getAndClearLatestHotplugs();
+}
+
+std::vector<DisplayConfiguration>
+HwcTester::GetDisplayConfigs(int64_t displayId) {
+  const auto &[configStatus, configs] =
+      mComposerClient->getDisplayConfigurations(displayId);
+  if (!configStatus.isOk() || configs.empty()) {
+    ALOGE("Failed to get display configs for display %" PRId64, displayId);
+  }
+
+  return configs;
+}
+
+DisplayConfiguration HwcTester::GetDisplayActiveConfigs(int64_t displayId) {
+  auto [activeConfigStatus, activeConfig] =
+      mComposerClient->getActiveConfig(displayId);
+  if (!activeConfigStatus.isOk()) {
+    ALOGE("Failed to get active config for display %" PRId64, displayId);
+    return {};
+  }
+
+  DisplayConfiguration displayConfig;
+  const auto &configs = GetDisplayConfigs(displayId);
+  for (const auto &config : configs) {
+    if (config.configId == activeConfig) {
+      return config;
+    }
+  }
+
+  ALOGE("Active config was not found in configs for display %" PRId64,
+        displayId);
+  return {};
+}
+
+bool HwcTester::DrawSolidColorToScreen(int64_t displayId, Color color) {
+  // Create a layer for solid color
+  const auto &[status, layer] =
+      mComposerClient->createLayer(displayId, kBufferSlotCount, nullptr);
+  if (!status.isOk()) {
+    ALOGE("Failed to create layer on display %" PRId64, displayId);
+    return false;
+  }
+
+  // Create a writer for the display commands
+  auto &writer = GetWriter(displayId);
+
+  // Set layer properties
+  writer.setLayerCompositionType(displayId, layer, Composition::SOLID_COLOR);
+  writer.setLayerPlaneAlpha(displayId, layer, color.a);
+  writer.setLayerColor(displayId, layer, color);
+
+  DisplayConfiguration displayConfig = GetDisplayActiveConfigs(displayId);
+  writer.setLayerDisplayFrame(
+      displayId, layer, Rect{0, 0, displayConfig.width, displayConfig.height});
+  writer.setLayerZOrder(displayId, layer, 0);
+
+  // Validate and present display
+  writer.validateDisplay(displayId, ComposerClientWriter::kNoTimestamp, 0);
+  writer.presentDisplay(displayId);
+
+  // Execute the commands
+  auto commands = writer.takePendingCommands();
+  std::pair<ScopedAStatus, std::vector<CommandResultPayload>> executeRes =
+      mComposerClient->executeCommands(commands);
+  return executeRes.first.isOk();
+}
+
+ComposerClientWriter &HwcTester::GetWriter(int64_t display) {
+  auto [it, _] = mWriters.try_emplace(display, display);
+  return it->second;
+}
+
+} // namespace hcct
diff --git a/tests/display/hcct/utils/hwc_tester.h b/tests/display/hcct/utils/hwc_tester.h
new file mode 100644
index 000000000..b9fbc34d2
--- /dev/null
+++ b/tests/display/hcct/utils/hwc_tester.h
@@ -0,0 +1,60 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#pragma once
+
+#include <ComposerClientWrapper.h>
+
+#include <aidl/android/hardware/graphics/common/DisplayHotplugEvent.h>
+#include <memory>
+#include <unistd.h>
+#include <unordered_map>
+#include <vector>
+
+namespace hcct {
+
+namespace libhwc_aidl_test =
+    ::aidl::android::hardware::graphics::composer3::libhwc_aidl_test;
+namespace common = ::aidl::android::hardware::graphics::common;
+
+/*
+ * HwcTester is a class that provides an interface to interact with the
+ * HWC AIDL through libhwc_aidl_test. It's not just an interface to the HWC
+ * AIDL, but also provides some helper functions to make it easier to write
+ * tests.
+ */
+
+class HwcTester {
+public:
+  HwcTester();
+  ~HwcTester();
+
+  std::vector<int64_t> GetAllDisplayIds() const;
+  std::vector<std::pair<int64_t, common::DisplayHotplugEvent>>
+  getAndClearLatestHotplugs();
+  bool DrawSolidColorToScreen(int64_t display_id, Color color);
+
+private:
+  std::vector<DisplayConfiguration> GetDisplayConfigs(int64_t display_id);
+  DisplayConfiguration GetDisplayActiveConfigs(int64_t display_id);
+  ComposerClientWriter &GetWriter(int64_t display_id);
+
+  std::unique_ptr<libhwc_aidl_test::ComposerClientWrapper> mComposerClient;
+  std::unordered_map<int64_t, libhwc_aidl_test::DisplayWrapper> mDisplays;
+  std::unordered_map<int64_t, ComposerClientWriter> mWriters;
+};
+
+} // namespace hcct
diff --git a/tests/display/hcct/utils/vkms_tester.cpp b/tests/display/hcct/utils/vkms_tester.cpp
new file mode 100644
index 000000000..de5693d37
--- /dev/null
+++ b/tests/display/hcct/utils/vkms_tester.cpp
@@ -0,0 +1,500 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include "vkms_tester.h"
+
+#include <android-base/file.h>
+#include <cassert>
+#include <cstdio>
+#include <cstdlib>
+#include <cutils/properties.h>
+#include <dirent.h>
+#include <errno.h>
+#include <log/log.h>
+#include <string>
+#include <sys/stat.h>
+#include <sys/wait.h>
+#include <unistd.h>
+#include <unordered_map>
+#include <vector>
+#include <inttypes.h>
+
+namespace hcct {
+
+namespace {
+// `/config/vkms` is the base directory for VKMS in ConfigFS. `my-vkms` is the
+// chosen name of the VKMS instance which can be anything.
+constexpr const char *kVkmsBaseDir = "/config/vkms/my-vkms";
+constexpr int kPlaneTypePrimary = 1;
+
+// https://cs.android.com/android/platform/superproject/main/+/main:external/libdrm/xf86drmMode.h;l=190
+enum class ConnectorStatus {
+  kConnected = 1,
+  kDisconnected = 2,
+  kUnknown = 3,
+};
+} // namespace
+
+// static
+std::unique_ptr<VkmsTester>
+VkmsTester::CreateWithGenericConnectors(int displaysCount) {
+  if (displaysCount < 0) {
+    ALOGE("Invalid number of displays: %i. At least one connector must be "
+          "specified.",
+          displaysCount);
+    return nullptr;
+  }
+
+  auto tester = std::unique_ptr<VkmsTester>(new VkmsTester(displaysCount));
+
+  if (!tester->mInitialized) {
+    ALOGE("Failed to initialize VkmsTester with Generic Connectors");
+    return nullptr;
+  }
+
+  return tester;
+}
+
+// static
+std::unique_ptr<VkmsTester> VkmsTester::CreateWithBuilders(
+    const std::vector<VkmsConnectorBuilder> &builders) {
+  if (builders.empty()) {
+    ALOGE("Empty configuration provided. At least one connector must be "
+          "specified.");
+    return nullptr;
+  }
+
+  auto tester =
+      std::unique_ptr<VkmsTester>(new VkmsTester(builders.size(), builders));
+
+  if (!tester->mInitialized) {
+    ALOGE("Failed to initialize VkmsTester with Builder Config");
+    return nullptr;
+  }
+
+  return tester;
+}
+
+// static
+void VkmsTester::ForceDeleteVkmsDir() { ShutdownAndCleanUpVkms(); }
+
+VkmsTester::VkmsTester(size_t displaysCount,
+                       const std::vector<VkmsConnectorBuilder> &builders) {
+  mInitialized = ToggleHwc3(false) && SetVkmsAsDisplayDriver() &&
+                 SetupDisplays(displaysCount, builders) && ToggleVkms(true) &&
+                 ToggleHwc3(true);
+  if (!mInitialized) {
+    ALOGE("Failed to set up VKMS");
+    ShutdownAndCleanUpVkms();
+    return;
+  }
+
+  mActiveConnectorsCount = displaysCount;
+}
+
+VkmsTester::~VkmsTester() {
+  if (mDisableCleanupOnDestruction) {
+    ALOGI("Skipping cleanup on destruction. mDisableCleanupOnDestruction is "
+          "set to true.");
+    return;
+  }
+
+  ShutdownAndCleanUpVkms();
+}
+
+bool VkmsTester::ToggleConnector(int connectorIndex, bool enable) {
+  return SetConnectorStatus(connectorIndex, enable);
+}
+
+void VkmsTester::DisableCleanupOnDestruction() {
+  mDisableCleanupOnDestruction = true;
+}
+
+bool VkmsTester::SetVkmsAsDisplayDriver() {
+  // TODO(b/398831713): Setup an official doc for reference.
+
+  // Set HWC to use VKMS as the display driver.
+  if (property_set("vendor.hwc.drm.device", "/dev/dri/card1") != 0) {
+    ALOGE("Failed to set vendor.hwc.drm.device property");
+    return false;
+  } else {
+    ALOGI("Successfully set vendor.hwc.drm.device property");
+  }
+
+  // Create VKMS directory
+  if (mkdir(kVkmsBaseDir, 0777) == 0) {
+    ALOGI("Successfully created directory %s", kVkmsBaseDir);
+    return true;
+  }
+
+  return false;
+}
+
+bool VkmsTester::SetupDisplays(
+    int displaysCount, const std::vector<VkmsConnectorBuilder> &builders) {
+  bool isExplicitConfig = !builders.empty();
+  if (isExplicitConfig && displaysCount != builders.size()) {
+    ALOGE("Mismatch between requested displays count and builder config size");
+    return false;
+  }
+
+  for (int i = 0; i < displaysCount; ++i) {
+    CreateResource(DrmResource::kCrtc, i);
+    CreateResource(DrmResource::kEncoder, i);
+    LinkToCrtc(DrmResource::kEncoder, i, i);
+
+    CreateResource(DrmResource::kConnector, i);
+    // Unless explicitly configured, set all connectors to disconnected.
+    SetConnectorStatus(i, isExplicitConfig && builders[i].mEnabledAtStart);
+    if (isExplicitConfig) {
+      SetConnectorType(i, builders[i].mType);
+      if (builders[i].mMonitorName.type != edid::MonitorName::Type::UNSET) {
+        SetConnectorEdid(i, builders[i].mMonitorName);
+      }
+    } else {
+      // Set connector type, eDP for first one, DP for the rest
+      SetConnectorType(i, i == 0 ? ConnectorType::keDP
+                                 : ConnectorType::kDisplayPort);
+    }
+    LinkConnectorToEncoder(i, i);
+
+    int additionalOverlays =
+        isExplicitConfig ? builders[i].mAdditionalOverlayPlanes : 0;
+    for (int j = 0; j < 2 + additionalOverlays; ++j) {
+      CreateResource(DrmResource::kPlane, mLatestPlaneId);
+      // For each connector, create at least 2 planes, a primary and a cursor
+      // PLUS any additional overlay planes
+      PlaneType type;
+      switch (j) {
+      case 0:
+        type = PlaneType::kCursor;
+        break;
+      case 1:
+        type = PlaneType::kPrimary;
+        break;
+      default:
+        type = PlaneType::kOverlay;
+        break;
+      }
+      SetPlaneType(mLatestPlaneId, type);
+      SetPlaneFormat(mLatestPlaneId);
+      LinkToCrtc(DrmResource::kPlane, mLatestPlaneId, i);
+
+      mLatestPlaneId++;
+    }
+
+    ALOGI("Successfully set up display %i", i);
+  }
+
+  return true;
+}
+
+// static
+bool VkmsTester::ToggleVkms(bool enable) {
+  std::string path = std::string(kVkmsBaseDir) + "/enabled";
+  std::string value = enable ? "1" : "0";
+  if (!android::base::WriteStringToFile(value, path)) {
+    ALOGE("Failed to toggle VKMS: %s", strerror(errno));
+    return false;
+  }
+
+  ALOGI("Successfully toggled VKMS at %s", path.c_str());
+  return true;
+}
+
+// static
+bool VkmsTester::ToggleHwc3(bool enable) {
+  const char *serviceName = "vendor.hwcomposer-3";
+  const char *propertyName = "ctl.start";
+  const char *propertyStopName = "ctl.stop";
+
+  if (property_set(enable ? propertyName : propertyStopName, serviceName) !=
+      0) {
+    ALOGE("Failed to set property %s to %s",
+          enable ? propertyName : propertyStopName, serviceName);
+    return false;
+  }
+
+  ALOGI("Successfully set property %s to %s",
+        enable ? propertyName : propertyStopName, serviceName);
+  return true;
+}
+
+bool VkmsTester::CreateResource(DrmResource resource, int index) {
+  std::string resourceBase = kDrmResourceBase.at(resource);
+  std::string resourceDir =
+      std::string(kVkmsBaseDir) + "/" + resourceBase + std::to_string(index);
+  if (mkdir(resourceDir.c_str(), 0777) != 0) {
+    ALOGE("Failed to create directory %s: %s", resourceDir.c_str(),
+          strerror(errno));
+    return false;
+  }
+
+  return true;
+}
+
+bool VkmsTester::SetConnectorStatus(int index, bool enable) {
+  std::string connectorDir = std::string(kVkmsBaseDir) + "/" +
+                             kDrmResourceBase.at(DrmResource::kConnector) +
+                             std::to_string(index);
+  std::string connectedPath = connectorDir + "/status";
+  ConnectorStatus status =
+      enable ? ConnectorStatus::kConnected : ConnectorStatus::kDisconnected;
+  std::string connectedValue = std::to_string(static_cast<int>(status));
+
+  if (!android::base::WriteStringToFile(connectedValue, connectedPath)) {
+    ALOGE("Failed to toggle connector %i: %s", index, strerror(errno));
+    return false;
+  }
+
+  ALOGI("Successfully toggled connector %i: %s", index,
+        enable ? "connected" : "disconnected");
+  return true;
+}
+
+bool VkmsTester::SetConnectorType(int index, ConnectorType type) {
+  std::string connectorDir = std::string(kVkmsBaseDir) + "/" +
+                             kDrmResourceBase.at(DrmResource::kConnector) +
+                             std::to_string(index);
+  std::string typePath = connectorDir + "/type";
+  std::string typeValue = std::to_string(static_cast<int>(type));
+  if (!android::base::WriteStringToFile(typeValue, typePath)) {
+    ALOGE("Failed to write connector type: %s", strerror(errno));
+    return false;
+  }
+
+  ALOGI("Successfully set connector %i type to %i", index,
+        static_cast<int>(type));
+  return true;
+}
+
+bool VkmsTester::SetConnectorEdid(int index, edid::MonitorName monitorName) {
+  std::vector<uint8_t> edidData = edid::getBinaryEdidForMonitor(monitorName);
+  if (edidData.empty()) {
+    ALOGE("Failed to get EDID data for monitor");
+    return false;
+  }
+
+  std::string connectorDir = std::string(kVkmsBaseDir) + "/" +
+                             kDrmResourceBase.at(DrmResource::kConnector) +
+                             std::to_string(index);
+  std::string edidPath = connectorDir + "/edid";
+
+  int fd = open(edidPath.c_str(), O_WRONLY | O_CREAT | O_TRUNC, 0644);
+  if (fd == -1) {
+    ALOGE("Failed to open EDID file for writing: %s", strerror(errno));
+    return false;
+  }
+
+  bool success =
+      android::base::WriteFully(fd, edidData.data(), edidData.size());
+  close(fd);
+
+  if (success) {
+    ALOGI("Successfully wrote EDID data with size %" PRIu64 " to connector %i",
+        edidData.size(), index);
+  } else {
+    ALOGE("Failed to write complete EDID data: %s", strerror(errno));
+  }
+
+  return success;
+}
+
+bool VkmsTester::SetPlaneType(int index, PlaneType type) {
+  std::string planeDir = std::string(kVkmsBaseDir) + "/" +
+                         kDrmResourceBase.at(DrmResource::kPlane) +
+                         std::to_string(index);
+  std::string typePath = planeDir + "/type";
+  std::string typeValue = std::to_string(static_cast<int>(type));
+  if (!android::base::WriteStringToFile(typeValue, typePath)) {
+    ALOGE("Failed to write plane type: %s", strerror(errno));
+    return false;
+  }
+
+  ALOGI("Successfully set plane %i type to %i", index, static_cast<int>(type));
+  return true;
+}
+
+bool VkmsTester::SetPlaneFormat(int index) {
+  std::string planeDir = std::string(kVkmsBaseDir) + "/" +
+                         kDrmResourceBase.at(DrmResource::kPlane) +
+                         std::to_string(index);
+  std::string formatPath = planeDir + "/supported_formats";
+  // TODO(markyacoub): This is now hardcoded to all formats. Extend this later.
+  std::string formatValue = "+*";
+  if (!android::base::WriteStringToFile(formatValue, formatPath)) {
+    ALOGE("Failed to write plane format: %s", strerror(errno));
+    return false;
+  }
+
+  ALOGI("Successfully set plane %i format", index);
+  return true;
+}
+
+bool VkmsTester::LinkToCrtc(DrmResource resource, int resourceIdx,
+                            int crtcIdx) {
+  std::string crtcName =
+      kDrmResourceBase.at(DrmResource::kCrtc) + std::to_string(crtcIdx);
+  std::string resourceDir = std::string(kVkmsBaseDir) + "/" +
+                            kDrmResourceBase.at(resource) +
+                            std::to_string(resourceIdx);
+  std::string possibleCrtcPath = resourceDir + "/possible_" + crtcName;
+  std::string crtcDir = std::string(kVkmsBaseDir) + "/" + crtcName;
+
+  // Now create the symlink
+  if (symlink(crtcDir.c_str(), possibleCrtcPath.c_str()) != 0) {
+    ALOGE("Failed to create symlink at %s pointing to %s: %s",
+          possibleCrtcPath.c_str(), crtcDir.c_str(), strerror(errno));
+    return false;
+  }
+
+  ALOGI("Successfully linked %s to %s", possibleCrtcPath.c_str(),
+        crtcDir.c_str());
+  return true;
+}
+
+bool VkmsTester::LinkConnectorToEncoder(int connectorIdx, int encoderIdx) {
+  std::string encoderName =
+      kDrmResourceBase.at(DrmResource::kEncoder) + std::to_string(encoderIdx);
+  std::string connectorDir = std::string(kVkmsBaseDir) + "/" +
+                             kDrmResourceBase.at(DrmResource::kConnector) +
+                             std::to_string(connectorIdx);
+  std::string possibleEncoderPath = connectorDir + "/possible_" + encoderName;
+  std::string encoderDir = std::string(kVkmsBaseDir) + "/" + encoderName;
+
+  // Now create the symlink
+  if (symlink(encoderDir.c_str(), possibleEncoderPath.c_str()) != 0) {
+    ALOGE("Failed to create symlink at %s pointing to %s: %s",
+          possibleEncoderPath.c_str(), encoderDir.c_str(), strerror(errno));
+    return false;
+  }
+
+  ALOGI("Successfully linked %s to %s", possibleEncoderPath.c_str(),
+        encoderDir.c_str());
+  return true;
+}
+
+// static
+// ConfigFS has special rules about deletion, so we need to clean up manually
+// every layer.
+void VkmsTester::ShutdownAndCleanUpVkms() {
+  ToggleHwc3(false);
+  ToggleVkms(false);
+  // Give the kernel a longer time to release resources
+  usleep(500000);
+
+  // Clean up manually created relationships first under
+  // possible_(crtcs/encoders). This is required before we started cleaning up
+  // the directories.
+  FindAndCleanupPossibleLinks(kVkmsBaseDir);
+  CleanUpDirAndChildren(kVkmsBaseDir);
+}
+
+// static
+void VkmsTester::FindAndCleanupPossibleLinks(const std::string &dirPath) {
+  DIR *dir = opendir(dirPath.c_str());
+  if (!dir) {
+    return;
+  }
+
+  struct dirent *entry;
+  while ((entry = readdir(dir)) != nullptr) {
+    if (strcmp(entry->d_name, ".") == 0 || strcmp(entry->d_name, "..") == 0) {
+      continue;
+    }
+
+    std::string path = dirPath + "/" + entry->d_name;
+    struct stat statBuf;
+
+    if (lstat(path.c_str(), &statBuf) != 0) {
+      continue;
+    }
+
+    if (S_ISDIR(statBuf.st_mode)) {
+      // If this is a "possible_*" directory, process it specially
+      if (strstr(entry->d_name, "possible_") == entry->d_name) {
+        DIR *dir = opendir(path.c_str());
+        if (!dir) {
+          return;
+        }
+
+        // First try to remove any contents
+        struct dirent *entry;
+        while ((entry = readdir(dir)) != nullptr) {
+          if (strcmp(entry->d_name, ".") == 0 ||
+              strcmp(entry->d_name, "..") == 0) {
+            continue;
+          }
+
+          std::string fullPath = path + "/" + entry->d_name;
+          unlink(
+              fullPath
+                  .c_str()); // Try to remove anything inside, ignoring errors
+        }
+
+        closedir(dir);
+
+        // Then try to remove the directory itself
+        rmdir(path.c_str());
+      } else {
+        // Otherwise recursively look for more possible_* directories
+        FindAndCleanupPossibleLinks(path);
+      }
+    }
+  }
+
+  closedir(dir);
+}
+
+// static
+void VkmsTester::CleanUpDirAndChildren(const std::string &dirPath) {
+  DIR *dir = opendir(dirPath.c_str());
+  if (!dir) {
+    ALOGW("Failed to open directory %s: %s - skipping", dirPath.c_str(),
+          strerror(errno));
+    return;
+  }
+
+  struct dirent *entry;
+  while ((entry = readdir(dir)) != nullptr) {
+    // Skip "." and ".."
+    if (strcmp(entry->d_name, ".") == 0 || strcmp(entry->d_name, "..") == 0) {
+      continue;
+    }
+
+    std::string path = dirPath + "/" + entry->d_name;
+    struct stat statBuf;
+
+    if (lstat(path.c_str(), &statBuf) != 0) {
+      ALOGW("Failed to stat %s: %s - skipping", path.c_str(), strerror(errno));
+      continue;
+    }
+
+    if (S_ISDIR(statBuf.st_mode)) {
+      CleanUpDirAndChildren(path);
+    } else {
+    }
+  }
+
+  closedir(dir);
+
+  // Remove the directory itself. Do not check for errors as directories that
+  // are auto-created can't be manually deleted. It's a no-op otherwise so we
+  // can ignore the return value.
+  rmdir(dirPath.c_str());
+}
+
+} // namespace hcct
diff --git a/tests/display/hcct/utils/vkms_tester.h b/tests/display/hcct/utils/vkms_tester.h
new file mode 100644
index 000000000..8645c2fb8
--- /dev/null
+++ b/tests/display/hcct/utils/vkms_tester.h
@@ -0,0 +1,205 @@
+/*
+ * Copyright (C) 2025 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#pragma once
+
+#include "edid_helper.h"
+#include <memory>
+#include <string>
+#include <unordered_map>
+#include <vector>
+
+namespace hcct {
+
+// https://cs.android.com/android/platform/superproject/main/+/main:external/libdrm/include/drm/drm_mode.h;l=403
+#define CONNECTOR_TYPES \
+  CONNECTOR_TYPE(kUnknown, 0, "UNKNOWN") \
+  CONNECTOR_TYPE(kVGA, 1, "VGA") \
+  CONNECTOR_TYPE(kDisplayPort, 10, "DP") \
+  CONNECTOR_TYPE(kHDMIA, 11, "HDMIA") \
+  CONNECTOR_TYPE(keDP, 14, "eDP") \
+  CONNECTOR_TYPE(kVirtual, 15, "VIRTUAL") \
+  CONNECTOR_TYPE(kDSI, 16, "DSI") \
+  CONNECTOR_TYPE(kDPI, 17, "DPI") \
+  CONNECTOR_TYPE(kWriteback, 18, "WRITEBACK")
+
+/**
+ * @class VkmsTester
+ * @brief Handles setup and configuration of Virtual KMS (VKMS) for display
+ * emulation
+ *
+ * This class manages the creation of VKMS directory structures and file system
+ * entries needed to configure virtual displays through the VKMS driver.
+ */
+class VkmsTester {
+public:
+  enum class ConnectorType {
+    #define CONNECTOR_TYPE(enumName, value, stringName) enumName = value,
+    CONNECTOR_TYPES
+    #undef CONNECTOR_TYPE
+  };
+
+  class VkmsConnectorBuilder {
+   public:
+    // Create a builder with default settings
+    static VkmsConnectorBuilder create() { return VkmsConnectorBuilder(); }
+
+    VkmsConnectorBuilder& withType(ConnectorType type) {
+      mType = type;
+      return *this;
+    }
+
+    VkmsConnectorBuilder& withType(const std::string& typeStr) {
+#define CONNECTOR_TYPE(enumName, value, stringName) \
+  if (typeStr == stringName) mType = ConnectorType::enumName;
+      CONNECTOR_TYPES
+#undef CONNECTOR_TYPE
+      return *this;
+    }
+
+    VkmsConnectorBuilder& enabledAtStart(bool enabled = true) {
+      mEnabledAtStart = enabled;
+      return *this;
+    }
+
+    VkmsConnectorBuilder& withAdditionalOverlayPlanes(int count) {
+      mAdditionalOverlayPlanes = count;
+      return *this;
+    }
+
+    VkmsConnectorBuilder& withMonitor(edid::MonitorName monitorName) {
+      mMonitorName = monitorName;
+      return *this;
+    }
+
+    // Friend access for VkmsTester to read the configuration
+    friend class VkmsTester;
+
+   private:
+    ConnectorType mType = ConnectorType::kDisplayPort;
+    bool mEnabledAtStart = true;
+    int mAdditionalOverlayPlanes = 0;
+    edid::MonitorName mMonitorName;
+  };
+
+  /**
+   * Creates a VKMS configuration with a specified number of virtual displays,
+   * each with a default setup.
+   *
+   * Each connector is configured with:
+   *   - 1 CRTC
+   *   - 1 Encoder
+   *   - 2 Planes: 1 Primary and 1 Cursor
+   *
+   * The first connector is set to eDP, and the remaining connectors are set to
+   * DisplayPort.
+   *
+   * @param displaysCount The number of virtual displays to configure.
+   * @return A unique pointer to the created VkmsTester instance, or nullptr if
+   * creation failed.
+   */
+  static std::unique_ptr<VkmsTester>
+  CreateWithGenericConnectors(int displaysCount);
+
+  /**
+   * Creates a VKMS configuration based on a provided vector of connector
+   * builders.
+   *
+   * This method allows for fine-grained control over the configuration of each
+   * virtual display. Each builder in the vector defines a single connector and
+   * its associated configuration.
+   *
+   * @param builders A vector of VkmsConnectorBuilder objects, each defining the
+   * configuration for a single connector. The size of the vector determines the
+   * number of virtual displays to create.
+   * @return A unique pointer to the created VkmsTester instance, or nullptr if
+   * creation failed.
+   */
+  static std::unique_ptr<VkmsTester> CreateWithBuilders(
+      const std::vector<VkmsConnectorBuilder>& builders);
+
+  static void ForceDeleteVkmsDir();
+
+  ~VkmsTester();
+
+  // Returns the number of connectors that have been successfully created
+  // regardless of their connection status.
+  int getActiveConnectorsCount() const { return mActiveConnectorsCount; }
+  bool ToggleConnector(int connectorIndex, bool enable);
+
+  // Prevent the VkmsTester instance from cleaning up the VKMS directories upon
+  // destruction.
+  void DisableCleanupOnDestruction();
+
+private:
+  enum class DrmResource {
+    kConnector,
+    kCrtc,
+    kEncoder,
+    kPlane,
+  };
+
+  // https://cs.android.com/android/platform/superproject/main/+/main:external/libdrm/xf86drmMode.h;l=225
+  enum class PlaneType {
+    kOverlay = 0,
+    kPrimary = 1,
+    kCursor = 2,
+  };
+
+  // Create a map of the base directory for each resource type to maintain
+  // string consistency throughout the code.
+  const std::unordered_map<DrmResource, std::string> kDrmResourceBase = {
+      {DrmResource::kConnector, "connectors/CONNECTOR_"},
+      {DrmResource::kCrtc, "crtcs/CRTC_"},
+      {DrmResource::kEncoder, "encoders/ENCODER_"},
+      {DrmResource::kPlane, "planes/PLANE_"},
+  };
+
+  // Private constructor to prevent direct instantiation without the Create
+  // functions.
+  explicit VkmsTester(size_t displaysCount,
+                      const std::vector<VkmsConnectorBuilder>& builders = {});
+
+  bool SetVkmsAsDisplayDriver();
+  bool SetupDisplays(int displaysCount,
+                     const std::vector<VkmsConnectorBuilder>& builders);
+  static bool ToggleVkms(bool enable);
+  static bool ToggleHwc3(bool enable);
+
+  bool CreateResource(DrmResource resource, int index);
+  bool SetConnectorStatus(int index, bool enable);
+  bool SetConnectorType(int index, ConnectorType type);
+  bool SetConnectorEdid(int index, edid::MonitorName monitorName);
+  bool SetPlaneType(int index, PlaneType type);
+  bool SetPlaneFormat(int index);
+  bool LinkToCrtc(DrmResource resource, int resourceIdx, int crtcIdx);
+  bool LinkConnectorToEncoder(int connectorIdx, int encoderIdx);
+
+  static void ShutdownAndCleanUpVkms();
+  static void FindAndCleanupPossibleLinks(const std::string &dirPath);
+  static void CleanUpDirAndChildren(const std::string &rootDir);
+
+  size_t mActiveConnectorsCount = 0;
+  // Used to track the most recently created plane ID, as the number of planes
+  // can vary per connector. This value is updated whenever a new plane is
+  // created.
+  int mLatestPlaneId = 0;
+
+  bool mDisableCleanupOnDestruction = false;
+  bool mInitialized = false;
+};
+
+} // namespace hcct
\ No newline at end of file
diff --git a/tests/display/igt/Android.bp b/tests/display/igt/Android.bp
new file mode 100644
index 000000000..5684c19cf
--- /dev/null
+++ b/tests/display/igt/Android.bp
@@ -0,0 +1,152 @@
+package {
+    // See: http://go/android-license-faq
+    default_applicable_licenses: [
+        "Android-Apache-2.0",
+    ],
+}
+
+cc_defaults {
+    name: "platform_igt_gpu_tools_default",
+    cppflags: [
+        "-DFLAG_GTEST_ENABLED",
+    ],
+    compile_multilib: "64",
+    local_include_dirs: ["include"],
+    require_root: true,
+    test_suites: [
+        "device-tests",
+    ],
+    shared_libs: [
+        "libbase",
+    ],
+}
+
+cc_test {
+    name: "IgtCoreAuthTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/core_auth.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:core_auth",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsAddfbBasicTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_addfb_basic.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_addfb_basic",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsAtomicInterruptibleTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_atomic_interruptible.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_atomic_interruptible",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsAtomicTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_atomic.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_atomic",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsPlaneLowresTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_plane_lowres.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_plane_lowres",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsPlaneScalingTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_plane_scaling.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_plane_scaling",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsPropBlobTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_prop_blob.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_prop_blob",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsPropertiesTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_properties.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_properties",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsVBlankTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_vblank.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_vblank",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
+
+cc_test {
+    name: "IgtKmsSetmodeTestCases",
+    defaults: ["platform_igt_gpu_tools_default"],
+    srcs: [
+        "src/igt_test_helper.cpp",
+        "src/kms_setmode.cpp",
+    ],
+    data_bins: [
+        "//external/igt-gpu-tools:kms_setmode",
+    ],
+    test_config_template: "igt_config_template.xml",
+}
diff --git a/tests/display/igt/OWNERS b/tests/display/igt/OWNERS
new file mode 100644
index 000000000..5a03129ec
--- /dev/null
+++ b/tests/display/igt/OWNERS
@@ -0,0 +1,2 @@
+markyacoub@google.com
+ddavenport@google.com
diff --git a/tests/display/igt/TEST_MAPPING b/tests/display/igt/TEST_MAPPING
new file mode 100644
index 000000000..311d5dfe9
--- /dev/null
+++ b/tests/display/igt/TEST_MAPPING
@@ -0,0 +1,34 @@
+{
+  "desktop-postsubmit": [
+    {
+      "name": "IgtCoreAuthTestCases"
+    },
+    {
+      "name": "IgtKmsAddfbBasicTestCases"
+    },
+    {
+      "name": "IgtKmsAtomicInterruptibleTestCases"
+    },
+    {
+      "name": "IgtKmsAtomicTestCases"
+    },
+    {
+      "name": "IgtKmsPlaneLowresTestCases"
+    },
+    {
+      "name": "IgtKmsPlaneScalingTestCases"
+    },
+    {
+      "name": "IgtKmsPropBlobTestCases"
+    },
+    {
+      "name": "IgtKmsPropertiesTestCases"
+    },
+    {
+      "name": "IgtKmsVBlankTestCases"
+    },
+    {
+      "name": "IgtKmsSetmodeTestCases"
+    }
+  ]
+}
\ No newline at end of file
diff --git a/tests/display/igt/igt_config_template.xml b/tests/display/igt/igt_config_template.xml
new file mode 100644
index 000000000..c8e7231d3
--- /dev/null
+++ b/tests/display/igt/igt_config_template.xml
@@ -0,0 +1,41 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2024 The Android Open Source Project
+
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+
+         http://www.apache.org/licenses/LICENSE-2.0
+
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<configuration description="Config for {MODULE}">
+    <option name="config-descriptor:metadata" key="parameter" value="not_multi_abi" />
+
+    <target_preparer class="com.android.tradefed.targetprep.RootTargetPreparer" />
+    <target_preparer class="com.android.tradefed.targetprep.RunCommandTargetPreparer">
+        <option name="run-command" value="mkdir -p /data/igt_tests" />
+        <option name="run-command" value="stop vendor.hwcomposer-2-4" />
+        <option name="run-command" value="stop vendor.hwcomposer-3" />
+        <option name="run-command" value="stop vendor.qti.hardware.display.composer" />
+        <option name="teardown-command" value="start vendor.hwcomposer-2-4" />
+        <option name="teardown-command" value="start vendor.hwcomposer-3" />
+        <option name="teardown-command" value="start vendor.qti.hardware.display.composer" />
+    </target_preparer>
+
+    <target_preparer class="com.android.compatibility.common.tradefed.targetprep.FilePusher">
+        <option name="cleanup" value="true" />
+        <option name="append-bitness" value="false" />
+        <option name="push" value="{MODULE}->/data/igt_tests/" />
+    </target_preparer>
+
+    <test class="com.android.tradefed.testtype.GTest">
+        <option name="native-test-device-path" value="/data/igt_tests/x86_64" />
+        <option name="module-name" value="{MODULE}" />
+    </test>
+
+</configuration>
\ No newline at end of file
diff --git a/tests/display/igt/include/igt_test_helper.h b/tests/display/igt/include/igt_test_helper.h
new file mode 100644
index 000000000..e155dcc8a
--- /dev/null
+++ b/tests/display/igt/include/igt_test_helper.h
@@ -0,0 +1,55 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#pragma once
+
+#include <gtest/gtest.h>
+
+#include "android-base/logging.h"
+#include <cstdlib>
+#include <string>
+
+namespace igt {
+
+// Holds the IGT subtests details as outlined in go/igt-al
+struct IgtSubtestParams {
+  std::string name;
+  std::string_view desc;
+  // Describe the reason we care about running this test.
+  std::string_view rationale;
+};
+
+class IgtTestHelper {
+public:
+  // A helper function used by `INSTANTIATE_TEST_SUITE_P` from `GTest` to return
+  // a test name based for each item in the array of |IgtSubtestParams|.
+  static std::string
+  generateGTestName(const ::testing::TestParamInfo<IgtSubtestParams> &info);
+
+protected:
+  IgtTestHelper(const std::string test_name)
+      : test_name_("/data/igt_tests/x86_64/" + test_name + "64") {
+    DCHECK(test_name.length());
+  }
+
+  void runSubTest(const IgtSubtestParams &subtest);
+  void runTest(const std::string &desc, const std::string &rationale);
+
+private:
+  const std::string test_name_ = "";
+};
+
+} // namespace igt
diff --git a/tests/display/igt/src/core_auth.cpp b/tests/display/igt/src/core_auth.cpp
new file mode 100644
index 000000000..3b044367f
--- /dev/null
+++ b/tests/display/igt/src/core_auth.cpp
@@ -0,0 +1,55 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+class CoreAuthTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                      public IgtTestHelper {
+public:
+  CoreAuthTests() : IgtTestHelper("core_auth") {}
+};
+
+IgtSubtestParams subtests[] = {
+    {.name = "getclient-simple",
+     .desc = "Check drm client is always authenticated",
+     .rationale = "ensuring that auth works correctly is probably P0 from a "
+                  "security perspective"},
+    {.name = "getclient-master-drop",
+     .desc =
+         "Use 2 clients, check second is authenticated even when first dropped",
+     .rationale = "ensuring that auth works correctly is probably P0 from a "
+                  "security perspective"},
+    {.name = "basic-auth",
+     .desc = "Test magic numbers for master and slave",
+     .rationale = "ensuring that auth works correctly is probably P0 from a "
+                  "security perspective"},
+};
+
+TEST_P(CoreAuthTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(CoreAuthTests, CoreAuthTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/igt_test_helper.cpp b/tests/display/igt/src/igt_test_helper.cpp
new file mode 100644
index 000000000..59bb13572
--- /dev/null
+++ b/tests/display/igt/src/igt_test_helper.cpp
@@ -0,0 +1,170 @@
+/*
+ * Copyright (C) 2024 Google LLC.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include "include/igt_test_helper.h"
+
+#include <android-base/logging.h>
+#include <gtest/gtest.h>
+
+#include <array>
+#include <cstdio>
+#include <cstdlib>
+#include <memory>
+#include <optional>
+#include <sstream>
+
+namespace igt {
+namespace {
+enum class TestResult { kPass, kFail, kSkip, kUnknown };
+
+std::optional<std::string> runCommand(const std::string &cmd) {
+  // Gtest runs from root /, so the command should start from there.
+  std::unique_ptr<FILE, decltype(&pclose)> pipe(popen(cmd.c_str(), "r"),
+                                                pclose);
+  if (!pipe) {
+    ADD_FAILURE() << "popen() failed! Could not find or run the binary.";
+    return std::nullopt;
+  }
+
+  std::array<char, 128> buffer;
+  std::string result;
+  while (fgets(buffer.data(), buffer.size(), pipe.get()) != nullptr) {
+    result += buffer.data();
+  }
+  return result;
+}
+
+TestResult getSubtestTestResultFromLog(const std::string &log,
+                                       const std::string &subTestName) {
+  if (log.find("Subtest " + subTestName + ": FAIL") != std::string::npos) {
+    return TestResult::kFail;
+  } else if (log.find("Subtest " + subTestName + ": SKIP") !=
+             std::string::npos) {
+    return TestResult::kSkip;
+  } else if (log.find("Subtest " + subTestName + ": SUCCESS") !=
+             std::string::npos) {
+    return TestResult::kPass;
+  } else {
+    return TestResult::kUnknown;
+  }
+}
+
+TestResult getTestResultFromLog(std::string &log) {
+  std::for_each(log.begin(), log.end(), [](char &c) { c = ::tolower(c); });
+
+  if (log.find("fail") != std::string::npos) {
+    return TestResult::kFail;
+  } else if (log.find("skip") != std::string::npos) {
+    return TestResult::kSkip;
+  } else if (log.find("success") != std::string::npos) {
+    return TestResult::kPass;
+  } else {
+    return TestResult::kUnknown;
+  }
+}
+
+std::string generateFailureLog(const std::string &log,
+                               const std::string_view &desc,
+                               const std::string_view &rationale) {
+
+  std::stringstream failureMessage;
+  failureMessage << log << std::endl;
+  failureMessage << "**What the test is doing**: " << desc << std::endl;
+  failureMessage << "**Why the test should be fixed**: " << rationale
+                 << std::endl;
+
+  return failureMessage.str();
+}
+
+void presentTestResult(TestResult result, const std::string &log,
+                       const std::string_view &desc,
+                       const std::string_view &rationale) {
+  switch (result) {
+  case TestResult::kPass:
+    SUCCEED();
+    break;
+  case TestResult::kFail:
+    ADD_FAILURE() << generateFailureLog(log, desc, rationale);
+    break;
+  case TestResult::kSkip:
+    GTEST_SKIP() << log;
+    break;
+  case TestResult::kUnknown:
+    ADD_FAILURE() << "Could not determine test result.\n" << log;
+    break;
+  default:
+    ADD_FAILURE() << log;
+    break;
+  }
+}
+} // namespace
+
+// static
+std::string IgtTestHelper::generateGTestName(
+    const ::testing::TestParamInfo<IgtSubtestParams> &info) {
+  std::string dashedName(info.param.name);
+
+  // Many subtest names include %s and %d which are not valid GTest names.
+  size_t pos = dashedName.find("%s");
+  while (pos != std::string::npos) {
+    dashedName.erase(pos, 2);
+    pos = dashedName.find("%s", pos);
+  }
+  pos = dashedName.find("%d");
+  while (pos != std::string::npos) {
+    dashedName.erase(pos, 2);
+    pos = dashedName.find("%d", pos);
+  }
+
+  // convert test-name to PascalCase
+  std::stringstream ss(dashedName);
+  std::string word;
+  std::string pascalCaseName;
+  while (std::getline(ss, word, '-')) {
+    if (!word.empty()) {
+      // Capitalize the first letter
+      word[0] = std::toupper(word[0]);
+      pascalCaseName += word;
+    }
+  }
+
+  return pascalCaseName;
+}
+
+void IgtTestHelper::runSubTest(const IgtSubtestParams &subtest) {
+  CHECK(test_name_.size());
+  std::optional<std::string> log =
+      runCommand(test_name_ + " --run-subtest " + subtest.name);
+  if (!log.has_value())
+    return;
+
+  TestResult result = getSubtestTestResultFromLog(log.value(), subtest.name);
+  presentTestResult(result, log.value(), subtest.desc, subtest.rationale);
+}
+
+void IgtTestHelper::runTest(const std::string &desc,
+                            const std::string &rationale) {
+  CHECK(test_name_.size());
+
+  std::optional<std::string> log = runCommand(test_name_);
+  if (!log.has_value())
+    return;
+
+  TestResult result = getTestResultFromLog(log.value());
+  presentTestResult(result, log.value(), desc, rationale);
+}
+
+} // namespace igt
diff --git a/tests/display/igt/src/kms_addfb_basic.cpp b/tests/display/igt/src/kms_addfb_basic.cpp
new file mode 100644
index 000000000..731039e92
--- /dev/null
+++ b/tests/display/igt/src/kms_addfb_basic.cpp
@@ -0,0 +1,55 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms addfb basic
+ * Category: Display
+ * Description: Sanity test for ioctls DRM_IOCTL_MODE_ADDFB2 &
+ * DRM_IOCTL_MODE_RMFB.
+ * Functionality: kms_gem_interop Mega feature: General
+ * Display Features Test category: functionality test
+ */
+
+class KmsAddfbBasicTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                           public IgtTestHelper {
+public:
+  KmsAddfbBasicTests() : IgtTestHelper("kms_addfb_basic") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Low Level Validation Tests
+    {.name = "basic",
+     .desc = "Check if addfb2 call works with given handle",
+     .rationale = "fundamentral fb mgmt"},
+};
+
+TEST_P(KmsAddfbBasicTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsAddfbBasicTests, KmsAddfbBasicTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_atomic.cpp b/tests/display/igt/src/kms_atomic.cpp
new file mode 100644
index 000000000..7567ad414
--- /dev/null
+++ b/tests/display/igt/src/kms_atomic.cpp
@@ -0,0 +1,76 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms atomic
+ * Category: Display
+ * Description: Test atomic modesetting API
+ * Functionality: kms_core, plane
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsAtomicTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                       public IgtTestHelper {
+public:
+  KmsAtomicTests() : IgtTestHelper("kms_atomic") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Low Level Validation Tests
+    {.name = "atomic-invalid-params",
+     .desc = "Test abuse the atomic ioctl directly in order to test "
+             "various "
+             "invalid conditions which the libdrm wrapper won't allow "
+             "us to create",
+     .rationale = "important for ensuring the robustness and security of the "
+                  "atomic modesetting API"},
+    {.name = "atomic-plane-damage",
+     .desc = "Simple test cases to use FB_DAMAGE_CLIPS plane property",
+     .rationale = "important for optimizing performance by only updating the "
+                  "portion of the display that has changed"},
+    {.name = "test-only",
+     .desc = "Test to ensure that DRM_MODE_ATOMIC_TEST_ONLY really only "
+             "touches the free-standing state objects and nothing else.",
+     .rationale = "useful for validating a complex modeset configuration "
+                  "before committing to it such"},
+    {.name = "plane-primary-overlay-mutable-zpos",
+     .desc = "Verify that the overlay plane can cover the primary one (and "
+             "vice versa) by changing their zpos property",
+     .rationale = "important for ensuring that the overlay can be displayed "
+                  "correctly on top of or behind the primary plane"},
+    {.name = "plane-immutable-zpos",
+     .desc = "Verify the reported zpos property of planes by making sure only "
+             "higher zpos planes cover the lower zpos ones",
+     .rationale = "important for ensuring that the planes are displayed in the "
+                  "correct order"}};
+
+TEST_P(KmsAtomicTests, Run) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsAtomic, KmsAtomicTests,
+                         ::testing::ValuesIn(subtests));
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_atomic_interruptible.cpp b/tests/display/igt/src/kms_atomic_interruptible.cpp
new file mode 100644
index 000000000..8b95cbe57
--- /dev/null
+++ b/tests/display/igt/src/kms_atomic_interruptible.cpp
@@ -0,0 +1,63 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms atomic interruptible
+ * Category: Display
+ * Description: Tests that interrupt various atomic ioctls.
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsAtomicInterruptibleTests
+    : public ::testing::TestWithParam<IgtSubtestParams>,
+      public IgtTestHelper {
+public:
+  KmsAtomicInterruptibleTests() : IgtTestHelper("kms_atomic_interruptible") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Full System Tests
+    {.name = "atomic-setmode",
+     .desc = "Validate atomic modeset by interruption",
+     .rationale = "interruptibility"},
+    {.name = "universal-setplane-primary",
+     .desc = "Validate atomic setplane on primary by interruption",
+     .rationale = "interruptibility"},
+    {.name = "universal-setplane-cursor",
+     .desc = "Validate atomic setplane on cursor by interruption",
+     .rationale = "interruptibility, "
+                  "otherwise it's not"},
+};
+
+TEST_P(KmsAtomicInterruptibleTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsAtomicInterruptibleTests,
+                         KmsAtomicInterruptibleTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_bw.cpp b/tests/display/igt/src/kms_bw.cpp
new file mode 100644
index 000000000..5ca440582
--- /dev/null
+++ b/tests/display/igt/src/kms_bw.cpp
@@ -0,0 +1,66 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms bw
+ * Category: Display
+ * Description: BW test with different resolutions
+ * Functionality: kms_core
+ * Mega feature: Display Latency/Bandwidth
+ * Test category: functionality test
+ */
+
+class KmsBwTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                   public IgtTestHelper {
+public:
+  KmsBwTests() : IgtTestHelper("kms_flip") {}
+};
+
+constexpr std::string_view kDescription =
+    "pushes the display pipeline's bandwidth to its limits using a "
+    "high-resolution configuration";
+constexpr std::string_view kRationale =
+    "Failure could indicate the system can't handle demanding display tasks, "
+    "leading to slowdowns or an inability to drive the display at its native "
+    "resolution";
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "linear-tiling-%d-displays-%s",
+     .desc = kDescription,
+     .rationale = kRationale},
+    {.name = "connected-linear-tiling-%d-displays-%s",
+     .desc = kDescription,
+     .rationale = kRationale},
+
+};
+
+TEST_P(KmsBwTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsBwTests, KmsBwTests, ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_color.cpp b/tests/display/igt/src/kms_color.cpp
new file mode 100644
index 000000000..a4b32be7c
--- /dev/null
+++ b/tests/display/igt/src/kms_color.cpp
@@ -0,0 +1,69 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms color
+ * Category: Display
+ * Description: Test Color Features at Pipe level
+ * Functionality: colorspace
+ * Mega feature: Color Management
+ * Test category: functionality test
+ */
+
+class KmsColorTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                      public IgtTestHelper {
+public:
+  KmsColorTests() : IgtTestHelper("kms_color") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "deep-color",
+     .desc = "Verify that deep color works correctly",
+     .rationale = "essential for high-quality displays and accurate color "
+                  "representation"},
+    {.name = "degamma",
+     .desc = "Verify that degamma LUT transformation works correctly",
+     .rationale =
+         "verifies that the degamma LUT is applied correctly by the hardware"},
+    {.name = "gamma",
+     .desc = "Verify that gamma LUT transformation works correctly",
+     .rationale =
+         "checks if the gamma LUT is applied correctly by the hardware"},
+    {.name = "ctm-%s",
+     .desc = "Check the color transformation",
+     .rationale = "checks the hardware's ability to apply various color "
+                  "transformations using CTMs"},
+
+};
+
+TEST_P(KmsColorTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsColorTests, KmsColorTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_concurrent.cpp b/tests/display/igt/src/kms_concurrent.cpp
new file mode 100644
index 000000000..bce6b0fbb
--- /dev/null
+++ b/tests/display/igt/src/kms_concurrent.cpp
@@ -0,0 +1,54 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms concurrent
+ * Category: Display
+ * Description: Test atomic mode setting concurrently with multiple planes and
+ *              screen resolution
+ */
+
+class KmsConcurrentTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                           public IgtTestHelper {
+public:
+  KmsConcurrentTests() : IgtTestHelper("kms_concurrent") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Full System Tests
+    {.name = "multi-plane-atomic-lowres",
+     .desc = "Test atomic mode setting concurrently with multiple planes and "
+             "screen resolution.",
+     .rationale = "concurrent operations"},
+};
+
+TEST_P(KmsConcurrentTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsConcurrentTests, KmsConcurrentTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_content_protection.cpp b/tests/display/igt/src/kms_content_protection.cpp
new file mode 100644
index 000000000..987087559
--- /dev/null
+++ b/tests/display/igt/src/kms_content_protection.cpp
@@ -0,0 +1,58 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms content protection
+ * Category: Display
+ * Description: Test content protection (HDCP)
+ * Functionality: hdcp1.4
+ * Mega feature: HDCP
+ * Test category: functionality test
+ */
+
+class KmsContentProtectionTests
+    : public ::testing::TestWithParam<IgtSubtestParams>,
+      public IgtTestHelper {
+public:
+  KmsContentProtectionTests() : IgtTestHelper("kms_content_protection") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "lic-type-0",
+     .desc = "Test for the integrity of link for type-0 content",
+     .rationale = "it's a hardware feature"},
+    {.name = "lic-type-1",
+     .desc = "Test for the integrity of link for type-1 content",
+     .rationale = "it's a hardware feature"}};
+
+TEST_P(KmsContentProtectionTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsContentProtectionTests, KmsContentProtectionTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_cursor_edge_walk.cpp b/tests/display/igt/src/kms_cursor_edge_walk.cpp
new file mode 100644
index 000000000..d40487a50
--- /dev/null
+++ b/tests/display/igt/src/kms_cursor_edge_walk.cpp
@@ -0,0 +1,50 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms cursor edge walk
+ * Category: Display
+ * Description: Test to check different cursor sizes by walking different edges
+ * of screen
+ * Functionality: cursor Mega feature: General Display Features Test
+ * category: functionality test
+ */
+
+class KmsCursorEdgeWalkTests
+    : public ::testing::TestWithParam<IgtSubtestParams>,
+      public IgtTestHelper {
+public:
+  KmsCursorEdgeWalkTests() : IgtTestHelper("kms_cursor_edge_walk") {}
+};
+
+TEST_F(KmsCursorEdgeWalkTests, TestCursorEdgeWalk) {
+  std::string desc = "Test to check different cursor sizes by walking "
+                     "different edges of screen";
+  std::string rationale = "Functionality: cursor";
+  runTest(desc, rationale);
+}
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_display_modes.cpp b/tests/display/igt/src/kms_display_modes.cpp
new file mode 100644
index 000000000..775f2422d
--- /dev/null
+++ b/tests/display/igt/src/kms_display_modes.cpp
@@ -0,0 +1,55 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms display modes
+ * Category: Display
+ * Description: Test Display Modes
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsDisplayModesTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                             public IgtTestHelper {
+public:
+  KmsDisplayModesTests() : IgtTestHelper("kms_display_modes") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "extended-mode-basic",
+     .desc = "Test for validating display extended mode with a pair of "
+             "connected displays",
+     .rationale = "common use case"},
+};
+
+TEST_P(KmsDisplayModesTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsDisplayModesTests, KmsDisplayModesTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_hdmi_inject.cpp b/tests/display/igt/src/kms_hdmi_inject.cpp
new file mode 100644
index 000000000..83f5f95dd
--- /dev/null
+++ b/tests/display/igt/src/kms_hdmi_inject.cpp
@@ -0,0 +1,56 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms hdmi inject
+ * Category: Display
+ * Description: Tests for validating hdmi inject
+ * Functionality: hdmi inject
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsHdmiInjectTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                           public IgtTestHelper {
+public:
+  KmsHdmiInjectTests() : IgtTestHelper("kms_hdmi_inject") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Full System Tests
+    {.name = "inject-4k",
+     .desc = "Make sure that 4K modes exposed by DRM match the forced EDID and "
+             "modesetting using it succeed.",
+     .rationale = "EDID is solid"},
+};
+
+TEST_P(KmsHdmiInjectTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsHdmiInjectTests, KmsHdmiInjectTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_hdr.cpp b/tests/display/igt/src/kms_hdr.cpp
new file mode 100644
index 000000000..b90646770
--- /dev/null
+++ b/tests/display/igt/src/kms_hdr.cpp
@@ -0,0 +1,61 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms hdr
+ * Category: Display
+ * Description: Test HDR metadata interfaces and bpc switch
+ * Mega feature: HDR
+ * Test category: functionality test
+ */
+
+class KmsHdrTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                    public IgtTestHelper {
+public:
+  KmsHdrTests() : IgtTestHelper("kms_hdr") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "bpc-switch",
+     .desc = "Tests switching between different display output bpc modes",
+     .rationale = "it's a hardware feature"},
+    {.name = "invalid-hdr",
+     .desc = "Test to ensure HDR is not enabled on non-HDR panel",
+     .rationale = "it's a hardware feature"},
+    {.name = "invalid-metadata-sizes",
+     .desc = "Tests invalid HDR metadata sizes",
+     .rationale = "it's a hardware feature"},
+
+};
+
+TEST_P(KmsHdrTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsHdrTests, KmsHdrTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_invalid_mode.cpp b/tests/display/igt/src/kms_invalid_mode.cpp
new file mode 100644
index 000000000..ff0ed0728
--- /dev/null
+++ b/tests/display/igt/src/kms_invalid_mode.cpp
@@ -0,0 +1,50 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms invalid mode
+ * Category: Display
+ * Description: Make sure all modesets are rejected when the requested mode is
+ *              invalid
+ * Functionality: kms_core
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsInvalidModeTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                            public IgtTestHelper {
+public:
+  KmsInvalidModeTests() : IgtTestHelper("kms_invalid_mode") {}
+};
+
+TEST_F(KmsInvalidModeTests, TestInvalidMode) {
+  std::string desc = "Test to check different cursor sizes by walking "
+                     "different edges of screen";
+  std::string rationale = "Functionality: cursor";
+  runTest(desc, rationale);
+}
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_pipe_crc_basic.cpp b/tests/display/igt/src/kms_pipe_crc_basic.cpp
new file mode 100644
index 000000000..ff3812d47
--- /dev/null
+++ b/tests/display/igt/src/kms_pipe_crc_basic.cpp
@@ -0,0 +1,67 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms pipe crc basic
+ * Category: Display
+ * Description: Tests behaviour of CRC
+ * Functionality: crc
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPipeCrcBasicTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                             public IgtTestHelper {
+public:
+  KmsPipeCrcBasicTests() : IgtTestHelper("kms_pipe_crc_basic") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "read-crc",
+     .desc = "Test for pipe CRC reads",
+     .rationale =
+         "ensures we can read the CRC which we utilize in a lot of tests"},
+    {.name = "hang-read-crc",
+     .desc = "Hang test for pipe CRC read",
+     .rationale = "Failure might indicate severe issues with hardware "
+                  "stability and error recovery"},
+    // Full System Tests
+    {.name = "read-crc-frame-sequence",
+     .desc = "Tests the pipe CRC read and ensure frame sequence.",
+     .rationale = "verify that the display is outputting the correct pixels."},
+    {.name = "suspend-read-crc",
+     .desc = "Suspend test for pipe CRC reads",
+     .rationale = "verify that the display is outputting the correct pixels."},
+};
+
+TEST_P(KmsPipeCrcBasicTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPipeCrcBasicTests, KmsPipeCrcBasicTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_plane.cpp b/tests/display/igt/src/kms_plane.cpp
new file mode 100644
index 000000000..55f172903
--- /dev/null
+++ b/tests/display/igt/src/kms_plane.cpp
@@ -0,0 +1,64 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms plane
+ * Category: Display
+ * Description: Testes for KMS Plane
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPlaneTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                      public IgtTestHelper {
+public:
+  KmsPlaneTests() : IgtTestHelper("kms_plane") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "planar-pixel-format-settings",
+     .desc = "verify planar settings for pixel format are handled correctly",
+     .rationale = "hardware correctly handles planar pixel formats"},
+    {.name = "pixel-format",
+     .desc = "verify the pixel formats for given plane and pipe",
+     .rationale = "broader test of formats"},
+    // eDP Validation Tests
+    {.name = "plane-position-hole",
+     .desc = "verify plane position using two planes to create a partially "
+             "covered screen",
+     .rationale = "ensure that the eDP panel can correctly display images from "
+                  "multiple planes, avoiding issues like flickering or "
+                  "incorrect layering of elements on the screen"},
+};
+
+TEST_P(KmsPlaneTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPlaneTests, KmsPlaneTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_plane_cursor.cpp b/tests/display/igt/src/kms_plane_cursor.cpp
new file mode 100644
index 000000000..99e340379
--- /dev/null
+++ b/tests/display/igt/src/kms_plane_cursor.cpp
@@ -0,0 +1,56 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms plane cursor
+ * Category: Display
+ * Description: Tests cursor interactions with primary and overlay planes.
+ * Functionality: cursor, plane
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPlaneCursorTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                            public IgtTestHelper {
+public:
+  KmsPlaneCursorTests() : IgtTestHelper("kms_plane_cursor") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Low Level Validation Tests
+    {.name = "primary",
+     .desc = "Tests atomic cursor positioning on primary plane",
+     .rationale = "checks for inability to control the cursor position "
+                  "accurately, impacting user interaction."},
+};
+
+TEST_P(KmsPlaneCursorTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPlaneCursorTests, KmsPlaneCursorTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_plane_lowres.cpp b/tests/display/igt/src/kms_plane_lowres.cpp
new file mode 100644
index 000000000..4d1d05dee
--- /dev/null
+++ b/tests/display/igt/src/kms_plane_lowres.cpp
@@ -0,0 +1,65 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms plane lowres
+ * Category: Display
+ * Description: Test atomic mode setting with a plane by switching between high
+ *              and low resolutions
+ * Functionality: plane, tiling
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPlaneLowresTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                            public IgtTestHelper {
+public:
+  KmsPlaneLowresTests() : IgtTestHelper("kms_plane_lowres") {}
+};
+
+constexpr std::string_view kDescription =
+    "Tests the visibility of the planes when switching between high and low "
+    "resolution";
+constexpr std::string_view kRationale =
+    "revealing issues with memory management or the interaction between "
+    "scaling and tiling";
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "tiling-none", .desc = kDescription, .rationale = kRationale},
+    {.name = "tiling-x", .desc = kDescription, .rationale = kRationale},
+    {.name = "tiling-y", .desc = kDescription, .rationale = kRationale},
+    {.name = "tiling-4", .desc = kDescription, .rationale = kRationale},
+
+};
+
+TEST_P(KmsPlaneLowresTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPlaneLowresTests, KmsPlaneLowresTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_plane_multiple.cpp b/tests/display/igt/src/kms_plane_multiple.cpp
new file mode 100644
index 000000000..52abc2409
--- /dev/null
+++ b/tests/display/igt/src/kms_plane_multiple.cpp
@@ -0,0 +1,61 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms plane multiple
+ * Category: Display
+ * Description: Test atomic mode setting with multiple planes.
+ * Functionality: plane, tiling
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPlaneMultipleTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                              public IgtTestHelper {
+public:
+  KmsPlaneMultipleTests() : IgtTestHelper("kms_plane_multiple") {}
+};
+
+constexpr std::string_view kDescription =
+    "fundamental KMS display functionalities";
+constexpr std::string_view kRationale =
+    "fundamental KMS display functionalities";
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "tiling-x", .desc = kDescription, .rationale = kRationale},
+    {.name = "tiling-y", .desc = kDescription, .rationale = kRationale},
+    {.name = "tiling-4", .desc = kDescription, .rationale = kRationale},
+
+};
+
+TEST_P(KmsPlaneMultipleTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPlaneMultipleTests, KmsPlaneMultipleTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_plane_scaling.cpp b/tests/display/igt/src/kms_plane_scaling.cpp
new file mode 100644
index 000000000..7296f8a78
--- /dev/null
+++ b/tests/display/igt/src/kms_plane_scaling.cpp
@@ -0,0 +1,76 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms plane scaling
+ * Category: Display
+ * Description: Test display plane scaling
+ * Functionality: plane, scaling
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPlaneScalingTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                             public IgtTestHelper {
+public:
+  KmsPlaneScalingTests() : IgtTestHelper("kms_plane_scaling") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "plane-scaler-unity-scaling-with-rotation",
+     .desc = "Tests scaling with rotation, unity scaling",
+     .rationale =
+         "checks if the hardware can correctly combine scaling and rotation. "
+         "Even with unity scaling, the hardware needs to perform the rotation "
+         "while maintaining the image quality and avoiding artifacts"},
+    {.name = "plane-scaler-with-clipping-clamping-rotation",
+     .desc = "Tests scaling with clipping and clamping, rotation",
+     .rationale =
+         "checks if the hardware can correctly handle scaling with additional "
+         "constraints (clipping and clamping) while also performing rotation"},
+    // eDP Validation Tests
+    {.name = "plane-scaler-unity-scaling-with-pixel-format",
+     .desc = "Tests scaling with pixel formats, unity scaling",
+     .rationale = "failure indicate problems with displaying content at the "
+                  "native resolution of the eDP panel, potentially causing "
+                  "blurry or distorted images"},
+    {.name = "plane-downscale-factor-0-5-with-pixel-format",
+     .desc = "Tests downscaling with pixel formats for 0.5 scaling factor.",
+     .rationale =
+         "checks if the eDP panel can correctly downscale images, which is "
+         "important for scenarios like displaying a lower-resolution video on "
+         "the high-resolution panel, preventing issues like incorrect scaling "
+         "artifacts or a black screen"},
+};
+
+TEST_P(KmsPlaneScalingTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPlaneScalingTests, KmsPlaneScalingTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_prop_blob.cpp b/tests/display/igt/src/kms_prop_blob.cpp
new file mode 100644
index 000000000..42ffe96a5
--- /dev/null
+++ b/tests/display/igt/src/kms_prop_blob.cpp
@@ -0,0 +1,61 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms prop blob
+ * Category: Display
+ * Description: Tests behaviour of mass-data 'blob' properties.
+ * Functionality: kms_core
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPropBlobTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                         public IgtTestHelper {
+public:
+  KmsPropBlobTests() : IgtTestHelper("kms_prop_blob") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Full System Tests
+    {.name = "blob-prop-core",
+     .desc = "Tests error handling when invalid property IDs are passed.",
+     .rationale = "DRM property blob functionality"},
+    {.name = "blob-prop-validate",
+     .desc = "Tests error handling when incorrect blob size is passed.",
+     .rationale = "DRM property blob functionality"},
+    {.name = "blob-prop-lifetime",
+     .desc = "Tests validates the lifetime of the properties created",
+     .rationale = "DRM property blob functionality"},
+};
+
+TEST_P(KmsPropBlobTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPropBlobTests, KmsPropBlobTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
\ No newline at end of file
diff --git a/tests/display/igt/src/kms_properties.cpp b/tests/display/igt/src/kms_properties.cpp
new file mode 100644
index 000000000..568d9ebc2
--- /dev/null
+++ b/tests/display/igt/src/kms_properties.cpp
@@ -0,0 +1,67 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms properties
+ * Category: Display
+ * Description: Test to validate the properties of all planes, crtc and
+ * connectors
+ * Functionality: kms_core Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsPropertiesTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                           public IgtTestHelper {
+public:
+  KmsPropertiesTests() : IgtTestHelper("kms_properties") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "get_properties-sanity-atomic",
+     .desc = "Test validates the properties of all planes, crtc and connectors "
+             "with atomic commit",
+     .rationale = "Failure here could lead to all sorts of unexpected behavior "
+                  "- some props are reflection of HW caps"},
+    // Full System Tests
+    {.name = "plane-properties-atomic",
+     .desc = "Tests plane properties with atomic commit",
+     .rationale = "basic prop functionality for planes"},
+    {.name = "crtc-properties-atomic",
+     .desc = "Tests crtc properties with atomic commit",
+     .rationale = "basic prop functionality for crtcs"},
+    {.name = "connector-properties-atomic",
+     .desc = "Tests connector properties with atomic commit",
+     .rationale = "basic prop functionality for connectors"},
+};
+
+TEST_P(KmsPropertiesTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsPropertiesTests, KmsPropertiesTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_rotation_crc.cpp b/tests/display/igt/src/kms_rotation_crc.cpp
new file mode 100644
index 000000000..b013b03a7
--- /dev/null
+++ b/tests/display/igt/src/kms_rotation_crc.cpp
@@ -0,0 +1,73 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms rotation crc
+ * Category: Display
+ * Description: Tests different rotations with different planes & formats
+ * Functionality: plane, rotation
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsRotationCrcTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                            public IgtTestHelper {
+public:
+  KmsRotationCrcTests() : IgtTestHelper("kms_rotation_crc") {}
+};
+
+IgtSubtestParams subtests[] = {
+    {.name = "%s-rotation-180",
+     .desc = "Rotation test with 180 degree for (primary/sprite/cursor) planes",
+     .rationale = "plane rotation"},
+    {.name = "%s-rotation-%d",
+     .desc = "Rotation test with (90/270) degree for (primary/sprite) planes "
+             "of gen9+",
+     .rationale = "plane rotation"},
+    {.name = "bad-pixel-format",
+     .desc = "Checking unsupported pixel format for gen9+ with 90 degree of "
+             "rotation",
+     .rationale = "plane rotation"},
+    {.name = "bad-tiling",
+     .desc = "Checking unsupported tiling for gen9+ with 90 degree of rotation",
+     .rationale = "plane rotation"},
+    {.name = "multiplane-rotation",
+     .desc = "Rotation test on both planes by making them fully visible",
+     .rationale = "plane rotation"},
+    {.name = "multiplane-rotation-cropping-%s",
+     .desc =
+         "Rotation test on both planes by cropping left/(bottom/top) corner of "
+         "primary plane and right/(bottom/top) corner of sprite plane",
+     .rationale = "plane rotation"},
+};
+
+TEST_P(KmsRotationCrcTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsRotationCrcTests, KmsRotationCrcTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
\ No newline at end of file
diff --git a/tests/display/igt/src/kms_scaling_modes.cpp b/tests/display/igt/src/kms_scaling_modes.cpp
new file mode 100644
index 000000000..be4311609
--- /dev/null
+++ b/tests/display/igt/src/kms_scaling_modes.cpp
@@ -0,0 +1,48 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms scaling modes
+ * Category: Display
+ * Description: Test display scaling modes
+ * Functionality: edp, plane, scaling
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsScalingModesTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                             public IgtTestHelper {
+public:
+  KmsScalingModesTests() : IgtTestHelper("kms_scaling_modes") {}
+};
+
+TEST_F(KmsScalingModesTests, TestSysfsEdidTiming) {
+  std::string desc = "Test display scaling modes";
+  std::string rationale = "Functionality: edp, plane, scaling";
+  runTest(desc, rationale);
+}
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_setmode.cpp b/tests/display/igt/src/kms_setmode.cpp
new file mode 100644
index 000000000..9173a920b
--- /dev/null
+++ b/tests/display/igt/src/kms_setmode.cpp
@@ -0,0 +1,55 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms setmode
+ * Category: Display
+ * Description: Tests the mode by iterating through all valid/invalid
+ * crtc/connector combinations
+ * Functionality: kms_core Mega feature: General
+ * Display Features Test category: functionality test
+ */
+
+class KmsSetmodeTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                        public IgtTestHelper {
+public:
+  KmsSetmodeTests() : IgtTestHelper("kms_setmode") {}
+};
+
+IgtSubtestParams subtests[] = {
+    {.name = "basic",
+     .desc = "Tests the vblank timing by iterating through all valid "
+             "crtc/connector combinations",
+     .rationale = "basic functionality"},
+};
+
+TEST_P(KmsSetmodeTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsSetmodeTests, KmsSetmodeTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_sysfs_edid_timing.cpp b/tests/display/igt/src/kms_sysfs_edid_timing.cpp
new file mode 100644
index 000000000..c29ed072a
--- /dev/null
+++ b/tests/display/igt/src/kms_sysfs_edid_timing.cpp
@@ -0,0 +1,50 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms sysfs edid timing
+ * Category: Display
+ * Description: Test to check the time it takes to reprobe each connector.
+ */
+
+class KmsSysfsEdidTimingTests
+    : public ::testing::TestWithParam<IgtSubtestParams>,
+      public IgtTestHelper {
+public:
+  KmsSysfsEdidTimingTests() : IgtTestHelper("kms_sysfs_edid_timing") {}
+};
+
+TEST_F(KmsSysfsEdidTimingTests, TestSysfsEdidTiming) {
+  std::string desc =
+      "This test checks the time it takes to reprobe each connector and fails "
+      "if either the time it takes for one reprobe is too long or if the mean "
+      "time it takes to reprobe one connector is too long. Additionally, make "
+      "sure that the mean time for all connectors is not too long.";
+  std::string rationale = "we don't want tests taking forever to (re)probe";
+  runTest(desc, rationale);
+}
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_tiled_display.cpp b/tests/display/igt/src/kms_tiled_display.cpp
new file mode 100644
index 000000000..fa14450c3
--- /dev/null
+++ b/tests/display/igt/src/kms_tiled_display.cpp
@@ -0,0 +1,55 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms tiled display
+ * Category: Display
+ * Description: Test for Transcoder Port Sync for Display Port Tiled Displays
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsTiledDisplayTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                             public IgtTestHelper {
+public:
+  KmsTiledDisplayTests() : IgtTestHelper("kms_tiled_display") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "basic-test-pattern",
+     .desc = "Make sure the Tiled CRTCs are synchronized and we get page flips "
+             "for all tiled CRTCs in one vblank",
+     .rationale = "Failure could lead to tearing or other visual artifacts"},
+};
+
+TEST_P(KmsTiledDisplayTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsTiledDisplayTests, KmsTiledDisplayTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_vblank.cpp b/tests/display/igt/src/kms_vblank.cpp
new file mode 100644
index 000000000..31fe998bf
--- /dev/null
+++ b/tests/display/igt/src/kms_vblank.cpp
@@ -0,0 +1,78 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms vblank
+ * Category: Display
+ * Description: Test speed of WaitVblank.
+ * Mega feature: General Display Features
+ * Test category: functionality test
+ */
+
+class KmsVblankTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                       public IgtTestHelper {
+public:
+  KmsVblankTests() : IgtTestHelper("kms_vblank") {}
+};
+
+IgtSubtestParams subtests[] = {
+    // Fundamental Validation tests.
+    {.name = "crtc-id",
+     .desc = "Check the vblank and flip events works with given crtc id",
+     .rationale = "If this fails, almost everything else display-related is "
+                  "likely broken as well."},
+    {.name = "ts-continuation-modeset-rpm",
+     .desc = "Test TS continuty with DPMS & RPM while hanging by introducing "
+             "NOHANG flag",
+     .rationale = "Failure could point to serious issues with power management "
+                  "and modesetting, leading to display instability during use"},
+    {.name = "accuracy-idle",
+     .desc = "Test Accuracy of vblank events while hanging by introducing "
+             "NOHANG Flag",
+     .rationale =
+         "Inaccurate signals can lead to performance problems, visual "
+         "artifacts, or even the inability to display an image at all"},
+    // Low Level Validation Tests
+    {.name = "wait-idle",
+     .desc = "Time taken to wait for vblanks",
+     .rationale = "checks for performance degradation and reduced system "
+                  "responsiveness"},
+    {.name = "wait-busy",
+     .desc = "Time taken to wait for vblanks (during V-active)",
+     .rationale = "checks for system instability and unresponsiveness under "
+                  "heavy load"},
+    {.name = "ts-continuation-idle",
+     .desc = "TS continuty",
+     .rationale = "checks for timing issues"},
+};
+
+TEST_P(KmsVblankTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsVblankTests, KmsVblankTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
diff --git a/tests/display/igt/src/kms_vrr.cpp b/tests/display/igt/src/kms_vrr.cpp
new file mode 100644
index 000000000..929d12b27
--- /dev/null
+++ b/tests/display/igt/src/kms_vrr.cpp
@@ -0,0 +1,58 @@
+/*
+ * Copyright (C) 2024 The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+#include <gtest/gtest.h>
+
+#include <cstdlib>
+
+#include "include/igt_test_helper.h"
+
+namespace igt {
+namespace {
+
+/**
+ * TEST: kms vrr
+ * Category: Display
+ * Description: Test to validate different features of VRR
+ * Functionality: adaptive_sync
+ * Mega feature: Adaptive Sync
+ * Test category: functionality test
+ */
+
+class KmsVrrTests : public ::testing::TestWithParam<IgtSubtestParams>,
+                    public IgtTestHelper {
+public:
+  KmsVrrTests() : IgtTestHelper("kms_vrr") {}
+};
+
+IgtSubtestParams subtests[] = {
+    {.name = "flipline",
+     .desc = "Make sure that flips happen at flipline decision boundary",
+     .rationale = "smoother visual experience, especially in games and video"},
+    {.name = "lobf",
+     .desc =
+         "Test to validate link-off between active frames in non-psr operation",
+     .rationale = "ensures that the feature works correctly"},
+};
+
+TEST_P(KmsVrrTests, RunSubTests) { runSubTest(GetParam()); }
+
+INSTANTIATE_TEST_SUITE_P(KmsVrrTests, KmsVrrTests,
+                         ::testing::ValuesIn(subtests),
+                         IgtTestHelper::generateGTestName);
+
+} // namespace
+} // namespace igt
```

