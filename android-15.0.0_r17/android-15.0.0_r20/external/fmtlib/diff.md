```diff
diff --git a/.clang-format b/.clang-format
index df55d340..31f8c343 100644
--- a/.clang-format
+++ b/.clang-format
@@ -6,3 +6,9 @@ IndentPPDirectives: AfterHash
 IndentCaseLabels: false
 AlwaysBreakTemplateDeclarations: false
 DerivePointerAlignment: false
+AllowShortCaseLabelsOnASingleLine: true
+AlignConsecutiveShortCaseStatements:
+  Enabled: true
+  AcrossEmptyLines: true
+  AcrossComments: true
+  AlignCaseColons: false
\ No newline at end of file
diff --git a/.github/dependabot.yml b/.github/dependabot.yml
index 55c156a6..f74783d9 100644
--- a/.github/dependabot.yml
+++ b/.github/dependabot.yml
@@ -1,8 +1,8 @@
 version: 2
 updates:
-  - package-ecosystem: "github-actions" # Necessary to update action hashs	
+  - package-ecosystem: "github-actions" # Necessary to update action hashes.	
     directory: "/"
     schedule:
       interval: "monthly"
-    # Allow up to 3 opened pull requests for github-actions versions
+    # Allow up to 3 opened pull requests for github-actions versions.
     open-pull-requests-limit: 3
diff --git a/.github/workflows/cifuzz.yml b/.github/workflows/cifuzz.yml
index 25250e8b..88144dd9 100644
--- a/.github/workflows/cifuzz.yml
+++ b/.github/workflows/cifuzz.yml
@@ -8,22 +8,22 @@ jobs:
   Fuzzing:
     runs-on: ubuntu-latest
     steps:
-    - name: Build Fuzzers
+    - name: Build fuzzers
       id: build
-      uses: google/oss-fuzz/infra/cifuzz/actions/build_fuzzers@061583ebb5a96653e42feb3a97ee513eedc18078 # master
+      uses: google/oss-fuzz/infra/cifuzz/actions/build_fuzzers@92182553173581f871130c71c71b17f003d47b0a # master
       with:
         oss-fuzz-project-name: 'fmt'
         dry-run: false
         language: c++
-    - name: Run Fuzzers
-      uses: google/oss-fuzz/infra/cifuzz/actions/run_fuzzers@061583ebb5a96653e42feb3a97ee513eedc18078 # master
+    - name: Run fuzzers
+      uses: google/oss-fuzz/infra/cifuzz/actions/run_fuzzers@92182553173581f871130c71c71b17f003d47b0a # master
       with:
         oss-fuzz-project-name: 'fmt'
         fuzz-seconds: 300
         dry-run: false
         language: c++
-    - name: Upload Crash
-      uses: actions/upload-artifact@c7d193f32edcb7bfad88892161225aeda64e9392 # v4.0.0
+    - name: Upload crash
+      uses: actions/upload-artifact@50769540e7f4bd5e21e526ee35c689e35e0d6874 # v4.4.0
       if: failure() && steps.build.outcome == 'success'
       with:
         name: artifacts
diff --git a/.github/workflows/doc.yml b/.github/workflows/doc.yml
index 4055b9f3..019a85f1 100644
--- a/.github/workflows/doc.yml
+++ b/.github/workflows/doc.yml
@@ -11,9 +11,9 @@ jobs:
     runs-on: ubuntu-20.04
 
     steps:
-    - uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0
+    - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
 
-    - name: Add ubuntu mirrors
+    - name: Add Ubuntu mirrors
       run: |
         # Github Actions caching proxy is at times unreliable
         # see https://github.com/actions/runner-images/issues/7048
@@ -21,15 +21,23 @@ jobs:
         curl http://mirrors.ubuntu.com/mirrors.txt | sudo tee --append /etc/apt/mirrors.txt
         sudo sed -i 's~http://azure.archive.ubuntu.com/ubuntu/~mirror+file:/etc/apt/mirrors.txt~' /etc/apt/sources.list
 
-    - name: Create Build Environment
+    - name: Create build environment
       run: |
         sudo apt update
-        sudo apt install doxygen python3-virtualenv
-        sudo npm install -g less clean-css
+        sudo apt install doxygen
+        pip install mkdocs-material==9.5.25 mkdocstrings==0.25.1 mike==2.1.1
         cmake -E make_directory ${{runner.workspace}}/build
+        # Workaround https://github.com/actions/checkout/issues/13:
+        git config --global user.name "$(git --no-pager log --format=format:'%an' -n 1)"
+        git config --global user.email "$(git --no-pager log --format=format:'%ae' -n 1)"
 
     - name: Build
       working-directory: ${{runner.workspace}}/build
+      run: $GITHUB_WORKSPACE/support/mkdocs deploy dev
+
+    - name: Deploy
       env:
-        KEY: ${{secrets.KEY}}
-      run: $GITHUB_WORKSPACE/support/build-docs.py
+        KEY: "${{secrets.KEY}}"
+      if: env.KEY != '' && github.ref == 'refs/heads/master'
+      working-directory: ${{runner.workspace}}/fmt/build/fmt.dev
+      run: git push https://$KEY@github.com/fmtlib/fmt.dev.git
diff --git a/.github/workflows/lint.yml b/.github/workflows/lint.yml
index b906fac2..bbbb8de6 100644
--- a/.github/workflows/lint.yml
+++ b/.github/workflows/lint.yml
@@ -13,10 +13,10 @@ jobs:
   format_code:
     runs-on: ubuntu-latest
     steps:
-    - uses: actions/checkout@v4
+    - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
 
     - name: Install clang-format
-      uses: aminya/setup-cpp@v1
+      uses: aminya/setup-cpp@290824452986e378826155f3379d31bce8753d76 # v0.37.0
       with:
         clangformat: 17.0.5
 
diff --git a/.github/workflows/linux.yml b/.github/workflows/linux.yml
index 0f30ba63..97150467 100644
--- a/.github/workflows/linux.yml
+++ b/.github/workflows/linux.yml
@@ -10,12 +10,13 @@ jobs:
     runs-on: ubuntu-20.04
     strategy:
       matrix:
-        cxx: [g++-4.8, g++-10, clang++-9]
+        cxx: [g++-4.9, g++-10, clang++-9]
         build_type: [Debug, Release]
         std: [11]
+        shared: [""]
         include:
-          - cxx: g++-4.8
-            install: sudo apt install g++-4.8
+          - cxx: g++-4.9
+            install: sudo apt install g++-4.9
           - cxx: g++-8
             build_type: Debug
             std: 14
@@ -54,25 +55,31 @@ jobs:
             std: 20
             cxxflags: -stdlib=libc++
             install: sudo apt install libc++-11-dev libc++abi-11-dev
-          - shared: -DBUILD_SHARED_LIBS=ON
+          - cxx: g++-13
+            build_type: Release
+            std: 23
+            install: sudo apt install g++-13
+            shared: -DBUILD_SHARED_LIBS=ON
 
     steps:
-    - uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0
+    - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
 
     - name: Set timezone
       run: sudo timedatectl set-timezone 'Asia/Yekaterinburg'
 
     - name: Add repositories for older GCC
       run: |
-        # Below two repos provide GCC 4.8, 5.5 and 6.4
-        sudo apt-add-repository 'deb http://azure.archive.ubuntu.com/ubuntu/ bionic main'
-        sudo apt-add-repository 'deb http://azure.archive.ubuntu.com/ubuntu/ bionic universe'
-        # Below two repos additionally update GCC 6 to 6.5
-        # sudo apt-add-repository 'deb http://azure.archive.ubuntu.com/ubuntu/ bionic-updates main'
-        # sudo apt-add-repository 'deb http://azure.archive.ubuntu.com/ubuntu/ bionic-updates universe'
-      if: ${{ matrix.cxx == 'g++-4.8' }}
+        # Below repo provides GCC 4.9.
+        sudo apt-add-repository 'deb http://dk.archive.ubuntu.com/ubuntu/ xenial main'
+        sudo apt-add-repository 'deb http://dk.archive.ubuntu.com/ubuntu/ xenial universe'
+      if: ${{ matrix.cxx == 'g++-4.9' }}
 
-    - name: Add ubuntu mirrors
+    - name: Add repositories for newer GCC
+      run: |
+        sudo apt-add-repository ppa:ubuntu-toolchain-r/test
+      if: ${{ matrix.cxx == 'g++-11' || matrix.cxx == 'g++-13' }}
+
+    - name: Add Ubuntu mirrors
       run: |
         # Github Actions caching proxy is at times unreliable
         # see https://github.com/actions/runner-images/issues/7048
diff --git a/.github/workflows/macos.yml b/.github/workflows/macos.yml
index 48d179f6..3543ef57 100644
--- a/.github/workflows/macos.yml
+++ b/.github/workflows/macos.yml
@@ -9,20 +9,23 @@ jobs:
   build:
     strategy:
       matrix:
-        os: [macos-11, macos-13]
+        os: [macos-13, macos-14]
         build_type: [Debug, Release]
         std: [11, 17, 20]
+        shared: [""]
         exclude:
-          - { os: macos-11, std: 20 }
           - { os: macos-13, std: 11 }
           - { os: macos-13, std: 17 }
         include:
-          - shared: -DBUILD_SHARED_LIBS=ON
+          - os: macos-14
+            std: 23
+            build_type: Release
+            shared: -DBUILD_SHARED_LIBS=ON
 
     runs-on: '${{ matrix.os }}'
 
     steps:
-    - uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0
+    - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
 
     - name: Set timezone
       run: sudo systemsetup -settimezone 'Asia/Yekaterinburg'
diff --git a/.github/workflows/scorecard.yml b/.github/workflows/scorecard.yml
index c5f2ea9d..3f53c332 100644
--- a/.github/workflows/scorecard.yml
+++ b/.github/workflows/scorecard.yml
@@ -29,12 +29,12 @@ jobs:
 
     steps:
       - name: "Checkout code"
-        uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0
+        uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
         with:
           persist-credentials: false
 
       - name: "Run analysis"
-        uses: ossf/scorecard-action@0864cf19026789058feabb7e87baa5f140aac736 # v2.3.1
+        uses: ossf/scorecard-action@62b2cac7ed8198b15735ed49ab1e5cf35480ba46 # v2.4.0
         with:
           results_file: results.sarif
           results_format: sarif
@@ -52,7 +52,7 @@ jobs:
       # Upload the results as artifacts (optional). Commenting out will disable uploads of run results in SARIF
       # format to the repository Actions tab.
       - name: "Upload artifact"
-        uses: actions/upload-artifact@c7d193f32edcb7bfad88892161225aeda64e9392 # v4.0.0
+        uses: actions/upload-artifact@50769540e7f4bd5e21e526ee35c689e35e0d6874 # v4.4.0
         with:
           name: SARIF file
           path: results.sarif
@@ -60,6 +60,6 @@ jobs:
 
       # Upload the results to GitHub's code scanning dashboard.
       - name: "Upload to code-scanning"
-        uses: github/codeql-action/upload-sarif@74483a38d39275f33fcff5f35b679b5ca4a26a99 # v2.22.5
+        uses: github/codeql-action/upload-sarif@4dd16135b69a43b6c8efb853346f8437d92d3c93 # v3.26.6
         with:
           sarif_file: results.sarif
diff --git a/.github/workflows/windows.yml b/.github/workflows/windows.yml
index d576abb1..ecde951e 100644
--- a/.github/workflows/windows.yml
+++ b/.github/workflows/windows.yml
@@ -15,21 +15,16 @@ jobs:
         # https://github.com/actions/virtual-environments.
         os: [windows-2019]
         platform: [Win32, x64]
-        toolset: [v140, v141, v142]
+        toolset: [v141, v142]
         standard: [14, 17, 20]
         shared: ["", -DBUILD_SHARED_LIBS=ON]
         build_type: [Debug, Release]
         exclude:
-          - { toolset: v140, standard: 17 }
-          - { toolset: v140, standard: 20 }
-          - { toolset: v141, standard: 14 }
           - { toolset: v141, standard: 20 }
           - { toolset: v142, standard: 14 }
-          - { platform: Win32, toolset: v140 }
           - { platform: Win32, toolset: v141 }
           - { platform: Win32, standard: 14 }
           - { platform: Win32, standard: 20 }
-          - { platform: x64, toolset: v140, shared: -DBUILD_SHARED_LIBS=ON }
           - { platform: x64, toolset: v141, shared: -DBUILD_SHARED_LIBS=ON }
           - { platform: x64, standard: 14, shared: -DBUILD_SHARED_LIBS=ON }
           - { platform: x64, standard: 20, shared: -DBUILD_SHARED_LIBS=ON }
@@ -41,7 +36,7 @@ jobs:
             standard: 20
 
     steps:
-    - uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0
+    - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
 
     - name: Set timezone
       run: tzutil /s "Ekaterinburg Standard Time"
@@ -83,12 +78,12 @@ jobs:
     - name: Set timezone
       run: tzutil /s "Ekaterinburg Standard Time"
       shell: cmd
-    - uses: msys2/setup-msys2@7efe20baefed56359985e327d329042cde2434ff # v2
+    - uses: msys2/setup-msys2@5df0ca6cbf14efcd08f8d5bd5e049a3cc8e07fd2 # v2.24.0
       with:
         release: false
         msystem: ${{matrix.sys}}
         pacboy: cc:p cmake:p ninja:p lld:p
-    - uses: actions/checkout@8ade135a41bc03ea155e62e844d188df1ea18608 # v4.1.0
+    - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
     - name: Configure
       run: cmake -B ../build -DBUILD_SHARED_LIBS=ON -DCMAKE_BUILD_TYPE=Debug
       env: { LDFLAGS: -fuse-ld=lld }
diff --git a/.gitignore b/.gitignore
index 1406ac34..2635026a 100644
--- a/.gitignore
+++ b/.gitignore
@@ -6,9 +6,6 @@
 /CMakeScripts
 /Testing
 /_CPack_Packages
-/doc/doxyxml
-/doc/html
-/doc/node_modules
 /install_manifest.txt
 CMakeCache.txt
 CMakeFiles
@@ -21,4 +18,3 @@ build/
 cmake_install.cmake
 fmt-*.cmake
 fmt.pc
-virtualenv
diff --git a/Android.bp b/Android.bp
index e1fb5cb5..00d342b3 100644
--- a/Android.bp
+++ b/Android.bp
@@ -135,8 +135,6 @@ cc_defaults {
     // The tests require exceptions and RTTI.
     cflags: [
         "-fexceptions",
-        // https://github.com/fmtlib/fmt/issues/3884
-        "-Wno-non-virtual-dtor",
     ],
     rtti: true,
     // The usual "gtest *and* gmock, please" dance...
@@ -158,9 +156,9 @@ cc_test {
     defaults: ["fmtlib-test-defaults"],
     srcs: [
         "test/args-test.cc",
+        "test/base-test.cc",
         "test/chrono-test.cc",
         "test/color-test.cc",
-        "test/core-test.cc",
         "test/enforce-checks-test.cc",
         "test/format-test.cc",
         "test/noexception-test.cc",
@@ -168,7 +166,8 @@ cc_test {
         // file descriptors, but Android's fdsan won't let them.
         // "test/os-test.cc",
         "test/ranges-odr-test.cc",
-        "test/scan-test.cc",
+        // Includes fmt/format-inl.h twice, causing duplicated symbols.
+        // "test/scan-test.cc",
         // Depends on filesystem_error declarations which are not linked.
         // "test/std-test.cc",
         "test/unicode-test.cc",
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 4b928ae3..1606e886 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,4 +1,4 @@
-cmake_minimum_required(VERSION 3.8...3.26)
+cmake_minimum_required(VERSION 3.8...3.28)
 
 # Fallback for using newer policies on CMake <3.12.
 if (${CMAKE_VERSION} VERSION_LESS 3.12)
@@ -36,6 +36,12 @@ function(enable_module target)
   endif ()
 endfunction()
 
+set(FMT_USE_CMAKE_MODULES FALSE)
+if (CMAKE_VERSION VERSION_GREATER_EQUAL 3.28 AND
+    CMAKE_GENERATOR STREQUAL "Ninja")
+  set(FMT_USE_CMAKE_MODULES TRUE)
+endif ()
+
 # Adds a library compiled with C++20 module support.
 # `enabled` is a CMake variables that specifies if modules are enabled.
 # If modules are disabled `add_module_library` falls back to creating a
@@ -53,6 +59,7 @@ function(add_module_library name)
   if (NOT ${${AML_IF}})
     # Create a non-modular library.
     target_sources(${name} PRIVATE ${AML_FALLBACK})
+    set_target_properties(${name} PROPERTIES CXX_SCAN_FOR_MODULES OFF)
     return()
   endif ()
 
@@ -62,48 +69,55 @@ function(add_module_library name)
     target_compile_options(${name} PUBLIC -fmodules-ts)
   endif ()
 
-  # `std` is affected by CMake options and may be higher than C++20.
-  get_target_property(std ${name} CXX_STANDARD)
-
-  if (CMAKE_CXX_COMPILER_ID MATCHES "Clang")
-    set(pcms)
-    foreach (src ${sources})
-      get_filename_component(pcm ${src} NAME_WE)
-      set(pcm ${pcm}.pcm)
-
-      # Propagate -fmodule-file=*.pcm to targets that link with this library.
-      target_compile_options(
-        ${name} PUBLIC -fmodule-file=${CMAKE_CURRENT_BINARY_DIR}/${pcm})
-
-      # Use an absolute path to prevent target_link_libraries prepending -l
-      # to it.
-      set(pcms ${pcms} ${CMAKE_CURRENT_BINARY_DIR}/${pcm})
-      add_custom_command(
-        OUTPUT ${pcm}
-        COMMAND ${CMAKE_CXX_COMPILER}
-                -std=c++${std} -x c++-module --precompile -c
-                -o ${pcm} ${CMAKE_CURRENT_SOURCE_DIR}/${src}
-                "-I$<JOIN:$<TARGET_PROPERTY:${name},INCLUDE_DIRECTORIES>,;-I>"
-        # Required by the -I generator expression above.
-        COMMAND_EXPAND_LISTS
-        DEPENDS ${src})
-    endforeach ()
-
-    # Add .pcm files as sources to make sure they are built before the library.
-    set(sources)
-    foreach (pcm ${pcms})
-      get_filename_component(pcm_we ${pcm} NAME_WE)
-      set(obj ${pcm_we}.o)
-      # Use an absolute path to prevent target_link_libraries prepending -l.
-      set(sources ${sources} ${pcm} ${CMAKE_CURRENT_BINARY_DIR}/${obj})
-      add_custom_command(
-        OUTPUT ${obj}
-        COMMAND ${CMAKE_CXX_COMPILER} $<TARGET_PROPERTY:${name},COMPILE_OPTIONS>
-                -c -o ${obj} ${pcm}
-        DEPENDS ${pcm})
-    endforeach ()
-  endif ()
-  target_sources(${name} PRIVATE ${sources})
+  target_compile_definitions(${name} PRIVATE FMT_MODULE)
+
+  if (FMT_USE_CMAKE_MODULES)
+    target_sources(${name} PUBLIC FILE_SET fmt TYPE CXX_MODULES
+                   FILES ${sources})
+  else()
+    # `std` is affected by CMake options and may be higher than C++20.
+    get_target_property(std ${name} CXX_STANDARD)
+
+    if (CMAKE_CXX_COMPILER_ID MATCHES "Clang")
+      set(pcms)
+      foreach (src ${sources})
+        get_filename_component(pcm ${src} NAME_WE)
+        set(pcm ${pcm}.pcm)
+
+        # Propagate -fmodule-file=*.pcm to targets that link with this library.
+        target_compile_options(
+          ${name} PUBLIC -fmodule-file=${CMAKE_CURRENT_BINARY_DIR}/${pcm})
+
+        # Use an absolute path to prevent target_link_libraries prepending -l
+        # to it.
+        set(pcms ${pcms} ${CMAKE_CURRENT_BINARY_DIR}/${pcm})
+        add_custom_command(
+          OUTPUT ${pcm}
+          COMMAND ${CMAKE_CXX_COMPILER}
+                  -std=c++${std} -x c++-module --precompile -c
+                  -o ${pcm} ${CMAKE_CURRENT_SOURCE_DIR}/${src}
+                  "-I$<JOIN:$<TARGET_PROPERTY:${name},INCLUDE_DIRECTORIES>,;-I>"
+          # Required by the -I generator expression above.
+          COMMAND_EXPAND_LISTS
+          DEPENDS ${src})
+      endforeach ()
+
+      # Add .pcm files as sources to make sure they are built before the library.
+      set(sources)
+      foreach (pcm ${pcms})
+        get_filename_component(pcm_we ${pcm} NAME_WE)
+        set(obj ${pcm_we}.o)
+        # Use an absolute path to prevent target_link_libraries prepending -l.
+        set(sources ${sources} ${pcm} ${CMAKE_CURRENT_BINARY_DIR}/${obj})
+        add_custom_command(
+          OUTPUT ${obj}
+          COMMAND ${CMAKE_CXX_COMPILER} $<TARGET_PROPERTY:${name},COMPILE_OPTIONS>
+                  -c -o ${obj} ${pcm}
+          DEPENDS ${pcm})
+      endforeach ()
+    endif ()
+    target_sources(${name} PRIVATE ${sources})
+  endif()
 endfunction()
 
 include(CMakeParseArguments)
@@ -150,9 +164,10 @@ option(FMT_INSTALL "Generate the install target." ON)
 option(FMT_TEST "Generate the test target." ${FMT_MASTER_PROJECT})
 option(FMT_FUZZ "Generate the fuzz target." OFF)
 option(FMT_CUDA_TEST "Generate the cuda-test target." OFF)
-option(FMT_OS "Include core requiring OS (Windows/Posix) " ON)
+option(FMT_OS "Include OS-specific APIs." ON)
 option(FMT_MODULE "Build a module instead of a traditional library." OFF)
 option(FMT_SYSTEM_HEADERS "Expose headers with marking them as system." OFF)
+option(FMT_UNICODE "Enable Unicode support." ON)
 
 if (FMT_TEST AND FMT_MODULE)
   # The tests require {fmt} to be compiled as traditional library
@@ -167,10 +182,10 @@ if (CMAKE_SYSTEM_NAME STREQUAL "MSDOS")
   message(STATUS "MSDOS is incompatible with gtest")
 endif ()
 
-# Get version from core.h
-file(READ include/fmt/core.h core_h)
-if (NOT core_h MATCHES "FMT_VERSION ([0-9]+)([0-9][0-9])([0-9][0-9])")
-  message(FATAL_ERROR "Cannot get FMT_VERSION from core.h.")
+# Get version from base.h
+file(READ include/fmt/base.h base_h)
+if (NOT base_h MATCHES "FMT_VERSION ([0-9]+)([0-9][0-9])([0-9][0-9])")
+  message(FATAL_ERROR "Cannot get FMT_VERSION from base.h.")
 endif ()
 # Use math to skip leading zeros if any.
 math(EXPR CPACK_PACKAGE_VERSION_MAJOR ${CMAKE_MATCH_1})
@@ -178,7 +193,7 @@ math(EXPR CPACK_PACKAGE_VERSION_MINOR ${CMAKE_MATCH_2})
 math(EXPR CPACK_PACKAGE_VERSION_PATCH ${CMAKE_MATCH_3})
 join(FMT_VERSION ${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.
                  ${CPACK_PACKAGE_VERSION_PATCH})
-message(STATUS "Version: ${FMT_VERSION}")
+message(STATUS "{fmt} version: ${FMT_VERSION}")
 
 message(STATUS "Build type: ${CMAKE_BUILD_TYPE}")
 
@@ -225,7 +240,13 @@ if (CMAKE_CXX_COMPILER_ID MATCHES "GNU")
   endif ()
   if (NOT CMAKE_CXX_COMPILER_VERSION VERSION_LESS 6.0)
       set(PEDANTIC_COMPILE_FLAGS ${PEDANTIC_COMPILE_FLAGS} -Wshift-overflow=2
-          -Wnull-dereference -Wduplicated-cond)
+          -Wduplicated-cond)
+      # Workaround for GCC regression
+      # [12/13/14/15 regression] New (since gcc 12) false positive null-dereference in vector.resize
+      # https://gcc.gnu.org/bugzilla/show_bug.cgi?id=108860
+      if (CMAKE_CXX_COMPILER_VERSION VERSION_LESS 12.0)
+        set(PEDANTIC_COMPILE_FLAGS ${PEDANTIC_COMPILE_FLAGS} -Wnull-dereference)
+      endif ()
   endif ()
   set(WERROR_FLAG -Werror)
 endif ()
@@ -274,13 +295,10 @@ function(add_headers VAR)
 endfunction()
 
 # Define the fmt library, its includes and the needed defines.
-add_headers(FMT_HEADERS args.h chrono.h color.h compile.h core.h format.h
+add_headers(FMT_HEADERS args.h base.h chrono.h color.h compile.h core.h format.h
                         format-inl.h os.h ostream.h printf.h ranges.h std.h
                         xchar.h)
 set(FMT_SOURCES src/format.cc)
-if (FMT_OS)
-  set(FMT_SOURCES ${FMT_SOURCES} src/os.cc)
-endif ()
 
 add_module_library(fmt src/fmt.cc FALLBACK
                    ${FMT_SOURCES} ${FMT_HEADERS} README.md ChangeLog.md
@@ -288,6 +306,10 @@ add_module_library(fmt src/fmt.cc FALLBACK
 add_library(fmt::fmt ALIAS fmt)
 if (FMT_MODULE)
   enable_module(fmt)
+elseif (FMT_OS)
+  target_sources(fmt PRIVATE src/os.cc)
+else()
+  target_compile_definitions(fmt PRIVATE FMT_OS=0)
 endif ()
 
 if (FMT_WERROR)
@@ -303,7 +325,7 @@ else ()
   message(WARNING "Feature cxx_std_11 is unknown for the CXX compiler")
 endif ()
 
-target_include_directories(fmt ${FMT_SYSTEM_HEADERS_ATTRIBUTE} PUBLIC
+target_include_directories(fmt ${FMT_SYSTEM_HEADERS_ATTRIBUTE} BEFORE PUBLIC
   $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include>
   $<INSTALL_INTERFACE:${FMT_INC_DIR}>)
 
@@ -339,11 +361,21 @@ endif ()
 add_library(fmt-header-only INTERFACE)
 add_library(fmt::fmt-header-only ALIAS fmt-header-only)
 
+if (NOT MSVC)
+  # Unicode is always supported on compilers other than MSVC.
+elseif (FMT_UNICODE)
+  # Unicode support requires compiling with /utf-8.
+  target_compile_options(fmt PUBLIC $<$<AND:$<COMPILE_LANGUAGE:CXX>,$<CXX_COMPILER_ID:MSVC>>:/utf-8>)
+  target_compile_options(fmt-header-only INTERFACE $<$<AND:$<COMPILE_LANGUAGE:CXX>,$<CXX_COMPILER_ID:MSVC>>:/utf-8>)
+else ()
+  target_compile_definitions(fmt PUBLIC FMT_UNICODE=0)
+endif ()
+
 target_compile_definitions(fmt-header-only INTERFACE FMT_HEADER_ONLY=1)
 target_compile_features(fmt-header-only INTERFACE cxx_std_11)
 
 target_include_directories(fmt-header-only
-  ${FMT_SYSTEM_HEADERS_ATTRIBUTE} INTERFACE
+  ${FMT_SYSTEM_HEADERS_ATTRIBUTE} BEFORE INTERFACE
   $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include>
   $<INSTALL_INTERFACE:${FMT_INC_DIR}>)
 
@@ -388,12 +420,18 @@ if (FMT_INSTALL)
 
   set(INSTALL_TARGETS fmt fmt-header-only)
 
+  set(INSTALL_FILE_SET)
+  if (FMT_USE_CMAKE_MODULES)
+    set(INSTALL_FILE_SET FILE_SET fmt DESTINATION "${FMT_INC_DIR}/fmt")
+  endif()
+
   # Install the library and headers.
   install(TARGETS ${INSTALL_TARGETS} EXPORT ${targets_export_name}
           LIBRARY DESTINATION ${FMT_LIB_DIR}
           ARCHIVE DESTINATION ${FMT_LIB_DIR}
           PUBLIC_HEADER DESTINATION "${FMT_INC_DIR}/fmt"
-          RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR})
+          RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
+          ${INSTALL_FILE_SET})
 
   # Use a namespace because CMake provides better diagnostics for namespaced
   # imported targets.
@@ -410,8 +448,44 @@ if (FMT_INSTALL)
   install(FILES "${pkgconfig}" DESTINATION "${FMT_PKGCONFIG_DIR}")
 endif ()
 
+function(add_doc_target)
+  find_program(DOXYGEN doxygen
+    PATHS "$ENV{ProgramFiles}/doxygen/bin"
+          "$ENV{ProgramFiles\(x86\)}/doxygen/bin")
+  if (NOT DOXYGEN)
+    message(STATUS "Target 'doc' disabled because doxygen not found")
+    return ()
+  endif ()
+
+  find_program(MKDOCS mkdocs)
+  if (NOT MKDOCS)
+    message(STATUS "Target 'doc' disabled because mkdocs not found")
+    return ()
+  endif ()
+
+  set(sources )
+  foreach (source api.md index.md syntax.md get-started.md fmt.css fmt.js)
+    set(sources ${sources} doc/${source})
+  endforeach()
+
+  add_custom_target(
+    doc
+    COMMAND
+      ${CMAKE_COMMAND}
+        -E env PYTHONPATH=${CMAKE_CURRENT_SOURCE_DIR}/support/python
+        ${MKDOCS} build -f ${CMAKE_CURRENT_SOURCE_DIR}/support/mkdocs.yml
+        # MkDocs requires the site dir to be outside of the doc dir.
+                        --site-dir ${CMAKE_CURRENT_BINARY_DIR}/doc-html
+                        --no-directory-urls
+    SOURCES ${sources})
+
+  include(GNUInstallDirs)
+  install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/doc-html/
+          DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/doc/fmt OPTIONAL)
+endfunction()
+
 if (FMT_DOC)
-  add_subdirectory(doc)
+  add_doc_target()
 endif ()
 
 if (FMT_TEST)
@@ -441,8 +515,7 @@ if (FMT_MASTER_PROJECT AND EXISTS ${gitignore})
     string(REPLACE "*" ".*" line "${line}")
     set(ignored_files ${ignored_files} "${line}$" "${line}/")
   endforeach ()
-  set(ignored_files ${ignored_files}
-    /.git /breathe /format-benchmark sphinx/ .buildinfo .doctrees)
+  set(ignored_files ${ignored_files} /.git /build/doxyxml .vagrant)
 
   set(CPACK_SOURCE_GENERATOR ZIP)
   set(CPACK_SOURCE_IGNORE_FILES ${ignored_files})
diff --git a/ChangeLog.md b/ChangeLog.md
index 8f8075ac..0eb9ba8e 100644
--- a/ChangeLog.md
+++ b/ChangeLog.md
@@ -1,5528 +1,2632 @@
-# 10.2.0 - 2024-01-01
-
--   Added support for the `%j` specifier (the number of days) for
-    `std::chrono::duration` (https://github.com/fmtlib/fmt/issues/3643,
-    https://github.com/fmtlib/fmt/pull/3732). Thanks @intelfx.
-
--   Added support for the chrono suffix for days and changed
-    the suffix for minutes from "m" to the correct "min"
-    (https://github.com/fmtlib/fmt/issues/3662,
-    https://github.com/fmtlib/fmt/pull/3664).
-    For example ([godbolt](https://godbolt.org/z/9KhMnq9ba)):
-
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      fmt::print("{}\n", std::chrono::days(42)); // prints "42d"
-    }
-    ```
-
-    Thanks @Richardk2n.
-
--   Fixed an overflow in `std::chrono::time_point` formatting with large dates
-    (https://github.com/fmtlib/fmt/issues/3725,
-    https://github.com/fmtlib/fmt/pull/3727). Thanks @cschreib.
-
--   Added a formatter for `std::source_location`
-    (https://github.com/fmtlib/fmt/pull/3730).
-    For example ([godbolt](https://godbolt.org/z/YajfKjhhr)):
-
-    ```c++
-    #include <source_location>
-    #include <fmt/std.h>
-
-    int main() {
-      fmt::print("{}\n", std::source_location::current());
-    }
-    ```
-
-    prints
-
-    ```
-    /app/example.cpp:5:51: int main()
-    ```
-
-    Thanks @felix642.
+# 11.1.0 - TBD
 
--   Added a formatter for `std::bitset`
-    (https://github.com/fmtlib/fmt/pull/3660).
-    For example ([godbolt](https://godbolt.org/z/bdEaGeYxe)):
+- Improved debug codegen.
+
+# 11.0.2 - 2024-07-20
 
-    ```c++
-    #include <bitset>
-    #include <fmt/std.h>
+- Fixed compatibility with non-POSIX systems
+  (https://github.com/fmtlib/fmt/issues/4054,
+  https://github.com/fmtlib/fmt/issues/4060).
+
+- Fixed performance regressions when using `std::back_insert_iterator` with
+  `fmt::format_to` (https://github.com/fmtlib/fmt/issues/4070).
+
+- Fixed handling of `std::generator` and move-only iterators
+  (https://github.com/fmtlib/fmt/issues/4053,
+  https://github.com/fmtlib/fmt/pull/4057). Thanks @Arghnews.
+
+- Made `formatter<std::string_view>::parse` work with types convertible to
+  `std::string_view` (https://github.com/fmtlib/fmt/issues/4036,
+  https://github.com/fmtlib/fmt/pull/4055). Thanks @Arghnews.
+
+- Made `volatile void*` formattable
+  (https://github.com/fmtlib/fmt/issues/4049,
+  https://github.com/fmtlib/fmt/pull/4056). Thanks @Arghnews.
+
+- Made `Glib::ustring` not be confused with `std::string`
+  (https://github.com/fmtlib/fmt/issues/4052).
+
+- Made `fmt::context` iterator compatible with STL algorithms that rely on
+  iterator category (https://github.com/fmtlib/fmt/issues/4079).
+
+# 11.0.1 - 2024-07-05
+
+- Fixed version number in the inline namespace
+  (https://github.com/fmtlib/fmt/issues/4047).
+
+- Fixed disabling Unicode support via CMake
+  (https://github.com/fmtlib/fmt/issues/4051).
+
+- Fixed deprecated `visit_format_arg` (https://github.com/fmtlib/fmt/pull/4043).
+  Thanks @nebkat.
+
+- Fixed handling of a sign and improved the `std::complex` formater
+  (https://github.com/fmtlib/fmt/pull/4034,
+  https://github.com/fmtlib/fmt/pull/4050). Thanks @tesch1 and @phprus.
+
+- Fixed ADL issues in `fmt::printf` when using C++20
+  (https://github.com/fmtlib/fmt/pull/4042). Thanks @toge.
+
+- Removed a redundant check in the formatter for `std::expected`
+  (https://github.com/fmtlib/fmt/pull/4040). Thanks @phprus.
+
+# 11.0.0 - 2024-07-01
+
+- Added `fmt/base.h` which provides a subset of the API with minimal include
+  dependencies and enough functionality to replace all uses of the `printf`
+  family of functions. This brings the compile time of code using {fmt} much
+  closer to the equivalent `printf` code as shown on the following benchmark
+  that compiles 100 source files:
+
+  | Method       | Compile Time (s) |
+  |--------------|------------------|
+  | printf       | 1.6              |
+  | IOStreams    | 25.9             |
+  | fmt 10.x     | 19.0             |
+  | fmt 11.0     | 4.8              |
+  | tinyformat   | 29.1             |
+  | Boost Format | 55.0             |
+
+  This gives almost 4x improvement in build speed compared to version 10.
+  Note that the benchmark is purely formatting code and includes. In real
+  projects the difference from `printf` will be smaller partly because common
+  standard headers will be included in almost any translation unit (TU) anyway.
+  In particular, in every case except `printf` above ~1s is spent in total on
+  including `<type_traits>` in all TUs.
+
+- Optimized includes in other headers such as `fmt/format.h` which is now
+  roughly equivalent to the old `fmt/core.h` in terms of build speed.
+
+- Migrated the documentation at https://fmt.dev/ from Sphinx to MkDocs.
+
+- Improved C++20 module support
+  (https://github.com/fmtlib/fmt/issues/3990,
+  https://github.com/fmtlib/fmt/pull/3991,
+  https://github.com/fmtlib/fmt/issues/3993,
+  https://github.com/fmtlib/fmt/pull/3994,
+  https://github.com/fmtlib/fmt/pull/3997,
+  https://github.com/fmtlib/fmt/pull/3998,
+  https://github.com/fmtlib/fmt/pull/4004,
+  https://github.com/fmtlib/fmt/pull/4005,
+  https://github.com/fmtlib/fmt/pull/4006,
+  https://github.com/fmtlib/fmt/pull/4013,
+  https://github.com/fmtlib/fmt/pull/4027,
+  https://github.com/fmtlib/fmt/pull/4029). In particular, native CMake support
+  for modules is now used if available. Thanks @yujincheng08 and @matt77hias.
+
+- Added an option to replace standard includes with `import std` enabled via
+  the `FMT_IMPORT_STD` macro (https://github.com/fmtlib/fmt/issues/3921,
+  https://github.com/fmtlib/fmt/pull/3928). Thanks @matt77hias.
+
+- Exported `fmt::range_format`, `fmt::range_format_kind` and
+  `fmt::compiled_string` from the `fmt` module
+  (https://github.com/fmtlib/fmt/pull/3970,
+  https://github.com/fmtlib/fmt/pull/3999).
+  Thanks @matt77hias and @yujincheng08.
+
+- Improved integration with stdio in `fmt::print`, enabling direct writes
+  into a C stream buffer in common cases. This may give significant
+  performance improvements ranging from tens of percent to [2x](
+  https://stackoverflow.com/a/78457454/471164) and eliminates dynamic memory
+  allocations on the buffer level. It is currently enabled for built-in and
+  string types with wider availability coming up in future releases.
+
+  For example, it gives ~24% improvement on a [simple benchmark](
+  https://isocpp.org/files/papers/P3107R5.html#perf) compiled with Apple clang
+  version 15.0.0 (clang-1500.1.0.2.5) and run on macOS 14.2.1:
+
+  ```
+  -------------------------------------------------------
+  Benchmark             Time             CPU   Iterations
+  -------------------------------------------------------
+  printf             81.8 ns         81.5 ns      8496899
+  fmt::print (10.x)  63.8 ns         61.9 ns     11524151
+  fmt::print (11.0)  51.3 ns         51.0 ns     13846580
+  ```
+
+- Improved safety of `fmt::format_to` when writing to an array
+  (https://github.com/fmtlib/fmt/pull/3805).
+  For example ([godbolt](https://www.godbolt.org/z/cYrn8dWY8)):
+
+  ```c++
+  auto volkswagen = char[4];
+  auto result = fmt::format_to(volkswagen, "elephant");
+  ```
+
+  no longer results in a buffer overflow. Instead the output will be truncated
+  and you can get the end iterator and whether truncation occurred from the
+  `result` object. Thanks @ThePhD.
+
+- Enabled Unicode support by default in MSVC, bringing it on par with other
+  compilers and making it unnecessary for users to enable it explicitly.
+  Most of {fmt} is encoding-agnostic but this prevents mojibake in places
+  where encoding matters such as path formatting and terminal output.
+  You can control the Unicode support via the CMake `FMT_UNICODE` option.
+  Note that some {fmt} packages such as the one in vcpkg have already been
+  compiled with Unicode enabled.
+
+- Added a formatter for `std::expected`
+  (https://github.com/fmtlib/fmt/pull/3834). Thanks @dominicpoeschko.
+
+- Added a formatter for `std::complex`
+  (https://github.com/fmtlib/fmt/issues/1467,
+  https://github.com/fmtlib/fmt/issues/3886,
+  https://github.com/fmtlib/fmt/pull/3892,
+  https://github.com/fmtlib/fmt/pull/3900). Thanks @phprus.
+
+- Added a formatter for `std::type_info`
+  (https://github.com/fmtlib/fmt/pull/3978). Thanks @matt77hias.
+
+- Specialized `formatter` for `std::basic_string` types with custom traits
+  and allocators (https://github.com/fmtlib/fmt/issues/3938,
+  https://github.com/fmtlib/fmt/pull/3943). Thanks @dieram3.
+
+- Added formatters for `std::chrono::day`, `std::chrono::month`,
+  `std::chrono::year` and `std::chrono::year_month_day`
+  (https://github.com/fmtlib/fmt/issues/3758,
+  https://github.com/fmtlib/fmt/issues/3772,
+  https://github.com/fmtlib/fmt/pull/3906,
+  https://github.com/fmtlib/fmt/pull/3913). For example:
+
+  ```c++
+  #include <fmt/chrono.h>
+  #include <fmt/color.h>
+
+  int main() {
+    fmt::print(fg(fmt::color::green), "{}\n", std::chrono::day(7));
+  }
+  ```
+
+  prints a green day:
+
+  <img width="306" alt="image" src="https://github.com/fmtlib/fmt/assets/576385/6e395f8b-451a-4cf7-bccc-ee92ca0dec65">
+
+  Thanks @zivshek.
+
+- Fixed handling of precision in `%S` (https://github.com/fmtlib/fmt/issues/3794,
+  https://github.com/fmtlib/fmt/pull/3814). Thanks @js324.
 
-    int main() {
-      fmt::print("{}\n", std::bitset<6>(42)); // prints "101010"
-    }
-    ```
+- Added support for the `-` specifier (glibc `strftime` extension) to day of
+  the month (`%d`) and week of the year (`%W`, `%U`, `%V`) specifiers
+  (https://github.com/fmtlib/fmt/pull/3976). Thanks @ZaheenJ.
 
-    Thanks @muggenhor.
+- Fixed the scope of the `-` extension in chrono formatting so that it doesn't
+  apply to subsequent specifiers (https://github.com/fmtlib/fmt/issues/3811,
+  https://github.com/fmtlib/fmt/pull/3812). Thanks @phprus.
 
--   Added an experimental `nested_formatter` that provides an easy way of
-    applying a formatter to one or more subobjects while automatically handling
-    width, fill and alignment. For example:
+- Improved handling of `time_point::min()`
+  (https://github.com/fmtlib/fmt/issues/3282).
 
-    ```c++
-    #include <fmt/format.h>
+- Added support for character range formatting
+  (https://github.com/fmtlib/fmt/issues/3857,
+  https://github.com/fmtlib/fmt/pull/3863). Thanks @js324.
+
+- Added `string` and `debug_string` range formatters
+  (https://github.com/fmtlib/fmt/pull/3973,
+  https://github.com/fmtlib/fmt/pull/4024). Thanks @matt77hias.
+
+- Enabled ADL for `begin` and `end` in `fmt::join`
+  (https://github.com/fmtlib/fmt/issues/3813,
+  https://github.com/fmtlib/fmt/pull/3824). Thanks @bbolli.
+
+- Made contiguous iterator optimizations apply to `std::basic_string` iterators
+  (https://github.com/fmtlib/fmt/pull/3798). Thanks @phprus.
+
+- Added support for ranges with mutable `begin` and `end`
+  (https://github.com/fmtlib/fmt/issues/3752,
+  https://github.com/fmtlib/fmt/pull/3800,
+  https://github.com/fmtlib/fmt/pull/3955). Thanks @tcbrindle and @Arghnews.
+
+- Added support for move-only iterators to `fmt::join`
+  (https://github.com/fmtlib/fmt/issues/3802,
+  https://github.com/fmtlib/fmt/pull/3946). Thanks @Arghnews.
+
+- Moved range and iterator overloads of `fmt::join` to `fmt/ranges.h`, next
+  to other overloads.
+
+- Fixed handling of types with `begin` returning `void` such as Eigen matrices
+  (https://github.com/fmtlib/fmt/issues/3839,
+  https://github.com/fmtlib/fmt/pull/3964). Thanks @Arghnews.
+
+- Added an `fmt::formattable` concept (https://github.com/fmtlib/fmt/pull/3974).
+  Thanks @matt77hias.
+
+- Added support for `__float128` (https://github.com/fmtlib/fmt/issues/3494).
+
+- Fixed rounding issues when formatting `long double` with fixed precision
+  (https://github.com/fmtlib/fmt/issues/3539).
+
+- Made `fmt::isnan` not trigger floating-point exception for NaN values
+  (https://github.com/fmtlib/fmt/issues/3948,
+  https://github.com/fmtlib/fmt/pull/3951). Thanks @alexdewar.
+
+- Removed dependency on `<memory>` for `std::allocator_traits` when possible
+  (https://github.com/fmtlib/fmt/pull/3804). Thanks @phprus.
+
+- Enabled compile-time checks in formatting functions that take text colors and
+  styles.
+
+- Deprecated wide stream overloads of `fmt::print` that take text styles.
+
+- Made format string compilation work with clang 12 and later despite
+  only partial non-type template parameter support
+  (https://github.com/fmtlib/fmt/issues/4000,
+  https://github.com/fmtlib/fmt/pull/4001). Thanks @yujincheng08.
+
+- Made `fmt::iterator_buffer`'s move constructor `noexcept`
+  (https://github.com/fmtlib/fmt/pull/3808). Thanks @waywardmonkeys.
+
+- Started enforcing that `formatter::format` is const for compatibility
+  with `std::format` (https://github.com/fmtlib/fmt/issues/3447).
+
+- Added `fmt::basic_format_arg::visit` and deprecated `fmt::visit_format_arg`.
+
+- Made `fmt::basic_string_view` not constructible from `nullptr` for
+  consistency with `std::string_view` in C++23
+  (https://github.com/fmtlib/fmt/pull/3846). Thanks @dalle.
+
+- Fixed `fmt::group_digits` for negative integers
+  (https://github.com/fmtlib/fmt/issues/3891,
+  https://github.com/fmtlib/fmt/pull/3901). Thanks @phprus.
+
+- Fixed handling of negative ids in `fmt::basic_format_args::get`
+  (https://github.com/fmtlib/fmt/pull/3945). Thanks @marlenecota.
+
+- Improved named argument validation
+  (https://github.com/fmtlib/fmt/issues/3817).
+
+- Disabled copy construction/assignment for `fmt::format_arg_store` and
+  fixed moved construction (https://github.com/fmtlib/fmt/pull/3833).
+  Thanks @ivafanas.
+
+- Worked around a locale issue in RHEL/devtoolset
+  (https://github.com/fmtlib/fmt/issues/3858,
+  https://github.com/fmtlib/fmt/pull/3859). Thanks @g199209.
+
+- Added RTTI detection for MSVC (https://github.com/fmtlib/fmt/pull/3821,
+  https://github.com/fmtlib/fmt/pull/3963). Thanks @edo9300.
+
+- Migrated the documentation from Sphinx to MkDocs.
+
+- Improved documentation and README
+  (https://github.com/fmtlib/fmt/issues/3775,
+  https://github.com/fmtlib/fmt/pull/3784,
+  https://github.com/fmtlib/fmt/issues/3788,
+  https://github.com/fmtlib/fmt/pull/3789,
+  https://github.com/fmtlib/fmt/pull/3793,
+  https://github.com/fmtlib/fmt/issues/3818,
+  https://github.com/fmtlib/fmt/pull/3820,
+  https://github.com/fmtlib/fmt/pull/3822,
+  https://github.com/fmtlib/fmt/pull/3843,
+  https://github.com/fmtlib/fmt/pull/3890,
+  https://github.com/fmtlib/fmt/issues/3894,
+  https://github.com/fmtlib/fmt/pull/3895,
+  https://github.com/fmtlib/fmt/pull/3905,
+  https://github.com/fmtlib/fmt/issues/3942,
+  https://github.com/fmtlib/fmt/pull/4008).
+  Thanks @zencatalyst, WolleTD, @tupaschoal, @Dobiasd, @frank-weinberg, @bbolli,
+  @phprus, @waywardmonkeys, @js324 and @tchaikov.
+
+- Improved CI and tests
+  (https://github.com/fmtlib/fmt/issues/3878,
+  https://github.com/fmtlib/fmt/pull/3883,
+  https://github.com/fmtlib/fmt/issues/3897,
+  https://github.com/fmtlib/fmt/pull/3979,
+  https://github.com/fmtlib/fmt/pull/3980,
+  https://github.com/fmtlib/fmt/pull/3988,
+  https://github.com/fmtlib/fmt/pull/4010,
+  https://github.com/fmtlib/fmt/pull/4012,
+  https://github.com/fmtlib/fmt/pull/4038).
+  Thanks @vgorrX, @waywardmonkeys, @tchaikov and @phprus.
+
+- Fixed buffer overflow when using format string compilation with debug format
+  and `std::back_insert_iterator` (https://github.com/fmtlib/fmt/issues/3795,
+  https://github.com/fmtlib/fmt/pull/3797). Thanks @phprus.
+
+- Improved Bazel support
+  (https://github.com/fmtlib/fmt/pull/3792,
+  https://github.com/fmtlib/fmt/pull/3801,
+  https://github.com/fmtlib/fmt/pull/3962,
+  https://github.com/fmtlib/fmt/pull/3965). Thanks @Vertexwahn.
+
+- Improved/fixed the CMake config
+  (https://github.com/fmtlib/fmt/issues/3777,
+  https://github.com/fmtlib/fmt/pull/3783,
+  https://github.com/fmtlib/fmt/issues/3847,
+  https://github.com/fmtlib/fmt/pull/3907). Thanks @phprus and @xTachyon.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/issues/3685,
+  https://github.com/fmtlib/fmt/issues/3769,
+  https://github.com/fmtlib/fmt/issues/3796,
+  https://github.com/fmtlib/fmt/issues/3803,
+  https://github.com/fmtlib/fmt/pull/3806,
+  https://github.com/fmtlib/fmt/pull/3807,
+  https://github.com/fmtlib/fmt/issues/3809,
+  https://github.com/fmtlib/fmt/pull/3810,
+  https://github.com/fmtlib/fmt/issues/3830,
+  https://github.com/fmtlib/fmt/pull/3832,
+  https://github.com/fmtlib/fmt/issues/3835,
+  https://github.com/fmtlib/fmt/pull/3844,
+  https://github.com/fmtlib/fmt/issues/3854,
+  https://github.com/fmtlib/fmt/pull/3856,
+  https://github.com/fmtlib/fmt/pull/3865,
+  https://github.com/fmtlib/fmt/pull/3866,
+  https://github.com/fmtlib/fmt/pull/3880,
+  https://github.com/fmtlib/fmt/issues/3881,
+  https://github.com/fmtlib/fmt/issues/3884,
+  https://github.com/fmtlib/fmt/issues/3898,
+  https://github.com/fmtlib/fmt/pull/3899,
+  https://github.com/fmtlib/fmt/pull/3909,
+  https://github.com/fmtlib/fmt/pull/3917,
+  https://github.com/fmtlib/fmt/pull/3923,
+  https://github.com/fmtlib/fmt/pull/3924,
+  https://github.com/fmtlib/fmt/issues/3925,
+  https://github.com/fmtlib/fmt/pull/3930,
+  https://github.com/fmtlib/fmt/pull/3931,
+  https://github.com/fmtlib/fmt/pull/3933,
+  https://github.com/fmtlib/fmt/issues/3935,
+  https://github.com/fmtlib/fmt/pull/3937,
+  https://github.com/fmtlib/fmt/pull/3967,
+  https://github.com/fmtlib/fmt/pull/3968,
+  https://github.com/fmtlib/fmt/pull/3972,
+  https://github.com/fmtlib/fmt/pull/3983,
+  https://github.com/fmtlib/fmt/issues/3992,
+  https://github.com/fmtlib/fmt/pull/3995,
+  https://github.com/fmtlib/fmt/pull/4009,
+  https://github.com/fmtlib/fmt/pull/4023).
+  Thanks @hmbj, @phprus, @res2k, @Baardi, @matt77hias, @waywardmonkeys, @hmbj,
+  @yakra, @prlw1, @Arghnews, @mtillmann0, @ShifftC, @eepp, @jimmy-park and
+  @ChristianGebhardt.
+
+# 10.2.1 - 2024-01-04
+
+- Fixed ABI compatibility with earlier 10.x versions
+  (https://github.com/fmtlib/fmt/issues/3785,
+  https://github.com/fmtlib/fmt/pull/3786). Thanks @saraedum.
 
-    struct point {
-      double x, y;
-    };
+# 10.2.0 - 2024-01-01
 
-    template <>
-    struct fmt::formatter<point> : nested_formatter<double> {
-      auto format(point p, format_context& ctx) const {
-        return write_padded(ctx, [=](auto out) {
-          return format_to(out, "({}, {})", nested(p.x), nested(p.y));
-        });
-      }
-    };
+- Added support for the `%j` specifier (the number of days) for
+  `std::chrono::duration` (https://github.com/fmtlib/fmt/issues/3643,
+  https://github.com/fmtlib/fmt/pull/3732). Thanks @intelfx.
 
-    int main() {
-      fmt::print("[{:>20.2f}]", point{1, 2});
-    }
-    ```
+- Added support for the chrono suffix for days and changed
+  the suffix for minutes from "m" to the correct "min"
+  (https://github.com/fmtlib/fmt/issues/3662,
+  https://github.com/fmtlib/fmt/pull/3664).
+  For example ([godbolt](https://godbolt.org/z/9KhMnq9ba)):
 
-    prints
+  ```c++
+  #include <fmt/chrono.h>
 
-    ```
-    [          (1.00, 2.00)]
-    ```
+  int main() {
+    fmt::print("{}\n", std::chrono::days(42)); // prints "42d"
+  }
+  ```
 
--   Added the generic representation (`g`) to `std::filesystem::path`
-    (https://github.com/fmtlib/fmt/issues/3715,
-    https://github.com/fmtlib/fmt/pull/3729). For example:
+  Thanks @Richardk2n.
 
-    ```c++
-    #include <filesystem>
-    #include <fmt/std.h>
+- Fixed an overflow in `std::chrono::time_point` formatting with large dates
+  (https://github.com/fmtlib/fmt/issues/3725,
+  https://github.com/fmtlib/fmt/pull/3727). Thanks @cschreib.
 
-    int main() {
-      fmt::print("{:g}\n", std::filesystem::path("C:\\foo"));
-    }
-    ```
-
-    prints `"C:/foo"` on Windows.
-
-    Thanks @js324.
-
--   Made `format_as` work with references
-    (https://github.com/fmtlib/fmt/pull/3739). Thanks @tchaikov.
-
--   Fixed formatting of invalid UTF-8 with precision
-    (https://github.com/fmtlib/fmt/issues/3284).
-
--   Fixed an inconsistency between `fmt::to_string` and `fmt::format`
-    (https://github.com/fmtlib/fmt/issues/3684).
-
--   Disallowed unsafe uses of `fmt::styled`
-    (https://github.com/fmtlib/fmt/issues/3625):
-
-    ```c++
-    auto s = fmt::styled(std::string("dangle"), fmt::emphasis::bold);
-    fmt::print("{}\n", s); // compile error
-    ```
-
-    Pass `fmt::styled(...)` as a parameter instead.
-
--   Added a null check when formatting a C string with the `s` specifier
-    (https://github.com/fmtlib/fmt/issues/3706).
-
--   Disallowed the `c` specifier for `bool`
-    (https://github.com/fmtlib/fmt/issues/3726,
-    https://github.com/fmtlib/fmt/pull/3734). Thanks @js324.
-
--   Made the default formatting unlocalized in `fmt::ostream_formatter` for
-    consistency with the rest of the library
-    (https://github.com/fmtlib/fmt/issues/3460).
-
--   Fixed localized formatting in bases other than decimal
-    (https://github.com/fmtlib/fmt/issues/3693,
-    https://github.com/fmtlib/fmt/pull/3750). Thanks @js324.
-
--   Fixed a performance regression in experimental `fmt::ostream::print`
-    (https://github.com/fmtlib/fmt/issues/3674).
-
--   Added synchronization with the underlying output stream when writing to
-    the Windows console
-    (https://github.com/fmtlib/fmt/pull/3668,
-    https://github.com/fmtlib/fmt/issues/3688,
-    https://github.com/fmtlib/fmt/pull/3689).
-    Thanks @Roman-Koshelev and @dimztimz.
-
--   Changed to only export `format_error` when {fmt} is built as a shared
-    library (https://github.com/fmtlib/fmt/issues/3626,
-    https://github.com/fmtlib/fmt/pull/3627). Thanks @phprus.
-
--   Made `fmt::streamed` `constexpr`.
-    (https://github.com/fmtlib/fmt/pull/3650). Thanks @muggenhor.
-
--   Enabled `consteval` on older versions of MSVC
-    (https://github.com/fmtlib/fmt/pull/3757). Thanks @phprus.
-
--   Added an option to build without `wchar_t` support on Windows
-    (https://github.com/fmtlib/fmt/issues/3631,
-    https://github.com/fmtlib/fmt/pull/3636). Thanks @glebm.
-
--   Improved build and CI configuration
-    (https://github.com/fmtlib/fmt/pull/3679,
-    https://github.com/fmtlib/fmt/issues/3701,
-    https://github.com/fmtlib/fmt/pull/3702,
-    https://github.com/fmtlib/fmt/pull/3749).
-    Thanks @jcar87, @pklima and @tchaikov.
-
--   Fixed various warnings, compilation and test issues
-    (https://github.com/fmtlib/fmt/issues/3607,
-    https://github.com/fmtlib/fmt/pull/3610,
-    https://github.com/fmtlib/fmt/pull/3624,
-    https://github.com/fmtlib/fmt/pull/3630,
-    https://github.com/fmtlib/fmt/pull/3634,
-    https://github.com/fmtlib/fmt/pull/3638,
-    https://github.com/fmtlib/fmt/issues/3645,
-    https://github.com/fmtlib/fmt/issues/3646,
-    https://github.com/fmtlib/fmt/pull/3647,
-    https://github.com/fmtlib/fmt/pull/3652,
-    https://github.com/fmtlib/fmt/issues/3654,
-    https://github.com/fmtlib/fmt/pull/3663,
-    https://github.com/fmtlib/fmt/issues/3670,
-    https://github.com/fmtlib/fmt/pull/3680,
-    https://github.com/fmtlib/fmt/issues/3694,
-    https://github.com/fmtlib/fmt/pull/3695,
-    https://github.com/fmtlib/fmt/pull/3699,
-    https://github.com/fmtlib/fmt/issues/3705,
-    https://github.com/fmtlib/fmt/issues/3710,
-    https://github.com/fmtlib/fmt/issues/3712,
-    https://github.com/fmtlib/fmt/pull/3713,
-    https://github.com/fmtlib/fmt/issues/3714,
-    https://github.com/fmtlib/fmt/pull/3716,
-    https://github.com/fmtlib/fmt/pull/3723,
-    https://github.com/fmtlib/fmt/issues/3738,
-    https://github.com/fmtlib/fmt/issues/3740,
-    https://github.com/fmtlib/fmt/pull/3741,
-    https://github.com/fmtlib/fmt/pull/3743,
-    https://github.com/fmtlib/fmt/issues/3745,
-    https://github.com/fmtlib/fmt/pull/3747,
-    https://github.com/fmtlib/fmt/pull/3748,
-    https://github.com/fmtlib/fmt/pull/3751,
-    https://github.com/fmtlib/fmt/pull/3754,
-    https://github.com/fmtlib/fmt/pull/3755,
-    https://github.com/fmtlib/fmt/issues/3760,
-    https://github.com/fmtlib/fmt/pull/3762,
-    https://github.com/fmtlib/fmt/issues/3763,
-    https://github.com/fmtlib/fmt/pull/3764,
-    https://github.com/fmtlib/fmt/issues/3774,
-    https://github.com/fmtlib/fmt/pull/3779).
-    Thanks @danakj, @vinayyadav3016, @cyyever, @phprus, @qimiko, @saschasc,
-    @gsjaardema, @lazka, @Zhaojun-Liu, @carlsmedstad, @hotwatermorning,
-    @cptFracassa, @kuguma, @PeterJohnson, @H1X4Dev, @asantoni, @eltociear,
-    @msimberg, @tchaikov, @waywardmonkeys.
-
--   Improved documentation and README
-    (https://github.com/fmtlib/fmt/issues/2086,
-    https://github.com/fmtlib/fmt/issues/3637,
-    https://github.com/fmtlib/fmt/pull/3642,
-    https://github.com/fmtlib/fmt/pull/3653,
-    https://github.com/fmtlib/fmt/pull/3655,
-    https://github.com/fmtlib/fmt/pull/3661,
-    https://github.com/fmtlib/fmt/issues/3673,
-    https://github.com/fmtlib/fmt/pull/3677,
-    https://github.com/fmtlib/fmt/pull/3737,
-    https://github.com/fmtlib/fmt/issues/3742,
-    https://github.com/fmtlib/fmt/pull/3744).
-    Thanks @idzm, @perlun, @joycebrum, @fennewald, @reinhardt1053, @GeorgeLS.
-
--   Updated CI dependencies
-    (https://github.com/fmtlib/fmt/pull/3615,
-    https://github.com/fmtlib/fmt/pull/3622,
-    https://github.com/fmtlib/fmt/pull/3623,
-    https://github.com/fmtlib/fmt/pull/3666,
-    https://github.com/fmtlib/fmt/pull/3696,
-    https://github.com/fmtlib/fmt/pull/3697,
-    https://github.com/fmtlib/fmt/pull/3759,
-    https://github.com/fmtlib/fmt/pull/3782).
+- Added a formatter for `std::source_location`
+  (https://github.com/fmtlib/fmt/pull/3730).
+  For example ([godbolt](https://godbolt.org/z/YajfKjhhr)):
 
-# 10.1.1 - 2023-08-28
+  ```c++
+  #include <source_location>
+  #include <fmt/std.h>
 
--   Added formatters for `std::atomic` and `atomic_flag`
-    (https://github.com/fmtlib/fmt/pull/3574,
-    https://github.com/fmtlib/fmt/pull/3594).
-    Thanks @wangzw and @AlexGuteniev.
--   Fixed an error about partial specialization of `formatter<string>`
-    after instantiation when compiled with gcc and C++20
-    (https://github.com/fmtlib/fmt/issues/3584).
--   Fixed compilation as a C++20 module with gcc and clang
-    (https://github.com/fmtlib/fmt/issues/3587,
-    https://github.com/fmtlib/fmt/pull/3597,
-    https://github.com/fmtlib/fmt/pull/3605).
-    Thanks @MathewBensonCode.
--   Made `fmt::to_string` work with types that have `format_as`
-    overloads (https://github.com/fmtlib/fmt/pull/3575). Thanks @phprus.
--   Made `formatted_size` work with integral format specifiers at
-    compile time (https://github.com/fmtlib/fmt/pull/3591).
-    Thanks @elbeno.
--   Fixed a warning about the `no_unique_address` attribute on clang-cl
-    (https://github.com/fmtlib/fmt/pull/3599). Thanks @lukester1975.
--   Improved compatibility with the legacy GBK encoding
-    (https://github.com/fmtlib/fmt/issues/3598,
-    https://github.com/fmtlib/fmt/pull/3599). Thanks @YuHuanTin.
--   Added OpenSSF Scorecard analysis
-    (https://github.com/fmtlib/fmt/issues/3530,
-    https://github.com/fmtlib/fmt/pull/3571). Thanks @joycebrum.
--   Updated CI dependencies
-    (https://github.com/fmtlib/fmt/pull/3591,
-    https://github.com/fmtlib/fmt/pull/3592,
-    https://github.com/fmtlib/fmt/pull/3593,
-    https://github.com/fmtlib/fmt/pull/3602).
+  int main() {
+    fmt::print("{}\n", std::source_location::current());
+  }
+  ```
 
-# 10.1.0 - 2023-08-12
+  prints
 
--   Optimized format string compilation resulting in up to 40% speed up
-    in compiled `format_to` and \~4x speed up in compiled `format_to_n`
-    on a concatenation benchmark
-    (https://github.com/fmtlib/fmt/issues/3133,
-    https://github.com/fmtlib/fmt/issues/3484).
+  ```
+  /app/example.cpp:5:51: int main()
+  ```
 
-    {fmt} 10.0:
+  Thanks @felix642.
 
-        ---------------------------------------------------------
-        Benchmark               Time             CPU   Iterations
-        ---------------------------------------------------------
-        BM_format_to         78.9 ns         78.9 ns      8881746
-        BM_format_to_n        568 ns          568 ns      1232089
+- Added a formatter for `std::bitset`
+  (https://github.com/fmtlib/fmt/pull/3660).
+  For example ([godbolt](https://godbolt.org/z/bdEaGeYxe)):
 
-    {fmt} 10.1:
+  ```c++
+  #include <bitset>
+  #include <fmt/std.h>
 
-        ---------------------------------------------------------
-        Benchmark               Time             CPU   Iterations
-        ---------------------------------------------------------
-        BM_format_to         54.9 ns         54.9 ns     12727944
-        BM_format_to_n        133 ns          133 ns      5257795
+  int main() {
+    fmt::print("{}\n", std::bitset<6>(42)); // prints "101010"
+  }
+  ```
 
--   Optimized storage of an empty allocator in `basic_memory_buffer`
-    (https://github.com/fmtlib/fmt/pull/3485). Thanks @Minty-Meeo.
+  Thanks @muggenhor.
 
--   Added formatters for proxy references to elements of
-    `std::vector<bool>` and `std::bitset<N>`
-    (https://github.com/fmtlib/fmt/issues/3567,
-    https://github.com/fmtlib/fmt/pull/3570). For example
-    ([godbolt](https://godbolt.org/z/zYb79Pvn8)):
+- Added an experimental `nested_formatter` that provides an easy way of
+  applying a formatter to one or more subobjects while automatically handling
+  width, fill and alignment. For example:
 
-    ```c++
-    #include <vector>
-    #include <fmt/std.h>
+  ```c++
+  #include <fmt/format.h>
 
-    int main() {
-      auto v = std::vector<bool>{true};
-      fmt::print("{}", v[0]);
-    }
-    ```
-
-    Thanks @phprus and @felix642.
-
--   Fixed an ambiguous formatter specialization for containers that look
-    like container adaptors such as `boost::flat_set`
-    (https://github.com/fmtlib/fmt/issues/3556,
-    https://github.com/fmtlib/fmt/pull/3561). Thanks @5chmidti.
-
--   Fixed compilation when formatting durations not convertible from
-    `std::chrono::seconds`
-    (https://github.com/fmtlib/fmt/pull/3430). Thanks @patlkli.
-
--   Made the `formatter` specialization for `char*` const-correct
-    (https://github.com/fmtlib/fmt/pull/3432). Thanks @timsong-cpp.
-
--   Made `{}` and `{:}` handled consistently during compile-time checks
-    (https://github.com/fmtlib/fmt/issues/3526).
-
--   Disallowed passing temporaries to `make_format_args` to improve API
-    safety by preventing dangling references.
-
--   Improved the compile-time error for unformattable types
-    (https://github.com/fmtlib/fmt/pull/3478). Thanks @BRevzin.
-
--   Improved the floating-point formatter
-    (https://github.com/fmtlib/fmt/pull/3448,
-    https://github.com/fmtlib/fmt/pull/3450).
-    Thanks @florimond-collette.
-
--   Fixed handling of precision for `long double` larger than 64 bits.
-    (https://github.com/fmtlib/fmt/issues/3539,
-    https://github.com/fmtlib/fmt/issues/3564).
-
--   Made floating-point and chrono tests less platform-dependent
-    (https://github.com/fmtlib/fmt/issues/3337,
-    https://github.com/fmtlib/fmt/issues/3433,
-    https://github.com/fmtlib/fmt/pull/3434). Thanks @phprus.
-
--   Removed the remnants of the Grisu floating-point formatter that has
-    been replaced by Dragonbox in earlier versions.
-
--   Added `throw_format_error` to the public API
-    (https://github.com/fmtlib/fmt/pull/3551). Thanks @mjerabek.
-
--   Made `FMT_THROW` assert even if assertions are disabled when
-    compiling with exceptions disabled
-    (https://github.com/fmtlib/fmt/issues/3418,
-    https://github.com/fmtlib/fmt/pull/3439). Thanks @BRevzin.
-
--   Made `format_as` and `std::filesystem::path` formatter work with
-    exotic code unit types.
-    (https://github.com/fmtlib/fmt/pull/3457,
-    https://github.com/fmtlib/fmt/pull/3476). Thanks @gix and @hmbj.
-
--   Added support for the `?` format specifier to
-    `std::filesystem::path` and made the default unescaped for
-    consistency with strings.
-
--   Deprecated the wide stream overload of `printf`.
-
--   Removed unused `basic_printf_parse_context`.
-
--   Improved RTTI detection used when formatting exceptions
-    (https://github.com/fmtlib/fmt/pull/3468). Thanks @danakj.
-
--   Improved compatibility with VxWorks7
-    (https://github.com/fmtlib/fmt/pull/3467). Thanks @wenshan1.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/3174,
-    https://github.com/fmtlib/fmt/issues/3423,
-    https://github.com/fmtlib/fmt/pull/3454,
-    https://github.com/fmtlib/fmt/issues/3458,
-    https://github.com/fmtlib/fmt/pull/3461,
-    https://github.com/fmtlib/fmt/issues/3487,
-    https://github.com/fmtlib/fmt/pull/3515).
-    Thanks @zencatalyst, @rlalik and @mikecrowe.
-
--   Improved build and CI configurations
-    (https://github.com/fmtlib/fmt/issues/3449,
-    https://github.com/fmtlib/fmt/pull/3451,
-    https://github.com/fmtlib/fmt/pull/3452,
-    https://github.com/fmtlib/fmt/pull/3453,
-    https://github.com/fmtlib/fmt/pull/3459,
-    https://github.com/fmtlib/fmt/issues/3481,
-    https://github.com/fmtlib/fmt/pull/3486,
-    https://github.com/fmtlib/fmt/issues/3489,
-    https://github.com/fmtlib/fmt/pull/3496,
-    https://github.com/fmtlib/fmt/issues/3517,
-    https://github.com/fmtlib/fmt/pull/3523,
-    https://github.com/fmtlib/fmt/pull/3563).
-    Thanks @joycebrum, @glebm, @phprus, @petrmanek, @setoye and @abouvier.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/issues/3408,
-    https://github.com/fmtlib/fmt/issues/3424,
-    https://github.com/fmtlib/fmt/issues/3444,
-    https://github.com/fmtlib/fmt/pull/3446,
-    https://github.com/fmtlib/fmt/pull/3475,
-    https://github.com/fmtlib/fmt/pull/3482,
-    https://github.com/fmtlib/fmt/issues/3492,
-    https://github.com/fmtlib/fmt/pull/3493,
-    https://github.com/fmtlib/fmt/pull/3508,
-    https://github.com/fmtlib/fmt/issues/3509,
-    https://github.com/fmtlib/fmt/issues/3533,
-    https://github.com/fmtlib/fmt/pull/3542,
-    https://github.com/fmtlib/fmt/issues/3543,
-    https://github.com/fmtlib/fmt/issues/3540,
-    https://github.com/fmtlib/fmt/pull/3544,
-    https://github.com/fmtlib/fmt/issues/3548,
-    https://github.com/fmtlib/fmt/pull/3549,
-    https://github.com/fmtlib/fmt/pull/3550,
-    https://github.com/fmtlib/fmt/pull/3552).
-    Thanks @adesitter, @hmbj, @Minty-Meeo, @phprus, @TobiSchluter,
-    @kieranclancy, @alexeedm, @jurihock, @Ozomahtli and @razaqq.
+  struct point {
+    double x, y;
+  };
 
-# 10.0.0 - 2023-05-09
-
--   Replaced Grisu with a new floating-point formatting algorithm for
-    given precision (https://github.com/fmtlib/fmt/issues/3262,
-    https://github.com/fmtlib/fmt/issues/2750,
-    https://github.com/fmtlib/fmt/pull/3269,
-    https://github.com/fmtlib/fmt/pull/3276). The new algorithm
-    is based on Dragonbox already used for the shortest representation
-    and gives substantial performance improvement:
-
-    ![](https://user-images.githubusercontent.com/33922675/211956670-84891a09-6867-47d9-82fc-3230da7abe0f.png)
-
-    -   Red: new algorithm
-    -   Green: new algorithm with `FMT_USE_FULL_CACHE_DRAGONBOX` defined
-        to 1
-    -   Blue: old algorithm
-
-    Thanks @jk-jeon.
-
--   Replaced `snprintf`-based hex float formatter with an internal
-    implementation (https://github.com/fmtlib/fmt/pull/3179,
-    https://github.com/fmtlib/fmt/pull/3203). This removes the
-    last usage of `s(n)printf` in {fmt}. Thanks @phprus.
-
--   Fixed alignment of floating-point numbers with localization
-    (https://github.com/fmtlib/fmt/issues/3263,
-    https://github.com/fmtlib/fmt/pull/3272). Thanks @ShawnZhong.
-
--   Made handling of `#` consistent with `std::format`.
-
--   Improved C++20 module support
-    (https://github.com/fmtlib/fmt/pull/3134,
-    https://github.com/fmtlib/fmt/pull/3254,
-    https://github.com/fmtlib/fmt/pull/3386,
-    https://github.com/fmtlib/fmt/pull/3387,
-    https://github.com/fmtlib/fmt/pull/3388,
-    https://github.com/fmtlib/fmt/pull/3392,
-    https://github.com/fmtlib/fmt/pull/3397,
-    https://github.com/fmtlib/fmt/pull/3399,
-    https://github.com/fmtlib/fmt/pull/3400).
-    Thanks @laitingsheng, @Orvid and @DanielaE.
-    
--   Switched to the [modules CMake library](https://github.com/vitaut/modules)
-    which allows building {fmt} as a C++20 module with clang:
-
-        CXX=clang++ cmake -DFMT_MODULE=ON .
-        make
-
--   Made `format_as` work with any user-defined type and not just enums.
-    For example ([godbolt](https://godbolt.org/z/b7rqhq5Kh)):
-
-    ```c++
-    #include <fmt/format.h>
-
-    struct floaty_mc_floatface {
-      double value;
-    };
-
-    auto format_as(floaty_mc_floatface f) { return f.value; }
-
-    int main() {
-      fmt::print("{:8}\n", floaty_mc_floatface{0.42}); // prints "    0.42"
+  template <>
+  struct fmt::formatter<point> : nested_formatter<double> {
+    auto format(point p, format_context& ctx) const {
+      return write_padded(ctx, [=](auto out) {
+        return format_to(out, "({}, {})", nested(p.x), nested(p.y));
+      });
     }
-    ```
-
--   Removed deprecated implicit conversions for enums and conversions to
-    primitive types for compatibility with `std::format` and to prevent
-    potential ODR violations. Use `format_as` instead.
+  };
 
--   Added support for fill, align and width to the time point formatter
-    (https://github.com/fmtlib/fmt/issues/3237,
-    https://github.com/fmtlib/fmt/pull/3260,
-    https://github.com/fmtlib/fmt/pull/3275). For example
-    ([godbolt](https://godbolt.org/z/rKP6MGz6c)):
+  int main() {
+    fmt::print("[{:>20.2f}]", point{1, 2});
+  }
+  ```
 
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      // prints "    2023"
-      fmt::print("{:>8%Y}\n", std::chrono::system_clock::now());
-    }
-    ```
+  prints
 
-    Thanks @ShawnZhong.
+  ```
+  [          (1.00, 2.00)]
+  ```
 
--   Implemented formatting of subseconds
-    (https://github.com/fmtlib/fmt/issues/2207,
-    https://github.com/fmtlib/fmt/issues/3117,
-    https://github.com/fmtlib/fmt/pull/3115,
-    https://github.com/fmtlib/fmt/pull/3143,
-    https://github.com/fmtlib/fmt/pull/3144,
-    https://github.com/fmtlib/fmt/pull/3349). For example
-    ([godbolt](https://godbolt.org/z/45738oGEo)):
+- Added the generic representation (`g`) to `std::filesystem::path`
+  (https://github.com/fmtlib/fmt/issues/3715,
+  https://github.com/fmtlib/fmt/pull/3729). For example:
+
+  ```c++
+  #include <filesystem>
+  #include <fmt/std.h>
+
+  int main() {
+    fmt::print("{:g}\n", std::filesystem::path("C:\\foo"));
+  }
+  ```
+
+  prints `"C:/foo"` on Windows.
+
+  Thanks @js324.
+
+- Made `format_as` work with references
+  (https://github.com/fmtlib/fmt/pull/3739). Thanks @tchaikov.
+
+- Fixed formatting of invalid UTF-8 with precision
+  (https://github.com/fmtlib/fmt/issues/3284).
+
+- Fixed an inconsistency between `fmt::to_string` and `fmt::format`
+  (https://github.com/fmtlib/fmt/issues/3684).
+
+- Disallowed unsafe uses of `fmt::styled`
+  (https://github.com/fmtlib/fmt/issues/3625):
+
+  ```c++
+  auto s = fmt::styled(std::string("dangle"), fmt::emphasis::bold);
+  fmt::print("{}\n", s); // compile error
+  ```
+
+  Pass `fmt::styled(...)` as a parameter instead.
+
+- Added a null check when formatting a C string with the `s` specifier
+  (https://github.com/fmtlib/fmt/issues/3706).
+
+- Disallowed the `c` specifier for `bool`
+  (https://github.com/fmtlib/fmt/issues/3726,
+  https://github.com/fmtlib/fmt/pull/3734). Thanks @js324.
+
+- Made the default formatting unlocalized in `fmt::ostream_formatter` for
+  consistency with the rest of the library
+  (https://github.com/fmtlib/fmt/issues/3460).
+
+- Fixed localized formatting in bases other than decimal
+  (https://github.com/fmtlib/fmt/issues/3693,
+  https://github.com/fmtlib/fmt/pull/3750). Thanks @js324.
+
+- Fixed a performance regression in experimental `fmt::ostream::print`
+  (https://github.com/fmtlib/fmt/issues/3674).
+
+- Added synchronization with the underlying output stream when writing to
+  the Windows console
+  (https://github.com/fmtlib/fmt/pull/3668,
+  https://github.com/fmtlib/fmt/issues/3688,
+  https://github.com/fmtlib/fmt/pull/3689).
+  Thanks @Roman-Koshelev and @dimztimz.
+
+- Changed to only export `format_error` when {fmt} is built as a shared
+  library (https://github.com/fmtlib/fmt/issues/3626,
+  https://github.com/fmtlib/fmt/pull/3627). Thanks @phprus.
+
+- Made `fmt::streamed` `constexpr`.
+  (https://github.com/fmtlib/fmt/pull/3650). Thanks @muggenhor.
+
+- Made `fmt::format_int` `constexpr`
+  (https://github.com/fmtlib/fmt/issues/4031,
+  https://github.com/fmtlib/fmt/pull/4032). Thanks @dixlorenz.
+
+- Enabled `consteval` on older versions of MSVC
+  (https://github.com/fmtlib/fmt/pull/3757). Thanks @phprus.
+
+- Added an option to build without `wchar_t` support on Windows
+  (https://github.com/fmtlib/fmt/issues/3631,
+  https://github.com/fmtlib/fmt/pull/3636). Thanks @glebm.
+
+- Improved build and CI configuration
+  (https://github.com/fmtlib/fmt/pull/3679,
+  https://github.com/fmtlib/fmt/issues/3701,
+  https://github.com/fmtlib/fmt/pull/3702,
+  https://github.com/fmtlib/fmt/pull/3749).
+  Thanks @jcar87, @pklima and @tchaikov.
+
+- Fixed various warnings, compilation and test issues
+  (https://github.com/fmtlib/fmt/issues/3607,
+  https://github.com/fmtlib/fmt/pull/3610,
+  https://github.com/fmtlib/fmt/pull/3624,
+  https://github.com/fmtlib/fmt/pull/3630,
+  https://github.com/fmtlib/fmt/pull/3634,
+  https://github.com/fmtlib/fmt/pull/3638,
+  https://github.com/fmtlib/fmt/issues/3645,
+  https://github.com/fmtlib/fmt/issues/3646,
+  https://github.com/fmtlib/fmt/pull/3647,
+  https://github.com/fmtlib/fmt/pull/3652,
+  https://github.com/fmtlib/fmt/issues/3654,
+  https://github.com/fmtlib/fmt/pull/3663,
+  https://github.com/fmtlib/fmt/issues/3670,
+  https://github.com/fmtlib/fmt/pull/3680,
+  https://github.com/fmtlib/fmt/issues/3694,
+  https://github.com/fmtlib/fmt/pull/3695,
+  https://github.com/fmtlib/fmt/pull/3699,
+  https://github.com/fmtlib/fmt/issues/3705,
+  https://github.com/fmtlib/fmt/issues/3710,
+  https://github.com/fmtlib/fmt/issues/3712,
+  https://github.com/fmtlib/fmt/pull/3713,
+  https://github.com/fmtlib/fmt/issues/3714,
+  https://github.com/fmtlib/fmt/pull/3716,
+  https://github.com/fmtlib/fmt/pull/3723,
+  https://github.com/fmtlib/fmt/issues/3738,
+  https://github.com/fmtlib/fmt/issues/3740,
+  https://github.com/fmtlib/fmt/pull/3741,
+  https://github.com/fmtlib/fmt/pull/3743,
+  https://github.com/fmtlib/fmt/issues/3745,
+  https://github.com/fmtlib/fmt/pull/3747,
+  https://github.com/fmtlib/fmt/pull/3748,
+  https://github.com/fmtlib/fmt/pull/3751,
+  https://github.com/fmtlib/fmt/pull/3754,
+  https://github.com/fmtlib/fmt/pull/3755,
+  https://github.com/fmtlib/fmt/issues/3760,
+  https://github.com/fmtlib/fmt/pull/3762,
+  https://github.com/fmtlib/fmt/issues/3763,
+  https://github.com/fmtlib/fmt/pull/3764,
+  https://github.com/fmtlib/fmt/issues/3774,
+  https://github.com/fmtlib/fmt/pull/3779).
+  Thanks @danakj, @vinayyadav3016, @cyyever, @phprus, @qimiko, @saschasc,
+  @gsjaardema, @lazka, @Zhaojun-Liu, @carlsmedstad, @hotwatermorning,
+  @cptFracassa, @kuguma, @PeterJohnson, @H1X4Dev, @asantoni, @eltociear,
+  @msimberg, @tchaikov, @waywardmonkeys.
+
+- Improved documentation and README
+  (https://github.com/fmtlib/fmt/issues/2086,
+  https://github.com/fmtlib/fmt/issues/3637,
+  https://github.com/fmtlib/fmt/pull/3642,
+  https://github.com/fmtlib/fmt/pull/3653,
+  https://github.com/fmtlib/fmt/pull/3655,
+  https://github.com/fmtlib/fmt/pull/3661,
+  https://github.com/fmtlib/fmt/issues/3673,
+  https://github.com/fmtlib/fmt/pull/3677,
+  https://github.com/fmtlib/fmt/pull/3737,
+  https://github.com/fmtlib/fmt/issues/3742,
+  https://github.com/fmtlib/fmt/pull/3744).
+  Thanks @idzm, @perlun, @joycebrum, @fennewald, @reinhardt1053, @GeorgeLS.
+
+- Updated CI dependencies
+  (https://github.com/fmtlib/fmt/pull/3615,
+  https://github.com/fmtlib/fmt/pull/3622,
+  https://github.com/fmtlib/fmt/pull/3623,
+  https://github.com/fmtlib/fmt/pull/3666,
+  https://github.com/fmtlib/fmt/pull/3696,
+  https://github.com/fmtlib/fmt/pull/3697,
+  https://github.com/fmtlib/fmt/pull/3759,
+  https://github.com/fmtlib/fmt/pull/3782).
 
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      // prints 01.234567
-      fmt::print("{:%S}\n", std::chrono::microseconds(1234567));
-    }
-    ```
+# 10.1.1 - 2023-08-28
 
-    Thanks @patrickroocks @phprus and @BRevzin.
+- Added formatters for `std::atomic` and `atomic_flag`
+  (https://github.com/fmtlib/fmt/pull/3574,
+  https://github.com/fmtlib/fmt/pull/3594).
+  Thanks @wangzw and @AlexGuteniev.
+- Fixed an error about partial specialization of `formatter<string>`
+  after instantiation when compiled with gcc and C++20
+  (https://github.com/fmtlib/fmt/issues/3584).
+- Fixed compilation as a C++20 module with gcc and clang
+  (https://github.com/fmtlib/fmt/issues/3587,
+  https://github.com/fmtlib/fmt/pull/3597,
+  https://github.com/fmtlib/fmt/pull/3605).
+  Thanks @MathewBensonCode.
+- Made `fmt::to_string` work with types that have `format_as`
+  overloads (https://github.com/fmtlib/fmt/pull/3575). Thanks @phprus.
+- Made `formatted_size` work with integral format specifiers at
+  compile time (https://github.com/fmtlib/fmt/pull/3591).
+  Thanks @elbeno.
+- Fixed a warning about the `no_unique_address` attribute on clang-cl
+  (https://github.com/fmtlib/fmt/pull/3599). Thanks @lukester1975.
+- Improved compatibility with the legacy GBK encoding
+  (https://github.com/fmtlib/fmt/issues/3598,
+  https://github.com/fmtlib/fmt/pull/3599). Thanks @YuHuanTin.
+- Added OpenSSF Scorecard analysis
+  (https://github.com/fmtlib/fmt/issues/3530,
+  https://github.com/fmtlib/fmt/pull/3571). Thanks @joycebrum.
+- Updated CI dependencies
+  (https://github.com/fmtlib/fmt/pull/3591,
+  https://github.com/fmtlib/fmt/pull/3592,
+  https://github.com/fmtlib/fmt/pull/3593,
+  https://github.com/fmtlib/fmt/pull/3602).
 
--   Added precision support to `%S`
-    (https://github.com/fmtlib/fmt/pull/3148). Thanks @SappyJoy
+# 10.1.0 - 2023-08-12
 
--   Added support for `std::utc_time`
-    (https://github.com/fmtlib/fmt/issues/3098,
-    https://github.com/fmtlib/fmt/pull/3110). Thanks @patrickroocks.
+- Optimized format string compilation resulting in up to 40% speed up
+  in compiled `format_to` and \~4x speed up in compiled `format_to_n`
+  on a concatenation benchmark
+  (https://github.com/fmtlib/fmt/issues/3133,
+  https://github.com/fmtlib/fmt/issues/3484).
 
--   Switched formatting of `std::chrono::system_clock` from local time
-    to UTC for compatibility with the standard
-    (https://github.com/fmtlib/fmt/issues/3199,
-    https://github.com/fmtlib/fmt/pull/3230). Thanks @ned14.
+  {fmt} 10.0:
 
--   Added support for `%Ez` and `%Oz` to chrono formatters.
-    (https://github.com/fmtlib/fmt/issues/3220,
-    https://github.com/fmtlib/fmt/pull/3222). Thanks @phprus.
+      ---------------------------------------------------------
+      Benchmark               Time             CPU   Iterations
+      ---------------------------------------------------------
+      BM_format_to         78.9 ns         78.9 ns      8881746
+      BM_format_to_n        568 ns          568 ns      1232089
 
--   Improved validation of format specifiers for `std::chrono::duration`
-    (https://github.com/fmtlib/fmt/issues/3219,
-    https://github.com/fmtlib/fmt/pull/3232). Thanks @ShawnZhong.
+  {fmt} 10.1:
 
--   Fixed formatting of time points before the epoch
-    (https://github.com/fmtlib/fmt/issues/3117,
-    https://github.com/fmtlib/fmt/pull/3261). For example
-    ([godbolt](https://godbolt.org/z/f7bcznb3W)):
+      ---------------------------------------------------------
+      Benchmark               Time             CPU   Iterations
+      ---------------------------------------------------------
+      BM_format_to         54.9 ns         54.9 ns     12727944
+      BM_format_to_n        133 ns          133 ns      5257795
 
-    ```c++
-    #include <fmt/chrono.h>
+- Optimized storage of an empty allocator in `basic_memory_buffer`
+  (https://github.com/fmtlib/fmt/pull/3485). Thanks @Minty-Meeo.
+
+- Added formatters for proxy references to elements of
+  `std::vector<bool>` and `std::bitset<N>`
+  (https://github.com/fmtlib/fmt/issues/3567,
+  https://github.com/fmtlib/fmt/pull/3570). For example
+  ([godbolt](https://godbolt.org/z/zYb79Pvn8)):
+
+  ```c++
+  #include <vector>
+  #include <fmt/std.h>
+
+  int main() {
+    auto v = std::vector<bool>{true};
+    fmt::print("{}", v[0]);
+  }
+  ```
+
+  Thanks @phprus and @felix642.
+
+- Fixed an ambiguous formatter specialization for containers that look
+  like container adaptors such as `boost::flat_set`
+  (https://github.com/fmtlib/fmt/issues/3556,
+  https://github.com/fmtlib/fmt/pull/3561). Thanks @5chmidti.
+
+- Fixed compilation when formatting durations not convertible from
+  `std::chrono::seconds`
+  (https://github.com/fmtlib/fmt/pull/3430). Thanks @patlkli.
+
+- Made the `formatter` specialization for `char*` const-correct
+  (https://github.com/fmtlib/fmt/pull/3432). Thanks @timsong-cpp.
+
+- Made `{}` and `{:}` handled consistently during compile-time checks
+  (https://github.com/fmtlib/fmt/issues/3526).
+
+- Disallowed passing temporaries to `make_format_args` to improve API
+  safety by preventing dangling references.
+
+- Improved the compile-time error for unformattable types
+  (https://github.com/fmtlib/fmt/pull/3478). Thanks @BRevzin.
+
+- Improved the floating-point formatter
+  (https://github.com/fmtlib/fmt/pull/3448,
+  https://github.com/fmtlib/fmt/pull/3450).
+  Thanks @florimond-collette.
+
+- Fixed handling of precision for `long double` larger than 64 bits.
+  (https://github.com/fmtlib/fmt/issues/3539,
+  https://github.com/fmtlib/fmt/issues/3564).
+
+- Made floating-point and chrono tests less platform-dependent
+  (https://github.com/fmtlib/fmt/issues/3337,
+  https://github.com/fmtlib/fmt/issues/3433,
+  https://github.com/fmtlib/fmt/pull/3434). Thanks @phprus.
+
+- Removed the remnants of the Grisu floating-point formatter that has
+  been replaced by Dragonbox in earlier versions.
+
+- Added `throw_format_error` to the public API
+  (https://github.com/fmtlib/fmt/pull/3551). Thanks @mjerabek.
+
+- Made `FMT_THROW` assert even if assertions are disabled when
+  compiling with exceptions disabled
+  (https://github.com/fmtlib/fmt/issues/3418,
+  https://github.com/fmtlib/fmt/pull/3439). Thanks @BRevzin.
+
+- Made `format_as` and `std::filesystem::path` formatter work with
+  exotic code unit types.
+  (https://github.com/fmtlib/fmt/pull/3457,
+  https://github.com/fmtlib/fmt/pull/3476). Thanks @gix and @hmbj.
+
+- Added support for the `?` format specifier to
+  `std::filesystem::path` and made the default unescaped for
+  consistency with strings.
+
+- Deprecated the wide stream overload of `printf`.
+
+- Removed unused `basic_printf_parse_context`.
+
+- Improved RTTI detection used when formatting exceptions
+  (https://github.com/fmtlib/fmt/pull/3468). Thanks @danakj.
+
+- Improved compatibility with VxWorks7
+  (https://github.com/fmtlib/fmt/pull/3467). Thanks @wenshan1.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/3174,
+  https://github.com/fmtlib/fmt/issues/3423,
+  https://github.com/fmtlib/fmt/pull/3454,
+  https://github.com/fmtlib/fmt/issues/3458,
+  https://github.com/fmtlib/fmt/pull/3461,
+  https://github.com/fmtlib/fmt/issues/3487,
+  https://github.com/fmtlib/fmt/pull/3515).
+  Thanks @zencatalyst, @rlalik and @mikecrowe.
+
+- Improved build and CI configurations
+  (https://github.com/fmtlib/fmt/issues/3449,
+  https://github.com/fmtlib/fmt/pull/3451,
+  https://github.com/fmtlib/fmt/pull/3452,
+  https://github.com/fmtlib/fmt/pull/3453,
+  https://github.com/fmtlib/fmt/pull/3459,
+  https://github.com/fmtlib/fmt/issues/3481,
+  https://github.com/fmtlib/fmt/pull/3486,
+  https://github.com/fmtlib/fmt/issues/3489,
+  https://github.com/fmtlib/fmt/pull/3496,
+  https://github.com/fmtlib/fmt/issues/3517,
+  https://github.com/fmtlib/fmt/pull/3523,
+  https://github.com/fmtlib/fmt/pull/3563).
+  Thanks @joycebrum, @glebm, @phprus, @petrmanek, @setoye and @abouvier.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/issues/3408,
+  https://github.com/fmtlib/fmt/issues/3424,
+  https://github.com/fmtlib/fmt/issues/3444,
+  https://github.com/fmtlib/fmt/pull/3446,
+  https://github.com/fmtlib/fmt/pull/3475,
+  https://github.com/fmtlib/fmt/pull/3482,
+  https://github.com/fmtlib/fmt/issues/3492,
+  https://github.com/fmtlib/fmt/pull/3493,
+  https://github.com/fmtlib/fmt/pull/3508,
+  https://github.com/fmtlib/fmt/issues/3509,
+  https://github.com/fmtlib/fmt/issues/3533,
+  https://github.com/fmtlib/fmt/pull/3542,
+  https://github.com/fmtlib/fmt/issues/3543,
+  https://github.com/fmtlib/fmt/issues/3540,
+  https://github.com/fmtlib/fmt/pull/3544,
+  https://github.com/fmtlib/fmt/issues/3548,
+  https://github.com/fmtlib/fmt/pull/3549,
+  https://github.com/fmtlib/fmt/pull/3550,
+  https://github.com/fmtlib/fmt/pull/3552).
+  Thanks @adesitter, @hmbj, @Minty-Meeo, @phprus, @TobiSchluter,
+  @kieranclancy, @alexeedm, @jurihock, @Ozomahtli and @razaqq.
 
-    int main() {
-      auto t = std::chrono::system_clock::from_time_t(0) -
-               std::chrono::milliseconds(250);
-      fmt::print("{:%S}\n", t); // prints 59.750000000
-    }
-    ```
-
-    Thanks @ShawnZhong.
-
--   Experimental: implemented glibc extension for padding seconds,
-    minutes and hours
-    (https://github.com/fmtlib/fmt/issues/2959,
-    https://github.com/fmtlib/fmt/pull/3271). Thanks @ShawnZhong.
-
--   Added a formatter for `std::exception`
-    (https://github.com/fmtlib/fmt/issues/2977,
-    https://github.com/fmtlib/fmt/issues/3012,
-    https://github.com/fmtlib/fmt/pull/3062,
-    https://github.com/fmtlib/fmt/pull/3076,
-    https://github.com/fmtlib/fmt/pull/3119). For example
-    ([godbolt](https://godbolt.org/z/8xoWGs9e4)):
-
-    ```c++
-    #include <fmt/std.h>
-    #include <vector>
-
-    int main() {
-      try {
-        std::vector<bool>().at(0);
-      } catch(const std::exception& e) {
-        fmt::print("{}", e);
-      }
-    }
-    ```
+# 10.0.0 - 2023-05-09
 
-    prints:
+- Replaced Grisu with a new floating-point formatting algorithm for
+  given precision (https://github.com/fmtlib/fmt/issues/3262,
+  https://github.com/fmtlib/fmt/issues/2750,
+  https://github.com/fmtlib/fmt/pull/3269,
+  https://github.com/fmtlib/fmt/pull/3276). The new algorithm
+  is based on Dragonbox already used for the shortest representation
+  and gives substantial performance improvement:
+
+  ![](https://user-images.githubusercontent.com/33922675/211956670-84891a09-6867-47d9-82fc-3230da7abe0f.png)
+
+  -   Red: new algorithm
+  -   Green: new algorithm with `FMT_USE_FULL_CACHE_DRAGONBOX` defined
+      to 1
+  -   Blue: old algorithm
+
+  Thanks @jk-jeon.
+
+- Replaced `snprintf`-based hex float formatter with an internal
+  implementation (https://github.com/fmtlib/fmt/pull/3179,
+  https://github.com/fmtlib/fmt/pull/3203). This removes the
+  last usage of `s(n)printf` in {fmt}. Thanks @phprus.
+
+- Fixed alignment of floating-point numbers with localization
+  (https://github.com/fmtlib/fmt/issues/3263,
+  https://github.com/fmtlib/fmt/pull/3272). Thanks @ShawnZhong.
+
+- Made handling of `#` consistent with `std::format`.
+
+- Improved C++20 module support
+  (https://github.com/fmtlib/fmt/pull/3134,
+  https://github.com/fmtlib/fmt/pull/3254,
+  https://github.com/fmtlib/fmt/pull/3386,
+  https://github.com/fmtlib/fmt/pull/3387,
+  https://github.com/fmtlib/fmt/pull/3388,
+  https://github.com/fmtlib/fmt/pull/3392,
+  https://github.com/fmtlib/fmt/pull/3397,
+  https://github.com/fmtlib/fmt/pull/3399,
+  https://github.com/fmtlib/fmt/pull/3400).
+  Thanks @laitingsheng, @Orvid and @DanielaE.
+  
+- Switched to the [modules CMake library](https://github.com/vitaut/modules)
+  which allows building {fmt} as a C++20 module with clang:
+
+      CXX=clang++ cmake -DFMT_MODULE=ON .
+      make
+
+- Made `format_as` work with any user-defined type and not just enums.
+  For example ([godbolt](https://godbolt.org/z/b7rqhq5Kh)):
+
+  ```c++
+  #include <fmt/format.h>
+
+  struct floaty_mc_floatface {
+    double value;
+  };
+
+  auto format_as(floaty_mc_floatface f) { return f.value; }
+
+  int main() {
+    fmt::print("{:8}\n", floaty_mc_floatface{0.42}); // prints "    0.42"
+  }
+  ```
+
+- Removed deprecated implicit conversions for enums and conversions to
+  primitive types for compatibility with `std::format` and to prevent
+  potential ODR violations. Use `format_as` instead.
+
+- Added support for fill, align and width to the time point formatter
+  (https://github.com/fmtlib/fmt/issues/3237,
+  https://github.com/fmtlib/fmt/pull/3260,
+  https://github.com/fmtlib/fmt/pull/3275). For example
+  ([godbolt](https://godbolt.org/z/rKP6MGz6c)):
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
+    // prints "    2023"
+    fmt::print("{:>8%Y}\n", std::chrono::system_clock::now());
+  }
+  ```
+
+  Thanks @ShawnZhong.
+
+- Implemented formatting of subseconds
+  (https://github.com/fmtlib/fmt/issues/2207,
+  https://github.com/fmtlib/fmt/issues/3117,
+  https://github.com/fmtlib/fmt/pull/3115,
+  https://github.com/fmtlib/fmt/pull/3143,
+  https://github.com/fmtlib/fmt/pull/3144,
+  https://github.com/fmtlib/fmt/pull/3349). For example
+  ([godbolt](https://godbolt.org/z/45738oGEo)):
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
+    // prints 01.234567
+    fmt::print("{:%S}\n", std::chrono::microseconds(1234567));
+  }
+  ```
+
+  Thanks @patrickroocks @phprus and @BRevzin.
+
+- Added precision support to `%S`
+  (https://github.com/fmtlib/fmt/pull/3148). Thanks @SappyJoy
+
+- Added support for `std::utc_time`
+  (https://github.com/fmtlib/fmt/issues/3098,
+  https://github.com/fmtlib/fmt/pull/3110). Thanks @patrickroocks.
+
+- Switched formatting of `std::chrono::system_clock` from local time
+  to UTC for compatibility with the standard
+  (https://github.com/fmtlib/fmt/issues/3199,
+  https://github.com/fmtlib/fmt/pull/3230). Thanks @ned14.
+
+- Added support for `%Ez` and `%Oz` to chrono formatters.
+  (https://github.com/fmtlib/fmt/issues/3220,
+  https://github.com/fmtlib/fmt/pull/3222). Thanks @phprus.
+
+- Improved validation of format specifiers for `std::chrono::duration`
+  (https://github.com/fmtlib/fmt/issues/3219,
+  https://github.com/fmtlib/fmt/pull/3232). Thanks @ShawnZhong.
+
+- Fixed formatting of time points before the epoch
+  (https://github.com/fmtlib/fmt/issues/3117,
+  https://github.com/fmtlib/fmt/pull/3261). For example
+  ([godbolt](https://godbolt.org/z/f7bcznb3W)):
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
+    auto t = std::chrono::system_clock::from_time_t(0) -
+             std::chrono::milliseconds(250);
+    fmt::print("{:%S}\n", t); // prints 59.750000000
+  }
+  ```
+
+  Thanks @ShawnZhong.
 
-        vector<bool>::_M_range_check: __n (which is 0) >= this->size() (which is 0)
+- Experimental: implemented glibc extension for padding seconds,
+  minutes and hours
+  (https://github.com/fmtlib/fmt/issues/2959,
+  https://github.com/fmtlib/fmt/pull/3271). Thanks @ShawnZhong.
+
+- Added a formatter for `std::exception`
+  (https://github.com/fmtlib/fmt/issues/2977,
+  https://github.com/fmtlib/fmt/issues/3012,
+  https://github.com/fmtlib/fmt/pull/3062,
+  https://github.com/fmtlib/fmt/pull/3076,
+  https://github.com/fmtlib/fmt/pull/3119). For example
+  ([godbolt](https://godbolt.org/z/8xoWGs9e4)):
+
+  ```c++
+  #include <fmt/std.h>
+  #include <vector>
+
+  int main() {
+    try {
+      std::vector<bool>().at(0);
+    } catch(const std::exception& e) {
+      fmt::print("{}", e);
+    }
+  }
+  ```
 
-    on libstdc++. Thanks @zach2good and @phprus.
+  prints:
+
+      vector<bool>::_M_range_check: __n (which is 0) >= this->size() (which is 0)
 
--   Moved `std::error_code` formatter from `fmt/os.h` to `fmt/std.h`.
-    (https://github.com/fmtlib/fmt/pull/3125). Thanks @phprus.
+  on libstdc++. Thanks @zach2good and @phprus.
 
--   Added formatters for standard container adapters:
-    `std::priority_queue`, `std::queue` and `std::stack`
-    (https://github.com/fmtlib/fmt/issues/3215,
-    https://github.com/fmtlib/fmt/pull/3279). For example
-    ([godbolt](https://godbolt.org/z/74h1xY9qK)):
+- Moved `std::error_code` formatter from `fmt/os.h` to `fmt/std.h`.
+  (https://github.com/fmtlib/fmt/pull/3125). Thanks @phprus.
 
-    ```c++
-    #include <fmt/ranges.h>
-    #include <stack>
-    #include <vector>
+- Added formatters for standard container adapters:
+  `std::priority_queue`, `std::queue` and `std::stack`
+  (https://github.com/fmtlib/fmt/issues/3215,
+  https://github.com/fmtlib/fmt/pull/3279). For example
+  ([godbolt](https://godbolt.org/z/74h1xY9qK)):
 
-    int main() {
-      auto s = std::stack<bool, std::vector<bool>>();
-      for (auto b: {true, false, true}) s.push(b);
-      fmt::print("{}\n", s); // prints [true, false, true]
-    }
-    ```
-
-    Thanks @ShawnZhong.
-
--   Added a formatter for `std::optional` to `fmt/std.h`
-    (https://github.com/fmtlib/fmt/issues/1367,
-    https://github.com/fmtlib/fmt/pull/3303).
-    Thanks @tom-huntington.
-
--   Fixed formatting of valueless by exception variants
-    (https://github.com/fmtlib/fmt/pull/3347). Thanks @TheOmegaCarrot.
-
--   Made `fmt::ptr` accept `unique_ptr` with a custom deleter
-    (https://github.com/fmtlib/fmt/pull/3177). Thanks @hmbj.
-
--   Fixed formatting of noncopyable ranges and nested ranges of chars
-    (https://github.com/fmtlib/fmt/pull/3158
-    https://github.com/fmtlib/fmt/issues/3286,
-    https://github.com/fmtlib/fmt/pull/3290). Thanks @BRevzin.
-
--   Fixed issues with formatting of paths and ranges of paths
-    (https://github.com/fmtlib/fmt/issues/3319,
-    https://github.com/fmtlib/fmt/pull/3321
-    https://github.com/fmtlib/fmt/issues/3322). Thanks @phprus.
-
--   Improved handling of invalid Unicode in paths.
-
--   Enabled compile-time checks on Apple clang 14 and later
-    (https://github.com/fmtlib/fmt/pull/3331). Thanks @cloyce.
-
--   Improved compile-time checks of named arguments
-    (https://github.com/fmtlib/fmt/issues/3105,
-    https://github.com/fmtlib/fmt/pull/3214). Thanks @rbrich.
-
--   Fixed formatting when both alignment and `0` are given
-    (https://github.com/fmtlib/fmt/issues/3236,
-    https://github.com/fmtlib/fmt/pull/3248). Thanks @ShawnZhong.
-
--   Improved Unicode support in the experimental file API on Windows
-    (https://github.com/fmtlib/fmt/issues/3234,
-    https://github.com/fmtlib/fmt/pull/3293). Thanks @Fros1er.
-
--   Unified UTF transcoding
-    (https://github.com/fmtlib/fmt/pull/3416). Thanks @phprus.
-
--   Added support for UTF-8 digit separators via an experimental locale
-    facet (https://github.com/fmtlib/fmt/issues/1861). For
-    example ([godbolt](https://godbolt.org/z/f7bcznb3W)):
-
-    ```c++
-    auto loc = std::locale(
-      std::locale(), new fmt::format_facet<std::locale>(""));
-    auto s = fmt::format(loc, "{:L}", 1000);
-    ```
-
-    where `` is U+2019 used as a digit separator in the de_CH locale.
-
--   Added an overload of `formatted_size` that takes a locale
-    (https://github.com/fmtlib/fmt/issues/3084,
-    https://github.com/fmtlib/fmt/pull/3087). Thanks @gerboengels.
-
--   Removed the deprecated `FMT_DEPRECATED_OSTREAM`.
-
--   Fixed a UB when using a null `std::string_view` with
-    `fmt::to_string` or format string compilation
-    (https://github.com/fmtlib/fmt/issues/3241,
-    https://github.com/fmtlib/fmt/pull/3244). Thanks @phprus.
-
--   Added `starts_with` to the fallback `string_view` implementation
-    (https://github.com/fmtlib/fmt/pull/3080). Thanks @phprus.
-
--   Added `fmt::basic_format_string::get()` for compatibility with
-    `basic_format_string`
-    (https://github.com/fmtlib/fmt/pull/3111). Thanks @huangqinjin.
-
--   Added `println` for compatibility with C++23
-    (https://github.com/fmtlib/fmt/pull/3267). Thanks @ShawnZhong.
-
--   Renamed the `FMT_EXPORT` macro for shared library usage to
-    `FMT_LIB_EXPORT`.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/3108,
-    https://github.com/fmtlib/fmt/issues/3169,
-    https://github.com/fmtlib/fmt/pull/3243).
-    https://github.com/fmtlib/fmt/pull/3404).
-    Thanks @Cleroth and @Vertexwahn.
-
--   Improved build configuration and tests
-    (https://github.com/fmtlib/fmt/pull/3118,
-    https://github.com/fmtlib/fmt/pull/3120,
-    https://github.com/fmtlib/fmt/pull/3188,
-    https://github.com/fmtlib/fmt/issues/3189,
-    https://github.com/fmtlib/fmt/pull/3198,
-    https://github.com/fmtlib/fmt/pull/3205,
-    https://github.com/fmtlib/fmt/pull/3207,
-    https://github.com/fmtlib/fmt/pull/3210,
-    https://github.com/fmtlib/fmt/pull/3240,
-    https://github.com/fmtlib/fmt/pull/3256,
-    https://github.com/fmtlib/fmt/pull/3264,
-    https://github.com/fmtlib/fmt/issues/3299,
-    https://github.com/fmtlib/fmt/pull/3302,
-    https://github.com/fmtlib/fmt/pull/3312,
-    https://github.com/fmtlib/fmt/issues/3317,
-    https://github.com/fmtlib/fmt/pull/3328,
-    https://github.com/fmtlib/fmt/pull/3333,
-    https://github.com/fmtlib/fmt/pull/3369,
-    https://github.com/fmtlib/fmt/issues/3373,
-    https://github.com/fmtlib/fmt/pull/3395,
-    https://github.com/fmtlib/fmt/pull/3406,
-    https://github.com/fmtlib/fmt/pull/3411).
-    Thanks @dimztimz, @phprus, @DavidKorczynski, @ChrisThrasher,
-    @FrancoisCarouge, @kennyweiss, @luzpaz, @codeinred, @Mixaill, @joycebrum,
-    @kevinhwang and @Vertexwahn.
-
--   Fixed a regression in handling empty format specifiers after a colon
-    (`{:}`) (https://github.com/fmtlib/fmt/pull/3086). Thanks @oxidase.
-
--   Worked around a broken implementation of
-    `std::is_constant_evaluated` in some versions of libstdc++ on clang
-    (https://github.com/fmtlib/fmt/issues/3247,
-    https://github.com/fmtlib/fmt/pull/3281). Thanks @phprus.
-
--   Fixed formatting of volatile variables
-    (https://github.com/fmtlib/fmt/pull/3068).
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/pull/3057,
-    https://github.com/fmtlib/fmt/pull/3066,
-    https://github.com/fmtlib/fmt/pull/3072,
-    https://github.com/fmtlib/fmt/pull/3082,
-    https://github.com/fmtlib/fmt/pull/3091,
-    https://github.com/fmtlib/fmt/issues/3092,
-    https://github.com/fmtlib/fmt/pull/3093,
-    https://github.com/fmtlib/fmt/pull/3095,
-    https://github.com/fmtlib/fmt/issues/3096,
-    https://github.com/fmtlib/fmt/pull/3097,
-    https://github.com/fmtlib/fmt/issues/3128,
-    https://github.com/fmtlib/fmt/pull/3129,
-    https://github.com/fmtlib/fmt/pull/3137,
-    https://github.com/fmtlib/fmt/pull/3139,
-    https://github.com/fmtlib/fmt/issues/3140,
-    https://github.com/fmtlib/fmt/pull/3142,
-    https://github.com/fmtlib/fmt/issues/3149,
-    https://github.com/fmtlib/fmt/pull/3150,
-    https://github.com/fmtlib/fmt/issues/3154,
-    https://github.com/fmtlib/fmt/issues/3163,
-    https://github.com/fmtlib/fmt/issues/3178,
-    https://github.com/fmtlib/fmt/pull/3184,
-    https://github.com/fmtlib/fmt/pull/3196,
-    https://github.com/fmtlib/fmt/issues/3204,
-    https://github.com/fmtlib/fmt/pull/3206,
-    https://github.com/fmtlib/fmt/pull/3208,
-    https://github.com/fmtlib/fmt/issues/3213,
-    https://github.com/fmtlib/fmt/pull/3216,
-    https://github.com/fmtlib/fmt/issues/3224,
-    https://github.com/fmtlib/fmt/issues/3226,
-    https://github.com/fmtlib/fmt/issues/3228,
-    https://github.com/fmtlib/fmt/pull/3229,
-    https://github.com/fmtlib/fmt/pull/3259,
-    https://github.com/fmtlib/fmt/issues/3274,
-    https://github.com/fmtlib/fmt/issues/3287,
-    https://github.com/fmtlib/fmt/pull/3288,
-    https://github.com/fmtlib/fmt/issues/3292,
-    https://github.com/fmtlib/fmt/pull/3295,
-    https://github.com/fmtlib/fmt/pull/3296,
-    https://github.com/fmtlib/fmt/issues/3298,
-    https://github.com/fmtlib/fmt/issues/3325,
-    https://github.com/fmtlib/fmt/pull/3326,
-    https://github.com/fmtlib/fmt/issues/3334,
-    https://github.com/fmtlib/fmt/issues/3342,
-    https://github.com/fmtlib/fmt/pull/3343,
-    https://github.com/fmtlib/fmt/issues/3351,
-    https://github.com/fmtlib/fmt/pull/3352,
-    https://github.com/fmtlib/fmt/pull/3362,
-    https://github.com/fmtlib/fmt/issues/3365,
-    https://github.com/fmtlib/fmt/pull/3366,
-    https://github.com/fmtlib/fmt/pull/3374,
-    https://github.com/fmtlib/fmt/issues/3377,
-    https://github.com/fmtlib/fmt/pull/3378,
-    https://github.com/fmtlib/fmt/issues/3381,
-    https://github.com/fmtlib/fmt/pull/3398,
-    https://github.com/fmtlib/fmt/pull/3413,
-    https://github.com/fmtlib/fmt/issues/3415).
-    Thanks @phprus, @gsjaardema, @NewbieOrange, @EngineLessCC, @asmaloney,
-    @HazardyKnusperkeks, @sergiud, @Youw, @thesmurph, @czudziakm,
-    @Roman-Koshelev, @chronoxor, @ShawnZhong, @russelltg, @glebm, @tmartin-gh,
-    @Zhaojun-Liu, @louiswins and @mogemimi.
+  ```c++
+  #include <fmt/ranges.h>
+  #include <stack>
+  #include <vector>
+
+  int main() {
+    auto s = std::stack<bool, std::vector<bool>>();
+    for (auto b: {true, false, true}) s.push(b);
+    fmt::print("{}\n", s); // prints [true, false, true]
+  }
+  ```
+
+  Thanks @ShawnZhong.
+
+- Added a formatter for `std::optional` to `fmt/std.h`
+  (https://github.com/fmtlib/fmt/issues/1367,
+  https://github.com/fmtlib/fmt/pull/3303).
+  Thanks @tom-huntington.
+
+- Fixed formatting of valueless by exception variants
+  (https://github.com/fmtlib/fmt/pull/3347). Thanks @TheOmegaCarrot.
+
+- Made `fmt::ptr` accept `unique_ptr` with a custom deleter
+  (https://github.com/fmtlib/fmt/pull/3177). Thanks @hmbj.
+
+- Fixed formatting of noncopyable ranges and nested ranges of chars
+  (https://github.com/fmtlib/fmt/pull/3158
+  https://github.com/fmtlib/fmt/issues/3286,
+  https://github.com/fmtlib/fmt/pull/3290). Thanks @BRevzin.
+
+- Fixed issues with formatting of paths and ranges of paths
+  (https://github.com/fmtlib/fmt/issues/3319,
+  https://github.com/fmtlib/fmt/pull/3321
+  https://github.com/fmtlib/fmt/issues/3322). Thanks @phprus.
+
+- Improved handling of invalid Unicode in paths.
+
+- Enabled compile-time checks on Apple clang 14 and later
+  (https://github.com/fmtlib/fmt/pull/3331). Thanks @cloyce.
+
+- Improved compile-time checks of named arguments
+  (https://github.com/fmtlib/fmt/issues/3105,
+  https://github.com/fmtlib/fmt/pull/3214). Thanks @rbrich.
+
+- Fixed formatting when both alignment and `0` are given
+  (https://github.com/fmtlib/fmt/issues/3236,
+  https://github.com/fmtlib/fmt/pull/3248). Thanks @ShawnZhong.
+
+- Improved Unicode support in the experimental file API on Windows
+  (https://github.com/fmtlib/fmt/issues/3234,
+  https://github.com/fmtlib/fmt/pull/3293). Thanks @Fros1er.
+
+- Unified UTF transcoding
+  (https://github.com/fmtlib/fmt/pull/3416). Thanks @phprus.
+
+- Added support for UTF-8 digit separators via an experimental locale
+  facet (https://github.com/fmtlib/fmt/issues/1861). For
+  example ([godbolt](https://godbolt.org/z/f7bcznb3W)):
+
+  ```c++
+  auto loc = std::locale(
+    std::locale(), new fmt::format_facet<std::locale>(""));
+  auto s = fmt::format(loc, "{:L}", 1000);
+  ```
+
+  where `` is U+2019 used as a digit separator in the de_CH locale.
+
+- Added an overload of `formatted_size` that takes a locale
+  (https://github.com/fmtlib/fmt/issues/3084,
+  https://github.com/fmtlib/fmt/pull/3087). Thanks @gerboengels.
+
+- Removed the deprecated `FMT_DEPRECATED_OSTREAM`.
+
+- Fixed a UB when using a null `std::string_view` with
+  `fmt::to_string` or format string compilation
+  (https://github.com/fmtlib/fmt/issues/3241,
+  https://github.com/fmtlib/fmt/pull/3244). Thanks @phprus.
+
+- Added `starts_with` to the fallback `string_view` implementation
+  (https://github.com/fmtlib/fmt/pull/3080). Thanks @phprus.
+
+- Added `fmt::basic_format_string::get()` for compatibility with
+  `basic_format_string`
+  (https://github.com/fmtlib/fmt/pull/3111). Thanks @huangqinjin.
+
+- Added `println` for compatibility with C++23
+  (https://github.com/fmtlib/fmt/pull/3267). Thanks @ShawnZhong.
+
+- Renamed the `FMT_EXPORT` macro for shared library usage to
+  `FMT_LIB_EXPORT`.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/3108,
+  https://github.com/fmtlib/fmt/issues/3169,
+  https://github.com/fmtlib/fmt/pull/3243).
+  https://github.com/fmtlib/fmt/pull/3404,
+  https://github.com/fmtlib/fmt/pull/4002).
+  Thanks @Cleroth, @Vertexwahn and @yujincheng08.
+
+- Improved build configuration and tests
+  (https://github.com/fmtlib/fmt/pull/3118,
+  https://github.com/fmtlib/fmt/pull/3120,
+  https://github.com/fmtlib/fmt/pull/3188,
+  https://github.com/fmtlib/fmt/issues/3189,
+  https://github.com/fmtlib/fmt/pull/3198,
+  https://github.com/fmtlib/fmt/pull/3205,
+  https://github.com/fmtlib/fmt/pull/3207,
+  https://github.com/fmtlib/fmt/pull/3210,
+  https://github.com/fmtlib/fmt/pull/3240,
+  https://github.com/fmtlib/fmt/pull/3256,
+  https://github.com/fmtlib/fmt/pull/3264,
+  https://github.com/fmtlib/fmt/issues/3299,
+  https://github.com/fmtlib/fmt/pull/3302,
+  https://github.com/fmtlib/fmt/pull/3312,
+  https://github.com/fmtlib/fmt/issues/3317,
+  https://github.com/fmtlib/fmt/pull/3328,
+  https://github.com/fmtlib/fmt/pull/3333,
+  https://github.com/fmtlib/fmt/pull/3369,
+  https://github.com/fmtlib/fmt/issues/3373,
+  https://github.com/fmtlib/fmt/pull/3395,
+  https://github.com/fmtlib/fmt/pull/3406,
+  https://github.com/fmtlib/fmt/pull/3411).
+  Thanks @dimztimz, @phprus, @DavidKorczynski, @ChrisThrasher,
+  @FrancoisCarouge, @kennyweiss, @luzpaz, @codeinred, @Mixaill, @joycebrum,
+  @kevinhwang and @Vertexwahn.
+
+- Fixed a regression in handling empty format specifiers after a colon
+  (`{:}`) (https://github.com/fmtlib/fmt/pull/3086). Thanks @oxidase.
+
+- Worked around a broken implementation of
+  `std::is_constant_evaluated` in some versions of libstdc++ on clang
+  (https://github.com/fmtlib/fmt/issues/3247,
+  https://github.com/fmtlib/fmt/pull/3281). Thanks @phprus.
+
+- Fixed formatting of volatile variables
+  (https://github.com/fmtlib/fmt/pull/3068).
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/pull/3057,
+  https://github.com/fmtlib/fmt/pull/3066,
+  https://github.com/fmtlib/fmt/pull/3072,
+  https://github.com/fmtlib/fmt/pull/3082,
+  https://github.com/fmtlib/fmt/pull/3091,
+  https://github.com/fmtlib/fmt/issues/3092,
+  https://github.com/fmtlib/fmt/pull/3093,
+  https://github.com/fmtlib/fmt/pull/3095,
+  https://github.com/fmtlib/fmt/issues/3096,
+  https://github.com/fmtlib/fmt/pull/3097,
+  https://github.com/fmtlib/fmt/issues/3128,
+  https://github.com/fmtlib/fmt/pull/3129,
+  https://github.com/fmtlib/fmt/pull/3137,
+  https://github.com/fmtlib/fmt/pull/3139,
+  https://github.com/fmtlib/fmt/issues/3140,
+  https://github.com/fmtlib/fmt/pull/3142,
+  https://github.com/fmtlib/fmt/issues/3149,
+  https://github.com/fmtlib/fmt/pull/3150,
+  https://github.com/fmtlib/fmt/issues/3154,
+  https://github.com/fmtlib/fmt/issues/3163,
+  https://github.com/fmtlib/fmt/issues/3178,
+  https://github.com/fmtlib/fmt/pull/3184,
+  https://github.com/fmtlib/fmt/pull/3196,
+  https://github.com/fmtlib/fmt/issues/3204,
+  https://github.com/fmtlib/fmt/pull/3206,
+  https://github.com/fmtlib/fmt/pull/3208,
+  https://github.com/fmtlib/fmt/issues/3213,
+  https://github.com/fmtlib/fmt/pull/3216,
+  https://github.com/fmtlib/fmt/issues/3224,
+  https://github.com/fmtlib/fmt/issues/3226,
+  https://github.com/fmtlib/fmt/issues/3228,
+  https://github.com/fmtlib/fmt/pull/3229,
+  https://github.com/fmtlib/fmt/pull/3259,
+  https://github.com/fmtlib/fmt/issues/3274,
+  https://github.com/fmtlib/fmt/issues/3287,
+  https://github.com/fmtlib/fmt/pull/3288,
+  https://github.com/fmtlib/fmt/issues/3292,
+  https://github.com/fmtlib/fmt/pull/3295,
+  https://github.com/fmtlib/fmt/pull/3296,
+  https://github.com/fmtlib/fmt/issues/3298,
+  https://github.com/fmtlib/fmt/issues/3325,
+  https://github.com/fmtlib/fmt/pull/3326,
+  https://github.com/fmtlib/fmt/issues/3334,
+  https://github.com/fmtlib/fmt/issues/3342,
+  https://github.com/fmtlib/fmt/pull/3343,
+  https://github.com/fmtlib/fmt/issues/3351,
+  https://github.com/fmtlib/fmt/pull/3352,
+  https://github.com/fmtlib/fmt/pull/3362,
+  https://github.com/fmtlib/fmt/issues/3365,
+  https://github.com/fmtlib/fmt/pull/3366,
+  https://github.com/fmtlib/fmt/pull/3374,
+  https://github.com/fmtlib/fmt/issues/3377,
+  https://github.com/fmtlib/fmt/pull/3378,
+  https://github.com/fmtlib/fmt/issues/3381,
+  https://github.com/fmtlib/fmt/pull/3398,
+  https://github.com/fmtlib/fmt/pull/3413,
+  https://github.com/fmtlib/fmt/issues/3415).
+  Thanks @phprus, @gsjaardema, @NewbieOrange, @EngineLessCC, @asmaloney,
+  @HazardyKnusperkeks, @sergiud, @Youw, @thesmurph, @czudziakm,
+  @Roman-Koshelev, @chronoxor, @ShawnZhong, @russelltg, @glebm, @tmartin-gh,
+  @Zhaojun-Liu, @louiswins and @mogemimi.
 
 # 9.1.0 - 2022-08-27
 
--   `fmt::formatted_size` now works at compile time
-    (https://github.com/fmtlib/fmt/pull/3026). For example
-    ([godbolt](https://godbolt.org/z/1MW5rMdf8)):
-
-    ```c++
-    #include <fmt/compile.h>
-
-    int main() {
-      using namespace fmt::literals;
-      constexpr size_t n = fmt::formatted_size("{}"_cf, 42);
-      fmt::print("{}\n", n); // prints 2
-    }
-    ```
+- `fmt::formatted_size` now works at compile time
+  (https://github.com/fmtlib/fmt/pull/3026). For example
+  ([godbolt](https://godbolt.org/z/1MW5rMdf8)):
 
-    Thanks @marksantaniello.
+  ```c++
+  #include <fmt/compile.h>
 
--   Fixed handling of invalid UTF-8
-    (https://github.com/fmtlib/fmt/pull/3038,
-    https://github.com/fmtlib/fmt/pull/3044,
-    https://github.com/fmtlib/fmt/pull/3056).
-    Thanks @phprus and @skeeto.
-
--   Improved Unicode support in `ostream` overloads of `print`
-    (https://github.com/fmtlib/fmt/pull/2994,
-    https://github.com/fmtlib/fmt/pull/3001,
-    https://github.com/fmtlib/fmt/pull/3025). Thanks @dimztimz.
-
--   Fixed handling of the sign specifier in localized formatting on
-    systems with 32-bit `wchar_t`
-    (https://github.com/fmtlib/fmt/issues/3041).
-
--   Added support for wide streams to `fmt::streamed`
-    (https://github.com/fmtlib/fmt/pull/2994). Thanks @phprus.
-
--   Added the `n` specifier that disables the output of delimiters when
-    formatting ranges (https://github.com/fmtlib/fmt/pull/2981,
-    https://github.com/fmtlib/fmt/pull/2983). For example
-    ([godbolt](https://godbolt.org/z/roKqGdj8c)):
-
-    ```c++
-    #include <fmt/ranges.h>
-    #include <vector>
-
-    int main() {
-      auto v = std::vector{1, 2, 3};
-      fmt::print("{:n}\n", v); // prints 1, 2, 3
-    }
-    ```
-
-    Thanks @BRevzin.
-
--   Worked around problematic `std::string_view` constructors introduced
-    in C++23 (https://github.com/fmtlib/fmt/issues/3030,
-    https://github.com/fmtlib/fmt/issues/3050). Thanks @strega-nil-ms.
-
--   Improve handling (exclusion) of recursive ranges
-    (https://github.com/fmtlib/fmt/issues/2968,
-    https://github.com/fmtlib/fmt/pull/2974). Thanks @Dani-Hub.
-
--   Improved error reporting in format string compilation
-    (https://github.com/fmtlib/fmt/issues/3055).
-
--   Improved the implementation of
-    [Dragonbox](https://github.com/jk-jeon/dragonbox), the algorithm
-    used for the default floating-point formatting
-    (https://github.com/fmtlib/fmt/pull/2984). Thanks @jk-jeon.
-
--   Fixed issues with floating-point formatting on exotic platforms.
-
--   Improved the implementation of chrono formatting
-    (https://github.com/fmtlib/fmt/pull/3010). Thanks @phprus.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/pull/2966,
-    https://github.com/fmtlib/fmt/pull/3009,
-    https://github.com/fmtlib/fmt/issues/3020,
-    https://github.com/fmtlib/fmt/pull/3037).
-    Thanks @mwinterb, @jcelerier and @remiburtin.
-
--   Improved build configuration
-    (https://github.com/fmtlib/fmt/pull/2991,
-    https://github.com/fmtlib/fmt/pull/2995,
-    https://github.com/fmtlib/fmt/issues/3004,
-    https://github.com/fmtlib/fmt/pull/3007,
-    https://github.com/fmtlib/fmt/pull/3040).
-    Thanks @dimztimz and @hwhsu1231.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/issues/2969,
-    https://github.com/fmtlib/fmt/pull/2971,
-    https://github.com/fmtlib/fmt/issues/2975,
-    https://github.com/fmtlib/fmt/pull/2982,
-    https://github.com/fmtlib/fmt/pull/2985,
-    https://github.com/fmtlib/fmt/issues/2988,
-    https://github.com/fmtlib/fmt/issues/2989,
-    https://github.com/fmtlib/fmt/issues/3000,
-    https://github.com/fmtlib/fmt/issues/3006,
-    https://github.com/fmtlib/fmt/issues/3014,
-    https://github.com/fmtlib/fmt/issues/3015,
-    https://github.com/fmtlib/fmt/pull/3021,
-    https://github.com/fmtlib/fmt/issues/3023,
-    https://github.com/fmtlib/fmt/pull/3024,
-    https://github.com/fmtlib/fmt/pull/3029,
-    https://github.com/fmtlib/fmt/pull/3043,
-    https://github.com/fmtlib/fmt/issues/3052,
-    https://github.com/fmtlib/fmt/pull/3053,
-    https://github.com/fmtlib/fmt/pull/3054).
-    Thanks @h-friederich, @dimztimz, @olupton, @bernhardmgruber and @phprus.
+  int main() {
+    using namespace fmt::literals;
+    constexpr size_t n = fmt::formatted_size("{}"_cf, 42);
+    fmt::print("{}\n", n); // prints 2
+  }
+  ```
+
+  Thanks @marksantaniello.
+
+- Fixed handling of invalid UTF-8
+  (https://github.com/fmtlib/fmt/pull/3038,
+  https://github.com/fmtlib/fmt/pull/3044,
+  https://github.com/fmtlib/fmt/pull/3056).
+  Thanks @phprus and @skeeto.
+
+- Improved Unicode support in `ostream` overloads of `print`
+  (https://github.com/fmtlib/fmt/pull/2994,
+  https://github.com/fmtlib/fmt/pull/3001,
+  https://github.com/fmtlib/fmt/pull/3025). Thanks @dimztimz.
+
+- Fixed handling of the sign specifier in localized formatting on
+  systems with 32-bit `wchar_t`
+  (https://github.com/fmtlib/fmt/issues/3041).
+
+- Added support for wide streams to `fmt::streamed`
+  (https://github.com/fmtlib/fmt/pull/2994). Thanks @phprus.
+
+- Added the `n` specifier that disables the output of delimiters when
+  formatting ranges (https://github.com/fmtlib/fmt/pull/2981,
+  https://github.com/fmtlib/fmt/pull/2983). For example
+  ([godbolt](https://godbolt.org/z/roKqGdj8c)):
+
+  ```c++
+  #include <fmt/ranges.h>
+  #include <vector>
+
+  int main() {
+    auto v = std::vector{1, 2, 3};
+    fmt::print("{:n}\n", v); // prints 1, 2, 3
+  }
+  ```
+
+  Thanks @BRevzin.
+
+- Worked around problematic `std::string_view` constructors introduced
+  in C++23 (https://github.com/fmtlib/fmt/issues/3030,
+  https://github.com/fmtlib/fmt/issues/3050). Thanks @strega-nil-ms.
+
+- Improve handling (exclusion) of recursive ranges
+  (https://github.com/fmtlib/fmt/issues/2968,
+  https://github.com/fmtlib/fmt/pull/2974). Thanks @Dani-Hub.
+
+- Improved error reporting in format string compilation
+  (https://github.com/fmtlib/fmt/issues/3055).
+
+- Improved the implementation of
+  [Dragonbox](https://github.com/jk-jeon/dragonbox), the algorithm
+  used for the default floating-point formatting
+  (https://github.com/fmtlib/fmt/pull/2984). Thanks @jk-jeon.
+
+- Fixed issues with floating-point formatting on exotic platforms.
+
+- Improved the implementation of chrono formatting
+  (https://github.com/fmtlib/fmt/pull/3010). Thanks @phprus.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/pull/2966,
+  https://github.com/fmtlib/fmt/pull/3009,
+  https://github.com/fmtlib/fmt/issues/3020,
+  https://github.com/fmtlib/fmt/pull/3037).
+  Thanks @mwinterb, @jcelerier and @remiburtin.
+
+- Improved build configuration
+  (https://github.com/fmtlib/fmt/pull/2991,
+  https://github.com/fmtlib/fmt/pull/2995,
+  https://github.com/fmtlib/fmt/issues/3004,
+  https://github.com/fmtlib/fmt/pull/3007,
+  https://github.com/fmtlib/fmt/pull/3040).
+  Thanks @dimztimz and @hwhsu1231.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/issues/2969,
+  https://github.com/fmtlib/fmt/pull/2971,
+  https://github.com/fmtlib/fmt/issues/2975,
+  https://github.com/fmtlib/fmt/pull/2982,
+  https://github.com/fmtlib/fmt/pull/2985,
+  https://github.com/fmtlib/fmt/issues/2988,
+  https://github.com/fmtlib/fmt/issues/2989,
+  https://github.com/fmtlib/fmt/issues/3000,
+  https://github.com/fmtlib/fmt/issues/3006,
+  https://github.com/fmtlib/fmt/issues/3014,
+  https://github.com/fmtlib/fmt/issues/3015,
+  https://github.com/fmtlib/fmt/pull/3021,
+  https://github.com/fmtlib/fmt/issues/3023,
+  https://github.com/fmtlib/fmt/pull/3024,
+  https://github.com/fmtlib/fmt/pull/3029,
+  https://github.com/fmtlib/fmt/pull/3043,
+  https://github.com/fmtlib/fmt/issues/3052,
+  https://github.com/fmtlib/fmt/pull/3053,
+  https://github.com/fmtlib/fmt/pull/3054).
+  Thanks @h-friederich, @dimztimz, @olupton, @bernhardmgruber and @phprus.
 
 # 9.0.0 - 2022-07-04
 
--   Switched to the internal floating point formatter for all decimal
-    presentation formats. In particular this results in consistent
-    rounding on all platforms and removing the `s[n]printf` fallback for
-    decimal FP formatting.
-
--   Compile-time floating point formatting no longer requires the
-    header-only mode. For example
-    ([godbolt](https://godbolt.org/z/G37PTeG3b)):
-
-    ```c++
-    #include <array>
-    #include <fmt/compile.h>
-
-    consteval auto compile_time_dtoa(double value) -> std::array<char, 10> {
-      auto result = std::array<char, 10>();
-      fmt::format_to(result.data(), FMT_COMPILE("{}"), value);
-      return result;
-    }
-
-    constexpr auto answer = compile_time_dtoa(0.42);
-    ```
+- Switched to the internal floating point formatter for all decimal
+  presentation formats. In particular this results in consistent
+  rounding on all platforms and removing the `s[n]printf` fallback for
+  decimal FP formatting.
 
-    works with the default settings.
+- Compile-time floating point formatting no longer requires the
+  header-only mode. For example
+  ([godbolt](https://godbolt.org/z/G37PTeG3b)):
 
--   Improved the implementation of
-    [Dragonbox](https://github.com/jk-jeon/dragonbox), the algorithm
-    used for the default floating-point formatting
-    (https://github.com/fmtlib/fmt/pull/2713,
-    https://github.com/fmtlib/fmt/pull/2750). Thanks @jk-jeon.
+  ```c++
+  #include <array>
+  #include <fmt/compile.h>
 
--   Made `fmt::to_string` work with `__float128`. This uses the internal
-    FP formatter and works even on system without `__float128` support
-    in `[s]printf`.
+  consteval auto compile_time_dtoa(double value) -> std::array<char, 10> {
+    auto result = std::array<char, 10>();
+    fmt::format_to(result.data(), FMT_COMPILE("{}"), value);
+    return result;
+  }
 
--   Disabled automatic `std::ostream` insertion operator (`operator<<`)
-    discovery when `fmt/ostream.h` is included to prevent ODR
-    violations. You can get the old behavior by defining
-    `FMT_DEPRECATED_OSTREAM` but this will be removed in the next major
-    release. Use `fmt::streamed` or `fmt::ostream_formatter` to enable
-    formatting via `std::ostream` instead.
+  constexpr auto answer = compile_time_dtoa(0.42);
+  ```
 
--   Added `fmt::ostream_formatter` that can be used to write `formatter`
-    specializations that perform formatting via `std::ostream`. For
-    example ([godbolt](https://godbolt.org/z/5sEc5qMsf)):
+  works with the default settings.
 
-    ```c++
-    #include <fmt/ostream.h>
+- Improved the implementation of
+  [Dragonbox](https://github.com/jk-jeon/dragonbox), the algorithm
+  used for the default floating-point formatting
+  (https://github.com/fmtlib/fmt/pull/2713,
+  https://github.com/fmtlib/fmt/pull/2750). Thanks @jk-jeon.
 
-    struct date {
-      int year, month, day;
+- Made `fmt::to_string` work with `__float128`. This uses the internal
+  FP formatter and works even on system without `__float128` support
+  in `[s]printf`.
 
-      friend std::ostream& operator<<(std::ostream& os, const date& d) {
-        return os << d.year << '-' << d.month << '-' << d.day;
-      }
-    };
+- Disabled automatic `std::ostream` insertion operator (`operator<<`)
+  discovery when `fmt/ostream.h` is included to prevent ODR
+  violations. You can get the old behavior by defining
+  `FMT_DEPRECATED_OSTREAM` but this will be removed in the next major
+  release. Use `fmt::streamed` or `fmt::ostream_formatter` to enable
+  formatting via `std::ostream` instead.
 
-    template <> struct fmt::formatter<date> : ostream_formatter {};
+- Added `fmt::ostream_formatter` that can be used to write `formatter`
+  specializations that perform formatting via `std::ostream`. For
+  example ([godbolt](https://godbolt.org/z/5sEc5qMsf)):
 
-    std::string s = fmt::format("The date is {}", date{2012, 12, 9});
-    // s == "The date is 2012-12-9"
-    ```
+  ```c++
+  #include <fmt/ostream.h>
 
--   Added the `fmt::streamed` function that takes an object and formats
-    it via `std::ostream`. For example
-    ([godbolt](https://godbolt.org/z/5G3346G1f)):
+  struct date {
+    int year, month, day;
 
-    ```c++
-    #include <thread>
-    #include <fmt/ostream.h>
-
-    int main() {
-      fmt::print("Current thread id: {}\n",
-                 fmt::streamed(std::this_thread::get_id()));
+    friend std::ostream& operator<<(std::ostream& os, const date& d) {
+      return os << d.year << '-' << d.month << '-' << d.day;
     }
-    ```
+  };
 
-    Note that `fmt/std.h` provides a `formatter` specialization for
-    `std::thread::id` so you don\'t need to format it via
-    `std::ostream`.
+  template <> struct fmt::formatter<date> : ostream_formatter {};
 
--   Deprecated implicit conversions of unscoped enums to integers for
-    consistency with scoped enums.
+  std::string s = fmt::format("The date is {}", date{2012, 12, 9});
+  // s == "The date is 2012-12-9"
+  ```
 
--   Added an argument-dependent lookup based `format_as` extension API
-    to simplify formatting of enums.
+- Added the `fmt::streamed` function that takes an object and formats
+  it via `std::ostream`. For example
+  ([godbolt](https://godbolt.org/z/5G3346G1f)):
 
--   Added experimental `std::variant` formatting support
-    (https://github.com/fmtlib/fmt/pull/2941). For example
-    ([godbolt](https://godbolt.org/z/KG9z6cq68)):
+  ```c++
+  #include <thread>
+  #include <fmt/ostream.h>
 
-    ```c++
-    #include <variant>
-    #include <fmt/std.h>
+  int main() {
+    fmt::print("Current thread id: {}\n",
+               fmt::streamed(std::this_thread::get_id()));
+  }
+  ```
 
-    int main() {
-      auto v = std::variant<int, std::string>(42);
-      fmt::print("{}\n", v);
-    }
-    ```
+  Note that `fmt/std.h` provides a `formatter` specialization for
+  `std::thread::id` so you don\'t need to format it via
+  `std::ostream`.
 
-    prints:
+- Deprecated implicit conversions of unscoped enums to integers for
+  consistency with scoped enums.
 
-        variant(42)
+- Added an argument-dependent lookup based `format_as` extension API
+  to simplify formatting of enums.
 
-    Thanks @jehelset.
+- Added experimental `std::variant` formatting support
+  (https://github.com/fmtlib/fmt/pull/2941). For example
+  ([godbolt](https://godbolt.org/z/KG9z6cq68)):
 
--   Added experimental `std::filesystem::path` formatting support
-    (https://github.com/fmtlib/fmt/issues/2865,
-    https://github.com/fmtlib/fmt/pull/2902,
-    https://github.com/fmtlib/fmt/issues/2917,
-    https://github.com/fmtlib/fmt/pull/2918). For example
-    ([godbolt](https://godbolt.org/z/o44dMexEb)):
+  ```c++
+  #include <variant>
+  #include <fmt/std.h>
 
-    ```c++
-    #include <filesystem>
-    #include <fmt/std.h>
+  int main() {
+    auto v = std::variant<int, std::string>(42);
+    fmt::print("{}\n", v);
+  }
+  ```
 
-    int main() {
-      fmt::print("There is no place like {}.", std::filesystem::path("/home"));
-    }
-    ```
+  prints:
 
-    prints:
+      variant(42)
 
-        There is no place like "/home".
+  Thanks @jehelset.
 
-    Thanks @phprus.
+- Added experimental `std::filesystem::path` formatting support
+  (https://github.com/fmtlib/fmt/issues/2865,
+  https://github.com/fmtlib/fmt/pull/2902,
+  https://github.com/fmtlib/fmt/issues/2917,
+  https://github.com/fmtlib/fmt/pull/2918). For example
+  ([godbolt](https://godbolt.org/z/o44dMexEb)):
 
--   Added a `std::thread::id` formatter to `fmt/std.h`. For example
-    ([godbolt](https://godbolt.org/z/j1azbYf3E)):
+  ```c++
+  #include <filesystem>
+  #include <fmt/std.h>
 
-    ```c++
-    #include <thread>
-    #include <fmt/std.h>
+  int main() {
+    fmt::print("There is no place like {}.", std::filesystem::path("/home"));
+  }
+  ```
 
-    int main() {
-      fmt::print("Current thread id: {}\n", std::this_thread::get_id());
-    }
-    ```
-
--   Added `fmt::styled` that applies a text style to an individual
-    argument (https://github.com/fmtlib/fmt/pull/2793). For
-    example ([godbolt](https://godbolt.org/z/vWGW7v5M6)):
-
-    ```c++
-    #include <fmt/chrono.h>
-    #include <fmt/color.h>
-
-    int main() {
-      auto now = std::chrono::system_clock::now();
-      fmt::print(
-        "[{}] {}: {}\n",
-        fmt::styled(now, fmt::emphasis::bold),
-        fmt::styled("error", fg(fmt::color::red)),
-        "something went wrong");
-    }
-    ```
+  prints:
 
-    prints
+      There is no place like "/home".
 
-    ![](https://user-images.githubusercontent.com/576385/175071215-12809244-dab0-4005-96d8-7cd911c964d5.png)
+  Thanks @phprus.
 
-    Thanks @rbrugo.
+- Added a `std::thread::id` formatter to `fmt/std.h`. For example
+  ([godbolt](https://godbolt.org/z/j1azbYf3E)):
 
--   Made `fmt::print` overload for text styles correctly handle UTF-8
-    (https://github.com/fmtlib/fmt/issues/2681,
-    https://github.com/fmtlib/fmt/pull/2701). Thanks @AlexGuteniev.
+  ```c++
+  #include <thread>
+  #include <fmt/std.h>
 
--   Fixed Unicode handling when writing to an ostream.
+  int main() {
+    fmt::print("Current thread id: {}\n", std::this_thread::get_id());
+  }
+  ```
 
--   Added support for nested specifiers to range formatting
-    (https://github.com/fmtlib/fmt/pull/2673). For example
-    ([godbolt](https://godbolt.org/z/xd3Gj38cf)):
+- Added `fmt::styled` that applies a text style to an individual
+  argument (https://github.com/fmtlib/fmt/pull/2793). For
+  example ([godbolt](https://godbolt.org/z/vWGW7v5M6)):
 
-    ```c++
-    #include <vector>
-    #include <fmt/ranges.h>
+  ```c++
+  #include <fmt/chrono.h>
+  #include <fmt/color.h>
 
-    int main() {
-      fmt::print("{::#x}\n", std::vector{10, 20, 30});
-    }
-    ```
-
-    prints `[0xa, 0x14, 0x1e]`.
-
-    Thanks @BRevzin.
-
--   Implemented escaping of wide strings in ranges
-    (https://github.com/fmtlib/fmt/pull/2904). Thanks @phprus.
-
--   Added support for ranges with `begin` / `end` found via the
-    argument-dependent lookup
-    (https://github.com/fmtlib/fmt/pull/2807). Thanks @rbrugo.
-
--   Fixed formatting of certain kinds of ranges of ranges
-    (https://github.com/fmtlib/fmt/pull/2787). Thanks @BRevzin.
-
--   Fixed handling of maps with element types other than `std::pair`
-    (https://github.com/fmtlib/fmt/pull/2944). Thanks @BrukerJWD.
-
--   Made tuple formatter enabled only if elements are formattable
-    (https://github.com/fmtlib/fmt/issues/2939,
-    https://github.com/fmtlib/fmt/pull/2940). Thanks @jehelset.
-
--   Made `fmt::join` compatible with format string compilation
-    (https://github.com/fmtlib/fmt/issues/2719,
-    https://github.com/fmtlib/fmt/pull/2720). Thanks @phprus.
-
--   Made compile-time checks work with named arguments of custom types
-    and `std::ostream` `print` overloads
-    (https://github.com/fmtlib/fmt/issues/2816,
-    https://github.com/fmtlib/fmt/issues/2817,
-    https://github.com/fmtlib/fmt/pull/2819). Thanks @timsong-cpp.
-
--   Removed `make_args_checked` because it is no longer needed for
-    compile-time checks
-    (https://github.com/fmtlib/fmt/pull/2760). Thanks @phprus.
-
--   Removed the following deprecated APIs: `_format`, `arg_join`, the
-    `format_to` overload that takes a memory buffer, `[v]fprintf` that
-    takes an `ostream`.
-
--   Removed the deprecated implicit conversion of `[const] signed char*`
-    and `[const] unsigned char*` to C strings.
-
--   Removed the deprecated `fmt/locale.h`.
-
--   Replaced the deprecated `fileno()` with `descriptor()` in
-    `buffered_file`.
-
--   Moved `to_string_view` to the `detail` namespace since it\'s an
-    implementation detail.
-
--   Made access mode of a created file consistent with `fopen` by
-    setting `S_IWGRP` and `S_IWOTH`
-    (https://github.com/fmtlib/fmt/pull/2733). Thanks @arogge.
-
--   Removed a redundant buffer resize when formatting to `std::ostream`
-    (https://github.com/fmtlib/fmt/issues/2842,
-    https://github.com/fmtlib/fmt/pull/2843). Thanks @jcelerier.
-
--   Made precision computation for strings consistent with width
-    (https://github.com/fmtlib/fmt/issues/2888).
-
--   Fixed handling of locale separators in floating point formatting
-    (https://github.com/fmtlib/fmt/issues/2830).
-
--   Made sign specifiers work with `__int128_t`
-    (https://github.com/fmtlib/fmt/issues/2773).
-
--   Improved support for systems such as CHERI with extra data stored in
-    pointers (https://github.com/fmtlib/fmt/pull/2932).
-    Thanks @davidchisnall.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/pull/2706,
-    https://github.com/fmtlib/fmt/pull/2712,
-    https://github.com/fmtlib/fmt/pull/2789,
-    https://github.com/fmtlib/fmt/pull/2803,
-    https://github.com/fmtlib/fmt/pull/2805,
-    https://github.com/fmtlib/fmt/pull/2815,
-    https://github.com/fmtlib/fmt/pull/2924).
-    Thanks @BRevzin, @Pokechu22, @setoye, @rtobar, @rbrugo, @anoonD and
-    @leha-bot.
-
--   Improved build configuration
-    (https://github.com/fmtlib/fmt/pull/2766,
-    https://github.com/fmtlib/fmt/pull/2772,
-    https://github.com/fmtlib/fmt/pull/2836,
-    https://github.com/fmtlib/fmt/pull/2852,
-    https://github.com/fmtlib/fmt/pull/2907,
-    https://github.com/fmtlib/fmt/pull/2913,
-    https://github.com/fmtlib/fmt/pull/2914).
-    Thanks @kambala-decapitator, @mattiasljungstrom, @kieselnb, @nathannaveen
-    and @Vertexwahn.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/issues/2408,
-    https://github.com/fmtlib/fmt/issues/2507,
-    https://github.com/fmtlib/fmt/issues/2697,
-    https://github.com/fmtlib/fmt/issues/2715,
-    https://github.com/fmtlib/fmt/issues/2717,
-    https://github.com/fmtlib/fmt/pull/2722,
-    https://github.com/fmtlib/fmt/pull/2724,
-    https://github.com/fmtlib/fmt/pull/2725,
-    https://github.com/fmtlib/fmt/issues/2726,
-    https://github.com/fmtlib/fmt/pull/2728,
-    https://github.com/fmtlib/fmt/pull/2732,
-    https://github.com/fmtlib/fmt/issues/2738,
-    https://github.com/fmtlib/fmt/pull/2742,
-    https://github.com/fmtlib/fmt/issues/2744,
-    https://github.com/fmtlib/fmt/issues/2745,
-    https://github.com/fmtlib/fmt/issues/2746,
-    https://github.com/fmtlib/fmt/issues/2754,
-    https://github.com/fmtlib/fmt/pull/2755,
-    https://github.com/fmtlib/fmt/issues/2757,
-    https://github.com/fmtlib/fmt/pull/2758,
-    https://github.com/fmtlib/fmt/issues/2761,
-    https://github.com/fmtlib/fmt/pull/2762,
-    https://github.com/fmtlib/fmt/issues/2763,
-    https://github.com/fmtlib/fmt/pull/2765,
-    https://github.com/fmtlib/fmt/issues/2769,
-    https://github.com/fmtlib/fmt/pull/2770,
-    https://github.com/fmtlib/fmt/issues/2771,
-    https://github.com/fmtlib/fmt/issues/2777,
-    https://github.com/fmtlib/fmt/pull/2779,
-    https://github.com/fmtlib/fmt/pull/2782,
-    https://github.com/fmtlib/fmt/pull/2783,
-    https://github.com/fmtlib/fmt/issues/2794,
-    https://github.com/fmtlib/fmt/issues/2796,
-    https://github.com/fmtlib/fmt/pull/2797,
-    https://github.com/fmtlib/fmt/pull/2801,
-    https://github.com/fmtlib/fmt/pull/2802,
-    https://github.com/fmtlib/fmt/issues/2808,
-    https://github.com/fmtlib/fmt/issues/2818,
-    https://github.com/fmtlib/fmt/pull/2819,
-    https://github.com/fmtlib/fmt/issues/2829,
-    https://github.com/fmtlib/fmt/issues/2835,
-    https://github.com/fmtlib/fmt/issues/2848,
-    https://github.com/fmtlib/fmt/issues/2860,
-    https://github.com/fmtlib/fmt/pull/2861,
-    https://github.com/fmtlib/fmt/pull/2882,
-    https://github.com/fmtlib/fmt/issues/2886,
-    https://github.com/fmtlib/fmt/issues/2891,
-    https://github.com/fmtlib/fmt/pull/2892,
-    https://github.com/fmtlib/fmt/issues/2895,
-    https://github.com/fmtlib/fmt/issues/2896,
-    https://github.com/fmtlib/fmt/pull/2903,
-    https://github.com/fmtlib/fmt/issues/2906,
-    https://github.com/fmtlib/fmt/issues/2908,
-    https://github.com/fmtlib/fmt/pull/2909,
-    https://github.com/fmtlib/fmt/issues/2920,
-    https://github.com/fmtlib/fmt/pull/2922,
-    https://github.com/fmtlib/fmt/pull/2927,
-    https://github.com/fmtlib/fmt/pull/2929,
-    https://github.com/fmtlib/fmt/issues/2936,
-    https://github.com/fmtlib/fmt/pull/2937,
-    https://github.com/fmtlib/fmt/pull/2938,
-    https://github.com/fmtlib/fmt/pull/2951,
-    https://github.com/fmtlib/fmt/issues/2954,
-    https://github.com/fmtlib/fmt/pull/2957,
-    https://github.com/fmtlib/fmt/issues/2958,
-    https://github.com/fmtlib/fmt/pull/2960).
-    Thanks @matrackif @Tobi823, @ivan-volnov, @VasiliPupkin256,
-    @federico-busato, @barcharcraz, @jk-jeon, @HazardyKnusperkeks, @dalboris,
-    @seanm, @gsjaardema, @timsong-cpp, @seanm, @frithrah, @chronoxor, @Agga,
-    @madmaxoft, @JurajX, @phprus and @Dani-Hub.
+  int main() {
+    auto now = std::chrono::system_clock::now();
+    fmt::print(
+      "[{}] {}: {}\n",
+      fmt::styled(now, fmt::emphasis::bold),
+      fmt::styled("error", fg(fmt::color::red)),
+      "something went wrong");
+  }
+  ```
 
-# 8.1.1 - 2022-01-06
+  prints
 
--   Restored ABI compatibility with version 8.0.x
-    (https://github.com/fmtlib/fmt/issues/2695,
-    https://github.com/fmtlib/fmt/pull/2696). Thanks @saraedum.
--   Fixed chrono formatting on big endian systems
-    (https://github.com/fmtlib/fmt/issues/2698,
-    https://github.com/fmtlib/fmt/pull/2699).
-    Thanks @phprus and @xvitaly.
--   Fixed a linkage error with mingw
-    (https://github.com/fmtlib/fmt/issues/2691,
-    https://github.com/fmtlib/fmt/pull/2692). Thanks @rbberger.
+  ![](https://user-images.githubusercontent.com/576385/175071215-12809244-dab0-4005-96d8-7cd911c964d5.png)
 
-# 8.1.0 - 2022-01-02
+  Thanks @rbrugo.
 
--   Optimized chrono formatting
-    (https://github.com/fmtlib/fmt/pull/2500,
-    https://github.com/fmtlib/fmt/pull/2537,
-    https://github.com/fmtlib/fmt/issues/2541,
-    https://github.com/fmtlib/fmt/pull/2544,
-    https://github.com/fmtlib/fmt/pull/2550,
-    https://github.com/fmtlib/fmt/pull/2551,
-    https://github.com/fmtlib/fmt/pull/2576,
-    https://github.com/fmtlib/fmt/issues/2577,
-    https://github.com/fmtlib/fmt/pull/2586,
-    https://github.com/fmtlib/fmt/pull/2591,
-    https://github.com/fmtlib/fmt/pull/2594,
-    https://github.com/fmtlib/fmt/pull/2602,
-    https://github.com/fmtlib/fmt/pull/2617,
-    https://github.com/fmtlib/fmt/issues/2628,
-    https://github.com/fmtlib/fmt/pull/2633,
-    https://github.com/fmtlib/fmt/issues/2670,
-    https://github.com/fmtlib/fmt/pull/2671).
-
-    Processing of some specifiers such as `%z` and `%Y` is now up to
-    10-20 times faster, for example on GCC 11 with libstdc++:
-
-        ----------------------------------------------------------------------------
-        Benchmark                                  Before             After
-        ----------------------------------------------------------------------------
-        FMTFormatter_z                             261 ns             26.3 ns
-        FMTFormatterCompile_z                      246 ns             11.6 ns
-        FMTFormatter_Y                             263 ns             26.1 ns
-        FMTFormatterCompile_Y                      244 ns             10.5 ns
-        ----------------------------------------------------------------------------
-
-    Thanks @phprus and @toughengineer.
-
--   Implemented subsecond formatting for chrono durations
-    (https://github.com/fmtlib/fmt/pull/2623). For example
-    ([godbolt](https://godbolt.org/z/es7vWTETe)):
-
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      fmt::print("{:%S}", std::chrono::milliseconds(1234));
-    }
-    ```
+- Made `fmt::print` overload for text styles correctly handle UTF-8
+  (https://github.com/fmtlib/fmt/issues/2681,
+  https://github.com/fmtlib/fmt/pull/2701). Thanks @AlexGuteniev.
 
-    prints \"01.234\".
+- Fixed Unicode handling when writing to an ostream.
 
-    Thanks @matrackif.
+- Added support for nested specifiers to range formatting
+  (https://github.com/fmtlib/fmt/pull/2673). For example
+  ([godbolt](https://godbolt.org/z/xd3Gj38cf)):
 
--   Fixed handling of precision 0 when formatting chrono durations
-    (https://github.com/fmtlib/fmt/issues/2587,
-    https://github.com/fmtlib/fmt/pull/2588). Thanks @lukester1975.
+  ```c++
+  #include <vector>
+  #include <fmt/ranges.h>
 
--   Fixed an overflow on invalid inputs in the `tm` formatter
-    (https://github.com/fmtlib/fmt/pull/2564). Thanks @phprus.
+  int main() {
+    fmt::print("{::#x}\n", std::vector{10, 20, 30});
+  }
+  ```
 
--   Added `fmt::group_digits` that formats integers with a non-localized
-    digit separator (comma) for groups of three digits. For example
-    ([godbolt](https://godbolt.org/z/TxGxG9Poq)):
+  prints `[0xa, 0x14, 0x1e]`.
 
-    ```c++
-    #include <fmt/format.h>
+  Thanks @BRevzin.
+
+- Implemented escaping of wide strings in ranges
+  (https://github.com/fmtlib/fmt/pull/2904). Thanks @phprus.
+
+- Added support for ranges with `begin` / `end` found via the
+  argument-dependent lookup
+  (https://github.com/fmtlib/fmt/pull/2807). Thanks @rbrugo.
+
+- Fixed formatting of certain kinds of ranges of ranges
+  (https://github.com/fmtlib/fmt/pull/2787). Thanks @BRevzin.
+
+- Fixed handling of maps with element types other than `std::pair`
+  (https://github.com/fmtlib/fmt/pull/2944). Thanks @BrukerJWD.
+
+- Made tuple formatter enabled only if elements are formattable
+  (https://github.com/fmtlib/fmt/issues/2939,
+  https://github.com/fmtlib/fmt/pull/2940). Thanks @jehelset.
+
+- Made `fmt::join` compatible with format string compilation
+  (https://github.com/fmtlib/fmt/issues/2719,
+  https://github.com/fmtlib/fmt/pull/2720). Thanks @phprus.
+
+- Made compile-time checks work with named arguments of custom types
+  and `std::ostream` `print` overloads
+  (https://github.com/fmtlib/fmt/issues/2816,
+  https://github.com/fmtlib/fmt/issues/2817,
+  https://github.com/fmtlib/fmt/pull/2819). Thanks @timsong-cpp.
+
+- Removed `make_args_checked` because it is no longer needed for
+  compile-time checks
+  (https://github.com/fmtlib/fmt/pull/2760). Thanks @phprus.
+
+- Removed the following deprecated APIs: `_format`, `arg_join`, the
+  `format_to` overload that takes a memory buffer, `[v]fprintf` that
+  takes an `ostream`.
+
+- Removed the deprecated implicit conversion of `[const] signed char*`
+  and `[const] unsigned char*` to C strings.
+
+- Removed the deprecated `fmt/locale.h`.
+
+- Replaced the deprecated `fileno()` with `descriptor()` in
+  `buffered_file`.
+
+- Moved `to_string_view` to the `detail` namespace since it\'s an
+  implementation detail.
+
+- Made access mode of a created file consistent with `fopen` by
+  setting `S_IWGRP` and `S_IWOTH`
+  (https://github.com/fmtlib/fmt/pull/2733). Thanks @arogge.
+
+- Removed a redundant buffer resize when formatting to `std::ostream`
+  (https://github.com/fmtlib/fmt/issues/2842,
+  https://github.com/fmtlib/fmt/pull/2843). Thanks @jcelerier.
+
+- Made precision computation for strings consistent with width
+  (https://github.com/fmtlib/fmt/issues/2888).
+
+- Fixed handling of locale separators in floating point formatting
+  (https://github.com/fmtlib/fmt/issues/2830).
+
+- Made sign specifiers work with `__int128_t`
+  (https://github.com/fmtlib/fmt/issues/2773).
+
+- Improved support for systems such as CHERI with extra data stored in
+  pointers (https://github.com/fmtlib/fmt/pull/2932).
+  Thanks @davidchisnall.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/pull/2706,
+  https://github.com/fmtlib/fmt/pull/2712,
+  https://github.com/fmtlib/fmt/pull/2789,
+  https://github.com/fmtlib/fmt/pull/2803,
+  https://github.com/fmtlib/fmt/pull/2805,
+  https://github.com/fmtlib/fmt/pull/2815,
+  https://github.com/fmtlib/fmt/pull/2924).
+  Thanks @BRevzin, @Pokechu22, @setoye, @rtobar, @rbrugo, @anoonD and
+  @leha-bot.
+
+- Improved build configuration
+  (https://github.com/fmtlib/fmt/pull/2766,
+  https://github.com/fmtlib/fmt/pull/2772,
+  https://github.com/fmtlib/fmt/pull/2836,
+  https://github.com/fmtlib/fmt/pull/2852,
+  https://github.com/fmtlib/fmt/pull/2907,
+  https://github.com/fmtlib/fmt/pull/2913,
+  https://github.com/fmtlib/fmt/pull/2914).
+  Thanks @kambala-decapitator, @mattiasljungstrom, @kieselnb, @nathannaveen
+  and @Vertexwahn.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/issues/2408,
+  https://github.com/fmtlib/fmt/issues/2507,
+  https://github.com/fmtlib/fmt/issues/2697,
+  https://github.com/fmtlib/fmt/issues/2715,
+  https://github.com/fmtlib/fmt/issues/2717,
+  https://github.com/fmtlib/fmt/pull/2722,
+  https://github.com/fmtlib/fmt/pull/2724,
+  https://github.com/fmtlib/fmt/pull/2725,
+  https://github.com/fmtlib/fmt/issues/2726,
+  https://github.com/fmtlib/fmt/pull/2728,
+  https://github.com/fmtlib/fmt/pull/2732,
+  https://github.com/fmtlib/fmt/issues/2738,
+  https://github.com/fmtlib/fmt/pull/2742,
+  https://github.com/fmtlib/fmt/issues/2744,
+  https://github.com/fmtlib/fmt/issues/2745,
+  https://github.com/fmtlib/fmt/issues/2746,
+  https://github.com/fmtlib/fmt/issues/2754,
+  https://github.com/fmtlib/fmt/pull/2755,
+  https://github.com/fmtlib/fmt/issues/2757,
+  https://github.com/fmtlib/fmt/pull/2758,
+  https://github.com/fmtlib/fmt/issues/2761,
+  https://github.com/fmtlib/fmt/pull/2762,
+  https://github.com/fmtlib/fmt/issues/2763,
+  https://github.com/fmtlib/fmt/pull/2765,
+  https://github.com/fmtlib/fmt/issues/2769,
+  https://github.com/fmtlib/fmt/pull/2770,
+  https://github.com/fmtlib/fmt/issues/2771,
+  https://github.com/fmtlib/fmt/issues/2777,
+  https://github.com/fmtlib/fmt/pull/2779,
+  https://github.com/fmtlib/fmt/pull/2782,
+  https://github.com/fmtlib/fmt/pull/2783,
+  https://github.com/fmtlib/fmt/issues/2794,
+  https://github.com/fmtlib/fmt/issues/2796,
+  https://github.com/fmtlib/fmt/pull/2797,
+  https://github.com/fmtlib/fmt/pull/2801,
+  https://github.com/fmtlib/fmt/pull/2802,
+  https://github.com/fmtlib/fmt/issues/2808,
+  https://github.com/fmtlib/fmt/issues/2818,
+  https://github.com/fmtlib/fmt/pull/2819,
+  https://github.com/fmtlib/fmt/issues/2829,
+  https://github.com/fmtlib/fmt/issues/2835,
+  https://github.com/fmtlib/fmt/issues/2848,
+  https://github.com/fmtlib/fmt/issues/2860,
+  https://github.com/fmtlib/fmt/pull/2861,
+  https://github.com/fmtlib/fmt/pull/2882,
+  https://github.com/fmtlib/fmt/issues/2886,
+  https://github.com/fmtlib/fmt/issues/2891,
+  https://github.com/fmtlib/fmt/pull/2892,
+  https://github.com/fmtlib/fmt/issues/2895,
+  https://github.com/fmtlib/fmt/issues/2896,
+  https://github.com/fmtlib/fmt/pull/2903,
+  https://github.com/fmtlib/fmt/issues/2906,
+  https://github.com/fmtlib/fmt/issues/2908,
+  https://github.com/fmtlib/fmt/pull/2909,
+  https://github.com/fmtlib/fmt/issues/2920,
+  https://github.com/fmtlib/fmt/pull/2922,
+  https://github.com/fmtlib/fmt/pull/2927,
+  https://github.com/fmtlib/fmt/pull/2929,
+  https://github.com/fmtlib/fmt/issues/2936,
+  https://github.com/fmtlib/fmt/pull/2937,
+  https://github.com/fmtlib/fmt/pull/2938,
+  https://github.com/fmtlib/fmt/pull/2951,
+  https://github.com/fmtlib/fmt/issues/2954,
+  https://github.com/fmtlib/fmt/pull/2957,
+  https://github.com/fmtlib/fmt/issues/2958,
+  https://github.com/fmtlib/fmt/pull/2960).
+  Thanks @matrackif @Tobi823, @ivan-volnov, @VasiliPupkin256,
+  @federico-busato, @barcharcraz, @jk-jeon, @HazardyKnusperkeks, @dalboris,
+  @seanm, @gsjaardema, @timsong-cpp, @seanm, @frithrah, @chronoxor, @Agga,
+  @madmaxoft, @JurajX, @phprus and @Dani-Hub.
 
-    int main() {
-      fmt::print("{} dollars", fmt::group_digits(1000000));
-    }
-    ```
-
-    prints \"1,000,000 dollars\".
+# 8.1.1 - 2022-01-06
 
--   Added support for faint, conceal, reverse and blink text styles
-    (https://github.com/fmtlib/fmt/pull/2394):
+- Restored ABI compatibility with version 8.0.x
+  (https://github.com/fmtlib/fmt/issues/2695,
+  https://github.com/fmtlib/fmt/pull/2696). Thanks @saraedum.
+- Fixed chrono formatting on big endian systems
+  (https://github.com/fmtlib/fmt/issues/2698,
+  https://github.com/fmtlib/fmt/pull/2699).
+  Thanks @phprus and @xvitaly.
+- Fixed a linkage error with mingw
+  (https://github.com/fmtlib/fmt/issues/2691,
+  https://github.com/fmtlib/fmt/pull/2692). Thanks @rbberger.
 
-    <https://user-images.githubusercontent.com/576385/147710227-c68f5317-f8fa-42c3-9123-7c4ba3c398cb.mp4>
+# 8.1.0 - 2022-01-02
 
-    Thanks @benit8 and @data-man.
+- Optimized chrono formatting
+  (https://github.com/fmtlib/fmt/pull/2500,
+  https://github.com/fmtlib/fmt/pull/2537,
+  https://github.com/fmtlib/fmt/issues/2541,
+  https://github.com/fmtlib/fmt/pull/2544,
+  https://github.com/fmtlib/fmt/pull/2550,
+  https://github.com/fmtlib/fmt/pull/2551,
+  https://github.com/fmtlib/fmt/pull/2576,
+  https://github.com/fmtlib/fmt/issues/2577,
+  https://github.com/fmtlib/fmt/pull/2586,
+  https://github.com/fmtlib/fmt/pull/2591,
+  https://github.com/fmtlib/fmt/pull/2594,
+  https://github.com/fmtlib/fmt/pull/2602,
+  https://github.com/fmtlib/fmt/pull/2617,
+  https://github.com/fmtlib/fmt/issues/2628,
+  https://github.com/fmtlib/fmt/pull/2633,
+  https://github.com/fmtlib/fmt/issues/2670,
+  https://github.com/fmtlib/fmt/pull/2671).
+
+  Processing of some specifiers such as `%z` and `%Y` is now up to
+  10-20 times faster, for example on GCC 11 with libstdc++:
+
+      ----------------------------------------------------------------------------
+      Benchmark                                  Before             After
+      ----------------------------------------------------------------------------
+      FMTFormatter_z                             261 ns             26.3 ns
+      FMTFormatterCompile_z                      246 ns             11.6 ns
+      FMTFormatter_Y                             263 ns             26.1 ns
+      FMTFormatterCompile_Y                      244 ns             10.5 ns
+      ----------------------------------------------------------------------------
+
+  Thanks @phprus and @toughengineer.
+
+- Implemented subsecond formatting for chrono durations
+  (https://github.com/fmtlib/fmt/pull/2623). For example
+  ([godbolt](https://godbolt.org/z/es7vWTETe)):
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
+    fmt::print("{:%S}", std::chrono::milliseconds(1234));
+  }
+  ```
+
+  prints \"01.234\".
+
+  Thanks @matrackif.
+
+- Fixed handling of precision 0 when formatting chrono durations
+  (https://github.com/fmtlib/fmt/issues/2587,
+  https://github.com/fmtlib/fmt/pull/2588). Thanks @lukester1975.
+
+- Fixed an overflow on invalid inputs in the `tm` formatter
+  (https://github.com/fmtlib/fmt/pull/2564). Thanks @phprus.
+
+- Added `fmt::group_digits` that formats integers with a non-localized
+  digit separator (comma) for groups of three digits. For example
+  ([godbolt](https://godbolt.org/z/TxGxG9Poq)):
+
+  ```c++
+  #include <fmt/format.h>
+
+  int main() {
+    fmt::print("{} dollars", fmt::group_digits(1000000));
+  }
+  ```
+
+  prints \"1,000,000 dollars\".
+
+- Added support for faint, conceal, reverse and blink text styles
+  (https://github.com/fmtlib/fmt/pull/2394):
+
+  <https://user-images.githubusercontent.com/576385/147710227-c68f5317-f8fa-42c3-9123-7c4ba3c398cb.mp4>
+
+  Thanks @benit8 and @data-man.
+
+- Added experimental support for compile-time floating point
+  formatting (https://github.com/fmtlib/fmt/pull/2426,
+  https://github.com/fmtlib/fmt/pull/2470). It is currently
+  limited to the header-only mode. Thanks @alexezeder.
+
+- Added UDL-based named argument support to compile-time format string
+  checks (https://github.com/fmtlib/fmt/issues/2640,
+  https://github.com/fmtlib/fmt/pull/2649). For example
+  ([godbolt](https://godbolt.org/z/ohGbbvonv)):
+
+  ```c++
+  #include <fmt/format.h>
+
+  int main() {
+    using namespace fmt::literals;
+    fmt::print("{answer:s}", "answer"_a=42);
+  }
+  ```
 
--   Added experimental support for compile-time floating point
-    formatting (https://github.com/fmtlib/fmt/pull/2426,
-    https://github.com/fmtlib/fmt/pull/2470). It is currently
-    limited to the header-only mode. Thanks @alexezeder.
+  gives a compile-time error on compilers with C++20 `consteval` and
+  non-type template parameter support (gcc 10+) because `s` is not a
+  valid format specifier for an integer.
 
--   Added UDL-based named argument support to compile-time format string
-    checks (https://github.com/fmtlib/fmt/issues/2640,
-    https://github.com/fmtlib/fmt/pull/2649). For example
-    ([godbolt](https://godbolt.org/z/ohGbbvonv)):
+  Thanks @alexezeder.
 
-    ```c++
-    #include <fmt/format.h>
+- Implemented escaping of string range elements. For example
+  ([godbolt](https://godbolt.org/z/rKvM1vKf3)):
 
-    int main() {
-      using namespace fmt::literals;
-      fmt::print("{answer:s}", "answer"_a=42);
-    }
-    ```
+  ```c++
+  #include <fmt/ranges.h>
+  #include <vector>
 
-    gives a compile-time error on compilers with C++20 `consteval` and
-    non-type template parameter support (gcc 10+) because `s` is not a
-    valid format specifier for an integer.
+  int main() {
+    fmt::print("{}", std::vector<std::string>{"\naan"});
+  }
+  ```
 
-    Thanks @alexezeder.
+  is now printed as:
 
--   Implemented escaping of string range elements. For example
-    ([godbolt](https://godbolt.org/z/rKvM1vKf3)):
+      ["\naan"]
 
-    ```c++
-    #include <fmt/ranges.h>
-    #include <vector>
+  instead of:
 
-    int main() {
-      fmt::print("{}", std::vector<std::string>{"\naan"});
-    }
-    ```
+      ["
+      aan"]
 
-    is now printed as:
+- Added an experimental `?` specifier for escaping strings.
+  (https://github.com/fmtlib/fmt/pull/2674). Thanks @BRevzin.
 
-        ["\naan"]
+- Switched to JSON-like representation of maps and sets for
+  consistency with Python\'s `str.format`. For example
+  ([godbolt](https://godbolt.org/z/seKjoY9W5)):
 
-    instead of:
+  ```c++
+  #include <fmt/ranges.h>
+  #include <map>
 
-        ["
-        aan"]
+  int main() {
+    fmt::print("{}", std::map<std::string, int>{{"answer", 42}});
+  }
+  ```
 
--   Added an experimental `?` specifier for escaping strings.
-    (https://github.com/fmtlib/fmt/pull/2674). Thanks @BRevzin.
+  is now printed as:
 
--   Switched to JSON-like representation of maps and sets for
-    consistency with Python\'s `str.format`. For example
-    ([godbolt](https://godbolt.org/z/seKjoY9W5)):
+      {"answer": 42}
 
-    ```c++
-    #include <fmt/ranges.h>
-    #include <map>
+- Extended `fmt::join` to support C++20-only ranges
+  (https://github.com/fmtlib/fmt/pull/2549). Thanks @BRevzin.
 
-    int main() {
-      fmt::print("{}", std::map<std::string, int>{{"answer", 42}});
-    }
-    ```
+- Optimized handling of non-const-iterable ranges and implemented
+  initial support for non-const-formattable types.
 
-    is now printed as:
+- Disabled implicit conversions of scoped enums to integers that was
+  accidentally introduced in earlier versions
+  (https://github.com/fmtlib/fmt/pull/1841).
 
-        {"answer": 42}
+- Deprecated implicit conversion of `[const] signed char*` and
+  `[const] unsigned char*` to C strings.
 
--   Extended `fmt::join` to support C++20-only ranges
-    (https://github.com/fmtlib/fmt/pull/2549). Thanks @BRevzin.
+- Deprecated `_format`, a legacy UDL-based format API
+  (https://github.com/fmtlib/fmt/pull/2646). Thanks @alexezeder.
 
--   Optimized handling of non-const-iterable ranges and implemented
-    initial support for non-const-formattable types.
+- Marked `format`, `formatted_size` and `to_string` as `[[nodiscard]]`
+  (https://github.com/fmtlib/fmt/pull/2612). @0x8000-0000.
 
--   Disabled implicit conversions of scoped enums to integers that was
-    accidentally introduced in earlier versions
-    (https://github.com/fmtlib/fmt/pull/1841).
-
--   Deprecated implicit conversion of `[const] signed char*` and
-    `[const] unsigned char*` to C strings.
-
--   Deprecated `_format`, a legacy UDL-based format API
-    (https://github.com/fmtlib/fmt/pull/2646). Thanks @alexezeder.
-
--   Marked `format`, `formatted_size` and `to_string` as `[[nodiscard]]`
-    (https://github.com/fmtlib/fmt/pull/2612). @0x8000-0000.
-
--   Added missing diagnostic when trying to format function and member
-    pointers as well as objects convertible to pointers which is
-    explicitly disallowed
-    (https://github.com/fmtlib/fmt/issues/2598,
-    https://github.com/fmtlib/fmt/pull/2609,
-    https://github.com/fmtlib/fmt/pull/2610). Thanks @AlexGuteniev.
-
--   Optimized writing to a contiguous buffer with `format_to_n`
-    (https://github.com/fmtlib/fmt/pull/2489). Thanks @Roman-Koshelev.
-
--   Optimized writing to non-`char` buffers
-    (https://github.com/fmtlib/fmt/pull/2477). Thanks @Roman-Koshelev.
-
--   Decimal point is now localized when using the `L` specifier.
-
--   Improved floating point formatter implementation
-    (https://github.com/fmtlib/fmt/pull/2498,
-    https://github.com/fmtlib/fmt/pull/2499). Thanks @Roman-Koshelev.
-
--   Fixed handling of very large precision in fixed format
-    (https://github.com/fmtlib/fmt/pull/2616).
-
--   Made a table of cached powers used in FP formatting static
-    (https://github.com/fmtlib/fmt/pull/2509). Thanks @jk-jeon.
-
--   Resolved a lookup ambiguity with C++20 format-related functions due
-    to ADL (https://github.com/fmtlib/fmt/issues/2639,
-    https://github.com/fmtlib/fmt/pull/2641). Thanks @mkurdej.
-
--   Removed unnecessary inline namespace qualification
-    (https://github.com/fmtlib/fmt/issues/2642,
-    https://github.com/fmtlib/fmt/pull/2643). Thanks @mkurdej.
-
--   Implemented argument forwarding in `format_to_n`
-    (https://github.com/fmtlib/fmt/issues/2462,
-    https://github.com/fmtlib/fmt/pull/2463). Thanks @owent.
-
--   Fixed handling of implicit conversions in `fmt::to_string` and
-    format string compilation
-    (https://github.com/fmtlib/fmt/issues/2565).
-
--   Changed the default access mode of files created by
-    `fmt::output_file` to `-rw-r--r--` for consistency with `fopen`
-    (https://github.com/fmtlib/fmt/issues/2530).
-
--   Make `fmt::ostream::flush` public
-    (https://github.com/fmtlib/fmt/issues/2435).
-
--   Improved C++14/17 attribute detection
-    (https://github.com/fmtlib/fmt/pull/2615). Thanks @AlexGuteniev.
-
--   Improved `consteval` detection for MSVC
-    (https://github.com/fmtlib/fmt/pull/2559). Thanks @DanielaE.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/2406,
-    https://github.com/fmtlib/fmt/pull/2446,
-    https://github.com/fmtlib/fmt/issues/2493,
-    https://github.com/fmtlib/fmt/issues/2513,
-    https://github.com/fmtlib/fmt/pull/2515,
-    https://github.com/fmtlib/fmt/issues/2522,
-    https://github.com/fmtlib/fmt/pull/2562,
-    https://github.com/fmtlib/fmt/pull/2575,
-    https://github.com/fmtlib/fmt/pull/2606,
-    https://github.com/fmtlib/fmt/pull/2620,
-    https://github.com/fmtlib/fmt/issues/2676).
-    Thanks @sobolevn, @UnePierre, @zhsj, @phprus, @ericcurtin and @Lounarok.
-
--   Improved fuzzers and added a fuzzer for chrono timepoint formatting
-    (https://github.com/fmtlib/fmt/pull/2461,
-    https://github.com/fmtlib/fmt/pull/2469). @pauldreik,
-
--   Added the `FMT_SYSTEM_HEADERS` CMake option setting which marks
-    {fmt}\'s headers as system. It can be used to suppress warnings
-    (https://github.com/fmtlib/fmt/issues/2644,
-    https://github.com/fmtlib/fmt/pull/2651). Thanks @alexezeder.
-
--   Added the Bazel build system support
-    (https://github.com/fmtlib/fmt/pull/2505,
-    https://github.com/fmtlib/fmt/pull/2516). Thanks @Vertexwahn.
-
--   Improved build configuration and tests
-    (https://github.com/fmtlib/fmt/issues/2437,
-    https://github.com/fmtlib/fmt/pull/2558,
-    https://github.com/fmtlib/fmt/pull/2648,
-    https://github.com/fmtlib/fmt/pull/2650,
-    https://github.com/fmtlib/fmt/pull/2663,
-    https://github.com/fmtlib/fmt/pull/2677).
-    Thanks @DanielaE, @alexezeder and @phprus.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/pull/2353,
-    https://github.com/fmtlib/fmt/pull/2356,
-    https://github.com/fmtlib/fmt/pull/2399,
-    https://github.com/fmtlib/fmt/issues/2408,
-    https://github.com/fmtlib/fmt/pull/2414,
-    https://github.com/fmtlib/fmt/pull/2427,
-    https://github.com/fmtlib/fmt/pull/2432,
-    https://github.com/fmtlib/fmt/pull/2442,
-    https://github.com/fmtlib/fmt/pull/2434,
-    https://github.com/fmtlib/fmt/issues/2439,
-    https://github.com/fmtlib/fmt/pull/2447,
-    https://github.com/fmtlib/fmt/pull/2450,
-    https://github.com/fmtlib/fmt/issues/2455,
-    https://github.com/fmtlib/fmt/issues/2465,
-    https://github.com/fmtlib/fmt/issues/2472,
-    https://github.com/fmtlib/fmt/issues/2474,
-    https://github.com/fmtlib/fmt/pull/2476,
-    https://github.com/fmtlib/fmt/issues/2478,
-    https://github.com/fmtlib/fmt/issues/2479,
-    https://github.com/fmtlib/fmt/issues/2481,
-    https://github.com/fmtlib/fmt/pull/2482,
-    https://github.com/fmtlib/fmt/pull/2483,
-    https://github.com/fmtlib/fmt/issues/2490,
-    https://github.com/fmtlib/fmt/pull/2491,
-    https://github.com/fmtlib/fmt/pull/2510,
-    https://github.com/fmtlib/fmt/pull/2518,
-    https://github.com/fmtlib/fmt/issues/2528,
-    https://github.com/fmtlib/fmt/pull/2529,
-    https://github.com/fmtlib/fmt/pull/2539,
-    https://github.com/fmtlib/fmt/issues/2540,
-    https://github.com/fmtlib/fmt/pull/2545,
-    https://github.com/fmtlib/fmt/pull/2555,
-    https://github.com/fmtlib/fmt/issues/2557,
-    https://github.com/fmtlib/fmt/issues/2570,
-    https://github.com/fmtlib/fmt/pull/2573,
-    https://github.com/fmtlib/fmt/pull/2582,
-    https://github.com/fmtlib/fmt/issues/2605,
-    https://github.com/fmtlib/fmt/pull/2611,
-    https://github.com/fmtlib/fmt/pull/2647,
-    https://github.com/fmtlib/fmt/issues/2627,
-    https://github.com/fmtlib/fmt/pull/2630,
-    https://github.com/fmtlib/fmt/issues/2635,
-    https://github.com/fmtlib/fmt/issues/2638,
-    https://github.com/fmtlib/fmt/issues/2653,
-    https://github.com/fmtlib/fmt/issues/2654,
-    https://github.com/fmtlib/fmt/issues/2661,
-    https://github.com/fmtlib/fmt/pull/2664,
-    https://github.com/fmtlib/fmt/pull/2684).
-    Thanks @DanielaE, @mwinterb, @cdacamar, @TrebledJ, @bodomartin, @cquammen,
-    @white238, @mmarkeloff, @palacaze, @jcelerier, @mborn-adi, @BrukerJWD,
-    @spyridon97, @phprus, @oliverlee, @joshessman-llnl, @akohlmey, @timkalu,
-    @olupton, @Acretock, @alexezeder, @andrewcorrigan, @lucpelletier and
-    @HazardyKnusperkeks.
+- Added missing diagnostic when trying to format function and member
+  pointers as well as objects convertible to pointers which is
+  explicitly disallowed
+  (https://github.com/fmtlib/fmt/issues/2598,
+  https://github.com/fmtlib/fmt/pull/2609,
+  https://github.com/fmtlib/fmt/pull/2610). Thanks @AlexGuteniev.
+
+- Optimized writing to a contiguous buffer with `format_to_n`
+  (https://github.com/fmtlib/fmt/pull/2489). Thanks @Roman-Koshelev.
+
+- Optimized writing to non-`char` buffers
+  (https://github.com/fmtlib/fmt/pull/2477). Thanks @Roman-Koshelev.
+
+- Decimal point is now localized when using the `L` specifier.
+
+- Improved floating point formatter implementation
+  (https://github.com/fmtlib/fmt/pull/2498,
+  https://github.com/fmtlib/fmt/pull/2499). Thanks @Roman-Koshelev.
+
+- Fixed handling of very large precision in fixed format
+  (https://github.com/fmtlib/fmt/pull/2616).
+
+- Made a table of cached powers used in FP formatting static
+  (https://github.com/fmtlib/fmt/pull/2509). Thanks @jk-jeon.
+
+- Resolved a lookup ambiguity with C++20 format-related functions due
+  to ADL (https://github.com/fmtlib/fmt/issues/2639,
+  https://github.com/fmtlib/fmt/pull/2641). Thanks @mkurdej.
+
+- Removed unnecessary inline namespace qualification
+  (https://github.com/fmtlib/fmt/issues/2642,
+  https://github.com/fmtlib/fmt/pull/2643). Thanks @mkurdej.
+
+- Implemented argument forwarding in `format_to_n`
+  (https://github.com/fmtlib/fmt/issues/2462,
+  https://github.com/fmtlib/fmt/pull/2463). Thanks @owent.
+
+- Fixed handling of implicit conversions in `fmt::to_string` and
+  format string compilation
+  (https://github.com/fmtlib/fmt/issues/2565).
+
+- Changed the default access mode of files created by
+  `fmt::output_file` to `-rw-r--r--` for consistency with `fopen`
+  (https://github.com/fmtlib/fmt/issues/2530).
+
+- Make `fmt::ostream::flush` public
+  (https://github.com/fmtlib/fmt/issues/2435).
+
+- Improved C++14/17 attribute detection
+  (https://github.com/fmtlib/fmt/pull/2615). Thanks @AlexGuteniev.
+
+- Improved `consteval` detection for MSVC
+  (https://github.com/fmtlib/fmt/pull/2559). Thanks @DanielaE.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/2406,
+  https://github.com/fmtlib/fmt/pull/2446,
+  https://github.com/fmtlib/fmt/issues/2493,
+  https://github.com/fmtlib/fmt/issues/2513,
+  https://github.com/fmtlib/fmt/pull/2515,
+  https://github.com/fmtlib/fmt/issues/2522,
+  https://github.com/fmtlib/fmt/pull/2562,
+  https://github.com/fmtlib/fmt/pull/2575,
+  https://github.com/fmtlib/fmt/pull/2606,
+  https://github.com/fmtlib/fmt/pull/2620,
+  https://github.com/fmtlib/fmt/issues/2676).
+  Thanks @sobolevn, @UnePierre, @zhsj, @phprus, @ericcurtin and @Lounarok.
+
+- Improved fuzzers and added a fuzzer for chrono timepoint formatting
+  (https://github.com/fmtlib/fmt/pull/2461,
+  https://github.com/fmtlib/fmt/pull/2469). @pauldreik,
+
+- Added the `FMT_SYSTEM_HEADERS` CMake option setting which marks
+  {fmt}\'s headers as system. It can be used to suppress warnings
+  (https://github.com/fmtlib/fmt/issues/2644,
+  https://github.com/fmtlib/fmt/pull/2651). Thanks @alexezeder.
+
+- Added the Bazel build system support
+  (https://github.com/fmtlib/fmt/pull/2505,
+  https://github.com/fmtlib/fmt/pull/2516). Thanks @Vertexwahn.
+
+- Improved build configuration and tests
+  (https://github.com/fmtlib/fmt/issues/2437,
+  https://github.com/fmtlib/fmt/pull/2558,
+  https://github.com/fmtlib/fmt/pull/2648,
+  https://github.com/fmtlib/fmt/pull/2650,
+  https://github.com/fmtlib/fmt/pull/2663,
+  https://github.com/fmtlib/fmt/pull/2677).
+  Thanks @DanielaE, @alexezeder and @phprus.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/pull/2353,
+  https://github.com/fmtlib/fmt/pull/2356,
+  https://github.com/fmtlib/fmt/pull/2399,
+  https://github.com/fmtlib/fmt/issues/2408,
+  https://github.com/fmtlib/fmt/pull/2414,
+  https://github.com/fmtlib/fmt/pull/2427,
+  https://github.com/fmtlib/fmt/pull/2432,
+  https://github.com/fmtlib/fmt/pull/2442,
+  https://github.com/fmtlib/fmt/pull/2434,
+  https://github.com/fmtlib/fmt/issues/2439,
+  https://github.com/fmtlib/fmt/pull/2447,
+  https://github.com/fmtlib/fmt/pull/2450,
+  https://github.com/fmtlib/fmt/issues/2455,
+  https://github.com/fmtlib/fmt/issues/2465,
+  https://github.com/fmtlib/fmt/issues/2472,
+  https://github.com/fmtlib/fmt/issues/2474,
+  https://github.com/fmtlib/fmt/pull/2476,
+  https://github.com/fmtlib/fmt/issues/2478,
+  https://github.com/fmtlib/fmt/issues/2479,
+  https://github.com/fmtlib/fmt/issues/2481,
+  https://github.com/fmtlib/fmt/pull/2482,
+  https://github.com/fmtlib/fmt/pull/2483,
+  https://github.com/fmtlib/fmt/issues/2490,
+  https://github.com/fmtlib/fmt/pull/2491,
+  https://github.com/fmtlib/fmt/pull/2510,
+  https://github.com/fmtlib/fmt/pull/2518,
+  https://github.com/fmtlib/fmt/issues/2528,
+  https://github.com/fmtlib/fmt/pull/2529,
+  https://github.com/fmtlib/fmt/pull/2539,
+  https://github.com/fmtlib/fmt/issues/2540,
+  https://github.com/fmtlib/fmt/pull/2545,
+  https://github.com/fmtlib/fmt/pull/2555,
+  https://github.com/fmtlib/fmt/issues/2557,
+  https://github.com/fmtlib/fmt/issues/2570,
+  https://github.com/fmtlib/fmt/pull/2573,
+  https://github.com/fmtlib/fmt/pull/2582,
+  https://github.com/fmtlib/fmt/issues/2605,
+  https://github.com/fmtlib/fmt/pull/2611,
+  https://github.com/fmtlib/fmt/pull/2647,
+  https://github.com/fmtlib/fmt/issues/2627,
+  https://github.com/fmtlib/fmt/pull/2630,
+  https://github.com/fmtlib/fmt/issues/2635,
+  https://github.com/fmtlib/fmt/issues/2638,
+  https://github.com/fmtlib/fmt/issues/2653,
+  https://github.com/fmtlib/fmt/issues/2654,
+  https://github.com/fmtlib/fmt/issues/2661,
+  https://github.com/fmtlib/fmt/pull/2664,
+  https://github.com/fmtlib/fmt/pull/2684).
+  Thanks @DanielaE, @mwinterb, @cdacamar, @TrebledJ, @bodomartin, @cquammen,
+  @white238, @mmarkeloff, @palacaze, @jcelerier, @mborn-adi, @BrukerJWD,
+  @spyridon97, @phprus, @oliverlee, @joshessman-llnl, @akohlmey, @timkalu,
+  @olupton, @Acretock, @alexezeder, @andrewcorrigan, @lucpelletier and
+  @HazardyKnusperkeks.
 
 # 8.0.1 - 2021-07-02
 
--   Fixed the version number in the inline namespace
-    (https://github.com/fmtlib/fmt/issues/2374).
--   Added a missing presentation type check for `std::string`
-    (https://github.com/fmtlib/fmt/issues/2402).
--   Fixed a linkage error when mixing code built with clang and gcc
-    (https://github.com/fmtlib/fmt/issues/2377).
--   Fixed documentation issues
-    (https://github.com/fmtlib/fmt/pull/2396,
-    https://github.com/fmtlib/fmt/issues/2403,
-    https://github.com/fmtlib/fmt/issues/2406). Thanks @mkurdej.
--   Removed dead code in FP formatter (
-    https://github.com/fmtlib/fmt/pull/2398). Thanks @javierhonduco.
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/issues/2351,
-    https://github.com/fmtlib/fmt/issues/2359,
-    https://github.com/fmtlib/fmt/pull/2365,
-    https://github.com/fmtlib/fmt/issues/2368,
-    https://github.com/fmtlib/fmt/pull/2370,
-    https://github.com/fmtlib/fmt/pull/2376,
-    https://github.com/fmtlib/fmt/pull/2381,
-    https://github.com/fmtlib/fmt/pull/2382,
-    https://github.com/fmtlib/fmt/issues/2386,
-    https://github.com/fmtlib/fmt/pull/2389,
-    https://github.com/fmtlib/fmt/pull/2395,
-    https://github.com/fmtlib/fmt/pull/2397,
-    https://github.com/fmtlib/fmt/issues/2400,
-    https://github.com/fmtlib/fmt/issues/2401,
-    https://github.com/fmtlib/fmt/pull/2407).
-    Thanks @zx2c4, @AidanSun05, @mattiasljungstrom, @joemmett, @erengy,
-    @patlkli, @gsjaardema and @phprus.
+- Fixed the version number in the inline namespace
+  (https://github.com/fmtlib/fmt/issues/2374).
+- Added a missing presentation type check for `std::string`
+  (https://github.com/fmtlib/fmt/issues/2402).
+- Fixed a linkage error when mixing code built with clang and gcc
+  (https://github.com/fmtlib/fmt/issues/2377).
+- Fixed documentation issues
+  (https://github.com/fmtlib/fmt/pull/2396,
+  https://github.com/fmtlib/fmt/issues/2403,
+  https://github.com/fmtlib/fmt/issues/2406). Thanks @mkurdej.
+- Removed dead code in FP formatter (
+  https://github.com/fmtlib/fmt/pull/2398). Thanks @javierhonduco.
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/issues/2351,
+  https://github.com/fmtlib/fmt/issues/2359,
+  https://github.com/fmtlib/fmt/pull/2365,
+  https://github.com/fmtlib/fmt/issues/2368,
+  https://github.com/fmtlib/fmt/pull/2370,
+  https://github.com/fmtlib/fmt/pull/2376,
+  https://github.com/fmtlib/fmt/pull/2381,
+  https://github.com/fmtlib/fmt/pull/2382,
+  https://github.com/fmtlib/fmt/issues/2386,
+  https://github.com/fmtlib/fmt/pull/2389,
+  https://github.com/fmtlib/fmt/pull/2395,
+  https://github.com/fmtlib/fmt/pull/2397,
+  https://github.com/fmtlib/fmt/issues/2400,
+  https://github.com/fmtlib/fmt/issues/2401,
+  https://github.com/fmtlib/fmt/pull/2407).
+  Thanks @zx2c4, @AidanSun05, @mattiasljungstrom, @joemmett, @erengy,
+  @patlkli, @gsjaardema and @phprus.
 
 # 8.0.0 - 2021-06-21
 
--   Enabled compile-time format string checks by default. For example
-    ([godbolt](https://godbolt.org/z/sMxcohGjz)):
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("{:d}", "I am not a number");
-    }
-    ```
-
-    gives a compile-time error on compilers with C++20 `consteval`
-    support (gcc 10+, clang 11+) because `d` is not a valid format
-    specifier for a string.
-
-    To pass a runtime string wrap it in `fmt::runtime`:
-
-    ```c++
-    fmt::print(fmt::runtime("{:d}"), "I am not a number");
-    ```
-
--   Added compile-time formatting
-    (https://github.com/fmtlib/fmt/pull/2019,
-    https://github.com/fmtlib/fmt/pull/2044,
-    https://github.com/fmtlib/fmt/pull/2056,
-    https://github.com/fmtlib/fmt/pull/2072,
-    https://github.com/fmtlib/fmt/pull/2075,
-    https://github.com/fmtlib/fmt/issues/2078,
-    https://github.com/fmtlib/fmt/pull/2129,
-    https://github.com/fmtlib/fmt/pull/2326). For example
-    ([godbolt](https://godbolt.org/z/Mxx9d89jM)):
-
-    ```c++
-    #include <fmt/compile.h>
-
-    consteval auto compile_time_itoa(int value) -> std::array<char, 10> {
-      auto result = std::array<char, 10>();
-      fmt::format_to(result.data(), FMT_COMPILE("{}"), value);
-      return result;
-    }
-
-    constexpr auto answer = compile_time_itoa(42);
-    ```
-
-    Most of the formatting functionality is available at compile time
-    with a notable exception of floating-point numbers and pointers.
-    Thanks @alexezeder.
-
--   Optimized handling of format specifiers during format string
-    compilation. For example, hexadecimal formatting (`"{:x}"`) is now
-    3-7x faster than before when using `format_to` with format string
-    compilation and a stack-allocated buffer
-    (https://github.com/fmtlib/fmt/issues/1944).
-
-    Before (7.1.3):
-
-        ----------------------------------------------------------------------------
-        Benchmark                                  Time             CPU   Iterations
-        ----------------------------------------------------------------------------
-        FMTCompileOld/0                         15.5 ns         15.5 ns     43302898
-        FMTCompileOld/42                        16.6 ns         16.6 ns     43278267
-        FMTCompileOld/273123                    18.7 ns         18.6 ns     37035861
-        FMTCompileOld/9223372036854775807       19.4 ns         19.4 ns     35243000
-        ----------------------------------------------------------------------------
-
-    After (8.x):
-
-        ----------------------------------------------------------------------------
-        Benchmark                                  Time             CPU   Iterations
-        ----------------------------------------------------------------------------
-        FMTCompileNew/0                         1.99 ns         1.99 ns    360523686
-        FMTCompileNew/42                        2.33 ns         2.33 ns    279865664
-        FMTCompileNew/273123                    3.72 ns         3.71 ns    190230315
-        FMTCompileNew/9223372036854775807       5.28 ns         5.26 ns    130711631
-        ----------------------------------------------------------------------------
-
-    It is even faster than `std::to_chars` from libc++ compiled with
-    clang on macOS:
-
-        ----------------------------------------------------------------------------
-        Benchmark                                  Time             CPU   Iterations
-        ----------------------------------------------------------------------------
-        ToChars/0                               4.42 ns         4.41 ns    160196630
-        ToChars/42                              5.00 ns         4.98 ns    140735201
-        ToChars/273123                          7.26 ns         7.24 ns     95784130
-        ToChars/9223372036854775807             8.77 ns         8.75 ns     75872534
-        ----------------------------------------------------------------------------
-
-    In other cases, especially involving `std::string` construction, the
-    speed up is usually lower because handling format specifiers takes a
-    smaller fraction of the total time.
-
--   Added the `_cf` user-defined literal to represent a compiled format
-    string. It can be used instead of the `FMT_COMPILE` macro
-    (https://github.com/fmtlib/fmt/pull/2043,
-    https://github.com/fmtlib/fmt/pull/2242):
-
-    ```c++
-    #include <fmt/compile.h>
-
-    using namespace fmt::literals;
-    auto s = fmt::format(FMT_COMPILE("{}"), 42); //  not modern
-    auto s = fmt::format("{}"_cf, 42);           //  modern as hell
-    ```
-
-    It requires compiler support for class types in non-type template
-    parameters (a C++20 feature) which is available in GCC 9.3+.
-    Thanks @alexezeder.
-
--   Format string compilation now requires `format` functions of
-    `formatter` specializations for user-defined types to be `const`:
-
-    ```c++
-    template <> struct fmt::formatter<my_type>: formatter<string_view> {
-      template <typename FormatContext>
-      auto format(my_type obj, FormatContext& ctx) const {  // Note const here.
-        // ...
-      }
-    };
-    ```
-
--   Added UDL-based named argument support to format string compilation
-    (https://github.com/fmtlib/fmt/pull/2243,
-    https://github.com/fmtlib/fmt/pull/2281). For example:
-
-    ```c++
-    #include <fmt/compile.h>
-
-    using namespace fmt::literals;
-    auto s = fmt::format(FMT_COMPILE("{answer}"), "answer"_a = 42);
-    ```
-
-    Here the argument named \"answer\" is resolved at compile time with
-    no runtime overhead. Thanks @alexezeder.
-
--   Added format string compilation support to `fmt::print`
-    (https://github.com/fmtlib/fmt/issues/2280,
-    https://github.com/fmtlib/fmt/pull/2304). Thanks @alexezeder.
-
--   Added initial support for compiling {fmt} as a C++20 module
-    (https://github.com/fmtlib/fmt/pull/2235,
-    https://github.com/fmtlib/fmt/pull/2240,
-    https://github.com/fmtlib/fmt/pull/2260,
-    https://github.com/fmtlib/fmt/pull/2282,
-    https://github.com/fmtlib/fmt/pull/2283,
-    https://github.com/fmtlib/fmt/pull/2288,
-    https://github.com/fmtlib/fmt/pull/2298,
-    https://github.com/fmtlib/fmt/pull/2306,
-    https://github.com/fmtlib/fmt/pull/2307,
-    https://github.com/fmtlib/fmt/pull/2309,
-    https://github.com/fmtlib/fmt/pull/2318,
-    https://github.com/fmtlib/fmt/pull/2324,
-    https://github.com/fmtlib/fmt/pull/2332,
-    https://github.com/fmtlib/fmt/pull/2340). Thanks @DanielaE.
-
--   Made symbols private by default reducing shared library size
-    (https://github.com/fmtlib/fmt/pull/2301). For example
-    there was a \~15% reported reduction on one platform. Thanks @sergiud.
-
--   Optimized includes making the result of preprocessing `fmt/format.h`
-    \~20% smaller with libstdc++/C++20 and slightly improving build
-    times (https://github.com/fmtlib/fmt/issues/1998).
-
--   Added support of ranges with non-const `begin` / `end`
-    (https://github.com/fmtlib/fmt/pull/1953). Thanks @kitegi.
-
--   Added support of `std::byte` and other formattable types to
-    `fmt::join` (https://github.com/fmtlib/fmt/issues/1981,
-    https://github.com/fmtlib/fmt/issues/2040,
-    https://github.com/fmtlib/fmt/pull/2050,
-    https://github.com/fmtlib/fmt/issues/2262). For example:
-
-    ```c++
-    #include <fmt/format.h>
-    #include <cstddef>
-    #include <vector>
-
-    int main() {
-      auto bytes = std::vector{std::byte(4), std::byte(2)};
-      fmt::print("{}", fmt::join(bytes, ""));
-    }
-    ```
-
-    prints \"42\".
-
-    Thanks @kamibo.
-
--   Implemented the default format for `std::chrono::system_clock`
-    (https://github.com/fmtlib/fmt/issues/2319,
-    https://github.com/fmtlib/fmt/pull/2345). For example:
-
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      fmt::print("{}", std::chrono::system_clock::now());
-    }
-    ```
-
-    prints \"2021-06-18 15:22:00\" (the output depends on the current
-    date and time). Thanks @sunmy2019.
-
--   Made more chrono specifiers locale independent by default. Use the
-    `'L'` specifier to get localized formatting. For example:
-
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      std::locale::global(std::locale("ru_RU.UTF-8"));
-      auto monday = std::chrono::weekday(1);
-      fmt::print("{}\n", monday);   // prints "Mon"
-      fmt::print("{:L}\n", monday); // prints ""
-    }
-    ```
-
--   Improved locale handling in chrono formatting
-    (https://github.com/fmtlib/fmt/issues/2337,
-    https://github.com/fmtlib/fmt/pull/2349,
-    https://github.com/fmtlib/fmt/pull/2350). Thanks @phprus.
-
--   Deprecated `fmt/locale.h` moving the formatting functions that take
-    a locale to `fmt/format.h` (`char`) and `fmt/xchar` (other
-    overloads). This doesn\'t introduce a dependency on `<locale>` so
-    there is virtually no compile time effect.
-
--   Deprecated an undocumented `format_to` overload that takes
-    `basic_memory_buffer`.
-
--   Made parameter order in `vformat_to` consistent with `format_to`
-    (https://github.com/fmtlib/fmt/issues/2327).
-
--   Added support for time points with arbitrary durations
-    (https://github.com/fmtlib/fmt/issues/2208). For example:
-
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      using tp = std::chrono::time_point<
-        std::chrono::system_clock, std::chrono::seconds>;
-      fmt::print("{:%S}", tp(std::chrono::seconds(42)));
-    }
-    ```
-
-    prints \"42\".
-
--   Formatting floating-point numbers no longer produces trailing zeros
-    by default for consistency with `std::format`. For example:
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("{0:.3}", 1.1);
-    }
-    ```
-
-    prints \"1.1\". Use the `'#'` specifier to keep trailing zeros.
-
--   Dropped a limit on the number of elements in a range and replaced
-    `{}` with `[]` as range delimiters for consistency with Python\'s
-    `str.format`.
-
--   The `'L'` specifier for locale-specific numeric formatting can now
-    be combined with presentation specifiers as in `std::format`. For
-    example:
-
-    ```c++
-    #include <fmt/core.h>
-    #include <locale>
-
-    int main() {
-      std::locale::global(std::locale("fr_FR.UTF-8"));
-      fmt::print("{0:.2Lf}", 0.42);
-    }
-    ```
-
-    prints \"0,42\". The deprecated `'n'` specifier has been removed.
-
--   Made the `0` specifier ignored for infinity and NaN
-    (https://github.com/fmtlib/fmt/issues/2305,
-    https://github.com/fmtlib/fmt/pull/2310). Thanks @Liedtke.
-
--   Made the hexfloat formatting use the right alignment by default
-    (https://github.com/fmtlib/fmt/issues/2308,
-    https://github.com/fmtlib/fmt/pull/2317). Thanks @Liedtke.
-
--   Removed the deprecated numeric alignment (`'='`). Use the `'0'`
-    specifier instead.
-
--   Removed the deprecated `fmt/posix.h` header that has been replaced
-    with `fmt/os.h`.
-
--   Removed the deprecated `format_to_n_context`, `format_to_n_args` and
-    `make_format_to_n_args`. They have been replaced with
-    `format_context`, `` format_args` and ``make_format_args\`\`
-    respectively.
-
--   Moved `wchar_t`-specific functions and types to `fmt/xchar.h`. You
-    can define `FMT_DEPRECATED_INCLUDE_XCHAR` to automatically include
-    `fmt/xchar.h` from `fmt/format.h` but this will be disabled in the
-    next major release.
-
--   Fixed handling of the `'+'` specifier in localized formatting
-    (https://github.com/fmtlib/fmt/issues/2133).
-
--   Added support for the `'s'` format specifier that gives textual
-    representation of `bool`
-    (https://github.com/fmtlib/fmt/issues/2094,
-    https://github.com/fmtlib/fmt/pull/2109). For example:
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("{:s}", true);
-    }
-    ```
-
-    prints \"true\". Thanks @powercoderlol.
-
--   Made `fmt::ptr` work with function pointers
-    (https://github.com/fmtlib/fmt/pull/2131). For example:
-
-    ```c++
-    #include <fmt/format.h>
-
-    int main() {
-      fmt::print("My main: {}\n", fmt::ptr(main));
-    }
-    ```
-
-    Thanks @mikecrowe.
-
--   The undocumented support for specializing `formatter` for pointer
-    types has been removed.
-
--   Fixed `fmt::formatted_size` with format string compilation
-    (https://github.com/fmtlib/fmt/pull/2141,
-    https://github.com/fmtlib/fmt/pull/2161). Thanks @alexezeder.
-
--   Fixed handling of empty format strings during format string
-    compilation (https://github.com/fmtlib/fmt/issues/2042):
-
-    ```c++
-    auto s = fmt::format(FMT_COMPILE(""));
-    ```
-
-    Thanks @alexezeder.
-
--   Fixed handling of enums in `fmt::to_string`
-    (https://github.com/fmtlib/fmt/issues/2036).
-
--   Improved width computation
-    (https://github.com/fmtlib/fmt/issues/2033,
-    https://github.com/fmtlib/fmt/issues/2091). For example:
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("{:-<10}{}\n", "", "");
-      fmt::print("{:-<10}{}\n", "hello", "world");
-    }
-    ```
-
-    prints
-
-    ![](https://user-images.githubusercontent.com/576385/119840373-cea3ca80-beb9-11eb-91e0-54266c48e181.png)
-
-    on a modern terminal.
-
--   The experimental fast output stream (`fmt::ostream`) is now
-    truncated by default for consistency with `fopen`
-    (https://github.com/fmtlib/fmt/issues/2018). For example:
-
-    ```c++
-    #include <fmt/os.h>
-
-    int main() {
-      fmt::ostream out1 = fmt::output_file("guide");
-      out1.print("Zaphod");
-      out1.close();
-      fmt::ostream out2 = fmt::output_file("guide");
-      out2.print("Ford");
-    }
-    ```
-
-    writes \"Ford\" to the file \"guide\". To preserve the old file
-    content if any pass `fmt::file::WRONLY | fmt::file::CREATE` flags to
-    `fmt::output_file`.
-
--   Fixed moving of `fmt::ostream` that holds buffered data
-    (https://github.com/fmtlib/fmt/issues/2197,
-    https://github.com/fmtlib/fmt/pull/2198). Thanks @vtta.
-
--   Replaced the `fmt::system_error` exception with a function of the
-    same name that constructs `std::system_error`
-    (https://github.com/fmtlib/fmt/issues/2266).
-
--   Replaced the `fmt::windows_error` exception with a function of the
-    same name that constructs `std::system_error` with the category
-    returned by `fmt::system_category()`
-    (https://github.com/fmtlib/fmt/issues/2274,
-    https://github.com/fmtlib/fmt/pull/2275). The latter is
-    similar to `std::sytem_category` but correctly handles UTF-8.
-    Thanks @phprus.
-
--   Replaced `fmt::error_code` with `std::error_code` and made it
-    formattable (https://github.com/fmtlib/fmt/issues/2269,
-    https://github.com/fmtlib/fmt/pull/2270,
-    https://github.com/fmtlib/fmt/pull/2273). Thanks @phprus.
-
--   Added speech synthesis support
-    (https://github.com/fmtlib/fmt/pull/2206).
-
--   Made `format_to` work with a memory buffer that has a custom
-    allocator (https://github.com/fmtlib/fmt/pull/2300).
-    Thanks @voxmea.
-
--   Added `Allocator::max_size` support to `basic_memory_buffer`.
-    (https://github.com/fmtlib/fmt/pull/1960). Thanks @phprus.
-
--   Added wide string support to `fmt::join`
-    (https://github.com/fmtlib/fmt/pull/2236). Thanks @crbrz.
-
--   Made iterators passed to `formatter` specializations via a format
-    context satisfy C++20 `std::output_iterator` requirements
-    (https://github.com/fmtlib/fmt/issues/2156,
-    https://github.com/fmtlib/fmt/pull/2158,
-    https://github.com/fmtlib/fmt/issues/2195,
-    https://github.com/fmtlib/fmt/pull/2204). Thanks @randomnetcat.
-
--   Optimized the `printf` implementation
-    (https://github.com/fmtlib/fmt/pull/1982,
-    https://github.com/fmtlib/fmt/pull/1984,
-    https://github.com/fmtlib/fmt/pull/2016,
-    https://github.com/fmtlib/fmt/pull/2164).
-    Thanks @rimathia and @moiwi.
-
--   Improved detection of `constexpr` `char_traits`
-    (https://github.com/fmtlib/fmt/pull/2246,
-    https://github.com/fmtlib/fmt/pull/2257). Thanks @phprus.
-
--   Fixed writing to `stdout` when it is redirected to `NUL` on Windows
-    (https://github.com/fmtlib/fmt/issues/2080).
-
--   Fixed exception propagation from iterators
-    (https://github.com/fmtlib/fmt/issues/2097).
-
--   Improved `strftime` error handling
-    (https://github.com/fmtlib/fmt/issues/2238,
-    https://github.com/fmtlib/fmt/pull/2244). Thanks @yumeyao.
-
--   Stopped using deprecated GCC UDL template extension.
-
--   Added `fmt/args.h` to the install target
-    (https://github.com/fmtlib/fmt/issues/2096).
-
--   Error messages are now passed to assert when exceptions are disabled
-    (https://github.com/fmtlib/fmt/pull/2145). Thanks @NobodyXu.
-
--   Added the `FMT_MASTER_PROJECT` CMake option to control build and
-    install targets when {fmt} is included via `add_subdirectory`
-    (https://github.com/fmtlib/fmt/issues/2098,
-    https://github.com/fmtlib/fmt/pull/2100).
-    Thanks @randomizedthinking.
-
--   Improved build configuration
-    (https://github.com/fmtlib/fmt/pull/2026,
-    https://github.com/fmtlib/fmt/pull/2122).
-    Thanks @luncliff and @ibaned.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/issues/1947,
-    https://github.com/fmtlib/fmt/pull/1959,
-    https://github.com/fmtlib/fmt/pull/1963,
-    https://github.com/fmtlib/fmt/pull/1965,
-    https://github.com/fmtlib/fmt/issues/1966,
-    https://github.com/fmtlib/fmt/pull/1974,
-    https://github.com/fmtlib/fmt/pull/1975,
-    https://github.com/fmtlib/fmt/pull/1990,
-    https://github.com/fmtlib/fmt/issues/2000,
-    https://github.com/fmtlib/fmt/pull/2001,
-    https://github.com/fmtlib/fmt/issues/2002,
-    https://github.com/fmtlib/fmt/issues/2004,
-    https://github.com/fmtlib/fmt/pull/2006,
-    https://github.com/fmtlib/fmt/pull/2009,
-    https://github.com/fmtlib/fmt/pull/2010,
-    https://github.com/fmtlib/fmt/issues/2038,
-    https://github.com/fmtlib/fmt/issues/2039,
-    https://github.com/fmtlib/fmt/issues/2047,
-    https://github.com/fmtlib/fmt/pull/2053,
-    https://github.com/fmtlib/fmt/issues/2059,
-    https://github.com/fmtlib/fmt/pull/2065,
-    https://github.com/fmtlib/fmt/pull/2067,
-    https://github.com/fmtlib/fmt/pull/2068,
-    https://github.com/fmtlib/fmt/pull/2073,
-    https://github.com/fmtlib/fmt/issues/2103,
-    https://github.com/fmtlib/fmt/issues/2105,
-    https://github.com/fmtlib/fmt/pull/2106,
-    https://github.com/fmtlib/fmt/pull/2107,
-    https://github.com/fmtlib/fmt/issues/2116,
-    https://github.com/fmtlib/fmt/pull/2117,
-    https://github.com/fmtlib/fmt/issues/2118,
-    https://github.com/fmtlib/fmt/pull/2119,
-    https://github.com/fmtlib/fmt/issues/2127,
-    https://github.com/fmtlib/fmt/pull/2128,
-    https://github.com/fmtlib/fmt/issues/2140,
-    https://github.com/fmtlib/fmt/issues/2142,
-    https://github.com/fmtlib/fmt/pull/2143,
-    https://github.com/fmtlib/fmt/pull/2144,
-    https://github.com/fmtlib/fmt/issues/2147,
-    https://github.com/fmtlib/fmt/issues/2148,
-    https://github.com/fmtlib/fmt/issues/2149,
-    https://github.com/fmtlib/fmt/pull/2152,
-    https://github.com/fmtlib/fmt/pull/2160,
-    https://github.com/fmtlib/fmt/issues/2170,
-    https://github.com/fmtlib/fmt/issues/2175,
-    https://github.com/fmtlib/fmt/issues/2176,
-    https://github.com/fmtlib/fmt/pull/2177,
-    https://github.com/fmtlib/fmt/issues/2178,
-    https://github.com/fmtlib/fmt/pull/2179,
-    https://github.com/fmtlib/fmt/issues/2180,
-    https://github.com/fmtlib/fmt/issues/2181,
-    https://github.com/fmtlib/fmt/pull/2183,
-    https://github.com/fmtlib/fmt/issues/2184,
-    https://github.com/fmtlib/fmt/issues/2185,
-    https://github.com/fmtlib/fmt/pull/2186,
-    https://github.com/fmtlib/fmt/pull/2187,
-    https://github.com/fmtlib/fmt/pull/2190,
-    https://github.com/fmtlib/fmt/pull/2192,
-    https://github.com/fmtlib/fmt/pull/2194,
-    https://github.com/fmtlib/fmt/pull/2205,
-    https://github.com/fmtlib/fmt/issues/2210,
-    https://github.com/fmtlib/fmt/pull/2211,
-    https://github.com/fmtlib/fmt/pull/2215,
-    https://github.com/fmtlib/fmt/pull/2216,
-    https://github.com/fmtlib/fmt/pull/2218,
-    https://github.com/fmtlib/fmt/pull/2220,
-    https://github.com/fmtlib/fmt/issues/2228,
-    https://github.com/fmtlib/fmt/pull/2229,
-    https://github.com/fmtlib/fmt/pull/2230,
-    https://github.com/fmtlib/fmt/issues/2233,
-    https://github.com/fmtlib/fmt/pull/2239,
-    https://github.com/fmtlib/fmt/issues/2248,
-    https://github.com/fmtlib/fmt/issues/2252,
-    https://github.com/fmtlib/fmt/pull/2253,
-    https://github.com/fmtlib/fmt/pull/2255,
-    https://github.com/fmtlib/fmt/issues/2261,
-    https://github.com/fmtlib/fmt/issues/2278,
-    https://github.com/fmtlib/fmt/issues/2284,
-    https://github.com/fmtlib/fmt/pull/2287,
-    https://github.com/fmtlib/fmt/pull/2289,
-    https://github.com/fmtlib/fmt/pull/2290,
-    https://github.com/fmtlib/fmt/pull/2293,
-    https://github.com/fmtlib/fmt/issues/2295,
-    https://github.com/fmtlib/fmt/pull/2296,
-    https://github.com/fmtlib/fmt/pull/2297,
-    https://github.com/fmtlib/fmt/issues/2311,
-    https://github.com/fmtlib/fmt/pull/2313,
-    https://github.com/fmtlib/fmt/pull/2315,
-    https://github.com/fmtlib/fmt/issues/2320,
-    https://github.com/fmtlib/fmt/pull/2321,
-    https://github.com/fmtlib/fmt/pull/2323,
-    https://github.com/fmtlib/fmt/issues/2328,
-    https://github.com/fmtlib/fmt/pull/2329,
-    https://github.com/fmtlib/fmt/pull/2333,
-    https://github.com/fmtlib/fmt/pull/2338,
-    https://github.com/fmtlib/fmt/pull/2341).
-    Thanks @darklukee, @fagg, @killerbot242, @jgopel, @yeswalrus, @Finkman,
-    @HazardyKnusperkeks, @dkavolis, @concatime, @chronoxor, @summivox, @yNeo,
-    @Apache-HB, @alexezeder, @toojays, @Brainy0207, @vadz, @imsherlock, @phprus,
-    @white238, @yafshar, @BillyDonahue, @jstaahl, @denchat, @DanielaE,
-    @ilyakurdyukov, @ilmai, @JessyDL, @sergiud, @mwinterb, @sven-herrmann,
-    @jmelas, @twoixter, @crbrz and @upsj.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/1986,
-    https://github.com/fmtlib/fmt/pull/2051,
-    https://github.com/fmtlib/fmt/issues/2057,
-    https://github.com/fmtlib/fmt/pull/2081,
-    https://github.com/fmtlib/fmt/issues/2084,
-    https://github.com/fmtlib/fmt/pull/2312).
-    Thanks @imba-tjd, @0x416c69 and @mordante.
-
--   Continuous integration and test improvements
-    (https://github.com/fmtlib/fmt/issues/1969,
-    https://github.com/fmtlib/fmt/pull/1991,
-    https://github.com/fmtlib/fmt/pull/2020,
-    https://github.com/fmtlib/fmt/pull/2110,
-    https://github.com/fmtlib/fmt/pull/2114,
-    https://github.com/fmtlib/fmt/issues/2196,
-    https://github.com/fmtlib/fmt/pull/2217,
-    https://github.com/fmtlib/fmt/pull/2247,
-    https://github.com/fmtlib/fmt/pull/2256,
-    https://github.com/fmtlib/fmt/pull/2336,
-    https://github.com/fmtlib/fmt/pull/2346).
-    Thanks @jgopel, @alexezeder and @DanielaE.
-
-# 7.1.3 - 2020-11-24
-
--   Fixed handling of buffer boundaries in `format_to_n`
-    (https://github.com/fmtlib/fmt/issues/1996,
-    https://github.com/fmtlib/fmt/issues/2029).
--   Fixed linkage errors when linking with a shared library
-    (https://github.com/fmtlib/fmt/issues/2011).
--   Reintroduced ostream support to range formatters
-    (https://github.com/fmtlib/fmt/issues/2014).
--   Worked around an issue with mixing std versions in gcc
-    (https://github.com/fmtlib/fmt/issues/2017).
-
-# 7.1.2 - 2020-11-04
-
--   Fixed floating point formatting with large precision
-    (https://github.com/fmtlib/fmt/issues/1976).
-
-# 7.1.1 - 2020-11-01
-
--   Fixed ABI compatibility with 7.0.x
-    (https://github.com/fmtlib/fmt/issues/1961).
--   Added the `FMT_ARM_ABI_COMPATIBILITY` macro to work around ABI
-    incompatibility between GCC and Clang on ARM
-    (https://github.com/fmtlib/fmt/issues/1919).
--   Worked around a SFINAE bug in GCC 8
-    (https://github.com/fmtlib/fmt/issues/1957).
--   Fixed linkage errors when building with GCC\'s LTO
-    (https://github.com/fmtlib/fmt/issues/1955).
--   Fixed a compilation error when building without `__builtin_clz` or
-    equivalent (https://github.com/fmtlib/fmt/pull/1968).
-    Thanks @tohammer.
--   Fixed a sign conversion warning
-    (https://github.com/fmtlib/fmt/pull/1964). Thanks @OptoCloud.
-
-# 7.1.0 - 2020-10-25
-
--   Switched from
-    [Grisu3](https://www.cs.tufts.edu/~nr/cs257/archive/florian-loitsch/printf.pdf)
-    to [Dragonbox](https://github.com/jk-jeon/dragonbox) for the default
-    floating-point formatting which gives the shortest decimal
-    representation with round-trip guarantee and correct rounding
-    (https://github.com/fmtlib/fmt/pull/1882,
-    https://github.com/fmtlib/fmt/pull/1887,
-    https://github.com/fmtlib/fmt/pull/1894). This makes {fmt}
-    up to 20-30x faster than common implementations of
-    `std::ostringstream` and `sprintf` on
-    [dtoa-benchmark](https://github.com/fmtlib/dtoa-benchmark) and
-    faster than double-conversion and Ry:
-
-    ![](https://user-images.githubusercontent.com/576385/95684665-11719600-0ba8-11eb-8e5b-972ff4e49428.png)
-
-    It is possible to get even better performance at the cost of larger
-    binary size by compiling with the `FMT_USE_FULL_CACHE_DRAGONBOX`
-    macro set to 1.
-
-    Thanks @jk-jeon.
-
--   Added an experimental unsynchronized file output API which, together
-    with [format string
-    compilation](https://fmt.dev/latest/api.html#compile-api), can give
-    [5-9 times speed up compared to
-    fprintf](https://www.zverovich.net/2020/08/04/optimal-file-buffer-size.html)
-    on common platforms ([godbolt](https://godbolt.org/z/nsTcG8)):
-
-    ```c++
-    #include <fmt/os.h>
-
-    int main() {
-      auto f = fmt::output_file("guide");
-      f.print("The answer is {}.", 42);
-    }
-    ```
-
--   Added a formatter for `std::chrono::time_point<system_clock>`
-    (https://github.com/fmtlib/fmt/issues/1819,
-    https://github.com/fmtlib/fmt/pull/1837). For example
-    ([godbolt](https://godbolt.org/z/c4M6fh)):
-
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      auto now = std::chrono::system_clock::now();
-      fmt::print("The time is {:%H:%M:%S}.\n", now);
-    }
-    ```
-
-    Thanks @adamburgess.
-
--   Added support for ranges with non-const `begin`/`end` to `fmt::join`
-    (https://github.com/fmtlib/fmt/issues/1784,
-    https://github.com/fmtlib/fmt/pull/1786). For example
-    ([godbolt](https://godbolt.org/z/jP63Tv)):
-
-    ```c++
-    #include <fmt/ranges.h>
-    #include <range/v3/view/filter.hpp>
-
-    int main() {
-      using std::literals::string_literals::operator""s;
-      auto strs = std::array{"a"s, "bb"s, "ccc"s};
-      auto range = strs | ranges::views::filter(
-        [] (const std::string &x) { return x.size() != 2; }
-      );
-      fmt::print("{}\n", fmt::join(range, ""));
-    }
-    ```
-
-    prints \"accc\".
-
-    Thanks @tonyelewis.
-
--   Added a `memory_buffer::append` overload that takes a range
-    (https://github.com/fmtlib/fmt/pull/1806). Thanks @BRevzin.
-
--   Improved handling of single code units in `FMT_COMPILE`. For
-    example:
-
-    ```c++
-    #include <fmt/compile.h>
-
-    char* f(char* buf) {
-      return fmt::format_to(buf, FMT_COMPILE("x{}"), 42);
-    }
-    ```
-
-    compiles to just ([godbolt](https://godbolt.org/z/5vncz3)):
-
-    ```asm
-    _Z1fPc:
-      movb $120, (%rdi)
-      xorl %edx, %edx
-      cmpl $42, _ZN3fmt2v76detail10basic_dataIvE23zero_or_powers_of_10_32E+8(%rip)
-      movl $3, %eax
-      seta %dl
-      subl %edx, %eax
-      movzwl _ZN3fmt2v76detail10basic_dataIvE6digitsE+84(%rip), %edx
-      cltq
-      addq %rdi, %rax
-      movw %dx, -2(%rax)
-      ret
-    ```
-
-    Here a single `mov` instruction writes `'x'` (`$120`) to the output
-    buffer.
-
--   Added dynamic width support to format string compilation
-    (https://github.com/fmtlib/fmt/issues/1809).
-
--   Improved error reporting for unformattable types: now you\'ll get
-    the type name directly in the error message instead of the note:
-
-    ```c++
-    #include <fmt/core.h>
-
-    struct how_about_no {};
-
-    int main() {
-      fmt::print("{}", how_about_no());
-    }
-    ```
-
-    Error ([godbolt](https://godbolt.org/z/GoxM4e)):
-
-    `fmt/core.h:1438:3: error: static_assert failed due to requirement 'fmt::v7::formattable<how_about_no>()' "Cannot format an argument. To make type T formattable provide a formatter<T> specialization: https://fmt.dev/latest/api.html#udt" ...`
-
--   Added the
-    [make_args_checked](https://fmt.dev/7.1.0/api.html#argument-lists)
-    function template that allows you to write formatting functions with
-    compile-time format string checks and avoid binary code bloat
-    ([godbolt](https://godbolt.org/z/PEf9qr)):
-
-    ```c++
-    void vlog(const char* file, int line, fmt::string_view format,
-              fmt::format_args args) {
-      fmt::print("{}: {}: ", file, line);
-      fmt::vprint(format, args);
-    }
-
-    template <typename S, typename... Args>
-    void log(const char* file, int line, const S& format, Args&&... args) {
-      vlog(file, line, format,
-          fmt::make_args_checked<Args...>(format, args...));
-    }
-
-    #define MY_LOG(format, ...) \
-      log(__FILE__, __LINE__, FMT_STRING(format), __VA_ARGS__)
-
-    MY_LOG("invalid squishiness: {}", 42);
-    ```
-
--   Replaced `snprintf` fallback with a faster internal IEEE 754 `float`
-    and `double` formatter for arbitrary precision. For example
-    ([godbolt](https://godbolt.org/z/dPhWvj)):
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("{:.500}\n", 4.9406564584124654E-324);
-    }
-    ```
-
-    prints
-
-    `4.9406564584124654417656879286822137236505980261432476442558568250067550727020875186529983636163599237979656469544571773092665671035593979639877479601078187812630071319031140452784581716784898210368871863605699873072305000638740915356498438731247339727316961514003171538539807412623856559117102665855668676818703956031062493194527159149245532930545654440112748012970999954193198940908041656332452475714786901472678015935523861155013480352649347201937902681071074917033322268447533357208324319360923829e-324`.
-
--   Made `format_to_n` and `formatted_size` part of the [core
-    API](https://fmt.dev/latest/api.html#core-api)
-    ([godbolt](https://godbolt.org/z/sPjY1K)):
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      char buffer[10];
-      auto result = fmt::format_to_n(buffer, sizeof(buffer), "{}", 42);
-    }
-    ```
-
--   Added `fmt::format_to_n` overload with format string compilation
-    (https://github.com/fmtlib/fmt/issues/1764,
-    https://github.com/fmtlib/fmt/pull/1767,
-    https://github.com/fmtlib/fmt/pull/1869). For example
-    ([godbolt](https://godbolt.org/z/93h86q)):
-
-    ```c++
-    #include <fmt/compile.h>
-
-    int main() {
-      char buffer[8];
-      fmt::format_to_n(buffer, sizeof(buffer), FMT_COMPILE("{}"), 42);
-    }
-    ```
-
-    Thanks @Kurkin and @alexezeder.
-
--   Added `fmt::format_to` overload that take `text_style`
-    (https://github.com/fmtlib/fmt/issues/1593,
-    https://github.com/fmtlib/fmt/issues/1842,
-    https://github.com/fmtlib/fmt/pull/1843). For example
-    ([godbolt](https://godbolt.org/z/91153r)):
-
-    ```c++
-    #include <fmt/color.h>
-
-    int main() {
-      std::string out;
-      fmt::format_to(std::back_inserter(out),
-                     fmt::emphasis::bold | fg(fmt::color::red),
-                     "The answer is {}.", 42);
-    }
-    ```
-
-    Thanks @Naios.
-
--   Made the `'#'` specifier emit trailing zeros in addition to the
-    decimal point (https://github.com/fmtlib/fmt/issues/1797).
-    For example ([godbolt](https://godbolt.org/z/bhdcW9)):
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("{:#.2g}", 0.5);
-    }
-    ```
-
-    prints `0.50`.
-
--   Changed the default floating point format to not include `.0` for
-    consistency with `std::format` and `std::to_chars`
-    (https://github.com/fmtlib/fmt/issues/1893,
-    https://github.com/fmtlib/fmt/issues/1943). It is possible
-    to get the decimal point and trailing zero with the `#` specifier.
-
--   Fixed an issue with floating-point formatting that could result in
-    addition of a non-significant trailing zero in rare cases e.g.
-    `1.00e-34` instead of `1.0e-34`
-    (https://github.com/fmtlib/fmt/issues/1873,
-    https://github.com/fmtlib/fmt/issues/1917).
-
--   Made `fmt::to_string` fallback on `ostream` insertion operator if
-    the `formatter` specialization is not provided
-    (https://github.com/fmtlib/fmt/issues/1815,
-    https://github.com/fmtlib/fmt/pull/1829). Thanks @alexezeder.
-
--   Added support for the append mode to the experimental file API and
-    improved `fcntl.h` detection.
-    (https://github.com/fmtlib/fmt/pull/1847,
-    https://github.com/fmtlib/fmt/pull/1848). Thanks @t-wiser.
-
--   Fixed handling of types that have both an implicit conversion
-    operator and an overloaded `ostream` insertion operator
-    (https://github.com/fmtlib/fmt/issues/1766).
-
--   Fixed a slicing issue in an internal iterator type
-    (https://github.com/fmtlib/fmt/pull/1822). Thanks @BRevzin.
-
--   Fixed an issue in locale-specific integer formatting
-    (https://github.com/fmtlib/fmt/issues/1927).
-
--   Fixed handling of exotic code unit types
-    (https://github.com/fmtlib/fmt/issues/1870,
-    https://github.com/fmtlib/fmt/issues/1932).
-
--   Improved `FMT_ALWAYS_INLINE`
-    (https://github.com/fmtlib/fmt/pull/1878). Thanks @jk-jeon.
-
--   Removed dependency on `windows.h`
-    (https://github.com/fmtlib/fmt/pull/1900). Thanks @bernd5.
-
--   Optimized counting of decimal digits on MSVC
-    (https://github.com/fmtlib/fmt/pull/1890). Thanks @mwinterb.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/1772,
-    https://github.com/fmtlib/fmt/pull/1775,
-    https://github.com/fmtlib/fmt/pull/1792,
-    https://github.com/fmtlib/fmt/pull/1838,
-    https://github.com/fmtlib/fmt/pull/1888,
-    https://github.com/fmtlib/fmt/pull/1918,
-    https://github.com/fmtlib/fmt/pull/1939).
-    Thanks @leolchat, @pepsiman, @Klaim, @ravijanjam, @francesco-st and @udnaan.
-
--   Added the `FMT_REDUCE_INT_INSTANTIATIONS` CMake option that reduces
-    the binary code size at the cost of some integer formatting
-    performance. This can be useful for extremely memory-constrained
-    embedded systems
-    (https://github.com/fmtlib/fmt/issues/1778,
-    https://github.com/fmtlib/fmt/pull/1781). Thanks @kammce.
-
--   Added the `FMT_USE_INLINE_NAMESPACES` macro to control usage of
-    inline namespaces
-    (https://github.com/fmtlib/fmt/pull/1945). Thanks @darklukee.
-
--   Improved build configuration
-    (https://github.com/fmtlib/fmt/pull/1760,
-    https://github.com/fmtlib/fmt/pull/1770,
-    https://github.com/fmtlib/fmt/issues/1779,
-    https://github.com/fmtlib/fmt/pull/1783,
-    https://github.com/fmtlib/fmt/pull/1823).
-    Thanks @dvetutnev, @xvitaly, @tambry, @medithe and @martinwuehrer.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/pull/1790,
-    https://github.com/fmtlib/fmt/pull/1802,
-    https://github.com/fmtlib/fmt/pull/1808,
-    https://github.com/fmtlib/fmt/issues/1810,
-    https://github.com/fmtlib/fmt/issues/1811,
-    https://github.com/fmtlib/fmt/pull/1812,
-    https://github.com/fmtlib/fmt/pull/1814,
-    https://github.com/fmtlib/fmt/pull/1816,
-    https://github.com/fmtlib/fmt/pull/1817,
-    https://github.com/fmtlib/fmt/pull/1818,
-    https://github.com/fmtlib/fmt/issues/1825,
-    https://github.com/fmtlib/fmt/pull/1836,
-    https://github.com/fmtlib/fmt/pull/1855,
-    https://github.com/fmtlib/fmt/pull/1856,
-    https://github.com/fmtlib/fmt/pull/1860,
-    https://github.com/fmtlib/fmt/pull/1877,
-    https://github.com/fmtlib/fmt/pull/1879,
-    https://github.com/fmtlib/fmt/pull/1880,
-    https://github.com/fmtlib/fmt/issues/1896,
-    https://github.com/fmtlib/fmt/pull/1897,
-    https://github.com/fmtlib/fmt/pull/1898,
-    https://github.com/fmtlib/fmt/issues/1904,
-    https://github.com/fmtlib/fmt/pull/1908,
-    https://github.com/fmtlib/fmt/issues/1911,
-    https://github.com/fmtlib/fmt/issues/1912,
-    https://github.com/fmtlib/fmt/issues/1928,
-    https://github.com/fmtlib/fmt/pull/1929,
-    https://github.com/fmtlib/fmt/issues/1935,
-    https://github.com/fmtlib/fmt/pull/1937,
-    https://github.com/fmtlib/fmt/pull/1942,
-    https://github.com/fmtlib/fmt/issues/1949).
-    Thanks @TheQwertiest, @medithe, @martinwuehrer, @n16h7hunt3r, @Othereum,
-    @gsjaardema, @AlexanderLanin, @gcerretani, @chronoxor, @noizefloor,
-    @akohlmey, @jk-jeon, @rimathia, @rglarix, @moiwi, @heckad, @MarcDirven.
-    @BartSiwek and @darklukee.
-
-# 7.0.3 - 2020-08-06
-
--   Worked around broken `numeric_limits` for 128-bit integers
-    (https://github.com/fmtlib/fmt/issues/1787).
--   Added error reporting on missing named arguments
-    (https://github.com/fmtlib/fmt/issues/1796).
--   Stopped using 128-bit integers with clang-cl
-    (https://github.com/fmtlib/fmt/pull/1800). Thanks @Kingcom.
--   Fixed issues in locale-specific integer formatting
-    (https://github.com/fmtlib/fmt/issues/1782,
-    https://github.com/fmtlib/fmt/issues/1801).
-
-# 7.0.2 - 2020-07-29
-
--   Worked around broken `numeric_limits` for 128-bit integers
-    (https://github.com/fmtlib/fmt/issues/1725).
--   Fixed compatibility with CMake 3.4
-    (https://github.com/fmtlib/fmt/issues/1779).
--   Fixed handling of digit separators in locale-specific formatting
-    (https://github.com/fmtlib/fmt/issues/1782).
-
-# 7.0.1 - 2020-07-07
-
--   Updated the inline version namespace name.
--   Worked around a gcc bug in mangling of alias templates
-    (https://github.com/fmtlib/fmt/issues/1753).
--   Fixed a linkage error on Windows
-    (https://github.com/fmtlib/fmt/issues/1757). Thanks @Kurkin.
--   Fixed minor issues with the documentation.
-
-# 7.0.0 - 2020-07-05
-
--   Reduced the library size. For example, on macOS a stripped test
-    binary statically linked with {fmt} [shrank from \~368k to less than
-    100k](http://www.zverovich.net/2020/05/21/reducing-library-size.html).
-
--   Added a simpler and more efficient [format string compilation
-    API](https://fmt.dev/7.0.0/api.html#compile-api):
-
-    ```c++
-    #include <fmt/compile.h>
-
-    // Converts 42 into std::string using the most efficient method and no
-    // runtime format string processing.
-    std::string s = fmt::format(FMT_COMPILE("{}"), 42);
-    ```
-
-    The old `fmt::compile` API is now deprecated.
-
--   Optimized integer formatting: `format_to` with format string
-    compilation and a stack-allocated buffer is now [faster than
-    to_chars on both libc++ and
-    libstdc++](http://www.zverovich.net/2020/06/13/fast-int-to-string-revisited.html).
-
--   Optimized handling of small format strings. For example,
-
-    ```c++
-    fmt::format("Result: {}: ({},{},{},{})", str1, str2, str3, str4, str5)
-    ```
-
-    is now \~40% faster
-    (https://github.com/fmtlib/fmt/issues/1685).
-
--   Applied extern templates to improve compile times when using the
-    core API and `fmt/format.h`
-    (https://github.com/fmtlib/fmt/issues/1452). For example,
-    on macOS with clang the compile time of a test translation unit
-    dropped from 2.3s to 0.3s with `-O2` and from 0.6s to 0.3s with the
-    default settings (`-O0`).
-
-    Before (`-O2`):
-
-        % time c++ -c test.cc -I include -std=c++17 -O2
-        c++ -c test.cc -I include -std=c++17 -O2  2.22s user 0.08s system 99% cpu 2.311 total
-
-    After (`-O2`):
-
-        % time c++ -c test.cc -I include -std=c++17 -O2
-        c++ -c test.cc -I include -std=c++17 -O2  0.26s user 0.04s system 98% cpu 0.303 total
-
-    Before (default):
-
-        % time c++ -c test.cc -I include -std=c++17
-        c++ -c test.cc -I include -std=c++17  0.53s user 0.06s system 98% cpu 0.601 total
-
-    After (default):
-
-        % time c++ -c test.cc -I include -std=c++17
-        c++ -c test.cc -I include -std=c++17  0.24s user 0.06s system 98% cpu 0.301 total
-
-    It is still recommended to use `fmt/core.h` instead of
-    `fmt/format.h` but the compile time difference is now smaller.
-    Thanks @alex3d for the suggestion.
-
--   Named arguments are now stored on stack (no dynamic memory
-    allocations) and the compiled code is more compact and efficient.
-    For example
-
-    ```c++
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("The answer is {answer}\n", fmt::arg("answer", 42));
-    }
-    ```
-
-    compiles to just ([godbolt](https://godbolt.org/z/NcfEp_))
-
-    ```asm
-    .LC0:
-            .string "answer"
-    .LC1:
-            .string "The answer is {answer}\n"
-    main:
-            sub     rsp, 56
-            mov     edi, OFFSET FLAT:.LC1
-            mov     esi, 23
-            movabs  rdx, 4611686018427387905
-            lea     rax, [rsp+32]
-            lea     rcx, [rsp+16]
-            mov     QWORD PTR [rsp+8], 1
-            mov     QWORD PTR [rsp], rax
-            mov     DWORD PTR [rsp+16], 42
-            mov     QWORD PTR [rsp+32], OFFSET FLAT:.LC0
-            mov     DWORD PTR [rsp+40], 0
-            call    fmt::v6::vprint(fmt::v6::basic_string_view<char>,
-                                    fmt::v6::format_args)
-            xor     eax, eax
-            add     rsp, 56
-            ret
-
-        .L.str.1:
-                .asciz  "answer"
-    ```
-
--   Implemented compile-time checks for dynamic width and precision
-    (https://github.com/fmtlib/fmt/issues/1614):
-
-    ```c++
-    #include <fmt/format.h>
-
-    int main() {
-      fmt::print(FMT_STRING("{0:{1}}"), 42);
-    }
-    ```
-
-    now gives a compilation error because argument 1 doesn\'t exist:
-
-        In file included from test.cc:1:
-        include/fmt/format.h:2726:27: error: constexpr variable 'invalid_format' must be
-        initialized by a constant expression
-          FMT_CONSTEXPR_DECL bool invalid_format =
-                                  ^
-        ...
-        include/fmt/core.h:569:26: note: in call to
-        '&checker(s, {}).context_->on_error(&"argument not found"[0])'
-            if (id >= num_args_) on_error("argument not found");
-                                ^
-
--   Added sentinel support to `fmt::join`
-    (https://github.com/fmtlib/fmt/pull/1689)
-
-    ```c++
-    struct zstring_sentinel {};
-    bool operator==(const char* p, zstring_sentinel) { return *p == '\0'; }
-    bool operator!=(const char* p, zstring_sentinel) { return *p != '\0'; }
-
-    struct zstring {
-      const char* p;
-      const char* begin() const { return p; }
-      zstring_sentinel end() const { return {}; }
-    };
-
-    auto s = fmt::format("{}", fmt::join(zstring{"hello"}, "_"));
-    // s == "h_e_l_l_o"
-    ```
-
-    Thanks @BRevzin.
-
--   Added support for named arguments, `clear` and `reserve` to
-    `dynamic_format_arg_store`
-    (https://github.com/fmtlib/fmt/issues/1655,
-    https://github.com/fmtlib/fmt/pull/1663,
-    https://github.com/fmtlib/fmt/pull/1674,
-    https://github.com/fmtlib/fmt/pull/1677). Thanks @vsolontsov-ll.
-
--   Added support for the `'c'` format specifier to integral types for
-    compatibility with `std::format`
-    (https://github.com/fmtlib/fmt/issues/1652).
-
--   Replaced the `'n'` format specifier with `'L'` for compatibility
-    with `std::format`
-    (https://github.com/fmtlib/fmt/issues/1624). The `'n'`
-    specifier can be enabled via the `FMT_DEPRECATED_N_SPECIFIER` macro.
-
--   The `'='` format specifier is now disabled by default for
-    compatibility with `std::format`. It can be enabled via the
-    `FMT_DEPRECATED_NUMERIC_ALIGN` macro.
-
--   Removed the following deprecated APIs:
-
-    -   `FMT_STRING_ALIAS` and `fmt` macros - replaced by `FMT_STRING`
-    -   `fmt::basic_string_view::char_type` - replaced by
-        `fmt::basic_string_view::value_type`
-    -   `convert_to_int`
-    -   `format_arg_store::types`
-    -   `*parse_context` - replaced by `*format_parse_context`
-    -   `FMT_DEPRECATED_INCLUDE_OS`
-    -   `FMT_DEPRECATED_PERCENT` - incompatible with `std::format`
-    -   `*writer` - replaced by compiled format API
-
--   Renamed the `internal` namespace to `detail`
-    (https://github.com/fmtlib/fmt/issues/1538). The former is
-    still provided as an alias if the `FMT_USE_INTERNAL` macro is
-    defined.
-
--   Improved compatibility between `fmt::printf` with the standard specs
-    (https://github.com/fmtlib/fmt/issues/1595,
-    https://github.com/fmtlib/fmt/pull/1682,
-    https://github.com/fmtlib/fmt/pull/1683,
-    https://github.com/fmtlib/fmt/pull/1687,
-    https://github.com/fmtlib/fmt/pull/1699). Thanks @rimathia.
-
--   Fixed handling of `operator<<` overloads that use `copyfmt`
-    (https://github.com/fmtlib/fmt/issues/1666).
-
--   Added the `FMT_OS` CMake option to control inclusion of OS-specific
-    APIs in the fmt target. This can be useful for embedded platforms
-    (https://github.com/fmtlib/fmt/issues/1654,
-    https://github.com/fmtlib/fmt/pull/1656). Thanks @kwesolowski.
-
--   Replaced `FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION` with the
-    `FMT_FUZZ` macro to prevent interfering with fuzzing of projects
-    using {fmt} (https://github.com/fmtlib/fmt/pull/1650).
-    Thanks @asraa.
-
--   Fixed compatibility with emscripten
-    (https://github.com/fmtlib/fmt/issues/1636,
-    https://github.com/fmtlib/fmt/pull/1637). Thanks @ArthurSonzogni.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/704,
-    https://github.com/fmtlib/fmt/pull/1643,
-    https://github.com/fmtlib/fmt/pull/1660,
-    https://github.com/fmtlib/fmt/pull/1681,
-    https://github.com/fmtlib/fmt/pull/1691,
-    https://github.com/fmtlib/fmt/pull/1706,
-    https://github.com/fmtlib/fmt/pull/1714,
-    https://github.com/fmtlib/fmt/pull/1721,
-    https://github.com/fmtlib/fmt/pull/1739,
-    https://github.com/fmtlib/fmt/pull/1740,
-    https://github.com/fmtlib/fmt/pull/1741,
-    https://github.com/fmtlib/fmt/pull/1751).
-    Thanks @senior7515, @lsr0, @puetzk, @fpelliccioni, Alexey Kuzmenko, @jelly,
-    @claremacrae, @jiapengwen, @gsjaardema and @alexey-milovidov.
-
--   Implemented various build configuration fixes and improvements
-    (https://github.com/fmtlib/fmt/pull/1603,
-    https://github.com/fmtlib/fmt/pull/1657,
-    https://github.com/fmtlib/fmt/pull/1702,
-    https://github.com/fmtlib/fmt/pull/1728).
-    Thanks @scramsby, @jtojnar, @orivej and @flagarde.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/pull/1616,
-    https://github.com/fmtlib/fmt/issues/1620,
-    https://github.com/fmtlib/fmt/issues/1622,
-    https://github.com/fmtlib/fmt/issues/1625,
-    https://github.com/fmtlib/fmt/pull/1627,
-    https://github.com/fmtlib/fmt/issues/1628,
-    https://github.com/fmtlib/fmt/pull/1629,
-    https://github.com/fmtlib/fmt/issues/1631,
-    https://github.com/fmtlib/fmt/pull/1633,
-    https://github.com/fmtlib/fmt/pull/1649,
-    https://github.com/fmtlib/fmt/issues/1658,
-    https://github.com/fmtlib/fmt/pull/1661,
-    https://github.com/fmtlib/fmt/pull/1667,
-    https://github.com/fmtlib/fmt/issues/1668,
-    https://github.com/fmtlib/fmt/pull/1669,
-    https://github.com/fmtlib/fmt/issues/1692,
-    https://github.com/fmtlib/fmt/pull/1696,
-    https://github.com/fmtlib/fmt/pull/1697,
-    https://github.com/fmtlib/fmt/issues/1707,
-    https://github.com/fmtlib/fmt/pull/1712,
-    https://github.com/fmtlib/fmt/pull/1716,
-    https://github.com/fmtlib/fmt/pull/1722,
-    https://github.com/fmtlib/fmt/issues/1724,
-    https://github.com/fmtlib/fmt/pull/1729,
-    https://github.com/fmtlib/fmt/pull/1738,
-    https://github.com/fmtlib/fmt/issues/1742,
-    https://github.com/fmtlib/fmt/issues/1743,
-    https://github.com/fmtlib/fmt/pull/1744,
-    https://github.com/fmtlib/fmt/issues/1747,
-    https://github.com/fmtlib/fmt/pull/1750).
-    Thanks @gsjaardema, @gabime, @johnor, @Kurkin, @invexed, @peterbell10,
-    @daixtrose, @petrutlucian94, @Neargye, @ambitslix, @gabime, @erthink,
-    @tohammer and @0x8000-0000.
-
-# 6.2.1 - 2020-05-09
-
--   Fixed ostream support in `sprintf`
-    (https://github.com/fmtlib/fmt/issues/1631).
--   Fixed type detection when using implicit conversion to `string_view`
-    and ostream `operator<<` inconsistently
-    (https://github.com/fmtlib/fmt/issues/1662).
-
-# 6.2.0 - 2020-04-05
-
--   Improved error reporting when trying to format an object of a
-    non-formattable type:
-
-    ```c++
-    fmt::format("{}", S());
-    ```
-
-    now gives:
-
-        include/fmt/core.h:1015:5: error: static_assert failed due to requirement
-        'formattable' "Cannot format argument. To make type T formattable provide a
-        formatter<T> specialization:
-        https://fmt.dev/latest/api.html#formatting-user-defined-types"
-            static_assert(
-            ^
-        ...
-        note: in instantiation of function template specialization
-        'fmt::v6::format<char [3], S, char>' requested here
-          fmt::format("{}", S());
-               ^
-
-    if `S` is not formattable.
-
--   Reduced the library size by \~10%.
-
--   Always print decimal point if `#` is specified
-    (https://github.com/fmtlib/fmt/issues/1476,
-    https://github.com/fmtlib/fmt/issues/1498):
-
-    ```c++
-    fmt::print("{:#.0f}", 42.0);
-    ```
-
-    now prints `42.`
-
--   Implemented the `'L'` specifier for locale-specific numeric
-    formatting to improve compatibility with `std::format`. The `'n'`
-    specifier is now deprecated and will be removed in the next major
-    release.
-
--   Moved OS-specific APIs such as `windows_error` from `fmt/format.h`
-    to `fmt/os.h`. You can define `FMT_DEPRECATED_INCLUDE_OS` to
-    automatically include `fmt/os.h` from `fmt/format.h` for
-    compatibility but this will be disabled in the next major release.
-
--   Added precision overflow detection in floating-point formatting.
-
--   Implemented detection of invalid use of `fmt::arg`.
-
--   Used `type_identity` to block unnecessary template argument
-    deduction. Thanks Tim Song.
-
--   Improved UTF-8 handling
-    (https://github.com/fmtlib/fmt/issues/1109):
-
-    ```c++
-    fmt::print("{0:^{2}}\n"
-               "{1: ^{2}}\n"
-               "{0:^{2}}\n", "", ", !", 20);
-    ```
-
-    now prints:
-
-        
-            , !    
-        
-
-    on systems that support Unicode.
-
--   Added experimental dynamic argument storage
-    (https://github.com/fmtlib/fmt/issues/1170,
-    https://github.com/fmtlib/fmt/pull/1584):
-
-    ```c++
-    fmt::dynamic_format_arg_store<fmt::format_context> store;
-    store.push_back("answer");
-    store.push_back(42);
-    fmt::vprint("The {} is {}.\n", store);
-    ```
-
-    prints:
-
-        The answer is 42.
-
-    Thanks @vsolontsov-ll.
-
--   Made `fmt::join` accept `initializer_list`
-    (https://github.com/fmtlib/fmt/pull/1591). Thanks @Rapotkinnik.
-
--   Fixed handling of empty tuples
-    (https://github.com/fmtlib/fmt/issues/1588).
-
--   Fixed handling of output iterators in `format_to_n`
-    (https://github.com/fmtlib/fmt/issues/1506).
-
--   Fixed formatting of `std::chrono::duration` types to wide output
-    (https://github.com/fmtlib/fmt/pull/1533). Thanks @zeffy.
-
--   Added const `begin` and `end` overload to buffers
-    (https://github.com/fmtlib/fmt/pull/1553). Thanks @dominicpoeschko.
-
--   Added the ability to disable floating-point formatting via
-    `FMT_USE_FLOAT`, `FMT_USE_DOUBLE` and `FMT_USE_LONG_DOUBLE` macros
-    for extremely memory-constrained embedded system
-    (https://github.com/fmtlib/fmt/pull/1590). Thanks @albaguirre.
-
--   Made `FMT_STRING` work with `constexpr` `string_view`
-    (https://github.com/fmtlib/fmt/pull/1589). Thanks @scramsby.
-
--   Implemented a minor optimization in the format string parser
-    (https://github.com/fmtlib/fmt/pull/1560). Thanks @IkarusDeveloper.
-
--   Improved attribute detection
-    (https://github.com/fmtlib/fmt/pull/1469,
-    https://github.com/fmtlib/fmt/pull/1475,
-    https://github.com/fmtlib/fmt/pull/1576).
-    Thanks @federico-busato, @chronoxor and @refnum.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/pull/1481,
-    https://github.com/fmtlib/fmt/pull/1523).
-    Thanks @JackBoosY and @imba-tjd.
-
--   Fixed symbol visibility on Linux when compiling with
-    `-fvisibility=hidden`
-    (https://github.com/fmtlib/fmt/pull/1535). Thanks @milianw.
-
--   Implemented various build configuration fixes and improvements
-    (https://github.com/fmtlib/fmt/issues/1264,
-    https://github.com/fmtlib/fmt/issues/1460,
-    https://github.com/fmtlib/fmt/pull/1534,
-    https://github.com/fmtlib/fmt/issues/1536,
-    https://github.com/fmtlib/fmt/issues/1545,
-    https://github.com/fmtlib/fmt/pull/1546,
-    https://github.com/fmtlib/fmt/issues/1566,
-    https://github.com/fmtlib/fmt/pull/1582,
-    https://github.com/fmtlib/fmt/issues/1597,
-    https://github.com/fmtlib/fmt/pull/1598).
-    Thanks @ambitslix, @jwillikers and @stac47.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/pull/1433,
-    https://github.com/fmtlib/fmt/issues/1461,
-    https://github.com/fmtlib/fmt/pull/1470,
-    https://github.com/fmtlib/fmt/pull/1480,
-    https://github.com/fmtlib/fmt/pull/1485,
-    https://github.com/fmtlib/fmt/pull/1492,
-    https://github.com/fmtlib/fmt/issues/1493,
-    https://github.com/fmtlib/fmt/issues/1504,
-    https://github.com/fmtlib/fmt/pull/1505,
-    https://github.com/fmtlib/fmt/pull/1512,
-    https://github.com/fmtlib/fmt/issues/1515,
-    https://github.com/fmtlib/fmt/pull/1516,
-    https://github.com/fmtlib/fmt/pull/1518,
-    https://github.com/fmtlib/fmt/pull/1519,
-    https://github.com/fmtlib/fmt/pull/1520,
-    https://github.com/fmtlib/fmt/pull/1521,
-    https://github.com/fmtlib/fmt/pull/1522,
-    https://github.com/fmtlib/fmt/issues/1524,
-    https://github.com/fmtlib/fmt/pull/1530,
-    https://github.com/fmtlib/fmt/issues/1531,
-    https://github.com/fmtlib/fmt/pull/1532,
-    https://github.com/fmtlib/fmt/issues/1539,
-    https://github.com/fmtlib/fmt/issues/1547,
-    https://github.com/fmtlib/fmt/issues/1548,
-    https://github.com/fmtlib/fmt/pull/1554,
-    https://github.com/fmtlib/fmt/issues/1567,
-    https://github.com/fmtlib/fmt/pull/1568,
-    https://github.com/fmtlib/fmt/pull/1569,
-    https://github.com/fmtlib/fmt/pull/1571,
-    https://github.com/fmtlib/fmt/pull/1573,
-    https://github.com/fmtlib/fmt/pull/1575,
-    https://github.com/fmtlib/fmt/pull/1581,
-    https://github.com/fmtlib/fmt/issues/1583,
-    https://github.com/fmtlib/fmt/issues/1586,
-    https://github.com/fmtlib/fmt/issues/1587,
-    https://github.com/fmtlib/fmt/issues/1594,
-    https://github.com/fmtlib/fmt/pull/1596,
-    https://github.com/fmtlib/fmt/issues/1604,
-    https://github.com/fmtlib/fmt/pull/1606,
-    https://github.com/fmtlib/fmt/issues/1607,
-    https://github.com/fmtlib/fmt/issues/1609).
-    Thanks @marti4d, @iPherian, @parkertomatoes, @gsjaardema, @chronoxor,
-    @DanielaE, @torsten48, @tohammer, @lefticus, @ryusakki, @adnsv, @fghzxm,
-    @refnum, @pramodk, @Spirrwell and @scramsby.
-
-# 6.1.2 - 2019-12-11
-
--   Fixed ABI compatibility with `libfmt.so.6.0.0`
-    (https://github.com/fmtlib/fmt/issues/1471).
--   Fixed handling types convertible to `std::string_view`
-    (https://github.com/fmtlib/fmt/pull/1451). Thanks @denizevrenci.
--   Made CUDA test an opt-in enabled via the `FMT_CUDA_TEST` CMake
-    option.
--   Fixed sign conversion warnings
-    (https://github.com/fmtlib/fmt/pull/1440). Thanks @0x8000-0000.
-
-# 6.1.1 - 2019-12-04
-
--   Fixed shared library build on Windows
-    (https://github.com/fmtlib/fmt/pull/1443,
-    https://github.com/fmtlib/fmt/issues/1445,
-    https://github.com/fmtlib/fmt/pull/1446,
-    https://github.com/fmtlib/fmt/issues/1450).
-    Thanks @egorpugin and @bbolli.
--   Added a missing decimal point in exponent notation with trailing
-    zeros.
--   Removed deprecated `format_arg_store::TYPES`.
-
-# 6.1.0 - 2019-12-01
-
--   {fmt} now formats IEEE 754 `float` and `double` using the shortest
-    decimal representation with correct rounding by default:
-
-    ```c++
-    #include <cmath>
-    #include <fmt/core.h>
-
-    int main() {
-      fmt::print("{}", M_PI);
-    }
-    ```
-
-    prints `3.141592653589793`.
-
--   Made the fast binary to decimal floating-point formatter the
-    default, simplified it and improved performance. {fmt} is now 15
-    times faster than libc++\'s `std::ostringstream`, 11 times faster
-    than `printf` and 10% faster than double-conversion on
-    [dtoa-benchmark](https://github.com/fmtlib/dtoa-benchmark):
-
-    | Function      | Time (ns) | Speedup |
-    | ------------- | --------: | ------: |
-    | ostringstream | 1,346.30  | 1.00x   |
-    | ostrstream    | 1,195.74  | 1.13x   |
-    | sprintf       | 995.08    | 1.35x   |
-    | doubleconv    | 99.10     | 13.59x  |
-    | fmt           | 88.34     | 15.24x  |
-
-    ![](https://user-images.githubusercontent.com/576385/69767160-cdaca400-112f-11ea-9fc5-347c9f83caad.png)
-
--   {fmt} no longer converts `float` arguments to `double`. In
-    particular this improves the default (shortest) representation of
-    floats and makes `fmt::format` consistent with `std::format` specs
-    (https://github.com/fmtlib/fmt/issues/1336,
-    https://github.com/fmtlib/fmt/issues/1353,
-    https://github.com/fmtlib/fmt/pull/1360,
-    https://github.com/fmtlib/fmt/pull/1361):
-
-    ```c++
-    fmt::print("{}", 0.1f);
-    ```
-
-    prints `0.1` instead of `0.10000000149011612`.
-
-    Thanks @orivej.
-
--   Made floating-point formatting output consistent with
-    `printf`/iostreams
-    (https://github.com/fmtlib/fmt/issues/1376,
-    https://github.com/fmtlib/fmt/issues/1417).
-
--   Added support for 128-bit integers
-    (https://github.com/fmtlib/fmt/pull/1287):
-
-    ```c++
-    fmt::print("{}", std::numeric_limits<__int128_t>::max());
-    ```
-
-    prints `170141183460469231731687303715884105727`.
-
-    Thanks @denizevrenci.
-
--   The overload of `print` that takes `text_style` is now atomic, i.e.
-    the output from different threads doesn\'t interleave
-    (https://github.com/fmtlib/fmt/pull/1351). Thanks @tankiJong.
-
--   Made compile time in the header-only mode \~20% faster by reducing
-    the number of template instantiations. `wchar_t` overload of
-    `vprint` was moved from `fmt/core.h` to `fmt/format.h`.
-
--   Added an overload of `fmt::join` that works with tuples
-    (https://github.com/fmtlib/fmt/issues/1322,
-    https://github.com/fmtlib/fmt/pull/1330):
-
-    ```c++
-    #include <tuple>
-    #include <fmt/ranges.h>
-
-    int main() {
-      std::tuple<char, int, float> t{'a', 1, 2.0f};
-      fmt::print("{}", t);
-    }
-    ```
-
-    prints `('a', 1, 2.0)`.
-
-    Thanks @jeremyong.
-
--   Changed formatting of octal zero with prefix from \"00\" to \"0\":
-
-    ```c++
-    fmt::print("{:#o}", 0);
-    ```
-
-    prints `0`.
-
--   The locale is now passed to ostream insertion (`<<`) operators
-    (https://github.com/fmtlib/fmt/pull/1406):
-
-    ```c++
-    #include <fmt/locale.h>
-    #include <fmt/ostream.h>
-
-    struct S {
-      double value;
-    };
-
-    std::ostream& operator<<(std::ostream& os, S s) {
-      return os << s.value;
-    }
-
-    int main() {
-      auto s = fmt::format(std::locale("fr_FR.UTF-8"), "{}", S{0.42});
-      // s == "0,42"
-    }
-    ```
-
-    Thanks @dlaugt.
-
--   Locale-specific number formatting now uses grouping
-    (https://github.com/fmtlib/fmt/issues/1393,
-    https://github.com/fmtlib/fmt/pull/1394). Thanks @skrdaniel.
-
--   Fixed handling of types with deleted implicit rvalue conversion to
-    `const char**` (https://github.com/fmtlib/fmt/issues/1421):
-
-    ```c++
-    struct mystring {
-      operator const char*() const&;
-      operator const char*() &;
-      operator const char*() const&& = delete;
-      operator const char*() && = delete;
-    };
-    mystring str;
-    fmt::print("{}", str); // now compiles
-    ```
-
--   Enums are now mapped to correct underlying types instead of `int`
-    (https://github.com/fmtlib/fmt/pull/1286). Thanks @agmt.
-
--   Enum classes are no longer implicitly converted to `int`
-    (https://github.com/fmtlib/fmt/issues/1424).
-
--   Added `basic_format_parse_context` for consistency with C++20
-    `std::format` and deprecated `basic_parse_context`.
-
--   Fixed handling of UTF-8 in precision
-    (https://github.com/fmtlib/fmt/issues/1389,
-    https://github.com/fmtlib/fmt/pull/1390). Thanks @tajtiattila.
-
--   {fmt} can now be installed on Linux, macOS and Windows with
-    [Conda](https://docs.conda.io/en/latest/) using its
-    [conda-forge](https://conda-forge.org)
-    [package](https://github.com/conda-forge/fmt-feedstock)
-    (https://github.com/fmtlib/fmt/pull/1410):
-
-        conda install -c conda-forge fmt
-
-    Thanks @tdegeus.
-
--   Added a CUDA test (https://github.com/fmtlib/fmt/pull/1285,
-    https://github.com/fmtlib/fmt/pull/1317).
-    Thanks @luncliff and @risa2000.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/pull/1276,
-    https://github.com/fmtlib/fmt/issues/1291,
-    https://github.com/fmtlib/fmt/issues/1296,
-    https://github.com/fmtlib/fmt/pull/1315,
-    https://github.com/fmtlib/fmt/pull/1332,
-    https://github.com/fmtlib/fmt/pull/1337,
-    https://github.com/fmtlib/fmt/issues/1395
-    https://github.com/fmtlib/fmt/pull/1418).
-    Thanks @waywardmonkeys, @pauldreik and @jackoalan.
-
--   Various code improvements
-    (https://github.com/fmtlib/fmt/pull/1358,
-    https://github.com/fmtlib/fmt/pull/1407).
-    Thanks @orivej and @dpacbach.
-
--   Fixed compile-time format string checks for user-defined types
-    (https://github.com/fmtlib/fmt/issues/1292).
-
--   Worked around a false positive in `unsigned-integer-overflow` sanitizer
-    (https://github.com/fmtlib/fmt/issues/1377).
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/issues/1273,
-    https://github.com/fmtlib/fmt/pull/1278,
-    https://github.com/fmtlib/fmt/pull/1280,
-    https://github.com/fmtlib/fmt/issues/1281,
-    https://github.com/fmtlib/fmt/issues/1288,
-    https://github.com/fmtlib/fmt/pull/1290,
-    https://github.com/fmtlib/fmt/pull/1301,
-    https://github.com/fmtlib/fmt/issues/1305,
-    https://github.com/fmtlib/fmt/issues/1306,
-    https://github.com/fmtlib/fmt/issues/1309,
-    https://github.com/fmtlib/fmt/pull/1312,
-    https://github.com/fmtlib/fmt/issues/1313,
-    https://github.com/fmtlib/fmt/issues/1316,
-    https://github.com/fmtlib/fmt/issues/1319,
-    https://github.com/fmtlib/fmt/pull/1320,
-    https://github.com/fmtlib/fmt/pull/1326,
-    https://github.com/fmtlib/fmt/pull/1328,
-    https://github.com/fmtlib/fmt/issues/1344,
-    https://github.com/fmtlib/fmt/pull/1345,
-    https://github.com/fmtlib/fmt/pull/1347,
-    https://github.com/fmtlib/fmt/pull/1349,
-    https://github.com/fmtlib/fmt/issues/1354,
-    https://github.com/fmtlib/fmt/issues/1362,
-    https://github.com/fmtlib/fmt/issues/1366,
-    https://github.com/fmtlib/fmt/pull/1364,
-    https://github.com/fmtlib/fmt/pull/1370,
-    https://github.com/fmtlib/fmt/pull/1371,
-    https://github.com/fmtlib/fmt/issues/1385,
-    https://github.com/fmtlib/fmt/issues/1388,
-    https://github.com/fmtlib/fmt/pull/1397,
-    https://github.com/fmtlib/fmt/pull/1414,
-    https://github.com/fmtlib/fmt/pull/1416,
-    https://github.com/fmtlib/fmt/issues/1422
-    https://github.com/fmtlib/fmt/pull/1427,
-    https://github.com/fmtlib/fmt/issues/1431,
-    https://github.com/fmtlib/fmt/pull/1433).
-    Thanks @hhb, @gsjaardema, @gabime, @neheb, @vedranmiletic, @dkavolis,
-    @mwinterb, @orivej, @denizevrenci, @leonklingele, @chronoxor, @kent-tri,
-    @0x8000-0000 and @marti4d.
-
-# 6.0.0 - 2019-08-26
-
--   Switched to the [MIT license](
-    https://github.com/fmtlib/fmt/blob/5a4b24613ba16cc689977c3b5bd8274a3ba1dd1f/LICENSE.rst)
-    with an optional exception that allows distributing binary code
-    without attribution.
-
--   Floating-point formatting is now locale-independent by default:
-
-    ```c++
-    #include <locale>
-    #include <fmt/core.h>
-
-    int main() {
-      std::locale::global(std::locale("ru_RU.UTF-8"));
-      fmt::print("value = {}", 4.2);
-    }
-    ```
-
-    prints \"value = 4.2\" regardless of the locale.
-
-    For locale-specific formatting use the `n` specifier:
-
-    ```c++
+- Enabled compile-time format string checks by default. For example
+  ([godbolt](https://godbolt.org/z/sMxcohGjz)):
+
+  ```c++
+  #include <fmt/core.h>
+
+  int main() {
+    fmt::print("{:d}", "I am not a number");
+  }
+  ```
+
+  gives a compile-time error on compilers with C++20 `consteval`
+  support (gcc 10+, clang 11+) because `d` is not a valid format
+  specifier for a string.
+
+  To pass a runtime string wrap it in `fmt::runtime`:
+
+  ```c++
+  fmt::print(fmt::runtime("{:d}"), "I am not a number");
+  ```
+
+- Added compile-time formatting
+  (https://github.com/fmtlib/fmt/pull/2019,
+  https://github.com/fmtlib/fmt/pull/2044,
+  https://github.com/fmtlib/fmt/pull/2056,
+  https://github.com/fmtlib/fmt/pull/2072,
+  https://github.com/fmtlib/fmt/pull/2075,
+  https://github.com/fmtlib/fmt/issues/2078,
+  https://github.com/fmtlib/fmt/pull/2129,
+  https://github.com/fmtlib/fmt/pull/2326). For example
+  ([godbolt](https://godbolt.org/z/Mxx9d89jM)):
+
+  ```c++
+  #include <fmt/compile.h>
+
+  consteval auto compile_time_itoa(int value) -> std::array<char, 10> {
+    auto result = std::array<char, 10>();
+    fmt::format_to(result.data(), FMT_COMPILE("{}"), value);
+    return result;
+  }
+
+  constexpr auto answer = compile_time_itoa(42);
+  ```
+
+  Most of the formatting functionality is available at compile time
+  with a notable exception of floating-point numbers and pointers.
+  Thanks @alexezeder.
+
+- Optimized handling of format specifiers during format string
+  compilation. For example, hexadecimal formatting (`"{:x}"`) is now
+  3-7x faster than before when using `format_to` with format string
+  compilation and a stack-allocated buffer
+  (https://github.com/fmtlib/fmt/issues/1944).
+
+  Before (7.1.3):
+
+      ----------------------------------------------------------------------------
+      Benchmark                                  Time             CPU   Iterations
+      ----------------------------------------------------------------------------
+      FMTCompileOld/0                         15.5 ns         15.5 ns     43302898
+      FMTCompileOld/42                        16.6 ns         16.6 ns     43278267
+      FMTCompileOld/273123                    18.7 ns         18.6 ns     37035861
+      FMTCompileOld/9223372036854775807       19.4 ns         19.4 ns     35243000
+      ----------------------------------------------------------------------------
+
+  After (8.x):
+
+      ----------------------------------------------------------------------------
+      Benchmark                                  Time             CPU   Iterations
+      ----------------------------------------------------------------------------
+      FMTCompileNew/0                         1.99 ns         1.99 ns    360523686
+      FMTCompileNew/42                        2.33 ns         2.33 ns    279865664
+      FMTCompileNew/273123                    3.72 ns         3.71 ns    190230315
+      FMTCompileNew/9223372036854775807       5.28 ns         5.26 ns    130711631
+      ----------------------------------------------------------------------------
+
+  It is even faster than `std::to_chars` from libc++ compiled with
+  clang on macOS:
+
+      ----------------------------------------------------------------------------
+      Benchmark                                  Time             CPU   Iterations
+      ----------------------------------------------------------------------------
+      ToChars/0                               4.42 ns         4.41 ns    160196630
+      ToChars/42                              5.00 ns         4.98 ns    140735201
+      ToChars/273123                          7.26 ns         7.24 ns     95784130
+      ToChars/9223372036854775807             8.77 ns         8.75 ns     75872534
+      ----------------------------------------------------------------------------
+
+  In other cases, especially involving `std::string` construction, the
+  speed up is usually lower because handling format specifiers takes a
+  smaller fraction of the total time.
+
+- Added the `_cf` user-defined literal to represent a compiled format
+  string. It can be used instead of the `FMT_COMPILE` macro
+  (https://github.com/fmtlib/fmt/pull/2043,
+  https://github.com/fmtlib/fmt/pull/2242):
+
+  ```c++
+  #include <fmt/compile.h>
+
+  using namespace fmt::literals;
+  auto s = fmt::format(FMT_COMPILE("{}"), 42); //  not modern
+  auto s = fmt::format("{}"_cf, 42);           //  modern as hell
+  ```
+
+  It requires compiler support for class types in non-type template
+  parameters (a C++20 feature) which is available in GCC 9.3+.
+  Thanks @alexezeder.
+
+- Format string compilation now requires `format` functions of
+  `formatter` specializations for user-defined types to be `const`:
+
+  ```c++
+  template <> struct fmt::formatter<my_type>: formatter<string_view> {
+    template <typename FormatContext>
+    auto format(my_type obj, FormatContext& ctx) const {  // Note const here.
+      // ...
+    }
+  };
+  ```
+
+- Added UDL-based named argument support to format string compilation
+  (https://github.com/fmtlib/fmt/pull/2243,
+  https://github.com/fmtlib/fmt/pull/2281). For example:
+
+  ```c++
+  #include <fmt/compile.h>
+
+  using namespace fmt::literals;
+  auto s = fmt::format(FMT_COMPILE("{answer}"), "answer"_a = 42);
+  ```
+
+  Here the argument named \"answer\" is resolved at compile time with
+  no runtime overhead. Thanks @alexezeder.
+
+- Added format string compilation support to `fmt::print`
+  (https://github.com/fmtlib/fmt/issues/2280,
+  https://github.com/fmtlib/fmt/pull/2304). Thanks @alexezeder.
+
+- Added initial support for compiling {fmt} as a C++20 module
+  (https://github.com/fmtlib/fmt/pull/2235,
+  https://github.com/fmtlib/fmt/pull/2240,
+  https://github.com/fmtlib/fmt/pull/2260,
+  https://github.com/fmtlib/fmt/pull/2282,
+  https://github.com/fmtlib/fmt/pull/2283,
+  https://github.com/fmtlib/fmt/pull/2288,
+  https://github.com/fmtlib/fmt/pull/2298,
+  https://github.com/fmtlib/fmt/pull/2306,
+  https://github.com/fmtlib/fmt/pull/2307,
+  https://github.com/fmtlib/fmt/pull/2309,
+  https://github.com/fmtlib/fmt/pull/2318,
+  https://github.com/fmtlib/fmt/pull/2324,
+  https://github.com/fmtlib/fmt/pull/2332,
+  https://github.com/fmtlib/fmt/pull/2340). Thanks @DanielaE.
+
+- Made symbols private by default reducing shared library size
+  (https://github.com/fmtlib/fmt/pull/2301). For example
+  there was a \~15% reported reduction on one platform. Thanks @sergiud.
+
+- Optimized includes making the result of preprocessing `fmt/format.h`
+  \~20% smaller with libstdc++/C++20 and slightly improving build
+  times (https://github.com/fmtlib/fmt/issues/1998).
+
+- Added support of ranges with non-const `begin` / `end`
+  (https://github.com/fmtlib/fmt/pull/1953). Thanks @kitegi.
+
+- Added support of `std::byte` and other formattable types to
+  `fmt::join` (https://github.com/fmtlib/fmt/issues/1981,
+  https://github.com/fmtlib/fmt/issues/2040,
+  https://github.com/fmtlib/fmt/pull/2050,
+  https://github.com/fmtlib/fmt/issues/2262). For example:
+
+  ```c++
+  #include <fmt/format.h>
+  #include <cstddef>
+  #include <vector>
+
+  int main() {
+    auto bytes = std::vector{std::byte(4), std::byte(2)};
+    fmt::print("{}", fmt::join(bytes, ""));
+  }
+  ```
+
+  prints \"42\".
+
+  Thanks @kamibo.
+
+- Implemented the default format for `std::chrono::system_clock`
+  (https://github.com/fmtlib/fmt/issues/2319,
+  https://github.com/fmtlib/fmt/pull/2345). For example:
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
+    fmt::print("{}", std::chrono::system_clock::now());
+  }
+  ```
+
+  prints \"2021-06-18 15:22:00\" (the output depends on the current
+  date and time). Thanks @sunmy2019.
+
+- Made more chrono specifiers locale independent by default. Use the
+  `'L'` specifier to get localized formatting. For example:
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
     std::locale::global(std::locale("ru_RU.UTF-8"));
-    fmt::print("value = {:n}", 4.2);
-    ```
-
-    prints \"value = 4,2\".
-
--   Added an experimental Grisu floating-point formatting algorithm
-    implementation (disabled by default). To enable it compile with the
-    `FMT_USE_GRISU` macro defined to 1:
-
-    ```c++
-    #define FMT_USE_GRISU 1
-    #include <fmt/format.h>
-
-    auto s = fmt::format("{}", 4.2); // formats 4.2 using Grisu
-    ```
-
-    With Grisu enabled, {fmt} is 13x faster than `std::ostringstream`
-    (libc++) and 10x faster than `sprintf` on
-    [dtoa-benchmark](https://github.com/fmtlib/dtoa-benchmark) ([full
-    results](https://fmt.dev/unknown_mac64_clang10.0.html)):
-
-    ![](https://user-images.githubusercontent.com/576385/54883977-9fe8c000-4e28-11e9-8bde-272d122e7c52.jpg)
-
--   Separated formatting and parsing contexts for consistency with
-    [C++20 std::format](http://eel.is/c++draft/format), removing the
-    undocumented `basic_format_context::parse_context()` function.
-
--   Added [oss-fuzz](https://github.com/google/oss-fuzz) support
-    (https://github.com/fmtlib/fmt/pull/1199). Thanks @pauldreik.
-
--   `formatter` specializations now always take precedence over
-    `operator<<` (https://github.com/fmtlib/fmt/issues/952):
-
-    ```c++
-    #include <iostream>
-    #include <fmt/ostream.h>
-
-    struct S {};
-
-    std::ostream& operator<<(std::ostream& os, S) {
-      return os << 1;
-    }
-
-    template <>
-    struct fmt::formatter<S> : fmt::formatter<int> {
-      auto format(S, format_context& ctx) {
-        return formatter<int>::format(2, ctx);
-      }
-    };
-
-    int main() {
-      std::cout << S() << "\n"; // prints 1 using operator<<
-      fmt::print("{}\n", S());  // prints 2 using formatter
-    }
-    ```
-
--   Introduced the experimental `fmt::compile` function that does format
-    string compilation
-    (https://github.com/fmtlib/fmt/issues/618,
-    https://github.com/fmtlib/fmt/issues/1169,
-    https://github.com/fmtlib/fmt/pull/1171):
-
-    ```c++
-    #include <fmt/compile.h>
-
-    auto f = fmt::compile<int>("{}");
-    std::string s = fmt::format(f, 42); // can be called multiple times to
-                                        // format different values
-    // s == "42"
-    ```
-
-    It moves the cost of parsing a format string outside of the format
-    function which can be beneficial when identically formatting many
-    objects of the same types. Thanks @stryku.
-
--   Added experimental `%` format specifier that formats floating-point
-    values as percentages
-    (https://github.com/fmtlib/fmt/pull/1060,
-    https://github.com/fmtlib/fmt/pull/1069,
-    https://github.com/fmtlib/fmt/pull/1071):
-
-    ```c++
-    auto s = fmt::format("{:.1%}", 0.42); // s == "42.0%"
-    ```
-
-    Thanks @gawain-bolton.
-
--   Implemented precision for floating-point durations
-    (https://github.com/fmtlib/fmt/issues/1004,
-    https://github.com/fmtlib/fmt/pull/1012):
-
-    ```c++
-    auto s = fmt::format("{:.1}", std::chrono::duration<double>(1.234));
-    // s == 1.2s
-    ```
-
-    Thanks @DanielaE.
-
--   Implemented `chrono` format specifiers `%Q` and `%q` that give the
-    value and the unit respectively
-    (https://github.com/fmtlib/fmt/pull/1019):
-
-    ```c++
-    auto value = fmt::format("{:%Q}", 42s); // value == "42"
-    auto unit  = fmt::format("{:%q}", 42s); // unit == "s"
-    ```
-
-    Thanks @DanielaE.
-
--   Fixed handling of dynamic width in chrono formatter:
-
-    ```c++
-    auto s = fmt::format("{0:{1}%H:%M:%S}", std::chrono::seconds(12345), 12);
-    //                        ^ width argument index                     ^ width
-    // s == "03:25:45    "
-    ```
-
-    Thanks Howard Hinnant.
-
--   Removed deprecated `fmt/time.h`. Use `fmt/chrono.h` instead.
-
--   Added `fmt::format` and `fmt::vformat` overloads that take
-    `text_style` (https://github.com/fmtlib/fmt/issues/993,
-    https://github.com/fmtlib/fmt/pull/994):
-
-    ```c++
-    #include <fmt/color.h>
-
-    std::string message = fmt::format(fmt::emphasis::bold | fg(fmt::color::red),
-                                      "The answer is {}.", 42);
-    ```
-
-    Thanks @Naios.
-
--   Removed the deprecated color API (`print_colored`). Use the new API,
-    namely `print` overloads that take `text_style` instead.
-
--   Made `std::unique_ptr` and `std::shared_ptr` formattable as pointers
-    via `fmt::ptr` (https://github.com/fmtlib/fmt/pull/1121):
-
-    ```c++
-    std::unique_ptr<int> p = ...;
-    fmt::print("{}", fmt::ptr(p)); // prints p as a pointer
-    ```
-
-    Thanks @sighingnow.
-
--   Made `print` and `vprint` report I/O errors
-    (https://github.com/fmtlib/fmt/issues/1098,
-    https://github.com/fmtlib/fmt/pull/1099). Thanks @BillyDonahue.
-
--   Marked deprecated APIs with the `[[deprecated]]` attribute and
-    removed internal uses of deprecated APIs
-    (https://github.com/fmtlib/fmt/pull/1022). Thanks @eliaskosunen.
-
--   Modernized the codebase using more C++11 features and removing
-    workarounds. Most importantly, `buffer_context` is now an alias
-    template, so use `buffer_context<T>` instead of
-    `buffer_context<T>::type`. These features require GCC 4.8 or later.
-
--   `formatter` specializations now always take precedence over implicit
-    conversions to `int` and the undocumented `convert_to_int` trait is
-    now deprecated.
-
--   Moved the undocumented `basic_writer`, `writer`, and `wwriter` types
-    to the `internal` namespace.
-
--   Removed deprecated `basic_format_context::begin()`. Use `out()`
-    instead.
-
--   Disallowed passing the result of `join` as an lvalue to prevent
-    misuse.
-
--   Refactored the undocumented structs that represent parsed format
-    specifiers to simplify the API and allow multibyte fill.
-
--   Moved SFINAE to template parameters to reduce symbol sizes.
-
--   Switched to `fputws` for writing wide strings so that it\'s no
-    longer required to call `_setmode` on Windows
-    (https://github.com/fmtlib/fmt/issues/1229,
-    https://github.com/fmtlib/fmt/pull/1243). Thanks @jackoalan.
-
--   Improved literal-based API
-    (https://github.com/fmtlib/fmt/pull/1254). Thanks @sylveon.
-
--   Added support for exotic platforms without `uintptr_t` such as IBM i
-    (AS/400) which has 128-bit pointers and only 64-bit integers
-    (https://github.com/fmtlib/fmt/issues/1059).
-
--   Added [Sublime Text syntax highlighting config](
-    https://github.com/fmtlib/fmt/blob/master/support/C%2B%2B.sublime-syntax)
-    (https://github.com/fmtlib/fmt/issues/1037). Thanks @Kronuz.
-
--   Added the `FMT_ENFORCE_COMPILE_STRING` macro to enforce the use of
-    compile-time format strings
-    (https://github.com/fmtlib/fmt/pull/1231). Thanks @jackoalan.
-
--   Stopped setting `CMAKE_BUILD_TYPE` if {fmt} is a subproject
-    (https://github.com/fmtlib/fmt/issues/1081).
-
--   Various build improvements
-    (https://github.com/fmtlib/fmt/pull/1039,
-    https://github.com/fmtlib/fmt/pull/1078,
-    https://github.com/fmtlib/fmt/pull/1091,
-    https://github.com/fmtlib/fmt/pull/1103,
-    https://github.com/fmtlib/fmt/pull/1177).
-    Thanks @luncliff, @jasonszang, @olafhering, @Lecetem and @pauldreik.
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/1049,
-    https://github.com/fmtlib/fmt/pull/1051,
-    https://github.com/fmtlib/fmt/pull/1083,
-    https://github.com/fmtlib/fmt/pull/1113,
-    https://github.com/fmtlib/fmt/pull/1114,
-    https://github.com/fmtlib/fmt/issues/1146,
-    https://github.com/fmtlib/fmt/issues/1180,
-    https://github.com/fmtlib/fmt/pull/1250,
-    https://github.com/fmtlib/fmt/pull/1252,
-    https://github.com/fmtlib/fmt/pull/1265).
-    Thanks @mikelui, @foonathan, @BillyDonahue, @jwakely, @kaisbe and
-    @sdebionne.
-
--   Fixed ambiguous formatter specialization in `fmt/ranges.h`
-    (https://github.com/fmtlib/fmt/issues/1123).
-
--   Fixed formatting of a non-empty `std::filesystem::path` which is an
-    infinitely deep range of its components
-    (https://github.com/fmtlib/fmt/issues/1268).
-
--   Fixed handling of general output iterators when formatting
-    characters (https://github.com/fmtlib/fmt/issues/1056,
-    https://github.com/fmtlib/fmt/pull/1058). Thanks @abolz.
-
--   Fixed handling of output iterators in `formatter` specialization for
-    ranges (https://github.com/fmtlib/fmt/issues/1064).
-
--   Fixed handling of exotic character types
-    (https://github.com/fmtlib/fmt/issues/1188).
-
--   Made chrono formatting work with exceptions disabled
-    (https://github.com/fmtlib/fmt/issues/1062).
-
--   Fixed DLL visibility issues
-    (https://github.com/fmtlib/fmt/pull/1134,
-    https://github.com/fmtlib/fmt/pull/1147). Thanks @denchat.
-
--   Disabled the use of UDL template extension on GCC 9
-    (https://github.com/fmtlib/fmt/issues/1148).
-
--   Removed misplaced `format` compile-time checks from `printf`
-    (https://github.com/fmtlib/fmt/issues/1173).
-
--   Fixed issues in the experimental floating-point formatter
-    (https://github.com/fmtlib/fmt/issues/1072,
-    https://github.com/fmtlib/fmt/issues/1129,
-    https://github.com/fmtlib/fmt/issues/1153,
-    https://github.com/fmtlib/fmt/pull/1155,
-    https://github.com/fmtlib/fmt/issues/1210,
-    https://github.com/fmtlib/fmt/issues/1222). Thanks @alabuzhev.
-
--   Fixed bugs discovered by fuzzing or during fuzzing integration
-    (https://github.com/fmtlib/fmt/issues/1124,
-    https://github.com/fmtlib/fmt/issues/1127,
-    https://github.com/fmtlib/fmt/issues/1132,
-    https://github.com/fmtlib/fmt/pull/1135,
-    https://github.com/fmtlib/fmt/issues/1136,
-    https://github.com/fmtlib/fmt/issues/1141,
-    https://github.com/fmtlib/fmt/issues/1142,
-    https://github.com/fmtlib/fmt/issues/1178,
-    https://github.com/fmtlib/fmt/issues/1179,
-    https://github.com/fmtlib/fmt/issues/1194). Thanks @pauldreik.
-
--   Fixed building tests on FreeBSD and Hurd
-    (https://github.com/fmtlib/fmt/issues/1043). Thanks @jackyf.
-
--   Fixed various warnings and compilation issues
-    (https://github.com/fmtlib/fmt/pull/998,
-    https://github.com/fmtlib/fmt/pull/1006,
-    https://github.com/fmtlib/fmt/issues/1008,
-    https://github.com/fmtlib/fmt/issues/1011,
-    https://github.com/fmtlib/fmt/issues/1025,
-    https://github.com/fmtlib/fmt/pull/1027,
-    https://github.com/fmtlib/fmt/pull/1028,
-    https://github.com/fmtlib/fmt/pull/1029,
-    https://github.com/fmtlib/fmt/pull/1030,
-    https://github.com/fmtlib/fmt/pull/1031,
-    https://github.com/fmtlib/fmt/pull/1054,
-    https://github.com/fmtlib/fmt/issues/1063,
-    https://github.com/fmtlib/fmt/pull/1068,
-    https://github.com/fmtlib/fmt/pull/1074,
-    https://github.com/fmtlib/fmt/pull/1075,
-    https://github.com/fmtlib/fmt/pull/1079,
-    https://github.com/fmtlib/fmt/pull/1086,
-    https://github.com/fmtlib/fmt/issues/1088,
-    https://github.com/fmtlib/fmt/pull/1089,
-    https://github.com/fmtlib/fmt/pull/1094,
-    https://github.com/fmtlib/fmt/issues/1101,
-    https://github.com/fmtlib/fmt/pull/1102,
-    https://github.com/fmtlib/fmt/issues/1105,
-    https://github.com/fmtlib/fmt/pull/1107,
-    https://github.com/fmtlib/fmt/issues/1115,
-    https://github.com/fmtlib/fmt/issues/1117,
-    https://github.com/fmtlib/fmt/issues/1118,
-    https://github.com/fmtlib/fmt/issues/1120,
-    https://github.com/fmtlib/fmt/issues/1123,
-    https://github.com/fmtlib/fmt/pull/1139,
-    https://github.com/fmtlib/fmt/issues/1140,
-    https://github.com/fmtlib/fmt/issues/1143,
-    https://github.com/fmtlib/fmt/pull/1144,
-    https://github.com/fmtlib/fmt/pull/1150,
-    https://github.com/fmtlib/fmt/pull/1151,
-    https://github.com/fmtlib/fmt/issues/1152,
-    https://github.com/fmtlib/fmt/issues/1154,
-    https://github.com/fmtlib/fmt/issues/1156,
-    https://github.com/fmtlib/fmt/pull/1159,
-    https://github.com/fmtlib/fmt/issues/1175,
-    https://github.com/fmtlib/fmt/issues/1181,
-    https://github.com/fmtlib/fmt/issues/1186,
-    https://github.com/fmtlib/fmt/pull/1187,
-    https://github.com/fmtlib/fmt/pull/1191,
-    https://github.com/fmtlib/fmt/issues/1197,
-    https://github.com/fmtlib/fmt/issues/1200,
-    https://github.com/fmtlib/fmt/issues/1203,
-    https://github.com/fmtlib/fmt/issues/1205,
-    https://github.com/fmtlib/fmt/pull/1206,
-    https://github.com/fmtlib/fmt/issues/1213,
-    https://github.com/fmtlib/fmt/issues/1214,
-    https://github.com/fmtlib/fmt/pull/1217,
-    https://github.com/fmtlib/fmt/issues/1228,
-    https://github.com/fmtlib/fmt/pull/1230,
-    https://github.com/fmtlib/fmt/issues/1232,
-    https://github.com/fmtlib/fmt/pull/1235,
-    https://github.com/fmtlib/fmt/pull/1236,
-    https://github.com/fmtlib/fmt/issues/1240).
-    Thanks @DanielaE, @mwinterb, @eliaskosunen, @morinmorin, @ricco19,
-    @waywardmonkeys, @chronoxor, @remyabel, @pauldreik, @gsjaardema, @rcane,
-    @mocabe, @denchat, @cjdb, @HazardyKnusperkeks, @vedranmiletic, @jackoalan,
-    @DaanDeMeyer and @starkmapper.
-
-# 5.3.0 - 2018-12-28
-
--   Introduced experimental chrono formatting support:
-
-    ```c++
-    #include <fmt/chrono.h>
-
-    int main() {
-      using namespace std::literals::chrono_literals;
-      fmt::print("Default format: {} {}\n", 42s, 100ms);
-      fmt::print("strftime-like format: {:%H:%M:%S}\n", 3h + 15min + 30s);
-    }
-    ```
-
-    prints:
-
-        Default format: 42s 100ms
-        strftime-like format: 03:15:30
-
--   Added experimental support for emphasis (bold, italic, underline,
-    strikethrough), colored output to a file stream, and improved
-    colored formatting API
-    (https://github.com/fmtlib/fmt/pull/961,
-    https://github.com/fmtlib/fmt/pull/967,
-    https://github.com/fmtlib/fmt/pull/973):
-
-    ```c++
-    #include <fmt/color.h>
-
-    int main() {
-      print(fg(fmt::color::crimson) | fmt::emphasis::bold,
-            "Hello, {}!\n", "world");
-      print(fg(fmt::color::floral_white) | bg(fmt::color::slate_gray) |
-            fmt::emphasis::underline, "Hello, {}!\n", "");
-      print(fg(fmt::color::steel_blue) | fmt::emphasis::italic,
-            "Hello, {}!\n", "");
-    }
-    ```
-
-    prints the following on modern terminals with RGB color support:
-
-    ![](https://user-images.githubusercontent.com/576385/50405788-b66e7500-076e-11e9-9592-7324d1f951d8.png)
-
-    Thanks @Rakete1111.
-
--   Added support for 4-bit terminal colors
-    (https://github.com/fmtlib/fmt/issues/968,
-    https://github.com/fmtlib/fmt/pull/974)
-
-    ```c++
-    #include <fmt/color.h>
-
-    int main() {
-      print(fg(fmt::terminal_color::red), "stop\n");
-    }
-    ```
-
-    Note that these colors vary by terminal:
-
-    ![](https://user-images.githubusercontent.com/576385/50405925-dbfc7e00-0770-11e9-9b85-333fab0af9ac.png)
-
-    Thanks @Rakete1111.
-
--   Parameterized formatting functions on the type of the format string
-    (https://github.com/fmtlib/fmt/issues/880,
-    https://github.com/fmtlib/fmt/pull/881,
-    https://github.com/fmtlib/fmt/pull/883,
-    https://github.com/fmtlib/fmt/pull/885,
-    https://github.com/fmtlib/fmt/pull/897,
-    https://github.com/fmtlib/fmt/issues/920). Any object of
-    type `S` that has an overloaded `to_string_view(const S&)` returning
-    `fmt::string_view` can be used as a format string:
-
-    ```c++
-    namespace my_ns {
-    inline string_view to_string_view(const my_string& s) {
-      return {s.data(), s.length()};
-    }
-    }
-
-    std::string message = fmt::format(my_string("The answer is {}."), 42);
-    ```
-
-    Thanks @DanielaE.
-
--   Made `std::string_view` work as a format string
-    (https://github.com/fmtlib/fmt/pull/898):
-
-    ```c++
-    auto message = fmt::format(std::string_view("The answer is {}."), 42);
-    ```
-
-    Thanks @DanielaE.
-
--   Added wide string support to compile-time format string checks
-    (https://github.com/fmtlib/fmt/pull/924):
-
-    ```c++
-    print(fmt(L"{:f}"), 42); // compile-time error: invalid type specifier
-    ```
-
-    Thanks @XZiar.
-
--   Made colored print functions work with wide strings
-    (https://github.com/fmtlib/fmt/pull/867):
-
-    ```c++
-    #include <fmt/color.h>
-
-    int main() {
-      print(fg(fmt::color::red), L"{}\n", 42);
-    }
-    ```
-
-    Thanks @DanielaE.
-
--   Introduced experimental Unicode support
-    (https://github.com/fmtlib/fmt/issues/628,
-    https://github.com/fmtlib/fmt/pull/891):
-
-    ```c++
-    using namespace fmt::literals;
-    auto s = fmt::format("{:*^5}"_u, ""_u); // s == "****"_u
-    ```
-
--   Improved locale support:
-
-    ```c++
-    #include <fmt/locale.h>
-
-    struct numpunct : std::numpunct<char> {
-     protected:
-      char do_thousands_sep() const override { return '~'; }
-    };
-
-    std::locale loc;
-    auto s = fmt::format(std::locale(loc, new numpunct()), "{:n}", 1234567);
-    // s == "1~234~567"
-    ```
-
--   Constrained formatting functions on proper iterator types
-    (https://github.com/fmtlib/fmt/pull/921). Thanks @DanielaE.
-
--   Added `make_printf_args` and `make_wprintf_args` functions
-    (https://github.com/fmtlib/fmt/pull/934). Thanks @tnovotny.
-
--   Deprecated `fmt::visit`, `parse_context`, and `wparse_context`. Use
-    `fmt::visit_format_arg`, `format_parse_context`, and
-    `wformat_parse_context` instead.
-
--   Removed undocumented `basic_fixed_buffer` which has been superseded
-    by the iterator-based API
-    (https://github.com/fmtlib/fmt/issues/873,
-    https://github.com/fmtlib/fmt/pull/902). Thanks @superfunc.
-
--   Disallowed repeated leading zeros in an argument ID:
-
-    ```c++
-    fmt::print("{000}", 42); // error
-    ```
-
--   Reintroduced support for gcc 4.4.
-
--   Fixed compilation on platforms with exotic `double`
-    (https://github.com/fmtlib/fmt/issues/878).
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/issues/164,
-    https://github.com/fmtlib/fmt/issues/877,
-    https://github.com/fmtlib/fmt/pull/901,
-    https://github.com/fmtlib/fmt/pull/906,
-    https://github.com/fmtlib/fmt/pull/979).
-    Thanks @kookjr, @DarkDimius and @HecticSerenity.
-
--   Added pkgconfig support which makes it easier to consume the library
-    from meson and other build systems
-    (https://github.com/fmtlib/fmt/pull/916). Thanks @colemickens.
-
--   Various build improvements
-    (https://github.com/fmtlib/fmt/pull/909,
-    https://github.com/fmtlib/fmt/pull/926,
-    https://github.com/fmtlib/fmt/pull/937,
-    https://github.com/fmtlib/fmt/pull/953,
-    https://github.com/fmtlib/fmt/pull/959).
-    Thanks @tchaikov, @luncliff, @AndreasSchoenle, @hotwatermorning and @Zefz.
-
--   Improved `string_view` construction performance
-    (https://github.com/fmtlib/fmt/pull/914). Thanks @gabime.
-
--   Fixed non-matching char types
-    (https://github.com/fmtlib/fmt/pull/895). Thanks @DanielaE.
-
--   Fixed `format_to_n` with `std::back_insert_iterator`
-    (https://github.com/fmtlib/fmt/pull/913). Thanks @DanielaE.
-
--   Fixed locale-dependent formatting
-    (https://github.com/fmtlib/fmt/issues/905).
-
--   Fixed various compiler warnings and errors
-    (https://github.com/fmtlib/fmt/pull/882,
-    https://github.com/fmtlib/fmt/pull/886,
-    https://github.com/fmtlib/fmt/pull/933,
-    https://github.com/fmtlib/fmt/pull/941,
-    https://github.com/fmtlib/fmt/issues/931,
-    https://github.com/fmtlib/fmt/pull/943,
-    https://github.com/fmtlib/fmt/pull/954,
-    https://github.com/fmtlib/fmt/pull/956,
-    https://github.com/fmtlib/fmt/pull/962,
-    https://github.com/fmtlib/fmt/issues/965,
-    https://github.com/fmtlib/fmt/issues/977,
-    https://github.com/fmtlib/fmt/pull/983,
-    https://github.com/fmtlib/fmt/pull/989).
-    Thanks @Luthaf, @stevenhoving, @christinaa, @lgritz, @DanielaE,
-    @0x8000-0000 and @liuping1997.
-
-# 5.2.1 - 2018-09-21
-
--   Fixed `visit` lookup issues on gcc 7 & 8
-    (https://github.com/fmtlib/fmt/pull/870). Thanks @medithe.
--   Fixed linkage errors on older gcc.
--   Prevented `fmt/range.h` from specializing `fmt::basic_string_view`
-    (https://github.com/fmtlib/fmt/issues/865,
-    https://github.com/fmtlib/fmt/pull/868). Thanks @hhggit.
--   Improved error message when formatting unknown types
-    (https://github.com/fmtlib/fmt/pull/872). Thanks @foonathan.
--   Disabled templated user-defined literals when compiled under nvcc
-    (https://github.com/fmtlib/fmt/pull/875). Thanks @CandyGumdrop.
--   Fixed `format_to` formatting to `wmemory_buffer`
-    (https://github.com/fmtlib/fmt/issues/874).
-
-# 5.2.0 - 2018-09-13
-
--   Optimized format string parsing and argument processing which
-    resulted in up to 5x speed up on long format strings and significant
-    performance boost on various benchmarks. For example, version 5.2 is
-    2.22x faster than 5.1 on decimal integer formatting with `format_to`
-    (macOS, clang-902.0.39.2):
-
-    | Method                     | Time, s         | Speedup |
-    | -------------------------- | --------------: | ------: |
-    | fmt::format 5.1            | 0.58            |         |
-    | fmt::format 5.2            | 0.35            |   1.66x |
-    | fmt::format_to 5.1         | 0.51            |         |
-    | fmt::format_to 5.2         | 0.23            |   2.22x |
-    | sprintf                    | 0.71            |         |
-    | std::to_string             | 1.01            |         |
-    | std::stringstream          | 1.73            |         |
-
--   Changed the `fmt` macro from opt-out to opt-in to prevent name
-    collisions. To enable it define the `FMT_STRING_ALIAS` macro to 1
-    before including `fmt/format.h`:
-
-    ```c++
-    #define FMT_STRING_ALIAS 1
-    #include <fmt/format.h>
-    std::string answer = format(fmt("{}"), 42);
-    ```
-
--   Added compile-time format string checks to `format_to` overload that
-    takes `fmt::memory_buffer`
-    (https://github.com/fmtlib/fmt/issues/783):
-
-    ```c++
-    fmt::memory_buffer buf;
-    // Compile-time error: invalid type specifier.
-    fmt::format_to(buf, fmt("{:d}"), "foo");
-    ```
-
--   Moved experimental color support to `fmt/color.h` and enabled the
-    new API by default. The old API can be enabled by defining the
-    `FMT_DEPRECATED_COLORS` macro.
-
--   Added formatting support for types explicitly convertible to
-    `fmt::string_view`:
-
-    ```c++
-    struct foo {
-      explicit operator fmt::string_view() const { return "foo"; }
-    };
-    auto s = format("{}", foo());
-    ```
-
-    In particular, this makes formatting function work with
-    `folly::StringPiece`.
-
--   Implemented preliminary support for `char*_t` by replacing the
-    `format` function overloads with a single function template
-    parameterized on the string type.
-
--   Added support for dynamic argument lists
-    (https://github.com/fmtlib/fmt/issues/814,
-    https://github.com/fmtlib/fmt/pull/819). Thanks @MikePopoloski.
-
--   Reduced executable size overhead for embedded targets using newlib
-    nano by making locale dependency optional
-    (https://github.com/fmtlib/fmt/pull/839). Thanks @teajay-fr.
-
--   Keep `noexcept` specifier when exceptions are disabled
-    (https://github.com/fmtlib/fmt/issues/801,
-    https://github.com/fmtlib/fmt/pull/810). Thanks @qis.
-
--   Fixed formatting of user-defined types providing `operator<<` with
-    `format_to_n` (https://github.com/fmtlib/fmt/pull/806).
-    Thanks @mkurdej.
-
--   Fixed dynamic linkage of new symbols
-    (https://github.com/fmtlib/fmt/issues/808).
-
--   Fixed global initialization issue
-    (https://github.com/fmtlib/fmt/issues/807):
-
-    ```c++
-    // This works on compilers with constexpr support.
-    static const std::string answer = fmt::format("{}", 42);
-    ```
-
--   Fixed various compiler warnings and errors
-    (https://github.com/fmtlib/fmt/pull/804,
-    https://github.com/fmtlib/fmt/issues/809,
-    https://github.com/fmtlib/fmt/pull/811,
-    https://github.com/fmtlib/fmt/issues/822,
-    https://github.com/fmtlib/fmt/pull/827,
-    https://github.com/fmtlib/fmt/issues/830,
-    https://github.com/fmtlib/fmt/pull/838,
-    https://github.com/fmtlib/fmt/issues/843,
-    https://github.com/fmtlib/fmt/pull/844,
-    https://github.com/fmtlib/fmt/issues/851,
-    https://github.com/fmtlib/fmt/pull/852,
-    https://github.com/fmtlib/fmt/pull/854).
-    Thanks @henryiii, @medithe, and @eliasdaler.
-
-# 5.1.0 - 2018-07-05
-
--   Added experimental support for RGB color output enabled with the
-    `FMT_EXTENDED_COLORS` macro:
-
-    ```c++
-    #define FMT_EXTENDED_COLORS
-    #define FMT_HEADER_ONLY // or compile fmt with FMT_EXTENDED_COLORS defined
-    #include <fmt/format.h>
-
-    fmt::print(fmt::color::steel_blue, "Some beautiful text");
-    ```
-
-    The old API (the `print_colored` and `vprint_colored` functions and
-    the `color` enum) is now deprecated.
-    (https://github.com/fmtlib/fmt/issues/762
-    https://github.com/fmtlib/fmt/pull/767). thanks @Remotion.
-
--   Added quotes to strings in ranges and tuples
-    (https://github.com/fmtlib/fmt/pull/766). Thanks @Remotion.
-
--   Made `format_to` work with `basic_memory_buffer`
-    (https://github.com/fmtlib/fmt/issues/776).
-
--   Added `vformat_to_n` and `wchar_t` overload of `format_to_n`
-    (https://github.com/fmtlib/fmt/issues/764,
-    https://github.com/fmtlib/fmt/issues/769).
-
--   Made `is_range` and `is_tuple_like` part of public (experimental)
-    API to allow specialization for user-defined types
-    (https://github.com/fmtlib/fmt/issues/751,
-    https://github.com/fmtlib/fmt/pull/759). Thanks @drrlvn.
-
--   Added more compilers to continuous integration and increased
-    `FMT_PEDANTIC` warning levels
-    (https://github.com/fmtlib/fmt/pull/736). Thanks @eliaskosunen.
-
--   Fixed compilation with MSVC 2013.
-
--   Fixed handling of user-defined types in `format_to`
-    (https://github.com/fmtlib/fmt/issues/793).
-
--   Forced linking of inline `vformat` functions into the library
-    (https://github.com/fmtlib/fmt/issues/795).
-
--   Fixed incorrect call to on_align in `'{:}='`
-    (https://github.com/fmtlib/fmt/issues/750).
-
--   Fixed floating-point formatting to a non-back_insert_iterator with
-    sign & numeric alignment specified
-    (https://github.com/fmtlib/fmt/issues/756).
-
--   Fixed formatting to an array with `format_to_n`
-    (https://github.com/fmtlib/fmt/issues/778).
-
--   Fixed formatting of more than 15 named arguments
-    (https://github.com/fmtlib/fmt/issues/754).
-
--   Fixed handling of compile-time strings when including
-    `fmt/ostream.h`. (https://github.com/fmtlib/fmt/issues/768).
-
--   Fixed various compiler warnings and errors
-    (https://github.com/fmtlib/fmt/issues/742,
-    https://github.com/fmtlib/fmt/issues/748,
-    https://github.com/fmtlib/fmt/issues/752,
-    https://github.com/fmtlib/fmt/issues/770,
-    https://github.com/fmtlib/fmt/pull/775,
-    https://github.com/fmtlib/fmt/issues/779,
-    https://github.com/fmtlib/fmt/pull/780,
-    https://github.com/fmtlib/fmt/pull/790,
-    https://github.com/fmtlib/fmt/pull/792,
-    https://github.com/fmtlib/fmt/pull/800).
-    Thanks @Remotion, @gabime, @foonathan, @Dark-Passenger and @0x8000-0000.
-
-# 5.0.0 - 2018-05-21
-
--   Added a requirement for partial C++11 support, most importantly
-    variadic templates and type traits, and dropped `FMT_VARIADIC_*`
-    emulation macros. Variadic templates are available since GCC 4.4,
-    Clang 2.9 and MSVC 18.0 (2013). For older compilers use {fmt}
-    [version 4.x](https://github.com/fmtlib/fmt/releases/tag/4.1.0)
-    which continues to be maintained and works with C++98 compilers.
-
--   Renamed symbols to follow standard C++ naming conventions and
-    proposed a subset of the library for standardization in [P0645R2
-    Text Formatting](https://wg21.link/P0645).
-
--   Implemented `constexpr` parsing of format strings and [compile-time
-    format string
-    checks](https://fmt.dev/latest/api.html#compile-time-format-string-checks).
-    For example
-
-    ```c++
-    #include <fmt/format.h>
-
-    std::string s = format(fmt("{:d}"), "foo");
-    ```
-
-    gives a compile-time error because `d` is an invalid specifier for
-    strings ([godbolt](https://godbolt.org/g/rnCy9Q)):
-
-        ...
-        <source>:4:19: note: in instantiation of function template specialization 'fmt::v5::format<S, char [4]>' requested here
-          std::string s = format(fmt("{:d}"), "foo");
-                          ^
-        format.h:1337:13: note: non-constexpr function 'on_error' cannot be used in a constant expression
-            handler.on_error("invalid type specifier");
-
-    Compile-time checks require relaxed `constexpr` (C++14 feature)
-    support. If the latter is not available, checks will be performed at
-    runtime.
-
--   Separated format string parsing and formatting in the extension API
-    to enable compile-time format string processing. For example
-
-    ```c++
-    struct Answer {};
-
-    namespace fmt {
-    template <>
-    struct formatter<Answer> {
-      constexpr auto parse(parse_context& ctx) {
-        auto it = ctx.begin();
-        spec = *it;
-        if (spec != 'd' && spec != 's')
-          throw format_error("invalid specifier");
-        return ++it;
-      }
-
-      template <typename FormatContext>
-      auto format(Answer, FormatContext& ctx) {
-        return spec == 's' ?
-          format_to(ctx.begin(), "{}", "fourty-two") :
-          format_to(ctx.begin(), "{}", 42);
-      }
-
-      char spec = 0;
-    };
-    }
-
-    std::string s = format(fmt("{:x}"), Answer());
-    ```
-
-    gives a compile-time error due to invalid format specifier
-    ([godbolt](https://godbolt.org/g/2jQ1Dv)):
-
-        ...
-        <source>:12:45: error: expression '<throw-expression>' is not a constant expression
-               throw format_error("invalid specifier");
-
--   Added [iterator
-    support](https://fmt.dev/latest/api.html#output-iterator-support):
-
-    ```c++
-    #include <vector>
-    #include <fmt/format.h>
-
-    std::vector<char> out;
-    fmt::format_to(std::back_inserter(out), "{}", 42);
-    ```
-
--   Added the
-    [format_to_n](https://fmt.dev/latest/api.html#_CPPv2N3fmt11format_to_nE8OutputItNSt6size_tE11string_viewDpRK4Args)
-    function that restricts the output to the specified number of
-    characters (https://github.com/fmtlib/fmt/issues/298):
-
-    ```c++
-    char out[4];
-    fmt::format_to_n(out, sizeof(out), "{}", 12345);
-    // out == "1234" (without terminating '\0')
-    ```
-
--   Added the [formatted_size](
-    https://fmt.dev/latest/api.html#_CPPv2N3fmt14formatted_sizeE11string_viewDpRK4Args)
-    function for computing the output size:
-
-    ```c++
-    #include <fmt/format.h>
-
-    auto size = fmt::formatted_size("{}", 12345); // size == 5
-    ```
-
--   Improved compile times by reducing dependencies on standard headers
-    and providing a lightweight [core
-    API](https://fmt.dev/latest/api.html#core-api):
-
-    ```c++
-    #include <fmt/core.h>
-
-    fmt::print("The answer is {}.", 42);
-    ```
-
-    See [Compile time and code
-    bloat](https://github.com/fmtlib/fmt#compile-time-and-code-bloat).
-
--   Added the [make_format_args](
-    https://fmt.dev/latest/api.html#_CPPv2N3fmt16make_format_argsEDpRK4Args)
-    function for capturing formatting arguments:
-
-    ```c++
-    // Prints formatted error message.
-    void vreport_error(const char *format, fmt::format_args args) {
-      fmt::print("Error: ");
-      fmt::vprint(format, args);
-    }
-    template <typename... Args>
-    void report_error(const char *format, const Args & ... args) {
-      vreport_error(format, fmt::make_format_args(args...));
-    }
-    ```
-
--   Added the `make_printf_args` function for capturing `printf`
-    arguments (https://github.com/fmtlib/fmt/issues/687,
-    https://github.com/fmtlib/fmt/pull/694). Thanks @Kronuz.
-
--   Added prefix `v` to non-variadic functions taking `format_args` to
-    distinguish them from variadic ones:
-
-    ```c++
-    std::string vformat(string_view format_str, format_args args);
-
-    template <typename... Args>
-    std::string format(string_view format_str, const Args & ... args);
-    ```
-
--   Added experimental support for formatting ranges, containers and
-    tuple-like types in `fmt/ranges.h`
-    (https://github.com/fmtlib/fmt/pull/735):
+    auto monday = std::chrono::weekday(1);
+    fmt::print("{}\n", monday);   // prints "Mon"
+    fmt::print("{:L}\n", monday); // prints ""
+  }
+  ```
 
-    ```c++
-    #include <fmt/ranges.h>
+- Improved locale handling in chrono formatting
+  (https://github.com/fmtlib/fmt/issues/2337,
+  https://github.com/fmtlib/fmt/pull/2349,
+  https://github.com/fmtlib/fmt/pull/2350). Thanks @phprus.
 
-    std::vector<int> v = {1, 2, 3};
-    fmt::print("{}", v); // prints {1, 2, 3}
-    ```
+- Deprecated `fmt/locale.h` moving the formatting functions that take
+  a locale to `fmt/format.h` (`char`) and `fmt/xchar` (other
+  overloads). This doesn\'t introduce a dependency on `<locale>` so
+  there is virtually no compile time effect.
 
-    Thanks @Remotion.
+- Deprecated an undocumented `format_to` overload that takes
+  `basic_memory_buffer`.
 
--   Implemented `wchar_t` date and time formatting
-    (https://github.com/fmtlib/fmt/pull/712):
+- Made parameter order in `vformat_to` consistent with `format_to`
+  (https://github.com/fmtlib/fmt/issues/2327).
 
-    ```c++
-    #include <fmt/time.h>
+- Added support for time points with arbitrary durations
+  (https://github.com/fmtlib/fmt/issues/2208). For example:
 
-    std::time_t t = std::time(nullptr);
-    auto s = fmt::format(L"The date is {:%Y-%m-%d}.", *std::localtime(&t));
-    ```
+  ```c++
+  #include <fmt/chrono.h>
 
-    Thanks @DanielaE.
+  int main() {
+    using tp = std::chrono::time_point<
+      std::chrono::system_clock, std::chrono::seconds>;
+    fmt::print("{:%S}", tp(std::chrono::seconds(42)));
+  }
+  ```
 
--   Provided more wide string overloads
-    (https://github.com/fmtlib/fmt/pull/724). Thanks @DanielaE.
+  prints \"42\".
 
--   Switched from a custom null-terminated string view class to
-    `string_view` in the format API and provided `fmt::string_view`
-    which implements a subset of `std::string_view` API for pre-C++17
-    systems.
+- Formatting floating-point numbers no longer produces trailing zeros
+  by default for consistency with `std::format`. For example:
 
--   Added support for `std::experimental::string_view`
-    (https://github.com/fmtlib/fmt/pull/607):
+  ```c++
+  #include <fmt/core.h>
 
-    ```c++
-    #include <fmt/core.h>
-    #include <experimental/string_view>
+  int main() {
+    fmt::print("{0:.3}", 1.1);
+  }
+  ```
 
-    fmt::print("{}", std::experimental::string_view("foo"));
-    ```
+  prints \"1.1\". Use the `'#'` specifier to keep trailing zeros.
 
-    Thanks @virgiliofornazin.
+- Dropped a limit on the number of elements in a range and replaced
+  `{}` with `[]` as range delimiters for consistency with Python\'s
+  `str.format`.
 
--   Allowed mixing named and automatic arguments:
+- The `'L'` specifier for locale-specific numeric formatting can now
+  be combined with presentation specifiers as in `std::format`. For
+  example:
 
-    ```c++
-    fmt::format("{} {two}", 1, fmt::arg("two", 2));
-    ```
-
--   Removed the write API in favor of the [format
-    API](https://fmt.dev/latest/api.html#format-api) with compile-time
-    handling of format strings.
-
--   Disallowed formatting of multibyte strings into a wide character
-    target (https://github.com/fmtlib/fmt/pull/606).
-
--   Improved documentation
-    (https://github.com/fmtlib/fmt/pull/515,
-    https://github.com/fmtlib/fmt/issues/614,
-    https://github.com/fmtlib/fmt/pull/617,
-    https://github.com/fmtlib/fmt/pull/661,
-    https://github.com/fmtlib/fmt/pull/680).
-    Thanks @ibell, @mihaitodor and @johnthagen.
-
--   Implemented more efficient handling of large number of format
-    arguments.
-
--   Introduced an inline namespace for symbol versioning.
-
--   Added debug postfix `d` to the `fmt` library name
-    (https://github.com/fmtlib/fmt/issues/636).
-
--   Removed unnecessary `fmt/` prefix in includes
-    (https://github.com/fmtlib/fmt/pull/397). Thanks @chronoxor.
-
--   Moved `fmt/*.h` to `include/fmt/*.h` to prevent irrelevant files and
-    directories appearing on the include search paths when fmt is used
-    as a subproject and moved source files to the `src` directory.
-
--   Added qmake project file `support/fmt.pro`
-    (https://github.com/fmtlib/fmt/pull/641). Thanks @cowo78.
-
--   Added Gradle build file `support/build.gradle`
-    (https://github.com/fmtlib/fmt/pull/649). Thanks @luncliff.
-
--   Removed `FMT_CPPFORMAT` CMake option.
-
--   Fixed a name conflict with the macro `CHAR_WIDTH` in glibc
-    (https://github.com/fmtlib/fmt/pull/616). Thanks @aroig.
-
--   Fixed handling of nested braces in `fmt::join`
-    (https://github.com/fmtlib/fmt/issues/638).
-
--   Added `SOURCELINK_SUFFIX` for compatibility with Sphinx 1.5
-    (https://github.com/fmtlib/fmt/pull/497). Thanks @ginggs.
-
--   Added a missing `inline` in the header-only mode
-    (https://github.com/fmtlib/fmt/pull/626). Thanks @aroig.
-
--   Fixed various compiler warnings
-    (https://github.com/fmtlib/fmt/pull/640,
-    https://github.com/fmtlib/fmt/pull/656,
-    https://github.com/fmtlib/fmt/pull/679,
-    https://github.com/fmtlib/fmt/pull/681,
-    https://github.com/fmtlib/fmt/pull/705,
-    https://github.com/fmtlib/fmt/issues/715,
-    https://github.com/fmtlib/fmt/pull/717,
-    https://github.com/fmtlib/fmt/pull/720,
-    https://github.com/fmtlib/fmt/pull/723,
-    https://github.com/fmtlib/fmt/pull/726,
-    https://github.com/fmtlib/fmt/pull/730,
-    https://github.com/fmtlib/fmt/pull/739).
-    Thanks @peterbell10, @LarsGullik, @foonathan, @eliaskosunen,
-    @christianparpart, @DanielaE and @mwinterb.
-
--   Worked around an MSVC bug and fixed several warnings
-    (https://github.com/fmtlib/fmt/pull/653). Thanks @alabuzhev.
-
--   Worked around GCC bug 67371
-    (https://github.com/fmtlib/fmt/issues/682).
-
--   Fixed compilation with `-fno-exceptions`
-    (https://github.com/fmtlib/fmt/pull/655). Thanks @chenxiaolong.
-
--   Made `constexpr remove_prefix` gcc version check tighter
-    (https://github.com/fmtlib/fmt/issues/648).
-
--   Renamed internal type enum constants to prevent collision with
-    poorly written C libraries
-    (https://github.com/fmtlib/fmt/issues/644).
-
--   Added detection of `wostream operator<<`
-    (https://github.com/fmtlib/fmt/issues/650).
-
--   Fixed compilation on OpenBSD
-    (https://github.com/fmtlib/fmt/pull/660). Thanks @hubslave.
-
--   Fixed compilation on FreeBSD 12
-    (https://github.com/fmtlib/fmt/pull/732). Thanks @dankm.
-
--   Fixed compilation when there is a mismatch between `-std` options
-    between the library and user code
-    (https://github.com/fmtlib/fmt/issues/664).
-
--   Fixed compilation with GCC 7 and `-std=c++11`
-    (https://github.com/fmtlib/fmt/issues/734).
-
--   Improved generated binary code on GCC 7 and older
-    (https://github.com/fmtlib/fmt/issues/668).
-
--   Fixed handling of numeric alignment with no width
-    (https://github.com/fmtlib/fmt/issues/675).
-
--   Fixed handling of empty strings in UTF8/16 converters
-    (https://github.com/fmtlib/fmt/pull/676). Thanks @vgalka-sl.
-
--   Fixed formatting of an empty `string_view`
-    (https://github.com/fmtlib/fmt/issues/689).
-
--   Fixed detection of `string_view` on libc++
-    (https://github.com/fmtlib/fmt/issues/686).
-
--   Fixed DLL issues (https://github.com/fmtlib/fmt/pull/696).
-    Thanks @sebkoenig.
-
--   Fixed compile checks for mixing narrow and wide strings
-    (https://github.com/fmtlib/fmt/issues/690).
-
--   Disabled unsafe implicit conversion to `std::string`
-    (https://github.com/fmtlib/fmt/issues/729).
-
--   Fixed handling of reused format specs (as in `fmt::join`) for
-    pointers (https://github.com/fmtlib/fmt/pull/725). Thanks @mwinterb.
-
--   Fixed installation of `fmt/ranges.h`
-    (https://github.com/fmtlib/fmt/pull/738). Thanks @sv1990.
-
-# 4.1.0 - 2017-12-20
-
--   Added `fmt::to_wstring()` in addition to `fmt::to_string()`
-    (https://github.com/fmtlib/fmt/pull/559). Thanks @alabuzhev.
--   Added support for C++17 `std::string_view`
-    (https://github.com/fmtlib/fmt/pull/571 and
-    https://github.com/fmtlib/fmt/pull/578).
-    Thanks @thelostt and @mwinterb.
--   Enabled stream exceptions to catch errors
-    (https://github.com/fmtlib/fmt/issues/581). Thanks @crusader-mike.
--   Allowed formatting of class hierarchies with `fmt::format_arg()`
-    (https://github.com/fmtlib/fmt/pull/547). Thanks @rollbear.
--   Removed limitations on character types
-    (https://github.com/fmtlib/fmt/pull/563). Thanks @Yelnats321.
--   Conditionally enabled use of `std::allocator_traits`
-    (https://github.com/fmtlib/fmt/pull/583). Thanks @mwinterb.
--   Added support for `const` variadic member function emulation with
-    `FMT_VARIADIC_CONST`
-    (https://github.com/fmtlib/fmt/pull/591). Thanks @ludekvodicka.
--   Various bugfixes: bad overflow check, unsupported implicit type
-    conversion when determining formatting function, test segfaults
-    (https://github.com/fmtlib/fmt/issues/551), ill-formed
-    macros (https://github.com/fmtlib/fmt/pull/542) and
-    ambiguous overloads
-    (https://github.com/fmtlib/fmt/issues/580). Thanks @xylosper.
--   Prevented warnings on MSVC
-    (https://github.com/fmtlib/fmt/pull/605,
-    https://github.com/fmtlib/fmt/pull/602, and
-    https://github.com/fmtlib/fmt/pull/545), clang
-    (https://github.com/fmtlib/fmt/pull/582), GCC
-    (https://github.com/fmtlib/fmt/issues/573), various
-    conversion warnings (https://github.com/fmtlib/fmt/pull/609,
-    https://github.com/fmtlib/fmt/pull/567,
-    https://github.com/fmtlib/fmt/pull/553 and
-    https://github.com/fmtlib/fmt/pull/553), and added
-    `override` and `[[noreturn]]`
-    (https://github.com/fmtlib/fmt/pull/549 and
-    https://github.com/fmtlib/fmt/issues/555).
-    Thanks @alabuzhev, @virgiliofornazin, @alexanderbock, @yumetodo, @VaderY,
-    @jpcima, @thelostt and @Manu343726.
--   Improved CMake: Used `GNUInstallDirs` to set installation location
-    (https://github.com/fmtlib/fmt/pull/610) and fixed warnings
-    (https://github.com/fmtlib/fmt/pull/536 and
-    https://github.com/fmtlib/fmt/pull/556).
-    Thanks @mikecrowe, @evgen231 and @henryiii.
-
-# 4.0.0 - 2017-06-27
-
--   Removed old compatibility headers `cppformat/*.h` and CMake options
-    (https://github.com/fmtlib/fmt/pull/527). Thanks @maddinat0r.
-
--   Added `string.h` containing `fmt::to_string()` as alternative to
-    `std::to_string()` as well as other string writer functionality
-    (https://github.com/fmtlib/fmt/issues/326 and
-    https://github.com/fmtlib/fmt/pull/441):
-
-    ```c++
-    #include "fmt/string.h"
-
-    std::string answer = fmt::to_string(42);
-    ```
-
-    Thanks @glebov-andrey.
-
--   Moved `fmt::printf()` to new `printf.h` header and allowed `%s` as
-    generic specifier (https://github.com/fmtlib/fmt/pull/453),
-    made `%.f` more conformant to regular `printf()`
-    (https://github.com/fmtlib/fmt/pull/490), added custom
-    writer support (https://github.com/fmtlib/fmt/issues/476)
-    and implemented missing custom argument formatting
-    (https://github.com/fmtlib/fmt/pull/339 and
-    https://github.com/fmtlib/fmt/pull/340):
-
-    ```c++
-    #include "fmt/printf.h"
-
-    // %s format specifier can be used with any argument type.
-    fmt::printf("%s", 42);
-    ```
-
-    Thanks @mojoBrendan, @manylegged and @spacemoose.
-    See also https://github.com/fmtlib/fmt/issues/360,
-    https://github.com/fmtlib/fmt/issues/335 and
-    https://github.com/fmtlib/fmt/issues/331.
-
--   Added `container.h` containing a `BasicContainerWriter` to write to
-    containers like `std::vector`
-    (https://github.com/fmtlib/fmt/pull/450). Thanks @polyvertex.
-
--   Added `fmt::join()` function that takes a range and formats its
-    elements separated by a given string
-    (https://github.com/fmtlib/fmt/pull/466):
-
-    ```c++
-    #include "fmt/format.h"
-
-    std::vector<double> v = {1.2, 3.4, 5.6};
-    // Prints "(+01.20, +03.40, +05.60)".
-    fmt::print("({:+06.2f})", fmt::join(v.begin(), v.end(), ", "));
-    ```
-
-    Thanks @olivier80.
-
--   Added support for custom formatting specifications to simplify
-    customization of built-in formatting
-    (https://github.com/fmtlib/fmt/pull/444). Thanks @polyvertex.
-    See also https://github.com/fmtlib/fmt/issues/439.
-
--   Added `fmt::format_system_error()` for error code formatting
-    (https://github.com/fmtlib/fmt/issues/323 and
-    https://github.com/fmtlib/fmt/pull/526). Thanks @maddinat0r.
-
--   Added thread-safe `fmt::localtime()` and `fmt::gmtime()` as
-    replacement for the standard version to `time.h`
-    (https://github.com/fmtlib/fmt/pull/396). Thanks @codicodi.
-
--   Internal improvements to `NamedArg` and `ArgLists`
-    (https://github.com/fmtlib/fmt/pull/389 and
-    https://github.com/fmtlib/fmt/pull/390). Thanks @chronoxor.
-
--   Fixed crash due to bug in `FormatBuf`
-    (https://github.com/fmtlib/fmt/pull/493). Thanks @effzeh. See also
-    https://github.com/fmtlib/fmt/issues/480 and
-    https://github.com/fmtlib/fmt/issues/491.
-
--   Fixed handling of wide strings in `fmt::StringWriter`.
-
--   Improved compiler error messages
-    (https://github.com/fmtlib/fmt/issues/357).
-
--   Fixed various warnings and issues with various compilers
-    (https://github.com/fmtlib/fmt/pull/494,
-    https://github.com/fmtlib/fmt/pull/499,
-    https://github.com/fmtlib/fmt/pull/483,
-    https://github.com/fmtlib/fmt/pull/485,
-    https://github.com/fmtlib/fmt/pull/482,
-    https://github.com/fmtlib/fmt/pull/475,
-    https://github.com/fmtlib/fmt/pull/473 and
-    https://github.com/fmtlib/fmt/pull/414).
-    Thanks @chronoxor, @zhaohuaxishi, @pkestene, @dschmidt and @0x414c.
-
--   Improved CMake: targets are now namespaced
-    (https://github.com/fmtlib/fmt/pull/511 and
-    https://github.com/fmtlib/fmt/pull/513), supported
-    header-only `printf.h`
-    (https://github.com/fmtlib/fmt/pull/354), fixed issue with
-    minimal supported library subset
-    (https://github.com/fmtlib/fmt/issues/418,
-    https://github.com/fmtlib/fmt/pull/419 and
-    https://github.com/fmtlib/fmt/pull/420).
-    Thanks @bjoernthiel, @niosHD, @LogicalKnight and @alabuzhev.
-
--   Improved documentation (https://github.com/fmtlib/fmt/pull/393).
-    Thanks @pwm1234.
-
-# 3.0.2 - 2017-06-14
-
--   Added `FMT_VERSION` macro
-    (https://github.com/fmtlib/fmt/issues/411).
--   Used `FMT_NULL` instead of literal `0`
-    (https://github.com/fmtlib/fmt/pull/409). Thanks @alabuzhev.
--   Added extern templates for `format_float`
-    (https://github.com/fmtlib/fmt/issues/413).
--   Fixed implicit conversion issue
-    (https://github.com/fmtlib/fmt/issues/507).
--   Fixed signbit detection
-    (https://github.com/fmtlib/fmt/issues/423).
--   Fixed naming collision
-    (https://github.com/fmtlib/fmt/issues/425).
--   Fixed missing intrinsic for C++/CLI
-    (https://github.com/fmtlib/fmt/pull/457). Thanks @calumr.
--   Fixed Android detection
-    (https://github.com/fmtlib/fmt/pull/458). Thanks @Gachapen.
--   Use lean `windows.h` if not in header-only mode
-    (https://github.com/fmtlib/fmt/pull/503). Thanks @Quentin01.
--   Fixed issue with CMake exporting C++11 flag
-    (https://github.com/fmtlib/fmt/pull/455). Thanks @EricWF.
--   Fixed issue with nvcc and MSVC compiler bug and MinGW
-    (https://github.com/fmtlib/fmt/issues/505).
--   Fixed DLL issues (https://github.com/fmtlib/fmt/pull/469 and
-    https://github.com/fmtlib/fmt/pull/502).
-    Thanks @richardeakin and @AndreasSchoenle.
--   Fixed test compilation under FreeBSD
-    (https://github.com/fmtlib/fmt/issues/433).
--   Fixed various warnings
-    (https://github.com/fmtlib/fmt/pull/403,
-    https://github.com/fmtlib/fmt/pull/410 and
-    https://github.com/fmtlib/fmt/pull/510).
-    Thanks @Lecetem, @chenhayat and @trozen.
--   Worked around a broken `__builtin_clz` in clang with MS codegen
-    (https://github.com/fmtlib/fmt/issues/519).
--   Removed redundant include
-    (https://github.com/fmtlib/fmt/issues/479).
--   Fixed documentation issues.
-
-# 3.0.1 - 2016-11-01
-
--   Fixed handling of thousands separator
-    (https://github.com/fmtlib/fmt/issues/353).
--   Fixed handling of `unsigned char` strings
-    (https://github.com/fmtlib/fmt/issues/373).
--   Corrected buffer growth when formatting time
-    (https://github.com/fmtlib/fmt/issues/367).
--   Removed warnings under MSVC and clang
-    (https://github.com/fmtlib/fmt/issues/318,
-    https://github.com/fmtlib/fmt/issues/250, also merged
-    https://github.com/fmtlib/fmt/pull/385 and
-    https://github.com/fmtlib/fmt/pull/361).
-    Thanks @jcelerier and @nmoehrle.
--   Fixed compilation issues under Android
-    (https://github.com/fmtlib/fmt/pull/327,
-    https://github.com/fmtlib/fmt/issues/345 and
-    https://github.com/fmtlib/fmt/pull/381), FreeBSD
-    (https://github.com/fmtlib/fmt/pull/358), Cygwin
-    (https://github.com/fmtlib/fmt/issues/388), MinGW
-    (https://github.com/fmtlib/fmt/issues/355) as well as other
-    issues (https://github.com/fmtlib/fmt/issues/350,
-    https://github.com/fmtlib/fmt/issues/355,
-    https://github.com/fmtlib/fmt/pull/348,
-    https://github.com/fmtlib/fmt/pull/402,
-    https://github.com/fmtlib/fmt/pull/405).
-    Thanks @dpantele, @hghwng, @arvedarved, @LogicalKnight and @JanHellwig.
--   Fixed some documentation issues and extended specification
-    (https://github.com/fmtlib/fmt/issues/320,
-    https://github.com/fmtlib/fmt/pull/333,
-    https://github.com/fmtlib/fmt/issues/347,
-    https://github.com/fmtlib/fmt/pull/362). Thanks @smellman.
-
-# 3.0.0 - 2016-05-07
-
--   The project has been renamed from C++ Format (cppformat) to fmt for
-    consistency with the used namespace and macro prefix
-    (https://github.com/fmtlib/fmt/issues/307). Library headers
-    are now located in the `fmt` directory:
-
-    ```c++
-    #include "fmt/format.h"
-    ```
-
-    Including `format.h` from the `cppformat` directory is deprecated
-    but works via a proxy header which will be removed in the next major
-    version.
-
-    The documentation is now available at <https://fmt.dev>.
-
--   Added support for
-    [strftime](http://en.cppreference.com/w/cpp/chrono/c/strftime)-like
-    [date and time
-    formatting](https://fmt.dev/3.0.0/api.html#date-and-time-formatting)
-    (https://github.com/fmtlib/fmt/issues/283):
-
-    ```c++
-    #include "fmt/time.h"
-
-    std::time_t t = std::time(nullptr);
-    // Prints "The date is 2016-04-29." (with the current date)
-    fmt::print("The date is {:%Y-%m-%d}.", *std::localtime(&t));
-    ```
-
--   `std::ostream` support including formatting of user-defined types
-    that provide overloaded `operator<<` has been moved to
-    `fmt/ostream.h`:
-
-    ```c++
-    #include "fmt/ostream.h"
-
-    class Date {
-      int year_, month_, day_;
-    public:
-      Date(int year, int month, int day) : year_(year), month_(month), day_(day) {}
-
-      friend std::ostream &operator<<(std::ostream &os, const Date &d) {
-        return os << d.year_ << '-' << d.month_ << '-' << d.day_;
-      }
-    };
-
-    std::string s = fmt::format("The date is {}", Date(2012, 12, 9));
-    // s == "The date is 2012-12-9"
-    ```
-
--   Added support for [custom argument
-    formatters](https://fmt.dev/3.0.0/api.html#argument-formatters)
-    (https://github.com/fmtlib/fmt/issues/235).
-
--   Added support for locale-specific integer formatting with the `n`
-    specifier (https://github.com/fmtlib/fmt/issues/305):
-
-    ```c++
-    std::setlocale(LC_ALL, "en_US.utf8");
-    fmt::print("cppformat: {:n}\n", 1234567); // prints 1,234,567
-    ```
-
--   Sign is now preserved when formatting an integer with an incorrect
-    `printf` format specifier
-    (https://github.com/fmtlib/fmt/issues/265):
-
-    ```c++
-    fmt::printf("%lld", -42); // prints -42
-    ```
-
-    Note that it would be an undefined behavior in `std::printf`.
-
--   Length modifiers such as `ll` are now optional in printf formatting
-    functions and the correct type is determined automatically
-    (https://github.com/fmtlib/fmt/issues/255):
-
-    ```c++
-    fmt::printf("%d", std::numeric_limits<long long>::max());
-    ```
-
-    Note that it would be an undefined behavior in `std::printf`.
-
--   Added initial support for custom formatters
-    (https://github.com/fmtlib/fmt/issues/231).
-
--   Fixed detection of user-defined literal support on Intel C++
-    compiler (https://github.com/fmtlib/fmt/issues/311,
-    https://github.com/fmtlib/fmt/pull/312).
-    Thanks @dean0x7d and @speth.
-
--   Reduced compile time
-    (https://github.com/fmtlib/fmt/pull/243,
-    https://github.com/fmtlib/fmt/pull/249,
-    https://github.com/fmtlib/fmt/issues/317):
-
-    ![](https://cloud.githubusercontent.com/assets/4831417/11614060/b9e826d2-9c36-11e5-8666-d4131bf503ef.png)
-
-    ![](https://cloud.githubusercontent.com/assets/4831417/11614080/6ac903cc-9c37-11e5-8165-26df6efae364.png)
-
-    Thanks @dean0x7d.
-
--   Compile test fixes (https://github.com/fmtlib/fmt/pull/313).
-    Thanks @dean0x7d.
-
--   Documentation fixes (https://github.com/fmtlib/fmt/pull/239,
-    https://github.com/fmtlib/fmt/issues/248,
-    https://github.com/fmtlib/fmt/issues/252,
-    https://github.com/fmtlib/fmt/pull/258,
-    https://github.com/fmtlib/fmt/issues/260,
-    https://github.com/fmtlib/fmt/issues/301,
-    https://github.com/fmtlib/fmt/pull/309).
-    Thanks @ReadmeCritic @Gachapen and @jwilk.
-
--   Fixed compiler and sanitizer warnings
-    (https://github.com/fmtlib/fmt/issues/244,
-    https://github.com/fmtlib/fmt/pull/256,
-    https://github.com/fmtlib/fmt/pull/259,
-    https://github.com/fmtlib/fmt/issues/263,
-    https://github.com/fmtlib/fmt/issues/274,
-    https://github.com/fmtlib/fmt/pull/277,
-    https://github.com/fmtlib/fmt/pull/286,
-    https://github.com/fmtlib/fmt/issues/291,
-    https://github.com/fmtlib/fmt/issues/296,
-    https://github.com/fmtlib/fmt/issues/308).
-    Thanks @mwinterb, @pweiskircher and @Naios.
-
--   Improved compatibility with Windows Store apps
-    (https://github.com/fmtlib/fmt/issues/280,
-    https://github.com/fmtlib/fmt/pull/285) Thanks @mwinterb.
-
--   Added tests of compatibility with older C++ standards
-    (https://github.com/fmtlib/fmt/pull/273). Thanks @niosHD.
-
--   Fixed Android build
-    (https://github.com/fmtlib/fmt/pull/271). Thanks @newnon.
-
--   Changed `ArgMap` to be backed by a vector instead of a map.
-    (https://github.com/fmtlib/fmt/issues/261,
-    https://github.com/fmtlib/fmt/pull/262). Thanks @mwinterb.
-
--   Added `fprintf` overload that writes to a `std::ostream`
-    (https://github.com/fmtlib/fmt/pull/251).
-    Thanks @nickhutchinson.
-
--   Export symbols when building a Windows DLL
-    (https://github.com/fmtlib/fmt/pull/245).
-    Thanks @macdems.
-
--   Fixed compilation on Cygwin
-    (https://github.com/fmtlib/fmt/issues/304).
-
--   Implemented a workaround for a bug in Apple LLVM version 4.2 of
-    clang (https://github.com/fmtlib/fmt/issues/276).
-
--   Implemented a workaround for Google Test bug
-    https://github.com/google/googletest/issues/705 on gcc 6
-    (https://github.com/fmtlib/fmt/issues/268). Thanks @octoploid.
-
--   Removed Biicode support because the latter has been discontinued.
-
-# 2.1.1 - 2016-04-11
-
--   The install location for generated CMake files is now configurable
-    via the `FMT_CMAKE_DIR` CMake variable
-    (https://github.com/fmtlib/fmt/pull/299). Thanks @niosHD.
--   Documentation fixes
-    (https://github.com/fmtlib/fmt/issues/252).
-
-# 2.1.0 - 2016-03-21
-
--   Project layout and build system improvements
-    (https://github.com/fmtlib/fmt/pull/267):
-
-    -   The code have been moved to the `cppformat` directory. Including
-        `format.h` from the top-level directory is deprecated but works
-        via a proxy header which will be removed in the next major
-        version.
-    -   C++ Format CMake targets now have proper interface definitions.
-    -   Installed version of the library now supports the header-only
-        configuration.
-    -   Targets `doc`, `install`, and `test` are now disabled if C++
-        Format is included as a CMake subproject. They can be enabled by
-        setting `FMT_DOC`, `FMT_INSTALL`, and `FMT_TEST` in the parent
-        project.
-
-    Thanks @niosHD.
-
-# 2.0.1 - 2016-03-13
-
--   Improved CMake find and package support
-    (https://github.com/fmtlib/fmt/issues/264). Thanks @niosHD.
--   Fix compile error with Android NDK and mingw32
-    (https://github.com/fmtlib/fmt/issues/241). Thanks @Gachapen.
--   Documentation fixes
-    (https://github.com/fmtlib/fmt/issues/248,
-    https://github.com/fmtlib/fmt/issues/260).
-
-# 2.0.0 - 2015-12-01
-
-## General
-
--   \[Breaking\] Named arguments
-    (https://github.com/fmtlib/fmt/pull/169,
-    https://github.com/fmtlib/fmt/pull/173,
-    https://github.com/fmtlib/fmt/pull/174):
-
-    ```c++
-    fmt::print("The answer is {answer}.", fmt::arg("answer", 42));
-    ```
-
-    Thanks @jamboree.
-
--   \[Experimental\] User-defined literals for format and named
-    arguments (https://github.com/fmtlib/fmt/pull/204,
-    https://github.com/fmtlib/fmt/pull/206,
-    https://github.com/fmtlib/fmt/pull/207):
-
-    ```c++
-    using namespace fmt::literals;
-    fmt::print("The answer is {answer}.", "answer"_a=42);
-    ```
-
-    Thanks @dean0x7d.
-
--   \[Breaking\] Formatting of more than 16 arguments is now supported
-    when using variadic templates
-    (https://github.com/fmtlib/fmt/issues/141). Thanks @Shauren.
-
--   Runtime width specification
-    (https://github.com/fmtlib/fmt/pull/168):
-
-    ```c++
-    fmt::format("{0:{1}}", 42, 5); // gives "   42"
-    ```
-
-    Thanks @jamboree.
-
--   \[Breaking\] Enums are now formatted with an overloaded
-    `std::ostream` insertion operator (`operator<<`) if available
-    (https://github.com/fmtlib/fmt/issues/232).
-
--   \[Breaking\] Changed default `bool` format to textual, \"true\" or
-    \"false\" (https://github.com/fmtlib/fmt/issues/170):
-
-    ```c++
-    fmt::print("{}", true); // prints "true"
-    ```
-
-    To print `bool` as a number use numeric format specifier such as
-    `d`:
-
-    ```c++
-    fmt::print("{:d}", true); // prints "1"
-    ```
-
--   `fmt::printf` and `fmt::sprintf` now support formatting of `bool`
-    with the `%s` specifier giving textual output, \"true\" or \"false\"
-    (https://github.com/fmtlib/fmt/pull/223):
-
-    ```c++
-    fmt::printf("%s", true); // prints "true"
-    ```
-
-    Thanks @LarsGullik.
-
--   \[Breaking\] `signed char` and `unsigned char` are now formatted as
-    integers by default
-    (https://github.com/fmtlib/fmt/pull/217).
-
--   \[Breaking\] Pointers to C strings can now be formatted with the `p`
-    specifier (https://github.com/fmtlib/fmt/pull/223):
-
-    ```c++
-    fmt::print("{:p}", "test"); // prints pointer value
-    ```
-
-    Thanks @LarsGullik.
-
--   \[Breaking\] `fmt::printf` and `fmt::sprintf` now print null
-    pointers as `(nil)` and null strings as `(null)` for consistency
-    with glibc (https://github.com/fmtlib/fmt/pull/226).
-    Thanks @LarsGullik.
-
--   \[Breaking\] `fmt::(s)printf` now supports formatting of objects of
-    user-defined types that provide an overloaded `std::ostream`
-    insertion operator (`operator<<`)
-    (https://github.com/fmtlib/fmt/issues/201):
-
-    ```c++
-    fmt::printf("The date is %s", Date(2012, 12, 9));
-    ```
-
--   \[Breaking\] The `Buffer` template is now part of the public API and
-    can be used to implement custom memory buffers
-    (https://github.com/fmtlib/fmt/issues/140). Thanks @polyvertex.
-
--   \[Breaking\] Improved compatibility between `BasicStringRef` and
-    [std::experimental::basic_string_view](
-    http://en.cppreference.com/w/cpp/experimental/basic_string_view)
-    (https://github.com/fmtlib/fmt/issues/100,
-    https://github.com/fmtlib/fmt/issues/159,
-    https://github.com/fmtlib/fmt/issues/183):
-
-    -   Comparison operators now compare string content, not pointers
-    -   `BasicStringRef::c_str` replaced by `BasicStringRef::data`
-    -   `BasicStringRef` is no longer assumed to be null-terminated
-
-    References to null-terminated strings are now represented by a new
-    class, `BasicCStringRef`.
-
--   Dependency on pthreads introduced by Google Test is now optional
-    (https://github.com/fmtlib/fmt/issues/185).
-
--   New CMake options `FMT_DOC`, `FMT_INSTALL` and `FMT_TEST` to control
-    generation of `doc`, `install` and `test` targets respectively, on
-    by default (https://github.com/fmtlib/fmt/issues/197,
-    https://github.com/fmtlib/fmt/issues/198,
-    https://github.com/fmtlib/fmt/issues/200). Thanks @maddinat0r.
-
--   `noexcept` is now used when compiling with MSVC2015
-    (https://github.com/fmtlib/fmt/pull/215). Thanks @dmkrepo.
-
--   Added an option to disable use of `windows.h` when
-    `FMT_USE_WINDOWS_H` is defined as 0 before including `format.h`
-    (https://github.com/fmtlib/fmt/issues/171). Thanks @alfps.
-
--   \[Breaking\] `windows.h` is now included with `NOMINMAX` unless
-    `FMT_WIN_MINMAX` is defined. This is done to prevent breaking code
-    using `std::min` and `std::max` and only affects the header-only
-    configuration (https://github.com/fmtlib/fmt/issues/152,
-    https://github.com/fmtlib/fmt/pull/153,
-    https://github.com/fmtlib/fmt/pull/154). Thanks @DevO2012.
-
--   Improved support for custom character types
-    (https://github.com/fmtlib/fmt/issues/171). Thanks @alfps.
-
--   Added an option to disable use of IOStreams when `FMT_USE_IOSTREAMS`
-    is defined as 0 before including `format.h`
-    (https://github.com/fmtlib/fmt/issues/205,
-    https://github.com/fmtlib/fmt/pull/208). Thanks @JodiTheTigger.
-
--   Improved detection of `isnan`, `isinf` and `signbit`.
-
-## Optimization
-
--   Made formatting of user-defined types more efficient with a custom
-    stream buffer (https://github.com/fmtlib/fmt/issues/92,
-    https://github.com/fmtlib/fmt/pull/230). Thanks @NotImplemented.
--   Further improved performance of `fmt::Writer` on integer formatting
-    and fixed a minor regression. Now it is \~7% faster than
-    `karma::generate` on Karma\'s benchmark
-    (https://github.com/fmtlib/fmt/issues/186).
--   \[Breaking\] Reduced [compiled code
-    size](https://github.com/fmtlib/fmt#compile-time-and-code-bloat)
-    (https://github.com/fmtlib/fmt/issues/143,
-    https://github.com/fmtlib/fmt/pull/149).
-
-## Distribution
-
--   \[Breaking\] Headers are now installed in
-    `${CMAKE_INSTALL_PREFIX}/include/cppformat`
-    (https://github.com/fmtlib/fmt/issues/178). Thanks @jackyf.
-
--   \[Breaking\] Changed the library name from `format` to `cppformat`
-    for consistency with the project name and to avoid potential
-    conflicts (https://github.com/fmtlib/fmt/issues/178).
-    Thanks @jackyf.
-
--   C++ Format is now available in [Debian](https://www.debian.org/)
-    GNU/Linux
-    ([stretch](https://packages.debian.org/source/stretch/cppformat),
-    [sid](https://packages.debian.org/source/sid/cppformat)) and derived
-    distributions such as
-    [Ubuntu](https://launchpad.net/ubuntu/+source/cppformat) 15.10 and
-    later (https://github.com/fmtlib/fmt/issues/155):
-
-        $ sudo apt-get install libcppformat1-dev
-
-    Thanks @jackyf.
-
--   [Packages for Fedora and
-    RHEL](https://admin.fedoraproject.org/pkgdb/package/cppformat/) are
-    now available. Thanks Dave Johansen.
-
--   C++ Format can now be installed via [Homebrew](http://brew.sh/) on
-    OS X (https://github.com/fmtlib/fmt/issues/157):
-
-        $ brew install cppformat
-
-    Thanks @ortho and Anatoliy Bulukin.
-
-## Documentation
-
--   Migrated from ReadTheDocs to GitHub Pages for better responsiveness
-    and reliability (https://github.com/fmtlib/fmt/issues/128).
-    New documentation address is <http://cppformat.github.io/>.
--   Added [Building thedocumentation](
-    https://fmt.dev/2.0.0/usage.html#building-the-documentation)
-    section to the documentation.
--   Documentation build script is now compatible with Python 3 and newer
-    pip versions. (https://github.com/fmtlib/fmt/pull/189,
-    https://github.com/fmtlib/fmt/issues/209).
-    Thanks @JodiTheTigger and @xentec.
--   Documentation fixes and improvements
-    (https://github.com/fmtlib/fmt/issues/36,
-    https://github.com/fmtlib/fmt/issues/75,
-    https://github.com/fmtlib/fmt/issues/125,
-    https://github.com/fmtlib/fmt/pull/160,
-    https://github.com/fmtlib/fmt/pull/161,
-    https://github.com/fmtlib/fmt/issues/162,
-    https://github.com/fmtlib/fmt/issues/165,
-    https://github.com/fmtlib/fmt/issues/210). 
-    Thanks @syohex.
--   Fixed out-of-tree documentation build
-    (https://github.com/fmtlib/fmt/issues/177). Thanks @jackyf.
-
-## Fixes
-
--   Fixed `initializer_list` detection
-    (https://github.com/fmtlib/fmt/issues/136). Thanks @Gachapen.
-
--   \[Breaking\] Fixed formatting of enums with numeric format
-    specifiers in `fmt::(s)printf`
-    (https://github.com/fmtlib/fmt/issues/131,
-    https://github.com/fmtlib/fmt/issues/139):
-
-    ```c++
-    enum { ANSWER = 42 };
-    fmt::printf("%d", ANSWER);
-    ```
-
-    Thanks @Naios.
-
--   Improved compatibility with old versions of MinGW
-    (https://github.com/fmtlib/fmt/issues/129,
-    https://github.com/fmtlib/fmt/pull/130,
-    https://github.com/fmtlib/fmt/issues/132). Thanks @cstamford.
-
--   Fixed a compile error on MSVC with disabled exceptions
-    (https://github.com/fmtlib/fmt/issues/144).
-
--   Added a workaround for broken implementation of variadic templates
-    in MSVC2012 (https://github.com/fmtlib/fmt/issues/148).
-
--   Placed the anonymous namespace within `fmt` namespace for the
-    header-only configuration (https://github.com/fmtlib/fmt/issues/171).
-    Thanks @alfps.
-
--   Fixed issues reported by Coverity Scan
-    (https://github.com/fmtlib/fmt/issues/187,
-    https://github.com/fmtlib/fmt/issues/192).
-
--   Implemented a workaround for a name lookup bug in MSVC2010
-    (https://github.com/fmtlib/fmt/issues/188).
-
--   Fixed compiler warnings
-    (https://github.com/fmtlib/fmt/issues/95,
-    https://github.com/fmtlib/fmt/issues/96,
-    https://github.com/fmtlib/fmt/pull/114,
-    https://github.com/fmtlib/fmt/issues/135,
-    https://github.com/fmtlib/fmt/issues/142,
-    https://github.com/fmtlib/fmt/issues/145,
-    https://github.com/fmtlib/fmt/issues/146,
-    https://github.com/fmtlib/fmt/issues/158,
-    https://github.com/fmtlib/fmt/issues/163,
-    https://github.com/fmtlib/fmt/issues/175,
-    https://github.com/fmtlib/fmt/issues/190,
-    https://github.com/fmtlib/fmt/pull/191,
-    https://github.com/fmtlib/fmt/issues/194,
-    https://github.com/fmtlib/fmt/pull/196,
-    https://github.com/fmtlib/fmt/issues/216,
-    https://github.com/fmtlib/fmt/pull/218,
-    https://github.com/fmtlib/fmt/pull/220,
-    https://github.com/fmtlib/fmt/pull/229,
-    https://github.com/fmtlib/fmt/issues/233,
-    https://github.com/fmtlib/fmt/issues/234,
-    https://github.com/fmtlib/fmt/pull/236,
-    https://github.com/fmtlib/fmt/issues/281,
-    https://github.com/fmtlib/fmt/issues/289).
-    Thanks @seanmiddleditch, @dixlorenz, @CarterLi, @Naios, @fmatthew5876,
-    @LevskiWeng, @rpopescu, @gabime, @cubicool, @jkflying, @LogicalKnight,
-    @inguin and @Jopie64.
-
--   Fixed portability issues (mostly causing test failures) on ARM,
-    ppc64, ppc64le, s390x and SunOS 5.11 i386
-    (https://github.com/fmtlib/fmt/issues/138,
-    https://github.com/fmtlib/fmt/issues/179,
-    https://github.com/fmtlib/fmt/issues/180,
-    https://github.com/fmtlib/fmt/issues/202,
-    https://github.com/fmtlib/fmt/issues/225, [Red Hat Bugzilla
-    Bug 1260297](https://bugzilla.redhat.com/show_bug.cgi?id=1260297)).
-    Thanks @Naios, @jackyf and Dave Johansen.
-
--   Fixed a name conflict with macro `free` defined in `crtdbg.h` when
-    `_CRTDBG_MAP_ALLOC` is set (https://github.com/fmtlib/fmt/issues/211).
-
--   Fixed shared library build on OS X
-    (https://github.com/fmtlib/fmt/pull/212). Thanks @dean0x7d.
-
--   Fixed an overload conflict on MSVC when `/Zc:wchar_t-` option is
-    specified (https://github.com/fmtlib/fmt/pull/214).
-    Thanks @slavanap.
-
--   Improved compatibility with MSVC 2008
-    (https://github.com/fmtlib/fmt/pull/236). Thanks @Jopie64.
-
--   Improved compatibility with bcc32
-    (https://github.com/fmtlib/fmt/issues/227).
-
--   Fixed `static_assert` detection on Clang
-    (https://github.com/fmtlib/fmt/pull/228). Thanks @dean0x7d.
-
-# 1.1.0 - 2015-03-06
-
--   Added `BasicArrayWriter`, a class template that provides operations
-    for formatting and writing data into a fixed-size array
-    (https://github.com/fmtlib/fmt/issues/105 and
-    https://github.com/fmtlib/fmt/issues/122):
-
-    ```c++
-    char buffer[100];
-    fmt::ArrayWriter w(buffer);
-    w.write("The answer is {}", 42);
-    ```
-
--   Added [0 A.D.](http://play0ad.com/) and [PenUltima Online
-    (POL)](http://www.polserver.com/) to the list of notable projects
-    using C++ Format.
-
--   C++ Format now uses MSVC intrinsics for better formatting performance
-    (https://github.com/fmtlib/fmt/pull/115,
-    https://github.com/fmtlib/fmt/pull/116,
-    https://github.com/fmtlib/fmt/pull/118 and
-    https://github.com/fmtlib/fmt/pull/121). Previously these
-    optimizations where only used on GCC and Clang.
-    Thanks @CarterLi and @objectx.
-
--   CMake install target
-    (https://github.com/fmtlib/fmt/pull/119). Thanks @TrentHouliston.
-
-    You can now install C++ Format with `make install` command.
-
--   Improved [Biicode](http://www.biicode.com/) support
-    (https://github.com/fmtlib/fmt/pull/98 and
-    https://github.com/fmtlib/fmt/pull/104).
-    Thanks @MariadeAnton and @franramirez688.
-
--   Improved support for building with [Android NDK](
-    https://developer.android.com/tools/sdk/ndk/index.html)
-    (https://github.com/fmtlib/fmt/pull/107). Thanks @newnon.
-
-    The [android-ndk-example](https://github.com/fmtlib/android-ndk-example)
-    repository provides and example of using C++ Format with Android NDK:
-
-    ![](https://raw.githubusercontent.com/fmtlib/android-ndk-example/master/screenshot.png)
-
--   Improved documentation of `SystemError` and `WindowsError`
-    (https://github.com/fmtlib/fmt/issues/54).
-
--   Various code improvements
-    (https://github.com/fmtlib/fmt/pull/110,
-    https://github.com/fmtlib/fmt/pull/111
-    https://github.com/fmtlib/fmt/pull/112). Thanks @CarterLi.
-
--   Improved compile-time errors when formatting wide into narrow
-    strings (https://github.com/fmtlib/fmt/issues/117).
-
--   Fixed `BasicWriter::write` without formatting arguments when C++11
-    support is disabled
-    (https://github.com/fmtlib/fmt/issues/109).
-
--   Fixed header-only build on OS X with GCC 4.9
-    (https://github.com/fmtlib/fmt/issues/124).
-
--   Fixed packaging issues (https://github.com/fmtlib/fmt/issues/94).
-
--   Added [changelog](https://github.com/fmtlib/fmt/blob/master/ChangeLog.md)
-    (https://github.com/fmtlib/fmt/issues/103).
-
-# 1.0.0 - 2015-02-05
-
--   Add support for a header-only configuration when `FMT_HEADER_ONLY`
-    is defined before including `format.h`:
-
-    ```c++
-    #define FMT_HEADER_ONLY
-    #include "format.h"
-    ```
-
--   Compute string length in the constructor of `BasicStringRef` instead
-    of the `size` method
-    (https://github.com/fmtlib/fmt/issues/79). This eliminates
-    size computation for string literals on reasonable optimizing
-    compilers.
-
--   Fix formatting of types with overloaded `operator <<` for
-    `std::wostream` (https://github.com/fmtlib/fmt/issues/86):
-
-    ```c++
-    fmt::format(L"The date is {0}", Date(2012, 12, 9));
-    ```
-
--   Fix linkage of tests on Arch Linux
-    (https://github.com/fmtlib/fmt/issues/89).
-
--   Allow precision specifier for non-float arguments
-    (https://github.com/fmtlib/fmt/issues/90):
-
-    ```c++
-    fmt::print("{:.3}\n", "Carpet"); // prints "Car"
-    ```
-
--   Fix build on Android NDK (https://github.com/fmtlib/fmt/issues/93).
-
--   Improvements to documentation build procedure.
-
--   Remove `FMT_SHARED` CMake variable in favor of standard [BUILD_SHARED_LIBS](
-    http://www.cmake.org/cmake/help/v3.0/variable/BUILD_SHARED_LIBS.html).
-
--   Fix error handling in `fmt::fprintf`.
-
--   Fix a number of warnings.
-
-# 0.12.0 - 2014-10-25
-
--   \[Breaking\] Improved separation between formatting and buffer
-    management. `Writer` is now a base class that cannot be instantiated
-    directly. The new `MemoryWriter` class implements the default buffer
-    management with small allocations done on stack. So `fmt::Writer`
-    should be replaced with `fmt::MemoryWriter` in variable
-    declarations.
-
-    Old code:
-
-    ```c++
-    fmt::Writer w;
-    ```
-
-    New code:
-
-    ```c++
-    fmt::MemoryWriter w;
-    ```
-
-    If you pass `fmt::Writer` by reference, you can continue to do so:
-
-    ```c++
-    void f(fmt::Writer &w);
-    ```
-
-    This doesn\'t affect the formatting API.
-
--   Support for custom memory allocators
-    (https://github.com/fmtlib/fmt/issues/69)
-
--   Formatting functions now accept [signed char]{.title-ref} and
-    [unsigned char]{.title-ref} strings as arguments
-    (https://github.com/fmtlib/fmt/issues/73):
-
-    ```c++
-    auto s = format("GLSL version: {}", glGetString(GL_VERSION));
-    ```
-
--   Reduced code bloat. According to the new [benchmark
-    results](https://github.com/fmtlib/fmt#compile-time-and-code-bloat),
-    cppformat is close to `printf` and by the order of magnitude better
-    than Boost Format in terms of compiled code size.
-
--   Improved appearance of the documentation on mobile by using the
-    [Sphinx Bootstrap
-    theme](http://ryan-roemer.github.io/sphinx-bootstrap-theme/):
-
-    | Old | New |
-    | --- | --- |
-    | ![](https://cloud.githubusercontent.com/assets/576385/4792130/cd256436-5de3-11e4-9a62-c077d0c2b003.png) | ![](https://cloud.githubusercontent.com/assets/576385/4792131/cd29896c-5de3-11e4-8f59-cac952942bf0.png) |
-
-# 0.11.0 - 2014-08-21
-
--   Safe printf implementation with a POSIX extension for positional
-    arguments:
-
-    ```c++
-    fmt::printf("Elapsed time: %.2f seconds", 1.23);
-    fmt::printf("%1$s, %3$d %2$s", weekday, month, day);
-    ```
-
--   Arguments of `char` type can now be formatted as integers (Issue
-    https://github.com/fmtlib/fmt/issues/55):
-
-    ```c++
-    fmt::format("0x{0:02X}", 'a');
-    ```
-
--   Deprecated parts of the API removed.
-
--   The library is now built and tested on MinGW with Appveyor in
-    addition to existing test platforms Linux/GCC, OS X/Clang,
-    Windows/MSVC.
-
-# 0.10.0 - 2014-07-01
-
-**Improved API**
-
--   All formatting methods are now implemented as variadic functions
-    instead of using `operator<<` for feeding arbitrary arguments into a
-    temporary formatter object. This works both with C++11 where
-    variadic templates are used and with older standards where variadic
-    functions are emulated by providing lightweight wrapper functions
-    defined with the `FMT_VARIADIC` macro. You can use this macro for
-    defining your own portable variadic functions:
-
-    ```c++
-    void report_error(const char *format, const fmt::ArgList &args) {
-      fmt::print("Error: {}");
-      fmt::print(format, args);
-    }
-    FMT_VARIADIC(void, report_error, const char *)
+  ```c++
+  #include <fmt/core.h>
+  #include <locale>
 
-    report_error("file not found: {}", path);
-    ```
+  int main() {
+    std::locale::global(std::locale("fr_FR.UTF-8"));
+    fmt::print("{0:.2Lf}", 0.42);
+  }
+  ```
 
-    Apart from a more natural syntax, this also improves performance as
-    there is no need to construct temporary formatter objects and
-    control arguments\' lifetimes. Because the wrapper functions are
-    very lightweight, this doesn\'t cause code bloat even in pre-C++11
-    mode.
+  prints \"0,42\". The deprecated `'n'` specifier has been removed.
 
--   Simplified common case of formatting an `std::string`. Now it
-    requires a single function call:
+- Made the `0` specifier ignored for infinity and NaN
+  (https://github.com/fmtlib/fmt/issues/2305,
+  https://github.com/fmtlib/fmt/pull/2310). Thanks @Liedtke.
 
-    ```c++
-    std::string s = format("The answer is {}.", 42);
-    ```
+- Made the hexfloat formatting use the right alignment by default
+  (https://github.com/fmtlib/fmt/issues/2308,
+  https://github.com/fmtlib/fmt/pull/2317). Thanks @Liedtke.
 
-    Previously it required 2 function calls:
+- Removed the deprecated numeric alignment (`'='`). Use the `'0'`
+  specifier instead.
 
-    ```c++
-    std::string s = str(Format("The answer is {}.") << 42);
-    ```
+- Removed the deprecated `fmt/posix.h` header that has been replaced
+  with `fmt/os.h`.
 
-    Instead of unsafe `c_str` function, `fmt::Writer` should be used
-    directly to bypass creation of `std::string`:
+- Removed the deprecated `format_to_n_context`, `format_to_n_args` and
+  `make_format_to_n_args`. They have been replaced with
+  `format_context`, `` format_args` and ``make_format_args\`\`
+  respectively.
 
-    ```c++
-    fmt::Writer w;
-    w.write("The answer is {}.", 42);
-    w.c_str();  // returns a C string
-    ```
+- Moved `wchar_t`-specific functions and types to `fmt/xchar.h`. You
+  can define `FMT_DEPRECATED_INCLUDE_XCHAR` to automatically include
+  `fmt/xchar.h` from `fmt/format.h` but this will be disabled in the
+  next major release.
 
-    This doesn\'t do dynamic memory allocation for small strings and is
-    less error prone as the lifetime of the string is the same as for
-    `std::string::c_str` which is well understood (hopefully).
+- Fixed handling of the `'+'` specifier in localized formatting
+  (https://github.com/fmtlib/fmt/issues/2133).
 
--   Improved consistency in naming functions that are a part of the
-    public API. Now all public functions are lowercase following the
-    standard library conventions. Previously it was a combination of
-    lowercase and CapitalizedWords. Issue
-    https://github.com/fmtlib/fmt/issues/50.
+- Added support for the `'s'` format specifier that gives textual
+  representation of `bool`
+  (https://github.com/fmtlib/fmt/issues/2094,
+  https://github.com/fmtlib/fmt/pull/2109). For example:
 
--   Old functions are marked as deprecated and will be removed in the
-    next release.
+  ```c++
+  #include <fmt/core.h>
 
-**Other Changes**
+  int main() {
+    fmt::print("{:s}", true);
+  }
+  ```
 
--   Experimental support for printf format specifications (work in
-    progress):
+  prints \"true\". Thanks @powercoderlol.
 
-    ```c++
-    fmt::printf("The answer is %d.", 42);
-    std::string s = fmt::sprintf("Look, a %s!", "string");
-    ```
+- Made `fmt::ptr` work with function pointers
+  (https://github.com/fmtlib/fmt/pull/2131). For example:
 
--   Support for hexadecimal floating point format specifiers `a` and
-    `A`:
+  ```c++
+  #include <fmt/format.h>
 
-    ```c++
-    print("{:a}", -42.0); // Prints -0x1.5p+5
-    print("{:A}", -42.0); // Prints -0X1.5P+5
-    ```
+  int main() {
+    fmt::print("My main: {}\n", fmt::ptr(main));
+  }
+  ```
 
--   CMake option `FMT_SHARED` that specifies whether to build format as
-    a shared library (off by default).
+  Thanks @mikecrowe.
 
-# 0.9.0 - 2014-05-13
+- The undocumented support for specializing `formatter` for pointer
+  types has been removed.
 
--   More efficient implementation of variadic formatting functions.
+- Fixed `fmt::formatted_size` with format string compilation
+  (https://github.com/fmtlib/fmt/pull/2141,
+  https://github.com/fmtlib/fmt/pull/2161). Thanks @alexezeder.
 
--   `Writer::Format` now has a variadic overload:
+- Fixed handling of empty format strings during format string
+  compilation (https://github.com/fmtlib/fmt/issues/2042):
 
-    ```c++
-    Writer out;
-    out.Format("Look, I'm {}!", "variadic");
-    ```
+  ```c++
+  auto s = fmt::format(FMT_COMPILE(""));
+  ```
 
--   For efficiency and consistency with other overloads, variadic
-    overload of the `Format` function now returns `Writer` instead of
-    `std::string`. Use the `str` function to convert it to
-    `std::string`:
+  Thanks @alexezeder.
 
-    ```c++
-    std::string s = str(Format("Look, I'm {}!", "variadic"));
-    ```
+- Fixed handling of enums in `fmt::to_string`
+  (https://github.com/fmtlib/fmt/issues/2036).
 
--   Replaced formatter actions with output sinks: `NoAction` -\>
-    `NullSink`, `Write` -\> `FileSink`, `ColorWriter` -\>
-    `ANSITerminalSink`. This improves naming consistency and shouldn\'t
-    affect client code unless these classes are used directly which
-    should be rarely needed.
+- Improved width computation
+  (https://github.com/fmtlib/fmt/issues/2033,
+  https://github.com/fmtlib/fmt/issues/2091). For example:
 
--   Added `ThrowSystemError` function that formats a message and throws
-    `SystemError` containing the formatted message and system-specific
-    error description. For example, the following code
+  ```c++
+  #include <fmt/core.h>
 
-    ```c++
-    FILE *f = fopen(filename, "r");
-    if (!f)
-      ThrowSystemError(errno, "Failed to open file '{}'") << filename;
-    ```
+  int main() {
+    fmt::print("{:-<10}{}\n", "", "");
+    fmt::print("{:-<10}{}\n", "hello", "world");
+  }
+  ```
 
-    will throw `SystemError` exception with description \"Failed to open
-    file \'\<filename\>\': No such file or directory\" if file doesn\'t
-    exist.
+  prints
 
--   Support for AppVeyor continuous integration platform.
+  ![](https://user-images.githubusercontent.com/576385/119840373-cea3ca80-beb9-11eb-91e0-54266c48e181.png)
 
--   `Format` now throws `SystemError` in case of I/O errors.
+  on a modern terminal.
 
--   Improve test infrastructure. Print functions are now tested by
-    redirecting the output to a pipe.
+- The experimental fast output stream (`fmt::ostream`) is now
+  truncated by default for consistency with `fopen`
+  (https://github.com/fmtlib/fmt/issues/2018). For example:
 
-# 0.8.0 - 2014-04-14
+  ```c++
+  #include <fmt/os.h>
 
--   Initial release
+  int main() {
+    fmt::ostream out1 = fmt::output_file("guide");
+    out1.print("Zaphod");
+    out1.close();
+    fmt::ostream out2 = fmt::output_file("guide");
+    out2.print("Ford");
+  }
+  ```
+
+  writes \"Ford\" to the file \"guide\". To preserve the old file
+  content if any pass `fmt::file::WRONLY | fmt::file::CREATE` flags to
+  `fmt::output_file`.
+
+- Fixed moving of `fmt::ostream` that holds buffered data
+  (https://github.com/fmtlib/fmt/issues/2197,
+  https://github.com/fmtlib/fmt/pull/2198). Thanks @vtta.
+
+- Replaced the `fmt::system_error` exception with a function of the
+  same name that constructs `std::system_error`
+  (https://github.com/fmtlib/fmt/issues/2266).
+
+- Replaced the `fmt::windows_error` exception with a function of the
+  same name that constructs `std::system_error` with the category
+  returned by `fmt::system_category()`
+  (https://github.com/fmtlib/fmt/issues/2274,
+  https://github.com/fmtlib/fmt/pull/2275). The latter is
+  similar to `std::system_category` but correctly handles UTF-8.
+  Thanks @phprus.
+
+- Replaced `fmt::error_code` with `std::error_code` and made it
+  formattable (https://github.com/fmtlib/fmt/issues/2269,
+  https://github.com/fmtlib/fmt/pull/2270,
+  https://github.com/fmtlib/fmt/pull/2273). Thanks @phprus.
+
+- Added speech synthesis support
+  (https://github.com/fmtlib/fmt/pull/2206).
+
+- Made `format_to` work with a memory buffer that has a custom
+  allocator (https://github.com/fmtlib/fmt/pull/2300).
+  Thanks @voxmea.
+
+- Added `Allocator::max_size` support to `basic_memory_buffer`.
+  (https://github.com/fmtlib/fmt/pull/1960). Thanks @phprus.
+
+- Added wide string support to `fmt::join`
+  (https://github.com/fmtlib/fmt/pull/2236). Thanks @crbrz.
+
+- Made iterators passed to `formatter` specializations via a format
+  context satisfy C++20 `std::output_iterator` requirements
+  (https://github.com/fmtlib/fmt/issues/2156,
+  https://github.com/fmtlib/fmt/pull/2158,
+  https://github.com/fmtlib/fmt/issues/2195,
+  https://github.com/fmtlib/fmt/pull/2204). Thanks @randomnetcat.
+
+- Optimized the `printf` implementation
+  (https://github.com/fmtlib/fmt/pull/1982,
+  https://github.com/fmtlib/fmt/pull/1984,
+  https://github.com/fmtlib/fmt/pull/2016,
+  https://github.com/fmtlib/fmt/pull/2164).
+  Thanks @rimathia and @moiwi.
+
+- Improved detection of `constexpr` `char_traits`
+  (https://github.com/fmtlib/fmt/pull/2246,
+  https://github.com/fmtlib/fmt/pull/2257). Thanks @phprus.
+
+- Fixed writing to `stdout` when it is redirected to `NUL` on Windows
+  (https://github.com/fmtlib/fmt/issues/2080).
+
+- Fixed exception propagation from iterators
+  (https://github.com/fmtlib/fmt/issues/2097).
+
+- Improved `strftime` error handling
+  (https://github.com/fmtlib/fmt/issues/2238,
+  https://github.com/fmtlib/fmt/pull/2244). Thanks @yumeyao.
+
+- Stopped using deprecated GCC UDL template extension.
+
+- Added `fmt/args.h` to the install target
+  (https://github.com/fmtlib/fmt/issues/2096).
+
+- Error messages are now passed to assert when exceptions are disabled
+  (https://github.com/fmtlib/fmt/pull/2145). Thanks @NobodyXu.
+
+- Added the `FMT_MASTER_PROJECT` CMake option to control build and
+  install targets when {fmt} is included via `add_subdirectory`
+  (https://github.com/fmtlib/fmt/issues/2098,
+  https://github.com/fmtlib/fmt/pull/2100).
+  Thanks @randomizedthinking.
+
+- Improved build configuration
+  (https://github.com/fmtlib/fmt/pull/2026,
+  https://github.com/fmtlib/fmt/pull/2122).
+  Thanks @luncliff and @ibaned.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/issues/1947,
+  https://github.com/fmtlib/fmt/pull/1959,
+  https://github.com/fmtlib/fmt/pull/1963,
+  https://github.com/fmtlib/fmt/pull/1965,
+  https://github.com/fmtlib/fmt/issues/1966,
+  https://github.com/fmtlib/fmt/pull/1974,
+  https://github.com/fmtlib/fmt/pull/1975,
+  https://github.com/fmtlib/fmt/pull/1990,
+  https://github.com/fmtlib/fmt/issues/2000,
+  https://github.com/fmtlib/fmt/pull/2001,
+  https://github.com/fmtlib/fmt/issues/2002,
+  https://github.com/fmtlib/fmt/issues/2004,
+  https://github.com/fmtlib/fmt/pull/2006,
+  https://github.com/fmtlib/fmt/pull/2009,
+  https://github.com/fmtlib/fmt/pull/2010,
+  https://github.com/fmtlib/fmt/issues/2038,
+  https://github.com/fmtlib/fmt/issues/2039,
+  https://github.com/fmtlib/fmt/issues/2047,
+  https://github.com/fmtlib/fmt/pull/2053,
+  https://github.com/fmtlib/fmt/issues/2059,
+  https://github.com/fmtlib/fmt/pull/2065,
+  https://github.com/fmtlib/fmt/pull/2067,
+  https://github.com/fmtlib/fmt/pull/2068,
+  https://github.com/fmtlib/fmt/pull/2073,
+  https://github.com/fmtlib/fmt/issues/2103,
+  https://github.com/fmtlib/fmt/issues/2105,
+  https://github.com/fmtlib/fmt/pull/2106,
+  https://github.com/fmtlib/fmt/pull/2107,
+  https://github.com/fmtlib/fmt/issues/2116,
+  https://github.com/fmtlib/fmt/pull/2117,
+  https://github.com/fmtlib/fmt/issues/2118,
+  https://github.com/fmtlib/fmt/pull/2119,
+  https://github.com/fmtlib/fmt/issues/2127,
+  https://github.com/fmtlib/fmt/pull/2128,
+  https://github.com/fmtlib/fmt/issues/2140,
+  https://github.com/fmtlib/fmt/issues/2142,
+  https://github.com/fmtlib/fmt/pull/2143,
+  https://github.com/fmtlib/fmt/pull/2144,
+  https://github.com/fmtlib/fmt/issues/2147,
+  https://github.com/fmtlib/fmt/issues/2148,
+  https://github.com/fmtlib/fmt/issues/2149,
+  https://github.com/fmtlib/fmt/pull/2152,
+  https://github.com/fmtlib/fmt/pull/2160,
+  https://github.com/fmtlib/fmt/issues/2170,
+  https://github.com/fmtlib/fmt/issues/2175,
+  https://github.com/fmtlib/fmt/issues/2176,
+  https://github.com/fmtlib/fmt/pull/2177,
+  https://github.com/fmtlib/fmt/issues/2178,
+  https://github.com/fmtlib/fmt/pull/2179,
+  https://github.com/fmtlib/fmt/issues/2180,
+  https://github.com/fmtlib/fmt/issues/2181,
+  https://github.com/fmtlib/fmt/pull/2183,
+  https://github.com/fmtlib/fmt/issues/2184,
+  https://github.com/fmtlib/fmt/issues/2185,
+  https://github.com/fmtlib/fmt/pull/2186,
+  https://github.com/fmtlib/fmt/pull/2187,
+  https://github.com/fmtlib/fmt/pull/2190,
+  https://github.com/fmtlib/fmt/pull/2192,
+  https://github.com/fmtlib/fmt/pull/2194,
+  https://github.com/fmtlib/fmt/pull/2205,
+  https://github.com/fmtlib/fmt/issues/2210,
+  https://github.com/fmtlib/fmt/pull/2211,
+  https://github.com/fmtlib/fmt/pull/2215,
+  https://github.com/fmtlib/fmt/pull/2216,
+  https://github.com/fmtlib/fmt/pull/2218,
+  https://github.com/fmtlib/fmt/pull/2220,
+  https://github.com/fmtlib/fmt/issues/2228,
+  https://github.com/fmtlib/fmt/pull/2229,
+  https://github.com/fmtlib/fmt/pull/2230,
+  https://github.com/fmtlib/fmt/issues/2233,
+  https://github.com/fmtlib/fmt/pull/2239,
+  https://github.com/fmtlib/fmt/issues/2248,
+  https://github.com/fmtlib/fmt/issues/2252,
+  https://github.com/fmtlib/fmt/pull/2253,
+  https://github.com/fmtlib/fmt/pull/2255,
+  https://github.com/fmtlib/fmt/issues/2261,
+  https://github.com/fmtlib/fmt/issues/2278,
+  https://github.com/fmtlib/fmt/issues/2284,
+  https://github.com/fmtlib/fmt/pull/2287,
+  https://github.com/fmtlib/fmt/pull/2289,
+  https://github.com/fmtlib/fmt/pull/2290,
+  https://github.com/fmtlib/fmt/pull/2293,
+  https://github.com/fmtlib/fmt/issues/2295,
+  https://github.com/fmtlib/fmt/pull/2296,
+  https://github.com/fmtlib/fmt/pull/2297,
+  https://github.com/fmtlib/fmt/issues/2311,
+  https://github.com/fmtlib/fmt/pull/2313,
+  https://github.com/fmtlib/fmt/pull/2315,
+  https://github.com/fmtlib/fmt/issues/2320,
+  https://github.com/fmtlib/fmt/pull/2321,
+  https://github.com/fmtlib/fmt/pull/2323,
+  https://github.com/fmtlib/fmt/issues/2328,
+  https://github.com/fmtlib/fmt/pull/2329,
+  https://github.com/fmtlib/fmt/pull/2333,
+  https://github.com/fmtlib/fmt/pull/2338,
+  https://github.com/fmtlib/fmt/pull/2341).
+  Thanks @darklukee, @fagg, @killerbot242, @jgopel, @yeswalrus, @Finkman,
+  @HazardyKnusperkeks, @dkavolis, @concatime, @chronoxor, @summivox, @yNeo,
+  @Apache-HB, @alexezeder, @toojays, @Brainy0207, @vadz, @imsherlock, @phprus,
+  @white238, @yafshar, @BillyDonahue, @jstaahl, @denchat, @DanielaE,
+  @ilyakurdyukov, @ilmai, @JessyDL, @sergiud, @mwinterb, @sven-herrmann,
+  @jmelas, @twoixter, @crbrz and @upsj.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/1986,
+  https://github.com/fmtlib/fmt/pull/2051,
+  https://github.com/fmtlib/fmt/issues/2057,
+  https://github.com/fmtlib/fmt/pull/2081,
+  https://github.com/fmtlib/fmt/issues/2084,
+  https://github.com/fmtlib/fmt/pull/2312).
+  Thanks @imba-tjd, @0x416c69 and @mordante.
+
+- Continuous integration and test improvements
+  (https://github.com/fmtlib/fmt/issues/1969,
+  https://github.com/fmtlib/fmt/pull/1991,
+  https://github.com/fmtlib/fmt/pull/2020,
+  https://github.com/fmtlib/fmt/pull/2110,
+  https://github.com/fmtlib/fmt/pull/2114,
+  https://github.com/fmtlib/fmt/issues/2196,
+  https://github.com/fmtlib/fmt/pull/2217,
+  https://github.com/fmtlib/fmt/pull/2247,
+  https://github.com/fmtlib/fmt/pull/2256,
+  https://github.com/fmtlib/fmt/pull/2336,
+  https://github.com/fmtlib/fmt/pull/2346).
+  Thanks @jgopel, @alexezeder and @DanielaE.
+
+The change log for versions 0.8.0 - 7.1.3 is available [here](
+doc/ChangeLog-old.md).
diff --git a/METADATA b/METADATA
index b4da998f..82a6d229 100644
--- a/METADATA
+++ b/METADATA
@@ -1,6 +1,6 @@
 # This project was upgraded with external_updater.
 # Usage: tools/external_updater/updater.sh update external/fmtlib
-# For more info, check https://cs.android.com/android/platform/superproject/+/main:tools/external_updater/README.md
+# For more info, check https://cs.android.com/android/platform/superproject/main/+/main:tools/external_updater/README.md
 
 name: "fmtlib"
 description: "{fmt} is an open-source formatting library providing a fast and safe alternative to C stdio and C++ iostreams."
@@ -8,13 +8,13 @@ third_party {
   license_type: NOTICE
   last_upgrade_date {
     year: 2024
-    month: 3
-    day: 5
+    month: 10
+    day: 12
   }
   homepage: "https://github.com/fmtlib/fmt"
   identifier {
     type: "Git"
     value: "https://github.com/fmtlib/fmt.git"
-    version: "10.2.0"
+    version: "4046f9727892a9a1baeef00cb20211ee062efa16"
   }
 }
diff --git a/README.md b/README.md
index dcfb16ec..fd845db2 100644
--- a/README.md
+++ b/README.md
@@ -20,16 +20,16 @@ that help victims of the war in Ukraine: <https://www.stopputin.net/>.
 Q&A: ask questions on [StackOverflow with the tag
 fmt](https://stackoverflow.com/questions/tagged/fmt).
 
-Try {fmt} in [Compiler Explorer](https://godbolt.org/z/Eq5763).
+Try {fmt} in [Compiler Explorer](https://godbolt.org/z/8Mx1EW73v).
 
 # Features
 
-- Simple [format API](https://fmt.dev/latest/api.html) with positional
+- Simple [format API](https://fmt.dev/latest/api/) with positional
   arguments for localization
 - Implementation of [C++20
   std::format](https://en.cppreference.com/w/cpp/utility/format) and
   [C++23 std::print](https://en.cppreference.com/w/cpp/io/print)
-- [Format string syntax](https://fmt.dev/latest/syntax.html) similar
+- [Format string syntax](https://fmt.dev/latest/syntax/) similar
   to Python\'s
   [format](https://docs.python.org/3/library/stdtypes.html#str.format)
 - Fast IEEE 754 floating-point formatter with correct rounding,
@@ -37,10 +37,10 @@ Try {fmt} in [Compiler Explorer](https://godbolt.org/z/Eq5763).
   [Dragonbox](https://github.com/jk-jeon/dragonbox) algorithm
 - Portable Unicode support
 - Safe [printf
-  implementation](https://fmt.dev/latest/api.html#printf-formatting)
+  implementation](https://fmt.dev/latest/api/#printf-formatting)
   including the POSIX extension for positional arguments
 - Extensibility: [support for user-defined
-  types](https://fmt.dev/latest/api.html#formatting-user-defined-types)
+  types](https://fmt.dev/latest/api/#formatting-user-defined-types)
 - High performance: faster than common standard library
   implementations of `(s)printf`, iostreams, `to_string` and
   `to_chars`, see [Speed tests](#speed-tests) and [Converting a
@@ -58,8 +58,8 @@ Try {fmt} in [Compiler Explorer](https://godbolt.org/z/Eq5763).
   buffer overflow errors
 - Ease of use: small self-contained code base, no external
   dependencies, permissive MIT
-  [license](https://github.com/fmtlib/fmt/blob/master/LICENSE.rst)
-- [Portability](https://fmt.dev/latest/index.html#portability) with
+  [license](https://github.com/fmtlib/fmt/blob/master/LICENSE)
+- [Portability](https://fmt.dev/latest/#portability) with
   consistent output across platforms and support for older compilers
 - Clean warning-free codebase even on high warning levels such as
   `-Wall -Wextra -pedantic`
@@ -203,43 +203,38 @@ and [ryu](https://github.com/ulfjack/ryu):
 
 ## Compile time and code bloat
 
-The script
-[bloat-test.py](https://github.com/fmtlib/format-benchmark/blob/master/bloat-test.py)
-from [format-benchmark](https://github.com/fmtlib/format-benchmark)
-tests compile time and code bloat for nontrivial projects. It generates
-100 translation units and uses `printf()` or its alternative five times
-in each to simulate a medium-sized project. The resulting executable
-size and compile time (Apple LLVM version 8.1.0 (clang-802.0.42), macOS
-Sierra, best of three) is shown in the following tables.
+The script [bloat-test.py][test] from [format-benchmark][bench] tests compile
+time and code bloat for nontrivial projects. It generates 100 translation units
+and uses `printf()` or its alternative five times in each to simulate a
+medium-sized project. The resulting executable size and compile time (Apple
+clang version 15.0.0 (clang-1500.1.0.2.5), macOS Sonoma, best of three) is shown
+in the following tables.
+
+[test]: https://github.com/fmtlib/format-benchmark/blob/master/bloat-test.py
+[bench]: https://github.com/fmtlib/format-benchmark
 
 **Optimized build (-O3)**
 
 | Method        | Compile Time, s | Executable size, KiB | Stripped size, KiB |
 |---------------|-----------------|----------------------|--------------------|
-| printf        |   2.6           |   29                 |   26               |
-| printf+string |   16.4          |   29                 |   26               |
-| iostreams     |   31.1          |   59                 |   55               |
-| {fmt}         |   19.0          |   37                 |   34               |
-| Boost Format  |   91.9          |   226                |   203              |
-| Folly Format  |   115.7         |   101                |   88               |
-
-As you can see, {fmt} has 60% less overhead in terms of resulting binary
-code size compared to iostreams and comes pretty close to `printf`.
-Boost Format and Folly Format have the largest overheads.
+| printf        |             1.6 |                   54 |                 50 |
+| IOStreams     |            25.9 |                   98 |                 84 |
+| fmt 83652df   |             4.8 |                   54 |                 50 |
+| tinyformat    |            29.1 |                  161 |                136 |
+| Boost Format  |            55.0 |                  530 |                317 |
 
-`printf+string` is the same as `printf` but with an extra `<string>`
-include to measure the overhead of the latter.
+{fmt} is fast to compile and is comparable to `printf` in terms of per-call
+binary size (within a rounding error on this system).
 
 **Non-optimized build**
 
 | Method        | Compile Time, s | Executable size, KiB | Stripped size, KiB |
 |---------------|-----------------|----------------------|--------------------|
-| printf        |   2.2           |   33                 |   30               |
-| printf+string |   16.0          |   33                 |   30               |
-| iostreams     |   28.3          |   56                 |   52               |
-| {fmt}         |   18.2          |   59                 |   50               |
-| Boost Format  |   54.1          |   365                |   303              |
-| Folly Format  |   79.9          |   445                |   430              |
+| printf        |             1.4 |                   54 |                 50 |
+| IOStreams     |            23.4 |                   92 |                 68 |
+| {fmt} 83652df |             4.4 |                   89 |                 85 |
+| tinyformat    |            24.5 |                  204 |                161 |
+| Boost Format  |            36.4 |                  831 |                462 |
 
 `libc`, `lib(std)c++`, and `libfmt` are all linked as shared libraries
 to compare formatting function overhead only. Boost Format is a
@@ -248,7 +243,7 @@ header-only library so it doesn\'t provide any linkage options.
 ## Running the tests
 
 Please refer to [Building the
-library](https://fmt.dev/latest/usage.html#building-the-library) for
+library](https://fmt.dev/latest/get-started/#building-from-source) for
 instructions on how to build the library and run the unit tests.
 
 Benchmarks reside in a separate repository,
@@ -270,8 +265,7 @@ or the bloat test:
 
 # Migrating code
 
-[clang-tidy](https://clang.llvm.org/extra/clang-tidy/) v17 (not yet
-released) provides the
+[clang-tidy](https://clang.llvm.org/extra/clang-tidy/) v18 provides the
 [modernize-use-std-print](https://clang.llvm.org/extra/clang-tidy/checks/modernize/use-std-print.html)
 check that is capable of converting occurrences of `printf` and
 `fprintf` to `fmt::print` if configured to do so. (By default it
@@ -297,13 +291,14 @@ converts to `std::print`.)
 - [ccache](https://ccache.dev/): a compiler cache
 - [ClickHouse](https://github.com/ClickHouse/ClickHouse): an
   analytical database management system
+- [ContextVision](https://www.contextvision.com/): medical imaging software
 - [Contour](https://github.com/contour-terminal/contour/): a modern
   terminal emulator
 - [CUAUV](https://cuauv.org/): Cornell University\'s autonomous
   underwater vehicle
 - [Drake](https://drake.mit.edu/): a planning, control, and analysis
   toolbox for nonlinear dynamical systems (MIT)
-- [Envoy](https://lyft.github.io/envoy/): C++ L7 proxy and
+- [Envoy](https://github.com/envoyproxy/envoy): C++ L7 proxy and
   communication bus (Lyft)
 - [FiveM](https://fivem.net/): a modification framework for GTA V
 - [fmtlog](https://github.com/MengRao/fmtlog): a performant
@@ -343,7 +338,7 @@ converts to `std::print`.)
 - [Quill](https://github.com/odygrd/quill): asynchronous low-latency
   logging library
 - [QKW](https://github.com/ravijanjam/qkw): generalizing aliasing to
-  simplify navigation, and executing complex multi-line terminal
+  simplify navigation, and execute complex multi-line terminal
   command sequences
 - [redis-cerberus](https://github.com/HunanTV/redis-cerberus): a Redis
   cluster proxy
@@ -432,7 +427,7 @@ code bloat issues (see [Benchmarks](#benchmarks)).
 
 ## FastFormat
 
-This is an interesting library that is fast, safe, and has positional
+This is an interesting library that is fast, safe and has positional
 arguments. However, it has significant limitations, citing its author:
 
 > Three features that have no hope of being accommodated within the
@@ -442,8 +437,8 @@ arguments. However, it has significant limitations, citing its author:
 > - Octal/hexadecimal encoding
 > - Runtime width/alignment specification
 
-It is also quite big and has a heavy dependency, STLSoft, which might be
-too restrictive for using it in some projects.
+It is also quite big and has a heavy dependency, on STLSoft, which might be
+too restrictive for use in some projects.
 
 ## Boost Spirit.Karma
 
@@ -462,7 +457,7 @@ second](http://www.zverovich.net/2020/06/13/fast-int-to-string-revisited.html).
 
 # Documentation License
 
-The [Format String Syntax](https://fmt.dev/latest/syntax.html) section
+The [Format String Syntax](https://fmt.dev/latest/syntax/) section
 in the documentation is based on the one from Python [string module
 documentation](https://docs.python.org/3/library/string.html#module-string).
 For this reason, the documentation is distributed under the Python
@@ -486,5 +481,5 @@ To report a security issue, please disclose it at [security
 advisory](https://github.com/fmtlib/fmt/security/advisories/new).
 
 This project is maintained by a team of volunteers on a
-reasonable-effort basis. As such, please give us at least 90 days to
+reasonable-effort basis. As such, please give us at least *90* days to
 work on a fix before public exposure.
diff --git a/doc/CMakeLists.txt b/doc/CMakeLists.txt
deleted file mode 100644
index fd9f4d1e..00000000
--- a/doc/CMakeLists.txt
+++ /dev/null
@@ -1,26 +0,0 @@
-find_program(DOXYGEN doxygen
-  PATHS "$ENV{ProgramFiles}/doxygen/bin"
-        "$ENV{ProgramFiles\(x86\)}/doxygen/bin")
-if (NOT DOXYGEN)
-  message(STATUS "Target 'doc' disabled (requires doxygen)")
-  return ()
-endif ()
-
-# Find the Python interpreter and set the PYTHON_EXECUTABLE variable.
-if (CMAKE_VERSION VERSION_LESS 3.12)
-  # This logic is deprecated in CMake after 3.12.
-  find_package(PythonInterp QUIET REQUIRED)
-else ()
-  find_package(Python QUIET REQUIRED)
-  set(PYTHON_EXECUTABLE ${Python_EXECUTABLE})
-endif ()
-
-add_custom_target(doc
-  COMMAND ${PYTHON_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/build.py
-                               ${FMT_VERSION}
-  SOURCES api.rst syntax.rst usage.rst build.py conf.py _templates/layout.html)
-
-include(GNUInstallDirs)
-install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/html/
-        DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/doc/fmt OPTIONAL
-        PATTERN ".doctrees" EXCLUDE)
diff --git a/doc/ChangeLog-old.md b/doc/ChangeLog-old.md
new file mode 100644
index 00000000..3f31d1e9
--- /dev/null
+++ b/doc/ChangeLog-old.md
@@ -0,0 +1,3290 @@
+# 7.1.3 - 2020-11-24
+
+- Fixed handling of buffer boundaries in `format_to_n`
+  (https://github.com/fmtlib/fmt/issues/1996,
+  https://github.com/fmtlib/fmt/issues/2029).
+- Fixed linkage errors when linking with a shared library
+  (https://github.com/fmtlib/fmt/issues/2011).
+- Reintroduced ostream support to range formatters
+  (https://github.com/fmtlib/fmt/issues/2014).
+- Worked around an issue with mixing std versions in gcc
+  (https://github.com/fmtlib/fmt/issues/2017).
+
+# 7.1.2 - 2020-11-04
+
+- Fixed floating point formatting with large precision
+  (https://github.com/fmtlib/fmt/issues/1976).
+
+# 7.1.1 - 2020-11-01
+
+- Fixed ABI compatibility with 7.0.x
+  (https://github.com/fmtlib/fmt/issues/1961).
+- Added the `FMT_ARM_ABI_COMPATIBILITY` macro to work around ABI
+  incompatibility between GCC and Clang on ARM
+  (https://github.com/fmtlib/fmt/issues/1919).
+- Worked around a SFINAE bug in GCC 8
+  (https://github.com/fmtlib/fmt/issues/1957).
+- Fixed linkage errors when building with GCC\'s LTO
+  (https://github.com/fmtlib/fmt/issues/1955).
+- Fixed a compilation error when building without `__builtin_clz` or
+  equivalent (https://github.com/fmtlib/fmt/pull/1968).
+  Thanks @tohammer.
+- Fixed a sign conversion warning
+  (https://github.com/fmtlib/fmt/pull/1964). Thanks @OptoCloud.
+
+# 7.1.0 - 2020-10-25
+
+- Switched from
+  [Grisu3](https://www.cs.tufts.edu/~nr/cs257/archive/florian-loitsch/printf.pdf)
+  to [Dragonbox](https://github.com/jk-jeon/dragonbox) for the default
+  floating-point formatting which gives the shortest decimal
+  representation with round-trip guarantee and correct rounding
+  (https://github.com/fmtlib/fmt/pull/1882,
+  https://github.com/fmtlib/fmt/pull/1887,
+  https://github.com/fmtlib/fmt/pull/1894). This makes {fmt}
+  up to 20-30x faster than common implementations of
+  `std::ostringstream` and `sprintf` on
+  [dtoa-benchmark](https://github.com/fmtlib/dtoa-benchmark) and
+  faster than double-conversion and Ry:
+
+  ![](https://user-images.githubusercontent.com/576385/95684665-11719600-0ba8-11eb-8e5b-972ff4e49428.png)
+
+  It is possible to get even better performance at the cost of larger
+  binary size by compiling with the `FMT_USE_FULL_CACHE_DRAGONBOX`
+  macro set to 1.
+
+  Thanks @jk-jeon.
+
+- Added an experimental unsynchronized file output API which, together
+  with [format string
+  compilation](https://fmt.dev/latest/api.html#compile-api), can give
+  [5-9 times speed up compared to
+  fprintf](https://www.zverovich.net/2020/08/04/optimal-file-buffer-size.html)
+  on common platforms ([godbolt](https://godbolt.org/z/nsTcG8)):
+
+  ```c++
+  #include <fmt/os.h>
+
+  int main() {
+    auto f = fmt::output_file("guide");
+    f.print("The answer is {}.", 42);
+  }
+  ```
+
+- Added a formatter for `std::chrono::time_point<system_clock>`
+  (https://github.com/fmtlib/fmt/issues/1819,
+  https://github.com/fmtlib/fmt/pull/1837). For example
+  ([godbolt](https://godbolt.org/z/c4M6fh)):
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
+    auto now = std::chrono::system_clock::now();
+    fmt::print("The time is {:%H:%M:%S}.\n", now);
+  }
+  ```
+
+  Thanks @adamburgess.
+
+- Added support for ranges with non-const `begin`/`end` to `fmt::join`
+  (https://github.com/fmtlib/fmt/issues/1784,
+  https://github.com/fmtlib/fmt/pull/1786). For example
+  ([godbolt](https://godbolt.org/z/jP63Tv)):
+
+  ```c++
+  #include <fmt/ranges.h>
+  #include <range/v3/view/filter.hpp>
+
+  int main() {
+    using std::literals::string_literals::operator""s;
+    auto strs = std::array{"a"s, "bb"s, "ccc"s};
+    auto range = strs | ranges::views::filter(
+      [] (const std::string &x) { return x.size() != 2; }
+    );
+    fmt::print("{}\n", fmt::join(range, ""));
+  }
+  ```
+
+  prints \"accc\".
+
+  Thanks @tonyelewis.
+
+- Added a `memory_buffer::append` overload that takes a range
+  (https://github.com/fmtlib/fmt/pull/1806). Thanks @BRevzin.
+
+- Improved handling of single code units in `FMT_COMPILE`. For
+  example:
+
+  ```c++
+  #include <fmt/compile.h>
+
+  char* f(char* buf) {
+    return fmt::format_to(buf, FMT_COMPILE("x{}"), 42);
+  }
+  ```
+
+  compiles to just ([godbolt](https://godbolt.org/z/5vncz3)):
+
+  ```asm
+  _Z1fPc:
+    movb $120, (%rdi)
+    xorl %edx, %edx
+    cmpl $42, _ZN3fmt2v76detail10basic_dataIvE23zero_or_powers_of_10_32E+8(%rip)
+    movl $3, %eax
+    seta %dl
+    subl %edx, %eax
+    movzwl _ZN3fmt2v76detail10basic_dataIvE6digitsE+84(%rip), %edx
+    cltq
+    addq %rdi, %rax
+    movw %dx, -2(%rax)
+    ret
+  ```
+
+  Here a single `mov` instruction writes `'x'` (`$120`) to the output
+  buffer.
+
+- Added dynamic width support to format string compilation
+  (https://github.com/fmtlib/fmt/issues/1809).
+
+- Improved error reporting for unformattable types: now you\'ll get
+  the type name directly in the error message instead of the note:
+
+  ```c++
+  #include <fmt/core.h>
+
+  struct how_about_no {};
+
+  int main() {
+    fmt::print("{}", how_about_no());
+  }
+  ```
+
+  Error ([godbolt](https://godbolt.org/z/GoxM4e)):
+
+  `fmt/core.h:1438:3: error: static_assert failed due to requirement 'fmt::v7::formattable<how_about_no>()' "Cannot format an argument. To make type T formattable provide a formatter<T> specialization: https://fmt.dev/latest/api.html#udt" ...`
+
+- Added the
+  [make_args_checked](https://fmt.dev/7.1.0/api.html#argument-lists)
+  function template that allows you to write formatting functions with
+  compile-time format string checks and avoid binary code bloat
+  ([godbolt](https://godbolt.org/z/PEf9qr)):
+
+  ```c++
+  void vlog(const char* file, int line, fmt::string_view format,
+            fmt::format_args args) {
+    fmt::print("{}: {}: ", file, line);
+    fmt::vprint(format, args);
+  }
+
+  template <typename S, typename... Args>
+  void log(const char* file, int line, const S& format, Args&&... args) {
+    vlog(file, line, format,
+        fmt::make_args_checked<Args...>(format, args...));
+  }
+
+  #define MY_LOG(format, ...) \
+    log(__FILE__, __LINE__, FMT_STRING(format), __VA_ARGS__)
+
+  MY_LOG("invalid squishiness: {}", 42);
+  ```
+
+- Replaced `snprintf` fallback with a faster internal IEEE 754 `float`
+  and `double` formatter for arbitrary precision. For example
+  ([godbolt](https://godbolt.org/z/dPhWvj)):
+
+  ```c++
+  #include <fmt/core.h>
+
+  int main() {
+    fmt::print("{:.500}\n", 4.9406564584124654E-324);
+  }
+  ```
+
+  prints
+
+  `4.9406564584124654417656879286822137236505980261432476442558568250067550727020875186529983636163599237979656469544571773092665671035593979639877479601078187812630071319031140452784581716784898210368871863605699873072305000638740915356498438731247339727316961514003171538539807412623856559117102665855668676818703956031062493194527159149245532930545654440112748012970999954193198940908041656332452475714786901472678015935523861155013480352649347201937902681071074917033322268447533357208324319360923829e-324`.
+
+- Made `format_to_n` and `formatted_size` part of the [core
+  API](https://fmt.dev/latest/api.html#core-api)
+  ([godbolt](https://godbolt.org/z/sPjY1K)):
+
+  ```c++
+  #include <fmt/core.h>
+
+  int main() {
+    char buffer[10];
+    auto result = fmt::format_to_n(buffer, sizeof(buffer), "{}", 42);
+  }
+  ```
+
+- Added `fmt::format_to_n` overload with format string compilation
+  (https://github.com/fmtlib/fmt/issues/1764,
+  https://github.com/fmtlib/fmt/pull/1767,
+  https://github.com/fmtlib/fmt/pull/1869). For example
+  ([godbolt](https://godbolt.org/z/93h86q)):
+
+  ```c++
+  #include <fmt/compile.h>
+
+  int main() {
+    char buffer[8];
+    fmt::format_to_n(buffer, sizeof(buffer), FMT_COMPILE("{}"), 42);
+  }
+  ```
+
+  Thanks @Kurkin and @alexezeder.
+
+- Added `fmt::format_to` overload that take `text_style`
+  (https://github.com/fmtlib/fmt/issues/1593,
+  https://github.com/fmtlib/fmt/issues/1842,
+  https://github.com/fmtlib/fmt/pull/1843). For example
+  ([godbolt](https://godbolt.org/z/91153r)):
+
+  ```c++
+  #include <fmt/color.h>
+
+  int main() {
+    std::string out;
+    fmt::format_to(std::back_inserter(out),
+                   fmt::emphasis::bold | fg(fmt::color::red),
+                   "The answer is {}.", 42);
+  }
+  ```
+
+  Thanks @Naios.
+
+- Made the `'#'` specifier emit trailing zeros in addition to the
+  decimal point (https://github.com/fmtlib/fmt/issues/1797).
+  For example ([godbolt](https://godbolt.org/z/bhdcW9)):
+
+  ```c++
+  #include <fmt/core.h>
+
+  int main() {
+    fmt::print("{:#.2g}", 0.5);
+  }
+  ```
+
+  prints `0.50`.
+
+- Changed the default floating point format to not include `.0` for
+  consistency with `std::format` and `std::to_chars`
+  (https://github.com/fmtlib/fmt/issues/1893,
+  https://github.com/fmtlib/fmt/issues/1943). It is possible
+  to get the decimal point and trailing zero with the `#` specifier.
+
+- Fixed an issue with floating-point formatting that could result in
+  addition of a non-significant trailing zero in rare cases e.g.
+  `1.00e-34` instead of `1.0e-34`
+  (https://github.com/fmtlib/fmt/issues/1873,
+  https://github.com/fmtlib/fmt/issues/1917).
+
+- Made `fmt::to_string` fallback on `ostream` insertion operator if
+  the `formatter` specialization is not provided
+  (https://github.com/fmtlib/fmt/issues/1815,
+  https://github.com/fmtlib/fmt/pull/1829). Thanks @alexezeder.
+
+- Added support for the append mode to the experimental file API and
+  improved `fcntl.h` detection.
+  (https://github.com/fmtlib/fmt/pull/1847,
+  https://github.com/fmtlib/fmt/pull/1848). Thanks @t-wiser.
+
+- Fixed handling of types that have both an implicit conversion
+  operator and an overloaded `ostream` insertion operator
+  (https://github.com/fmtlib/fmt/issues/1766).
+
+- Fixed a slicing issue in an internal iterator type
+  (https://github.com/fmtlib/fmt/pull/1822). Thanks @BRevzin.
+
+- Fixed an issue in locale-specific integer formatting
+  (https://github.com/fmtlib/fmt/issues/1927).
+
+- Fixed handling of exotic code unit types
+  (https://github.com/fmtlib/fmt/issues/1870,
+  https://github.com/fmtlib/fmt/issues/1932).
+
+- Improved `FMT_ALWAYS_INLINE`
+  (https://github.com/fmtlib/fmt/pull/1878). Thanks @jk-jeon.
+
+- Removed dependency on `windows.h`
+  (https://github.com/fmtlib/fmt/pull/1900). Thanks @bernd5.
+
+- Optimized counting of decimal digits on MSVC
+  (https://github.com/fmtlib/fmt/pull/1890). Thanks @mwinterb.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/1772,
+  https://github.com/fmtlib/fmt/pull/1775,
+  https://github.com/fmtlib/fmt/pull/1792,
+  https://github.com/fmtlib/fmt/pull/1838,
+  https://github.com/fmtlib/fmt/pull/1888,
+  https://github.com/fmtlib/fmt/pull/1918,
+  https://github.com/fmtlib/fmt/pull/1939).
+  Thanks @leolchat, @pepsiman, @Klaim, @ravijanjam, @francesco-st and @udnaan.
+
+- Added the `FMT_REDUCE_INT_INSTANTIATIONS` CMake option that reduces
+  the binary code size at the cost of some integer formatting
+  performance. This can be useful for extremely memory-constrained
+  embedded systems
+  (https://github.com/fmtlib/fmt/issues/1778,
+  https://github.com/fmtlib/fmt/pull/1781). Thanks @kammce.
+
+- Added the `FMT_USE_INLINE_NAMESPACES` macro to control usage of
+  inline namespaces
+  (https://github.com/fmtlib/fmt/pull/1945). Thanks @darklukee.
+
+- Improved build configuration
+  (https://github.com/fmtlib/fmt/pull/1760,
+  https://github.com/fmtlib/fmt/pull/1770,
+  https://github.com/fmtlib/fmt/issues/1779,
+  https://github.com/fmtlib/fmt/pull/1783,
+  https://github.com/fmtlib/fmt/pull/1823).
+  Thanks @dvetutnev, @xvitaly, @tambry, @medithe and @martinwuehrer.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/pull/1790,
+  https://github.com/fmtlib/fmt/pull/1802,
+  https://github.com/fmtlib/fmt/pull/1808,
+  https://github.com/fmtlib/fmt/issues/1810,
+  https://github.com/fmtlib/fmt/issues/1811,
+  https://github.com/fmtlib/fmt/pull/1812,
+  https://github.com/fmtlib/fmt/pull/1814,
+  https://github.com/fmtlib/fmt/pull/1816,
+  https://github.com/fmtlib/fmt/pull/1817,
+  https://github.com/fmtlib/fmt/pull/1818,
+  https://github.com/fmtlib/fmt/issues/1825,
+  https://github.com/fmtlib/fmt/pull/1836,
+  https://github.com/fmtlib/fmt/pull/1855,
+  https://github.com/fmtlib/fmt/pull/1856,
+  https://github.com/fmtlib/fmt/pull/1860,
+  https://github.com/fmtlib/fmt/pull/1877,
+  https://github.com/fmtlib/fmt/pull/1879,
+  https://github.com/fmtlib/fmt/pull/1880,
+  https://github.com/fmtlib/fmt/issues/1896,
+  https://github.com/fmtlib/fmt/pull/1897,
+  https://github.com/fmtlib/fmt/pull/1898,
+  https://github.com/fmtlib/fmt/issues/1904,
+  https://github.com/fmtlib/fmt/pull/1908,
+  https://github.com/fmtlib/fmt/issues/1911,
+  https://github.com/fmtlib/fmt/issues/1912,
+  https://github.com/fmtlib/fmt/issues/1928,
+  https://github.com/fmtlib/fmt/pull/1929,
+  https://github.com/fmtlib/fmt/issues/1935,
+  https://github.com/fmtlib/fmt/pull/1937,
+  https://github.com/fmtlib/fmt/pull/1942,
+  https://github.com/fmtlib/fmt/issues/1949).
+  Thanks @TheQwertiest, @medithe, @martinwuehrer, @n16h7hunt3r, @Othereum,
+  @gsjaardema, @AlexanderLanin, @gcerretani, @chronoxor, @noizefloor,
+  @akohlmey, @jk-jeon, @rimathia, @rglarix, @moiwi, @heckad, @MarcDirven.
+  @BartSiwek and @darklukee.
+
+# 7.0.3 - 2020-08-06
+
+- Worked around broken `numeric_limits` for 128-bit integers
+  (https://github.com/fmtlib/fmt/issues/1787).
+- Added error reporting on missing named arguments
+  (https://github.com/fmtlib/fmt/issues/1796).
+- Stopped using 128-bit integers with clang-cl
+  (https://github.com/fmtlib/fmt/pull/1800). Thanks @Kingcom.
+- Fixed issues in locale-specific integer formatting
+  (https://github.com/fmtlib/fmt/issues/1782,
+  https://github.com/fmtlib/fmt/issues/1801).
+
+# 7.0.2 - 2020-07-29
+
+- Worked around broken `numeric_limits` for 128-bit integers
+  (https://github.com/fmtlib/fmt/issues/1725).
+- Fixed compatibility with CMake 3.4
+  (https://github.com/fmtlib/fmt/issues/1779).
+- Fixed handling of digit separators in locale-specific formatting
+  (https://github.com/fmtlib/fmt/issues/1782).
+
+# 7.0.1 - 2020-07-07
+
+- Updated the inline version namespace name.
+- Worked around a gcc bug in mangling of alias templates
+  (https://github.com/fmtlib/fmt/issues/1753).
+- Fixed a linkage error on Windows
+  (https://github.com/fmtlib/fmt/issues/1757). Thanks @Kurkin.
+- Fixed minor issues with the documentation.
+
+# 7.0.0 - 2020-07-05
+
+- Reduced the library size. For example, on macOS a stripped test
+  binary statically linked with {fmt} [shrank from \~368k to less than
+  100k](http://www.zverovich.net/2020/05/21/reducing-library-size.html).
+
+- Added a simpler and more efficient [format string compilation
+  API](https://fmt.dev/7.0.0/api.html#compile-api):
+
+  ```c++
+  #include <fmt/compile.h>
+
+  // Converts 42 into std::string using the most efficient method and no
+  // runtime format string processing.
+  std::string s = fmt::format(FMT_COMPILE("{}"), 42);
+  ```
+
+  The old `fmt::compile` API is now deprecated.
+
+- Optimized integer formatting: `format_to` with format string
+  compilation and a stack-allocated buffer is now [faster than
+  to_chars on both libc++ and
+  libstdc++](http://www.zverovich.net/2020/06/13/fast-int-to-string-revisited.html).
+
+- Optimized handling of small format strings. For example,
+
+  ```c++
+  fmt::format("Result: {}: ({},{},{},{})", str1, str2, str3, str4, str5)
+  ```
+
+  is now \~40% faster
+  (https://github.com/fmtlib/fmt/issues/1685).
+
+- Applied extern templates to improve compile times when using the
+  core API and `fmt/format.h`
+  (https://github.com/fmtlib/fmt/issues/1452). For example,
+  on macOS with clang the compile time of a test translation unit
+  dropped from 2.3s to 0.3s with `-O2` and from 0.6s to 0.3s with the
+  default settings (`-O0`).
+
+  Before (`-O2`):
+
+      % time c++ -c test.cc -I include -std=c++17 -O2
+      c++ -c test.cc -I include -std=c++17 -O2  2.22s user 0.08s system 99% cpu 2.311 total
+
+  After (`-O2`):
+
+      % time c++ -c test.cc -I include -std=c++17 -O2
+      c++ -c test.cc -I include -std=c++17 -O2  0.26s user 0.04s system 98% cpu 0.303 total
+
+  Before (default):
+
+      % time c++ -c test.cc -I include -std=c++17
+      c++ -c test.cc -I include -std=c++17  0.53s user 0.06s system 98% cpu 0.601 total
+
+  After (default):
+
+      % time c++ -c test.cc -I include -std=c++17
+      c++ -c test.cc -I include -std=c++17  0.24s user 0.06s system 98% cpu 0.301 total
+
+  It is still recommended to use `fmt/core.h` instead of
+  `fmt/format.h` but the compile time difference is now smaller.
+  Thanks @alex3d for the suggestion.
+
+- Named arguments are now stored on stack (no dynamic memory
+  allocations) and the compiled code is more compact and efficient.
+  For example
+
+  ```c++
+  #include <fmt/core.h>
+
+  int main() {
+    fmt::print("The answer is {answer}\n", fmt::arg("answer", 42));
+  }
+  ```
+
+  compiles to just ([godbolt](https://godbolt.org/z/NcfEp_))
+
+  ```asm
+  .LC0:
+          .string "answer"
+  .LC1:
+          .string "The answer is {answer}\n"
+  main:
+          sub     rsp, 56
+          mov     edi, OFFSET FLAT:.LC1
+          mov     esi, 23
+          movabs  rdx, 4611686018427387905
+          lea     rax, [rsp+32]
+          lea     rcx, [rsp+16]
+          mov     QWORD PTR [rsp+8], 1
+          mov     QWORD PTR [rsp], rax
+          mov     DWORD PTR [rsp+16], 42
+          mov     QWORD PTR [rsp+32], OFFSET FLAT:.LC0
+          mov     DWORD PTR [rsp+40], 0
+          call    fmt::v6::vprint(fmt::v6::basic_string_view<char>,
+                                  fmt::v6::format_args)
+          xor     eax, eax
+          add     rsp, 56
+          ret
+
+      .L.str.1:
+              .asciz  "answer"
+  ```
+
+- Implemented compile-time checks for dynamic width and precision
+  (https://github.com/fmtlib/fmt/issues/1614):
+
+  ```c++
+  #include <fmt/format.h>
+
+  int main() {
+    fmt::print(FMT_STRING("{0:{1}}"), 42);
+  }
+  ```
+
+  now gives a compilation error because argument 1 doesn\'t exist:
+
+      In file included from test.cc:1:
+      include/fmt/format.h:2726:27: error: constexpr variable 'invalid_format' must be
+      initialized by a constant expression
+        FMT_CONSTEXPR_DECL bool invalid_format =
+                                ^
+      ...
+      include/fmt/core.h:569:26: note: in call to
+      '&checker(s, {}).context_->on_error(&"argument not found"[0])'
+          if (id >= num_args_) on_error("argument not found");
+                              ^
+
+- Added sentinel support to `fmt::join`
+  (https://github.com/fmtlib/fmt/pull/1689)
+
+  ```c++
+  struct zstring_sentinel {};
+  bool operator==(const char* p, zstring_sentinel) { return *p == '\0'; }
+  bool operator!=(const char* p, zstring_sentinel) { return *p != '\0'; }
+
+  struct zstring {
+    const char* p;
+    const char* begin() const { return p; }
+    zstring_sentinel end() const { return {}; }
+  };
+
+  auto s = fmt::format("{}", fmt::join(zstring{"hello"}, "_"));
+  // s == "h_e_l_l_o"
+  ```
+
+  Thanks @BRevzin.
+
+- Added support for named arguments, `clear` and `reserve` to
+  `dynamic_format_arg_store`
+  (https://github.com/fmtlib/fmt/issues/1655,
+  https://github.com/fmtlib/fmt/pull/1663,
+  https://github.com/fmtlib/fmt/pull/1674,
+  https://github.com/fmtlib/fmt/pull/1677). Thanks @vsolontsov-ll.
+
+- Added support for the `'c'` format specifier to integral types for
+  compatibility with `std::format`
+  (https://github.com/fmtlib/fmt/issues/1652).
+
+- Replaced the `'n'` format specifier with `'L'` for compatibility
+  with `std::format`
+  (https://github.com/fmtlib/fmt/issues/1624). The `'n'`
+  specifier can be enabled via the `FMT_DEPRECATED_N_SPECIFIER` macro.
+
+- The `'='` format specifier is now disabled by default for
+  compatibility with `std::format`. It can be enabled via the
+  `FMT_DEPRECATED_NUMERIC_ALIGN` macro.
+
+- Removed the following deprecated APIs:
+
+  -   `FMT_STRING_ALIAS` and `fmt` macros - replaced by `FMT_STRING`
+  -   `fmt::basic_string_view::char_type` - replaced by
+      `fmt::basic_string_view::value_type`
+  -   `convert_to_int`
+  -   `format_arg_store::types`
+  -   `*parse_context` - replaced by `*format_parse_context`
+  -   `FMT_DEPRECATED_INCLUDE_OS`
+  -   `FMT_DEPRECATED_PERCENT` - incompatible with `std::format`
+  -   `*writer` - replaced by compiled format API
+
+- Renamed the `internal` namespace to `detail`
+  (https://github.com/fmtlib/fmt/issues/1538). The former is
+  still provided as an alias if the `FMT_USE_INTERNAL` macro is
+  defined.
+
+- Improved compatibility between `fmt::printf` with the standard specs
+  (https://github.com/fmtlib/fmt/issues/1595,
+  https://github.com/fmtlib/fmt/pull/1682,
+  https://github.com/fmtlib/fmt/pull/1683,
+  https://github.com/fmtlib/fmt/pull/1687,
+  https://github.com/fmtlib/fmt/pull/1699). Thanks @rimathia.
+
+- Fixed handling of `operator<<` overloads that use `copyfmt`
+  (https://github.com/fmtlib/fmt/issues/1666).
+
+- Added the `FMT_OS` CMake option to control inclusion of OS-specific
+  APIs in the fmt target. This can be useful for embedded platforms
+  (https://github.com/fmtlib/fmt/issues/1654,
+  https://github.com/fmtlib/fmt/pull/1656). Thanks @kwesolowski.
+
+- Replaced `FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION` with the
+  `FMT_FUZZ` macro to prevent interfering with fuzzing of projects
+  using {fmt} (https://github.com/fmtlib/fmt/pull/1650).
+  Thanks @asraa.
+
+- Fixed compatibility with emscripten
+  (https://github.com/fmtlib/fmt/issues/1636,
+  https://github.com/fmtlib/fmt/pull/1637). Thanks @ArthurSonzogni.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/704,
+  https://github.com/fmtlib/fmt/pull/1643,
+  https://github.com/fmtlib/fmt/pull/1660,
+  https://github.com/fmtlib/fmt/pull/1681,
+  https://github.com/fmtlib/fmt/pull/1691,
+  https://github.com/fmtlib/fmt/pull/1706,
+  https://github.com/fmtlib/fmt/pull/1714,
+  https://github.com/fmtlib/fmt/pull/1721,
+  https://github.com/fmtlib/fmt/pull/1739,
+  https://github.com/fmtlib/fmt/pull/1740,
+  https://github.com/fmtlib/fmt/pull/1741,
+  https://github.com/fmtlib/fmt/pull/1751).
+  Thanks @senior7515, @lsr0, @puetzk, @fpelliccioni, Alexey Kuzmenko, @jelly,
+  @claremacrae, @jiapengwen, @gsjaardema and @alexey-milovidov.
+
+- Implemented various build configuration fixes and improvements
+  (https://github.com/fmtlib/fmt/pull/1603,
+  https://github.com/fmtlib/fmt/pull/1657,
+  https://github.com/fmtlib/fmt/pull/1702,
+  https://github.com/fmtlib/fmt/pull/1728).
+  Thanks @scramsby, @jtojnar, @orivej and @flagarde.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/pull/1616,
+  https://github.com/fmtlib/fmt/issues/1620,
+  https://github.com/fmtlib/fmt/issues/1622,
+  https://github.com/fmtlib/fmt/issues/1625,
+  https://github.com/fmtlib/fmt/pull/1627,
+  https://github.com/fmtlib/fmt/issues/1628,
+  https://github.com/fmtlib/fmt/pull/1629,
+  https://github.com/fmtlib/fmt/issues/1631,
+  https://github.com/fmtlib/fmt/pull/1633,
+  https://github.com/fmtlib/fmt/pull/1649,
+  https://github.com/fmtlib/fmt/issues/1658,
+  https://github.com/fmtlib/fmt/pull/1661,
+  https://github.com/fmtlib/fmt/pull/1667,
+  https://github.com/fmtlib/fmt/issues/1668,
+  https://github.com/fmtlib/fmt/pull/1669,
+  https://github.com/fmtlib/fmt/issues/1692,
+  https://github.com/fmtlib/fmt/pull/1696,
+  https://github.com/fmtlib/fmt/pull/1697,
+  https://github.com/fmtlib/fmt/issues/1707,
+  https://github.com/fmtlib/fmt/pull/1712,
+  https://github.com/fmtlib/fmt/pull/1716,
+  https://github.com/fmtlib/fmt/pull/1722,
+  https://github.com/fmtlib/fmt/issues/1724,
+  https://github.com/fmtlib/fmt/pull/1729,
+  https://github.com/fmtlib/fmt/pull/1738,
+  https://github.com/fmtlib/fmt/issues/1742,
+  https://github.com/fmtlib/fmt/issues/1743,
+  https://github.com/fmtlib/fmt/pull/1744,
+  https://github.com/fmtlib/fmt/issues/1747,
+  https://github.com/fmtlib/fmt/pull/1750).
+  Thanks @gsjaardema, @gabime, @johnor, @Kurkin, @invexed, @peterbell10,
+  @daixtrose, @petrutlucian94, @Neargye, @ambitslix, @gabime, @erthink,
+  @tohammer and @0x8000-0000.
+
+# 6.2.1 - 2020-05-09
+
+- Fixed ostream support in `sprintf`
+  (https://github.com/fmtlib/fmt/issues/1631).
+- Fixed type detection when using implicit conversion to `string_view`
+  and ostream `operator<<` inconsistently
+  (https://github.com/fmtlib/fmt/issues/1662).
+
+# 6.2.0 - 2020-04-05
+
+- Improved error reporting when trying to format an object of a
+  non-formattable type:
+
+  ```c++
+  fmt::format("{}", S());
+  ```
+
+  now gives:
+
+      include/fmt/core.h:1015:5: error: static_assert failed due to requirement
+      'formattable' "Cannot format argument. To make type T formattable provide a
+      formatter<T> specialization:
+      https://fmt.dev/latest/api.html#formatting-user-defined-types"
+          static_assert(
+          ^
+      ...
+      note: in instantiation of function template specialization
+      'fmt::v6::format<char [3], S, char>' requested here
+        fmt::format("{}", S());
+             ^
+
+  if `S` is not formattable.
+
+- Reduced the library size by \~10%.
+
+- Always print decimal point if `#` is specified
+  (https://github.com/fmtlib/fmt/issues/1476,
+  https://github.com/fmtlib/fmt/issues/1498):
+
+  ```c++
+  fmt::print("{:#.0f}", 42.0);
+  ```
+
+  now prints `42.`
+
+- Implemented the `'L'` specifier for locale-specific numeric
+  formatting to improve compatibility with `std::format`. The `'n'`
+  specifier is now deprecated and will be removed in the next major
+  release.
+
+- Moved OS-specific APIs such as `windows_error` from `fmt/format.h`
+  to `fmt/os.h`. You can define `FMT_DEPRECATED_INCLUDE_OS` to
+  automatically include `fmt/os.h` from `fmt/format.h` for
+  compatibility but this will be disabled in the next major release.
+
+- Added precision overflow detection in floating-point formatting.
+
+- Implemented detection of invalid use of `fmt::arg`.
+
+- Used `type_identity` to block unnecessary template argument
+  deduction. Thanks Tim Song.
+
+- Improved UTF-8 handling
+  (https://github.com/fmtlib/fmt/issues/1109):
+
+  ```c++
+  fmt::print("{0:^{2}}\n"
+             "{1: ^{2}}\n"
+             "{0:^{2}}\n", "", ", !", 21);
+  ```
+
+  now prints:
+
+      
+        , !  
+      
+
+  on systems that support Unicode.
+
+- Added experimental dynamic argument storage
+  (https://github.com/fmtlib/fmt/issues/1170,
+  https://github.com/fmtlib/fmt/pull/1584):
+
+  ```c++
+  fmt::dynamic_format_arg_store<fmt::format_context> store;
+  store.push_back("answer");
+  store.push_back(42);
+  fmt::vprint("The {} is {}.\n", store);
+  ```
+
+  prints:
+
+      The answer is 42.
+
+  Thanks @vsolontsov-ll.
+
+- Made `fmt::join` accept `initializer_list`
+  (https://github.com/fmtlib/fmt/pull/1591). Thanks @Rapotkinnik.
+
+- Fixed handling of empty tuples
+  (https://github.com/fmtlib/fmt/issues/1588).
+
+- Fixed handling of output iterators in `format_to_n`
+  (https://github.com/fmtlib/fmt/issues/1506).
+
+- Fixed formatting of `std::chrono::duration` types to wide output
+  (https://github.com/fmtlib/fmt/pull/1533). Thanks @zeffy.
+
+- Added const `begin` and `end` overload to buffers
+  (https://github.com/fmtlib/fmt/pull/1553). Thanks @dominicpoeschko.
+
+- Added the ability to disable floating-point formatting via
+  `FMT_USE_FLOAT`, `FMT_USE_DOUBLE` and `FMT_USE_LONG_DOUBLE` macros
+  for extremely memory-constrained embedded system
+  (https://github.com/fmtlib/fmt/pull/1590). Thanks @albaguirre.
+
+- Made `FMT_STRING` work with `constexpr` `string_view`
+  (https://github.com/fmtlib/fmt/pull/1589). Thanks @scramsby.
+
+- Implemented a minor optimization in the format string parser
+  (https://github.com/fmtlib/fmt/pull/1560). Thanks @IkarusDeveloper.
+
+- Improved attribute detection
+  (https://github.com/fmtlib/fmt/pull/1469,
+  https://github.com/fmtlib/fmt/pull/1475,
+  https://github.com/fmtlib/fmt/pull/1576).
+  Thanks @federico-busato, @chronoxor and @refnum.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/pull/1481,
+  https://github.com/fmtlib/fmt/pull/1523).
+  Thanks @JackBoosY and @imba-tjd.
+
+- Fixed symbol visibility on Linux when compiling with
+  `-fvisibility=hidden`
+  (https://github.com/fmtlib/fmt/pull/1535). Thanks @milianw.
+
+- Implemented various build configuration fixes and improvements
+  (https://github.com/fmtlib/fmt/issues/1264,
+  https://github.com/fmtlib/fmt/issues/1460,
+  https://github.com/fmtlib/fmt/pull/1534,
+  https://github.com/fmtlib/fmt/issues/1536,
+  https://github.com/fmtlib/fmt/issues/1545,
+  https://github.com/fmtlib/fmt/pull/1546,
+  https://github.com/fmtlib/fmt/issues/1566,
+  https://github.com/fmtlib/fmt/pull/1582,
+  https://github.com/fmtlib/fmt/issues/1597,
+  https://github.com/fmtlib/fmt/pull/1598).
+  Thanks @ambitslix, @jwillikers and @stac47.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/pull/1433,
+  https://github.com/fmtlib/fmt/issues/1461,
+  https://github.com/fmtlib/fmt/pull/1470,
+  https://github.com/fmtlib/fmt/pull/1480,
+  https://github.com/fmtlib/fmt/pull/1485,
+  https://github.com/fmtlib/fmt/pull/1492,
+  https://github.com/fmtlib/fmt/issues/1493,
+  https://github.com/fmtlib/fmt/issues/1504,
+  https://github.com/fmtlib/fmt/pull/1505,
+  https://github.com/fmtlib/fmt/pull/1512,
+  https://github.com/fmtlib/fmt/issues/1515,
+  https://github.com/fmtlib/fmt/pull/1516,
+  https://github.com/fmtlib/fmt/pull/1518,
+  https://github.com/fmtlib/fmt/pull/1519,
+  https://github.com/fmtlib/fmt/pull/1520,
+  https://github.com/fmtlib/fmt/pull/1521,
+  https://github.com/fmtlib/fmt/pull/1522,
+  https://github.com/fmtlib/fmt/issues/1524,
+  https://github.com/fmtlib/fmt/pull/1530,
+  https://github.com/fmtlib/fmt/issues/1531,
+  https://github.com/fmtlib/fmt/pull/1532,
+  https://github.com/fmtlib/fmt/issues/1539,
+  https://github.com/fmtlib/fmt/issues/1547,
+  https://github.com/fmtlib/fmt/issues/1548,
+  https://github.com/fmtlib/fmt/pull/1554,
+  https://github.com/fmtlib/fmt/issues/1567,
+  https://github.com/fmtlib/fmt/pull/1568,
+  https://github.com/fmtlib/fmt/pull/1569,
+  https://github.com/fmtlib/fmt/pull/1571,
+  https://github.com/fmtlib/fmt/pull/1573,
+  https://github.com/fmtlib/fmt/pull/1575,
+  https://github.com/fmtlib/fmt/pull/1581,
+  https://github.com/fmtlib/fmt/issues/1583,
+  https://github.com/fmtlib/fmt/issues/1586,
+  https://github.com/fmtlib/fmt/issues/1587,
+  https://github.com/fmtlib/fmt/issues/1594,
+  https://github.com/fmtlib/fmt/pull/1596,
+  https://github.com/fmtlib/fmt/issues/1604,
+  https://github.com/fmtlib/fmt/pull/1606,
+  https://github.com/fmtlib/fmt/issues/1607,
+  https://github.com/fmtlib/fmt/issues/1609).
+  Thanks @marti4d, @iPherian, @parkertomatoes, @gsjaardema, @chronoxor,
+  @DanielaE, @torsten48, @tohammer, @lefticus, @ryusakki, @adnsv, @fghzxm,
+  @refnum, @pramodk, @Spirrwell and @scramsby.
+
+# 6.1.2 - 2019-12-11
+
+- Fixed ABI compatibility with `libfmt.so.6.0.0`
+  (https://github.com/fmtlib/fmt/issues/1471).
+- Fixed handling types convertible to `std::string_view`
+  (https://github.com/fmtlib/fmt/pull/1451). Thanks @denizevrenci.
+- Made CUDA test an opt-in enabled via the `FMT_CUDA_TEST` CMake
+  option.
+- Fixed sign conversion warnings
+  (https://github.com/fmtlib/fmt/pull/1440). Thanks @0x8000-0000.
+
+# 6.1.1 - 2019-12-04
+
+- Fixed shared library build on Windows
+  (https://github.com/fmtlib/fmt/pull/1443,
+  https://github.com/fmtlib/fmt/issues/1445,
+  https://github.com/fmtlib/fmt/pull/1446,
+  https://github.com/fmtlib/fmt/issues/1450).
+  Thanks @egorpugin and @bbolli.
+- Added a missing decimal point in exponent notation with trailing
+  zeros.
+- Removed deprecated `format_arg_store::TYPES`.
+
+# 6.1.0 - 2019-12-01
+
+- {fmt} now formats IEEE 754 `float` and `double` using the shortest
+  decimal representation with correct rounding by default:
+
+  ```c++
+  #include <cmath>
+  #include <fmt/core.h>
+
+  int main() {
+    fmt::print("{}", M_PI);
+  }
+  ```
+
+  prints `3.141592653589793`.
+
+- Made the fast binary to decimal floating-point formatter the
+  default, simplified it and improved performance. {fmt} is now 15
+  times faster than libc++\'s `std::ostringstream`, 11 times faster
+  than `printf` and 10% faster than double-conversion on
+  [dtoa-benchmark](https://github.com/fmtlib/dtoa-benchmark):
+
+  | Function      | Time (ns) | Speedup |
+  | ------------- | --------: | ------: |
+  | ostringstream | 1,346.30  | 1.00x   |
+  | ostrstream    | 1,195.74  | 1.13x   |
+  | sprintf       | 995.08    | 1.35x   |
+  | doubleconv    | 99.10     | 13.59x  |
+  | fmt           | 88.34     | 15.24x  |
+
+  ![](https://user-images.githubusercontent.com/576385/69767160-cdaca400-112f-11ea-9fc5-347c9f83caad.png)
+
+- {fmt} no longer converts `float` arguments to `double`. In
+  particular this improves the default (shortest) representation of
+  floats and makes `fmt::format` consistent with `std::format` specs
+  (https://github.com/fmtlib/fmt/issues/1336,
+  https://github.com/fmtlib/fmt/issues/1353,
+  https://github.com/fmtlib/fmt/pull/1360,
+  https://github.com/fmtlib/fmt/pull/1361):
+
+  ```c++
+  fmt::print("{}", 0.1f);
+  ```
+
+  prints `0.1` instead of `0.10000000149011612`.
+
+  Thanks @orivej.
+
+- Made floating-point formatting output consistent with
+  `printf`/iostreams
+  (https://github.com/fmtlib/fmt/issues/1376,
+  https://github.com/fmtlib/fmt/issues/1417).
+
+- Added support for 128-bit integers
+  (https://github.com/fmtlib/fmt/pull/1287):
+
+  ```c++
+  fmt::print("{}", std::numeric_limits<__int128_t>::max());
+  ```
+
+  prints `170141183460469231731687303715884105727`.
+
+  Thanks @denizevrenci.
+
+- The overload of `print` that takes `text_style` is now atomic, i.e.
+  the output from different threads doesn\'t interleave
+  (https://github.com/fmtlib/fmt/pull/1351). Thanks @tankiJong.
+
+- Made compile time in the header-only mode \~20% faster by reducing
+  the number of template instantiations. `wchar_t` overload of
+  `vprint` was moved from `fmt/core.h` to `fmt/format.h`.
+
+- Added an overload of `fmt::join` that works with tuples
+  (https://github.com/fmtlib/fmt/issues/1322,
+  https://github.com/fmtlib/fmt/pull/1330):
+
+  ```c++
+  #include <tuple>
+  #include <fmt/ranges.h>
+
+  int main() {
+    std::tuple<char, int, float> t{'a', 1, 2.0f};
+    fmt::print("{}", t);
+  }
+  ```
+
+  prints `('a', 1, 2.0)`.
+
+  Thanks @jeremyong.
+
+- Changed formatting of octal zero with prefix from \"00\" to \"0\":
+
+  ```c++
+  fmt::print("{:#o}", 0);
+  ```
+
+  prints `0`.
+
+- The locale is now passed to ostream insertion (`<<`) operators
+  (https://github.com/fmtlib/fmt/pull/1406):
+
+  ```c++
+  #include <fmt/locale.h>
+  #include <fmt/ostream.h>
+
+  struct S {
+    double value;
+  };
+
+  std::ostream& operator<<(std::ostream& os, S s) {
+    return os << s.value;
+  }
+
+  int main() {
+    auto s = fmt::format(std::locale("fr_FR.UTF-8"), "{}", S{0.42});
+    // s == "0,42"
+  }
+  ```
+
+  Thanks @dlaugt.
+
+- Locale-specific number formatting now uses grouping
+  (https://github.com/fmtlib/fmt/issues/1393,
+  https://github.com/fmtlib/fmt/pull/1394). Thanks @skrdaniel.
+
+- Fixed handling of types with deleted implicit rvalue conversion to
+  `const char**` (https://github.com/fmtlib/fmt/issues/1421):
+
+  ```c++
+  struct mystring {
+    operator const char*() const&;
+    operator const char*() &;
+    operator const char*() const&& = delete;
+    operator const char*() && = delete;
+  };
+  mystring str;
+  fmt::print("{}", str); // now compiles
+  ```
+
+- Enums are now mapped to correct underlying types instead of `int`
+  (https://github.com/fmtlib/fmt/pull/1286). Thanks @agmt.
+
+- Enum classes are no longer implicitly converted to `int`
+  (https://github.com/fmtlib/fmt/issues/1424).
+
+- Added `basic_format_parse_context` for consistency with C++20
+  `std::format` and deprecated `basic_parse_context`.
+
+- Fixed handling of UTF-8 in precision
+  (https://github.com/fmtlib/fmt/issues/1389,
+  https://github.com/fmtlib/fmt/pull/1390). Thanks @tajtiattila.
+
+- {fmt} can now be installed on Linux, macOS and Windows with
+  [Conda](https://docs.conda.io/en/latest/) using its
+  [conda-forge](https://conda-forge.org)
+  [package](https://github.com/conda-forge/fmt-feedstock)
+  (https://github.com/fmtlib/fmt/pull/1410):
+
+      conda install -c conda-forge fmt
+
+  Thanks @tdegeus.
+
+- Added a CUDA test (https://github.com/fmtlib/fmt/pull/1285,
+  https://github.com/fmtlib/fmt/pull/1317).
+  Thanks @luncliff and @risa2000.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/pull/1276,
+  https://github.com/fmtlib/fmt/issues/1291,
+  https://github.com/fmtlib/fmt/issues/1296,
+  https://github.com/fmtlib/fmt/pull/1315,
+  https://github.com/fmtlib/fmt/pull/1332,
+  https://github.com/fmtlib/fmt/pull/1337,
+  https://github.com/fmtlib/fmt/issues/1395
+  https://github.com/fmtlib/fmt/pull/1418).
+  Thanks @waywardmonkeys, @pauldreik and @jackoalan.
+
+- Various code improvements
+  (https://github.com/fmtlib/fmt/pull/1358,
+  https://github.com/fmtlib/fmt/pull/1407).
+  Thanks @orivej and @dpacbach.
+
+- Fixed compile-time format string checks for user-defined types
+  (https://github.com/fmtlib/fmt/issues/1292).
+
+- Worked around a false positive in `unsigned-integer-overflow` sanitizer
+  (https://github.com/fmtlib/fmt/issues/1377).
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/issues/1273,
+  https://github.com/fmtlib/fmt/pull/1278,
+  https://github.com/fmtlib/fmt/pull/1280,
+  https://github.com/fmtlib/fmt/issues/1281,
+  https://github.com/fmtlib/fmt/issues/1288,
+  https://github.com/fmtlib/fmt/pull/1290,
+  https://github.com/fmtlib/fmt/pull/1301,
+  https://github.com/fmtlib/fmt/issues/1305,
+  https://github.com/fmtlib/fmt/issues/1306,
+  https://github.com/fmtlib/fmt/issues/1309,
+  https://github.com/fmtlib/fmt/pull/1312,
+  https://github.com/fmtlib/fmt/issues/1313,
+  https://github.com/fmtlib/fmt/issues/1316,
+  https://github.com/fmtlib/fmt/issues/1319,
+  https://github.com/fmtlib/fmt/pull/1320,
+  https://github.com/fmtlib/fmt/pull/1326,
+  https://github.com/fmtlib/fmt/pull/1328,
+  https://github.com/fmtlib/fmt/issues/1344,
+  https://github.com/fmtlib/fmt/pull/1345,
+  https://github.com/fmtlib/fmt/pull/1347,
+  https://github.com/fmtlib/fmt/pull/1349,
+  https://github.com/fmtlib/fmt/issues/1354,
+  https://github.com/fmtlib/fmt/issues/1362,
+  https://github.com/fmtlib/fmt/issues/1366,
+  https://github.com/fmtlib/fmt/pull/1364,
+  https://github.com/fmtlib/fmt/pull/1370,
+  https://github.com/fmtlib/fmt/pull/1371,
+  https://github.com/fmtlib/fmt/issues/1385,
+  https://github.com/fmtlib/fmt/issues/1388,
+  https://github.com/fmtlib/fmt/pull/1397,
+  https://github.com/fmtlib/fmt/pull/1414,
+  https://github.com/fmtlib/fmt/pull/1416,
+  https://github.com/fmtlib/fmt/issues/1422
+  https://github.com/fmtlib/fmt/pull/1427,
+  https://github.com/fmtlib/fmt/issues/1431,
+  https://github.com/fmtlib/fmt/pull/1433).
+  Thanks @hhb, @gsjaardema, @gabime, @neheb, @vedranmiletic, @dkavolis,
+  @mwinterb, @orivej, @denizevrenci, @leonklingele, @chronoxor, @kent-tri,
+  @0x8000-0000 and @marti4d.
+
+# 6.0.0 - 2019-08-26
+
+- Switched to the [MIT license](
+  https://github.com/fmtlib/fmt/blob/5a4b24613ba16cc689977c3b5bd8274a3ba1dd1f/LICENSE.rst)
+  with an optional exception that allows distributing binary code
+  without attribution.
+
+- Floating-point formatting is now locale-independent by default:
+
+  ```c++
+  #include <locale>
+  #include <fmt/core.h>
+
+  int main() {
+    std::locale::global(std::locale("ru_RU.UTF-8"));
+    fmt::print("value = {}", 4.2);
+  }
+  ```
+
+  prints \"value = 4.2\" regardless of the locale.
+
+  For locale-specific formatting use the `n` specifier:
+
+  ```c++
+  std::locale::global(std::locale("ru_RU.UTF-8"));
+  fmt::print("value = {:n}", 4.2);
+  ```
+
+  prints \"value = 4,2\".
+
+- Added an experimental Grisu floating-point formatting algorithm
+  implementation (disabled by default). To enable it compile with the
+  `FMT_USE_GRISU` macro defined to 1:
+
+  ```c++
+  #define FMT_USE_GRISU 1
+  #include <fmt/format.h>
+
+  auto s = fmt::format("{}", 4.2); // formats 4.2 using Grisu
+  ```
+
+  With Grisu enabled, {fmt} is 13x faster than `std::ostringstream`
+  (libc++) and 10x faster than `sprintf` on
+  [dtoa-benchmark](https://github.com/fmtlib/dtoa-benchmark) ([full
+  results](https://fmt.dev/unknown_mac64_clang10.0.html)):
+
+  ![](https://user-images.githubusercontent.com/576385/54883977-9fe8c000-4e28-11e9-8bde-272d122e7c52.jpg)
+
+- Separated formatting and parsing contexts for consistency with
+  [C++20 std::format](http://eel.is/c++draft/format), removing the
+  undocumented `basic_format_context::parse_context()` function.
+
+- Added [oss-fuzz](https://github.com/google/oss-fuzz) support
+  (https://github.com/fmtlib/fmt/pull/1199). Thanks @pauldreik.
+
+- `formatter` specializations now always take precedence over
+  `operator<<` (https://github.com/fmtlib/fmt/issues/952):
+
+  ```c++
+  #include <iostream>
+  #include <fmt/ostream.h>
+
+  struct S {};
+
+  std::ostream& operator<<(std::ostream& os, S) {
+    return os << 1;
+  }
+
+  template <>
+  struct fmt::formatter<S> : fmt::formatter<int> {
+    auto format(S, format_context& ctx) {
+      return formatter<int>::format(2, ctx);
+    }
+  };
+
+  int main() {
+    std::cout << S() << "\n"; // prints 1 using operator<<
+    fmt::print("{}\n", S());  // prints 2 using formatter
+  }
+  ```
+
+- Introduced the experimental `fmt::compile` function that does format
+  string compilation
+  (https://github.com/fmtlib/fmt/issues/618,
+  https://github.com/fmtlib/fmt/issues/1169,
+  https://github.com/fmtlib/fmt/pull/1171):
+
+  ```c++
+  #include <fmt/compile.h>
+
+  auto f = fmt::compile<int>("{}");
+  std::string s = fmt::format(f, 42); // can be called multiple times to
+                                      // format different values
+  // s == "42"
+  ```
+
+  It moves the cost of parsing a format string outside of the format
+  function which can be beneficial when identically formatting many
+  objects of the same types. Thanks @stryku.
+
+- Added experimental `%` format specifier that formats floating-point
+  values as percentages
+  (https://github.com/fmtlib/fmt/pull/1060,
+  https://github.com/fmtlib/fmt/pull/1069,
+  https://github.com/fmtlib/fmt/pull/1071):
+
+  ```c++
+  auto s = fmt::format("{:.1%}", 0.42); // s == "42.0%"
+  ```
+
+  Thanks @gawain-bolton.
+
+- Implemented precision for floating-point durations
+  (https://github.com/fmtlib/fmt/issues/1004,
+  https://github.com/fmtlib/fmt/pull/1012):
+
+  ```c++
+  auto s = fmt::format("{:.1}", std::chrono::duration<double>(1.234));
+  // s == 1.2s
+  ```
+
+  Thanks @DanielaE.
+
+- Implemented `chrono` format specifiers `%Q` and `%q` that give the
+  value and the unit respectively
+  (https://github.com/fmtlib/fmt/pull/1019):
+
+  ```c++
+  auto value = fmt::format("{:%Q}", 42s); // value == "42"
+  auto unit  = fmt::format("{:%q}", 42s); // unit == "s"
+  ```
+
+  Thanks @DanielaE.
+
+- Fixed handling of dynamic width in chrono formatter:
+
+  ```c++
+  auto s = fmt::format("{0:{1}%H:%M:%S}", std::chrono::seconds(12345), 12);
+  //                        ^ width argument index                     ^ width
+  // s == "03:25:45    "
+  ```
+
+  Thanks Howard Hinnant.
+
+- Removed deprecated `fmt/time.h`. Use `fmt/chrono.h` instead.
+
+- Added `fmt::format` and `fmt::vformat` overloads that take
+  `text_style` (https://github.com/fmtlib/fmt/issues/993,
+  https://github.com/fmtlib/fmt/pull/994):
+
+  ```c++
+  #include <fmt/color.h>
+
+  std::string message = fmt::format(fmt::emphasis::bold | fg(fmt::color::red),
+                                    "The answer is {}.", 42);
+  ```
+
+  Thanks @Naios.
+
+- Removed the deprecated color API (`print_colored`). Use the new API,
+  namely `print` overloads that take `text_style` instead.
+
+- Made `std::unique_ptr` and `std::shared_ptr` formattable as pointers
+  via `fmt::ptr` (https://github.com/fmtlib/fmt/pull/1121):
+
+  ```c++
+  std::unique_ptr<int> p = ...;
+  fmt::print("{}", fmt::ptr(p)); // prints p as a pointer
+  ```
+
+  Thanks @sighingnow.
+
+- Made `print` and `vprint` report I/O errors
+  (https://github.com/fmtlib/fmt/issues/1098,
+  https://github.com/fmtlib/fmt/pull/1099). Thanks @BillyDonahue.
+
+- Marked deprecated APIs with the `[[deprecated]]` attribute and
+  removed internal uses of deprecated APIs
+  (https://github.com/fmtlib/fmt/pull/1022). Thanks @eliaskosunen.
+
+- Modernized the codebase using more C++11 features and removing
+  workarounds. Most importantly, `buffer_context` is now an alias
+  template, so use `buffer_context<T>` instead of
+  `buffer_context<T>::type`. These features require GCC 4.8 or later.
+
+- `formatter` specializations now always take precedence over implicit
+  conversions to `int` and the undocumented `convert_to_int` trait is
+  now deprecated.
+
+- Moved the undocumented `basic_writer`, `writer`, and `wwriter` types
+  to the `internal` namespace.
+
+- Removed deprecated `basic_format_context::begin()`. Use `out()`
+  instead.
+
+- Disallowed passing the result of `join` as an lvalue to prevent
+  misuse.
+
+- Refactored the undocumented structs that represent parsed format
+  specifiers to simplify the API and allow multibyte fill.
+
+- Moved SFINAE to template parameters to reduce symbol sizes.
+
+- Switched to `fputws` for writing wide strings so that it\'s no
+  longer required to call `_setmode` on Windows
+  (https://github.com/fmtlib/fmt/issues/1229,
+  https://github.com/fmtlib/fmt/pull/1243). Thanks @jackoalan.
+
+- Improved literal-based API
+  (https://github.com/fmtlib/fmt/pull/1254). Thanks @sylveon.
+
+- Added support for exotic platforms without `uintptr_t` such as IBM i
+  (AS/400) which has 128-bit pointers and only 64-bit integers
+  (https://github.com/fmtlib/fmt/issues/1059).
+
+- Added [Sublime Text syntax highlighting config](
+  https://github.com/fmtlib/fmt/blob/master/support/C%2B%2B.sublime-syntax)
+  (https://github.com/fmtlib/fmt/issues/1037). Thanks @Kronuz.
+
+- Added the `FMT_ENFORCE_COMPILE_STRING` macro to enforce the use of
+  compile-time format strings
+  (https://github.com/fmtlib/fmt/pull/1231). Thanks @jackoalan.
+
+- Stopped setting `CMAKE_BUILD_TYPE` if {fmt} is a subproject
+  (https://github.com/fmtlib/fmt/issues/1081).
+
+- Various build improvements
+  (https://github.com/fmtlib/fmt/pull/1039,
+  https://github.com/fmtlib/fmt/pull/1078,
+  https://github.com/fmtlib/fmt/pull/1091,
+  https://github.com/fmtlib/fmt/pull/1103,
+  https://github.com/fmtlib/fmt/pull/1177).
+  Thanks @luncliff, @jasonszang, @olafhering, @Lecetem and @pauldreik.
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/1049,
+  https://github.com/fmtlib/fmt/pull/1051,
+  https://github.com/fmtlib/fmt/pull/1083,
+  https://github.com/fmtlib/fmt/pull/1113,
+  https://github.com/fmtlib/fmt/pull/1114,
+  https://github.com/fmtlib/fmt/issues/1146,
+  https://github.com/fmtlib/fmt/issues/1180,
+  https://github.com/fmtlib/fmt/pull/1250,
+  https://github.com/fmtlib/fmt/pull/1252,
+  https://github.com/fmtlib/fmt/pull/1265).
+  Thanks @mikelui, @foonathan, @BillyDonahue, @jwakely, @kaisbe and
+  @sdebionne.
+
+- Fixed ambiguous formatter specialization in `fmt/ranges.h`
+  (https://github.com/fmtlib/fmt/issues/1123).
+
+- Fixed formatting of a non-empty `std::filesystem::path` which is an
+  infinitely deep range of its components
+  (https://github.com/fmtlib/fmt/issues/1268).
+
+- Fixed handling of general output iterators when formatting
+  characters (https://github.com/fmtlib/fmt/issues/1056,
+  https://github.com/fmtlib/fmt/pull/1058). Thanks @abolz.
+
+- Fixed handling of output iterators in `formatter` specialization for
+  ranges (https://github.com/fmtlib/fmt/issues/1064).
+
+- Fixed handling of exotic character types
+  (https://github.com/fmtlib/fmt/issues/1188).
+
+- Made chrono formatting work with exceptions disabled
+  (https://github.com/fmtlib/fmt/issues/1062).
+
+- Fixed DLL visibility issues
+  (https://github.com/fmtlib/fmt/pull/1134,
+  https://github.com/fmtlib/fmt/pull/1147). Thanks @denchat.
+
+- Disabled the use of UDL template extension on GCC 9
+  (https://github.com/fmtlib/fmt/issues/1148).
+
+- Removed misplaced `format` compile-time checks from `printf`
+  (https://github.com/fmtlib/fmt/issues/1173).
+
+- Fixed issues in the experimental floating-point formatter
+  (https://github.com/fmtlib/fmt/issues/1072,
+  https://github.com/fmtlib/fmt/issues/1129,
+  https://github.com/fmtlib/fmt/issues/1153,
+  https://github.com/fmtlib/fmt/pull/1155,
+  https://github.com/fmtlib/fmt/issues/1210,
+  https://github.com/fmtlib/fmt/issues/1222). Thanks @alabuzhev.
+
+- Fixed bugs discovered by fuzzing or during fuzzing integration
+  (https://github.com/fmtlib/fmt/issues/1124,
+  https://github.com/fmtlib/fmt/issues/1127,
+  https://github.com/fmtlib/fmt/issues/1132,
+  https://github.com/fmtlib/fmt/pull/1135,
+  https://github.com/fmtlib/fmt/issues/1136,
+  https://github.com/fmtlib/fmt/issues/1141,
+  https://github.com/fmtlib/fmt/issues/1142,
+  https://github.com/fmtlib/fmt/issues/1178,
+  https://github.com/fmtlib/fmt/issues/1179,
+  https://github.com/fmtlib/fmt/issues/1194). Thanks @pauldreik.
+
+- Fixed building tests on FreeBSD and Hurd
+  (https://github.com/fmtlib/fmt/issues/1043). Thanks @jackyf.
+
+- Fixed various warnings and compilation issues
+  (https://github.com/fmtlib/fmt/pull/998,
+  https://github.com/fmtlib/fmt/pull/1006,
+  https://github.com/fmtlib/fmt/issues/1008,
+  https://github.com/fmtlib/fmt/issues/1011,
+  https://github.com/fmtlib/fmt/issues/1025,
+  https://github.com/fmtlib/fmt/pull/1027,
+  https://github.com/fmtlib/fmt/pull/1028,
+  https://github.com/fmtlib/fmt/pull/1029,
+  https://github.com/fmtlib/fmt/pull/1030,
+  https://github.com/fmtlib/fmt/pull/1031,
+  https://github.com/fmtlib/fmt/pull/1054,
+  https://github.com/fmtlib/fmt/issues/1063,
+  https://github.com/fmtlib/fmt/pull/1068,
+  https://github.com/fmtlib/fmt/pull/1074,
+  https://github.com/fmtlib/fmt/pull/1075,
+  https://github.com/fmtlib/fmt/pull/1079,
+  https://github.com/fmtlib/fmt/pull/1086,
+  https://github.com/fmtlib/fmt/issues/1088,
+  https://github.com/fmtlib/fmt/pull/1089,
+  https://github.com/fmtlib/fmt/pull/1094,
+  https://github.com/fmtlib/fmt/issues/1101,
+  https://github.com/fmtlib/fmt/pull/1102,
+  https://github.com/fmtlib/fmt/issues/1105,
+  https://github.com/fmtlib/fmt/pull/1107,
+  https://github.com/fmtlib/fmt/issues/1115,
+  https://github.com/fmtlib/fmt/issues/1117,
+  https://github.com/fmtlib/fmt/issues/1118,
+  https://github.com/fmtlib/fmt/issues/1120,
+  https://github.com/fmtlib/fmt/issues/1123,
+  https://github.com/fmtlib/fmt/pull/1139,
+  https://github.com/fmtlib/fmt/issues/1140,
+  https://github.com/fmtlib/fmt/issues/1143,
+  https://github.com/fmtlib/fmt/pull/1144,
+  https://github.com/fmtlib/fmt/pull/1150,
+  https://github.com/fmtlib/fmt/pull/1151,
+  https://github.com/fmtlib/fmt/issues/1152,
+  https://github.com/fmtlib/fmt/issues/1154,
+  https://github.com/fmtlib/fmt/issues/1156,
+  https://github.com/fmtlib/fmt/pull/1159,
+  https://github.com/fmtlib/fmt/issues/1175,
+  https://github.com/fmtlib/fmt/issues/1181,
+  https://github.com/fmtlib/fmt/issues/1186,
+  https://github.com/fmtlib/fmt/pull/1187,
+  https://github.com/fmtlib/fmt/pull/1191,
+  https://github.com/fmtlib/fmt/issues/1197,
+  https://github.com/fmtlib/fmt/issues/1200,
+  https://github.com/fmtlib/fmt/issues/1203,
+  https://github.com/fmtlib/fmt/issues/1205,
+  https://github.com/fmtlib/fmt/pull/1206,
+  https://github.com/fmtlib/fmt/issues/1213,
+  https://github.com/fmtlib/fmt/issues/1214,
+  https://github.com/fmtlib/fmt/pull/1217,
+  https://github.com/fmtlib/fmt/issues/1228,
+  https://github.com/fmtlib/fmt/pull/1230,
+  https://github.com/fmtlib/fmt/issues/1232,
+  https://github.com/fmtlib/fmt/pull/1235,
+  https://github.com/fmtlib/fmt/pull/1236,
+  https://github.com/fmtlib/fmt/issues/1240).
+  Thanks @DanielaE, @mwinterb, @eliaskosunen, @morinmorin, @ricco19,
+  @waywardmonkeys, @chronoxor, @remyabel, @pauldreik, @gsjaardema, @rcane,
+  @mocabe, @denchat, @cjdb, @HazardyKnusperkeks, @vedranmiletic, @jackoalan,
+  @DaanDeMeyer and @starkmapper.
+
+# 5.3.0 - 2018-12-28
+
+- Introduced experimental chrono formatting support:
+
+  ```c++
+  #include <fmt/chrono.h>
+
+  int main() {
+    using namespace std::literals::chrono_literals;
+    fmt::print("Default format: {} {}\n", 42s, 100ms);
+    fmt::print("strftime-like format: {:%H:%M:%S}\n", 3h + 15min + 30s);
+  }
+  ```
+
+  prints:
+
+      Default format: 42s 100ms
+      strftime-like format: 03:15:30
+
+- Added experimental support for emphasis (bold, italic, underline,
+  strikethrough), colored output to a file stream, and improved
+  colored formatting API
+  (https://github.com/fmtlib/fmt/pull/961,
+  https://github.com/fmtlib/fmt/pull/967,
+  https://github.com/fmtlib/fmt/pull/973):
+
+  ```c++
+  #include <fmt/color.h>
+
+  int main() {
+    fmt::print(fg(fmt::color::crimson) | fmt::emphasis::bold,
+               "Hello, {}!\n", "world");
+    fmt::print(fg(fmt::color::floral_white) | bg(fmt::color::slate_gray) |
+               fmt::emphasis::underline, "Ol, {}!\n", "Mundo");
+    fmt::print(fg(fmt::color::steel_blue) | fmt::emphasis::italic,
+               "{}\n", "");
+  }
+  ```
+
+  prints the following on modern terminals with RGB color support:
+
+  ![](https://github.com/fmtlib/fmt/assets/%0A576385/2a93c904-d6fa-4aa6-b453-2618e1c327d7)
+
+  Thanks @Rakete1111.
+
+- Added support for 4-bit terminal colors
+  (https://github.com/fmtlib/fmt/issues/968,
+  https://github.com/fmtlib/fmt/pull/974)
+
+  ```c++
+  #include <fmt/color.h>
+
+  int main() {
+    print(fg(fmt::terminal_color::red), "stop\n");
+  }
+  ```
+
+  Note that these colors vary by terminal:
+
+  ![](https://user-images.githubusercontent.com/576385/50405925-dbfc7e00-0770-11e9-9b85-333fab0af9ac.png)
+
+  Thanks @Rakete1111.
+
+- Parameterized formatting functions on the type of the format string
+  (https://github.com/fmtlib/fmt/issues/880,
+  https://github.com/fmtlib/fmt/pull/881,
+  https://github.com/fmtlib/fmt/pull/883,
+  https://github.com/fmtlib/fmt/pull/885,
+  https://github.com/fmtlib/fmt/pull/897,
+  https://github.com/fmtlib/fmt/issues/920). Any object of
+  type `S` that has an overloaded `to_string_view(const S&)` returning
+  `fmt::string_view` can be used as a format string:
+
+  ```c++
+  namespace my_ns {
+  inline string_view to_string_view(const my_string& s) {
+    return {s.data(), s.length()};
+  }
+  }
+
+  std::string message = fmt::format(my_string("The answer is {}."), 42);
+  ```
+
+  Thanks @DanielaE.
+
+- Made `std::string_view` work as a format string
+  (https://github.com/fmtlib/fmt/pull/898):
+
+  ```c++
+  auto message = fmt::format(std::string_view("The answer is {}."), 42);
+  ```
+
+  Thanks @DanielaE.
+
+- Added wide string support to compile-time format string checks
+  (https://github.com/fmtlib/fmt/pull/924):
+
+  ```c++
+  print(fmt(L"{:f}"), 42); // compile-time error: invalid type specifier
+  ```
+
+  Thanks @XZiar.
+
+- Made colored print functions work with wide strings
+  (https://github.com/fmtlib/fmt/pull/867):
+
+  ```c++
+  #include <fmt/color.h>
+
+  int main() {
+    print(fg(fmt::color::red), L"{}\n", 42);
+  }
+  ```
+
+  Thanks @DanielaE.
+
+- Introduced experimental Unicode support
+  (https://github.com/fmtlib/fmt/issues/628,
+  https://github.com/fmtlib/fmt/pull/891):
+
+  ```c++
+  using namespace fmt::literals;
+  auto s = fmt::format("{:*^5}"_u, ""_u); // s == "****"_u
+  ```
+
+- Improved locale support:
+
+  ```c++
+  #include <fmt/locale.h>
+
+  struct numpunct : std::numpunct<char> {
+   protected:
+    char do_thousands_sep() const override { return '~'; }
+  };
+
+  std::locale loc;
+  auto s = fmt::format(std::locale(loc, new numpunct()), "{:n}", 1234567);
+  // s == "1~234~567"
+  ```
+
+- Constrained formatting functions on proper iterator types
+  (https://github.com/fmtlib/fmt/pull/921). Thanks @DanielaE.
+
+- Added `make_printf_args` and `make_wprintf_args` functions
+  (https://github.com/fmtlib/fmt/pull/934). Thanks @tnovotny.
+
+- Deprecated `fmt::visit`, `parse_context`, and `wparse_context`. Use
+  `fmt::visit_format_arg`, `format_parse_context`, and
+  `wformat_parse_context` instead.
+
+- Removed undocumented `basic_fixed_buffer` which has been superseded
+  by the iterator-based API
+  (https://github.com/fmtlib/fmt/issues/873,
+  https://github.com/fmtlib/fmt/pull/902). Thanks @superfunc.
+
+- Disallowed repeated leading zeros in an argument ID:
+
+  ```c++
+  fmt::print("{000}", 42); // error
+  ```
+
+- Reintroduced support for gcc 4.4.
+
+- Fixed compilation on platforms with exotic `double`
+  (https://github.com/fmtlib/fmt/issues/878).
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/issues/164,
+  https://github.com/fmtlib/fmt/issues/877,
+  https://github.com/fmtlib/fmt/pull/901,
+  https://github.com/fmtlib/fmt/pull/906,
+  https://github.com/fmtlib/fmt/pull/979).
+  Thanks @kookjr, @DarkDimius and @HecticSerenity.
+
+- Added pkgconfig support which makes it easier to consume the library
+  from meson and other build systems
+  (https://github.com/fmtlib/fmt/pull/916). Thanks @colemickens.
+
+- Various build improvements
+  (https://github.com/fmtlib/fmt/pull/909,
+  https://github.com/fmtlib/fmt/pull/926,
+  https://github.com/fmtlib/fmt/pull/937,
+  https://github.com/fmtlib/fmt/pull/953,
+  https://github.com/fmtlib/fmt/pull/959).
+  Thanks @tchaikov, @luncliff, @AndreasSchoenle, @hotwatermorning and @Zefz.
+
+- Improved `string_view` construction performance
+  (https://github.com/fmtlib/fmt/pull/914). Thanks @gabime.
+
+- Fixed non-matching char types
+  (https://github.com/fmtlib/fmt/pull/895). Thanks @DanielaE.
+
+- Fixed `format_to_n` with `std::back_insert_iterator`
+  (https://github.com/fmtlib/fmt/pull/913). Thanks @DanielaE.
+
+- Fixed locale-dependent formatting
+  (https://github.com/fmtlib/fmt/issues/905).
+
+- Fixed various compiler warnings and errors
+  (https://github.com/fmtlib/fmt/pull/882,
+  https://github.com/fmtlib/fmt/pull/886,
+  https://github.com/fmtlib/fmt/pull/933,
+  https://github.com/fmtlib/fmt/pull/941,
+  https://github.com/fmtlib/fmt/issues/931,
+  https://github.com/fmtlib/fmt/pull/943,
+  https://github.com/fmtlib/fmt/pull/954,
+  https://github.com/fmtlib/fmt/pull/956,
+  https://github.com/fmtlib/fmt/pull/962,
+  https://github.com/fmtlib/fmt/issues/965,
+  https://github.com/fmtlib/fmt/issues/977,
+  https://github.com/fmtlib/fmt/pull/983,
+  https://github.com/fmtlib/fmt/pull/989).
+  Thanks @Luthaf, @stevenhoving, @christinaa, @lgritz, @DanielaE,
+  @0x8000-0000 and @liuping1997.
+
+# 5.2.1 - 2018-09-21
+
+- Fixed `visit` lookup issues on gcc 7 & 8
+  (https://github.com/fmtlib/fmt/pull/870). Thanks @medithe.
+- Fixed linkage errors on older gcc.
+- Prevented `fmt/range.h` from specializing `fmt::basic_string_view`
+  (https://github.com/fmtlib/fmt/issues/865,
+  https://github.com/fmtlib/fmt/pull/868). Thanks @hhggit.
+- Improved error message when formatting unknown types
+  (https://github.com/fmtlib/fmt/pull/872). Thanks @foonathan.
+- Disabled templated user-defined literals when compiled under nvcc
+  (https://github.com/fmtlib/fmt/pull/875). Thanks @CandyGumdrop.
+- Fixed `format_to` formatting to `wmemory_buffer`
+  (https://github.com/fmtlib/fmt/issues/874).
+
+# 5.2.0 - 2018-09-13
+
+- Optimized format string parsing and argument processing which
+  resulted in up to 5x speed up on long format strings and significant
+  performance boost on various benchmarks. For example, version 5.2 is
+  2.22x faster than 5.1 on decimal integer formatting with `format_to`
+  (macOS, clang-902.0.39.2):
+
+  | Method                     | Time, s         | Speedup |
+  | -------------------------- | --------------: | ------: |
+  | fmt::format 5.1            | 0.58            |         |
+  | fmt::format 5.2            | 0.35            |   1.66x |
+  | fmt::format_to 5.1         | 0.51            |         |
+  | fmt::format_to 5.2         | 0.23            |   2.22x |
+  | sprintf                    | 0.71            |         |
+  | std::to_string             | 1.01            |         |
+  | std::stringstream          | 1.73            |         |
+
+- Changed the `fmt` macro from opt-out to opt-in to prevent name
+  collisions. To enable it define the `FMT_STRING_ALIAS` macro to 1
+  before including `fmt/format.h`:
+
+  ```c++
+  #define FMT_STRING_ALIAS 1
+  #include <fmt/format.h>
+  std::string answer = format(fmt("{}"), 42);
+  ```
+
+- Added compile-time format string checks to `format_to` overload that
+  takes `fmt::memory_buffer`
+  (https://github.com/fmtlib/fmt/issues/783):
+
+  ```c++
+  fmt::memory_buffer buf;
+  // Compile-time error: invalid type specifier.
+  fmt::format_to(buf, fmt("{:d}"), "foo");
+  ```
+
+- Moved experimental color support to `fmt/color.h` and enabled the
+  new API by default. The old API can be enabled by defining the
+  `FMT_DEPRECATED_COLORS` macro.
+
+- Added formatting support for types explicitly convertible to
+  `fmt::string_view`:
+
+  ```c++
+  struct foo {
+    explicit operator fmt::string_view() const { return "foo"; }
+  };
+  auto s = format("{}", foo());
+  ```
+
+  In particular, this makes formatting function work with
+  `folly::StringPiece`.
+
+- Implemented preliminary support for `char*_t` by replacing the
+  `format` function overloads with a single function template
+  parameterized on the string type.
+
+- Added support for dynamic argument lists
+  (https://github.com/fmtlib/fmt/issues/814,
+  https://github.com/fmtlib/fmt/pull/819). Thanks @MikePopoloski.
+
+- Reduced executable size overhead for embedded targets using newlib
+  nano by making locale dependency optional
+  (https://github.com/fmtlib/fmt/pull/839). Thanks @teajay-fr.
+
+- Keep `noexcept` specifier when exceptions are disabled
+  (https://github.com/fmtlib/fmt/issues/801,
+  https://github.com/fmtlib/fmt/pull/810). Thanks @qis.
+
+- Fixed formatting of user-defined types providing `operator<<` with
+  `format_to_n` (https://github.com/fmtlib/fmt/pull/806).
+  Thanks @mkurdej.
+
+- Fixed dynamic linkage of new symbols
+  (https://github.com/fmtlib/fmt/issues/808).
+
+- Fixed global initialization issue
+  (https://github.com/fmtlib/fmt/issues/807):
+
+  ```c++
+  // This works on compilers with constexpr support.
+  static const std::string answer = fmt::format("{}", 42);
+  ```
+
+- Fixed various compiler warnings and errors
+  (https://github.com/fmtlib/fmt/pull/804,
+  https://github.com/fmtlib/fmt/issues/809,
+  https://github.com/fmtlib/fmt/pull/811,
+  https://github.com/fmtlib/fmt/issues/822,
+  https://github.com/fmtlib/fmt/pull/827,
+  https://github.com/fmtlib/fmt/issues/830,
+  https://github.com/fmtlib/fmt/pull/838,
+  https://github.com/fmtlib/fmt/issues/843,
+  https://github.com/fmtlib/fmt/pull/844,
+  https://github.com/fmtlib/fmt/issues/851,
+  https://github.com/fmtlib/fmt/pull/852,
+  https://github.com/fmtlib/fmt/pull/854).
+  Thanks @henryiii, @medithe, and @eliasdaler.
+
+# 5.1.0 - 2018-07-05
+
+- Added experimental support for RGB color output enabled with the
+  `FMT_EXTENDED_COLORS` macro:
+
+  ```c++
+  #define FMT_EXTENDED_COLORS
+  #define FMT_HEADER_ONLY // or compile fmt with FMT_EXTENDED_COLORS defined
+  #include <fmt/format.h>
+
+  fmt::print(fmt::color::steel_blue, "Some beautiful text");
+  ```
+
+  The old API (the `print_colored` and `vprint_colored` functions and
+  the `color` enum) is now deprecated.
+  (https://github.com/fmtlib/fmt/issues/762
+  https://github.com/fmtlib/fmt/pull/767). thanks @Remotion.
+
+- Added quotes to strings in ranges and tuples
+  (https://github.com/fmtlib/fmt/pull/766). Thanks @Remotion.
+
+- Made `format_to` work with `basic_memory_buffer`
+  (https://github.com/fmtlib/fmt/issues/776).
+
+- Added `vformat_to_n` and `wchar_t` overload of `format_to_n`
+  (https://github.com/fmtlib/fmt/issues/764,
+  https://github.com/fmtlib/fmt/issues/769).
+
+- Made `is_range` and `is_tuple_like` part of public (experimental)
+  API to allow specialization for user-defined types
+  (https://github.com/fmtlib/fmt/issues/751,
+  https://github.com/fmtlib/fmt/pull/759). Thanks @drrlvn.
+
+- Added more compilers to continuous integration and increased
+  `FMT_PEDANTIC` warning levels
+  (https://github.com/fmtlib/fmt/pull/736). Thanks @eliaskosunen.
+
+- Fixed compilation with MSVC 2013.
+
+- Fixed handling of user-defined types in `format_to`
+  (https://github.com/fmtlib/fmt/issues/793).
+
+- Forced linking of inline `vformat` functions into the library
+  (https://github.com/fmtlib/fmt/issues/795).
+
+- Fixed incorrect call to on_align in `'{:}='`
+  (https://github.com/fmtlib/fmt/issues/750).
+
+- Fixed floating-point formatting to a non-back_insert_iterator with
+  sign & numeric alignment specified
+  (https://github.com/fmtlib/fmt/issues/756).
+
+- Fixed formatting to an array with `format_to_n`
+  (https://github.com/fmtlib/fmt/issues/778).
+
+- Fixed formatting of more than 15 named arguments
+  (https://github.com/fmtlib/fmt/issues/754).
+
+- Fixed handling of compile-time strings when including
+  `fmt/ostream.h`. (https://github.com/fmtlib/fmt/issues/768).
+
+- Fixed various compiler warnings and errors
+  (https://github.com/fmtlib/fmt/issues/742,
+  https://github.com/fmtlib/fmt/issues/748,
+  https://github.com/fmtlib/fmt/issues/752,
+  https://github.com/fmtlib/fmt/issues/770,
+  https://github.com/fmtlib/fmt/pull/775,
+  https://github.com/fmtlib/fmt/issues/779,
+  https://github.com/fmtlib/fmt/pull/780,
+  https://github.com/fmtlib/fmt/pull/790,
+  https://github.com/fmtlib/fmt/pull/792,
+  https://github.com/fmtlib/fmt/pull/800).
+  Thanks @Remotion, @gabime, @foonathan, @Dark-Passenger and @0x8000-0000.
+
+# 5.0.0 - 2018-05-21
+
+- Added a requirement for partial C++11 support, most importantly
+  variadic templates and type traits, and dropped `FMT_VARIADIC_*`
+  emulation macros. Variadic templates are available since GCC 4.4,
+  Clang 2.9 and MSVC 18.0 (2013). For older compilers use {fmt}
+  [version 4.x](https://github.com/fmtlib/fmt/releases/tag/4.1.0)
+  which continues to be maintained and works with C++98 compilers.
+
+- Renamed symbols to follow standard C++ naming conventions and
+  proposed a subset of the library for standardization in [P0645R2
+  Text Formatting](https://wg21.link/P0645).
+
+- Implemented `constexpr` parsing of format strings and [compile-time
+  format string
+  checks](https://fmt.dev/latest/api.html#compile-time-format-string-checks).
+  For example
+
+  ```c++
+  #include <fmt/format.h>
+
+  std::string s = format(fmt("{:d}"), "foo");
+  ```
+
+  gives a compile-time error because `d` is an invalid specifier for
+  strings ([godbolt](https://godbolt.org/g/rnCy9Q)):
+
+      ...
+      <source>:4:19: note: in instantiation of function template specialization 'fmt::v5::format<S, char [4]>' requested here
+        std::string s = format(fmt("{:d}"), "foo");
+                        ^
+      format.h:1337:13: note: non-constexpr function 'on_error' cannot be used in a constant expression
+          handler.on_error("invalid type specifier");
+
+  Compile-time checks require relaxed `constexpr` (C++14 feature)
+  support. If the latter is not available, checks will be performed at
+  runtime.
+
+- Separated format string parsing and formatting in the extension API
+  to enable compile-time format string processing. For example
+
+  ```c++
+  struct Answer {};
+
+  namespace fmt {
+  template <>
+  struct formatter<Answer> {
+    constexpr auto parse(parse_context& ctx) {
+      auto it = ctx.begin();
+      spec = *it;
+      if (spec != 'd' && spec != 's')
+        throw format_error("invalid specifier");
+      return ++it;
+    }
+
+    template <typename FormatContext>
+    auto format(Answer, FormatContext& ctx) {
+      return spec == 's' ?
+        format_to(ctx.begin(), "{}", "fourty-two") :
+        format_to(ctx.begin(), "{}", 42);
+    }
+
+    char spec = 0;
+  };
+  }
+
+  std::string s = format(fmt("{:x}"), Answer());
+  ```
+
+  gives a compile-time error due to invalid format specifier
+  ([godbolt](https://godbolt.org/g/2jQ1Dv)):
+
+      ...
+      <source>:12:45: error: expression '<throw-expression>' is not a constant expression
+             throw format_error("invalid specifier");
+
+- Added [iterator
+  support](https://fmt.dev/latest/api.html#output-iterator-support):
+
+  ```c++
+  #include <vector>
+  #include <fmt/format.h>
+
+  std::vector<char> out;
+  fmt::format_to(std::back_inserter(out), "{}", 42);
+  ```
+
+- Added the
+  [format_to_n](https://fmt.dev/latest/api.html#_CPPv2N3fmt11format_to_nE8OutputItNSt6size_tE11string_viewDpRK4Args)
+  function that restricts the output to the specified number of
+  characters (https://github.com/fmtlib/fmt/issues/298):
+
+  ```c++
+  char out[4];
+  fmt::format_to_n(out, sizeof(out), "{}", 12345);
+  // out == "1234" (without terminating '\0')
+  ```
+
+- Added the [formatted_size](
+  https://fmt.dev/latest/api.html#_CPPv2N3fmt14formatted_sizeE11string_viewDpRK4Args)
+  function for computing the output size:
+
+  ```c++
+  #include <fmt/format.h>
+
+  auto size = fmt::formatted_size("{}", 12345); // size == 5
+  ```
+
+- Improved compile times by reducing dependencies on standard headers
+  and providing a lightweight [core
+  API](https://fmt.dev/latest/api.html#core-api):
+
+  ```c++
+  #include <fmt/core.h>
+
+  fmt::print("The answer is {}.", 42);
+  ```
+
+  See [Compile time and code
+  bloat](https://github.com/fmtlib/fmt#compile-time-and-code-bloat).
+
+- Added the [make_format_args](
+  https://fmt.dev/latest/api.html#_CPPv2N3fmt16make_format_argsEDpRK4Args)
+  function for capturing formatting arguments:
+
+  ```c++
+  // Prints formatted error message.
+  void vreport_error(const char *format, fmt::format_args args) {
+    fmt::print("Error: ");
+    fmt::vprint(format, args);
+  }
+  template <typename... Args>
+  void report_error(const char *format, const Args & ... args) {
+    vreport_error(format, fmt::make_format_args(args...));
+  }
+  ```
+
+- Added the `make_printf_args` function for capturing `printf`
+  arguments (https://github.com/fmtlib/fmt/issues/687,
+  https://github.com/fmtlib/fmt/pull/694). Thanks @Kronuz.
+
+- Added prefix `v` to non-variadic functions taking `format_args` to
+  distinguish them from variadic ones:
+
+  ```c++
+  std::string vformat(string_view format_str, format_args args);
+
+  template <typename... Args>
+  std::string format(string_view format_str, const Args & ... args);
+  ```
+
+- Added experimental support for formatting ranges, containers and
+  tuple-like types in `fmt/ranges.h`
+  (https://github.com/fmtlib/fmt/pull/735):
+
+  ```c++
+  #include <fmt/ranges.h>
+
+  std::vector<int> v = {1, 2, 3};
+  fmt::print("{}", v); // prints {1, 2, 3}
+  ```
+
+  Thanks @Remotion.
+
+- Implemented `wchar_t` date and time formatting
+  (https://github.com/fmtlib/fmt/pull/712):
+
+  ```c++
+  #include <fmt/time.h>
+
+  std::time_t t = std::time(nullptr);
+  auto s = fmt::format(L"The date is {:%Y-%m-%d}.", *std::localtime(&t));
+  ```
+
+  Thanks @DanielaE.
+
+- Provided more wide string overloads
+  (https://github.com/fmtlib/fmt/pull/724). Thanks @DanielaE.
+
+- Switched from a custom null-terminated string view class to
+  `string_view` in the format API and provided `fmt::string_view`
+  which implements a subset of `std::string_view` API for pre-C++17
+  systems.
+
+- Added support for `std::experimental::string_view`
+  (https://github.com/fmtlib/fmt/pull/607):
+
+  ```c++
+  #include <fmt/core.h>
+  #include <experimental/string_view>
+
+  fmt::print("{}", std::experimental::string_view("foo"));
+  ```
+
+  Thanks @virgiliofornazin.
+
+- Allowed mixing named and automatic arguments:
+
+  ```c++
+  fmt::format("{} {two}", 1, fmt::arg("two", 2));
+  ```
+
+- Removed the write API in favor of the [format
+  API](https://fmt.dev/latest/api.html#format-api) with compile-time
+  handling of format strings.
+
+- Disallowed formatting of multibyte strings into a wide character
+  target (https://github.com/fmtlib/fmt/pull/606).
+
+- Improved documentation
+  (https://github.com/fmtlib/fmt/pull/515,
+  https://github.com/fmtlib/fmt/issues/614,
+  https://github.com/fmtlib/fmt/pull/617,
+  https://github.com/fmtlib/fmt/pull/661,
+  https://github.com/fmtlib/fmt/pull/680).
+  Thanks @ibell, @mihaitodor and @johnthagen.
+
+- Implemented more efficient handling of large number of format
+  arguments.
+
+- Introduced an inline namespace for symbol versioning.
+
+- Added debug postfix `d` to the `fmt` library name
+  (https://github.com/fmtlib/fmt/issues/636).
+
+- Removed unnecessary `fmt/` prefix in includes
+  (https://github.com/fmtlib/fmt/pull/397). Thanks @chronoxor.
+
+- Moved `fmt/*.h` to `include/fmt/*.h` to prevent irrelevant files and
+  directories appearing on the include search paths when fmt is used
+  as a subproject and moved source files to the `src` directory.
+
+- Added qmake project file `support/fmt.pro`
+  (https://github.com/fmtlib/fmt/pull/641). Thanks @cowo78.
+
+- Added Gradle build file `support/build.gradle`
+  (https://github.com/fmtlib/fmt/pull/649). Thanks @luncliff.
+
+- Removed `FMT_CPPFORMAT` CMake option.
+
+- Fixed a name conflict with the macro `CHAR_WIDTH` in glibc
+  (https://github.com/fmtlib/fmt/pull/616). Thanks @aroig.
+
+- Fixed handling of nested braces in `fmt::join`
+  (https://github.com/fmtlib/fmt/issues/638).
+
+- Added `SOURCELINK_SUFFIX` for compatibility with Sphinx 1.5
+  (https://github.com/fmtlib/fmt/pull/497). Thanks @ginggs.
+
+- Added a missing `inline` in the header-only mode
+  (https://github.com/fmtlib/fmt/pull/626). Thanks @aroig.
+
+- Fixed various compiler warnings
+  (https://github.com/fmtlib/fmt/pull/640,
+  https://github.com/fmtlib/fmt/pull/656,
+  https://github.com/fmtlib/fmt/pull/679,
+  https://github.com/fmtlib/fmt/pull/681,
+  https://github.com/fmtlib/fmt/pull/705,
+  https://github.com/fmtlib/fmt/issues/715,
+  https://github.com/fmtlib/fmt/pull/717,
+  https://github.com/fmtlib/fmt/pull/720,
+  https://github.com/fmtlib/fmt/pull/723,
+  https://github.com/fmtlib/fmt/pull/726,
+  https://github.com/fmtlib/fmt/pull/730,
+  https://github.com/fmtlib/fmt/pull/739).
+  Thanks @peterbell10, @LarsGullik, @foonathan, @eliaskosunen,
+  @christianparpart, @DanielaE and @mwinterb.
+
+- Worked around an MSVC bug and fixed several warnings
+  (https://github.com/fmtlib/fmt/pull/653). Thanks @alabuzhev.
+
+- Worked around GCC bug 67371
+  (https://github.com/fmtlib/fmt/issues/682).
+
+- Fixed compilation with `-fno-exceptions`
+  (https://github.com/fmtlib/fmt/pull/655). Thanks @chenxiaolong.
+
+- Made `constexpr remove_prefix` gcc version check tighter
+  (https://github.com/fmtlib/fmt/issues/648).
+
+- Renamed internal type enum constants to prevent collision with
+  poorly written C libraries
+  (https://github.com/fmtlib/fmt/issues/644).
+
+- Added detection of `wostream operator<<`
+  (https://github.com/fmtlib/fmt/issues/650).
+
+- Fixed compilation on OpenBSD
+  (https://github.com/fmtlib/fmt/pull/660). Thanks @hubslave.
+
+- Fixed compilation on FreeBSD 12
+  (https://github.com/fmtlib/fmt/pull/732). Thanks @dankm.
+
+- Fixed compilation when there is a mismatch between `-std` options
+  between the library and user code
+  (https://github.com/fmtlib/fmt/issues/664).
+
+- Fixed compilation with GCC 7 and `-std=c++11`
+  (https://github.com/fmtlib/fmt/issues/734).
+
+- Improved generated binary code on GCC 7 and older
+  (https://github.com/fmtlib/fmt/issues/668).
+
+- Fixed handling of numeric alignment with no width
+  (https://github.com/fmtlib/fmt/issues/675).
+
+- Fixed handling of empty strings in UTF8/16 converters
+  (https://github.com/fmtlib/fmt/pull/676). Thanks @vgalka-sl.
+
+- Fixed formatting of an empty `string_view`
+  (https://github.com/fmtlib/fmt/issues/689).
+
+- Fixed detection of `string_view` on libc++
+  (https://github.com/fmtlib/fmt/issues/686).
+
+- Fixed DLL issues (https://github.com/fmtlib/fmt/pull/696).
+  Thanks @sebkoenig.
+
+- Fixed compile checks for mixing narrow and wide strings
+  (https://github.com/fmtlib/fmt/issues/690).
+
+- Disabled unsafe implicit conversion to `std::string`
+  (https://github.com/fmtlib/fmt/issues/729).
+
+- Fixed handling of reused format specs (as in `fmt::join`) for
+  pointers (https://github.com/fmtlib/fmt/pull/725). Thanks @mwinterb.
+
+- Fixed installation of `fmt/ranges.h`
+  (https://github.com/fmtlib/fmt/pull/738). Thanks @sv1990.
+
+# 4.1.0 - 2017-12-20
+
+- Added `fmt::to_wstring()` in addition to `fmt::to_string()`
+  (https://github.com/fmtlib/fmt/pull/559). Thanks @alabuzhev.
+- Added support for C++17 `std::string_view`
+  (https://github.com/fmtlib/fmt/pull/571 and
+  https://github.com/fmtlib/fmt/pull/578).
+  Thanks @thelostt and @mwinterb.
+- Enabled stream exceptions to catch errors
+  (https://github.com/fmtlib/fmt/issues/581). Thanks @crusader-mike.
+- Allowed formatting of class hierarchies with `fmt::format_arg()`
+  (https://github.com/fmtlib/fmt/pull/547). Thanks @rollbear.
+- Removed limitations on character types
+  (https://github.com/fmtlib/fmt/pull/563). Thanks @Yelnats321.
+- Conditionally enabled use of `std::allocator_traits`
+  (https://github.com/fmtlib/fmt/pull/583). Thanks @mwinterb.
+- Added support for `const` variadic member function emulation with
+  `FMT_VARIADIC_CONST`
+  (https://github.com/fmtlib/fmt/pull/591). Thanks @ludekvodicka.
+- Various bugfixes: bad overflow check, unsupported implicit type
+  conversion when determining formatting function, test segfaults
+  (https://github.com/fmtlib/fmt/issues/551), ill-formed
+  macros (https://github.com/fmtlib/fmt/pull/542) and
+  ambiguous overloads
+  (https://github.com/fmtlib/fmt/issues/580). Thanks @xylosper.
+- Prevented warnings on MSVC
+  (https://github.com/fmtlib/fmt/pull/605,
+  https://github.com/fmtlib/fmt/pull/602, and
+  https://github.com/fmtlib/fmt/pull/545), clang
+  (https://github.com/fmtlib/fmt/pull/582), GCC
+  (https://github.com/fmtlib/fmt/issues/573), various
+  conversion warnings (https://github.com/fmtlib/fmt/pull/609,
+  https://github.com/fmtlib/fmt/pull/567,
+  https://github.com/fmtlib/fmt/pull/553 and
+  https://github.com/fmtlib/fmt/pull/553), and added
+  `override` and `[[noreturn]]`
+  (https://github.com/fmtlib/fmt/pull/549 and
+  https://github.com/fmtlib/fmt/issues/555).
+  Thanks @alabuzhev, @virgiliofornazin, @alexanderbock, @yumetodo, @VaderY,
+  @jpcima, @thelostt and @Manu343726.
+- Improved CMake: Used `GNUInstallDirs` to set installation location
+  (https://github.com/fmtlib/fmt/pull/610) and fixed warnings
+  (https://github.com/fmtlib/fmt/pull/536 and
+  https://github.com/fmtlib/fmt/pull/556).
+  Thanks @mikecrowe, @evgen231 and @henryiii.
+
+# 4.0.0 - 2017-06-27
+
+- Removed old compatibility headers `cppformat/*.h` and CMake options
+  (https://github.com/fmtlib/fmt/pull/527). Thanks @maddinat0r.
+
+- Added `string.h` containing `fmt::to_string()` as alternative to
+  `std::to_string()` as well as other string writer functionality
+  (https://github.com/fmtlib/fmt/issues/326 and
+  https://github.com/fmtlib/fmt/pull/441):
+
+  ```c++
+  #include "fmt/string.h"
+
+  std::string answer = fmt::to_string(42);
+  ```
+
+  Thanks @glebov-andrey.
+
+- Moved `fmt::printf()` to new `printf.h` header and allowed `%s` as
+  generic specifier (https://github.com/fmtlib/fmt/pull/453),
+  made `%.f` more conformant to regular `printf()`
+  (https://github.com/fmtlib/fmt/pull/490), added custom
+  writer support (https://github.com/fmtlib/fmt/issues/476)
+  and implemented missing custom argument formatting
+  (https://github.com/fmtlib/fmt/pull/339 and
+  https://github.com/fmtlib/fmt/pull/340):
+
+  ```c++
+  #include "fmt/printf.h"
+
+  // %s format specifier can be used with any argument type.
+  fmt::printf("%s", 42);
+  ```
+
+  Thanks @mojoBrendan, @manylegged and @spacemoose.
+  See also https://github.com/fmtlib/fmt/issues/360,
+  https://github.com/fmtlib/fmt/issues/335 and
+  https://github.com/fmtlib/fmt/issues/331.
+
+- Added `container.h` containing a `BasicContainerWriter` to write to
+  containers like `std::vector`
+  (https://github.com/fmtlib/fmt/pull/450). Thanks @polyvertex.
+
+- Added `fmt::join()` function that takes a range and formats its
+  elements separated by a given string
+  (https://github.com/fmtlib/fmt/pull/466):
+
+  ```c++
+  #include "fmt/format.h"
+
+  std::vector<double> v = {1.2, 3.4, 5.6};
+  // Prints "(+01.20, +03.40, +05.60)".
+  fmt::print("({:+06.2f})", fmt::join(v.begin(), v.end(), ", "));
+  ```
+
+  Thanks @olivier80.
+
+- Added support for custom formatting specifications to simplify
+  customization of built-in formatting
+  (https://github.com/fmtlib/fmt/pull/444). Thanks @polyvertex.
+  See also https://github.com/fmtlib/fmt/issues/439.
+
+- Added `fmt::format_system_error()` for error code formatting
+  (https://github.com/fmtlib/fmt/issues/323 and
+  https://github.com/fmtlib/fmt/pull/526). Thanks @maddinat0r.
+
+- Added thread-safe `fmt::localtime()` and `fmt::gmtime()` as
+  replacement for the standard version to `time.h`
+  (https://github.com/fmtlib/fmt/pull/396). Thanks @codicodi.
+
+- Internal improvements to `NamedArg` and `ArgLists`
+  (https://github.com/fmtlib/fmt/pull/389 and
+  https://github.com/fmtlib/fmt/pull/390). Thanks @chronoxor.
+
+- Fixed crash due to bug in `FormatBuf`
+  (https://github.com/fmtlib/fmt/pull/493). Thanks @effzeh. See also
+  https://github.com/fmtlib/fmt/issues/480 and
+  https://github.com/fmtlib/fmt/issues/491.
+
+- Fixed handling of wide strings in `fmt::StringWriter`.
+
+- Improved compiler error messages
+  (https://github.com/fmtlib/fmt/issues/357).
+
+- Fixed various warnings and issues with various compilers
+  (https://github.com/fmtlib/fmt/pull/494,
+  https://github.com/fmtlib/fmt/pull/499,
+  https://github.com/fmtlib/fmt/pull/483,
+  https://github.com/fmtlib/fmt/pull/485,
+  https://github.com/fmtlib/fmt/pull/482,
+  https://github.com/fmtlib/fmt/pull/475,
+  https://github.com/fmtlib/fmt/pull/473 and
+  https://github.com/fmtlib/fmt/pull/414).
+  Thanks @chronoxor, @zhaohuaxishi, @pkestene, @dschmidt and @0x414c.
+
+- Improved CMake: targets are now namespaced
+  (https://github.com/fmtlib/fmt/pull/511 and
+  https://github.com/fmtlib/fmt/pull/513), supported
+  header-only `printf.h`
+  (https://github.com/fmtlib/fmt/pull/354), fixed issue with
+  minimal supported library subset
+  (https://github.com/fmtlib/fmt/issues/418,
+  https://github.com/fmtlib/fmt/pull/419 and
+  https://github.com/fmtlib/fmt/pull/420).
+  Thanks @bjoernthiel, @niosHD, @LogicalKnight and @alabuzhev.
+
+- Improved documentation (https://github.com/fmtlib/fmt/pull/393).
+  Thanks @pwm1234.
+
+# 3.0.2 - 2017-06-14
+
+- Added `FMT_VERSION` macro
+  (https://github.com/fmtlib/fmt/issues/411).
+- Used `FMT_NULL` instead of literal `0`
+  (https://github.com/fmtlib/fmt/pull/409). Thanks @alabuzhev.
+- Added extern templates for `format_float`
+  (https://github.com/fmtlib/fmt/issues/413).
+- Fixed implicit conversion issue
+  (https://github.com/fmtlib/fmt/issues/507).
+- Fixed signbit detection
+  (https://github.com/fmtlib/fmt/issues/423).
+- Fixed naming collision
+  (https://github.com/fmtlib/fmt/issues/425).
+- Fixed missing intrinsic for C++/CLI
+  (https://github.com/fmtlib/fmt/pull/457). Thanks @calumr.
+- Fixed Android detection
+  (https://github.com/fmtlib/fmt/pull/458). Thanks @Gachapen.
+- Use lean `windows.h` if not in header-only mode
+  (https://github.com/fmtlib/fmt/pull/503). Thanks @Quentin01.
+- Fixed issue with CMake exporting C++11 flag
+  (https://github.com/fmtlib/fmt/pull/455). Thanks @EricWF.
+- Fixed issue with nvcc and MSVC compiler bug and MinGW
+  (https://github.com/fmtlib/fmt/issues/505).
+- Fixed DLL issues (https://github.com/fmtlib/fmt/pull/469 and
+  https://github.com/fmtlib/fmt/pull/502).
+  Thanks @richardeakin and @AndreasSchoenle.
+- Fixed test compilation under FreeBSD
+  (https://github.com/fmtlib/fmt/issues/433).
+- Fixed various warnings
+  (https://github.com/fmtlib/fmt/pull/403,
+  https://github.com/fmtlib/fmt/pull/410 and
+  https://github.com/fmtlib/fmt/pull/510).
+  Thanks @Lecetem, @chenhayat and @trozen.
+- Worked around a broken `__builtin_clz` in clang with MS codegen
+  (https://github.com/fmtlib/fmt/issues/519).
+- Removed redundant include
+  (https://github.com/fmtlib/fmt/issues/479).
+- Fixed documentation issues.
+
+# 3.0.1 - 2016-11-01
+
+- Fixed handling of thousands separator
+  (https://github.com/fmtlib/fmt/issues/353).
+- Fixed handling of `unsigned char` strings
+  (https://github.com/fmtlib/fmt/issues/373).
+- Corrected buffer growth when formatting time
+  (https://github.com/fmtlib/fmt/issues/367).
+- Removed warnings under MSVC and clang
+  (https://github.com/fmtlib/fmt/issues/318,
+  https://github.com/fmtlib/fmt/issues/250, also merged
+  https://github.com/fmtlib/fmt/pull/385 and
+  https://github.com/fmtlib/fmt/pull/361).
+  Thanks @jcelerier and @nmoehrle.
+- Fixed compilation issues under Android
+  (https://github.com/fmtlib/fmt/pull/327,
+  https://github.com/fmtlib/fmt/issues/345 and
+  https://github.com/fmtlib/fmt/pull/381), FreeBSD
+  (https://github.com/fmtlib/fmt/pull/358), Cygwin
+  (https://github.com/fmtlib/fmt/issues/388), MinGW
+  (https://github.com/fmtlib/fmt/issues/355) as well as other
+  issues (https://github.com/fmtlib/fmt/issues/350,
+  https://github.com/fmtlib/fmt/issues/355,
+  https://github.com/fmtlib/fmt/pull/348,
+  https://github.com/fmtlib/fmt/pull/402,
+  https://github.com/fmtlib/fmt/pull/405).
+  Thanks @dpantele, @hghwng, @arvedarved, @LogicalKnight and @JanHellwig.
+- Fixed some documentation issues and extended specification
+  (https://github.com/fmtlib/fmt/issues/320,
+  https://github.com/fmtlib/fmt/pull/333,
+  https://github.com/fmtlib/fmt/issues/347,
+  https://github.com/fmtlib/fmt/pull/362). Thanks @smellman.
+
+# 3.0.0 - 2016-05-07
+
+- The project has been renamed from C++ Format (cppformat) to fmt for
+  consistency with the used namespace and macro prefix
+  (https://github.com/fmtlib/fmt/issues/307). Library headers
+  are now located in the `fmt` directory:
+
+  ```c++
+  #include "fmt/format.h"
+  ```
+
+  Including `format.h` from the `cppformat` directory is deprecated
+  but works via a proxy header which will be removed in the next major
+  version.
+
+  The documentation is now available at <https://fmt.dev>.
+
+- Added support for
+  [strftime](http://en.cppreference.com/w/cpp/chrono/c/strftime)-like
+  [date and time
+  formatting](https://fmt.dev/3.0.0/api.html#date-and-time-formatting)
+  (https://github.com/fmtlib/fmt/issues/283):
+
+  ```c++
+  #include "fmt/time.h"
+
+  std::time_t t = std::time(nullptr);
+  // Prints "The date is 2016-04-29." (with the current date)
+  fmt::print("The date is {:%Y-%m-%d}.", *std::localtime(&t));
+  ```
+
+- `std::ostream` support including formatting of user-defined types
+  that provide overloaded `operator<<` has been moved to
+  `fmt/ostream.h`:
+
+  ```c++
+  #include "fmt/ostream.h"
+
+  class Date {
+    int year_, month_, day_;
+  public:
+    Date(int year, int month, int day) : year_(year), month_(month), day_(day) {}
+
+    friend std::ostream &operator<<(std::ostream &os, const Date &d) {
+      return os << d.year_ << '-' << d.month_ << '-' << d.day_;
+    }
+  };
+
+  std::string s = fmt::format("The date is {}", Date(2012, 12, 9));
+  // s == "The date is 2012-12-9"
+  ```
+
+- Added support for [custom argument
+  formatters](https://fmt.dev/3.0.0/api.html#argument-formatters)
+  (https://github.com/fmtlib/fmt/issues/235).
+
+- Added support for locale-specific integer formatting with the `n`
+  specifier (https://github.com/fmtlib/fmt/issues/305):
+
+  ```c++
+  std::setlocale(LC_ALL, "en_US.utf8");
+  fmt::print("cppformat: {:n}\n", 1234567); // prints 1,234,567
+  ```
+
+- Sign is now preserved when formatting an integer with an incorrect
+  `printf` format specifier
+  (https://github.com/fmtlib/fmt/issues/265):
+
+  ```c++
+  fmt::printf("%lld", -42); // prints -42
+  ```
+
+  Note that it would be an undefined behavior in `std::printf`.
+
+- Length modifiers such as `ll` are now optional in printf formatting
+  functions and the correct type is determined automatically
+  (https://github.com/fmtlib/fmt/issues/255):
+
+  ```c++
+  fmt::printf("%d", std::numeric_limits<long long>::max());
+  ```
+
+  Note that it would be an undefined behavior in `std::printf`.
+
+- Added initial support for custom formatters
+  (https://github.com/fmtlib/fmt/issues/231).
+
+- Fixed detection of user-defined literal support on Intel C++
+  compiler (https://github.com/fmtlib/fmt/issues/311,
+  https://github.com/fmtlib/fmt/pull/312).
+  Thanks @dean0x7d and @speth.
+
+- Reduced compile time
+  (https://github.com/fmtlib/fmt/pull/243,
+  https://github.com/fmtlib/fmt/pull/249,
+  https://github.com/fmtlib/fmt/issues/317):
+
+  ![](https://cloud.githubusercontent.com/assets/4831417/11614060/b9e826d2-9c36-11e5-8666-d4131bf503ef.png)
+
+  ![](https://cloud.githubusercontent.com/assets/4831417/11614080/6ac903cc-9c37-11e5-8165-26df6efae364.png)
+
+  Thanks @dean0x7d.
+
+- Compile test fixes (https://github.com/fmtlib/fmt/pull/313).
+  Thanks @dean0x7d.
+
+- Documentation fixes (https://github.com/fmtlib/fmt/pull/239,
+  https://github.com/fmtlib/fmt/issues/248,
+  https://github.com/fmtlib/fmt/issues/252,
+  https://github.com/fmtlib/fmt/pull/258,
+  https://github.com/fmtlib/fmt/issues/260,
+  https://github.com/fmtlib/fmt/issues/301,
+  https://github.com/fmtlib/fmt/pull/309).
+  Thanks @ReadmeCritic @Gachapen and @jwilk.
+
+- Fixed compiler and sanitizer warnings
+  (https://github.com/fmtlib/fmt/issues/244,
+  https://github.com/fmtlib/fmt/pull/256,
+  https://github.com/fmtlib/fmt/pull/259,
+  https://github.com/fmtlib/fmt/issues/263,
+  https://github.com/fmtlib/fmt/issues/274,
+  https://github.com/fmtlib/fmt/pull/277,
+  https://github.com/fmtlib/fmt/pull/286,
+  https://github.com/fmtlib/fmt/issues/291,
+  https://github.com/fmtlib/fmt/issues/296,
+  https://github.com/fmtlib/fmt/issues/308).
+  Thanks @mwinterb, @pweiskircher and @Naios.
+
+- Improved compatibility with Windows Store apps
+  (https://github.com/fmtlib/fmt/issues/280,
+  https://github.com/fmtlib/fmt/pull/285) Thanks @mwinterb.
+
+- Added tests of compatibility with older C++ standards
+  (https://github.com/fmtlib/fmt/pull/273). Thanks @niosHD.
+
+- Fixed Android build
+  (https://github.com/fmtlib/fmt/pull/271). Thanks @newnon.
+
+- Changed `ArgMap` to be backed by a vector instead of a map.
+  (https://github.com/fmtlib/fmt/issues/261,
+  https://github.com/fmtlib/fmt/pull/262). Thanks @mwinterb.
+
+- Added `fprintf` overload that writes to a `std::ostream`
+  (https://github.com/fmtlib/fmt/pull/251).
+  Thanks @nickhutchinson.
+
+- Export symbols when building a Windows DLL
+  (https://github.com/fmtlib/fmt/pull/245).
+  Thanks @macdems.
+
+- Fixed compilation on Cygwin
+  (https://github.com/fmtlib/fmt/issues/304).
+
+- Implemented a workaround for a bug in Apple LLVM version 4.2 of
+  clang (https://github.com/fmtlib/fmt/issues/276).
+
+- Implemented a workaround for Google Test bug
+  https://github.com/google/googletest/issues/705 on gcc 6
+  (https://github.com/fmtlib/fmt/issues/268). Thanks @octoploid.
+
+- Removed Biicode support because the latter has been discontinued.
+
+# 2.1.1 - 2016-04-11
+
+- The install location for generated CMake files is now configurable
+  via the `FMT_CMAKE_DIR` CMake variable
+  (https://github.com/fmtlib/fmt/pull/299). Thanks @niosHD.
+- Documentation fixes
+  (https://github.com/fmtlib/fmt/issues/252).
+
+# 2.1.0 - 2016-03-21
+
+- Project layout and build system improvements
+  (https://github.com/fmtlib/fmt/pull/267):
+
+  -   The code have been moved to the `cppformat` directory. Including
+      `format.h` from the top-level directory is deprecated but works
+      via a proxy header which will be removed in the next major
+      version.
+  -   C++ Format CMake targets now have proper interface definitions.
+  -   Installed version of the library now supports the header-only
+      configuration.
+  -   Targets `doc`, `install`, and `test` are now disabled if C++
+      Format is included as a CMake subproject. They can be enabled by
+      setting `FMT_DOC`, `FMT_INSTALL`, and `FMT_TEST` in the parent
+      project.
+
+  Thanks @niosHD.
+
+# 2.0.1 - 2016-03-13
+
+- Improved CMake find and package support
+  (https://github.com/fmtlib/fmt/issues/264). Thanks @niosHD.
+- Fix compile error with Android NDK and mingw32
+  (https://github.com/fmtlib/fmt/issues/241). Thanks @Gachapen.
+- Documentation fixes
+  (https://github.com/fmtlib/fmt/issues/248,
+  https://github.com/fmtlib/fmt/issues/260).
+
+# 2.0.0 - 2015-12-01
+
+## General
+
+- \[Breaking\] Named arguments
+  (https://github.com/fmtlib/fmt/pull/169,
+  https://github.com/fmtlib/fmt/pull/173,
+  https://github.com/fmtlib/fmt/pull/174):
+
+  ```c++
+  fmt::print("The answer is {answer}.", fmt::arg("answer", 42));
+  ```
+
+  Thanks @jamboree.
+
+- \[Experimental\] User-defined literals for format and named
+  arguments (https://github.com/fmtlib/fmt/pull/204,
+  https://github.com/fmtlib/fmt/pull/206,
+  https://github.com/fmtlib/fmt/pull/207):
+
+  ```c++
+  using namespace fmt::literals;
+  fmt::print("The answer is {answer}.", "answer"_a=42);
+  ```
+
+  Thanks @dean0x7d.
+
+- \[Breaking\] Formatting of more than 16 arguments is now supported
+  when using variadic templates
+  (https://github.com/fmtlib/fmt/issues/141). Thanks @Shauren.
+
+- Runtime width specification
+  (https://github.com/fmtlib/fmt/pull/168):
+
+  ```c++
+  fmt::format("{0:{1}}", 42, 5); // gives "   42"
+  ```
+
+  Thanks @jamboree.
+
+- \[Breaking\] Enums are now formatted with an overloaded
+  `std::ostream` insertion operator (`operator<<`) if available
+  (https://github.com/fmtlib/fmt/issues/232).
+
+- \[Breaking\] Changed default `bool` format to textual, \"true\" or
+  \"false\" (https://github.com/fmtlib/fmt/issues/170):
+
+  ```c++
+  fmt::print("{}", true); // prints "true"
+  ```
+
+  To print `bool` as a number use numeric format specifier such as
+  `d`:
+
+  ```c++
+  fmt::print("{:d}", true); // prints "1"
+  ```
+
+- `fmt::printf` and `fmt::sprintf` now support formatting of `bool`
+  with the `%s` specifier giving textual output, \"true\" or \"false\"
+  (https://github.com/fmtlib/fmt/pull/223):
+
+  ```c++
+  fmt::printf("%s", true); // prints "true"
+  ```
+
+  Thanks @LarsGullik.
+
+- \[Breaking\] `signed char` and `unsigned char` are now formatted as
+  integers by default
+  (https://github.com/fmtlib/fmt/pull/217).
+
+- \[Breaking\] Pointers to C strings can now be formatted with the `p`
+  specifier (https://github.com/fmtlib/fmt/pull/223):
+
+  ```c++
+  fmt::print("{:p}", "test"); // prints pointer value
+  ```
+
+  Thanks @LarsGullik.
+
+- \[Breaking\] `fmt::printf` and `fmt::sprintf` now print null
+  pointers as `(nil)` and null strings as `(null)` for consistency
+  with glibc (https://github.com/fmtlib/fmt/pull/226).
+  Thanks @LarsGullik.
+
+- \[Breaking\] `fmt::(s)printf` now supports formatting of objects of
+  user-defined types that provide an overloaded `std::ostream`
+  insertion operator (`operator<<`)
+  (https://github.com/fmtlib/fmt/issues/201):
+
+  ```c++
+  fmt::printf("The date is %s", Date(2012, 12, 9));
+  ```
+
+- \[Breaking\] The `Buffer` template is now part of the public API and
+  can be used to implement custom memory buffers
+  (https://github.com/fmtlib/fmt/issues/140). Thanks @polyvertex.
+
+- \[Breaking\] Improved compatibility between `BasicStringRef` and
+  [std::experimental::basic_string_view](
+  http://en.cppreference.com/w/cpp/experimental/basic_string_view)
+  (https://github.com/fmtlib/fmt/issues/100,
+  https://github.com/fmtlib/fmt/issues/159,
+  https://github.com/fmtlib/fmt/issues/183):
+
+  -   Comparison operators now compare string content, not pointers
+  -   `BasicStringRef::c_str` replaced by `BasicStringRef::data`
+  -   `BasicStringRef` is no longer assumed to be null-terminated
+
+  References to null-terminated strings are now represented by a new
+  class, `BasicCStringRef`.
+
+- Dependency on pthreads introduced by Google Test is now optional
+  (https://github.com/fmtlib/fmt/issues/185).
+
+- New CMake options `FMT_DOC`, `FMT_INSTALL` and `FMT_TEST` to control
+  generation of `doc`, `install` and `test` targets respectively, on
+  by default (https://github.com/fmtlib/fmt/issues/197,
+  https://github.com/fmtlib/fmt/issues/198,
+  https://github.com/fmtlib/fmt/issues/200). Thanks @maddinat0r.
+
+- `noexcept` is now used when compiling with MSVC2015
+  (https://github.com/fmtlib/fmt/pull/215). Thanks @dmkrepo.
+
+- Added an option to disable use of `windows.h` when
+  `FMT_USE_WINDOWS_H` is defined as 0 before including `format.h`
+  (https://github.com/fmtlib/fmt/issues/171). Thanks @alfps.
+
+- \[Breaking\] `windows.h` is now included with `NOMINMAX` unless
+  `FMT_WIN_MINMAX` is defined. This is done to prevent breaking code
+  using `std::min` and `std::max` and only affects the header-only
+  configuration (https://github.com/fmtlib/fmt/issues/152,
+  https://github.com/fmtlib/fmt/pull/153,
+  https://github.com/fmtlib/fmt/pull/154). Thanks @DevO2012.
+
+- Improved support for custom character types
+  (https://github.com/fmtlib/fmt/issues/171). Thanks @alfps.
+
+- Added an option to disable use of IOStreams when `FMT_USE_IOSTREAMS`
+  is defined as 0 before including `format.h`
+  (https://github.com/fmtlib/fmt/issues/205,
+  https://github.com/fmtlib/fmt/pull/208). Thanks @JodiTheTigger.
+
+- Improved detection of `isnan`, `isinf` and `signbit`.
+
+## Optimization
+
+- Made formatting of user-defined types more efficient with a custom
+  stream buffer (https://github.com/fmtlib/fmt/issues/92,
+  https://github.com/fmtlib/fmt/pull/230). Thanks @NotImplemented.
+- Further improved performance of `fmt::Writer` on integer formatting
+  and fixed a minor regression. Now it is \~7% faster than
+  `karma::generate` on Karma\'s benchmark
+  (https://github.com/fmtlib/fmt/issues/186).
+- \[Breaking\] Reduced [compiled code
+  size](https://github.com/fmtlib/fmt#compile-time-and-code-bloat)
+  (https://github.com/fmtlib/fmt/issues/143,
+  https://github.com/fmtlib/fmt/pull/149).
+
+## Distribution
+
+- \[Breaking\] Headers are now installed in
+  `${CMAKE_INSTALL_PREFIX}/include/cppformat`
+  (https://github.com/fmtlib/fmt/issues/178). Thanks @jackyf.
+
+- \[Breaking\] Changed the library name from `format` to `cppformat`
+  for consistency with the project name and to avoid potential
+  conflicts (https://github.com/fmtlib/fmt/issues/178).
+  Thanks @jackyf.
+
+- C++ Format is now available in [Debian](https://www.debian.org/)
+  GNU/Linux
+  ([stretch](https://packages.debian.org/source/stretch/cppformat),
+  [sid](https://packages.debian.org/source/sid/cppformat)) and derived
+  distributions such as
+  [Ubuntu](https://launchpad.net/ubuntu/+source/cppformat) 15.10 and
+  later (https://github.com/fmtlib/fmt/issues/155):
+
+      $ sudo apt-get install libcppformat1-dev
+
+  Thanks @jackyf.
+
+- [Packages for Fedora and
+  RHEL](https://admin.fedoraproject.org/pkgdb/package/cppformat/) are
+  now available. Thanks Dave Johansen.
+
+- C++ Format can now be installed via [Homebrew](http://brew.sh/) on
+  OS X (https://github.com/fmtlib/fmt/issues/157):
+
+      $ brew install cppformat
+
+  Thanks @ortho and Anatoliy Bulukin.
+
+## Documentation
+
+- Migrated from ReadTheDocs to GitHub Pages for better responsiveness
+  and reliability (https://github.com/fmtlib/fmt/issues/128).
+  New documentation address is <http://cppformat.github.io/>.
+- Added [Building thedocumentation](
+  https://fmt.dev/2.0.0/usage.html#building-the-documentation)
+  section to the documentation.
+- Documentation build script is now compatible with Python 3 and newer
+  pip versions. (https://github.com/fmtlib/fmt/pull/189,
+  https://github.com/fmtlib/fmt/issues/209).
+  Thanks @JodiTheTigger and @xentec.
+- Documentation fixes and improvements
+  (https://github.com/fmtlib/fmt/issues/36,
+  https://github.com/fmtlib/fmt/issues/75,
+  https://github.com/fmtlib/fmt/issues/125,
+  https://github.com/fmtlib/fmt/pull/160,
+  https://github.com/fmtlib/fmt/pull/161,
+  https://github.com/fmtlib/fmt/issues/162,
+  https://github.com/fmtlib/fmt/issues/165,
+  https://github.com/fmtlib/fmt/issues/210). 
+  Thanks @syohex.
+- Fixed out-of-tree documentation build
+  (https://github.com/fmtlib/fmt/issues/177). Thanks @jackyf.
+
+## Fixes
+
+- Fixed `initializer_list` detection
+  (https://github.com/fmtlib/fmt/issues/136). Thanks @Gachapen.
+
+- \[Breaking\] Fixed formatting of enums with numeric format
+  specifiers in `fmt::(s)printf`
+  (https://github.com/fmtlib/fmt/issues/131,
+  https://github.com/fmtlib/fmt/issues/139):
+
+  ```c++
+  enum { ANSWER = 42 };
+  fmt::printf("%d", ANSWER);
+  ```
+
+  Thanks @Naios.
+
+- Improved compatibility with old versions of MinGW
+  (https://github.com/fmtlib/fmt/issues/129,
+  https://github.com/fmtlib/fmt/pull/130,
+  https://github.com/fmtlib/fmt/issues/132). Thanks @cstamford.
+
+- Fixed a compile error on MSVC with disabled exceptions
+  (https://github.com/fmtlib/fmt/issues/144).
+
+- Added a workaround for broken implementation of variadic templates
+  in MSVC2012 (https://github.com/fmtlib/fmt/issues/148).
+
+- Placed the anonymous namespace within `fmt` namespace for the
+  header-only configuration (https://github.com/fmtlib/fmt/issues/171).
+  Thanks @alfps.
+
+- Fixed issues reported by Coverity Scan
+  (https://github.com/fmtlib/fmt/issues/187,
+  https://github.com/fmtlib/fmt/issues/192).
+
+- Implemented a workaround for a name lookup bug in MSVC2010
+  (https://github.com/fmtlib/fmt/issues/188).
+
+- Fixed compiler warnings
+  (https://github.com/fmtlib/fmt/issues/95,
+  https://github.com/fmtlib/fmt/issues/96,
+  https://github.com/fmtlib/fmt/pull/114,
+  https://github.com/fmtlib/fmt/issues/135,
+  https://github.com/fmtlib/fmt/issues/142,
+  https://github.com/fmtlib/fmt/issues/145,
+  https://github.com/fmtlib/fmt/issues/146,
+  https://github.com/fmtlib/fmt/issues/158,
+  https://github.com/fmtlib/fmt/issues/163,
+  https://github.com/fmtlib/fmt/issues/175,
+  https://github.com/fmtlib/fmt/issues/190,
+  https://github.com/fmtlib/fmt/pull/191,
+  https://github.com/fmtlib/fmt/issues/194,
+  https://github.com/fmtlib/fmt/pull/196,
+  https://github.com/fmtlib/fmt/issues/216,
+  https://github.com/fmtlib/fmt/pull/218,
+  https://github.com/fmtlib/fmt/pull/220,
+  https://github.com/fmtlib/fmt/pull/229,
+  https://github.com/fmtlib/fmt/issues/233,
+  https://github.com/fmtlib/fmt/issues/234,
+  https://github.com/fmtlib/fmt/pull/236,
+  https://github.com/fmtlib/fmt/issues/281,
+  https://github.com/fmtlib/fmt/issues/289).
+  Thanks @seanmiddleditch, @dixlorenz, @CarterLi, @Naios, @fmatthew5876,
+  @LevskiWeng, @rpopescu, @gabime, @cubicool, @jkflying, @LogicalKnight,
+  @inguin and @Jopie64.
+
+- Fixed portability issues (mostly causing test failures) on ARM,
+  ppc64, ppc64le, s390x and SunOS 5.11 i386
+  (https://github.com/fmtlib/fmt/issues/138,
+  https://github.com/fmtlib/fmt/issues/179,
+  https://github.com/fmtlib/fmt/issues/180,
+  https://github.com/fmtlib/fmt/issues/202,
+  https://github.com/fmtlib/fmt/issues/225, [Red Hat Bugzilla
+  Bug 1260297](https://bugzilla.redhat.com/show_bug.cgi?id=1260297)).
+  Thanks @Naios, @jackyf and Dave Johansen.
+
+- Fixed a name conflict with macro `free` defined in `crtdbg.h` when
+  `_CRTDBG_MAP_ALLOC` is set (https://github.com/fmtlib/fmt/issues/211).
+
+- Fixed shared library build on OS X
+  (https://github.com/fmtlib/fmt/pull/212). Thanks @dean0x7d.
+
+- Fixed an overload conflict on MSVC when `/Zc:wchar_t-` option is
+  specified (https://github.com/fmtlib/fmt/pull/214).
+  Thanks @slavanap.
+
+- Improved compatibility with MSVC 2008
+  (https://github.com/fmtlib/fmt/pull/236). Thanks @Jopie64.
+
+- Improved compatibility with bcc32
+  (https://github.com/fmtlib/fmt/issues/227).
+
+- Fixed `static_assert` detection on Clang
+  (https://github.com/fmtlib/fmt/pull/228). Thanks @dean0x7d.
+
+# 1.1.0 - 2015-03-06
+
+- Added `BasicArrayWriter`, a class template that provides operations
+  for formatting and writing data into a fixed-size array
+  (https://github.com/fmtlib/fmt/issues/105 and
+  https://github.com/fmtlib/fmt/issues/122):
+
+  ```c++
+  char buffer[100];
+  fmt::ArrayWriter w(buffer);
+  w.write("The answer is {}", 42);
+  ```
+
+- Added [0 A.D.](http://play0ad.com/) and [PenUltima Online
+  (POL)](http://www.polserver.com/) to the list of notable projects
+  using C++ Format.
+
+- C++ Format now uses MSVC intrinsics for better formatting performance
+  (https://github.com/fmtlib/fmt/pull/115,
+  https://github.com/fmtlib/fmt/pull/116,
+  https://github.com/fmtlib/fmt/pull/118 and
+  https://github.com/fmtlib/fmt/pull/121). Previously these
+  optimizations where only used on GCC and Clang.
+  Thanks @CarterLi and @objectx.
+
+- CMake install target
+  (https://github.com/fmtlib/fmt/pull/119). Thanks @TrentHouliston.
+
+  You can now install C++ Format with `make install` command.
+
+- Improved [Biicode](http://www.biicode.com/) support
+  (https://github.com/fmtlib/fmt/pull/98 and
+  https://github.com/fmtlib/fmt/pull/104).
+  Thanks @MariadeAnton and @franramirez688.
+
+- Improved support for building with [Android NDK](
+  https://developer.android.com/tools/sdk/ndk/index.html)
+  (https://github.com/fmtlib/fmt/pull/107). Thanks @newnon.
+
+  The [android-ndk-example](https://github.com/fmtlib/android-ndk-example)
+  repository provides and example of using C++ Format with Android NDK:
+
+  ![](https://raw.githubusercontent.com/fmtlib/android-ndk-example/master/screenshot.png)
+
+- Improved documentation of `SystemError` and `WindowsError`
+  (https://github.com/fmtlib/fmt/issues/54).
+
+- Various code improvements
+  (https://github.com/fmtlib/fmt/pull/110,
+  https://github.com/fmtlib/fmt/pull/111
+  https://github.com/fmtlib/fmt/pull/112). Thanks @CarterLi.
+
+- Improved compile-time errors when formatting wide into narrow
+  strings (https://github.com/fmtlib/fmt/issues/117).
+
+- Fixed `BasicWriter::write` without formatting arguments when C++11
+  support is disabled
+  (https://github.com/fmtlib/fmt/issues/109).
+
+- Fixed header-only build on OS X with GCC 4.9
+  (https://github.com/fmtlib/fmt/issues/124).
+
+- Fixed packaging issues (https://github.com/fmtlib/fmt/issues/94).
+
+- Added [changelog](https://github.com/fmtlib/fmt/blob/master/ChangeLog.md)
+  (https://github.com/fmtlib/fmt/issues/103).
+
+# 1.0.0 - 2015-02-05
+
+- Add support for a header-only configuration when `FMT_HEADER_ONLY`
+  is defined before including `format.h`:
+
+  ```c++
+  #define FMT_HEADER_ONLY
+  #include "format.h"
+  ```
+
+- Compute string length in the constructor of `BasicStringRef` instead
+  of the `size` method
+  (https://github.com/fmtlib/fmt/issues/79). This eliminates
+  size computation for string literals on reasonable optimizing
+  compilers.
+
+- Fix formatting of types with overloaded `operator <<` for
+  `std::wostream` (https://github.com/fmtlib/fmt/issues/86):
+
+  ```c++
+  fmt::format(L"The date is {0}", Date(2012, 12, 9));
+  ```
+
+- Fix linkage of tests on Arch Linux
+  (https://github.com/fmtlib/fmt/issues/89).
+
+- Allow precision specifier for non-float arguments
+  (https://github.com/fmtlib/fmt/issues/90):
+
+  ```c++
+  fmt::print("{:.3}\n", "Carpet"); // prints "Car"
+  ```
+
+- Fix build on Android NDK (https://github.com/fmtlib/fmt/issues/93).
+
+- Improvements to documentation build procedure.
+
+- Remove `FMT_SHARED` CMake variable in favor of standard [BUILD_SHARED_LIBS](
+  http://www.cmake.org/cmake/help/v3.0/variable/BUILD_SHARED_LIBS.html).
+
+- Fix error handling in `fmt::fprintf`.
+
+- Fix a number of warnings.
+
+# 0.12.0 - 2014-10-25
+
+- \[Breaking\] Improved separation between formatting and buffer
+  management. `Writer` is now a base class that cannot be instantiated
+  directly. The new `MemoryWriter` class implements the default buffer
+  management with small allocations done on stack. So `fmt::Writer`
+  should be replaced with `fmt::MemoryWriter` in variable
+  declarations.
+
+  Old code:
+
+  ```c++
+  fmt::Writer w;
+  ```
+
+  New code:
+
+  ```c++
+  fmt::MemoryWriter w;
+  ```
+
+  If you pass `fmt::Writer` by reference, you can continue to do so:
+
+  ```c++
+  void f(fmt::Writer &w);
+  ```
+
+  This doesn\'t affect the formatting API.
+
+- Support for custom memory allocators
+  (https://github.com/fmtlib/fmt/issues/69)
+
+- Formatting functions now accept [signed char]{.title-ref} and
+  [unsigned char]{.title-ref} strings as arguments
+  (https://github.com/fmtlib/fmt/issues/73):
+
+  ```c++
+  auto s = format("GLSL version: {}", glGetString(GL_VERSION));
+  ```
+
+- Reduced code bloat. According to the new [benchmark
+  results](https://github.com/fmtlib/fmt#compile-time-and-code-bloat),
+  cppformat is close to `printf` and by the order of magnitude better
+  than Boost Format in terms of compiled code size.
+
+- Improved appearance of the documentation on mobile by using the
+  [Sphinx Bootstrap
+  theme](http://ryan-roemer.github.io/sphinx-bootstrap-theme/):
+
+  | Old | New |
+  | --- | --- |
+  | ![](https://cloud.githubusercontent.com/assets/576385/4792130/cd256436-5de3-11e4-9a62-c077d0c2b003.png) | ![](https://cloud.githubusercontent.com/assets/576385/4792131/cd29896c-5de3-11e4-8f59-cac952942bf0.png) |
+
+# 0.11.0 - 2014-08-21
+
+- Safe printf implementation with a POSIX extension for positional
+  arguments:
+
+  ```c++
+  fmt::printf("Elapsed time: %.2f seconds", 1.23);
+  fmt::printf("%1$s, %3$d %2$s", weekday, month, day);
+  ```
+
+- Arguments of `char` type can now be formatted as integers (Issue
+  https://github.com/fmtlib/fmt/issues/55):
+
+  ```c++
+  fmt::format("0x{0:02X}", 'a');
+  ```
+
+- Deprecated parts of the API removed.
+
+- The library is now built and tested on MinGW with Appveyor in
+  addition to existing test platforms Linux/GCC, OS X/Clang,
+  Windows/MSVC.
+
+# 0.10.0 - 2014-07-01
+
+**Improved API**
+
+- All formatting methods are now implemented as variadic functions
+  instead of using `operator<<` for feeding arbitrary arguments into a
+  temporary formatter object. This works both with C++11 where
+  variadic templates are used and with older standards where variadic
+  functions are emulated by providing lightweight wrapper functions
+  defined with the `FMT_VARIADIC` macro. You can use this macro for
+  defining your own portable variadic functions:
+
+  ```c++
+  void report_error(const char *format, const fmt::ArgList &args) {
+    fmt::print("Error: {}");
+    fmt::print(format, args);
+  }
+  FMT_VARIADIC(void, report_error, const char *)
+
+  report_error("file not found: {}", path);
+  ```
+
+  Apart from a more natural syntax, this also improves performance as
+  there is no need to construct temporary formatter objects and
+  control arguments\' lifetimes. Because the wrapper functions are
+  very lightweight, this doesn\'t cause code bloat even in pre-C++11
+  mode.
+
+- Simplified common case of formatting an `std::string`. Now it
+  requires a single function call:
+
+  ```c++
+  std::string s = format("The answer is {}.", 42);
+  ```
+
+  Previously it required 2 function calls:
+
+  ```c++
+  std::string s = str(Format("The answer is {}.") << 42);
+  ```
+
+  Instead of unsafe `c_str` function, `fmt::Writer` should be used
+  directly to bypass creation of `std::string`:
+
+  ```c++
+  fmt::Writer w;
+  w.write("The answer is {}.", 42);
+  w.c_str();  // returns a C string
+  ```
+
+  This doesn\'t do dynamic memory allocation for small strings and is
+  less error prone as the lifetime of the string is the same as for
+  `std::string::c_str` which is well understood (hopefully).
+
+- Improved consistency in naming functions that are a part of the
+  public API. Now all public functions are lowercase following the
+  standard library conventions. Previously it was a combination of
+  lowercase and CapitalizedWords. Issue
+  https://github.com/fmtlib/fmt/issues/50.
+
+- Old functions are marked as deprecated and will be removed in the
+  next release.
+
+**Other Changes**
+
+- Experimental support for printf format specifications (work in
+  progress):
+
+  ```c++
+  fmt::printf("The answer is %d.", 42);
+  std::string s = fmt::sprintf("Look, a %s!", "string");
+  ```
+
+- Support for hexadecimal floating point format specifiers `a` and
+  `A`:
+
+  ```c++
+  print("{:a}", -42.0); // Prints -0x1.5p+5
+  print("{:A}", -42.0); // Prints -0X1.5P+5
+  ```
+
+- CMake option `FMT_SHARED` that specifies whether to build format as
+  a shared library (off by default).
+
+# 0.9.0 - 2014-05-13
+
+- More efficient implementation of variadic formatting functions.
+
+- `Writer::Format` now has a variadic overload:
+
+  ```c++
+  Writer out;
+  out.Format("Look, I'm {}!", "variadic");
+  ```
+
+- For efficiency and consistency with other overloads, variadic
+  overload of the `Format` function now returns `Writer` instead of
+  `std::string`. Use the `str` function to convert it to
+  `std::string`:
+
+  ```c++
+  std::string s = str(Format("Look, I'm {}!", "variadic"));
+  ```
+
+- Replaced formatter actions with output sinks: `NoAction` -\>
+  `NullSink`, `Write` -\> `FileSink`, `ColorWriter` -\>
+  `ANSITerminalSink`. This improves naming consistency and shouldn\'t
+  affect client code unless these classes are used directly which
+  should be rarely needed.
+
+- Added `ThrowSystemError` function that formats a message and throws
+  `SystemError` containing the formatted message and system-specific
+  error description. For example, the following code
+
+  ```c++
+  FILE *f = fopen(filename, "r");
+  if (!f)
+    ThrowSystemError(errno, "Failed to open file '{}'") << filename;
+  ```
+
+  will throw `SystemError` exception with description \"Failed to open
+  file \'\<filename\>\': No such file or directory\" if file doesn\'t
+  exist.
+
+- Support for AppVeyor continuous integration platform.
+
+- `Format` now throws `SystemError` in case of I/O errors.
+
+- Improve test infrastructure. Print functions are now tested by
+  redirecting the output to a pipe.
+
+# 0.8.0 - 2014-04-14
+
+- Initial release
diff --git a/doc/_static/bootstrap.min.js b/doc/_static/bootstrap.min.js
deleted file mode 100644
index c35e1da1..00000000
--- a/doc/_static/bootstrap.min.js
+++ /dev/null
@@ -1,7 +0,0 @@
-/*!
-  * Bootstrap v5.3.2 (https://getbootstrap.com/)
-  * Copyright 2011-2023 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
-  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
-  */
-!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@popperjs/core")):"function"==typeof define&&define.amd?define(["@popperjs/core"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).bootstrap=e(t.Popper)}(this,(function(t){"use strict";function e(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t)for(const i in t)if("default"!==i){const s=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:()=>t[i]})}return e.default=t,Object.freeze(e)}const i=e(t),s=new Map,n={set(t,e,i){s.has(t)||s.set(t,new Map);const n=s.get(t);n.has(e)||0===n.size?n.set(e,i):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(n.keys())[0]}.`)},get:(t,e)=>s.has(t)&&s.get(t).get(e)||null,remove(t,e){if(!s.has(t))return;const i=s.get(t);i.delete(e),0===i.size&&s.delete(t)}},o="transitionend",r=t=>(t&&window.CSS&&window.CSS.escape&&(t=t.replace(/#([^\s"#']+)/g,((t,e)=>`#${CSS.escape(e)}`))),t),a=t=>{t.dispatchEvent(new Event(o))},l=t=>!(!t||"object"!=typeof t)&&(void 0!==t.jquery&&(t=t[0]),void 0!==t.nodeType),c=t=>l(t)?t.jquery?t[0]:t:"string"==typeof t&&t.length>0?document.querySelector(r(t)):null,h=t=>{if(!l(t)||0===t.getClientRects().length)return!1;const e="visible"===getComputedStyle(t).getPropertyValue("visibility"),i=t.closest("details:not([open])");if(!i)return e;if(i!==t){const e=t.closest("summary");if(e&&e.parentNode!==i)return!1;if(null===e)return!1}return e},d=t=>!t||t.nodeType!==Node.ELEMENT_NODE||!!t.classList.contains("disabled")||(void 0!==t.disabled?t.disabled:t.hasAttribute("disabled")&&"false"!==t.getAttribute("disabled")),u=t=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof t.getRootNode){const e=t.getRootNode();return e instanceof ShadowRoot?e:null}return t instanceof ShadowRoot?t:t.parentNode?u(t.parentNode):null},_=()=>{},g=t=>{t.offsetHeight},f=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,m=[],p=()=>"rtl"===document.documentElement.dir,b=t=>{var e;e=()=>{const e=f();if(e){const i=t.NAME,s=e.fn[i];e.fn[i]=t.jQueryInterface,e.fn[i].Constructor=t,e.fn[i].noConflict=()=>(e.fn[i]=s,t.jQueryInterface)}},"loading"===document.readyState?(m.length||document.addEventListener("DOMContentLoaded",(()=>{for(const t of m)t()})),m.push(e)):e()},v=(t,e=[],i=t)=>"function"==typeof t?t(...e):i,y=(t,e,i=!0)=>{if(!i)return void v(t);const s=(t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:i}=window.getComputedStyle(t);const s=Number.parseFloat(e),n=Number.parseFloat(i);return s||n?(e=e.split(",")[0],i=i.split(",")[0],1e3*(Number.parseFloat(e)+Number.parseFloat(i))):0})(e)+5;let n=!1;const r=({target:i})=>{i===e&&(n=!0,e.removeEventListener(o,r),v(t))};e.addEventListener(o,r),setTimeout((()=>{n||a(e)}),s)},w=(t,e,i,s)=>{const n=t.length;let o=t.indexOf(e);return-1===o?!i&&s?t[n-1]:t[0]:(o+=i?1:-1,s&&(o=(o+n)%n),t[Math.max(0,Math.min(o,n-1))])},A=/[^.]*(?=\..*)\.|.*/,E=/\..*/,C=/::\d+$/,T={};let k=1;const $={mouseenter:"mouseover",mouseleave:"mouseout"},S=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function L(t,e){return e&&`${e}::${k++}`||t.uidEvent||k++}function O(t){const e=L(t);return t.uidEvent=e,T[e]=T[e]||{},T[e]}function I(t,e,i=null){return Object.values(t).find((t=>t.callable===e&&t.delegationSelector===i))}function D(t,e,i){const s="string"==typeof e,n=s?i:e||i;let o=M(t);return S.has(o)||(o=t),[s,n,o]}function N(t,e,i,s,n){if("string"!=typeof e||!t)return;let[o,r,a]=D(e,i,s);if(e in $){const t=t=>function(e){if(!e.relatedTarget||e.relatedTarget!==e.delegateTarget&&!e.delegateTarget.contains(e.relatedTarget))return t.call(this,e)};r=t(r)}const l=O(t),c=l[a]||(l[a]={}),h=I(c,r,o?i:null);if(h)return void(h.oneOff=h.oneOff&&n);const d=L(r,e.replace(A,"")),u=o?function(t,e,i){return function s(n){const o=t.querySelectorAll(e);for(let{target:r}=n;r&&r!==this;r=r.parentNode)for(const a of o)if(a===r)return F(n,{delegateTarget:r}),s.oneOff&&j.off(t,n.type,e,i),i.apply(r,[n])}}(t,i,r):function(t,e){return function i(s){return F(s,{delegateTarget:t}),i.oneOff&&j.off(t,s.type,e),e.apply(t,[s])}}(t,r);u.delegationSelector=o?i:null,u.callable=r,u.oneOff=n,u.uidEvent=d,c[d]=u,t.addEventListener(a,u,o)}function P(t,e,i,s,n){const o=I(e[i],s,n);o&&(t.removeEventListener(i,o,Boolean(n)),delete e[i][o.uidEvent])}function x(t,e,i,s){const n=e[i]||{};for(const[o,r]of Object.entries(n))o.includes(s)&&P(t,e,i,r.callable,r.delegationSelector)}function M(t){return t=t.replace(E,""),$[t]||t}const j={on(t,e,i,s){N(t,e,i,s,!1)},one(t,e,i,s){N(t,e,i,s,!0)},off(t,e,i,s){if("string"!=typeof e||!t)return;const[n,o,r]=D(e,i,s),a=r!==e,l=O(t),c=l[r]||{},h=e.startsWith(".");if(void 0===o){if(h)for(const i of Object.keys(l))x(t,l,i,e.slice(1));for(const[i,s]of Object.entries(c)){const n=i.replace(C,"");a&&!e.includes(n)||P(t,l,r,s.callable,s.delegationSelector)}}else{if(!Object.keys(c).length)return;P(t,l,r,o,n?i:null)}},trigger(t,e,i){if("string"!=typeof e||!t)return null;const s=f();let n=null,o=!0,r=!0,a=!1;e!==M(e)&&s&&(n=s.Event(e,i),s(t).trigger(n),o=!n.isPropagationStopped(),r=!n.isImmediatePropagationStopped(),a=n.isDefaultPrevented());const l=F(new Event(e,{bubbles:o,cancelable:!0}),i);return a&&l.preventDefault(),r&&t.dispatchEvent(l),l.defaultPrevented&&n&&n.preventDefault(),l}};function F(t,e={}){for(const[i,s]of Object.entries(e))try{t[i]=s}catch(e){Object.defineProperty(t,i,{configurable:!0,get:()=>s})}return t}function z(t){if("true"===t)return!0;if("false"===t)return!1;if(t===Number(t).toString())return Number(t);if(""===t||"null"===t)return null;if("string"!=typeof t)return t;try{return JSON.parse(decodeURIComponent(t))}catch(e){return t}}function H(t){return t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`))}const B={setDataAttribute(t,e,i){t.setAttribute(`data-bs-${H(e)}`,i)},removeDataAttribute(t,e){t.removeAttribute(`data-bs-${H(e)}`)},getDataAttributes(t){if(!t)return{};const e={},i=Object.keys(t.dataset).filter((t=>t.startsWith("bs")&&!t.startsWith("bsConfig")));for(const s of i){let i=s.replace(/^bs/,"");i=i.charAt(0).toLowerCase()+i.slice(1,i.length),e[i]=z(t.dataset[s])}return e},getDataAttribute:(t,e)=>z(t.getAttribute(`data-bs-${H(e)}`))};class q{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const i=l(e)?B.getDataAttribute(e,"config"):{};return{...this.constructor.Default,..."object"==typeof i?i:{},...l(e)?B.getDataAttributes(e):{},..."object"==typeof t?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[s,n]of Object.entries(e)){const e=t[s],o=l(e)?"element":null==(i=e)?`${i}`:Object.prototype.toString.call(i).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(n).test(o))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${s}" provided type "${o}" but expected type "${n}".`)}var i}}class W extends q{constructor(t,e){super(),(t=c(t))&&(this._element=t,this._config=this._getConfig(e),n.set(this._element,this.constructor.DATA_KEY,this))}dispose(){n.remove(this._element,this.constructor.DATA_KEY),j.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,i=!0){y(t,e,i)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return n.get(c(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,"object"==typeof e?e:null)}static get VERSION(){return"5.3.2"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const R=t=>{let e=t.getAttribute("data-bs-target");if(!e||"#"===e){let i=t.getAttribute("href");if(!i||!i.includes("#")&&!i.startsWith("."))return null;i.includes("#")&&!i.startsWith("#")&&(i=`#${i.split("#")[1]}`),e=i&&"#"!==i?r(i.trim()):null}return e},K={find:(t,e=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(e,t)),findOne:(t,e=document.documentElement)=>Element.prototype.querySelector.call(e,t),children:(t,e)=>[].concat(...t.children).filter((t=>t.matches(e))),parents(t,e){const i=[];let s=t.parentNode.closest(e);for(;s;)i.push(s),s=s.parentNode.closest(e);return i},prev(t,e){let i=t.previousElementSibling;for(;i;){if(i.matches(e))return[i];i=i.previousElementSibling}return[]},next(t,e){let i=t.nextElementSibling;for(;i;){if(i.matches(e))return[i];i=i.nextElementSibling}return[]},focusableChildren(t){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((t=>`${t}:not([tabindex^="-"])`)).join(",");return this.find(e,t).filter((t=>!d(t)&&h(t)))},getSelectorFromElement(t){const e=R(t);return e&&K.findOne(e)?e:null},getElementFromSelector(t){const e=R(t);return e?K.findOne(e):null},getMultipleElementsFromSelector(t){const e=R(t);return e?K.find(e):[]}},V=(t,e="hide")=>{const i=`click.dismiss${t.EVENT_KEY}`,s=t.NAME;j.on(document,i,`[data-bs-dismiss="${s}"]`,(function(i){if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),d(this))return;const n=K.getElementFromSelector(this)||this.closest(`.${s}`);t.getOrCreateInstance(n)[e]()}))},Q=".bs.alert",X=`close${Q}`,Y=`closed${Q}`;class U extends W{static get NAME(){return"alert"}close(){if(j.trigger(this._element,X).defaultPrevented)return;this._element.classList.remove("show");const t=this._element.classList.contains("fade");this._queueCallback((()=>this._destroyElement()),this._element,t)}_destroyElement(){this._element.remove(),j.trigger(this._element,Y),this.dispose()}static jQueryInterface(t){return this.each((function(){const e=U.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}V(U,"close"),b(U);const G='[data-bs-toggle="button"]';class J extends W{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(t){return this.each((function(){const e=J.getOrCreateInstance(this);"toggle"===t&&e[t]()}))}}j.on(document,"click.bs.button.data-api",G,(t=>{t.preventDefault();const e=t.target.closest(G);J.getOrCreateInstance(e).toggle()})),b(J);const Z=".bs.swipe",tt=`touchstart${Z}`,et=`touchmove${Z}`,it=`touchend${Z}`,st=`pointerdown${Z}`,nt=`pointerup${Z}`,ot={endCallback:null,leftCallback:null,rightCallback:null},rt={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class at extends q{constructor(t,e){super(),this._element=t,t&&at.isSupported()&&(this._config=this._getConfig(e),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return ot}static get DefaultType(){return rt}static get NAME(){return"swipe"}dispose(){j.off(this._element,Z)}_start(t){this._supportPointerEvents?this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX):this._deltaX=t.touches[0].clientX}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),v(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=40)return;const e=t/this._deltaX;this._deltaX=0,e&&v(e>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(j.on(this._element,st,(t=>this._start(t))),j.on(this._element,nt,(t=>this._end(t))),this._element.classList.add("pointer-event")):(j.on(this._element,tt,(t=>this._start(t))),j.on(this._element,et,(t=>this._move(t))),j.on(this._element,it,(t=>this._end(t))))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&("pen"===t.pointerType||"touch"===t.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const lt=".bs.carousel",ct=".data-api",ht="next",dt="prev",ut="left",_t="right",gt=`slide${lt}`,ft=`slid${lt}`,mt=`keydown${lt}`,pt=`mouseenter${lt}`,bt=`mouseleave${lt}`,vt=`dragstart${lt}`,yt=`load${lt}${ct}`,wt=`click${lt}${ct}`,At="carousel",Et="active",Ct=".active",Tt=".carousel-item",kt=Ct+Tt,$t={ArrowLeft:_t,ArrowRight:ut},St={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Lt={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Ot extends W{constructor(t,e){super(t,e),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=K.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===At&&this.cycle()}static get Default(){return St}static get DefaultType(){return Lt}static get NAME(){return"carousel"}next(){this._slide(ht)}nextWhenVisible(){!document.hidden&&h(this._element)&&this.next()}prev(){this._slide(dt)}pause(){this._isSliding&&a(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval((()=>this.nextWhenVisible()),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?j.one(this._element,ft,(()=>this.cycle())):this.cycle())}to(t){const e=this._getItems();if(t>e.length-1||t<0)return;if(this._isSliding)return void j.one(this._element,ft,(()=>this.to(t)));const i=this._getItemIndex(this._getActive());if(i===t)return;const s=t>i?ht:dt;this._slide(s,e[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&j.on(this._element,mt,(t=>this._keydown(t))),"hover"===this._config.pause&&(j.on(this._element,pt,(()=>this.pause())),j.on(this._element,bt,(()=>this._maybeEnableCycle()))),this._config.touch&&at.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const t of K.find(".carousel-item img",this._element))j.on(t,vt,(t=>t.preventDefault()));const t={leftCallback:()=>this._slide(this._directionToOrder(ut)),rightCallback:()=>this._slide(this._directionToOrder(_t)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((()=>this._maybeEnableCycle()),500+this._config.interval))}};this._swipeHelper=new at(this._element,t)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=$t[t.key];e&&(t.preventDefault(),this._slide(this._directionToOrder(e)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const e=K.findOne(Ct,this._indicatorsElement);e.classList.remove(Et),e.removeAttribute("aria-current");const i=K.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);i&&(i.classList.add(Et),i.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=e||this._config.defaultInterval}_slide(t,e=null){if(this._isSliding)return;const i=this._getActive(),s=t===ht,n=e||w(this._getItems(),i,s,this._config.wrap);if(n===i)return;const o=this._getItemIndex(n),r=e=>j.trigger(this._element,e,{relatedTarget:n,direction:this._orderToDirection(t),from:this._getItemIndex(i),to:o});if(r(gt).defaultPrevented)return;if(!i||!n)return;const a=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(o),this._activeElement=n;const l=s?"carousel-item-start":"carousel-item-end",c=s?"carousel-item-next":"carousel-item-prev";n.classList.add(c),g(n),i.classList.add(l),n.classList.add(l),this._queueCallback((()=>{n.classList.remove(l,c),n.classList.add(Et),i.classList.remove(Et,c,l),this._isSliding=!1,r(ft)}),i,this._isAnimated()),a&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return K.findOne(kt,this._element)}_getItems(){return K.find(Tt,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return p()?t===ut?dt:ht:t===ut?ht:dt}_orderToDirection(t){return p()?t===dt?ut:_t:t===dt?_t:ut}static jQueryInterface(t){return this.each((function(){const e=Ot.getOrCreateInstance(this,t);if("number"!=typeof t){if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}else e.to(t)}))}}j.on(document,wt,"[data-bs-slide], [data-bs-slide-to]",(function(t){const e=K.getElementFromSelector(this);if(!e||!e.classList.contains(At))return;t.preventDefault();const i=Ot.getOrCreateInstance(e),s=this.getAttribute("data-bs-slide-to");return s?(i.to(s),void i._maybeEnableCycle()):"next"===B.getDataAttribute(this,"slide")?(i.next(),void i._maybeEnableCycle()):(i.prev(),void i._maybeEnableCycle())})),j.on(window,yt,(()=>{const t=K.find('[data-bs-ride="carousel"]');for(const e of t)Ot.getOrCreateInstance(e)})),b(Ot);const It=".bs.collapse",Dt=`show${It}`,Nt=`shown${It}`,Pt=`hide${It}`,xt=`hidden${It}`,Mt=`click${It}.data-api`,jt="show",Ft="collapse",zt="collapsing",Ht=`:scope .${Ft} .${Ft}`,Bt='[data-bs-toggle="collapse"]',qt={parent:null,toggle:!0},Wt={parent:"(null|element)",toggle:"boolean"};class Rt extends W{constructor(t,e){super(t,e),this._isTransitioning=!1,this._triggerArray=[];const i=K.find(Bt);for(const t of i){const e=K.getSelectorFromElement(t),i=K.find(e).filter((t=>t===this._element));null!==e&&i.length&&this._triggerArray.push(t)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return qt}static get DefaultType(){return Wt}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter((t=>t!==this._element)).map((t=>Rt.getOrCreateInstance(t,{toggle:!1})))),t.length&&t[0]._isTransitioning)return;if(j.trigger(this._element,Dt).defaultPrevented)return;for(const e of t)e.hide();const e=this._getDimension();this._element.classList.remove(Ft),this._element.classList.add(zt),this._element.style[e]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const i=`scroll${e[0].toUpperCase()+e.slice(1)}`;this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(zt),this._element.classList.add(Ft,jt),this._element.style[e]="",j.trigger(this._element,Nt)}),this._element,!0),this._element.style[e]=`${this._element[i]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(j.trigger(this._element,Pt).defaultPrevented)return;const t=this._getDimension();this._element.style[t]=`${this._element.getBoundingClientRect()[t]}px`,g(this._element),this._element.classList.add(zt),this._element.classList.remove(Ft,jt);for(const t of this._triggerArray){const e=K.getElementFromSelector(t);e&&!this._isShown(e)&&this._addAriaAndCollapsedClass([t],!1)}this._isTransitioning=!0,this._element.style[t]="",this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(zt),this._element.classList.add(Ft),j.trigger(this._element,xt)}),this._element,!0)}_isShown(t=this._element){return t.classList.contains(jt)}_configAfterMerge(t){return t.toggle=Boolean(t.toggle),t.parent=c(t.parent),t}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(Bt);for(const e of t){const t=K.getElementFromSelector(e);t&&this._addAriaAndCollapsedClass([e],this._isShown(t))}}_getFirstLevelChildren(t){const e=K.find(Ht,this._config.parent);return K.find(t,this._config.parent).filter((t=>!e.includes(t)))}_addAriaAndCollapsedClass(t,e){if(t.length)for(const i of t)i.classList.toggle("collapsed",!e),i.setAttribute("aria-expanded",e)}static jQueryInterface(t){const e={};return"string"==typeof t&&/show|hide/.test(t)&&(e.toggle=!1),this.each((function(){const i=Rt.getOrCreateInstance(this,e);if("string"==typeof t){if(void 0===i[t])throw new TypeError(`No method named "${t}"`);i[t]()}}))}}j.on(document,Mt,Bt,(function(t){("A"===t.target.tagName||t.delegateTarget&&"A"===t.delegateTarget.tagName)&&t.preventDefault();for(const t of K.getMultipleElementsFromSelector(this))Rt.getOrCreateInstance(t,{toggle:!1}).toggle()})),b(Rt);const Kt="dropdown",Vt=".bs.dropdown",Qt=".data-api",Xt="ArrowUp",Yt="ArrowDown",Ut=`hide${Vt}`,Gt=`hidden${Vt}`,Jt=`show${Vt}`,Zt=`shown${Vt}`,te=`click${Vt}${Qt}`,ee=`keydown${Vt}${Qt}`,ie=`keyup${Vt}${Qt}`,se="show",ne='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',oe=`${ne}.${se}`,re=".dropdown-menu",ae=p()?"top-end":"top-start",le=p()?"top-start":"top-end",ce=p()?"bottom-end":"bottom-start",he=p()?"bottom-start":"bottom-end",de=p()?"left-start":"right-start",ue=p()?"right-start":"left-start",_e={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},ge={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class fe extends W{constructor(t,e){super(t,e),this._popper=null,this._parent=this._element.parentNode,this._menu=K.next(this._element,re)[0]||K.prev(this._element,re)[0]||K.findOne(re,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return _e}static get DefaultType(){return ge}static get NAME(){return Kt}toggle(){return this._isShown()?this.hide():this.show()}show(){if(d(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!j.trigger(this._element,Jt,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const t of[].concat(...document.body.children))j.on(t,"mouseover",_);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(se),this._element.classList.add(se),j.trigger(this._element,Zt,t)}}hide(){if(d(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!j.trigger(this._element,Ut,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))j.off(t,"mouseover",_);this._popper&&this._popper.destroy(),this._menu.classList.remove(se),this._element.classList.remove(se),this._element.setAttribute("aria-expanded","false"),B.removeDataAttribute(this._menu,"popper"),j.trigger(this._element,Gt,t)}}_getConfig(t){if("object"==typeof(t=super._getConfig(t)).reference&&!l(t.reference)&&"function"!=typeof t.reference.getBoundingClientRect)throw new TypeError(`${Kt.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(void 0===i)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;"parent"===this._config.reference?t=this._parent:l(this._config.reference)?t=c(this._config.reference):"object"==typeof this._config.reference&&(t=this._config.reference);const e=this._getPopperConfig();this._popper=i.createPopper(t,this._menu,e)}_isShown(){return this._menu.classList.contains(se)}_getPlacement(){const t=this._parent;if(t.classList.contains("dropend"))return de;if(t.classList.contains("dropstart"))return ue;if(t.classList.contains("dropup-center"))return"top";if(t.classList.contains("dropdown-center"))return"bottom";const e="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return t.classList.contains("dropup")?e?le:ae:e?he:ce}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(B.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,...v(this._config.popperConfig,[t])}}_selectMenuItem({key:t,target:e}){const i=K.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((t=>h(t)));i.length&&w(i,e,t===Yt,!i.includes(e)).focus()}static jQueryInterface(t){return this.each((function(){const e=fe.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}static clearMenus(t){if(2===t.button||"keyup"===t.type&&"Tab"!==t.key)return;const e=K.find(oe);for(const i of e){const e=fe.getInstance(i);if(!e||!1===e._config.autoClose)continue;const s=t.composedPath(),n=s.includes(e._menu);if(s.includes(e._element)||"inside"===e._config.autoClose&&!n||"outside"===e._config.autoClose&&n)continue;if(e._menu.contains(t.target)&&("keyup"===t.type&&"Tab"===t.key||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const o={relatedTarget:e._element};"click"===t.type&&(o.clickEvent=t),e._completeHide(o)}}static dataApiKeydownHandler(t){const e=/input|textarea/i.test(t.target.tagName),i="Escape"===t.key,s=[Xt,Yt].includes(t.key);if(!s&&!i)return;if(e&&!i)return;t.preventDefault();const n=this.matches(ne)?this:K.prev(this,ne)[0]||K.next(this,ne)[0]||K.findOne(ne,t.delegateTarget.parentNode),o=fe.getOrCreateInstance(n);if(s)return t.stopPropagation(),o.show(),void o._selectMenuItem(t);o._isShown()&&(t.stopPropagation(),o.hide(),n.focus())}}j.on(document,ee,ne,fe.dataApiKeydownHandler),j.on(document,ee,re,fe.dataApiKeydownHandler),j.on(document,te,fe.clearMenus),j.on(document,ie,fe.clearMenus),j.on(document,te,ne,(function(t){t.preventDefault(),fe.getOrCreateInstance(this).toggle()})),b(fe);const me="backdrop",pe="show",be=`mousedown.bs.${me}`,ve={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},ye={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class we extends q{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return ve}static get DefaultType(){return ye}static get NAME(){return me}show(t){if(!this._config.isVisible)return void v(t);this._append();const e=this._getElement();this._config.isAnimated&&g(e),e.classList.add(pe),this._emulateAnimation((()=>{v(t)}))}hide(t){this._config.isVisible?(this._getElement().classList.remove(pe),this._emulateAnimation((()=>{this.dispose(),v(t)}))):v(t)}dispose(){this._isAppended&&(j.off(this._element,be),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add("fade"),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=c(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),j.on(t,be,(()=>{v(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(t){y(t,this._getElement(),this._config.isAnimated)}}const Ae=".bs.focustrap",Ee=`focusin${Ae}`,Ce=`keydown.tab${Ae}`,Te="backward",ke={autofocus:!0,trapElement:null},$e={autofocus:"boolean",trapElement:"element"};class Se extends q{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return ke}static get DefaultType(){return $e}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),j.off(document,Ae),j.on(document,Ee,(t=>this._handleFocusin(t))),j.on(document,Ce,(t=>this._handleKeydown(t))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,j.off(document,Ae))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const i=K.focusableChildren(e);0===i.length?e.focus():this._lastTabNavDirection===Te?i[i.length-1].focus():i[0].focus()}_handleKeydown(t){"Tab"===t.key&&(this._lastTabNavDirection=t.shiftKey?Te:"forward")}}const Le=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Oe=".sticky-top",Ie="padding-right",De="margin-right";class Ne{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Ie,(e=>e+t)),this._setElementAttributes(Le,Ie,(e=>e+t)),this._setElementAttributes(Oe,De,(e=>e-t))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Ie),this._resetElementAttributes(Le,Ie),this._resetElementAttributes(Oe,De)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,i){const s=this.getWidth();this._applyManipulationCallback(t,(t=>{if(t!==this._element&&window.innerWidth>t.clientWidth+s)return;this._saveInitialAttribute(t,e);const n=window.getComputedStyle(t).getPropertyValue(e);t.style.setProperty(e,`${i(Number.parseFloat(n))}px`)}))}_saveInitialAttribute(t,e){const i=t.style.getPropertyValue(e);i&&B.setDataAttribute(t,e,i)}_resetElementAttributes(t,e){this._applyManipulationCallback(t,(t=>{const i=B.getDataAttribute(t,e);null!==i?(B.removeDataAttribute(t,e),t.style.setProperty(e,i)):t.style.removeProperty(e)}))}_applyManipulationCallback(t,e){if(l(t))e(t);else for(const i of K.find(t,this._element))e(i)}}const Pe=".bs.modal",xe=`hide${Pe}`,Me=`hidePrevented${Pe}`,je=`hidden${Pe}`,Fe=`show${Pe}`,ze=`shown${Pe}`,He=`resize${Pe}`,Be=`click.dismiss${Pe}`,qe=`mousedown.dismiss${Pe}`,We=`keydown.dismiss${Pe}`,Re=`click${Pe}.data-api`,Ke="modal-open",Ve="show",Qe="modal-static",Xe={backdrop:!0,focus:!0,keyboard:!0},Ye={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Ue extends W{constructor(t,e){super(t,e),this._dialog=K.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Ne,this._addEventListeners()}static get Default(){return Xe}static get DefaultType(){return Ye}static get NAME(){return"modal"}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||j.trigger(this._element,Fe,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Ke),this._adjustDialog(),this._backdrop.show((()=>this._showElement(t))))}hide(){this._isShown&&!this._isTransitioning&&(j.trigger(this._element,xe).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Ve),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated())))}dispose(){j.off(window,Pe),j.off(this._dialog,Pe),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new we({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Se({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=K.findOne(".modal-body",this._dialog);e&&(e.scrollTop=0),g(this._element),this._element.classList.add(Ve),this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,j.trigger(this._element,ze,{relatedTarget:t})}),this._dialog,this._isAnimated())}_addEventListeners(){j.on(this._element,We,(t=>{"Escape"===t.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),j.on(window,He,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),j.on(this._element,qe,(t=>{j.one(this._element,Be,(e=>{this._element===t.target&&this._element===e.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(Ke),this._resetAdjustments(),this._scrollBar.reset(),j.trigger(this._element,je)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(j.trigger(this._element,Me).defaultPrevented)return;const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._element.style.overflowY;"hidden"===e||this._element.classList.contains(Qe)||(t||(this._element.style.overflowY="hidden"),this._element.classList.add(Qe),this._queueCallback((()=>{this._element.classList.remove(Qe),this._queueCallback((()=>{this._element.style.overflowY=e}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),i=e>0;if(i&&!t){const t=p()?"paddingLeft":"paddingRight";this._element.style[t]=`${e}px`}if(!i&&t){const t=p()?"paddingRight":"paddingLeft";this._element.style[t]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each((function(){const i=Ue.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===i[t])throw new TypeError(`No method named "${t}"`);i[t](e)}}))}}j.on(document,Re,'[data-bs-toggle="modal"]',(function(t){const e=K.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&t.preventDefault(),j.one(e,Fe,(t=>{t.defaultPrevented||j.one(e,je,(()=>{h(this)&&this.focus()}))}));const i=K.findOne(".modal.show");i&&Ue.getInstance(i).hide(),Ue.getOrCreateInstance(e).toggle(this)})),V(Ue),b(Ue);const Ge=".bs.offcanvas",Je=".data-api",Ze=`load${Ge}${Je}`,ti="show",ei="showing",ii="hiding",si=".offcanvas.show",ni=`show${Ge}`,oi=`shown${Ge}`,ri=`hide${Ge}`,ai=`hidePrevented${Ge}`,li=`hidden${Ge}`,ci=`resize${Ge}`,hi=`click${Ge}${Je}`,di=`keydown.dismiss${Ge}`,ui={backdrop:!0,keyboard:!0,scroll:!1},_i={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class gi extends W{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return ui}static get DefaultType(){return _i}static get NAME(){return"offcanvas"}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||j.trigger(this._element,ni,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||(new Ne).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(ei),this._queueCallback((()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(ti),this._element.classList.remove(ei),j.trigger(this._element,oi,{relatedTarget:t})}),this._element,!0))}hide(){this._isShown&&(j.trigger(this._element,ri).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(ii),this._backdrop.hide(),this._queueCallback((()=>{this._element.classList.remove(ti,ii),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new Ne).reset(),j.trigger(this._element,li)}),this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=Boolean(this._config.backdrop);return new we({className:"offcanvas-backdrop",isVisible:t,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:t?()=>{"static"!==this._config.backdrop?this.hide():j.trigger(this._element,ai)}:null})}_initializeFocusTrap(){return new Se({trapElement:this._element})}_addEventListeners(){j.on(this._element,di,(t=>{"Escape"===t.key&&(this._config.keyboard?this.hide():j.trigger(this._element,ai))}))}static jQueryInterface(t){return this.each((function(){const e=gi.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}j.on(document,hi,'[data-bs-toggle="offcanvas"]',(function(t){const e=K.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),d(this))return;j.one(e,li,(()=>{h(this)&&this.focus()}));const i=K.findOne(si);i&&i!==e&&gi.getInstance(i).hide(),gi.getOrCreateInstance(e).toggle(this)})),j.on(window,Ze,(()=>{for(const t of K.find(si))gi.getOrCreateInstance(t).show()})),j.on(window,ci,(()=>{for(const t of K.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(t).position&&gi.getOrCreateInstance(t).hide()})),V(gi),b(gi);const fi={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},mi=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),pi=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,bi=(t,e)=>{const i=t.nodeName.toLowerCase();return e.includes(i)?!mi.has(i)||Boolean(pi.test(t.nodeValue)):e.filter((t=>t instanceof RegExp)).some((t=>t.test(i)))},vi={allowList:fi,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},yi={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},wi={entry:"(string|element|function|null)",selector:"(string|element)"};class Ai extends q{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return vi}static get DefaultType(){return yi}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((t=>this._resolvePossibleFunction(t))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[e,i]of Object.entries(this._config.content))this._setContent(t,i,e);const e=t.children[0],i=this._resolvePossibleFunction(this._config.extraClass);return i&&e.classList.add(...i.split(" ")),e}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[e,i]of Object.entries(t))super._typeCheckConfig({selector:e,entry:i},wi)}_setContent(t,e,i){const s=K.findOne(i,t);s&&((e=this._resolvePossibleFunction(e))?l(e)?this._putElementInTemplate(c(e),s):this._config.html?s.innerHTML=this._maybeSanitize(e):s.textContent=e:s.remove())}_maybeSanitize(t){return this._config.sanitize?function(t,e,i){if(!t.length)return t;if(i&&"function"==typeof i)return i(t);const s=(new window.DOMParser).parseFromString(t,"text/html"),n=[].concat(...s.body.querySelectorAll("*"));for(const t of n){const i=t.nodeName.toLowerCase();if(!Object.keys(e).includes(i)){t.remove();continue}const s=[].concat(...t.attributes),n=[].concat(e["*"]||[],e[i]||[]);for(const e of s)bi(e,n)||t.removeAttribute(e.nodeName)}return s.body.innerHTML}(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return v(t,[this])}_putElementInTemplate(t,e){if(this._config.html)return e.innerHTML="",void e.append(t);e.textContent=t.textContent}}const Ei=new Set(["sanitize","allowList","sanitizeFn"]),Ci="fade",Ti="show",ki=".modal",$i="hide.bs.modal",Si="hover",Li="focus",Oi={AUTO:"auto",TOP:"top",RIGHT:p()?"left":"right",BOTTOM:"bottom",LEFT:p()?"right":"left"},Ii={allowList:fi,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Di={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Ni extends W{constructor(t,e){if(void 0===i)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t,e),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Ii}static get DefaultType(){return Di}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),j.off(this._element.closest(ki),$i,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const t=j.trigger(this._element,this.constructor.eventName("show")),e=(u(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!e)return;this._disposePopper();const i=this._getTipElement();this._element.setAttribute("aria-describedby",i.getAttribute("id"));const{container:s}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(s.append(i),j.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(i),i.classList.add(Ti),"ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))j.on(t,"mouseover",_);this._queueCallback((()=>{j.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(this._isShown()&&!j.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(Ti),"ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))j.off(t,"mouseover",_);this._activeTrigger.click=!1,this._activeTrigger[Li]=!1,this._activeTrigger[Si]=!1,this._isHovered=null,this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),j.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(Ci,Ti),e.classList.add(`bs-${this.constructor.NAME}-auto`);const i=(t=>{do{t+=Math.floor(1e6*Math.random())}while(document.getElementById(t));return t})(this.constructor.NAME).toString();return e.setAttribute("id",i),this._isAnimated()&&e.classList.add(Ci),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new Ai({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Ci)}_isShown(){return this.tip&&this.tip.classList.contains(Ti)}_createPopper(t){const e=v(this._config.placement,[this,t,this._element]),s=Oi[e.toUpperCase()];return i.createPopper(this._element,t,this._getPopperConfig(s))}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_resolvePossibleFunction(t){return v(t,[this._element])}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:t=>{this._getTipElement().setAttribute("data-popper-placement",t.state.placement)}}]};return{...e,...v(this._config.popperConfig,[e])}}_setListeners(){const t=this._config.trigger.split(" ");for(const e of t)if("click"===e)j.on(this._element,this.constructor.eventName("click"),this._config.selector,(t=>{this._initializeOnDelegatedTarget(t).toggle()}));else if("manual"!==e){const t=e===Si?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),i=e===Si?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");j.on(this._element,t,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusin"===t.type?Li:Si]=!0,e._enter()})),j.on(this._element,i,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusout"===t.type?Li:Si]=e._element.contains(t.relatedTarget),e._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},j.on(this._element.closest(ki),$i,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const e=B.getDataAttributes(this._element);for(const t of Object.keys(e))Ei.has(t)&&delete e[t];return t={...e,..."object"==typeof t&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=!1===t.container?document.body:c(t.container),"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[e,i]of Object.entries(this._config))this.constructor.Default[e]!==i&&(t[e]=i);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each((function(){const e=Ni.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}b(Ni);const Pi={...Ni.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},xi={...Ni.DefaultType,content:"(null|string|element|function)"};class Mi extends Ni{static get Default(){return Pi}static get DefaultType(){return xi}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each((function(){const e=Mi.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}b(Mi);const ji=".bs.scrollspy",Fi=`activate${ji}`,zi=`click${ji}`,Hi=`load${ji}.data-api`,Bi="active",qi="[href]",Wi=".nav-link",Ri=`${Wi}, .nav-item > ${Wi}, .list-group-item`,Ki={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Vi={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Qi extends W{constructor(t,e){super(t,e),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Ki}static get DefaultType(){return Vi}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=c(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,"string"==typeof t.threshold&&(t.threshold=t.threshold.split(",").map((t=>Number.parseFloat(t)))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(j.off(this._config.target,zi),j.on(this._config.target,zi,qi,(t=>{const e=this._observableSections.get(t.target.hash);if(e){t.preventDefault();const i=this._rootElement||window,s=e.offsetTop-this._element.offsetTop;if(i.scrollTo)return void i.scrollTo({top:s,behavior:"smooth"});i.scrollTop=s}})))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((t=>this._observerCallback(t)),t)}_observerCallback(t){const e=t=>this._targetLinks.get(`#${t.target.id}`),i=t=>{this._previousScrollData.visibleEntryTop=t.target.offsetTop,this._process(e(t))},s=(this._rootElement||document.documentElement).scrollTop,n=s>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=s;for(const o of t){if(!o.isIntersecting){this._activeTarget=null,this._clearActiveClass(e(o));continue}const t=o.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(n&&t){if(i(o),!s)return}else n||t||i(o)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=K.find(qi,this._config.target);for(const e of t){if(!e.hash||d(e))continue;const t=K.findOne(decodeURI(e.hash),this._element);h(t)&&(this._targetLinks.set(decodeURI(e.hash),e),this._observableSections.set(e.hash,t))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(Bi),this._activateParents(t),j.trigger(this._element,Fi,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains("dropdown-item"))K.findOne(".dropdown-toggle",t.closest(".dropdown")).classList.add(Bi);else for(const e of K.parents(t,".nav, .list-group"))for(const t of K.prev(e,Ri))t.classList.add(Bi)}_clearActiveClass(t){t.classList.remove(Bi);const e=K.find(`${qi}.${Bi}`,t);for(const t of e)t.classList.remove(Bi)}static jQueryInterface(t){return this.each((function(){const e=Qi.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}j.on(window,Hi,(()=>{for(const t of K.find('[data-bs-spy="scroll"]'))Qi.getOrCreateInstance(t)})),b(Qi);const Xi=".bs.tab",Yi=`hide${Xi}`,Ui=`hidden${Xi}`,Gi=`show${Xi}`,Ji=`shown${Xi}`,Zi=`click${Xi}`,ts=`keydown${Xi}`,es=`load${Xi}`,is="ArrowLeft",ss="ArrowRight",ns="ArrowUp",os="ArrowDown",rs="Home",as="End",ls="active",cs="fade",hs="show",ds=".dropdown-toggle",us=`:not(${ds})`,_s='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',gs=`.nav-link${us}, .list-group-item${us}, [role="tab"]${us}, ${_s}`,fs=`.${ls}[data-bs-toggle="tab"], .${ls}[data-bs-toggle="pill"], .${ls}[data-bs-toggle="list"]`;class ms extends W{constructor(t){super(t),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),j.on(this._element,ts,(t=>this._keydown(t))))}static get NAME(){return"tab"}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),i=e?j.trigger(e,Yi,{relatedTarget:t}):null;j.trigger(t,Gi,{relatedTarget:e}).defaultPrevented||i&&i.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){t&&(t.classList.add(ls),this._activate(K.getElementFromSelector(t)),this._queueCallback((()=>{"tab"===t.getAttribute("role")?(t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),j.trigger(t,Ji,{relatedTarget:e})):t.classList.add(hs)}),t,t.classList.contains(cs)))}_deactivate(t,e){t&&(t.classList.remove(ls),t.blur(),this._deactivate(K.getElementFromSelector(t)),this._queueCallback((()=>{"tab"===t.getAttribute("role")?(t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),j.trigger(t,Ui,{relatedTarget:e})):t.classList.remove(hs)}),t,t.classList.contains(cs)))}_keydown(t){if(![is,ss,ns,os,rs,as].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=this._getChildren().filter((t=>!d(t)));let i;if([rs,as].includes(t.key))i=e[t.key===rs?0:e.length-1];else{const s=[ss,os].includes(t.key);i=w(e,t.target,s,!0)}i&&(i.focus({preventScroll:!0}),ms.getOrCreateInstance(i).show())}_getChildren(){return K.find(gs,this._parent)}_getActiveElem(){return this._getChildren().find((t=>this._elemIsActive(t)))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const t of e)this._setInitialAttributesOnChild(t)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),i=this._getOuterElement(t);t.setAttribute("aria-selected",e),i!==t&&this._setAttributeIfNotExists(i,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=K.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const i=this._getOuterElement(t);if(!i.classList.contains("dropdown"))return;const s=(t,s)=>{const n=K.findOne(t,i);n&&n.classList.toggle(s,e)};s(ds,ls),s(".dropdown-menu",hs),i.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,i){t.hasAttribute(e)||t.setAttribute(e,i)}_elemIsActive(t){return t.classList.contains(ls)}_getInnerElement(t){return t.matches(gs)?t:K.findOne(gs,t)}_getOuterElement(t){return t.closest(".nav-item, .list-group-item")||t}static jQueryInterface(t){return this.each((function(){const e=ms.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}j.on(document,Zi,_s,(function(t){["A","AREA"].includes(this.tagName)&&t.preventDefault(),d(this)||ms.getOrCreateInstance(this).show()})),j.on(window,es,(()=>{for(const t of K.find(fs))ms.getOrCreateInstance(t)})),b(ms);const ps=".bs.toast",bs=`mouseover${ps}`,vs=`mouseout${ps}`,ys=`focusin${ps}`,ws=`focusout${ps}`,As=`hide${ps}`,Es=`hidden${ps}`,Cs=`show${ps}`,Ts=`shown${ps}`,ks="hide",$s="show",Ss="showing",Ls={animation:"boolean",autohide:"boolean",delay:"number"},Os={animation:!0,autohide:!0,delay:5e3};class Is extends W{constructor(t,e){super(t,e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Os}static get DefaultType(){return Ls}static get NAME(){return"toast"}show(){j.trigger(this._element,Cs).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(ks),g(this._element),this._element.classList.add($s,Ss),this._queueCallback((()=>{this._element.classList.remove(Ss),j.trigger(this._element,Ts),this._maybeScheduleHide()}),this._element,this._config.animation))}hide(){this.isShown()&&(j.trigger(this._element,As).defaultPrevented||(this._element.classList.add(Ss),this._queueCallback((()=>{this._element.classList.add(ks),this._element.classList.remove(Ss,$s),j.trigger(this._element,Es)}),this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove($s),super.dispose()}isShown(){return this._element.classList.contains($s)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":this._hasMouseInteraction=e;break;case"focusin":case"focusout":this._hasKeyboardInteraction=e}if(e)return void this._clearTimeout();const i=t.relatedTarget;this._element===i||this._element.contains(i)||this._maybeScheduleHide()}_setListeners(){j.on(this._element,bs,(t=>this._onInteraction(t,!0))),j.on(this._element,vs,(t=>this._onInteraction(t,!1))),j.on(this._element,ys,(t=>this._onInteraction(t,!0))),j.on(this._element,ws,(t=>this._onInteraction(t,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each((function(){const e=Is.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}return V(Is),b(Is),{Alert:U,Button:J,Carousel:Ot,Collapse:Rt,Dropdown:fe,Modal:Ue,Offcanvas:gi,Popover:Mi,ScrollSpy:Qi,Tab:ms,Toast:Is,Tooltip:Ni}}));
-//# sourceMappingURL=bootstrap.min.js.map
\ No newline at end of file
diff --git a/doc/_static/breathe.css b/doc/_static/breathe.css
deleted file mode 100644
index 2a1534b0..00000000
--- a/doc/_static/breathe.css
+++ /dev/null
@@ -1,28 +0,0 @@
-
-/* -- breathe specific styles ----------------------------------------------- */
-
-/* So enum value descriptions are displayed inline to the item */
-.breatheenumvalues li tt + p {
-  display: inline;
-}
-
-/* So parameter descriptions are displayed inline to the item */
-.breatheparameterlist li tt + p {
-  display: inline;
-}
-
-.container .breathe-sectiondef {
-  width: inherit;
-}
-
-.github-btn {
-  border: 0;
-  overflow: hidden;
-}
-
-.jumbotron {
-  background-size: 100% 4px;
-  background-repeat: repeat-y;
-  color: white;
-  text-align: center;
-}
diff --git a/doc/_static/fonts/glyphicons-halflings-regular.eot b/doc/_static/fonts/glyphicons-halflings-regular.eot
deleted file mode 100644
index 4a4ca865..00000000
Binary files a/doc/_static/fonts/glyphicons-halflings-regular.eot and /dev/null differ
diff --git a/doc/_static/fonts/glyphicons-halflings-regular.svg b/doc/_static/fonts/glyphicons-halflings-regular.svg
deleted file mode 100644
index e3e2dc73..00000000
--- a/doc/_static/fonts/glyphicons-halflings-regular.svg
+++ /dev/null
@@ -1,229 +0,0 @@
-<?xml version="1.0" standalone="no"?>
-<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" >
-<svg xmlns="http://www.w3.org/2000/svg">
-<metadata></metadata>
-<defs>
-<font id="glyphicons_halflingsregular" horiz-adv-x="1200" >
-<font-face units-per-em="1200" ascent="960" descent="-240" />
-<missing-glyph horiz-adv-x="500" />
-<glyph />
-<glyph />
-<glyph unicode="&#xd;" />
-<glyph unicode=" " />
-<glyph unicode="*" d="M100 500v200h259l-183 183l141 141l183 -183v259h200v-259l183 183l141 -141l-183 -183h259v-200h-259l183 -183l-141 -141l-183 183v-259h-200v259l-183 -183l-141 141l183 183h-259z" />
-<glyph unicode="+" d="M0 400v300h400v400h300v-400h400v-300h-400v-400h-300v400h-400z" />
-<glyph unicode="&#xa0;" />
-<glyph unicode="&#x2000;" horiz-adv-x="652" />
-<glyph unicode="&#x2001;" horiz-adv-x="1304" />
-<glyph unicode="&#x2002;" horiz-adv-x="652" />
-<glyph unicode="&#x2003;" horiz-adv-x="1304" />
-<glyph unicode="&#x2004;" horiz-adv-x="434" />
-<glyph unicode="&#x2005;" horiz-adv-x="326" />
-<glyph unicode="&#x2006;" horiz-adv-x="217" />
-<glyph unicode="&#x2007;" horiz-adv-x="217" />
-<glyph unicode="&#x2008;" horiz-adv-x="163" />
-<glyph unicode="&#x2009;" horiz-adv-x="260" />
-<glyph unicode="&#x200a;" horiz-adv-x="72" />
-<glyph unicode="&#x202f;" horiz-adv-x="260" />
-<glyph unicode="&#x205f;" horiz-adv-x="326" />
-<glyph unicode="&#x20ac;" d="M100 500l100 100h113q0 47 5 100h-218l100 100h135q37 167 112 257q117 141 297 141q242 0 354 -189q60 -103 66 -209h-181q0 55 -25.5 99t-63.5 68t-75 36.5t-67 12.5q-24 0 -52.5 -10t-62.5 -32t-65.5 -67t-50.5 -107h379l-100 -100h-300q-6 -46 -6 -100h406l-100 -100 h-300q9 -74 33 -132t52.5 -91t62 -54.5t59 -29t46.5 -7.5q29 0 66 13t75 37t63.5 67.5t25.5 96.5h174q-31 -172 -128 -278q-107 -117 -274 -117q-205 0 -324 158q-36 46 -69 131.5t-45 205.5h-217z" />
-<glyph unicode="&#x2212;" d="M200 400h900v300h-900v-300z" />
-<glyph unicode="&#x25fc;" horiz-adv-x="500" d="M0 0z" />
-<glyph unicode="&#x2601;" d="M-14 494q0 -80 56.5 -137t135.5 -57h750q120 0 205 86.5t85 207.5t-85 207t-205 86q-46 0 -90 -14q-44 97 -134.5 156.5t-200.5 59.5q-152 0 -260 -107.5t-108 -260.5q0 -25 2 -37q-66 -14 -108.5 -67.5t-42.5 -122.5z" />
-<glyph unicode="&#x2709;" d="M0 100l400 400l200 -200l200 200l400 -400h-1200zM0 300v600l300 -300zM0 1100l600 -603l600 603h-1200zM900 600l300 300v-600z" />
-<glyph unicode="&#x270f;" d="M-13 -13l333 112l-223 223zM187 403l214 -214l614 614l-214 214zM887 1103l214 -214l99 92q13 13 13 32.5t-13 33.5l-153 153q-15 13 -33 13t-33 -13z" />
-<glyph unicode="&#xe001;" d="M0 1200h1200l-500 -550v-550h300v-100h-800v100h300v550z" />
-<glyph unicode="&#xe002;" d="M14 84q18 -55 86 -75.5t147 5.5q65 21 109 69t44 90v606l600 155v-521q-64 16 -138 -7q-79 -26 -122.5 -83t-25.5 -111q18 -55 86 -75.5t147 4.5q70 23 111.5 63.5t41.5 95.5v881q0 10 -7 15.5t-17 2.5l-752 -193q-10 -3 -17 -12.5t-7 -19.5v-689q-64 17 -138 -7 q-79 -25 -122.5 -82t-25.5 -112z" />
-<glyph unicode="&#xe003;" d="M23 693q0 200 142 342t342 142t342 -142t142 -342q0 -142 -78 -261l300 -300q7 -8 7 -18t-7 -18l-109 -109q-8 -7 -18 -7t-18 7l-300 300q-119 -78 -261 -78q-200 0 -342 142t-142 342zM176 693q0 -136 97 -233t234 -97t233.5 96.5t96.5 233.5t-96.5 233.5t-233.5 96.5 t-234 -97t-97 -233z" />
-<glyph unicode="&#xe005;" d="M100 784q0 64 28 123t73 100.5t104.5 64t119 20.5t120 -38.5t104.5 -104.5q48 69 109.5 105t121.5 38t118.5 -20.5t102.5 -64t71 -100.5t27 -123q0 -57 -33.5 -117.5t-94 -124.5t-126.5 -127.5t-150 -152.5t-146 -174q-62 85 -145.5 174t-149.5 152.5t-126.5 127.5 t-94 124.5t-33.5 117.5z" />
-<glyph unicode="&#xe006;" d="M-72 800h479l146 400h2l146 -400h472l-382 -278l145 -449l-384 275l-382 -275l146 447zM168 71l2 1z" />
-<glyph unicode="&#xe007;" d="M-72 800h479l146 400h2l146 -400h472l-382 -278l145 -449l-384 275l-382 -275l146 447zM168 71l2 1zM237 700l196 -142l-73 -226l192 140l195 -141l-74 229l193 140h-235l-77 211l-78 -211h-239z" />
-<glyph unicode="&#xe008;" d="M0 0v143l400 257v100q-37 0 -68.5 74.5t-31.5 125.5v200q0 124 88 212t212 88t212 -88t88 -212v-200q0 -51 -31.5 -125.5t-68.5 -74.5v-100l400 -257v-143h-1200z" />
-<glyph unicode="&#xe009;" d="M0 0v1100h1200v-1100h-1200zM100 100h100v100h-100v-100zM100 300h100v100h-100v-100zM100 500h100v100h-100v-100zM100 700h100v100h-100v-100zM100 900h100v100h-100v-100zM300 100h600v400h-600v-400zM300 600h600v400h-600v-400zM1000 100h100v100h-100v-100z M1000 300h100v100h-100v-100zM1000 500h100v100h-100v-100zM1000 700h100v100h-100v-100zM1000 900h100v100h-100v-100z" />
-<glyph unicode="&#xe010;" d="M0 50v400q0 21 14.5 35.5t35.5 14.5h400q21 0 35.5 -14.5t14.5 -35.5v-400q0 -21 -14.5 -35.5t-35.5 -14.5h-400q-21 0 -35.5 14.5t-14.5 35.5zM0 650v400q0 21 14.5 35.5t35.5 14.5h400q21 0 35.5 -14.5t14.5 -35.5v-400q0 -21 -14.5 -35.5t-35.5 -14.5h-400 q-21 0 -35.5 14.5t-14.5 35.5zM600 50v400q0 21 14.5 35.5t35.5 14.5h400q21 0 35.5 -14.5t14.5 -35.5v-400q0 -21 -14.5 -35.5t-35.5 -14.5h-400q-21 0 -35.5 14.5t-14.5 35.5zM600 650v400q0 21 14.5 35.5t35.5 14.5h400q21 0 35.5 -14.5t14.5 -35.5v-400 q0 -21 -14.5 -35.5t-35.5 -14.5h-400q-21 0 -35.5 14.5t-14.5 35.5z" />
-<glyph unicode="&#xe011;" d="M0 50v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM0 450v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200 q-21 0 -35.5 14.5t-14.5 35.5zM0 850v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM400 50v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5 t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM400 450v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM400 850v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5 v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM800 50v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM800 450v200q0 21 14.5 35.5t35.5 14.5h200 q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM800 850v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5z" />
-<glyph unicode="&#xe012;" d="M0 50v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM0 450q0 -21 14.5 -35.5t35.5 -14.5h200q21 0 35.5 14.5t14.5 35.5v200q0 21 -14.5 35.5t-35.5 14.5h-200q-21 0 -35.5 -14.5 t-14.5 -35.5v-200zM0 850v200q0 21 14.5 35.5t35.5 14.5h200q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5zM400 50v200q0 21 14.5 35.5t35.5 14.5h700q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5 t-35.5 -14.5h-700q-21 0 -35.5 14.5t-14.5 35.5zM400 450v200q0 21 14.5 35.5t35.5 14.5h700q21 0 35.5 -14.5t14.5 -35.5v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-700q-21 0 -35.5 14.5t-14.5 35.5zM400 850v200q0 21 14.5 35.5t35.5 14.5h700q21 0 35.5 -14.5t14.5 -35.5 v-200q0 -21 -14.5 -35.5t-35.5 -14.5h-700q-21 0 -35.5 14.5t-14.5 35.5z" />
-<glyph unicode="&#xe013;" d="M29 454l419 -420l818 820l-212 212l-607 -607l-206 207z" />
-<glyph unicode="&#xe014;" d="M106 318l282 282l-282 282l212 212l282 -282l282 282l212 -212l-282 -282l282 -282l-212 -212l-282 282l-282 -282z" />
-<glyph unicode="&#xe015;" d="M23 693q0 200 142 342t342 142t342 -142t142 -342q0 -142 -78 -261l300 -300q7 -8 7 -18t-7 -18l-109 -109q-8 -7 -18 -7t-18 7l-300 300q-119 -78 -261 -78q-200 0 -342 142t-142 342zM176 693q0 -136 97 -233t234 -97t233.5 96.5t96.5 233.5t-96.5 233.5t-233.5 96.5 t-234 -97t-97 -233zM300 600v200h100v100h200v-100h100v-200h-100v-100h-200v100h-100z" />
-<glyph unicode="&#xe016;" d="M23 694q0 200 142 342t342 142t342 -142t142 -342q0 -141 -78 -262l300 -299q7 -7 7 -18t-7 -18l-109 -109q-8 -8 -18 -8t-18 8l-300 300q-119 -78 -261 -78q-200 0 -342 142t-142 342zM176 694q0 -136 97 -233t234 -97t233.5 97t96.5 233t-96.5 233t-233.5 97t-234 -97 t-97 -233zM300 601h400v200h-400v-200z" />
-<glyph unicode="&#xe017;" d="M23 600q0 183 105 331t272 210v-166q-103 -55 -165 -155t-62 -220q0 -177 125 -302t302 -125t302 125t125 302q0 120 -62 220t-165 155v166q167 -62 272 -210t105 -331q0 -118 -45.5 -224.5t-123 -184t-184 -123t-224.5 -45.5t-224.5 45.5t-184 123t-123 184t-45.5 224.5 zM500 750q0 -21 14.5 -35.5t35.5 -14.5h100q21 0 35.5 14.5t14.5 35.5v400q0 21 -14.5 35.5t-35.5 14.5h-100q-21 0 -35.5 -14.5t-14.5 -35.5v-400z" />
-<glyph unicode="&#xe018;" d="M100 1h200v300h-200v-300zM400 1v500h200v-500h-200zM700 1v800h200v-800h-200zM1000 1v1200h200v-1200h-200z" />
-<glyph unicode="&#xe019;" d="M26 601q0 -33 6 -74l151 -38l2 -6q14 -49 38 -93l3 -5l-80 -134q45 -59 105 -105l133 81l5 -3q45 -26 94 -39l5 -2l38 -151q40 -5 74 -5q27 0 74 5l38 151l6 2q46 13 93 39l5 3l134 -81q56 44 104 105l-80 134l3 5q24 44 39 93l1 6l152 38q5 40 5 74q0 28 -5 73l-152 38 l-1 6q-16 51 -39 93l-3 5l80 134q-44 58 -104 105l-134 -81l-5 3q-45 25 -93 39l-6 1l-38 152q-40 5 -74 5q-27 0 -74 -5l-38 -152l-5 -1q-50 -14 -94 -39l-5 -3l-133 81q-59 -47 -105 -105l80 -134l-3 -5q-25 -47 -38 -93l-2 -6l-151 -38q-6 -48 -6 -73zM385 601 q0 88 63 151t152 63t152 -63t63 -151q0 -89 -63 -152t-152 -63t-152 63t-63 152z" />
-<glyph unicode="&#xe020;" d="M100 1025v50q0 10 7.5 17.5t17.5 7.5h275v100q0 41 29.5 70.5t70.5 29.5h300q41 0 70.5 -29.5t29.5 -70.5v-100h275q10 0 17.5 -7.5t7.5 -17.5v-50q0 -11 -7 -18t-18 -7h-1050q-11 0 -18 7t-7 18zM200 100v800h900v-800q0 -41 -29.5 -71t-70.5 -30h-700q-41 0 -70.5 30 t-29.5 71zM300 100h100v700h-100v-700zM500 100h100v700h-100v-700zM500 1100h300v100h-300v-100zM700 100h100v700h-100v-700zM900 100h100v700h-100v-700z" />
-<glyph unicode="&#xe021;" d="M1 601l656 644l644 -644h-200v-600h-300v400h-300v-400h-300v600h-200z" />
-<glyph unicode="&#xe022;" d="M100 25v1150q0 11 7 18t18 7h475v-500h400v-675q0 -11 -7 -18t-18 -7h-850q-11 0 -18 7t-7 18zM700 800v300l300 -300h-300z" />
-<glyph unicode="&#xe023;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -171 121.5 -292.5t292.5 -121.5t292.5 121.5t121.5 292.5t-121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM500 500v400h100 v-300h200v-100h-300z" />
-<glyph unicode="&#xe024;" d="M-100 0l431 1200h209l-21 -300h162l-20 300h208l431 -1200h-538l-41 400h-242l-40 -400h-539zM488 500h224l-27 300h-170z" />
-<glyph unicode="&#xe025;" d="M0 0v400h490l-290 300h200v500h300v-500h200l-290 -300h490v-400h-1100zM813 200h175v100h-175v-100z" />
-<glyph unicode="&#xe026;" d="M1 600q0 122 47.5 233t127.5 191t191 127.5t233 47.5t233 -47.5t191 -127.5t127.5 -191t47.5 -233t-47.5 -233t-127.5 -191t-191 -127.5t-233 -47.5t-233 47.5t-191 127.5t-127.5 191t-47.5 233zM188 600q0 -170 121 -291t291 -121t291 121t121 291t-121 291t-291 121 t-291 -121t-121 -291zM350 600h150v300h200v-300h150l-250 -300z" />
-<glyph unicode="&#xe027;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -171 121.5 -292.5t292.5 -121.5t292.5 121.5t121.5 292.5t-121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM350 600l250 300 l250 -300h-150v-300h-200v300h-150z" />
-<glyph unicode="&#xe028;" d="M0 25v475l200 700h800l199 -700l1 -475q0 -11 -7 -18t-18 -7h-1150q-11 0 -18 7t-7 18zM200 500h200l50 -200h300l50 200h200l-97 500h-606z" />
-<glyph unicode="&#xe029;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -172 121.5 -293t292.5 -121t292.5 121t121.5 293q0 171 -121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM500 397v401 l297 -200z" />
-<glyph unicode="&#xe030;" d="M23 600q0 -118 45.5 -224.5t123 -184t184 -123t224.5 -45.5t224.5 45.5t184 123t123 184t45.5 224.5h-150q0 -177 -125 -302t-302 -125t-302 125t-125 302t125 302t302 125q136 0 246 -81l-146 -146h400v400l-145 -145q-157 122 -355 122q-118 0 -224.5 -45.5t-184 -123 t-123 -184t-45.5 -224.5z" />
-<glyph unicode="&#xe031;" d="M23 600q0 118 45.5 224.5t123 184t184 123t224.5 45.5q198 0 355 -122l145 145v-400h-400l147 147q-112 80 -247 80q-177 0 -302 -125t-125 -302h-150zM100 0v400h400l-147 -147q112 -80 247 -80q177 0 302 125t125 302h150q0 -118 -45.5 -224.5t-123 -184t-184 -123 t-224.5 -45.5q-198 0 -355 122z" />
-<glyph unicode="&#xe032;" d="M100 0h1100v1200h-1100v-1200zM200 100v900h900v-900h-900zM300 200v100h100v-100h-100zM300 400v100h100v-100h-100zM300 600v100h100v-100h-100zM300 800v100h100v-100h-100zM500 200h500v100h-500v-100zM500 400v100h500v-100h-500zM500 600v100h500v-100h-500z M500 800v100h500v-100h-500z" />
-<glyph unicode="&#xe033;" d="M0 100v600q0 41 29.5 70.5t70.5 29.5h100v200q0 82 59 141t141 59h300q82 0 141 -59t59 -141v-200h100q41 0 70.5 -29.5t29.5 -70.5v-600q0 -41 -29.5 -70.5t-70.5 -29.5h-900q-41 0 -70.5 29.5t-29.5 70.5zM400 800h300v150q0 21 -14.5 35.5t-35.5 14.5h-200 q-21 0 -35.5 -14.5t-14.5 -35.5v-150z" />
-<glyph unicode="&#xe034;" d="M100 0v1100h100v-1100h-100zM300 400q60 60 127.5 84t127.5 17.5t122 -23t119 -30t110 -11t103 42t91 120.5v500q-40 -81 -101.5 -115.5t-127.5 -29.5t-138 25t-139.5 40t-125.5 25t-103 -29.5t-65 -115.5v-500z" />
-<glyph unicode="&#xe035;" d="M0 275q0 -11 7 -18t18 -7h50q11 0 18 7t7 18v300q0 127 70.5 231.5t184.5 161.5t245 57t245 -57t184.5 -161.5t70.5 -231.5v-300q0 -11 7 -18t18 -7h50q11 0 18 7t7 18v300q0 116 -49.5 227t-131 192.5t-192.5 131t-227 49.5t-227 -49.5t-192.5 -131t-131 -192.5 t-49.5 -227v-300zM200 20v460q0 8 6 14t14 6h160q8 0 14 -6t6 -14v-460q0 -8 -6 -14t-14 -6h-160q-8 0 -14 6t-6 14zM800 20v460q0 8 6 14t14 6h160q8 0 14 -6t6 -14v-460q0 -8 -6 -14t-14 -6h-160q-8 0 -14 6t-6 14z" />
-<glyph unicode="&#xe036;" d="M0 400h300l300 -200v800l-300 -200h-300v-400zM688 459l141 141l-141 141l71 71l141 -141l141 141l71 -71l-141 -141l141 -141l-71 -71l-141 141l-141 -141z" />
-<glyph unicode="&#xe037;" d="M0 400h300l300 -200v800l-300 -200h-300v-400zM700 857l69 53q111 -135 111 -310q0 -169 -106 -302l-67 54q86 110 86 248q0 146 -93 257z" />
-<glyph unicode="&#xe038;" d="M0 401v400h300l300 200v-800l-300 200h-300zM702 858l69 53q111 -135 111 -310q0 -170 -106 -303l-67 55q86 110 86 248q0 145 -93 257zM889 951l7 -8q123 -151 123 -344q0 -189 -119 -339l-7 -8l81 -66l6 8q142 178 142 405q0 230 -144 408l-6 8z" />
-<glyph unicode="&#xe039;" d="M0 0h500v500h-200v100h-100v-100h-200v-500zM0 600h100v100h400v100h100v100h-100v300h-500v-600zM100 100v300h300v-300h-300zM100 800v300h300v-300h-300zM200 200v100h100v-100h-100zM200 900h100v100h-100v-100zM500 500v100h300v-300h200v-100h-100v-100h-200v100 h-100v100h100v200h-200zM600 0v100h100v-100h-100zM600 1000h100v-300h200v-300h300v200h-200v100h200v500h-600v-200zM800 800v300h300v-300h-300zM900 0v100h300v-100h-300zM900 900v100h100v-100h-100zM1100 200v100h100v-100h-100z" />
-<glyph unicode="&#xe040;" d="M0 200h100v1000h-100v-1000zM100 0v100h300v-100h-300zM200 200v1000h100v-1000h-100zM500 0v91h100v-91h-100zM500 200v1000h200v-1000h-200zM700 0v91h100v-91h-100zM800 200v1000h100v-1000h-100zM900 0v91h200v-91h-200zM1000 200v1000h200v-1000h-200z" />
-<glyph unicode="&#xe041;" d="M0 700l1 475q0 10 7.5 17.5t17.5 7.5h474l700 -700l-500 -500zM148 953q0 -42 29 -71q30 -30 71.5 -30t71.5 30q29 29 29 71t-29 71q-30 30 -71.5 30t-71.5 -30q-29 -29 -29 -71z" />
-<glyph unicode="&#xe042;" d="M1 700l1 475q0 11 7 18t18 7h474l700 -700l-500 -500zM148 953q0 -42 30 -71q29 -30 71 -30t71 30q30 29 30 71t-30 71q-29 30 -71 30t-71 -30q-30 -29 -30 -71zM701 1200h100l700 -700l-500 -500l-50 50l450 450z" />
-<glyph unicode="&#xe043;" d="M100 0v1025l175 175h925v-1000l-100 -100v1000h-750l-100 -100h750v-1000h-900z" />
-<glyph unicode="&#xe044;" d="M200 0l450 444l450 -443v1150q0 20 -14.5 35t-35.5 15h-800q-21 0 -35.5 -15t-14.5 -35v-1151z" />
-<glyph unicode="&#xe045;" d="M0 100v700h200l100 -200h600l100 200h200v-700h-200v200h-800v-200h-200zM253 829l40 -124h592l62 124l-94 346q-2 11 -10 18t-18 7h-450q-10 0 -18 -7t-10 -18zM281 24l38 152q2 10 11.5 17t19.5 7h500q10 0 19.5 -7t11.5 -17l38 -152q2 -10 -3.5 -17t-15.5 -7h-600 q-10 0 -15.5 7t-3.5 17z" />
-<glyph unicode="&#xe046;" d="M0 200q0 -41 29.5 -70.5t70.5 -29.5h1000q41 0 70.5 29.5t29.5 70.5v600q0 41 -29.5 70.5t-70.5 29.5h-150q-4 8 -11.5 21.5t-33 48t-53 61t-69 48t-83.5 21.5h-200q-41 0 -82 -20.5t-70 -50t-52 -59t-34 -50.5l-12 -20h-150q-41 0 -70.5 -29.5t-29.5 -70.5v-600z M356 500q0 100 72 172t172 72t172 -72t72 -172t-72 -172t-172 -72t-172 72t-72 172zM494 500q0 -44 31 -75t75 -31t75 31t31 75t-31 75t-75 31t-75 -31t-31 -75zM900 700v100h100v-100h-100z" />
-<glyph unicode="&#xe047;" d="M53 0h365v66q-41 0 -72 11t-49 38t1 71l92 234h391l82 -222q16 -45 -5.5 -88.5t-74.5 -43.5v-66h417v66q-34 1 -74 43q-18 19 -33 42t-21 37l-6 13l-385 998h-93l-399 -1006q-24 -48 -52 -75q-12 -12 -33 -25t-36 -20l-15 -7v-66zM416 521l178 457l46 -140l116 -317h-340 z" />
-<glyph unicode="&#xe048;" d="M100 0v89q41 7 70.5 32.5t29.5 65.5v827q0 28 -1 39.5t-5.5 26t-15.5 21t-29 14t-49 14.5v71l471 -1q120 0 213 -88t93 -228q0 -55 -11.5 -101.5t-28 -74t-33.5 -47.5t-28 -28l-12 -7q8 -3 21.5 -9t48 -31.5t60.5 -58t47.5 -91.5t21.5 -129q0 -84 -59 -156.5t-142 -111 t-162 -38.5h-500zM400 200h161q89 0 153 48.5t64 132.5q0 90 -62.5 154.5t-156.5 64.5h-159v-400zM400 700h139q76 0 130 61.5t54 138.5q0 82 -84 130.5t-239 48.5v-379z" />
-<glyph unicode="&#xe049;" d="M200 0v57q77 7 134.5 40.5t65.5 80.5l173 849q10 56 -10 74t-91 37q-6 1 -10.5 2.5t-9.5 2.5v57h425l2 -57q-33 -8 -62 -25.5t-46 -37t-29.5 -38t-17.5 -30.5l-5 -12l-128 -825q-10 -52 14 -82t95 -36v-57h-500z" />
-<glyph unicode="&#xe050;" d="M-75 200h75v800h-75l125 167l125 -167h-75v-800h75l-125 -167zM300 900v300h150h700h150v-300h-50q0 29 -8 48.5t-18.5 30t-33.5 15t-39.5 5.5t-50.5 1h-200v-850l100 -50v-100h-400v100l100 50v850h-200q-34 0 -50.5 -1t-40 -5.5t-33.5 -15t-18.5 -30t-8.5 -48.5h-49z " />
-<glyph unicode="&#xe051;" d="M33 51l167 125v-75h800v75l167 -125l-167 -125v75h-800v-75zM100 901v300h150h700h150v-300h-50q0 29 -8 48.5t-18 30t-33.5 15t-40 5.5t-50.5 1h-200v-650l100 -50v-100h-400v100l100 50v650h-200q-34 0 -50.5 -1t-39.5 -5.5t-33.5 -15t-18.5 -30t-8 -48.5h-50z" />
-<glyph unicode="&#xe052;" d="M0 50q0 -20 14.5 -35t35.5 -15h1100q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-1100q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM0 350q0 -20 14.5 -35t35.5 -15h800q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-800q-21 0 -35.5 -14.5t-14.5 -35.5 v-100zM0 650q0 -20 14.5 -35t35.5 -15h1000q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-1000q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM0 950q0 -20 14.5 -35t35.5 -15h600q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-600q-21 0 -35.5 -14.5 t-14.5 -35.5v-100z" />
-<glyph unicode="&#xe053;" d="M0 50q0 -20 14.5 -35t35.5 -15h1100q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-1100q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM0 650q0 -20 14.5 -35t35.5 -15h1100q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-1100q-21 0 -35.5 -14.5t-14.5 -35.5 v-100zM200 350q0 -20 14.5 -35t35.5 -15h700q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-700q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM200 950q0 -20 14.5 -35t35.5 -15h700q21 0 35.5 15t14.5 35v100q0 21 -14.5 35.5t-35.5 14.5h-700q-21 0 -35.5 -14.5 t-14.5 -35.5v-100z" />
-<glyph unicode="&#xe054;" d="M0 50v100q0 21 14.5 35.5t35.5 14.5h1100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-1100q-21 0 -35.5 15t-14.5 35zM100 650v100q0 21 14.5 35.5t35.5 14.5h1000q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-1000q-21 0 -35.5 15 t-14.5 35zM300 350v100q0 21 14.5 35.5t35.5 14.5h800q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-800q-21 0 -35.5 15t-14.5 35zM500 950v100q0 21 14.5 35.5t35.5 14.5h600q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-600 q-21 0 -35.5 15t-14.5 35z" />
-<glyph unicode="&#xe055;" d="M0 50v100q0 21 14.5 35.5t35.5 14.5h1100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-1100q-21 0 -35.5 15t-14.5 35zM0 350v100q0 21 14.5 35.5t35.5 14.5h1100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-1100q-21 0 -35.5 15 t-14.5 35zM0 650v100q0 21 14.5 35.5t35.5 14.5h1100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-1100q-21 0 -35.5 15t-14.5 35zM0 950v100q0 21 14.5 35.5t35.5 14.5h1100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-1100 q-21 0 -35.5 15t-14.5 35z" />
-<glyph unicode="&#xe056;" d="M0 50v100q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-100q-21 0 -35.5 15t-14.5 35zM0 350v100q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-100q-21 0 -35.5 15 t-14.5 35zM0 650v100q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-100q-21 0 -35.5 15t-14.5 35zM0 950v100q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-100q-21 0 -35.5 15 t-14.5 35zM300 50v100q0 21 14.5 35.5t35.5 14.5h800q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-800q-21 0 -35.5 15t-14.5 35zM300 350v100q0 21 14.5 35.5t35.5 14.5h800q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-800 q-21 0 -35.5 15t-14.5 35zM300 650v100q0 21 14.5 35.5t35.5 14.5h800q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15h-800q-21 0 -35.5 15t-14.5 35zM300 950v100q0 21 14.5 35.5t35.5 14.5h800q21 0 35.5 -14.5t14.5 -35.5v-100q0 -20 -14.5 -35t-35.5 -15 h-800q-21 0 -35.5 15t-14.5 35z" />
-<glyph unicode="&#xe057;" d="M-101 500v100h201v75l166 -125l-166 -125v75h-201zM300 0h100v1100h-100v-1100zM500 50q0 -20 14.5 -35t35.5 -15h600q20 0 35 15t15 35v100q0 21 -15 35.5t-35 14.5h-600q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM500 350q0 -20 14.5 -35t35.5 -15h300q20 0 35 15t15 35 v100q0 21 -15 35.5t-35 14.5h-300q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM500 650q0 -20 14.5 -35t35.5 -15h500q20 0 35 15t15 35v100q0 21 -15 35.5t-35 14.5h-500q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM500 950q0 -20 14.5 -35t35.5 -15h100q20 0 35 15t15 35v100 q0 21 -15 35.5t-35 14.5h-100q-21 0 -35.5 -14.5t-14.5 -35.5v-100z" />
-<glyph unicode="&#xe058;" d="M1 50q0 -20 14.5 -35t35.5 -15h600q20 0 35 15t15 35v100q0 21 -15 35.5t-35 14.5h-600q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM1 350q0 -20 14.5 -35t35.5 -15h300q20 0 35 15t15 35v100q0 21 -15 35.5t-35 14.5h-300q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM1 650 q0 -20 14.5 -35t35.5 -15h500q20 0 35 15t15 35v100q0 21 -15 35.5t-35 14.5h-500q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM1 950q0 -20 14.5 -35t35.5 -15h100q20 0 35 15t15 35v100q0 21 -15 35.5t-35 14.5h-100q-21 0 -35.5 -14.5t-14.5 -35.5v-100zM801 0v1100h100v-1100 h-100zM934 550l167 -125v75h200v100h-200v75z" />
-<glyph unicode="&#xe059;" d="M0 275v650q0 31 22 53t53 22h750q31 0 53 -22t22 -53v-650q0 -31 -22 -53t-53 -22h-750q-31 0 -53 22t-22 53zM900 600l300 300v-600z" />
-<glyph unicode="&#xe060;" d="M0 44v1012q0 18 13 31t31 13h1112q19 0 31.5 -13t12.5 -31v-1012q0 -18 -12.5 -31t-31.5 -13h-1112q-18 0 -31 13t-13 31zM100 263l247 182l298 -131l-74 156l293 318l236 -288v500h-1000v-737zM208 750q0 56 39 95t95 39t95 -39t39 -95t-39 -95t-95 -39t-95 39t-39 95z " />
-<glyph unicode="&#xe062;" d="M148 745q0 124 60.5 231.5t165 172t226.5 64.5q123 0 227 -63t164.5 -169.5t60.5 -229.5t-73 -272q-73 -114 -166.5 -237t-150.5 -189l-57 -66q-10 9 -27 26t-66.5 70.5t-96 109t-104 135.5t-100.5 155q-63 139 -63 262zM342 772q0 -107 75.5 -182.5t181.5 -75.5 q107 0 182.5 75.5t75.5 182.5t-75.5 182t-182.5 75t-182 -75.5t-75 -181.5z" />
-<glyph unicode="&#xe063;" d="M1 600q0 122 47.5 233t127.5 191t191 127.5t233 47.5t233 -47.5t191 -127.5t127.5 -191t47.5 -233t-47.5 -233t-127.5 -191t-191 -127.5t-233 -47.5t-233 47.5t-191 127.5t-127.5 191t-47.5 233zM173 600q0 -177 125.5 -302t301.5 -125v854q-176 0 -301.5 -125 t-125.5 -302z" />
-<glyph unicode="&#xe064;" d="M117 406q0 94 34 186t88.5 172.5t112 159t115 177t87.5 194.5q21 -71 57.5 -142.5t76 -130.5t83 -118.5t82 -117t70 -116t50 -125.5t18.5 -136q0 -89 -39 -165.5t-102 -126.5t-140 -79.5t-156 -33.5q-114 6 -211.5 53t-161.5 139t-64 210zM243 414q14 -82 59.5 -136 t136.5 -80l16 98q-7 6 -18 17t-34 48t-33 77q-15 73 -14 143.5t10 122.5l9 51q-92 -110 -119.5 -185t-12.5 -156z" />
-<glyph unicode="&#xe065;" d="M0 400v300q0 165 117.5 282.5t282.5 117.5q366 -6 397 -14l-186 -186h-311q-41 0 -70.5 -29.5t-29.5 -70.5v-500q0 -41 29.5 -70.5t70.5 -29.5h500q41 0 70.5 29.5t29.5 70.5v125l200 200v-225q0 -165 -117.5 -282.5t-282.5 -117.5h-300q-165 0 -282.5 117.5 t-117.5 282.5zM436 341l161 50l412 412l-114 113l-405 -405zM995 1015l113 -113l113 113l-21 85l-92 28z" />
-<glyph unicode="&#xe066;" d="M0 400v300q0 165 117.5 282.5t282.5 117.5h261l2 -80q-133 -32 -218 -120h-145q-41 0 -70.5 -29.5t-29.5 -70.5v-500q0 -41 29.5 -70.5t70.5 -29.5h500q41 0 70.5 29.5t29.5 70.5l200 153v-53q0 -165 -117.5 -282.5t-282.5 -117.5h-300q-165 0 -282.5 117.5t-117.5 282.5 zM423 524q30 38 81.5 64t103 35.5t99 14t77.5 3.5l29 -1v-209l360 324l-359 318v-216q-7 0 -19 -1t-48 -8t-69.5 -18.5t-76.5 -37t-76.5 -59t-62 -88t-39.5 -121.5z" />
-<glyph unicode="&#xe067;" d="M0 400v300q0 165 117.5 282.5t282.5 117.5h300q61 0 127 -23l-178 -177h-349q-41 0 -70.5 -29.5t-29.5 -70.5v-500q0 -41 29.5 -70.5t70.5 -29.5h500q41 0 70.5 29.5t29.5 70.5v69l200 200v-169q0 -165 -117.5 -282.5t-282.5 -117.5h-300q-165 0 -282.5 117.5 t-117.5 282.5zM342 632l283 -284l567 567l-137 137l-430 -431l-146 147z" />
-<glyph unicode="&#xe068;" d="M0 603l300 296v-198h200v200h-200l300 300l295 -300h-195v-200h200v198l300 -296l-300 -300v198h-200v-200h195l-295 -300l-300 300h200v200h-200v-198z" />
-<glyph unicode="&#xe069;" d="M200 50v1000q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-437l500 487v-1100l-500 488v-438q0 -21 -14.5 -35.5t-35.5 -14.5h-100q-21 0 -35.5 14.5t-14.5 35.5z" />
-<glyph unicode="&#xe070;" d="M0 50v1000q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-437l500 487v-487l500 487v-1100l-500 488v-488l-500 488v-438q0 -21 -14.5 -35.5t-35.5 -14.5h-100q-21 0 -35.5 14.5t-14.5 35.5z" />
-<glyph unicode="&#xe071;" d="M136 550l564 550v-487l500 487v-1100l-500 488v-488z" />
-<glyph unicode="&#xe072;" d="M200 0l900 550l-900 550v-1100z" />
-<glyph unicode="&#xe073;" d="M200 150q0 -21 14.5 -35.5t35.5 -14.5h200q21 0 35.5 14.5t14.5 35.5v800q0 21 -14.5 35.5t-35.5 14.5h-200q-21 0 -35.5 -14.5t-14.5 -35.5v-800zM600 150q0 -21 14.5 -35.5t35.5 -14.5h200q21 0 35.5 14.5t14.5 35.5v800q0 21 -14.5 35.5t-35.5 14.5h-200 q-21 0 -35.5 -14.5t-14.5 -35.5v-800z" />
-<glyph unicode="&#xe074;" d="M200 150q0 -20 14.5 -35t35.5 -15h800q21 0 35.5 15t14.5 35v800q0 21 -14.5 35.5t-35.5 14.5h-800q-21 0 -35.5 -14.5t-14.5 -35.5v-800z" />
-<glyph unicode="&#xe075;" d="M0 0v1100l500 -487v487l564 -550l-564 -550v488z" />
-<glyph unicode="&#xe076;" d="M0 0v1100l500 -487v487l500 -487v437q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-1000q0 -21 -14.5 -35.5t-35.5 -14.5h-100q-21 0 -35.5 14.5t-14.5 35.5v438l-500 -488v488z" />
-<glyph unicode="&#xe077;" d="M300 0v1100l500 -487v437q0 21 14.5 35.5t35.5 14.5h100q21 0 35.5 -14.5t14.5 -35.5v-1000q0 -21 -14.5 -35.5t-35.5 -14.5h-100q-21 0 -35.5 14.5t-14.5 35.5v438z" />
-<glyph unicode="&#xe078;" d="M100 250v100q0 21 14.5 35.5t35.5 14.5h1000q21 0 35.5 -14.5t14.5 -35.5v-100q0 -21 -14.5 -35.5t-35.5 -14.5h-1000q-21 0 -35.5 14.5t-14.5 35.5zM100 500h1100l-550 564z" />
-<glyph unicode="&#xe079;" d="M185 599l592 -592l240 240l-353 353l353 353l-240 240z" />
-<glyph unicode="&#xe080;" d="M272 194l353 353l-353 353l241 240l572 -571l21 -22l-1 -1v-1l-592 -591z" />
-<glyph unicode="&#xe081;" d="M3 600q0 162 80 299.5t217.5 217.5t299.5 80t299.5 -80t217.5 -217.5t80 -299.5t-80 -299.5t-217.5 -217.5t-299.5 -80t-299.5 80t-217.5 217.5t-80 299.5zM300 500h200v-200h200v200h200v200h-200v200h-200v-200h-200v-200z" />
-<glyph unicode="&#xe082;" d="M3 600q0 162 80 299.5t217.5 217.5t299.5 80t299.5 -80t217.5 -217.5t80 -299.5t-80 -299.5t-217.5 -217.5t-299.5 -80t-299.5 80t-217.5 217.5t-80 299.5zM300 500h600v200h-600v-200z" />
-<glyph unicode="&#xe083;" d="M3 600q0 162 80 299.5t217.5 217.5t299.5 80t299.5 -80t217.5 -217.5t80 -299.5t-80 -299.5t-217.5 -217.5t-299.5 -80t-299.5 80t-217.5 217.5t-80 299.5zM246 459l213 -213l141 142l141 -142l213 213l-142 141l142 141l-213 212l-141 -141l-141 142l-212 -213l141 -141 z" />
-<glyph unicode="&#xe084;" d="M3 600q0 162 80 299.5t217.5 217.5t299.5 80t299.5 -80t217.5 -217.5t80 -299.5t-80 -299.5t-217.5 -217.5t-299.5 -80t-299.5 80t-217.5 217.5t-80 299.5zM270 551l276 -277l411 411l-175 174l-236 -236l-102 102z" />
-<glyph unicode="&#xe085;" d="M3 600q0 162 80 299.5t217.5 217.5t299.5 80t299.5 -80t217.5 -217.5t80 -299.5t-80 -299.5t-217.5 -217.5t-299.5 -80t-299.5 80t-217.5 217.5t-80 299.5zM364 700h143q4 0 11.5 -1t11 -1t6.5 3t3 9t1 11t3.5 8.5t3.5 6t5.5 4t6.5 2.5t9 1.5t9 0.5h11.5h12.5 q19 0 30 -10t11 -26q0 -22 -4 -28t-27 -22q-5 -1 -12.5 -3t-27 -13.5t-34 -27t-26.5 -46t-11 -68.5h200q5 3 14 8t31.5 25.5t39.5 45.5t31 69t14 94q0 51 -17.5 89t-42 58t-58.5 32t-58.5 15t-51.5 3q-50 0 -90.5 -12t-75 -38.5t-53.5 -74.5t-19 -114zM500 300h200v100h-200 v-100z" />
-<glyph unicode="&#xe086;" d="M3 600q0 162 80 299.5t217.5 217.5t299.5 80t299.5 -80t217.5 -217.5t80 -299.5t-80 -299.5t-217.5 -217.5t-299.5 -80t-299.5 80t-217.5 217.5t-80 299.5zM400 300h400v100h-100v300h-300v-100h100v-200h-100v-100zM500 800h200v100h-200v-100z" />
-<glyph unicode="&#xe087;" d="M0 500v200h195q31 125 98.5 199.5t206.5 100.5v200h200v-200q54 -20 113 -60t112.5 -105.5t71.5 -134.5h203v-200h-203q-25 -102 -116.5 -186t-180.5 -117v-197h-200v197q-140 27 -208 102.5t-98 200.5h-194zM290 500q24 -73 79.5 -127.5t130.5 -78.5v206h200v-206 q149 48 201 206h-201v200h200q-25 74 -75.5 127t-124.5 77v-204h-200v203q-75 -23 -130 -77t-79 -126h209v-200h-210z" />
-<glyph unicode="&#xe088;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -171 121.5 -292.5t292.5 -121.5t292.5 121.5t121.5 292.5t-121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM356 465l135 135 l-135 135l109 109l135 -135l135 135l109 -109l-135 -135l135 -135l-109 -109l-135 135l-135 -135z" />
-<glyph unicode="&#xe089;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -171 121.5 -292.5t292.5 -121.5t292.5 121.5t121.5 292.5t-121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM322 537l141 141 l87 -87l204 205l142 -142l-346 -345z" />
-<glyph unicode="&#xe090;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -115 62 -215l568 567q-100 62 -216 62q-171 0 -292.5 -121.5t-121.5 -292.5zM391 245q97 -59 209 -59q171 0 292.5 121.5t121.5 292.5 q0 112 -59 209z" />
-<glyph unicode="&#xe091;" d="M0 547l600 453v-300h600v-300h-600v-301z" />
-<glyph unicode="&#xe092;" d="M0 400v300h600v300l600 -453l-600 -448v301h-600z" />
-<glyph unicode="&#xe093;" d="M204 600l450 600l444 -600h-298v-600h-300v600h-296z" />
-<glyph unicode="&#xe094;" d="M104 600h296v600h300v-600h298l-449 -600z" />
-<glyph unicode="&#xe095;" d="M0 200q6 132 41 238.5t103.5 193t184 138t271.5 59.5v271l600 -453l-600 -448v301q-95 -2 -183 -20t-170 -52t-147 -92.5t-100 -135.5z" />
-<glyph unicode="&#xe096;" d="M0 0v400l129 -129l294 294l142 -142l-294 -294l129 -129h-400zM635 777l142 -142l294 294l129 -129v400h-400l129 -129z" />
-<glyph unicode="&#xe097;" d="M34 176l295 295l-129 129h400v-400l-129 130l-295 -295zM600 600v400l129 -129l295 295l142 -141l-295 -295l129 -130h-400z" />
-<glyph unicode="&#xe101;" d="M23 600q0 118 45.5 224.5t123 184t184 123t224.5 45.5t224.5 -45.5t184 -123t123 -184t45.5 -224.5t-45.5 -224.5t-123 -184t-184 -123t-224.5 -45.5t-224.5 45.5t-184 123t-123 184t-45.5 224.5zM456 851l58 -302q4 -20 21.5 -34.5t37.5 -14.5h54q20 0 37.5 14.5 t21.5 34.5l58 302q4 20 -8 34.5t-32 14.5h-207q-21 0 -33 -14.5t-8 -34.5zM500 300h200v100h-200v-100z" />
-<glyph unicode="&#xe102;" d="M0 800h100v-200h400v300h200v-300h400v200h100v100h-111q1 1 1 6.5t-1.5 15t-3.5 17.5l-34 172q-11 39 -41.5 63t-69.5 24q-32 0 -61 -17l-239 -144q-22 -13 -40 -35q-19 24 -40 36l-238 144q-33 18 -62 18q-39 0 -69.5 -23t-40.5 -61l-35 -177q-2 -8 -3 -18t-1 -15v-6 h-111v-100zM100 0h400v400h-400v-400zM200 900q-3 0 14 48t36 96l18 47l213 -191h-281zM700 0v400h400v-400h-400zM731 900l202 197q5 -12 12 -32.5t23 -64t25 -72t7 -28.5h-269z" />
-<glyph unicode="&#xe103;" d="M0 -22v143l216 193q-9 53 -13 83t-5.5 94t9 113t38.5 114t74 124q47 60 99.5 102.5t103 68t127.5 48t145.5 37.5t184.5 43.5t220 58.5q0 -189 -22 -343t-59 -258t-89 -181.5t-108.5 -120t-122 -68t-125.5 -30t-121.5 -1.5t-107.5 12.5t-87.5 17t-56.5 7.5l-99 -55z M238.5 300.5q19.5 -6.5 86.5 76.5q55 66 367 234q70 38 118.5 69.5t102 79t99 111.5t86.5 148q22 50 24 60t-6 19q-7 5 -17 5t-26.5 -14.5t-33.5 -39.5q-35 -51 -113.5 -108.5t-139.5 -89.5l-61 -32q-369 -197 -458 -401q-48 -111 -28.5 -117.5z" />
-<glyph unicode="&#xe104;" d="M111 408q0 -33 5 -63q9 -56 44 -119.5t105 -108.5q31 -21 64 -16t62 23.5t57 49.5t48 61.5t35 60.5q32 66 39 184.5t-13 157.5q79 -80 122 -164t26 -184q-5 -33 -20.5 -69.5t-37.5 -80.5q-10 -19 -14.5 -29t-12 -26t-9 -23.5t-3 -19t2.5 -15.5t11 -9.5t19.5 -5t30.5 2.5 t42 8q57 20 91 34t87.5 44.5t87 64t65.5 88.5t47 122q38 172 -44.5 341.5t-246.5 278.5q22 -44 43 -129q39 -159 -32 -154q-15 2 -33 9q-79 33 -120.5 100t-44 175.5t48.5 257.5q-13 -8 -34 -23.5t-72.5 -66.5t-88.5 -105.5t-60 -138t-8 -166.5q2 -12 8 -41.5t8 -43t6 -39.5 t3.5 -39.5t-1 -33.5t-6 -31.5t-13.5 -24t-21 -20.5t-31 -12q-38 -10 -67 13t-40.5 61.5t-15 81.5t10.5 75q-52 -46 -83.5 -101t-39 -107t-7.5 -85z" />
-<glyph unicode="&#xe105;" d="M-61 600l26 40q6 10 20 30t49 63.5t74.5 85.5t97 90t116.5 83.5t132.5 59t145.5 23.5t145.5 -23.5t132.5 -59t116.5 -83.5t97 -90t74.5 -85.5t49 -63.5t20 -30l26 -40l-26 -40q-6 -10 -20 -30t-49 -63.5t-74.5 -85.5t-97 -90t-116.5 -83.5t-132.5 -59t-145.5 -23.5 t-145.5 23.5t-132.5 59t-116.5 83.5t-97 90t-74.5 85.5t-49 63.5t-20 30zM120 600q7 -10 40.5 -58t56 -78.5t68 -77.5t87.5 -75t103 -49.5t125 -21.5t123.5 20t100.5 45.5t85.5 71.5t66.5 75.5t58 81.5t47 66q-1 1 -28.5 37.5t-42 55t-43.5 53t-57.5 63.5t-58.5 54 q49 -74 49 -163q0 -124 -88 -212t-212 -88t-212 88t-88 212q0 85 46 158q-102 -87 -226 -258zM377 656q49 -124 154 -191l105 105q-37 24 -75 72t-57 84l-20 36z" />
-<glyph unicode="&#xe106;" d="M-61 600l26 40q6 10 20 30t49 63.5t74.5 85.5t97 90t116.5 83.5t132.5 59t145.5 23.5q61 0 121 -17l37 142h148l-314 -1200h-148l37 143q-82 21 -165 71.5t-140 102t-109.5 112t-72 88.5t-29.5 43zM120 600q210 -282 393 -336l37 141q-107 18 -178.5 101.5t-71.5 193.5 q0 85 46 158q-102 -87 -226 -258zM377 656q49 -124 154 -191l47 47l23 87q-30 28 -59 69t-44 68l-14 26zM780 161l38 145q22 15 44.5 34t46 44t40.5 44t41 50.5t33.5 43.5t33 44t24.5 34q-97 127 -140 175l39 146q67 -54 131.5 -125.5t87.5 -103.5t36 -52l26 -40l-26 -40 q-7 -12 -25.5 -38t-63.5 -79.5t-95.5 -102.5t-124 -100t-146.5 -79z" />
-<glyph unicode="&#xe107;" d="M-97.5 34q13.5 -34 50.5 -34h1294q37 0 50.5 35.5t-7.5 67.5l-642 1056q-20 34 -48 36.5t-48 -29.5l-642 -1066q-21 -32 -7.5 -66zM155 200l445 723l445 -723h-345v100h-200v-100h-345zM500 600l100 -300l100 300v100h-200v-100z" />
-<glyph unicode="&#xe108;" d="M100 262v41q0 20 11 44.5t26 38.5l363 325v339q0 62 44 106t106 44t106 -44t44 -106v-339l363 -325q15 -14 26 -38.5t11 -44.5v-41q0 -20 -12 -26.5t-29 5.5l-359 249v-263q100 -91 100 -113v-64q0 -20 -13 -28.5t-32 0.5l-94 78h-222l-94 -78q-19 -9 -32 -0.5t-13 28.5 v64q0 22 100 113v263l-359 -249q-17 -12 -29 -5.5t-12 26.5z" />
-<glyph unicode="&#xe109;" d="M0 50q0 -20 14.5 -35t35.5 -15h1000q21 0 35.5 15t14.5 35v750h-1100v-750zM0 900h1100v150q0 21 -14.5 35.5t-35.5 14.5h-150v100h-100v-100h-500v100h-100v-100h-150q-21 0 -35.5 -14.5t-14.5 -35.5v-150zM100 100v100h100v-100h-100zM100 300v100h100v-100h-100z M100 500v100h100v-100h-100zM300 100v100h100v-100h-100zM300 300v100h100v-100h-100zM300 500v100h100v-100h-100zM500 100v100h100v-100h-100zM500 300v100h100v-100h-100zM500 500v100h100v-100h-100zM700 100v100h100v-100h-100zM700 300v100h100v-100h-100zM700 500 v100h100v-100h-100zM900 100v100h100v-100h-100zM900 300v100h100v-100h-100zM900 500v100h100v-100h-100z" />
-<glyph unicode="&#xe110;" d="M0 200v200h259l600 600h241v198l300 -295l-300 -300v197h-159l-600 -600h-341zM0 800h259l122 -122l141 142l-181 180h-341v-200zM678 381l141 142l122 -123h159v198l300 -295l-300 -300v197h-241z" />
-<glyph unicode="&#xe111;" d="M0 400v600q0 41 29.5 70.5t70.5 29.5h1000q41 0 70.5 -29.5t29.5 -70.5v-600q0 -41 -29.5 -70.5t-70.5 -29.5h-596l-304 -300v300h-100q-41 0 -70.5 29.5t-29.5 70.5z" />
-<glyph unicode="&#xe112;" d="M100 600v200h300v-250q0 -113 6 -145q17 -92 102 -117q39 -11 92 -11q37 0 66.5 5.5t50 15.5t36 24t24 31.5t14 37.5t7 42t2.5 45t0 47v25v250h300v-200q0 -42 -3 -83t-15 -104t-31.5 -116t-58 -109.5t-89 -96.5t-129 -65.5t-174.5 -25.5t-174.5 25.5t-129 65.5t-89 96.5 t-58 109.5t-31.5 116t-15 104t-3 83zM100 900v300h300v-300h-300zM800 900v300h300v-300h-300z" />
-<glyph unicode="&#xe113;" d="M-30 411l227 -227l352 353l353 -353l226 227l-578 579z" />
-<glyph unicode="&#xe114;" d="M70 797l580 -579l578 579l-226 227l-353 -353l-352 353z" />
-<glyph unicode="&#xe115;" d="M-198 700l299 283l300 -283h-203v-400h385l215 -200h-800v600h-196zM402 1000l215 -200h381v-400h-198l299 -283l299 283h-200v600h-796z" />
-<glyph unicode="&#xe116;" d="M18 939q-5 24 10 42q14 19 39 19h896l38 162q5 17 18.5 27.5t30.5 10.5h94q20 0 35 -14.5t15 -35.5t-15 -35.5t-35 -14.5h-54l-201 -961q-2 -4 -6 -10.5t-19 -17.5t-33 -11h-31v-50q0 -20 -14.5 -35t-35.5 -15t-35.5 15t-14.5 35v50h-300v-50q0 -20 -14.5 -35t-35.5 -15 t-35.5 15t-14.5 35v50h-50q-21 0 -35.5 15t-14.5 35q0 21 14.5 35.5t35.5 14.5h535l48 200h-633q-32 0 -54.5 21t-27.5 43z" />
-<glyph unicode="&#xe117;" d="M0 0v800h1200v-800h-1200zM0 900v100h200q0 41 29.5 70.5t70.5 29.5h300q41 0 70.5 -29.5t29.5 -70.5h500v-100h-1200z" />
-<glyph unicode="&#xe118;" d="M1 0l300 700h1200l-300 -700h-1200zM1 400v600h200q0 41 29.5 70.5t70.5 29.5h300q41 0 70.5 -29.5t29.5 -70.5h500v-200h-1000z" />
-<glyph unicode="&#xe119;" d="M302 300h198v600h-198l298 300l298 -300h-198v-600h198l-298 -300z" />
-<glyph unicode="&#xe120;" d="M0 600l300 298v-198h600v198l300 -298l-300 -297v197h-600v-197z" />
-<glyph unicode="&#xe121;" d="M0 100v100q0 41 29.5 70.5t70.5 29.5h1000q41 0 70.5 -29.5t29.5 -70.5v-100q0 -41 -29.5 -70.5t-70.5 -29.5h-1000q-41 0 -70.5 29.5t-29.5 70.5zM31 400l172 739q5 22 23 41.5t38 19.5h672q19 0 37.5 -22.5t23.5 -45.5l172 -732h-1138zM800 100h100v100h-100v-100z M1000 100h100v100h-100v-100z" />
-<glyph unicode="&#xe122;" d="M-101 600v50q0 24 25 49t50 38l25 13v-250l-11 5.5t-24 14t-30 21.5t-24 27.5t-11 31.5zM100 500v250v8v8v7t0.5 7t1.5 5.5t2 5t3 4t4.5 3.5t6 1.5t7.5 0.5h200l675 250v-850l-675 200h-38l47 -276q2 -12 -3 -17.5t-11 -6t-21 -0.5h-8h-83q-20 0 -34.5 14t-18.5 35 q-55 337 -55 351zM1100 200v850q0 21 14.5 35.5t35.5 14.5q20 0 35 -14.5t15 -35.5v-850q0 -20 -15 -35t-35 -15q-21 0 -35.5 15t-14.5 35z" />
-<glyph unicode="&#xe123;" d="M74 350q0 21 13.5 35.5t33.5 14.5h18l117 173l63 327q15 77 76 140t144 83l-18 32q-6 19 3 32t29 13h94q20 0 29 -10.5t3 -29.5q-18 -36 -18 -37q83 -19 144 -82.5t76 -140.5l63 -327l118 -173h17q20 0 33.5 -14.5t13.5 -35.5q0 -20 -13 -40t-31 -27q-8 -3 -23 -8.5 t-65 -20t-103 -25t-132.5 -19.5t-158.5 -9q-125 0 -245.5 20.5t-178.5 40.5l-58 20q-18 7 -31 27.5t-13 40.5zM497 110q12 -49 40 -79.5t63 -30.5t63 30.5t39 79.5q-48 -6 -102 -6t-103 6z" />
-<glyph unicode="&#xe124;" d="M21 445l233 -45l-78 -224l224 78l45 -233l155 179l155 -179l45 233l224 -78l-78 224l234 45l-180 155l180 156l-234 44l78 225l-224 -78l-45 233l-155 -180l-155 180l-45 -233l-224 78l78 -225l-233 -44l179 -156z" />
-<glyph unicode="&#xe125;" d="M0 200h200v600h-200v-600zM300 275q0 -75 100 -75h61q124 -100 139 -100h250q46 0 83 57l238 344q29 31 29 74v100q0 44 -30.5 84.5t-69.5 40.5h-328q28 118 28 125v150q0 44 -30.5 84.5t-69.5 40.5h-50q-27 0 -51 -20t-38 -48l-96 -198l-145 -196q-20 -26 -20 -63v-400z M400 300v375l150 213l100 212h50v-175l-50 -225h450v-125l-250 -375h-214l-136 100h-100z" />
-<glyph unicode="&#xe126;" d="M0 400v600h200v-600h-200zM300 525v400q0 75 100 75h61q124 100 139 100h250q46 0 83 -57l238 -344q29 -31 29 -74v-100q0 -44 -30.5 -84.5t-69.5 -40.5h-328q28 -118 28 -125v-150q0 -44 -30.5 -84.5t-69.5 -40.5h-50q-27 0 -51 20t-38 48l-96 198l-145 196 q-20 26 -20 63zM400 525l150 -212l100 -213h50v175l-50 225h450v125l-250 375h-214l-136 -100h-100v-375z" />
-<glyph unicode="&#xe127;" d="M8 200v600h200v-600h-200zM308 275v525q0 17 14 35.5t28 28.5l14 9l362 230q14 6 25 6q17 0 29 -12l109 -112q14 -14 14 -34q0 -18 -11 -32l-85 -121h302q85 0 138.5 -38t53.5 -110t-54.5 -111t-138.5 -39h-107l-130 -339q-7 -22 -20.5 -41.5t-28.5 -19.5h-341 q-7 0 -90 81t-83 94zM408 289l100 -89h293l131 339q6 21 19.5 41t28.5 20h203q16 0 25 15t9 36q0 20 -9 34.5t-25 14.5h-457h-6.5h-7.5t-6.5 0.5t-6 1t-5 1.5t-5.5 2.5t-4 4t-4 5.5q-5 12 -5 20q0 14 10 27l147 183l-86 83l-339 -236v-503z" />
-<glyph unicode="&#xe128;" d="M-101 651q0 72 54 110t139 38l302 -1l-85 121q-11 16 -11 32q0 21 14 34l109 113q13 12 29 12q11 0 25 -6l365 -230q7 -4 17 -10.5t26.5 -26t16.5 -36.5v-526q0 -13 -86 -93.5t-94 -80.5h-341q-16 0 -29.5 20t-19.5 41l-130 339h-107q-84 0 -139 39t-55 111zM-1 601h222 q15 0 28.5 -20.5t19.5 -40.5l131 -339h293l107 89v502l-343 237l-87 -83l145 -184q10 -11 10 -26q0 -11 -5 -20q-1 -3 -3.5 -5.5l-4 -4t-5 -2.5t-5.5 -1.5t-6.5 -1t-6.5 -0.5h-7.5h-6.5h-476v-100zM1000 201v600h200v-600h-200z" />
-<glyph unicode="&#xe129;" d="M97 719l230 -363q4 -6 10.5 -15.5t26 -25t36.5 -15.5h525q13 0 94 83t81 90v342q0 15 -20 28.5t-41 19.5l-339 131v106q0 84 -39 139t-111 55t-110 -53.5t-38 -138.5v-302l-121 84q-15 12 -33.5 11.5t-32.5 -13.5l-112 -110q-22 -22 -6 -53zM172 739l83 86l183 -146 q22 -18 47 -5q3 1 5.5 3.5l4 4t2.5 5t1.5 5.5t1 6.5t0.5 6.5v7.5v6.5v456q0 22 25 31t50 -0.5t25 -30.5v-202q0 -16 20 -29.5t41 -19.5l339 -130v-294l-89 -100h-503zM400 0v200h600v-200h-600z" />
-<glyph unicode="&#xe130;" d="M2 585q-16 -31 6 -53l112 -110q13 -13 32 -13.5t34 10.5l121 85q0 -51 -0.5 -153.5t-0.5 -148.5q0 -84 38.5 -138t110.5 -54t111 55t39 139v106l339 131q20 6 40.5 19.5t20.5 28.5v342q0 7 -81 90t-94 83h-525q-17 0 -35.5 -14t-28.5 -28l-10 -15zM77 565l236 339h503 l89 -100v-294l-340 -130q-20 -6 -40 -20t-20 -29v-202q0 -22 -25 -31t-50 0t-25 31v456v14.5t-1.5 11.5t-5 12t-9.5 7q-24 13 -46 -5l-184 -146zM305 1104v200h600v-200h-600z" />
-<glyph unicode="&#xe131;" d="M5 597q0 122 47.5 232.5t127.5 190.5t190.5 127.5t232.5 47.5q162 0 299.5 -80t217.5 -218t80 -300t-80 -299.5t-217.5 -217.5t-299.5 -80t-300 80t-218 217.5t-80 299.5zM298 701l2 -201h300l-2 -194l402 294l-402 298v-197h-300z" />
-<glyph unicode="&#xe132;" d="M0 597q0 122 47.5 232.5t127.5 190.5t190.5 127.5t231.5 47.5q122 0 232.5 -47.5t190.5 -127.5t127.5 -190.5t47.5 -232.5q0 -162 -80 -299.5t-218 -217.5t-300 -80t-299.5 80t-217.5 217.5t-80 299.5zM200 600l402 -294l-2 194h300l2 201h-300v197z" />
-<glyph unicode="&#xe133;" d="M5 597q0 122 47.5 232.5t127.5 190.5t190.5 127.5t232.5 47.5q162 0 299.5 -80t217.5 -218t80 -300t-80 -299.5t-217.5 -217.5t-299.5 -80t-300 80t-218 217.5t-80 299.5zM300 600h200v-300h200v300h200l-300 400z" />
-<glyph unicode="&#xe134;" d="M5 597q0 122 47.5 232.5t127.5 190.5t190.5 127.5t232.5 47.5q162 0 299.5 -80t217.5 -218t80 -300t-80 -299.5t-217.5 -217.5t-299.5 -80t-300 80t-218 217.5t-80 299.5zM300 600l300 -400l300 400h-200v300h-200v-300h-200z" />
-<glyph unicode="&#xe135;" d="M5 597q0 122 47.5 232.5t127.5 190.5t190.5 127.5t232.5 47.5q121 0 231.5 -47.5t190.5 -127.5t127.5 -190.5t47.5 -232.5q0 -162 -80 -299.5t-217.5 -217.5t-299.5 -80t-300 80t-218 217.5t-80 299.5zM254 780q-8 -33 5.5 -92.5t7.5 -87.5q0 -9 17 -44t16 -60 q12 0 23 -5.5t23 -15t20 -13.5q24 -12 108 -42q22 -8 53 -31.5t59.5 -38.5t57.5 -11q8 -18 -15 -55t-20 -57q42 -71 87 -80q0 -6 -3 -15.5t-3.5 -14.5t4.5 -17q104 -3 221 112q30 29 47 47t34.5 49t20.5 62q-14 9 -37 9.5t-36 7.5q-14 7 -49 15t-52 19q-9 0 -39.5 -0.5 t-46.5 -1.5t-39 -6.5t-39 -16.5q-50 -35 -66 -12q-4 2 -3.5 25.5t0.5 25.5q-6 13 -26.5 17t-24.5 7q2 22 -2 41t-16.5 28t-38.5 -20q-23 -25 -42 4q-19 28 -8 58q6 16 22 22q6 -1 26 -1.5t33.5 -4t19.5 -13.5q12 -19 32 -37.5t34 -27.5l14 -8q0 3 9.5 39.5t5.5 57.5 q-4 23 14.5 44.5t22.5 31.5q5 14 10 35t8.5 31t15.5 22.5t34 21.5q-6 18 10 37q8 0 23.5 -1.5t24.5 -1.5t20.5 4.5t20.5 15.5q-10 23 -30.5 42.5t-38 30t-49 26.5t-43.5 23q11 39 2 44q31 -13 58 -14.5t39 3.5l11 4q7 36 -16.5 53.5t-64.5 28.5t-56 23q-19 -3 -37 0 q-15 -12 -36.5 -21t-34.5 -12t-44 -8t-39 -6q-15 -3 -45.5 0.5t-45.5 -2.5q-21 -7 -52 -26.5t-34 -34.5q-3 -11 6.5 -22.5t8.5 -18.5q-3 -34 -27.5 -90.5t-29.5 -79.5zM518 916q3 12 16 30t16 25q10 -10 18.5 -10t14 6t14.5 14.5t16 12.5q0 -24 17 -66.5t17 -43.5 q-9 2 -31 5t-36 5t-32 8t-30 14zM692 1003h1h-1z" />
-<glyph unicode="&#xe136;" d="M0 164.5q0 21.5 15 37.5l600 599q-33 101 6 201.5t135 154.5q164 92 306 -9l-259 -138l145 -232l251 126q13 -175 -151 -267q-123 -70 -253 -23l-596 -596q-15 -16 -36.5 -16t-36.5 16l-111 110q-15 15 -15 36.5z" />
-<glyph unicode="&#xe137;" horiz-adv-x="1220" d="M0 196v100q0 41 29.5 70.5t70.5 29.5h1000q41 0 70.5 -29.5t29.5 -70.5v-100q0 -41 -29.5 -70.5t-70.5 -29.5h-1000q-41 0 -70.5 29.5t-29.5 70.5zM0 596v100q0 41 29.5 70.5t70.5 29.5h1000q41 0 70.5 -29.5t29.5 -70.5v-100q0 -41 -29.5 -70.5t-70.5 -29.5h-1000 q-41 0 -70.5 29.5t-29.5 70.5zM0 996v100q0 41 29.5 70.5t70.5 29.5h1000q41 0 70.5 -29.5t29.5 -70.5v-100q0 -41 -29.5 -70.5t-70.5 -29.5h-1000q-41 0 -70.5 29.5t-29.5 70.5zM600 596h500v100h-500v-100zM800 196h300v100h-300v-100zM900 996h200v100h-200v-100z" />
-<glyph unicode="&#xe138;" d="M100 1100v100h1000v-100h-1000zM150 1000h900l-350 -500v-300l-200 -200v500z" />
-<glyph unicode="&#xe139;" d="M0 200v200h1200v-200q0 -41 -29.5 -70.5t-70.5 -29.5h-1000q-41 0 -70.5 29.5t-29.5 70.5zM0 500v400q0 41 29.5 70.5t70.5 29.5h300v100q0 41 29.5 70.5t70.5 29.5h200q41 0 70.5 -29.5t29.5 -70.5v-100h300q41 0 70.5 -29.5t29.5 -70.5v-400h-500v100h-200v-100h-500z M500 1000h200v100h-200v-100z" />
-<glyph unicode="&#xe140;" d="M0 0v400l129 -129l200 200l142 -142l-200 -200l129 -129h-400zM0 800l129 129l200 -200l142 142l-200 200l129 129h-400v-400zM729 329l142 142l200 -200l129 129v-400h-400l129 129zM729 871l200 200l-129 129h400v-400l-129 129l-200 -200z" />
-<glyph unicode="&#xe141;" d="M0 596q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM182 596q0 -172 121.5 -293t292.5 -121t292.5 121t121.5 293q0 171 -121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM291 655 q0 23 15.5 38.5t38.5 15.5t39 -16t16 -38q0 -23 -16 -39t-39 -16q-22 0 -38 16t-16 39zM400 850q0 22 16 38.5t39 16.5q22 0 38 -16t16 -39t-16 -39t-38 -16q-23 0 -39 16.5t-16 38.5zM514 609q0 32 20.5 56.5t51.5 29.5l122 126l1 1q-9 14 -9 28q0 22 16 38.5t39 16.5 q22 0 38 -16t16 -39t-16 -39t-38 -16q-14 0 -29 10l-55 -145q17 -22 17 -51q0 -36 -25.5 -61.5t-61.5 -25.5t-61.5 25.5t-25.5 61.5zM800 655q0 22 16 38t39 16t38.5 -15.5t15.5 -38.5t-16 -39t-38 -16q-23 0 -39 16t-16 39z" />
-<glyph unicode="&#xe142;" d="M-40 375q-13 -95 35 -173q35 -57 94 -89t129 -32q63 0 119 28q33 16 65 40.5t52.5 45.5t59.5 64q40 44 57 61l394 394q35 35 47 84t-3 96q-27 87 -117 104q-20 2 -29 2q-46 0 -78.5 -16.5t-67.5 -51.5l-389 -396l-7 -7l69 -67l377 373q20 22 39 38q23 23 50 23 q38 0 53 -36q16 -39 -20 -75l-547 -547q-52 -52 -125 -52q-55 0 -100 33t-54 96q-5 35 2.5 66t31.5 63t42 50t56 54q24 21 44 41l348 348q52 52 82.5 79.5t84 54t107.5 26.5q25 0 48 -4q95 -17 154 -94.5t51 -175.5q-7 -101 -98 -192l-252 -249l-253 -256l7 -7l69 -60 l517 511q67 67 95 157t11 183q-16 87 -67 154t-130 103q-69 33 -152 33q-107 0 -197 -55q-40 -24 -111 -95l-512 -512q-68 -68 -81 -163z" />
-<glyph unicode="&#xe143;" d="M80 784q0 131 98.5 229.5t230.5 98.5q143 0 241 -129q103 129 246 129q129 0 226 -98.5t97 -229.5q0 -46 -17.5 -91t-61 -99t-77 -89.5t-104.5 -105.5q-197 -191 -293 -322l-17 -23l-16 23q-43 58 -100 122.5t-92 99.5t-101 100q-71 70 -104.5 105.5t-77 89.5t-61 99 t-17.5 91zM250 784q0 -27 30.5 -70t61.5 -75.5t95 -94.5l22 -22q93 -90 190 -201q82 92 195 203l12 12q64 62 97.5 97t64.5 79t31 72q0 71 -48 119.5t-105 48.5q-74 0 -132 -83l-118 -171l-114 174q-51 80 -123 80q-60 0 -109.5 -49.5t-49.5 -118.5z" />
-<glyph unicode="&#xe144;" d="M57 353q0 -95 66 -159l141 -142q68 -66 159 -66q93 0 159 66l283 283q66 66 66 159t-66 159l-141 141q-8 9 -19 17l-105 -105l212 -212l-389 -389l-247 248l95 95l-18 18q-46 45 -75 101l-55 -55q-66 -66 -66 -159zM269 706q0 -93 66 -159l141 -141q7 -7 19 -17l105 105 l-212 212l389 389l247 -247l-95 -96l18 -17q47 -49 77 -100l29 29q35 35 62.5 88t27.5 96q0 93 -66 159l-141 141q-66 66 -159 66q-95 0 -159 -66l-283 -283q-66 -64 -66 -159z" />
-<glyph unicode="&#xe145;" d="M200 100v953q0 21 30 46t81 48t129 38t163 15t162 -15t127 -38t79 -48t29 -46v-953q0 -41 -29.5 -70.5t-70.5 -29.5h-600q-41 0 -70.5 29.5t-29.5 70.5zM300 300h600v700h-600v-700zM496 150q0 -43 30.5 -73.5t73.5 -30.5t73.5 30.5t30.5 73.5t-30.5 73.5t-73.5 30.5 t-73.5 -30.5t-30.5 -73.5z" />
-<glyph unicode="&#xe146;" d="M0 0l303 380l207 208l-210 212h300l267 279l-35 36q-15 14 -15 35t15 35q14 15 35 15t35 -15l283 -282q15 -15 15 -36t-15 -35q-14 -15 -35 -15t-35 15l-36 35l-279 -267v-300l-212 210l-208 -207z" />
-<glyph unicode="&#xe148;" d="M295 433h139q5 -77 48.5 -126.5t117.5 -64.5v335q-6 1 -15.5 4t-11.5 3q-46 14 -79 26.5t-72 36t-62.5 52t-40 72.5t-16.5 99q0 92 44 159.5t109 101t144 40.5v78h100v-79q38 -4 72.5 -13.5t75.5 -31.5t71 -53.5t51.5 -84t24.5 -118.5h-159q-8 72 -35 109.5t-101 50.5 v-307l64 -14q34 -7 64 -16.5t70 -31.5t67.5 -52t47.5 -80.5t20 -112.5q0 -139 -89 -224t-244 -96v-77h-100v78q-152 17 -237 104q-40 40 -52.5 93.5t-15.5 139.5zM466 889q0 -29 8 -51t16.5 -34t29.5 -22.5t31 -13.5t38 -10q7 -2 11 -3v274q-61 -8 -97.5 -37.5t-36.5 -102.5 zM700 237q170 18 170 151q0 64 -44 99.5t-126 60.5v-311z" />
-<glyph unicode="&#xe149;" d="M100 600v100h166q-24 49 -44 104q-10 26 -14.5 55.5t-3 72.5t25 90t68.5 87q97 88 263 88q129 0 230 -89t101 -208h-153q0 52 -34 89.5t-74 51.5t-76 14q-37 0 -79 -14.5t-62 -35.5q-41 -44 -41 -101q0 -28 16.5 -69.5t28 -62.5t41.5 -72h241v-100h-197q8 -50 -2.5 -115 t-31.5 -94q-41 -59 -99 -113q35 11 84 18t70 7q33 1 103 -16t103 -17q76 0 136 30l50 -147q-41 -25 -80.5 -36.5t-59 -13t-61.5 -1.5q-23 0 -128 33t-155 29q-39 -4 -82 -17t-66 -25l-24 -11l-55 145l16.5 11t15.5 10t13.5 9.5t14.5 12t14.5 14t17.5 18.5q48 55 54 126.5 t-30 142.5h-221z" />
-<glyph unicode="&#xe150;" d="M2 300l298 -300l298 300h-198v900h-200v-900h-198zM602 900l298 300l298 -300h-198v-900h-200v900h-198z" />
-<glyph unicode="&#xe151;" d="M2 300h198v900h200v-900h198l-298 -300zM700 0v200h100v-100h200v-100h-300zM700 400v100h300v-200h-99v-100h-100v100h99v100h-200zM700 700v500h300v-500h-100v100h-100v-100h-100zM801 900h100v200h-100v-200z" />
-<glyph unicode="&#xe152;" d="M2 300h198v900h200v-900h198l-298 -300zM700 0v500h300v-500h-100v100h-100v-100h-100zM700 700v200h100v-100h200v-100h-300zM700 1100v100h300v-200h-99v-100h-100v100h99v100h-200zM801 200h100v200h-100v-200z" />
-<glyph unicode="&#xe153;" d="M2 300l298 -300l298 300h-198v900h-200v-900h-198zM800 100v400h300v-500h-100v100h-200zM800 1100v100h200v-500h-100v400h-100zM901 200h100v200h-100v-200z" />
-<glyph unicode="&#xe154;" d="M2 300l298 -300l298 300h-198v900h-200v-900h-198zM800 400v100h200v-500h-100v400h-100zM800 800v400h300v-500h-100v100h-200zM901 900h100v200h-100v-200z" />
-<glyph unicode="&#xe155;" d="M2 300l298 -300l298 300h-198v900h-200v-900h-198zM700 100v200h500v-200h-500zM700 400v200h400v-200h-400zM700 700v200h300v-200h-300zM700 1000v200h200v-200h-200z" />
-<glyph unicode="&#xe156;" d="M2 300l298 -300l298 300h-198v900h-200v-900h-198zM700 100v200h200v-200h-200zM700 400v200h300v-200h-300zM700 700v200h400v-200h-400zM700 1000v200h500v-200h-500z" />
-<glyph unicode="&#xe157;" d="M0 400v300q0 165 117.5 282.5t282.5 117.5h300q162 0 281 -118.5t119 -281.5v-300q0 -165 -118.5 -282.5t-281.5 -117.5h-300q-165 0 -282.5 117.5t-117.5 282.5zM200 300q0 -41 29.5 -70.5t70.5 -29.5h500q41 0 70.5 29.5t29.5 70.5v500q0 41 -29.5 70.5t-70.5 29.5 h-500q-41 0 -70.5 -29.5t-29.5 -70.5v-500z" />
-<glyph unicode="&#xe158;" d="M0 400v300q0 163 119 281.5t281 118.5h300q165 0 282.5 -117.5t117.5 -282.5v-300q0 -165 -117.5 -282.5t-282.5 -117.5h-300q-163 0 -281.5 117.5t-118.5 282.5zM200 300q0 -41 29.5 -70.5t70.5 -29.5h500q41 0 70.5 29.5t29.5 70.5v500q0 41 -29.5 70.5t-70.5 29.5 h-500q-41 0 -70.5 -29.5t-29.5 -70.5v-500zM400 300l333 250l-333 250v-500z" />
-<glyph unicode="&#xe159;" d="M0 400v300q0 163 117.5 281.5t282.5 118.5h300q163 0 281.5 -119t118.5 -281v-300q0 -165 -117.5 -282.5t-282.5 -117.5h-300q-165 0 -282.5 117.5t-117.5 282.5zM200 300q0 -41 29.5 -70.5t70.5 -29.5h500q41 0 70.5 29.5t29.5 70.5v500q0 41 -29.5 70.5t-70.5 29.5 h-500q-41 0 -70.5 -29.5t-29.5 -70.5v-500zM300 700l250 -333l250 333h-500z" />
-<glyph unicode="&#xe160;" d="M0 400v300q0 165 117.5 282.5t282.5 117.5h300q165 0 282.5 -117.5t117.5 -282.5v-300q0 -162 -118.5 -281t-281.5 -119h-300q-165 0 -282.5 118.5t-117.5 281.5zM200 300q0 -41 29.5 -70.5t70.5 -29.5h500q41 0 70.5 29.5t29.5 70.5v500q0 41 -29.5 70.5t-70.5 29.5 h-500q-41 0 -70.5 -29.5t-29.5 -70.5v-500zM300 400h500l-250 333z" />
-<glyph unicode="&#xe161;" d="M0 400v300h300v200l400 -350l-400 -350v200h-300zM500 0v200h500q41 0 70.5 29.5t29.5 70.5v500q0 41 -29.5 70.5t-70.5 29.5h-500v200h400q165 0 282.5 -117.5t117.5 -282.5v-300q0 -165 -117.5 -282.5t-282.5 -117.5h-400z" />
-<glyph unicode="&#xe162;" d="M217 519q8 -19 31 -19h302q-155 -438 -160 -458q-5 -21 4 -32l9 -8h9q14 0 26 15q11 13 274.5 321.5t264.5 308.5q14 19 5 36q-8 17 -31 17l-301 -1q1 4 78 219.5t79 227.5q2 15 -5 27l-9 9h-9q-15 0 -25 -16q-4 -6 -98 -111.5t-228.5 -257t-209.5 -237.5q-16 -19 -6 -41 z" />
-<glyph unicode="&#xe163;" d="M0 400q0 -165 117.5 -282.5t282.5 -117.5h300q47 0 100 15v185h-500q-41 0 -70.5 29.5t-29.5 70.5v500q0 41 29.5 70.5t70.5 29.5h500v185q-14 4 -114 7.5t-193 5.5l-93 2q-165 0 -282.5 -117.5t-117.5 -282.5v-300zM600 400v300h300v200l400 -350l-400 -350v200h-300z " />
-<glyph unicode="&#xe164;" d="M0 400q0 -165 117.5 -282.5t282.5 -117.5h300q163 0 281.5 117.5t118.5 282.5v98l-78 73l-122 -123v-148q0 -41 -29.5 -70.5t-70.5 -29.5h-500q-41 0 -70.5 29.5t-29.5 70.5v500q0 41 29.5 70.5t70.5 29.5h156l118 122l-74 78h-100q-165 0 -282.5 -117.5t-117.5 -282.5 v-300zM496 709l353 342l-149 149h500v-500l-149 149l-342 -353z" />
-<glyph unicode="&#xe165;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -171 121.5 -292.5t292.5 -121.5t292.5 121.5t121.5 292.5t-121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM406 600 q0 80 57 137t137 57t137 -57t57 -137t-57 -137t-137 -57t-137 57t-57 137z" />
-<glyph unicode="&#xe166;" d="M0 0v275q0 11 7 18t18 7h1048q11 0 19 -7.5t8 -17.5v-275h-1100zM100 800l445 -500l450 500h-295v400h-300v-400h-300zM900 150h100v50h-100v-50z" />
-<glyph unicode="&#xe167;" d="M0 0v275q0 11 7 18t18 7h1048q11 0 19 -7.5t8 -17.5v-275h-1100zM100 700h300v-300h300v300h295l-445 500zM900 150h100v50h-100v-50z" />
-<glyph unicode="&#xe168;" d="M0 0v275q0 11 7 18t18 7h1048q11 0 19 -7.5t8 -17.5v-275h-1100zM100 705l305 -305l596 596l-154 155l-442 -442l-150 151zM900 150h100v50h-100v-50z" />
-<glyph unicode="&#xe169;" d="M0 0v275q0 11 7 18t18 7h1048q11 0 19 -7.5t8 -17.5v-275h-1100zM100 988l97 -98l212 213l-97 97zM200 400l697 1l3 699l-250 -239l-149 149l-212 -212l149 -149zM900 150h100v50h-100v-50z" />
-<glyph unicode="&#xe170;" d="M0 0v275q0 11 7 18t18 7h1048q11 0 19 -7.5t8 -17.5v-275h-1100zM200 612l212 -212l98 97l-213 212zM300 1200l239 -250l-149 -149l212 -212l149 148l249 -237l-1 697zM900 150h100v50h-100v-50z" />
-<glyph unicode="&#xe171;" d="M23 415l1177 784v-1079l-475 272l-310 -393v416h-392zM494 210l672 938l-672 -712v-226z" />
-<glyph unicode="&#xe172;" d="M0 150v1000q0 20 14.5 35t35.5 15h250v-300h500v300h100l200 -200v-850q0 -21 -15 -35.5t-35 -14.5h-150v400h-700v-400h-150q-21 0 -35.5 14.5t-14.5 35.5zM600 1000h100v200h-100v-200z" />
-<glyph unicode="&#xe173;" d="M0 150v1000q0 20 14.5 35t35.5 15h250v-300h500v300h100l200 -200v-218l-276 -275l-120 120l-126 -127h-378v-400h-150q-21 0 -35.5 14.5t-14.5 35.5zM581 306l123 123l120 -120l353 352l123 -123l-475 -476zM600 1000h100v200h-100v-200z" />
-<glyph unicode="&#xe174;" d="M0 150v1000q0 20 14.5 35t35.5 15h250v-300h500v300h100l200 -200v-269l-103 -103l-170 170l-298 -298h-329v-400h-150q-21 0 -35.5 14.5t-14.5 35.5zM600 1000h100v200h-100v-200zM700 133l170 170l-170 170l127 127l170 -170l170 170l127 -128l-170 -169l170 -170 l-127 -127l-170 170l-170 -170z" />
-<glyph unicode="&#xe175;" d="M0 150v1000q0 20 14.5 35t35.5 15h250v-300h500v300h100l200 -200v-300h-400v-200h-500v-400h-150q-21 0 -35.5 14.5t-14.5 35.5zM600 300l300 -300l300 300h-200v300h-200v-300h-200zM600 1000v200h100v-200h-100z" />
-<glyph unicode="&#xe176;" d="M0 150v1000q0 20 14.5 35t35.5 15h250v-300h500v300h100l200 -200v-402l-200 200l-298 -298h-402v-400h-150q-21 0 -35.5 14.5t-14.5 35.5zM600 300h200v-300h200v300h200l-300 300zM600 1000v200h100v-200h-100z" />
-<glyph unicode="&#xe177;" d="M0 250q0 -21 14.5 -35.5t35.5 -14.5h1100q21 0 35.5 14.5t14.5 35.5v550h-1200v-550zM0 900h1200v150q0 21 -14.5 35.5t-35.5 14.5h-1100q-21 0 -35.5 -14.5t-14.5 -35.5v-150zM100 300v200h400v-200h-400z" />
-<glyph unicode="&#xe178;" d="M0 400l300 298v-198h400v-200h-400v-198zM100 800v200h100v-200h-100zM300 800v200h100v-200h-100zM500 800v200h400v198l300 -298l-300 -298v198h-400zM800 300v200h100v-200h-100zM1000 300h100v200h-100v-200z" />
-<glyph unicode="&#xe179;" d="M100 700v400l50 100l50 -100v-300h100v300l50 100l50 -100v-300h100v300l50 100l50 -100v-400l-100 -203v-447q0 -21 -14.5 -35.5t-35.5 -14.5h-200q-21 0 -35.5 14.5t-14.5 35.5v447zM800 597q0 -29 10.5 -55.5t25 -43t29 -28.5t25.5 -18l10 -5v-397q0 -21 14.5 -35.5 t35.5 -14.5h200q21 0 35.5 14.5t14.5 35.5v1106q0 31 -18 40.5t-44 -7.5l-276 -116q-25 -17 -43.5 -51.5t-18.5 -65.5v-359z" />
-<glyph unicode="&#xe180;" d="M100 0h400v56q-75 0 -87.5 6t-12.5 44v394h500v-394q0 -38 -12.5 -44t-87.5 -6v-56h400v56q-4 0 -11 0.5t-24 3t-30 7t-24 15t-11 24.5v888q0 22 25 34.5t50 13.5l25 2v56h-400v-56q75 0 87.5 -6t12.5 -44v-394h-500v394q0 38 12.5 44t87.5 6v56h-400v-56q4 0 11 -0.5 t24 -3t30 -7t24 -15t11 -24.5v-888q0 -22 -25 -34.5t-50 -13.5l-25 -2v-56z" />
-<glyph unicode="&#xe181;" d="M0 300q0 -41 29.5 -70.5t70.5 -29.5h300q41 0 70.5 29.5t29.5 70.5v500q0 41 -29.5 70.5t-70.5 29.5h-300q-41 0 -70.5 -29.5t-29.5 -70.5v-500zM100 100h400l200 200h105l295 98v-298h-425l-100 -100h-375zM100 300v200h300v-200h-300zM100 600v200h300v-200h-300z M100 1000h400l200 -200v-98l295 98h105v200h-425l-100 100h-375zM700 402v163l400 133v-163z" />
-<glyph unicode="&#xe182;" d="M16.5 974.5q0.5 -21.5 16 -90t46.5 -140t104 -177.5t175 -208q103 -103 207.5 -176t180 -103.5t137 -47t92.5 -16.5l31 1l163 162q17 18 13.5 41t-22.5 37l-192 136q-19 14 -45 12t-42 -19l-118 -118q-142 101 -268 227t-227 268l118 118q17 17 20 41.5t-11 44.5 l-139 194q-14 19 -36.5 22t-40.5 -14l-162 -162q-1 -11 -0.5 -32.5z" />
-<glyph unicode="&#xe183;" d="M0 50v212q0 20 10.5 45.5t24.5 39.5l365 303v50q0 4 1 10.5t12 22.5t30 28.5t60 23t97 10.5t97 -10t60 -23.5t30 -27.5t12 -24l1 -10v-50l365 -303q14 -14 24.5 -39.5t10.5 -45.5v-212q0 -21 -14.5 -35.5t-35.5 -14.5h-1100q-20 0 -35 14.5t-15 35.5zM0 712 q0 -21 14.5 -33.5t34.5 -8.5l202 33q20 4 34.5 21t14.5 38v146q141 24 300 24t300 -24v-146q0 -21 14.5 -38t34.5 -21l202 -33q20 -4 34.5 8.5t14.5 33.5v200q-6 8 -19 20.5t-63 45t-112 57t-171 45t-235 20.5q-92 0 -175 -10.5t-141.5 -27t-108.5 -36.5t-81.5 -40 t-53.5 -36.5t-31 -27.5l-9 -10v-200z" />
-<glyph unicode="&#xe184;" d="M100 0v100h1100v-100h-1100zM175 200h950l-125 150v250l100 100v400h-100v-200h-100v200h-200v-200h-100v200h-200v-200h-100v200h-100v-400l100 -100v-250z" />
-<glyph unicode="&#xe185;" d="M100 0h300v400q0 41 -29.5 70.5t-70.5 29.5h-100q-41 0 -70.5 -29.5t-29.5 -70.5v-400zM500 0v1000q0 41 29.5 70.5t70.5 29.5h100q41 0 70.5 -29.5t29.5 -70.5v-1000h-300zM900 0v700q0 41 29.5 70.5t70.5 29.5h100q41 0 70.5 -29.5t29.5 -70.5v-700h-300z" />
-<glyph unicode="&#xe186;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 300h300v300h-200v100h200v100h-300v-300h200v-100h-200v-100zM600 300h200v100h100v300h-100v100h-200v-500 zM700 400v300h100v-300h-100z" />
-<glyph unicode="&#xe187;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 300h100v200h100v-200h100v500h-100v-200h-100v200h-100v-500zM600 300h200v100h100v300h-100v100h-200v-500 zM700 400v300h100v-300h-100z" />
-<glyph unicode="&#xe188;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 300h300v100h-200v300h200v100h-300v-500zM600 300h300v100h-200v300h200v100h-300v-500z" />
-<glyph unicode="&#xe189;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 550l300 -150v300zM600 400l300 150l-300 150v-300z" />
-<glyph unicode="&#xe190;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 300v500h700v-500h-700zM300 400h130q41 0 68 42t27 107t-28.5 108t-66.5 43h-130v-300zM575 549 q0 -65 27 -107t68 -42h130v300h-130q-38 0 -66.5 -43t-28.5 -108z" />
-<glyph unicode="&#xe191;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 300h300v300h-200v100h200v100h-300v-300h200v-100h-200v-100zM601 300h100v100h-100v-100zM700 700h100 v-400h100v500h-200v-100z" />
-<glyph unicode="&#xe192;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 300h300v400h-200v100h-100v-500zM301 400v200h100v-200h-100zM601 300h100v100h-100v-100zM700 700h100 v-400h100v500h-200v-100z" />
-<glyph unicode="&#xe193;" d="M-100 300v500q0 124 88 212t212 88h700q124 0 212 -88t88 -212v-500q0 -124 -88 -212t-212 -88h-700q-124 0 -212 88t-88 212zM100 200h900v700h-900v-700zM200 700v100h300v-300h-99v-100h-100v100h99v200h-200zM201 300v100h100v-100h-100zM601 300v100h100v-100h-100z M700 700v100h200v-500h-100v400h-100z" />
-<glyph unicode="&#xe194;" d="M4 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM186 600q0 -171 121.5 -292.5t292.5 -121.5t292.5 121.5t121.5 292.5t-121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM400 500v200 l100 100h300v-100h-300v-200h300v-100h-300z" />
-<glyph unicode="&#xe195;" d="M0 600q0 162 80 299t217 217t299 80t299 -80t217 -217t80 -299t-80 -299t-217 -217t-299 -80t-299 80t-217 217t-80 299zM182 600q0 -171 121.5 -292.5t292.5 -121.5t292.5 121.5t121.5 292.5t-121.5 292.5t-292.5 121.5t-292.5 -121.5t-121.5 -292.5zM400 400v400h300 l100 -100v-100h-100v100h-200v-100h200v-100h-200v-100h-100zM700 400v100h100v-100h-100z" />
-<glyph unicode="&#xe197;" d="M-14 494q0 -80 56.5 -137t135.5 -57h222v300h400v-300h128q120 0 205 86.5t85 207.5t-85 207t-205 86q-46 0 -90 -14q-44 97 -134.5 156.5t-200.5 59.5q-152 0 -260 -107.5t-108 -260.5q0 -25 2 -37q-66 -14 -108.5 -67.5t-42.5 -122.5zM300 200h200v300h200v-300h200 l-300 -300z" />
-<glyph unicode="&#xe198;" d="M-14 494q0 -80 56.5 -137t135.5 -57h8l414 414l403 -403q94 26 154.5 104.5t60.5 178.5q0 120 -85 206.5t-205 86.5q-46 0 -90 -14q-44 97 -134.5 156.5t-200.5 59.5q-152 0 -260 -107.5t-108 -260.5q0 -25 2 -37q-66 -14 -108.5 -67.5t-42.5 -122.5zM300 200l300 300 l300 -300h-200v-300h-200v300h-200z" />
-<glyph unicode="&#xe199;" d="M100 200h400v-155l-75 -45h350l-75 45v155h400l-270 300h170l-270 300h170l-300 333l-300 -333h170l-270 -300h170z" />
-<glyph unicode="&#xe200;" d="M121 700q0 -53 28.5 -97t75.5 -65q-4 -16 -4 -38q0 -74 52.5 -126.5t126.5 -52.5q56 0 100 30v-306l-75 -45h350l-75 45v306q46 -30 100 -30q74 0 126.5 52.5t52.5 126.5q0 24 -9 55q50 32 79.5 83t29.5 112q0 90 -61.5 155.5t-150.5 71.5q-26 89 -99.5 145.5 t-167.5 56.5q-116 0 -197.5 -81.5t-81.5 -197.5q0 -4 1 -11.5t1 -11.5q-14 2 -23 2q-74 0 -126.5 -52.5t-52.5 -126.5z" />
-</font>
-</defs></svg> 
\ No newline at end of file
diff --git a/doc/_static/fonts/glyphicons-halflings-regular.ttf b/doc/_static/fonts/glyphicons-halflings-regular.ttf
deleted file mode 100644
index 67fa00bf..00000000
Binary files a/doc/_static/fonts/glyphicons-halflings-regular.ttf and /dev/null differ
diff --git a/doc/_static/fonts/glyphicons-halflings-regular.woff b/doc/_static/fonts/glyphicons-halflings-regular.woff
deleted file mode 100644
index 8c54182a..00000000
Binary files a/doc/_static/fonts/glyphicons-halflings-regular.woff and /dev/null differ
diff --git a/doc/_templates/layout.html b/doc/_templates/layout.html
deleted file mode 100644
index 333a606c..00000000
--- a/doc/_templates/layout.html
+++ /dev/null
@@ -1,148 +0,0 @@
-{% extends "!layout.html" %}
-
-{% block extrahead %}
-<meta name="description" content="Small, safe and fast formatting library">
-<meta name="keywords" content="C++, formatting, printf, string, library">
-<meta name="author" content="Victor Zverovich">
-<link rel="stylesheet" href="_static/fmt.css">
-{# Google Analytics #}
-<script async src="https://www.googletagmanager.com/gtag/js?id=UA-20116650-4"></script>
-<script>
-  window.dataLayer = window.dataLayer || [];
-  function gtag(){dataLayer.push(arguments);}
-  gtag('js', new Date());
-
-  gtag('config', 'UA-20116650-4');
-</script>
-{% endblock %}
-
-{%- macro searchform(classes, button) %}
-<form class="{{classes}}" role="search" action="{{ pathto('search') }}"
-      method="get">
-  <div class="form-group">
-    <input type="text" name="q" class="form-control"
-           {{ 'placeholder="Search"' if not button }} >
-  </div>
-  <input type="hidden" name="check_keywords" value="yes" />
-  <input type="hidden" name="area" value="default" />
-  {% if button %}
-    <input type="submit" class="btn btn-default" value="search">
-  {% endif %}
-</form>
-{%- endmacro %}
-
-{% block header %}
-<nav class="navbar navbar-inverse">
-  <div class="tb-container">
-    <div class="row">
-      <div class="navbar-content">
-        {# Brand and toggle get grouped for better mobile display #}
-        <div class="navbar-header">
-          <button type="button" class="navbar-toggle collapsed"
-                  data-toggle="collapse" data-target=".navbar-collapse">
-            <span class="sr-only">Toggle navigation</span>
-            <span class="icon-bar"></span>
-            <span class="icon-bar"></span>
-            <span class="icon-bar"></span>
-          </button>
-          <a class="navbar-brand" href="index.html">{fmt}</a>
-        </div>
-
-        {# Collect the nav links, forms, and other content for toggling #}
-        <div class="collapse navbar-collapse">
-          <ul class="nav navbar-nav">
-            <li class="dropdown">
-              <a href="#" class="dropdown-toggle" data-toggle="dropdown"
-                 role="button" aria-expanded="false">{{ version }}
-                <span class="caret"></span></a>
-              <ul class="dropdown-menu" role="menu">
-                {% for v in versions.split(',') %}
-                <li><a href="https://fmt.dev/{{v}}">{{v}}</a></li>
-                {% endfor %}
-              </ul>
-            </li>
-            {% for name in ['Contents', 'Usage', 'API', 'Syntax'] %}
-              {% if pagename == name.lower() %}
-              <li class="active"><a href="{{name.lower()}}.html">{{name}}
-                <span class="sr-only">(current)</span></a></li>
-              {%else%}
-              <li><a href="{{name.lower()}}.html">{{name}}</a></li>
-              {%endif%}
-            {% endfor %}
-          </ul>
-          {% if pagename != 'search' %}
-            {{ searchform('navbar-form navbar-right', False) }}
-          {%endif%}
-        </div> {# /.navbar-collapse #}
-      </div> {# /.col-md-offset-2 #}
-    </div> {# /.row #}
-  </div> {# /.tb-container #}
-</nav>
-{% if pagename == "index" %}
-{% set download_url = 'https://github.com/fmtlib/fmt/releases/download' %}
-<div class="jumbotron">
-  <div class="tb-container">
-    <h1>{fmt}</h1>
-    <p class="lead">A modern formatting library</p>
-    <div class="btn-group" role="group">
-      {% set name = 'fmt' if version.split('.')[0]|int >= 3 else 'cppformat' %}
-      <a class="btn btn-success"
-         href="{{download_url}}/{{version}}/{{name}}-{{version}}.zip">
-           <span class="glyphicon glyphicon-download"></span> Download
-      </a>
-      <button type="button" class="btn btn-success dropdown-toggle"
-        data-toggle="dropdown"><span class="caret"></span></button>
-      <ul class="dropdown-menu">
-      {% for v in versions.split(',') %}
-      {% set name = 'fmt' if v.split('.')[0]|int >= 3 else 'cppformat' %}
-        <li><a href="{{download_url}}/{{v}}/{{name}}-{{v}}.zip">Version {{v}}
-          </a></li>
-      {% endfor %}
-      </ul>
-    </div>
-  </div>
-</div>
-{% endif %}
-{% endblock %}
-
-{# Disable relbars. #}
-{% block relbar1 %}
-{% endblock %}
-{% block relbar2 %}
-{% endblock %}
-
-{% block content %}
-<div class="tb-container">
-  <div class="row">
-    {# Sidebar is currently disabled.
-    <div class="bs-sidebar">
-      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
-        <div class="sphinxsidebarwrapper">
-          {%- block sidebarlogo %}
-          {%- if logo %}
-            <p class="logo"><a href="{{ pathto(master_doc) }}">
-              <img class="logo" src="{{ pathto('_static/' + logo, 1) }}"
-                   alt="Logo"/>
-            </a></p>
-          {%- endif %}
-          {%- endblock %}
-          {%- for sidebartemplate in sidebars %}
-          {%- include sidebartemplate %}
-          {%- endfor %}
-        </div>
-      </div>
-    </div>
-    #}
-
-    <div class="content">
-      {% block body %} {% endblock %}
-    </div>
-  </div>
-</div>
-{% endblock %}
-
-{% block footer %}
-{{ super() }}
-{# Placed at the end of the document so the pages load faster. #}
-<script src="_static/bootstrap.min.js"></script>
-{% endblock %}
diff --git a/doc/_templates/search.html b/doc/_templates/search.html
deleted file mode 100644
index 488e0b5d..00000000
--- a/doc/_templates/search.html
+++ /dev/null
@@ -1,55 +0,0 @@
-{#
-    basic/search.html
-    ~~~~~~~~~~~~~~~~~
-
-    Template for the search page.
-
-    :copyright: Copyright 2007-2015 by the Sphinx team, see AUTHORS.
-    :license: BSD, see LICENSE for details.
-#}
-{%- extends "layout.html" %}
-{% set title = _('Search') %}
-{% set script_files = script_files + ['_static/searchtools.js'] %}
-{% block extrahead %}
-  <script type="text/javascript">
-    jQuery(function() { Search.loadIndex("{{ pathto('searchindex.js', 1) }}"); });
-  </script>
-  {# this is used when loading the search index using $.ajax fails,
-     such as on Chrome for documents on localhost #}
-  <script type="text/javascript" id="searchindexloader"></script>
-  {{ super() }}
-{% endblock %}
-{% block body %}
-  <h1 id="search-documentation">{{ _('Search') }}</h1>
-  <div id="fallback" class="admonition warning">
-  <script type="text/javascript">$('#fallback').hide();</script>
-  <p>
-    {% trans %}Please activate JavaScript to enable the search
-    functionality.{% endtrans %}
-  </p>
-  </div>
-  <p>
-    {% trans %}From here you can search these documents. Enter your search
-    words into the box below and click "search". Note that the search
-    function will automatically search for all of the words. Pages
-    containing fewer words won't appear in the result list.{% endtrans %}
-  </p>
-  {{ searchform('form-inline', True) }}
-  {% if search_performed %}
-    <h2>{{ _('Search Results') }}</h2>
-    {% if not search_results %}
-      <p>{{ _('Your search did not match any documents. Please make sure that all words are spelled correctly and that you\'ve selected enough categories.') }}</p>
-    {% endif %}
-  {% endif %}
-  <div id="search-results">
-  {% if search_results %}
-    <ul>
-    {% for href, caption, context in search_results %}
-      <li><a href="{{ pathto(item.href) }}">{{ caption }}</a>
-        <div class="context">{{ context|e }}</div>
-      </li>
-    {% endfor %}
-    </ul>
-  {% endif %}
-  </div>
-{% endblock %}
diff --git a/doc/api.md b/doc/api.md
new file mode 100644
index 00000000..d6532a03
--- /dev/null
+++ b/doc/api.md
@@ -0,0 +1,649 @@
+# API Reference
+
+The {fmt} library API consists of the following components:
+
+- [`fmt/base.h`](#base-api): the base API providing main formatting functions
+  for `char`/UTF-8 with C++20 compile-time checks and minimal dependencies
+- [`fmt/format.h`](#format-api): `fmt::format` and other formatting functions
+  as well as locale support
+- [`fmt/ranges.h`](#ranges-api): formatting of ranges and tuples
+- [`fmt/chrono.h`](#chrono-api): date and time formatting
+- [`fmt/std.h`](#std-api): formatters for standard library types
+- [`fmt/compile.h`](#compile-api): format string compilation
+- [`fmt/color.h`](#color-api): terminal colors and text styles
+- [`fmt/os.h`](#os-api): system APIs
+- [`fmt/ostream.h`](#ostream-api): `std::ostream` support
+- [`fmt/args.h`](#args-api): dynamic argument lists
+- [`fmt/printf.h`](#printf-api): safe `printf`
+- [`fmt/xchar.h`](#xchar-api): optional `wchar_t` support
+
+All functions and types provided by the library reside in namespace `fmt`
+and macros have prefix `FMT_`.
+
+## Base API
+
+`fmt/base.h` defines the base API which provides main formatting functions
+for `char`/UTF-8 with C++20 compile-time checks. It has minimal include
+dependencies for better compile times. This header is only beneficial when
+using {fmt} as a library (the default) and not in the header-only mode.
+It also provides `formatter` specializations for the following types:
+
+- `int`, `long long`,
+- `unsigned`, `unsigned long long`
+- `float`, `double`, `long double`
+- `bool`
+- `char`
+- `const char*`, [`fmt::string_view`](#basic_string_view)
+- `const void*`
+
+The following functions use [format string syntax](syntax.md) similar to that
+of [str.format](https://docs.python.org/3/library/stdtypes.html#str.format)
+in Python. They take *fmt* and *args* as arguments.
+
+*fmt* is a format string that contains literal text and replacement fields
+surrounded by braces `{}`. The fields are replaced with formatted arguments
+in the resulting string. [`fmt::format_string`](#format_string) is a format
+string which can be implicitly constructed from a string literal or a
+`constexpr` string and is checked at compile time in C++20. To pass a runtime
+format string wrap it in [`fmt::runtime`](#runtime).
+
+*args* is an argument list representing objects to be formatted.
+
+I/O errors are reported as [`std::system_error`](
+https://en.cppreference.com/w/cpp/error/system_error) exceptions unless
+specified otherwise.
+
+::: print(format_string<T...>, T&&...)
+
+::: print(FILE*, format_string<T...>, T&&...)
+
+::: println(format_string<T...>, T&&...)
+
+::: println(FILE*, format_string<T...>, T&&...)
+
+::: format_to(OutputIt&&, format_string<T...>, T&&...)
+
+::: format_to_n(OutputIt, size_t, format_string<T...>, T&&...)
+
+::: format_to_n_result
+
+::: formatted_size(format_string<T...>, T&&...)
+
+<a id="udt"></a>
+### Formatting User-Defined Types
+
+The {fmt} library provides formatters for many standard C++ types.
+See [`fmt/ranges.h`](#ranges-api) for ranges and tuples including standard
+containers such as `std::vector`, [`fmt/chrono.h`](#chrono-api) for date and
+time formatting and [`fmt/std.h`](#std-api) for other standard library types.
+
+There are two ways to make a user-defined type formattable: providing a
+`format_as` function or specializing the `formatter` struct template.
+
+Use `format_as` if you want to make your type formattable as some other
+type with the same format specifiers. The `format_as` function should
+take an object of your type and return an object of a formattable type.
+It should be defined in the same namespace as your type.
+
+Example ([run](https://godbolt.org/z/nvME4arz8)):
+
+    #include <fmt/format.h>
+
+    namespace kevin_namespacy {
+
+    enum class film {
+      house_of_cards, american_beauty, se7en = 7
+    };
+
+    auto format_as(film f) { return fmt::underlying(f); }
+
+    }
+
+    int main() {
+      fmt::print("{}\n", kevin_namespacy::film::se7en); // Output: 7
+    }
+
+Using specialization is more complex but gives you full control over
+parsing and formatting. To use this method specialize the `formatter`
+struct template for your type and implement `parse` and `format`
+methods.
+
+The recommended way of defining a formatter is by reusing an existing
+one via inheritance or composition. This way you can support standard
+format specifiers without implementing them yourself. For example:
+
+```c++
+// color.h:
+#include <fmt/base.h>
+
+enum class color {red, green, blue};
+
+template <> struct fmt::formatter<color>: formatter<string_view> {
+  // parse is inherited from formatter<string_view>.
+
+  auto format(color c, format_context& ctx) const
+    -> format_context::iterator;
+};
+```
+
+```c++
+// color.cc:
+#include "color.h"
+#include <fmt/format.h>
+
+auto fmt::formatter<color>::format(color c, format_context& ctx) const
+    -> format_context::iterator {
+  string_view name = "unknown";
+  switch (c) {
+  case color::red:   name = "red"; break;
+  case color::green: name = "green"; break;
+  case color::blue:  name = "blue"; break;
+  }
+  return formatter<string_view>::format(name, ctx);
+}
+```
+
+Note that `formatter<string_view>::format` is defined in `fmt/format.h`
+so it has to be included in the source file. Since `parse` is inherited
+from `formatter<string_view>` it will recognize all string format
+specifications, for example
+
+```c++
+fmt::format("{:>10}", color::blue)
+```
+
+will return `"      blue"`.
+
+<!-- The experimental `nested_formatter` provides an easy way of applying a
+formatter to one or more subobjects.
+
+For example:
+
+    #include <fmt/format.h>
+
+    struct point {
+      double x, y;
+    };
+
+    template <>
+    struct fmt::formatter<point> : nested_formatter<double> {
+      auto format(point p, format_context& ctx) const {
+        return write_padded(ctx, [=](auto out) {
+          return format_to(out, "({}, {})", this->nested(p.x),
+                           this->nested(p.y));
+        });
+      }
+    };
+
+    int main() {
+      fmt::print("[{:>20.2f}]", point{1, 2});
+    }
+
+prints:
+
+    [          (1.00, 2.00)]
+
+Notice that fill, align and width are applied to the whole object which
+is the recommended behavior while the remaining specifiers apply to
+elements. -->
+
+In general the formatter has the following form:
+
+    template <> struct fmt::formatter<T> {
+      // Parses format specifiers and stores them in the formatter.
+      //
+      // [ctx.begin(), ctx.end()) is a, possibly empty, character range that
+      // contains a part of the format string starting from the format
+      // specifications to be parsed, e.g. in
+      //
+      //   fmt::format("{:f} continued", ...);
+      //
+      // the range will contain "f} continued". The formatter should parse
+      // specifiers until '}' or the end of the range. In this example the
+      // formatter should parse the 'f' specifier and return an iterator
+      // pointing to '}'.
+      constexpr auto parse(format_parse_context& ctx)
+        -> format_parse_context::iterator;
+
+      // Formats value using the parsed format specification stored in this
+      // formatter and writes the output to ctx.out().
+      auto format(const T& value, format_context& ctx) const
+        -> format_context::iterator;
+    };
+
+It is recommended to at least support fill, align and width that apply
+to the whole object and have the same semantics as in standard
+formatters.
+
+You can also write a formatter for a hierarchy of classes:
+
+```c++
+// demo.h:
+#include <type_traits>
+#include <fmt/core.h>
+
+struct A {
+  virtual ~A() {}
+  virtual std::string name() const { return "A"; }
+};
+
+struct B : A {
+  virtual std::string name() const { return "B"; }
+};
+
+template <typename T>
+struct fmt::formatter<T, std::enable_if_t<std::is_base_of_v<A, T>, char>> :
+    fmt::formatter<std::string> {
+  auto format(const A& a, format_context& ctx) const {
+    return formatter<std::string>::format(a.name(), ctx);
+  }
+};
+```
+
+```c++
+// demo.cc:
+#include "demo.h"
+#include <fmt/format.h>
+
+int main() {
+  B b;
+  A& a = b;
+  fmt::print("{}", a); // Output: B
+}
+```
+
+Providing both a `formatter` specialization and a `format_as` overload is
+disallowed.
+
+::: basic_format_parse_context
+
+::: context
+
+::: format_context
+
+### Compile-Time Checks
+
+Compile-time format string checks are enabled by default on compilers
+that support C++20 `consteval`. On older compilers you can use the
+[FMT_STRING](#legacy-checks) macro defined in `fmt/format.h` instead.
+
+Unused arguments are allowed as in Python's `str.format` and ordinary functions.
+
+::: basic_format_string
+
+::: format_string
+
+::: runtime(string_view)
+
+### Named Arguments
+
+::: arg(const Char*, const T&)
+
+Named arguments are not supported in compile-time checks at the moment.
+
+### Type Erasure
+
+You can create your own formatting function with compile-time checks and
+small binary footprint, for example ([run](https://godbolt.org/z/b9Pbasvzc)):
+
+```c++
+#include <fmt/format.h>
+
+void vlog(const char* file, int line,
+          fmt::string_view fmt, fmt::format_args args) {
+  fmt::print("{}: {}: {}", file, line, fmt::vformat(fmt, args));
+}
+
+template <typename... T>
+void log(const char* file, int line,
+         fmt::format_string<T...> fmt, T&&... args) {
+  vlog(file, line, fmt, fmt::make_format_args(args...));
+}
+
+#define MY_LOG(fmt, ...) log(__FILE__, __LINE__, fmt, __VA_ARGS__)
+
+MY_LOG("invalid squishiness: {}", 42);
+```
+
+Note that `vlog` is not parameterized on argument types which improves
+compile times and reduces binary code size compared to a fully
+parameterized version.
+
+::: make_format_args(T&...)
+
+::: basic_format_args
+
+::: format_args
+
+::: basic_format_arg
+
+### Compatibility
+
+::: basic_string_view
+
+::: string_view
+
+## Format API
+
+`fmt/format.h` defines the full format API providing additional
+formatting functions and locale support.
+
+<a id="format"></a>
+::: format(format_string<T...>, T&&...)
+
+::: vformat(string_view, format_args)
+
+::: operator""_a()
+
+### Utilities
+
+::: ptr(T)
+
+::: underlying(Enum)
+
+::: to_string(const T&)
+
+::: group_digits(T)
+
+::: detail::buffer
+
+::: basic_memory_buffer
+
+### System Errors
+
+{fmt} does not use `errno` to communicate errors to the user, but it may
+call system functions which set `errno`. Users should not make any
+assumptions about the value of `errno` being preserved by library
+functions.
+
+::: system_error
+
+::: format_system_error
+
+### Custom Allocators
+
+The {fmt} library supports custom dynamic memory allocators. A custom
+allocator class can be specified as a template argument to
+[`fmt::basic_memory_buffer`](#basic_memory_buffer):
+
+    using custom_memory_buffer = 
+      fmt::basic_memory_buffer<char, fmt::inline_buffer_size, custom_allocator>;
+
+It is also possible to write a formatting function that uses a custom
+allocator:
+
+    using custom_string =
+      std::basic_string<char, std::char_traits<char>, custom_allocator>;
+
+    auto vformat(custom_allocator alloc, fmt::string_view fmt,
+                 fmt::format_args args) -> custom_string {
+      auto buf = custom_memory_buffer(alloc);
+      fmt::vformat_to(std::back_inserter(buf), fmt, args);
+      return custom_string(buf.data(), buf.size(), alloc);
+    }
+
+    template <typename ...Args>
+    auto format(custom_allocator alloc, fmt::string_view fmt,
+                const Args& ... args) -> custom_string {
+      return vformat(alloc, fmt, fmt::make_format_args(args...));
+    }
+
+The allocator will be used for the output container only. Formatting
+functions normally don't do any allocations for built-in and string
+types except for non-default floating-point formatting that occasionally
+falls back on `sprintf`.
+
+### Locale
+
+All formatting is locale-independent by default. Use the `'L'` format
+specifier to insert the appropriate number separator characters from the
+locale:
+
+    #include <fmt/core.h>
+    #include <locale>
+
+    std::locale::global(std::locale("en_US.UTF-8"));
+    auto s = fmt::format("{:L}", 1000000);  // s == "1,000,000"
+
+`fmt/format.h` provides the following overloads of formatting functions
+that take `std::locale` as a parameter. The locale type is a template
+parameter to avoid the expensive `<locale>` include.
+
+::: format(detail::locale_ref, format_string<T...>, T&&...)
+
+::: format_to(OutputIt, detail::locale_ref, format_string<T...>, T&&...)
+
+::: formatted_size(detail::locale_ref, format_string<T...>, T&&...)
+
+<a id="legacy-checks"></a>
+### Legacy Compile-Time Checks
+
+`FMT_STRING` enables compile-time checks on older compilers. It requires
+C++14 or later and is a no-op in C++11.
+
+::: FMT_STRING
+
+To force the use of legacy compile-time checks, define the preprocessor
+variable `FMT_ENFORCE_COMPILE_STRING`. When set, functions accepting
+`FMT_STRING` will fail to compile with regular strings.
+
+<a id="ranges-api"></a>
+## Range and Tuple Formatting
+
+`fmt/ranges.h` provides formatting support for ranges and tuples:
+
+    #include <fmt/ranges.h>
+
+    fmt::print("{}", std::tuple<char, int>{'a', 42});
+    // Output: ('a', 42)
+
+Using `fmt::join`, you can separate tuple elements with a custom separator:
+
+    #include <fmt/ranges.h>
+
+    auto t = std::tuple<int, char>{1, 'a'};
+    fmt::print("{}", fmt::join(t, ", "));
+    // Output: 1, a
+
+::: join(Range&&, string_view)
+
+::: join(It, Sentinel, string_view)
+
+::: join(std::initializer_list<T>, string_view)
+
+<a id="chrono-api"></a>
+## Date and Time Formatting
+
+`fmt/chrono.h` provides formatters for
+
+- [`std::chrono::duration`](https://en.cppreference.com/w/cpp/chrono/duration)
+- [`std::chrono::time_point`](
+  https://en.cppreference.com/w/cpp/chrono/time_point)
+- [`std::tm`](https://en.cppreference.com/w/cpp/chrono/c/tm)
+
+The format syntax is described in [Chrono Format Specifications](syntax.md#
+chrono-format-specifications).
+
+**Example**:
+
+    #include <fmt/chrono.h>
+
+    int main() {
+      std::time_t t = std::time(nullptr);
+
+      fmt::print("The date is {:%Y-%m-%d}.", fmt::localtime(t));
+      // Output: The date is 2020-11-07.
+      // (with 2020-11-07 replaced by the current date)
+
+      using namespace std::literals::chrono_literals;
+
+      fmt::print("Default format: {} {}\n", 42s, 100ms);
+      // Output: Default format: 42s 100ms
+
+      fmt::print("strftime-like format: {:%H:%M:%S}\n", 3h + 15min + 30s);
+      // Output: strftime-like format: 03:15:30
+    }
+
+::: localtime(std::time_t)
+
+::: gmtime(std::time_t)
+
+<a id="std-api"></a>
+## Standard Library Types Formatting
+
+`fmt/std.h` provides formatters for:
+
+- [`std::atomic`](https://en.cppreference.com/w/cpp/atomic/atomic)
+- [`std::atomic_flag`](https://en.cppreference.com/w/cpp/atomic/atomic_flag)
+- [`std::bitset`](https://en.cppreference.com/w/cpp/utility/bitset)
+- [`std::error_code`](https://en.cppreference.com/w/cpp/error/error_code)
+- [`std::filesystem::path`](https://en.cppreference.com/w/cpp/filesystem/path)
+- [`std::monostate`](https://en.cppreference.com/w/cpp/utility/variant/monostate)
+- [`std::optional`](https://en.cppreference.com/w/cpp/utility/optional)
+- [`std::source_location`](https://en.cppreference.com/w/cpp/utility/source_location)
+- [`std::thread::id`](https://en.cppreference.com/w/cpp/thread/thread/id)
+- [`std::variant`](https://en.cppreference.com/w/cpp/utility/variant/variant)
+
+::: ptr(const std::unique_ptr<T, Deleter>&)
+
+::: ptr(const std::shared_ptr<T>&)
+
+### Formatting Variants
+
+A `std::variant` is only formattable if every variant alternative is
+formattable, and requires the `__cpp_lib_variant` [library
+feature](https://en.cppreference.com/w/cpp/feature_test).
+
+**Example**:
+
+    #include <fmt/std.h>
+
+    fmt::print("{}", std::variant<char, float>('x'));
+    // Output: variant('x')
+
+    fmt::print("{}", std::variant<std::monostate, char>());
+    // Output: variant(monostate)
+
+<a id="compile-api"></a>
+## Format String Compilation
+
+`fmt/compile.h` provides format string compilation enabled via the
+`FMT_COMPILE` macro or the `_cf` user-defined literal defined in
+namespace `fmt::literals`. Format strings marked with `FMT_COMPILE`
+or `_cf` are parsed, checked and converted into efficient formatting
+code at compile-time. This supports arguments of built-in and string
+types as well as user-defined types with `format` functions taking
+the format context type as a template parameter in their `formatter`
+specializations. For example:
+
+    template <> struct fmt::formatter<point> {
+      constexpr auto parse(format_parse_context& ctx);
+
+      template <typename FormatContext>
+      auto format(const point& p, FormatContext& ctx) const;
+    };
+
+Format string compilation can generate more binary code compared to the
+default API and is only recommended in places where formatting is a
+performance bottleneck.
+
+::: FMT_COMPILE
+
+::: operator""_cf
+
+<a id="color-api"></a>
+## Terminal Colors and Text Styles
+
+`fmt/color.h` provides support for terminal color and text style output.
+
+::: print(const text_style&, format_string<T...>, T&&...)
+
+::: fg(detail::color_type)
+
+::: bg(detail::color_type)
+
+::: styled(const T&, text_style)
+
+<a id="os-api"></a>
+## System APIs
+
+::: ostream
+
+::: windows_error
+
+<a id="ostream-api"></a>
+## `std::ostream` Support
+
+`fmt/ostream.h` provides `std::ostream` support including formatting of
+user-defined types that have an overloaded insertion operator
+(`operator<<`). In order to make a type formattable via `std::ostream`
+you should provide a `formatter` specialization inherited from
+`ostream_formatter`:
+
+    #include <fmt/ostream.h>
+
+    struct date {
+      int year, month, day;
+
+      friend std::ostream& operator<<(std::ostream& os, const date& d) {
+        return os << d.year << '-' << d.month << '-' << d.day;
+      }
+    };
+
+    template <> struct fmt::formatter<date> : ostream_formatter {};
+
+    std::string s = fmt::format("The date is {}", date{2012, 12, 9});
+    // s == "The date is 2012-12-9"
+
+::: streamed(const T&)
+
+::: print(std::ostream&, format_string<T...>, T&&...)
+
+<a id="args-api"></a>
+## Dynamic Argument Lists
+
+The header `fmt/args.h` provides `dynamic_format_arg_store`, a builder-like API
+that can be used to construct format argument lists dynamically.
+
+::: dynamic_format_arg_store
+
+<a id="printf-api"></a>
+## Safe `printf`
+
+The header `fmt/printf.h` provides `printf`-like formatting
+functionality. The following functions use [printf format string
+syntax](https://pubs.opengroup.org/onlinepubs/009695399/functions/fprintf.html)
+with the POSIX extension for positional arguments. Unlike their standard
+counterparts, the `fmt` functions are type-safe and throw an exception
+if an argument type doesn't match its format specification.
+
+::: printf(string_view, const T&...)
+
+::: fprintf(std::FILE*, const S&, const T&...)
+
+::: sprintf(const S&, const T&...)
+
+<a id="xchar-api"></a>
+## Wide Strings
+
+The optional header `fmt/xchar.h` provides support for `wchar_t` and
+exotic character types.
+
+::: is_char
+
+::: wstring_view
+
+::: wformat_context
+
+::: to_wstring(const T&)
+
+## Compatibility with C++20 `std::format`
+
+{fmt} implements nearly all of the [C++20 formatting
+library](https://en.cppreference.com/w/cpp/utility/format) with the
+following differences:
+
+- Names are defined in the `fmt` namespace instead of `std` to avoid
+  collisions with standard library implementations.
+- Width calculation doesn't use grapheme clusterization. The latter has
+  been implemented in a separate branch but hasn't been integrated yet.
diff --git a/doc/api.rst b/doc/api.rst
deleted file mode 100644
index 31b0328d..00000000
--- a/doc/api.rst
+++ /dev/null
@@ -1,678 +0,0 @@
-.. _string-formatting-api:
-
-*************
-API Reference
-*************
-
-The {fmt} library API consists of the following parts:
-
-* :ref:`fmt/core.h <core-api>`: the core API providing main formatting functions
-  for ``char``/UTF-8 with C++20 compile-time checks and minimal dependencies
-* :ref:`fmt/format.h <format-api>`: the full format API providing additional
-  formatting functions and locale support
-* :ref:`fmt/ranges.h <ranges-api>`: formatting of ranges and tuples
-* :ref:`fmt/chrono.h <chrono-api>`: date and time formatting
-* :ref:`fmt/std.h <std-api>`: formatters for standard library types
-* :ref:`fmt/compile.h <compile-api>`: format string compilation
-* :ref:`fmt/color.h <color-api>`: terminal color and text style
-* :ref:`fmt/os.h <os-api>`: system APIs
-* :ref:`fmt/ostream.h <ostream-api>`: ``std::ostream`` support
-* :ref:`fmt/args.h <args-api>`: dynamic argument lists
-* :ref:`fmt/printf.h <printf-api>`: ``printf`` formatting
-* :ref:`fmt/xchar.h <xchar-api>`: optional ``wchar_t`` support 
-
-All functions and types provided by the library reside in namespace ``fmt`` and
-macros have prefix ``FMT_``.
-
-.. _core-api:
-
-Core API
-========
-
-``fmt/core.h`` defines the core API which provides main formatting functions
-for ``char``/UTF-8 with C++20 compile-time checks. It has minimal include
-dependencies for better compile times. This header is only beneficial when
-using {fmt} as a library (the default) and not in the header-only mode.
-It also provides ``formatter`` specializations for built-in and string types.
-
-The following functions use :ref:`format string syntax <syntax>`
-similar to that of Python's `str.format
-<https://docs.python.org/3/library/stdtypes.html#str.format>`_.
-They take *fmt* and *args* as arguments.
-
-*fmt* is a format string that contains literal text and replacement fields
-surrounded by braces ``{}``. The fields are replaced with formatted arguments
-in the resulting string. `~fmt::format_string` is a format string which can be
-implicitly constructed from a string literal or a ``constexpr`` string and is
-checked at compile time in C++20. To pass a runtime format string wrap it in
-`fmt::runtime`.
-
-*args* is an argument list representing objects to be formatted.
-
-I/O errors are reported as `std::system_error
-<https://en.cppreference.com/w/cpp/error/system_error>`_ exceptions unless
-specified otherwise.
-
-.. _format:
-
-.. doxygenfunction:: format(format_string<T...> fmt, T&&... args) -> std::string
-.. doxygenfunction:: vformat(string_view fmt, format_args args) -> std::string
-
-.. doxygenfunction:: format_to(OutputIt out, format_string<T...> fmt, T&&... args) -> OutputIt
-.. doxygenfunction:: format_to_n(OutputIt out, size_t n, format_string<T...> fmt, T&&... args) -> format_to_n_result<OutputIt>
-.. doxygenfunction:: formatted_size(format_string<T...> fmt, T&&... args) -> size_t
-
-.. doxygenstruct:: fmt::format_to_n_result
-   :members:
-
-.. _print:
-
-.. doxygenfunction:: fmt::print(format_string<T...> fmt, T&&... args)
-.. doxygenfunction:: fmt::vprint(string_view fmt, format_args args)
-
-.. doxygenfunction:: print(std::FILE *f, format_string<T...> fmt, T&&... args)
-.. doxygenfunction:: vprint(std::FILE *f, string_view fmt, format_args args)
-
-Compile-Time Format String Checks
----------------------------------
-
-Compile-time format string checks are enabled by default on compilers
-that support C++20 ``consteval``. On older compilers you can use the
-:ref:`FMT_STRING <legacy-checks>`: macro defined in ``fmt/format.h`` instead.
-
-Unused arguments are allowed as in Python's `str.format` and ordinary functions.
-
-.. doxygenclass:: fmt::basic_format_string
-   :members:
-
-.. doxygentypedef:: fmt::format_string
-
-.. doxygenfunction:: fmt::runtime(string_view) -> runtime_format_string<>
-
-.. _udt:
-
-Formatting User-Defined Types
------------------------------
-
-The {fmt} library provides formatters for many standard C++ types.
-See :ref:`fmt/ranges.h <ranges-api>` for ranges and tuples including standard
-containers such as ``std::vector``, :ref:`fmt/chrono.h <chrono-api>` for date
-and time formatting and :ref:`fmt/std.h <std-api>` for other standard library
-types.
-
-There are two ways to make a user-defined type formattable: providing a
-``format_as`` function or specializing the ``formatter`` struct template.
-
-Use ``format_as`` if you want to make your type formattable as some other type
-with the same format specifiers. The ``format_as`` function should take an
-object of your type and return an object of a formattable type. It should be
-defined in the same namespace as your type.
-
-Example (https://godbolt.org/z/nvME4arz8)::
-
-  #include <fmt/format.h>
-
-  namespace kevin_namespacy {
-  enum class film {
-    house_of_cards, american_beauty, se7en = 7
-  };
-  auto format_as(film f) { return fmt::underlying(f); }
-  }
-
-  int main() {
-    fmt::print("{}\n", kevin_namespacy::film::se7en); // prints "7"
-  }
-
-Using specialization is more complex but gives you full control over parsing and
-formatting. To use this method specialize the ``formatter`` struct template for
-your type and implement ``parse`` and ``format`` methods.
-
-The recommended way of defining a formatter is by reusing an existing one via
-inheritance or composition. This way you can support standard format specifiers
-without implementing them yourself. For example::
-
-  // color.h:
-  #include <fmt/core.h>
-
-  enum class color {red, green, blue};
-
-  template <> struct fmt::formatter<color>: formatter<string_view> {
-    // parse is inherited from formatter<string_view>.
-
-    auto format(color c, format_context& ctx) const;
-  };
-
-  // color.cc:
-  #include "color.h"
-  #include <fmt/format.h>
-
-  auto fmt::formatter<color>::format(color c, format_context& ctx) const {
-    string_view name = "unknown";
-    switch (c) {
-    case color::red:   name = "red"; break;
-    case color::green: name = "green"; break;
-    case color::blue:  name = "blue"; break;
-    }
-    return formatter<string_view>::format(name, ctx);
-  }
-
-Note that ``formatter<string_view>::format`` is defined in ``fmt/format.h`` so
-it has to be included in the source file. Since ``parse`` is inherited from
-``formatter<string_view>`` it will recognize all string format specifications,
-for example
-
-.. code-block:: c++
-
-   fmt::format("{:>10}", color::blue)
-
-will return ``"      blue"``.
-
-The experimental ``nested_formatter`` provides an easy way of applying a
-formatter to one or more subobjects.
-
-For example::
-
-  #include <fmt/format.h>
-
-  struct point {
-    double x, y;
-  };
-
-  template <>
-  struct fmt::formatter<point> : nested_formatter<double> {
-    auto format(point p, format_context& ctx) const {
-      return write_padded(ctx, [=](auto out) {
-        return format_to(out, "({}, {})", nested(p.x), nested(p.y));
-      });
-    }
-  };
-
-  int main() {
-    fmt::print("[{:>20.2f}]", point{1, 2});
-  }
-
-prints::
-
-  [          (1.00, 2.00)]
-
-Notice that fill, align and width are applied to the whole object which is the
-recommended behavior while the remaining specifiers apply to elements.
-
-In general the formatter has the following form::
-
-  template <> struct fmt::formatter<T> {
-    // Parses format specifiers and stores them in the formatter.
-    //
-    // [ctx.begin(), ctx.end()) is a, possibly empty, character range that
-    // contains a part of the format string starting from the format
-    // specifications to be parsed, e.g. in
-    //
-    //   fmt::format("{:f} continued", ...);
-    //
-    // the range will contain "f} continued". The formatter should parse
-    // specifiers until '}' or the end of the range. In this example the
-    // formatter should parse the 'f' specifier and return an iterator
-    // pointing to '}'.
-    constexpr auto parse(format_parse_context& ctx)
-      -> format_parse_context::iterator;
-
-    // Formats value using the parsed format specification stored in this
-    // formatter and writes the output to ctx.out().
-    auto format(const T& value, format_context& ctx) const
-      -> format_context::iterator;
-  };
-
-It is recommended to at least support fill, align and width that apply to the
-whole object and have the same semantics as in standard formatters.
-
-You can also write a formatter for a hierarchy of classes::
-
-  // demo.h:
-  #include <type_traits>
-  #include <fmt/core.h>
-
-  struct A {
-    virtual ~A() {}
-    virtual std::string name() const { return "A"; }
-  };
-
-  struct B : A {
-    virtual std::string name() const { return "B"; }
-  };
-
-  template <typename T>
-  struct fmt::formatter<T, std::enable_if_t<std::is_base_of<A, T>::value, char>> :
-      fmt::formatter<std::string> {
-    auto format(const A& a, format_context& ctx) const {
-      return fmt::formatter<std::string>::format(a.name(), ctx);
-    }
-  };
-
-  // demo.cc:
-  #include "demo.h"
-  #include <fmt/format.h>
-
-  int main() {
-    B b;
-    A& a = b;
-    fmt::print("{}", a); // prints "B"
-  }
-
-Providing both a ``formatter`` specialization and a ``format_as`` overload is
-disallowed.
-
-Named Arguments
----------------
-
-.. doxygenfunction:: fmt::arg(const S&, const T&)
-
-Named arguments are not supported in compile-time checks at the moment.
-
-Argument Lists
---------------
-
-You can create your own formatting function with compile-time checks and small
-binary footprint, for example (https://godbolt.org/z/vajfWEG4b):
-
-.. code:: c++
-
-    #include <fmt/core.h>
-
-    void vlog(const char* file, int line, fmt::string_view format,
-              fmt::format_args args) {
-      fmt::print("{}: {}: ", file, line);
-      fmt::vprint(format, args);
-    }
-
-    template <typename... T>
-    void log(const char* file, int line, fmt::format_string<T...> format, T&&... args) {
-      vlog(file, line, format, fmt::make_format_args(args...));
-    }
-
-    #define MY_LOG(format, ...) log(__FILE__, __LINE__, format, __VA_ARGS__)
-
-    MY_LOG("invalid squishiness: {}", 42);
-
-Note that ``vlog`` is not parameterized on argument types which improves compile
-times and reduces binary code size compared to a fully parameterized version.
-
-.. doxygenfunction:: fmt::make_format_args(const Args&...)
-
-.. doxygenclass:: fmt::format_arg_store
-   :members:
-
-.. doxygenclass:: fmt::basic_format_args
-   :members:
-
-.. doxygentypedef:: fmt::format_args
-
-.. doxygenclass:: fmt::basic_format_arg
-   :members:
-
-.. doxygenclass:: fmt::basic_format_parse_context
-   :members:
-
-.. doxygenclass:: fmt::basic_format_context
-   :members:
-
-.. doxygentypedef:: fmt::format_context
-
-.. _args-api:
-
-Dynamic Argument Lists
-----------------------
-
-The header ``fmt/args.h`` provides ``dynamic_format_arg_store``, a builder-like
-API that can be used to construct format argument lists dynamically.
-
-.. doxygenclass:: fmt::dynamic_format_arg_store
-   :members:
-
-Compatibility
--------------
-
-.. doxygenclass:: fmt::basic_string_view
-   :members:
-
-.. doxygentypedef:: fmt::string_view
-
-.. _format-api:
-
-Format API
-==========
-
-``fmt/format.h`` defines the full format API providing additional formatting
-functions and locale support.
-
-Literal-Based API
------------------
-
-The following user-defined literals are defined in ``fmt/format.h``.
-
-.. doxygenfunction:: operator""_a()
-
-Utilities
----------
-
-.. doxygenfunction:: fmt::ptr(T p) -> const void*
-.. doxygenfunction:: fmt::ptr(const std::unique_ptr<T, Deleter> &p) -> const void*
-.. doxygenfunction:: fmt::ptr(const std::shared_ptr<T> &p) -> const void*
-
-.. doxygenfunction:: fmt::underlying(Enum e) -> typename std::underlying_type<Enum>::type
-
-.. doxygenfunction:: fmt::to_string(const T &value) -> std::string
-
-.. doxygenfunction:: fmt::join(Range &&range, string_view sep) -> join_view<detail::iterator_t<Range>, detail::sentinel_t<Range>>
-
-.. doxygenfunction:: fmt::join(It begin, Sentinel end, string_view sep) -> join_view<It, Sentinel>
-
-.. doxygenfunction:: fmt::group_digits(T value) -> group_digits_view<T>
-
-.. doxygenclass:: fmt::detail::buffer
-   :members:
-
-.. doxygenclass:: fmt::basic_memory_buffer
-   :protected-members:
-   :members:
-
-System Errors
--------------
-
-{fmt} does not use ``errno`` to communicate errors to the user, but it may call
-system functions which set ``errno``. Users should not make any assumptions
-about the value of ``errno`` being preserved by library functions.
-
-.. doxygenfunction:: fmt::system_error
-
-.. doxygenfunction:: fmt::format_system_error
-
-Custom Allocators
------------------
-
-The {fmt} library supports custom dynamic memory allocators.
-A custom allocator class can be specified as a template argument to
-:class:`fmt::basic_memory_buffer`::
-
-    using custom_memory_buffer = 
-      fmt::basic_memory_buffer<char, fmt::inline_buffer_size, custom_allocator>;
-
-It is also possible to write a formatting function that uses a custom
-allocator::
-
-    using custom_string =
-      std::basic_string<char, std::char_traits<char>, custom_allocator>;
-
-    custom_string vformat(custom_allocator alloc, fmt::string_view format_str,
-                          fmt::format_args args) {
-      auto buf = custom_memory_buffer(alloc);
-      fmt::vformat_to(std::back_inserter(buf), format_str, args);
-      return custom_string(buf.data(), buf.size(), alloc);
-    }
-
-    template <typename ...Args>
-    inline custom_string format(custom_allocator alloc,
-                                fmt::string_view format_str,
-                                const Args& ... args) {
-      return vformat(alloc, format_str, fmt::make_format_args(args...));
-    }
-
-The allocator will be used for the output container only. Formatting functions
-normally don't do any allocations for built-in and string types except for
-non-default floating-point formatting that occasionally falls back on
-``sprintf``.
-
-Locale
-------
-
-All formatting is locale-independent by default. Use the ``'L'`` format
-specifier to insert the appropriate number separator characters from the
-locale::
-
-  #include <fmt/core.h>
-  #include <locale>
-
-  std::locale::global(std::locale("en_US.UTF-8"));
-  auto s = fmt::format("{:L}", 1000000);  // s == "1,000,000"
-
-``fmt/format.h`` provides the following overloads of formatting functions that
-take ``std::locale`` as a parameter. The locale type is a template parameter to
-avoid the expensive ``<locale>`` include.
-
-.. doxygenfunction:: format(const Locale& loc, format_string<T...> fmt, T&&... args) -> std::string
-.. doxygenfunction:: format_to(OutputIt out, const Locale& loc, format_string<T...> fmt, T&&... args) -> OutputIt
-.. doxygenfunction:: formatted_size(const Locale& loc, format_string<T...> fmt, T&&... args) -> size_t
-
-.. _legacy-checks:
-
-Legacy Compile-Time Format String Checks
-----------------------------------------
-
-``FMT_STRING`` enables compile-time checks on older compilers. It requires C++14
-or later and is a no-op in C++11.
-
-.. doxygendefine:: FMT_STRING
-
-To force the use of legacy compile-time checks, define the preprocessor variable
-``FMT_ENFORCE_COMPILE_STRING``. When set, functions accepting ``FMT_STRING``
-will fail to compile with regular strings.
-
-.. _ranges-api:
-
-Range and Tuple Formatting
-==========================
-
-The library also supports convenient formatting of ranges and tuples::
-
-  #include <fmt/ranges.h>
-
-  std::tuple<char, int, float> t{'a', 1, 2.0f};
-  // Prints "('a', 1, 2.0)"
-  fmt::print("{}", t);
-
-
-NOTE: currently, the overload of ``fmt::join`` for iterables exists in the main
-``format.h`` header, but expect this to change in the future.
-
-Using ``fmt::join``, you can separate tuple elements with a custom separator::
-
-  #include <fmt/ranges.h>
-
-  std::tuple<int, char> t = {1, 'a'};
-  // Prints "1, a"
-  fmt::print("{}", fmt::join(t, ", "));
-
-.. _chrono-api:
-
-Date and Time Formatting
-========================
-
-``fmt/chrono.h`` provides formatters for
-
-* `std::chrono::duration <https://en.cppreference.com/w/cpp/chrono/duration>`_
-* `std::chrono::time_point
-  <https://en.cppreference.com/w/cpp/chrono/time_point>`_
-* `std::tm <https://en.cppreference.com/w/cpp/chrono/c/tm>`_
-
-The format syntax is described in :ref:`chrono-specs`.
-
-**Example**::
-
-  #include <fmt/chrono.h>
-
-  int main() {
-    std::time_t t = std::time(nullptr);
-
-    // Prints "The date is 2020-11-07." (with the current date):
-    fmt::print("The date is {:%Y-%m-%d}.", fmt::localtime(t));
-
-    using namespace std::literals::chrono_literals;
-
-    // Prints "Default format: 42s 100ms":
-    fmt::print("Default format: {} {}\n", 42s, 100ms);
-
-    // Prints "strftime-like format: 03:15:30":
-    fmt::print("strftime-like format: {:%H:%M:%S}\n", 3h + 15min + 30s);
-  }
-
-.. doxygenfunction:: localtime(std::time_t time)
-
-.. doxygenfunction:: gmtime(std::time_t time)
-
-.. _std-api:
-
-Standard Library Types Formatting
-=================================
-
-``fmt/std.h`` provides formatters for:
-
-* `std::filesystem::path <https://en.cppreference.com/w/cpp/filesystem/path>`_
-* `std::thread::id <https://en.cppreference.com/w/cpp/thread/thread/id>`_
-* `std::monostate <https://en.cppreference.com/w/cpp/utility/variant/monostate>`_
-* `std::variant <https://en.cppreference.com/w/cpp/utility/variant/variant>`_
-* `std::optional <https://en.cppreference.com/w/cpp/utility/optional>`_
-
-Formatting Variants
--------------------
-
-A ``std::variant`` is only formattable if every variant alternative is formattable, and requires the
-``__cpp_lib_variant`` `library feature <https://en.cppreference.com/w/cpp/feature_test>`_.
-  
-**Example**::
-
-  #include <fmt/std.h>
-
-  std::variant<char, float> v0{'x'};
-  // Prints "variant('x')"
-  fmt::print("{}", v0);
-
-  std::variant<std::monostate, char> v1;
-  // Prints "variant(monostate)"
-
-.. _compile-api:
-
-Format String Compilation
-=========================
-
-``fmt/compile.h`` provides format string compilation enabled via the
-``FMT_COMPILE`` macro or the ``_cf`` user-defined literal. Format strings
-marked with ``FMT_COMPILE`` or ``_cf`` are parsed, checked and converted into
-efficient formatting code at compile-time. This supports arguments of built-in
-and string types as well as user-defined types with ``format`` functions taking
-the format context type as a template parameter in their ``formatter``
-specializations. For example::
-
-  template <> struct fmt::formatter<point> {
-    constexpr auto parse(format_parse_context& ctx);
-
-    template <typename FormatContext>
-    auto format(const point& p, FormatContext& ctx) const;
-  };
-
-Format string compilation can generate more binary code compared to the default
-API and is only recommended in places where formatting is a performance
-bottleneck.
-
-.. doxygendefine:: FMT_COMPILE
-
-.. doxygenfunction:: operator""_cf()
-
-.. _color-api:
-
-Terminal Color and Text Style
-=============================
-
-``fmt/color.h`` provides support for terminal color and text style output.
-
-.. doxygenfunction:: print(const text_style &ts, const S &format_str, const Args&... args)
-
-.. doxygenfunction:: fg(detail::color_type)
-
-.. doxygenfunction:: bg(detail::color_type)
-
-.. doxygenfunction:: styled(const T& value, text_style ts)
-
-.. _os-api:
-
-System APIs
-===========
-
-.. doxygenclass:: fmt::ostream
-   :members:
-
-.. doxygenfunction:: fmt::windows_error
-
-.. _ostream-api:
-
-``std::ostream`` Support
-========================
-
-``fmt/ostream.h`` provides ``std::ostream`` support including formatting of
-user-defined types that have an overloaded insertion operator (``operator<<``).
-In order to make a type formattable via ``std::ostream`` you should provide a
-``formatter`` specialization inherited from ``ostream_formatter``::
-
-  #include <fmt/ostream.h>
-
-  struct date {
-    int year, month, day;
-
-    friend std::ostream& operator<<(std::ostream& os, const date& d) {
-      return os << d.year << '-' << d.month << '-' << d.day;
-    }
-  };
-
-  template <> struct fmt::formatter<date> : ostream_formatter {};
-
-  std::string s = fmt::format("The date is {}", date{2012, 12, 9});
-  // s == "The date is 2012-12-9"
-
-.. doxygenfunction:: streamed(const T &)
-
-.. doxygenfunction:: print(std::ostream &os, format_string<T...> fmt, T&&... args)
-
-.. _printf-api:
-
-``printf`` Formatting
-=====================
-
-The header ``fmt/printf.h`` provides ``printf``-like formatting functionality.
-The following functions use `printf format string syntax
-<https://pubs.opengroup.org/onlinepubs/009695399/functions/fprintf.html>`_ with
-the POSIX extension for positional arguments. Unlike their standard
-counterparts, the ``fmt`` functions are type-safe and throw an exception if an
-argument type doesn't match its format specification.
-
-.. doxygenfunction:: printf(string_view fmt, const T&... args) -> int
-
-.. doxygenfunction:: fprintf(std::FILE *f, const S &fmt, const T&... args) -> int
-
-.. doxygenfunction:: sprintf(const S&, const T&...)
-
-.. _xchar-api:
-
-``wchar_t`` Support
-===================
-
-The optional header ``fmt/xchar.h`` provides support for ``wchar_t`` and exotic
-character types.
-
-.. doxygenstruct:: fmt::is_char
-
-.. doxygentypedef:: fmt::wstring_view
-
-.. doxygentypedef:: fmt::wformat_context
-
-.. doxygenfunction:: fmt::to_wstring(const T &value)
-
-Compatibility with C++20 ``std::format``
-========================================
-
-{fmt} implements nearly all of the `C++20 formatting library
-<https://en.cppreference.com/w/cpp/utility/format>`_ with the following
-differences:
-
-* Names are defined in the ``fmt`` namespace instead of ``std`` to avoid
-  collisions with standard library implementations.
-* Width calculation doesn't use grapheme clusterization. The latter has been
-  implemented in a separate branch but hasn't been integrated yet.
-* Most C++20 chrono types are not supported yet.
diff --git a/doc/basic-bootstrap/README b/doc/basic-bootstrap/README
deleted file mode 100644
index ba67700d..00000000
--- a/doc/basic-bootstrap/README
+++ /dev/null
@@ -1,2 +0,0 @@
-Sphinx basic theme with Bootstrap support. Modifications are kept to
-a minimum to simplify integration in case of changes to Sphinx theming.
diff --git a/doc/basic-bootstrap/layout.html b/doc/basic-bootstrap/layout.html
deleted file mode 100644
index 5519c4b5..00000000
--- a/doc/basic-bootstrap/layout.html
+++ /dev/null
@@ -1,208 +0,0 @@
-{#
-    basic/layout.html
-    ~~~~~~~~~~~~~~~~~
-
-    Master layout template for Sphinx themes.
-
-    :copyright: Copyright 2007-2015 by the Sphinx team, see AUTHORS.
-    :license: BSD, see LICENSE for details.
-#}
-{%- block doctype -%}
-<!DOCTYPE html>
-{%- endblock %}
-{%- set reldelim1 = reldelim1 is not defined and ' &raquo;' or reldelim1 %}
-{%- set reldelim2 = reldelim2 is not defined and ' |' or reldelim2 %}
-{%- set render_sidebar = (not embedded) and (not theme_nosidebar|tobool) and
-                         (sidebars != []) %}
-{%- set url_root = pathto('', 1) %}
-{# XXX necessary? #}
-{%- if url_root == '#' %}{% set url_root = '' %}{% endif %}
-{%- if not embedded and docstitle %}
-  {%- set titlesuffix = " &mdash; "|safe + docstitle|e %}
-{%- else %}
-  {%- set titlesuffix = "" %}
-{%- endif %}
-
-{%- macro relbar() %}
-    <div class="related" role="navigation" aria-label="related navigation">
-      <h3>{{ _('Navigation') }}</h3>
-      <ul>
-        {%- for rellink in rellinks %}
-        <li class="right" {% if loop.first %}style="margin-right: 10px"{% endif %}>
-          <a href="{{ pathto(rellink[0]) }}" title="{{ rellink[1]|striptags|e }}"
-             {{ accesskey(rellink[2]) }}>{{ rellink[3] }}</a>
-          {%- if not loop.first %}{{ reldelim2 }}{% endif %}</li>
-        {%- endfor %}
-        {%- block rootrellink %}
-        <li class="nav-item nav-item-0"><a href="{{ pathto(master_doc) }}">{{ shorttitle|e }}</a>{{ reldelim1 }}</li>
-        {%- endblock %}
-        {%- for parent in parents %}
-          <li class="nav-item nav-item-{{ loop.index }}"><a href="{{ parent.link|e }}" {% if loop.last %}{{ accesskey("U") }}{% endif %}>{{ parent.title }}</a>{{ reldelim1 }}</li>
-        {%- endfor %}
-        {%- block relbaritems %} {% endblock %}
-      </ul>
-    </div>
-{%- endmacro %}
-
-{%- macro sidebar() %}
-      {%- if render_sidebar %}
-      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
-        <div class="sphinxsidebarwrapper">
-          {%- block sidebarlogo %}
-          {%- if logo %}
-            <p class="logo"><a href="{{ pathto(master_doc) }}">
-              <img class="logo" src="{{ pathto('_static/' + logo, 1) }}" alt="Logo"/>
-            </a></p>
-          {%- endif %}
-          {%- endblock %}
-          {%- if sidebars != None %}
-            {#- new style sidebar: explicitly include/exclude templates #}
-            {%- for sidebartemplate in sidebars %}
-            {%- include sidebartemplate %}
-            {%- endfor %}
-          {%- else %}
-            {#- old style sidebars: using blocks -- should be deprecated #}
-            {%- block sidebartoc %}
-            {%- include "localtoc.html" %}
-            {%- endblock %}
-            {%- block sidebarrel %}
-            {%- include "relations.html" %}
-            {%- endblock %}
-            {%- block sidebarsourcelink %}
-            {%- include "sourcelink.html" %}
-            {%- endblock %}
-            {%- if customsidebar %}
-            {%- include customsidebar %}
-            {%- endif %}
-            {%- block sidebarsearch %}
-            {%- include "searchbox.html" %}
-            {%- endblock %}
-          {%- endif %}
-        </div>
-      </div>
-      {%- endif %}
-{%- endmacro %}
-
-{%- macro script() %}
-    <script type="text/javascript">
-      var DOCUMENTATION_OPTIONS = {
-        URL_ROOT:    '{{ url_root }}',
-        VERSION:     '{{ release|e }}',
-        COLLAPSE_INDEX: false,
-        FILE_SUFFIX: '{{ '' if no_search_suffix else file_suffix }}',
-        LINK_SUFFIX: '{{ link_suffix }}',
-        SOURCELINK_SUFFIX: '{{ sourcelink_suffix }}',
-        HAS_SOURCE:  {{ has_source|lower }},
-        SOURCELINK_SUFFIX:  '{{ sourcelink_suffix }}'
-      };
-    </script>
-    {%- for scriptfile in script_files %}
-    {{ js_tag(scriptfile) }}
-    {%- endfor %}
-{%- endmacro %}
-
-{%- macro css() %}
-    <link rel="stylesheet" href="{{ pathto('_static/' + style, 1) }}" type="text/css" />
-    <link rel="stylesheet" href="{{ pathto('_static/pygments.css', 1) }}" type="text/css" />
-    {%- for cssfile in css_files %}
-    <link rel="stylesheet" href="{{ pathto(cssfile, 1) }}" type="text/css" />
-    {%- endfor %}
-{%- endmacro %}
-
-<html lang="en">
-  <head>
-    <meta charset="{{ encoding }}">
-    <meta http-equiv="X-UA-Compatible" content="IE=edge">
-    <meta name="viewport" content="width=device-width, initial-scale=1">
-    {# The above 3 meta tags *must* come first in the head; any other head content
-       must come *after* these tags. #}
-    {{ metatags }}
-    {%- block htmltitle %}
-    <title>{{ title|striptags|e }}{{ titlesuffix }}</title>
-    {%- endblock %}
-    {{ css() }}
-    {%- if not embedded %}
-    {{ script() }}
-    {%- if use_opensearch %}
-    <link rel="search" type="application/opensearchdescription+xml"
-          title="{% trans docstitle=docstitle|e %}Search within {{ docstitle }}{% endtrans %}"
-          href="{{ pathto('_static/opensearch.xml', 1) }}"/>
-    {%- endif %}
-    {%- if favicon %}
-    <link rel="shortcut icon" href="{{ pathto('_static/' + favicon, 1) }}"/>
-    {%- endif %}
-    {%- endif %}
-{%- block linktags %}
-    {%- if hasdoc('about') %}
-    <link rel="author" title="{{ _('About these documents') }}" href="{{ pathto('about') }}" />
-    {%- endif %}
-    {%- if hasdoc('genindex') %}
-    <link rel="index" title="{{ _('Index') }}" href="{{ pathto('genindex') }}" />
-    {%- endif %}
-    {%- if hasdoc('search') %}
-    <link rel="search" title="{{ _('Search') }}" href="{{ pathto('search') }}" />
-    {%- endif %}
-    {%- if hasdoc('copyright') %}
-    <link rel="copyright" title="{{ _('Copyright') }}" href="{{ pathto('copyright') }}" />
-    {%- endif %}
-    {%- if parents %}
-    <link rel="up" title="{{ parents[-1].title|striptags|e }}" href="{{ parents[-1].link|e }}" />
-    {%- endif %}
-    {%- if next %}
-    <link rel="next" title="{{ next.title|striptags|e }}" href="{{ next.link|e }}" />
-    {%- endif %}
-    {%- if prev %}
-    <link rel="prev" title="{{ prev.title|striptags|e }}" href="{{ prev.link|e }}" />
-    {%- endif %}
-{%- endblock %}
-{%- block extrahead %} {% endblock %}
-  </head>
-  <body role="document">
-{%- block header %}{% endblock %}
-
-{%- block relbar1 %}{{ relbar() }}{% endblock %}
-
-{%- block content %}
-  {%- block sidebar1 %} {# possible location for sidebar #} {% endblock %}
-
-    <div class="document">
-  {%- block document %}
-      <div class="documentwrapper">
-      {%- if render_sidebar %}
-        <div class="bodywrapper">
-      {%- endif %}
-          <div class="body" role="main">
-            {% block body %} {% endblock %}
-          </div>
-      {%- if render_sidebar %}
-        </div>
-      {%- endif %}
-      </div>
-  {%- endblock %}
-
-  {%- block sidebar2 %}{{ sidebar() }}{% endblock %}
-      <div class="clearer"></div>
-    </div>
-{%- endblock %}
-
-{%- block relbar2 %}{{ relbar() }}{% endblock %}
-
-{%- block footer %}
-    <div class="footer" role="contentinfo">
-    {%- if show_copyright %}
-      {%- if hasdoc('copyright') %}
-        {% trans path=pathto('copyright'), copyright=copyright|e %}&copy; <a href="{{ path }}">Copyright</a> {{ copyright }}.{% endtrans %}
-      {%- else %}
-        {% trans copyright=copyright|e %}&copy; Copyright {{ copyright }}.{% endtrans %}
-      {%- endif %}
-    {%- endif %}
-    {%- if last_updated %}
-      {% trans last_updated=last_updated|e %}Last updated on {{ last_updated }}.{% endtrans %}
-    {%- endif %}
-    {%- if show_sphinx %}
-      {% trans sphinx_version=sphinx_version|e %}Created using <a href="http://sphinx-doc.org/">Sphinx</a> {{ sphinx_version }}.{% endtrans %}
-    {%- endif %}
-    </div>
-{%- endblock %}
-  </body>
-</html>
diff --git a/doc/basic-bootstrap/theme.conf b/doc/basic-bootstrap/theme.conf
deleted file mode 100644
index 89e03bbd..00000000
--- a/doc/basic-bootstrap/theme.conf
+++ /dev/null
@@ -1,2 +0,0 @@
-[theme]
-inherit = basic
diff --git a/doc/bootstrap/alerts.less b/doc/bootstrap/alerts.less
deleted file mode 100644
index c4199db9..00000000
--- a/doc/bootstrap/alerts.less
+++ /dev/null
@@ -1,73 +0,0 @@
-//
-// Alerts
-// --------------------------------------------------
-
-
-// Base styles
-// -------------------------
-
-.alert {
-  padding: @alert-padding;
-  margin-bottom: @line-height-computed;
-  border: 1px solid transparent;
-  border-radius: @alert-border-radius;
-
-  // Headings for larger alerts
-  h4 {
-    margin-top: 0;
-    // Specified for the h4 to prevent conflicts of changing @headings-color
-    color: inherit;
-  }
-
-  // Provide class for links that match alerts
-  .alert-link {
-    font-weight: @alert-link-font-weight;
-  }
-
-  // Improve alignment and spacing of inner content
-  > p,
-  > ul {
-    margin-bottom: 0;
-  }
-
-  > p + p {
-    margin-top: 5px;
-  }
-}
-
-// Dismissible alerts
-//
-// Expand the right padding and account for the close button's positioning.
-
-.alert-dismissable, // The misspelled .alert-dismissable was deprecated in 3.2.0.
-.alert-dismissible {
-  padding-right: (@alert-padding + 20);
-
-  // Adjust close link position
-  .close {
-    position: relative;
-    top: -2px;
-    right: -21px;
-    color: inherit;
-  }
-}
-
-// Alternate styles
-//
-// Generate contextual modifier classes for colorizing the alert.
-
-.alert-success {
-  .alert-variant(@alert-success-bg; @alert-success-border; @alert-success-text);
-}
-
-.alert-info {
-  .alert-variant(@alert-info-bg; @alert-info-border; @alert-info-text);
-}
-
-.alert-warning {
-  .alert-variant(@alert-warning-bg; @alert-warning-border; @alert-warning-text);
-}
-
-.alert-danger {
-  .alert-variant(@alert-danger-bg; @alert-danger-border; @alert-danger-text);
-}
diff --git a/doc/bootstrap/badges.less b/doc/bootstrap/badges.less
deleted file mode 100644
index c70bb939..00000000
--- a/doc/bootstrap/badges.less
+++ /dev/null
@@ -1,66 +0,0 @@
-//
-// Badges
-// --------------------------------------------------
-
-
-// Base class
-.badge {
-  display: inline-block;
-  min-width: 10px;
-  padding: 3px 7px;
-  font-size: @font-size-small;
-  font-weight: @badge-font-weight;
-  color: @badge-color;
-  line-height: @badge-line-height;
-  vertical-align: baseline;
-  white-space: nowrap;
-  text-align: center;
-  background-color: @badge-bg;
-  border-radius: @badge-border-radius;
-
-  // Empty badges collapse automatically (not available in IE8)
-  &:empty {
-    display: none;
-  }
-
-  // Quick fix for badges in buttons
-  .btn & {
-    position: relative;
-    top: -1px;
-  }
-
-  .btn-xs &,
-  .btn-group-xs > .btn & {
-    top: 0;
-    padding: 1px 5px;
-  }
-
-  // Hover state, but only for links
-  a& {
-    &:hover,
-    &:focus {
-      color: @badge-link-hover-color;
-      text-decoration: none;
-      cursor: pointer;
-    }
-  }
-
-  // Account for badges in navs
-  .list-group-item.active > &,
-  .nav-pills > .active > a > & {
-    color: @badge-active-color;
-    background-color: @badge-active-bg;
-  }
-
-  .list-group-item > & {
-    float: right;
-  }
-
-  .list-group-item > & + & {
-    margin-right: 5px;
-  }
-
-  .nav-pills > li > a > & {
-    margin-left: 3px;
-  }
-}
diff --git a/doc/bootstrap/bootstrap.less b/doc/bootstrap/bootstrap.less
deleted file mode 100644
index 61b77474..00000000
--- a/doc/bootstrap/bootstrap.less
+++ /dev/null
@@ -1,50 +0,0 @@
-// Core variables and mixins
-@import "variables.less";
-@import "mixins.less";
-
-// Reset and dependencies
-@import "normalize.less";
-@import "print.less";
-@import "glyphicons.less";
-
-// Core CSS
-@import "scaffolding.less";
-@import "type.less";
-@import "code.less";
-@import "grid.less";
-@import "tables.less";
-@import "forms.less";
-@import "buttons.less";
-
-// Components
-@import "component-animations.less";
-@import "dropdowns.less";
-@import "button-groups.less";
-@import "input-groups.less";
-@import "navs.less";
-@import "navbar.less";
-@import "breadcrumbs.less";
-@import "pagination.less";
-@import "pager.less";
-@import "labels.less";
-@import "badges.less";
-@import "jumbotron.less";
-@import "thumbnails.less";
-@import "alerts.less";
-@import "progress-bars.less";
-@import "media.less";
-@import "list-group.less";
-@import "panels.less";
-@import "responsive-embed.less";
-@import "wells.less";
-@import "close.less";
-
-// Components w/ JavaScript
-@import "modals.less";
-@import "tooltip.less";
-@import "popovers.less";
-@import "carousel.less";
-
-// Utility classes
-@import "utilities.less";
-@import "responsive-utilities.less";
diff --git a/doc/bootstrap/breadcrumbs.less b/doc/bootstrap/breadcrumbs.less
deleted file mode 100644
index cb01d503..00000000
--- a/doc/bootstrap/breadcrumbs.less
+++ /dev/null
@@ -1,26 +0,0 @@
-//
-// Breadcrumbs
-// --------------------------------------------------
-
-
-.breadcrumb {
-  padding: @breadcrumb-padding-vertical @breadcrumb-padding-horizontal;
-  margin-bottom: @line-height-computed;
-  list-style: none;
-  background-color: @breadcrumb-bg;
-  border-radius: @border-radius-base;
-
-  > li {
-    display: inline-block;
-
-    + li:before {
-      content: "@{breadcrumb-separator}\00a0"; // Unicode space added since inline-block means non-collapsing white-space
-      padding: 0 5px;
-      color: @breadcrumb-color;
-    }
-  }
-
-  > .active {
-    color: @breadcrumb-active-color;
-  }
-}
diff --git a/doc/bootstrap/button-groups.less b/doc/bootstrap/button-groups.less
deleted file mode 100644
index 13c1800d..00000000
--- a/doc/bootstrap/button-groups.less
+++ /dev/null
@@ -1,243 +0,0 @@
-//
-// Button groups
-// --------------------------------------------------
-
-// Make the div behave like a button
-.btn-group,
-.btn-group-vertical {
-  position: relative;
-  display: inline-block;
-  vertical-align: middle; // match .btn alignment given font-size hack above
-  > .btn {
-    position: relative;
-    float: left;
-    // Bring the "active" button to the front
-    &:hover,
-    &:focus,
-    &:active,
-    &.active {
-      z-index: 2;
-    }
-  }
-}
-
-// Prevent double borders when buttons are next to each other
-.btn-group {
-  .btn + .btn,
-  .btn + .btn-group,
-  .btn-group + .btn,
-  .btn-group + .btn-group {
-    margin-left: -1px;
-  }
-}
-
-// Optional: Group multiple button groups together for a toolbar
-.btn-toolbar {
-  margin-left: -5px; // Offset the first child's margin
-  &:extend(.clearfix all);
-
-  .btn-group,
-  .input-group {
-    float: left;
-  }
-  > .btn,
-  > .btn-group,
-  > .input-group {
-    margin-left: 5px;
-  }
-}
-
-.btn-group > .btn:not(:first-child):not(:last-child):not(.dropdown-toggle) {
-  border-radius: 0;
-}
-
-// Set corners individual because sometimes a single button can be in a .btn-group and we need :first-child and :last-child to both match
-.btn-group > .btn:first-child {
-  margin-left: 0;
-  &:not(:last-child):not(.dropdown-toggle) {
-    .border-right-radius(0);
-  }
-}
-// Need .dropdown-toggle since :last-child doesn't apply given a .dropdown-menu immediately after it
-.btn-group > .btn:last-child:not(:first-child),
-.btn-group > .dropdown-toggle:not(:first-child) {
-  .border-left-radius(0);
-}
-
-// Custom edits for including btn-groups within btn-groups (useful for including dropdown buttons within a btn-group)
-.btn-group > .btn-group {
-  float: left;
-}
-.btn-group > .btn-group:not(:first-child):not(:last-child) > .btn {
-  border-radius: 0;
-}
-.btn-group > .btn-group:first-child:not(:last-child) {
-  > .btn:last-child,
-  > .dropdown-toggle {
-    .border-right-radius(0);
-  }
-}
-.btn-group > .btn-group:last-child:not(:first-child) > .btn:first-child {
-  .border-left-radius(0);
-}
-
-// On active and open, don't show outline
-.btn-group .dropdown-toggle:active,
-.btn-group.open .dropdown-toggle {
-  outline: 0;
-}
-
-
-// Sizing
-//
-// Remix the default button sizing classes into new ones for easier manipulation.
-
-.btn-group-xs > .btn { &:extend(.btn-xs); }
-.btn-group-sm > .btn { &:extend(.btn-sm); }
-.btn-group-lg > .btn { &:extend(.btn-lg); }
-
-
-// Split button dropdowns
-// ----------------------
-
-// Give the line between buttons some depth
-.btn-group > .btn + .dropdown-toggle {
-  padding-left: 8px;
-  padding-right: 8px;
-}
-.btn-group > .btn-lg + .dropdown-toggle {
-  padding-left: 12px;
-  padding-right: 12px;
-}
-
-// The clickable button for toggling the menu
-// Remove the gradient and set the same inset shadow as the :active state
-.btn-group.open .dropdown-toggle {
-  .box-shadow(inset 0 3px 5px rgba(0,0,0,.125));
-
-  // Show no shadow for `.btn-link` since it has no other button styles.
-  &.btn-link {
-    .box-shadow(none);
-  }
-}
-
-
-// Reposition the caret
-.btn .caret {
-  margin-left: 0;
-}
-// Carets in other button sizes
-.btn-lg .caret {
-  border-width: @caret-width-large @caret-width-large 0;
-  border-bottom-width: 0;
-}
-// Upside down carets for .dropup
-.dropup .btn-lg .caret {
-  border-width: 0 @caret-width-large @caret-width-large;
-}
-
-
-// Vertical button groups
-// ----------------------
-
-.btn-group-vertical {
-  > .btn,
-  > .btn-group,
-  > .btn-group > .btn {
-    display: block;
-    float: none;
-    width: 100%;
-    max-width: 100%;
-  }
-
-  // Clear floats so dropdown menus can be properly placed
-  > .btn-group {
-    &:extend(.clearfix all);
-    > .btn {
-      float: none;
-    }
-  }
-
-  > .btn + .btn,
-  > .btn + .btn-group,
-  > .btn-group + .btn,
-  > .btn-group + .btn-group {
-    margin-top: -1px;
-    margin-left: 0;
-  }
-}
-
-.btn-group-vertical > .btn {
-  &:not(:first-child):not(:last-child) {
-    border-radius: 0;
-  }
-  &:first-child:not(:last-child) {
-    border-top-right-radius: @border-radius-base;
-    .border-bottom-radius(0);
-  }
-  &:last-child:not(:first-child) {
-    border-bottom-left-radius: @border-radius-base;
-    .border-top-radius(0);
-  }
-}
-.btn-group-vertical > .btn-group:not(:first-child):not(:last-child) > .btn {
-  border-radius: 0;
-}
-.btn-group-vertical > .btn-group:first-child:not(:last-child) {
-  > .btn:last-child,
-  > .dropdown-toggle {
-    .border-bottom-radius(0);
-  }
-}
-.btn-group-vertical > .btn-group:last-child:not(:first-child) > .btn:first-child {
-  .border-top-radius(0);
-}
-
-
-// Justified button groups
-// ----------------------
-
-.btn-group-justified {
-  display: table;
-  width: 100%;
-  table-layout: fixed;
-  border-collapse: separate;
-  > .btn,
-  > .btn-group {
-    float: none;
-    display: table-cell;
-    width: 1%;
-  }
-  > .btn-group .btn {
-    width: 100%;
-  }
-
-  > .btn-group .dropdown-menu {
-    left: auto;
-  }
-}
-
-
-// Checkbox and radio options
-//
-// In order to support the browser's form validation feedback, powered by the
-// `required` attribute, we have to "hide" the inputs via `clip`. We cannot use
-// `display: none;` or `visibility: hidden;` as that also hides the popover.
-// Simply visually hiding the inputs via `opacity` would leave them clickable in
-// certain cases which is prevented by using `clip` and `pointer-events`.
-// This way, we ensure a DOM element is visible to position the popover from.
-//
-// See https://github.com/twbs/bootstrap/pull/12794 and
-// https://github.com/twbs/bootstrap/pull/14559 for more information.
-
-[data-toggle="buttons"] {
-  > .btn,
-  > .btn-group > .btn {
-    input[type="radio"],
-    input[type="checkbox"] {
-      position: absolute;
-      clip: rect(0,0,0,0);
-      pointer-events: none;
-    }
-  }
-}
diff --git a/doc/bootstrap/buttons.less b/doc/bootstrap/buttons.less
deleted file mode 100644
index 5a746049..00000000
--- a/doc/bootstrap/buttons.less
+++ /dev/null
@@ -1,160 +0,0 @@
-//
-// Buttons
-// --------------------------------------------------
-
-
-// Base styles
-// --------------------------------------------------
-
-.btn {
-  display: inline-block;
-  margin-bottom: 0; // For input.btn
-  font-weight: @btn-font-weight;
-  text-align: center;
-  vertical-align: middle;
-  touch-action: manipulation;
-  cursor: pointer;
-  background-image: none; // Reset unusual Firefox-on-Android default style; see https://github.com/necolas/normalize.css/issues/214
-  border: 1px solid transparent;
-  white-space: nowrap;
-  .button-size(@padding-base-vertical; @padding-base-horizontal; @font-size-base; @line-height-base; @border-radius-base);
-  .user-select(none);
-
-  &,
-  &:active,
-  &.active {
-    &:focus,
-    &.focus {
-      .tab-focus();
-    }
-  }
-
-  &:hover,
-  &:focus,
-  &.focus {
-    color: @btn-default-color;
-    text-decoration: none;
-  }
-
-  &:active,
-  &.active {
-    outline: 0;
-    background-image: none;
-    .box-shadow(inset 0 3px 5px rgba(0,0,0,.125));
-  }
-
-  &.disabled,
-  &[disabled],
-  fieldset[disabled] & {
-    cursor: @cursor-disabled;
-    pointer-events: none; // Future-proof disabling of clicks
-    .opacity(.65);
-    .box-shadow(none);
-  }
-}
-
-
-// Alternate buttons
-// --------------------------------------------------
-
-.btn-default {
-  .button-variant(@btn-default-color; @btn-default-bg; @btn-default-border);
-}
-.btn-primary {
-  .button-variant(@btn-primary-color; @btn-primary-bg; @btn-primary-border);
-}
-// Success appears as green
-.btn-success {
-  .button-variant(@btn-success-color; @btn-success-bg; @btn-success-border);
-}
-// Info appears as blue-green
-.btn-info {
-  .button-variant(@btn-info-color; @btn-info-bg; @btn-info-border);
-}
-// Warning appears as orange
-.btn-warning {
-  .button-variant(@btn-warning-color; @btn-warning-bg; @btn-warning-border);
-}
-// Danger and error appear as red
-.btn-danger {
-  .button-variant(@btn-danger-color; @btn-danger-bg; @btn-danger-border);
-}
-
-
-// Link buttons
-// -------------------------
-
-// Make a button look and behave like a link
-.btn-link {
-  color: @link-color;
-  font-weight: normal;
-  border-radius: 0;
-
-  &,
-  &:active,
-  &.active,
-  &[disabled],
-  fieldset[disabled] & {
-    background-color: transparent;
-    .box-shadow(none);
-  }
-  &,
-  &:hover,
-  &:focus,
-  &:active {
-    border-color: transparent;
-  }
-  &:hover,
-  &:focus {
-    color: @link-hover-color;
-    text-decoration: @link-hover-decoration;
-    background-color: transparent;
-  }
-  &[disabled],
-  fieldset[disabled] & {
-    &:hover,
-    &:focus {
-      color: @btn-link-disabled-color;
-      text-decoration: none;
-    }
-  }
-}
-
-
-// Button Sizes
-// --------------------------------------------------
-
-.btn-lg {
-  // line-height: ensure even-numbered height of button next to large input
-  .button-size(@padding-large-vertical; @padding-large-horizontal; @font-size-large; @line-height-large; @border-radius-large);
-}
-.btn-sm {
-  // line-height: ensure proper height of button next to small input
-  .button-size(@padding-small-vertical; @padding-small-horizontal; @font-size-small; @line-height-small; @border-radius-small);
-}
-.btn-xs {
-  .button-size(@padding-xs-vertical; @padding-xs-horizontal; @font-size-small; @line-height-small; @border-radius-small);
-}
-
-
-// Block button
-// --------------------------------------------------
-
-.btn-block {
-  display: block;
-  width: 100%;
-}
-
-// Vertically space out multiple block buttons
-.btn-block + .btn-block {
-  margin-top: 5px;
-}
-
-// Specificity overrides
-input[type="submit"],
-input[type="reset"],
-input[type="button"] {
-  &.btn-block {
-    width: 100%;
-  }
-}
diff --git a/doc/bootstrap/carousel.less b/doc/bootstrap/carousel.less
deleted file mode 100644
index 4bbe946d..00000000
--- a/doc/bootstrap/carousel.less
+++ /dev/null
@@ -1,269 +0,0 @@
-//
-// Carousel
-// --------------------------------------------------
-
-
-// Wrapper for the slide container and indicators
-.carousel {
-  position: relative;
-}
-
-.carousel-inner {
-  position: relative;
-  overflow: hidden;
-  width: 100%;
-
-  > .item {
-    display: none;
-    position: relative;
-    .transition(.6s ease-in-out left);
-
-    // Account for jankitude on images
-    > img,
-    > a > img {
-      &:extend(.img-responsive);
-      line-height: 1;
-    }
-
-    // WebKit CSS3 transforms for supported devices
-    @media all and (transform-3d), (-webkit-transform-3d) {
-      .transition-transform(~'0.6s ease-in-out');
-      .backface-visibility(~'hidden');
-      .perspective(1000);
-
-      &.next,
-      &.active.right {
-        .translate3d(100%, 0, 0);
-        left: 0;
-      }
-      &.prev,
-      &.active.left {
-        .translate3d(-100%, 0, 0);
-        left: 0;
-      }
-      &.next.left,
-      &.prev.right,
-      &.active {
-        .translate3d(0, 0, 0);
-        left: 0;
-      }
-    }
-  }
-
-  > .active,
-  > .next,
-  > .prev {
-    display: block;
-  }
-
-  > .active {
-    left: 0;
-  }
-
-  > .next,
-  > .prev {
-    position: absolute;
-    top: 0;
-    width: 100%;
-  }
-
-  > .next {
-    left: 100%;
-  }
-  > .prev {
-    left: -100%;
-  }
-  > .next.left,
-  > .prev.right {
-    left: 0;
-  }
-
-  > .active.left {
-    left: -100%;
-  }
-  > .active.right {
-    left: 100%;
-  }
-
-}
-
-// Left/right controls for nav
-// ---------------------------
-
-.carousel-control {
-  position: absolute;
-  top: 0;
-  left: 0;
-  bottom: 0;
-  width: @carousel-control-width;
-  .opacity(@carousel-control-opacity);
-  font-size: @carousel-control-font-size;
-  color: @carousel-control-color;
-  text-align: center;
-  text-shadow: @carousel-text-shadow;
-  // We can't have this transition here because WebKit cancels the carousel
-  // animation if you trip this while in the middle of another animation.
-
-  // Set gradients for backgrounds
-  &.left {
-    #gradient > .horizontal(@start-color: rgba(0,0,0,.5); @end-color: rgba(0,0,0,.0001));
-  }
-  &.right {
-    left: auto;
-    right: 0;
-    #gradient > .horizontal(@start-color: rgba(0,0,0,.0001); @end-color: rgba(0,0,0,.5));
-  }
-
-  // Hover/focus state
-  &:hover,
-  &:focus {
-    outline: 0;
-    color: @carousel-control-color;
-    text-decoration: none;
-    .opacity(.9);
-  }
-
-  // Toggles
-  .icon-prev,
-  .icon-next,
-  .glyphicon-chevron-left,
-  .glyphicon-chevron-right {
-    position: absolute;
-    top: 50%;
-    z-index: 5;
-    display: inline-block;
-  }
-  .icon-prev,
-  .glyphicon-chevron-left {
-    left: 50%;
-    margin-left: -10px;
-  }
-  .icon-next,
-  .glyphicon-chevron-right {
-    right: 50%;
-    margin-right: -10px;
-  }
-  .icon-prev,
-  .icon-next {
-    width:  20px;
-    height: 20px;
-    margin-top: -10px;
-    line-height: 1;
-    font-family: serif;
-  }
-
-
-  .icon-prev {
-    &:before {
-      content: '\2039';// SINGLE LEFT-POINTING ANGLE QUOTATION MARK (U+2039)
-    }
-  }
-  .icon-next {
-    &:before {
-      content: '\203a';// SINGLE RIGHT-POINTING ANGLE QUOTATION MARK (U+203A)
-    }
-  }
-}
-
-// Optional indicator pips
-//
-// Add an unordered list with the following class and add a list item for each
-// slide your carousel holds.
-
-.carousel-indicators {
-  position: absolute;
-  bottom: 10px;
-  left: 50%;
-  z-index: 15;
-  width: 60%;
-  margin-left: -30%;
-  padding-left: 0;
-  list-style: none;
-  text-align: center;
-
-  li {
-    display: inline-block;
-    width:  10px;
-    height: 10px;
-    margin: 1px;
-    text-indent: -999px;
-    border: 1px solid @carousel-indicator-border-color;
-    border-radius: 10px;
-    cursor: pointer;
-
-    // IE8-9 hack for event handling
-    //
-    // Internet Explorer 8-9 does not support clicks on elements without a set
-    // `background-color`. We cannot use `filter` since that's not viewed as a
-    // background color by the browser. Thus, a hack is needed.
-    // See https://developer.mozilla.org/en-US/docs/Web/Events/click#Internet_Explorer
-    //
-    // For IE8, we set solid black as it doesn't support `rgba()`. For IE9, we
-    // set alpha transparency for the best results possible.
-    background-color: #000 \9; // IE8
-    background-color: rgba(0,0,0,0); // IE9
-  }
-  .active {
-    margin: 0;
-    width:  12px;
-    height: 12px;
-    background-color: @carousel-indicator-active-bg;
-  }
-}
-
-// Optional captions
-// -----------------------------
-// Hidden by default for smaller viewports
-.carousel-caption {
-  position: absolute;
-  left: 15%;
-  right: 15%;
-  bottom: 20px;
-  z-index: 10;
-  padding-top: 20px;
-  padding-bottom: 20px;
-  color: @carousel-caption-color;
-  text-align: center;
-  text-shadow: @carousel-text-shadow;
-  & .btn {
-    text-shadow: none; // No shadow for button elements in carousel-caption
-  }
-}
-
-
-// Scale up controls for tablets and up
-@media screen and (min-width: @screen-sm-min) {
-
-  // Scale up the controls a smidge
-  .carousel-control {
-    .glyphicon-chevron-left,
-    .glyphicon-chevron-right,
-    .icon-prev,
-    .icon-next {
-      width: 30px;
-      height: 30px;
-      margin-top: -15px;
-      font-size: 30px;
-    }
-    .glyphicon-chevron-left,
-    .icon-prev {
-      margin-left: -15px;
-    }
-    .glyphicon-chevron-right,
-    .icon-next {
-      margin-right: -15px;
-    }
-  }
-
-  // Show and left align the captions
-  .carousel-caption {
-    left: 20%;
-    right: 20%;
-    padding-bottom: 30px;
-  }
-
-  // Move up the indicators
-  .carousel-indicators {
-    bottom: 20px;
-  }
-}
diff --git a/doc/bootstrap/close.less b/doc/bootstrap/close.less
deleted file mode 100644
index 6d5bfe08..00000000
--- a/doc/bootstrap/close.less
+++ /dev/null
@@ -1,34 +0,0 @@
-//
-// Close icons
-// --------------------------------------------------
-
-
-.close {
-  float: right;
-  font-size: (@font-size-base * 1.5);
-  font-weight: @close-font-weight;
-  line-height: 1;
-  color: @close-color;
-  text-shadow: @close-text-shadow;
-  .opacity(.2);
-
-  &:hover,
-  &:focus {
-    color: @close-color;
-    text-decoration: none;
-    cursor: pointer;
-    .opacity(.5);
-  }
-
-  // Additional properties for button version
-  // iOS requires the button element instead of an anchor tag.
-  // If you want the anchor version, it requires `href="#"`.
-  // See https://developer.mozilla.org/en-US/docs/Web/Events/click#Safari_Mobile
-  button& {
-    padding: 0;
-    cursor: pointer;
-    background: transparent;
-    border: 0;
-    -webkit-appearance: none;
-  }
-}
diff --git a/doc/bootstrap/code.less b/doc/bootstrap/code.less
deleted file mode 100644
index a08b4d48..00000000
--- a/doc/bootstrap/code.less
+++ /dev/null
@@ -1,69 +0,0 @@
-//
-// Code (inline and block)
-// --------------------------------------------------
-
-
-// Inline and block code styles
-code,
-kbd,
-pre,
-samp {
-  font-family: @font-family-monospace;
-}
-
-// Inline code
-code {
-  padding: 2px 4px;
-  font-size: 90%;
-  color: @code-color;
-  background-color: @code-bg;
-  border-radius: @border-radius-base;
-}
-
-// User input typically entered via keyboard
-kbd {
-  padding: 2px 4px;
-  font-size: 90%;
-  color: @kbd-color;
-  background-color: @kbd-bg;
-  border-radius: @border-radius-small;
-  box-shadow: inset 0 -1px 0 rgba(0,0,0,.25);
-
-  kbd {
-    padding: 0;
-    font-size: 100%;
-    font-weight: bold;
-    box-shadow: none;
-  }
-}
-
-// Blocks of code
-pre {
-  display: block;
-  padding: ((@line-height-computed - 1) / 2);
-  margin: 0 0 (@line-height-computed / 2);
-  font-size: (@font-size-base - 1); // 14px to 13px
-  line-height: @line-height-base;
-  word-break: break-all;
-  word-wrap: break-word;
-  color: @pre-color;
-  background-color: @pre-bg;
-  border: 1px solid @pre-border-color;
-  border-radius: @border-radius-base;
-
-  // Account for some code outputs that place code tags in pre tags
-  code {
-    padding: 0;
-    font-size: inherit;
-    color: inherit;
-    white-space: pre-wrap;
-    background-color: transparent;
-    border-radius: 0;
-  }
-}
-
-// Enable scrollable blocks of code
-.pre-scrollable {
-  max-height: @pre-scrollable-max-height;
-  overflow-y: scroll;
-}
diff --git a/doc/bootstrap/component-animations.less b/doc/bootstrap/component-animations.less
deleted file mode 100644
index 0bcee910..00000000
--- a/doc/bootstrap/component-animations.less
+++ /dev/null
@@ -1,33 +0,0 @@
-//
-// Component animations
-// --------------------------------------------------
-
-// Heads up!
-//
-// We don't use the `.opacity()` mixin here since it causes a bug with text
-// fields in IE7-8. Source: https://github.com/twbs/bootstrap/pull/3552.
-
-.fade {
-  opacity: 0;
-  .transition(opacity .15s linear);
-  &.in {
-    opacity: 1;
-  }
-}
-
-.collapse {
-  display: none;
-
-  &.in      { display: block; }
-  tr&.in    { display: table-row; }
-  tbody&.in { display: table-row-group; }
-}
-
-.collapsing {
-  position: relative;
-  height: 0;
-  overflow: hidden;
-  .transition-property(~"height, visibility");
-  .transition-duration(.35s);
-  .transition-timing-function(ease);
-}
diff --git a/doc/bootstrap/dropdowns.less b/doc/bootstrap/dropdowns.less
deleted file mode 100644
index af344607..00000000
--- a/doc/bootstrap/dropdowns.less
+++ /dev/null
@@ -1,214 +0,0 @@
-//
-// Dropdown menus
-// --------------------------------------------------
-
-
-// Dropdown arrow/caret
-.caret {
-  display: inline-block;
-  width: 0;
-  height: 0;
-  margin-left: 2px;
-  vertical-align: middle;
-  border-top:   @caret-width-base dashed;
-  border-right: @caret-width-base solid transparent;
-  border-left:  @caret-width-base solid transparent;
-}
-
-// The dropdown wrapper (div)
-.dropup,
-.dropdown {
-  position: relative;
-}
-
-// Prevent the focus on the dropdown toggle when closing dropdowns
-.dropdown-toggle:focus {
-  outline: 0;
-}
-
-// The dropdown menu (ul)
-.dropdown-menu {
-  position: absolute;
-  top: 100%;
-  left: 0;
-  z-index: @zindex-dropdown;
-  display: none; // none by default, but block on "open" of the menu
-  float: left;
-  min-width: 160px;
-  padding: 5px 0;
-  margin: 2px 0 0; // override default ul
-  list-style: none;
-  font-size: @font-size-base;
-  text-align: left; // Ensures proper alignment if parent has it changed (e.g., modal footer)
-  background-color: @dropdown-bg;
-  border: 1px solid @dropdown-fallback-border; // IE8 fallback
-  border: 1px solid @dropdown-border;
-  border-radius: @border-radius-base;
-  .box-shadow(0 6px 12px rgba(0,0,0,.175));
-  background-clip: padding-box;
-
-  // Aligns the dropdown menu to right
-  //
-  // Deprecated as of 3.1.0 in favor of `.dropdown-menu-[dir]`
-  &.pull-right {
-    right: 0;
-    left: auto;
-  }
-
-  // Dividers (basically an hr) within the dropdown
-  .divider {
-    .nav-divider(@dropdown-divider-bg);
-  }
-
-  // Links within the dropdown menu
-  > li > a {
-    display: block;
-    padding: 3px 20px;
-    clear: both;
-    font-weight: normal;
-    line-height: @line-height-base;
-    color: @dropdown-link-color;
-    white-space: nowrap; // prevent links from randomly breaking onto new lines
-  }
-}
-
-// Hover/Focus state
-.dropdown-menu > li > a {
-  &:hover,
-  &:focus {
-    text-decoration: none;
-    color: @dropdown-link-hover-color;
-    background-color: @dropdown-link-hover-bg;
-  }
-}
-
-// Active state
-.dropdown-menu > .active > a {
-  &,
-  &:hover,
-  &:focus {
-    color: @dropdown-link-active-color;
-    text-decoration: none;
-    outline: 0;
-    background-color: @dropdown-link-active-bg;
-  }
-}
-
-// Disabled state
-//
-// Gray out text and ensure the hover/focus state remains gray
-
-.dropdown-menu > .disabled > a {
-  &,
-  &:hover,
-  &:focus {
-    color: @dropdown-link-disabled-color;
-  }
-
-  // Nuke hover/focus effects
-  &:hover,
-  &:focus {
-    text-decoration: none;
-    background-color: transparent;
-    background-image: none; // Remove CSS gradient
-    .reset-filter();
-    cursor: @cursor-disabled;
-  }
-}
-
-// Open state for the dropdown
-.open {
-  // Show the menu
-  > .dropdown-menu {
-    display: block;
-  }
-
-  // Remove the outline when :focus is triggered
-  > a {
-    outline: 0;
-  }
-}
-
-// Menu positioning
-//
-// Add extra class to `.dropdown-menu` to flip the alignment of the dropdown
-// menu with the parent.
-.dropdown-menu-right {
-  left: auto; // Reset the default from `.dropdown-menu`
-  right: 0;
-}
-// With v3, we enabled auto-flipping if you have a dropdown within a right
-// aligned nav component. To enable the undoing of that, we provide an override
-// to restore the default dropdown menu alignment.
-//
-// This is only for left-aligning a dropdown menu within a `.navbar-right` or
-// `.pull-right` nav component.
-.dropdown-menu-left {
-  left: 0;
-  right: auto;
-}
-
-// Dropdown section headers
-.dropdown-header {
-  display: block;
-  padding: 3px 20px;
-  font-size: @font-size-small;
-  line-height: @line-height-base;
-  color: @dropdown-header-color;
-  white-space: nowrap; // as with > li > a
-}
-
-// Backdrop to catch body clicks on mobile, etc.
-.dropdown-backdrop {
-  position: fixed;
-  left: 0;
-  right: 0;
-  bottom: 0;
-  top: 0;
-  z-index: (@zindex-dropdown - 10);
-}
-
-// Right aligned dropdowns
-.pull-right > .dropdown-menu {
-  right: 0;
-  left: auto;
-}
-
-// Allow for dropdowns to go bottom up (aka, dropup-menu)
-//
-// Just add .dropup after the standard .dropdown class and you're set, bro.
-// TODO: abstract this so that the navbar fixed styles are not placed here?
-
-.dropup,
-.navbar-fixed-bottom .dropdown {
-  // Reverse the caret
-  .caret {
-    border-top: 0;
-    border-bottom: @caret-width-base solid;
-    content: "";
-  }
-  // Different positioning for bottom up menu
-  .dropdown-menu {
-    top: auto;
-    bottom: 100%;
-    margin-bottom: 2px;
-  }
-}
-
-
-// Component alignment
-//
-// Reiterate per navbar.less and the modified component alignment there.
-
-@media (min-width: @grid-float-breakpoint) {
-  .navbar-right {
-    .dropdown-menu {
-      .dropdown-menu-right();
-    }
-    // Necessary for overrides of the default right aligned menu.
-    // Will remove come v4 in all likelihood.
-    .dropdown-menu-left {
-      .dropdown-menu-left();
-    }
-  }
-}
diff --git a/doc/bootstrap/forms.less b/doc/bootstrap/forms.less
deleted file mode 100644
index e4b50629..00000000
--- a/doc/bootstrap/forms.less
+++ /dev/null
@@ -1,574 +0,0 @@
-//
-// Forms
-// --------------------------------------------------
-
-
-// Normalize non-controls
-//
-// Restyle and baseline non-control form elements.
-
-fieldset {
-  padding: 0;
-  margin: 0;
-  border: 0;
-  // Chrome and Firefox set a `min-width: min-content;` on fieldsets,
-  // so we reset that to ensure it behaves more like a standard block element.
-  // See https://github.com/twbs/bootstrap/issues/12359.
-  min-width: 0;
-}
-
-legend {
-  display: block;
-  width: 100%;
-  padding: 0;
-  margin-bottom: @line-height-computed;
-  font-size: (@font-size-base * 1.5);
-  line-height: inherit;
-  color: @legend-color;
-  border: 0;
-  border-bottom: 1px solid @legend-border-color;
-}
-
-label {
-  display: inline-block;
-  max-width: 100%; // Force IE8 to wrap long content (see https://github.com/twbs/bootstrap/issues/13141)
-  margin-bottom: 5px;
-  font-weight: bold;
-}
-
-
-// Normalize form controls
-//
-// While most of our form styles require extra classes, some basic normalization
-// is required to ensure optimum display with or without those classes to better
-// address browser inconsistencies.
-
-// Override content-box in Normalize (* isn't specific enough)
-input[type="search"] {
-  .box-sizing(border-box);
-}
-
-// Position radios and checkboxes better
-input[type="radio"],
-input[type="checkbox"] {
-  margin: 4px 0 0;
-  margin-top: 1px \9; // IE8-9
-  line-height: normal;
-}
-
-// Set the height of file controls to match text inputs
-input[type="file"] {
-  display: block;
-}
-
-// Make range inputs behave like textual form controls
-input[type="range"] {
-  display: block;
-  width: 100%;
-}
-
-// Make multiple select elements height not fixed
-select[multiple],
-select[size] {
-  height: auto;
-}
-
-// Focus for file, radio, and checkbox
-input[type="file"]:focus,
-input[type="radio"]:focus,
-input[type="checkbox"]:focus {
-  .tab-focus();
-}
-
-// Adjust output element
-output {
-  display: block;
-  padding-top: (@padding-base-vertical + 1);
-  font-size: @font-size-base;
-  line-height: @line-height-base;
-  color: @input-color;
-}
-
-
-// Common form controls
-//
-// Shared size and type resets for form controls. Apply `.form-control` to any
-// of the following form controls:
-//
-// select
-// textarea
-// input[type="text"]
-// input[type="password"]
-// input[type="datetime"]
-// input[type="datetime-local"]
-// input[type="date"]
-// input[type="month"]
-// input[type="time"]
-// input[type="week"]
-// input[type="number"]
-// input[type="email"]
-// input[type="url"]
-// input[type="search"]
-// input[type="tel"]
-// input[type="color"]
-
-.form-control {
-  display: block;
-  width: 100%;
-  height: @input-height-base; // Make inputs at least the height of their button counterpart (base line-height + padding + border)
-  padding: @padding-base-vertical @padding-base-horizontal;
-  font-size: @font-size-base;
-  line-height: @line-height-base;
-  color: @input-color;
-  background-color: @input-bg;
-  background-image: none; // Reset unusual Firefox-on-Android default style; see https://github.com/necolas/normalize.css/issues/214
-  border: 1px solid @input-border;
-  border-radius: @input-border-radius; // Note: This has no effect on <select>s in some browsers, due to the limited stylability of <select>s in CSS.
-  .box-shadow(inset 0 1px 1px rgba(0,0,0,.075));
-  .transition(~"border-color ease-in-out .15s, box-shadow ease-in-out .15s");
-
-  // Customize the `:focus` state to imitate native WebKit styles.
-  .form-control-focus();
-
-  // Placeholder
-  .placeholder();
-
-  // Disabled and read-only inputs
-  //
-  // HTML5 says that controls under a fieldset > legend:first-child won't be
-  // disabled if the fieldset is disabled. Due to implementation difficulty, we
-  // don't honor that edge case; we style them as disabled anyway.
-  &[disabled],
-  &[readonly],
-  fieldset[disabled] & {
-    background-color: @input-bg-disabled;
-    opacity: 1; // iOS fix for unreadable disabled content; see https://github.com/twbs/bootstrap/issues/11655
-  }
-
-  &[disabled],
-  fieldset[disabled] & {
-    cursor: @cursor-disabled;
-  }
-
-  // Reset height for `textarea`s
-  textarea& {
-    height: auto;
-  }
-}
-
-
-// Search inputs in iOS
-//
-// This overrides the extra rounded corners on search inputs in iOS so that our
-// `.form-control` class can properly style them. Note that this cannot simply
-// be added to `.form-control` as it's not specific enough. For details, see
-// https://github.com/twbs/bootstrap/issues/11586.
-
-input[type="search"] {
-  -webkit-appearance: none;
-}
-
-
-// Special styles for iOS temporal inputs
-//
-// In Mobile Safari, setting `display: block` on temporal inputs causes the
-// text within the input to become vertically misaligned. As a workaround, we
-// set a pixel line-height that matches the given height of the input, but only
-// for Safari. See https://bugs.webkit.org/show_bug.cgi?id=139848
-
-@media screen and (-webkit-min-device-pixel-ratio: 0) {
-  input[type="date"],
-  input[type="time"],
-  input[type="datetime-local"],
-  input[type="month"] {
-    line-height: @input-height-base;
-
-    &.input-sm,
-    .input-group-sm & {
-      line-height: @input-height-small;
-    }
-
-    &.input-lg,
-    .input-group-lg & {
-      line-height: @input-height-large;
-    }
-  }
-}
-
-
-// Form groups
-//
-// Designed to help with the organization and spacing of vertical forms. For
-// horizontal forms, use the predefined grid classes.
-
-.form-group {
-  margin-bottom: @form-group-margin-bottom;
-}
-
-
-// Checkboxes and radios
-//
-// Indent the labels to position radios/checkboxes as hanging controls.
-
-.radio,
-.checkbox {
-  position: relative;
-  display: block;
-  margin-top: 10px;
-  margin-bottom: 10px;
-
-  label {
-    min-height: @line-height-computed; // Ensure the input doesn't jump when there is no text
-    padding-left: 20px;
-    margin-bottom: 0;
-    font-weight: normal;
-    cursor: pointer;
-  }
-}
-.radio input[type="radio"],
-.radio-inline input[type="radio"],
-.checkbox input[type="checkbox"],
-.checkbox-inline input[type="checkbox"] {
-  position: absolute;
-  margin-left: -20px;
-  margin-top: 4px \9;
-}
-
-.radio + .radio,
-.checkbox + .checkbox {
-  margin-top: -5px; // Move up sibling radios or checkboxes for tighter spacing
-}
-
-// Radios and checkboxes on same line
-.radio-inline,
-.checkbox-inline {
-  position: relative;
-  display: inline-block;
-  padding-left: 20px;
-  margin-bottom: 0;
-  vertical-align: middle;
-  font-weight: normal;
-  cursor: pointer;
-}
-.radio-inline + .radio-inline,
-.checkbox-inline + .checkbox-inline {
-  margin-top: 0;
-  margin-left: 10px; // space out consecutive inline controls
-}
-
-// Apply same disabled cursor tweak as for inputs
-// Some special care is needed because <label>s don't inherit their parent's `cursor`.
-//
-// Note: Neither radios nor checkboxes can be readonly.
-input[type="radio"],
-input[type="checkbox"] {
-  &[disabled],
-  &.disabled,
-  fieldset[disabled] & {
-    cursor: @cursor-disabled;
-  }
-}
-// These classes are used directly on <label>s
-.radio-inline,
-.checkbox-inline {
-  &.disabled,
-  fieldset[disabled] & {
-    cursor: @cursor-disabled;
-  }
-}
-// These classes are used on elements with <label> descendants
-.radio,
-.checkbox {
-  &.disabled,
-  fieldset[disabled] & {
-    label {
-      cursor: @cursor-disabled;
-    }
-  }
-}
-
-
-// Static form control text
-//
-// Apply class to a `p` element to make any string of text align with labels in
-// a horizontal form layout.
-
-.form-control-static {
-  // Size it appropriately next to real form controls
-  padding-top: (@padding-base-vertical + 1);
-  padding-bottom: (@padding-base-vertical + 1);
-  // Remove default margin from `p`
-  margin-bottom: 0;
-  min-height: (@line-height-computed + @font-size-base);
-
-  &.input-lg,
-  &.input-sm {
-    padding-left: 0;
-    padding-right: 0;
-  }
-}
-
-
-// Form control sizing
-//
-// Build on `.form-control` with modifier classes to decrease or increase the
-// height and font-size of form controls.
-//
-// The `.form-group-* form-control` variations are sadly duplicated to avoid the
-// issue documented in https://github.com/twbs/bootstrap/issues/15074.
-
-.input-sm {
-  .input-size(@input-height-small; @padding-small-vertical; @padding-small-horizontal; @font-size-small; @line-height-small; @input-border-radius-small);
-}
-.form-group-sm {
-  .form-control {
-    .input-size(@input-height-small; @padding-small-vertical; @padding-small-horizontal; @font-size-small; @line-height-small; @input-border-radius-small);
-  }
-  .form-control-static {
-    height: @input-height-small;
-    padding: @padding-small-vertical @padding-small-horizontal;
-    font-size: @font-size-small;
-    line-height: @line-height-small;
-    min-height: (@line-height-computed + @font-size-small);
-  }
-}
-
-.input-lg {
-  .input-size(@input-height-large; @padding-large-vertical; @padding-large-horizontal; @font-size-large; @line-height-large; @input-border-radius-large);
-}
-.form-group-lg {
-  .form-control {
-    .input-size(@input-height-large; @padding-large-vertical; @padding-large-horizontal; @font-size-large; @line-height-large; @input-border-radius-large);
-  }
-  .form-control-static {
-    height: @input-height-large;
-    padding: @padding-large-vertical @padding-large-horizontal;
-    font-size: @font-size-large;
-    line-height: @line-height-large;
-    min-height: (@line-height-computed + @font-size-large);
-  }
-}
-
-
-// Form control feedback states
-//
-// Apply contextual and semantic states to individual form controls.
-
-.has-feedback {
-  // Enable absolute positioning
-  position: relative;
-
-  // Ensure icons don't overlap text
-  .form-control {
-    padding-right: (@input-height-base * 1.25);
-  }
-}
-// Feedback icon (requires .glyphicon classes)
-.form-control-feedback {
-  position: absolute;
-  top: 0;
-  right: 0;
-  z-index: 2; // Ensure icon is above input groups
-  display: block;
-  width: @input-height-base;
-  height: @input-height-base;
-  line-height: @input-height-base;
-  text-align: center;
-  pointer-events: none;
-}
-.input-lg + .form-control-feedback {
-  width: @input-height-large;
-  height: @input-height-large;
-  line-height: @input-height-large;
-}
-.input-sm + .form-control-feedback {
-  width: @input-height-small;
-  height: @input-height-small;
-  line-height: @input-height-small;
-}
-
-// Feedback states
-.has-success {
-  .form-control-validation(@state-success-text; @state-success-text; @state-success-bg);
-}
-.has-warning {
-  .form-control-validation(@state-warning-text; @state-warning-text; @state-warning-bg);
-}
-.has-error {
-  .form-control-validation(@state-danger-text; @state-danger-text; @state-danger-bg);
-}
-
-// Reposition feedback icon if input has visible label above
-.has-feedback label {
-
-  & ~ .form-control-feedback {
-     top: (@line-height-computed + 5); // Height of the `label` and its margin
-  }
-  &.sr-only ~ .form-control-feedback {
-     top: 0;
-  }
-}
-
-
-// Help text
-//
-// Apply to any element you wish to create light text for placement immediately
-// below a form control. Use for general help, formatting, or instructional text.
-
-.help-block {
-  display: block; // account for any element using help-block
-  margin-top: 5px;
-  margin-bottom: 10px;
-  color: lighten(@text-color, 25%); // lighten the text some for contrast
-}
-
-
-// Inline forms
-//
-// Make forms appear inline(-block) by adding the `.form-inline` class. Inline
-// forms begin stacked on extra small (mobile) devices and then go inline when
-// viewports reach <768px.
-//
-// Requires wrapping inputs and labels with `.form-group` for proper display of
-// default HTML form controls and our custom form controls (e.g., input groups).
-//
-// Heads up! This is mixin-ed into `.navbar-form` in navbars.less.
-
-.form-inline {
-
-  // Kick in the inline
-  @media (min-width: @screen-sm-min) {
-    // Inline-block all the things for "inline"
-    .form-group {
-      display: inline-block;
-      margin-bottom: 0;
-      vertical-align: middle;
-    }
-
-    // In navbar-form, allow folks to *not* use `.form-group`
-    .form-control {
-      display: inline-block;
-      width: auto; // Prevent labels from stacking above inputs in `.form-group`
-      vertical-align: middle;
-    }
-
-    // Make static controls behave like regular ones
-    .form-control-static {
-      display: inline-block;
-    }
-
-    .input-group {
-      display: inline-table;
-      vertical-align: middle;
-
-      .input-group-addon,
-      .input-group-btn,
-      .form-control {
-        width: auto;
-      }
-    }
-
-    // Input groups need that 100% width though
-    .input-group > .form-control {
-      width: 100%;
-    }
-
-    .control-label {
-      margin-bottom: 0;
-      vertical-align: middle;
-    }
-
-    // Remove default margin on radios/checkboxes that were used for stacking, and
-    // then undo the floating of radios and checkboxes to match.
-    .radio,
-    .checkbox {
-      display: inline-block;
-      margin-top: 0;
-      margin-bottom: 0;
-      vertical-align: middle;
-
-      label {
-        padding-left: 0;
-      }
-    }
-    .radio input[type="radio"],
-    .checkbox input[type="checkbox"] {
-      position: relative;
-      margin-left: 0;
-    }
-
-    // Re-override the feedback icon.
-    .has-feedback .form-control-feedback {
-      top: 0;
-    }
-  }
-}
-
-
-// Horizontal forms
-//
-// Horizontal forms are built on grid classes and allow you to create forms with
-// labels on the left and inputs on the right.
-
-.form-horizontal {
-
-  // Consistent vertical alignment of radios and checkboxes
-  //
-  // Labels also get some reset styles, but that is scoped to a media query below.
-  .radio,
-  .checkbox,
-  .radio-inline,
-  .checkbox-inline {
-    margin-top: 0;
-    margin-bottom: 0;
-    padding-top: (@padding-base-vertical + 1); // Default padding plus a border
-  }
-  // Account for padding we're adding to ensure the alignment and of help text
-  // and other content below items
-  .radio,
-  .checkbox {
-    min-height: (@line-height-computed + (@padding-base-vertical + 1));
-  }
-
-  // Make form groups behave like rows
-  .form-group {
-    .make-row();
-  }
-
-  // Reset spacing and right align labels, but scope to media queries so that
-  // labels on narrow viewports stack the same as a default form example.
-  @media (min-width: @screen-sm-min) {
-    .control-label {
-      text-align: right;
-      margin-bottom: 0;
-      padding-top: (@padding-base-vertical + 1); // Default padding plus a border
-    }
-  }
-
-  // Validation states
-  //
-  // Reposition the icon because it's now within a grid column and columns have
-  // `position: relative;` on them. Also accounts for the grid gutter padding.
-  .has-feedback .form-control-feedback {
-    right: (@grid-gutter-width / 2);
-  }
-
-  // Form group sizes
-  //
-  // Quick utility class for applying `.input-lg` and `.input-sm` styles to the
-  // inputs and labels within a `.form-group`.
-  .form-group-lg {
-    @media (min-width: @screen-sm-min) {
-      .control-label {
-        padding-top: ((@padding-large-vertical * @line-height-large) + 1);
-      }
-    }
-  }
-  .form-group-sm {
-    @media (min-width: @screen-sm-min) {
-      .control-label {
-        padding-top: (@padding-small-vertical + 1);
-      }
-    }
-  }
-}
diff --git a/doc/bootstrap/glyphicons.less b/doc/bootstrap/glyphicons.less
deleted file mode 100644
index 335d80aa..00000000
--- a/doc/bootstrap/glyphicons.less
+++ /dev/null
@@ -1,305 +0,0 @@
-//
-// Glyphicons for Bootstrap
-//
-// Since icons are fonts, they can be placed anywhere text is placed and are
-// thus automatically sized to match the surrounding child. To use, create an
-// inline element with the appropriate classes, like so:
-//
-// <a href="#"><span class="glyphicon glyphicon-star"></span> Star</a>
-
-// Import the fonts
-@font-face {
-  font-family: 'Glyphicons Halflings';
-  src: url('@{icon-font-path}@{icon-font-name}.eot');
-  src: url('@{icon-font-path}@{icon-font-name}.eot?#iefix') format('embedded-opentype'),
-       url('@{icon-font-path}@{icon-font-name}.woff2') format('woff2'),
-       url('@{icon-font-path}@{icon-font-name}.woff') format('woff'),
-       url('@{icon-font-path}@{icon-font-name}.ttf') format('truetype'),
-       url('@{icon-font-path}@{icon-font-name}.svg#@{icon-font-svg-id}') format('svg');
-}
-
-// Catchall baseclass
-.glyphicon {
-  position: relative;
-  top: 1px;
-  display: inline-block;
-  font-family: 'Glyphicons Halflings';
-  font-style: normal;
-  font-weight: normal;
-  line-height: 1;
-  -webkit-font-smoothing: antialiased;
-  -moz-osx-font-smoothing: grayscale;
-}
-
-// Individual icons
-.glyphicon-asterisk               { &:before { content: "\2a"; } }
-.glyphicon-plus                   { &:before { content: "\2b"; } }
-.glyphicon-euro,
-.glyphicon-eur                    { &:before { content: "\20ac"; } }
-.glyphicon-minus                  { &:before { content: "\2212"; } }
-.glyphicon-cloud                  { &:before { content: "\2601"; } }
-.glyphicon-envelope               { &:before { content: "\2709"; } }
-.glyphicon-pencil                 { &:before { content: "\270f"; } }
-.glyphicon-glass                  { &:before { content: "\e001"; } }
-.glyphicon-music                  { &:before { content: "\e002"; } }
-.glyphicon-search                 { &:before { content: "\e003"; } }
-.glyphicon-heart                  { &:before { content: "\e005"; } }
-.glyphicon-star                   { &:before { content: "\e006"; } }
-.glyphicon-star-empty             { &:before { content: "\e007"; } }
-.glyphicon-user                   { &:before { content: "\e008"; } }
-.glyphicon-film                   { &:before { content: "\e009"; } }
-.glyphicon-th-large               { &:before { content: "\e010"; } }
-.glyphicon-th                     { &:before { content: "\e011"; } }
-.glyphicon-th-list                { &:before { content: "\e012"; } }
-.glyphicon-ok                     { &:before { content: "\e013"; } }
-.glyphicon-remove                 { &:before { content: "\e014"; } }
-.glyphicon-zoom-in                { &:before { content: "\e015"; } }
-.glyphicon-zoom-out               { &:before { content: "\e016"; } }
-.glyphicon-off                    { &:before { content: "\e017"; } }
-.glyphicon-signal                 { &:before { content: "\e018"; } }
-.glyphicon-cog                    { &:before { content: "\e019"; } }
-.glyphicon-trash                  { &:before { content: "\e020"; } }
-.glyphicon-home                   { &:before { content: "\e021"; } }
-.glyphicon-file                   { &:before { content: "\e022"; } }
-.glyphicon-time                   { &:before { content: "\e023"; } }
-.glyphicon-road                   { &:before { content: "\e024"; } }
-.glyphicon-download-alt           { &:before { content: "\e025"; } }
-.glyphicon-download               { &:before { content: "\e026"; } }
-.glyphicon-upload                 { &:before { content: "\e027"; } }
-.glyphicon-inbox                  { &:before { content: "\e028"; } }
-.glyphicon-play-circle            { &:before { content: "\e029"; } }
-.glyphicon-repeat                 { &:before { content: "\e030"; } }
-.glyphicon-refresh                { &:before { content: "\e031"; } }
-.glyphicon-list-alt               { &:before { content: "\e032"; } }
-.glyphicon-lock                   { &:before { content: "\e033"; } }
-.glyphicon-flag                   { &:before { content: "\e034"; } }
-.glyphicon-headphones             { &:before { content: "\e035"; } }
-.glyphicon-volume-off             { &:before { content: "\e036"; } }
-.glyphicon-volume-down            { &:before { content: "\e037"; } }
-.glyphicon-volume-up              { &:before { content: "\e038"; } }
-.glyphicon-qrcode                 { &:before { content: "\e039"; } }
-.glyphicon-barcode                { &:before { content: "\e040"; } }
-.glyphicon-tag                    { &:before { content: "\e041"; } }
-.glyphicon-tags                   { &:before { content: "\e042"; } }
-.glyphicon-book                   { &:before { content: "\e043"; } }
-.glyphicon-bookmark               { &:before { content: "\e044"; } }
-.glyphicon-print                  { &:before { content: "\e045"; } }
-.glyphicon-camera                 { &:before { content: "\e046"; } }
-.glyphicon-font                   { &:before { content: "\e047"; } }
-.glyphicon-bold                   { &:before { content: "\e048"; } }
-.glyphicon-italic                 { &:before { content: "\e049"; } }
-.glyphicon-text-height            { &:before { content: "\e050"; } }
-.glyphicon-text-width             { &:before { content: "\e051"; } }
-.glyphicon-align-left             { &:before { content: "\e052"; } }
-.glyphicon-align-center           { &:before { content: "\e053"; } }
-.glyphicon-align-right            { &:before { content: "\e054"; } }
-.glyphicon-align-justify          { &:before { content: "\e055"; } }
-.glyphicon-list                   { &:before { content: "\e056"; } }
-.glyphicon-indent-left            { &:before { content: "\e057"; } }
-.glyphicon-indent-right           { &:before { content: "\e058"; } }
-.glyphicon-facetime-video         { &:before { content: "\e059"; } }
-.glyphicon-picture                { &:before { content: "\e060"; } }
-.glyphicon-map-marker             { &:before { content: "\e062"; } }
-.glyphicon-adjust                 { &:before { content: "\e063"; } }
-.glyphicon-tint                   { &:before { content: "\e064"; } }
-.glyphicon-edit                   { &:before { content: "\e065"; } }
-.glyphicon-share                  { &:before { content: "\e066"; } }
-.glyphicon-check                  { &:before { content: "\e067"; } }
-.glyphicon-move                   { &:before { content: "\e068"; } }
-.glyphicon-step-backward          { &:before { content: "\e069"; } }
-.glyphicon-fast-backward          { &:before { content: "\e070"; } }
-.glyphicon-backward               { &:before { content: "\e071"; } }
-.glyphicon-play                   { &:before { content: "\e072"; } }
-.glyphicon-pause                  { &:before { content: "\e073"; } }
-.glyphicon-stop                   { &:before { content: "\e074"; } }
-.glyphicon-forward                { &:before { content: "\e075"; } }
-.glyphicon-fast-forward           { &:before { content: "\e076"; } }
-.glyphicon-step-forward           { &:before { content: "\e077"; } }
-.glyphicon-eject                  { &:before { content: "\e078"; } }
-.glyphicon-chevron-left           { &:before { content: "\e079"; } }
-.glyphicon-chevron-right          { &:before { content: "\e080"; } }
-.glyphicon-plus-sign              { &:before { content: "\e081"; } }
-.glyphicon-minus-sign             { &:before { content: "\e082"; } }
-.glyphicon-remove-sign            { &:before { content: "\e083"; } }
-.glyphicon-ok-sign                { &:before { content: "\e084"; } }
-.glyphicon-question-sign          { &:before { content: "\e085"; } }
-.glyphicon-info-sign              { &:before { content: "\e086"; } }
-.glyphicon-screenshot             { &:before { content: "\e087"; } }
-.glyphicon-remove-circle          { &:before { content: "\e088"; } }
-.glyphicon-ok-circle              { &:before { content: "\e089"; } }
-.glyphicon-ban-circle             { &:before { content: "\e090"; } }
-.glyphicon-arrow-left             { &:before { content: "\e091"; } }
-.glyphicon-arrow-right            { &:before { content: "\e092"; } }
-.glyphicon-arrow-up               { &:before { content: "\e093"; } }
-.glyphicon-arrow-down             { &:before { content: "\e094"; } }
-.glyphicon-share-alt              { &:before { content: "\e095"; } }
-.glyphicon-resize-full            { &:before { content: "\e096"; } }
-.glyphicon-resize-small           { &:before { content: "\e097"; } }
-.glyphicon-exclamation-sign       { &:before { content: "\e101"; } }
-.glyphicon-gift                   { &:before { content: "\e102"; } }
-.glyphicon-leaf                   { &:before { content: "\e103"; } }
-.glyphicon-fire                   { &:before { content: "\e104"; } }
-.glyphicon-eye-open               { &:before { content: "\e105"; } }
-.glyphicon-eye-close              { &:before { content: "\e106"; } }
-.glyphicon-warning-sign           { &:before { content: "\e107"; } }
-.glyphicon-plane                  { &:before { content: "\e108"; } }
-.glyphicon-calendar               { &:before { content: "\e109"; } }
-.glyphicon-random                 { &:before { content: "\e110"; } }
-.glyphicon-comment                { &:before { content: "\e111"; } }
-.glyphicon-magnet                 { &:before { content: "\e112"; } }
-.glyphicon-chevron-up             { &:before { content: "\e113"; } }
-.glyphicon-chevron-down           { &:before { content: "\e114"; } }
-.glyphicon-retweet                { &:before { content: "\e115"; } }
-.glyphicon-shopping-cart          { &:before { content: "\e116"; } }
-.glyphicon-folder-close           { &:before { content: "\e117"; } }
-.glyphicon-folder-open            { &:before { content: "\e118"; } }
-.glyphicon-resize-vertical        { &:before { content: "\e119"; } }
-.glyphicon-resize-horizontal      { &:before { content: "\e120"; } }
-.glyphicon-hdd                    { &:before { content: "\e121"; } }
-.glyphicon-bullhorn               { &:before { content: "\e122"; } }
-.glyphicon-bell                   { &:before { content: "\e123"; } }
-.glyphicon-certificate            { &:before { content: "\e124"; } }
-.glyphicon-thumbs-up              { &:before { content: "\e125"; } }
-.glyphicon-thumbs-down            { &:before { content: "\e126"; } }
-.glyphicon-hand-right             { &:before { content: "\e127"; } }
-.glyphicon-hand-left              { &:before { content: "\e128"; } }
-.glyphicon-hand-up                { &:before { content: "\e129"; } }
-.glyphicon-hand-down              { &:before { content: "\e130"; } }
-.glyphicon-circle-arrow-right     { &:before { content: "\e131"; } }
-.glyphicon-circle-arrow-left      { &:before { content: "\e132"; } }
-.glyphicon-circle-arrow-up        { &:before { content: "\e133"; } }
-.glyphicon-circle-arrow-down      { &:before { content: "\e134"; } }
-.glyphicon-globe                  { &:before { content: "\e135"; } }
-.glyphicon-wrench                 { &:before { content: "\e136"; } }
-.glyphicon-tasks                  { &:before { content: "\e137"; } }
-.glyphicon-filter                 { &:before { content: "\e138"; } }
-.glyphicon-briefcase              { &:before { content: "\e139"; } }
-.glyphicon-fullscreen             { &:before { content: "\e140"; } }
-.glyphicon-dashboard              { &:before { content: "\e141"; } }
-.glyphicon-paperclip              { &:before { content: "\e142"; } }
-.glyphicon-heart-empty            { &:before { content: "\e143"; } }
-.glyphicon-link                   { &:before { content: "\e144"; } }
-.glyphicon-phone                  { &:before { content: "\e145"; } }
-.glyphicon-pushpin                { &:before { content: "\e146"; } }
-.glyphicon-usd                    { &:before { content: "\e148"; } }
-.glyphicon-gbp                    { &:before { content: "\e149"; } }
-.glyphicon-sort                   { &:before { content: "\e150"; } }
-.glyphicon-sort-by-alphabet       { &:before { content: "\e151"; } }
-.glyphicon-sort-by-alphabet-alt   { &:before { content: "\e152"; } }
-.glyphicon-sort-by-order          { &:before { content: "\e153"; } }
-.glyphicon-sort-by-order-alt      { &:before { content: "\e154"; } }
-.glyphicon-sort-by-attributes     { &:before { content: "\e155"; } }
-.glyphicon-sort-by-attributes-alt { &:before { content: "\e156"; } }
-.glyphicon-unchecked              { &:before { content: "\e157"; } }
-.glyphicon-expand                 { &:before { content: "\e158"; } }
-.glyphicon-collapse-down          { &:before { content: "\e159"; } }
-.glyphicon-collapse-up            { &:before { content: "\e160"; } }
-.glyphicon-log-in                 { &:before { content: "\e161"; } }
-.glyphicon-flash                  { &:before { content: "\e162"; } }
-.glyphicon-log-out                { &:before { content: "\e163"; } }
-.glyphicon-new-window             { &:before { content: "\e164"; } }
-.glyphicon-record                 { &:before { content: "\e165"; } }
-.glyphicon-save                   { &:before { content: "\e166"; } }
-.glyphicon-open                   { &:before { content: "\e167"; } }
-.glyphicon-saved                  { &:before { content: "\e168"; } }
-.glyphicon-import                 { &:before { content: "\e169"; } }
-.glyphicon-export                 { &:before { content: "\e170"; } }
-.glyphicon-send                   { &:before { content: "\e171"; } }
-.glyphicon-floppy-disk            { &:before { content: "\e172"; } }
-.glyphicon-floppy-saved           { &:before { content: "\e173"; } }
-.glyphicon-floppy-remove          { &:before { content: "\e174"; } }
-.glyphicon-floppy-save            { &:before { content: "\e175"; } }
-.glyphicon-floppy-open            { &:before { content: "\e176"; } }
-.glyphicon-credit-card            { &:before { content: "\e177"; } }
-.glyphicon-transfer               { &:before { content: "\e178"; } }
-.glyphicon-cutlery                { &:before { content: "\e179"; } }
-.glyphicon-header                 { &:before { content: "\e180"; } }
-.glyphicon-compressed             { &:before { content: "\e181"; } }
-.glyphicon-earphone               { &:before { content: "\e182"; } }
-.glyphicon-phone-alt              { &:before { content: "\e183"; } }
-.glyphicon-tower                  { &:before { content: "\e184"; } }
-.glyphicon-stats                  { &:before { content: "\e185"; } }
-.glyphicon-sd-video               { &:before { content: "\e186"; } }
-.glyphicon-hd-video               { &:before { content: "\e187"; } }
-.glyphicon-subtitles              { &:before { content: "\e188"; } }
-.glyphicon-sound-stereo           { &:before { content: "\e189"; } }
-.glyphicon-sound-dolby            { &:before { content: "\e190"; } }
-.glyphicon-sound-5-1              { &:before { content: "\e191"; } }
-.glyphicon-sound-6-1              { &:before { content: "\e192"; } }
-.glyphicon-sound-7-1              { &:before { content: "\e193"; } }
-.glyphicon-copyright-mark         { &:before { content: "\e194"; } }
-.glyphicon-registration-mark      { &:before { content: "\e195"; } }
-.glyphicon-cloud-download         { &:before { content: "\e197"; } }
-.glyphicon-cloud-upload           { &:before { content: "\e198"; } }
-.glyphicon-tree-conifer           { &:before { content: "\e199"; } }
-.glyphicon-tree-deciduous         { &:before { content: "\e200"; } }
-.glyphicon-cd                     { &:before { content: "\e201"; } }
-.glyphicon-save-file              { &:before { content: "\e202"; } }
-.glyphicon-open-file              { &:before { content: "\e203"; } }
-.glyphicon-level-up               { &:before { content: "\e204"; } }
-.glyphicon-copy                   { &:before { content: "\e205"; } }
-.glyphicon-paste                  { &:before { content: "\e206"; } }
-// The following 2 Glyphicons are omitted for the time being because
-// they currently use Unicode codepoints that are outside the
-// Basic Multilingual Plane (BMP). Older buggy versions of WebKit can't handle
-// non-BMP codepoints in CSS string escapes, and thus can't display these two icons.
-// Notably, the bug affects some older versions of the Android Browser.
-// More info: https://github.com/twbs/bootstrap/issues/10106
-// .glyphicon-door                   { &:before { content: "\1f6aa"; } }
-// .glyphicon-key                    { &:before { content: "\1f511"; } }
-.glyphicon-alert                  { &:before { content: "\e209"; } }
-.glyphicon-equalizer              { &:before { content: "\e210"; } }
-.glyphicon-king                   { &:before { content: "\e211"; } }
-.glyphicon-queen                  { &:before { content: "\e212"; } }
-.glyphicon-pawn                   { &:before { content: "\e213"; } }
-.glyphicon-bishop                 { &:before { content: "\e214"; } }
-.glyphicon-knight                 { &:before { content: "\e215"; } }
-.glyphicon-baby-formula           { &:before { content: "\e216"; } }
-.glyphicon-tent                   { &:before { content: "\26fa"; } }
-.glyphicon-blackboard             { &:before { content: "\e218"; } }
-.glyphicon-bed                    { &:before { content: "\e219"; } }
-.glyphicon-apple                  { &:before { content: "\f8ff"; } }
-.glyphicon-erase                  { &:before { content: "\e221"; } }
-.glyphicon-hourglass              { &:before { content: "\231b"; } }
-.glyphicon-lamp                   { &:before { content: "\e223"; } }
-.glyphicon-duplicate              { &:before { content: "\e224"; } }
-.glyphicon-piggy-bank             { &:before { content: "\e225"; } }
-.glyphicon-scissors               { &:before { content: "\e226"; } }
-.glyphicon-bitcoin                { &:before { content: "\e227"; } }
-.glyphicon-btc                    { &:before { content: "\e227"; } }
-.glyphicon-xbt                    { &:before { content: "\e227"; } }
-.glyphicon-yen                    { &:before { content: "\00a5"; } }
-.glyphicon-jpy                    { &:before { content: "\00a5"; } }
-.glyphicon-ruble                  { &:before { content: "\20bd"; } }
-.glyphicon-rub                    { &:before { content: "\20bd"; } }
-.glyphicon-scale                  { &:before { content: "\e230"; } }
-.glyphicon-ice-lolly              { &:before { content: "\e231"; } }
-.glyphicon-ice-lolly-tasted       { &:before { content: "\e232"; } }
-.glyphicon-education              { &:before { content: "\e233"; } }
-.glyphicon-option-horizontal      { &:before { content: "\e234"; } }
-.glyphicon-option-vertical        { &:before { content: "\e235"; } }
-.glyphicon-menu-hamburger         { &:before { content: "\e236"; } }
-.glyphicon-modal-window           { &:before { content: "\e237"; } }
-.glyphicon-oil                    { &:before { content: "\e238"; } }
-.glyphicon-grain                  { &:before { content: "\e239"; } }
-.glyphicon-sunglasses             { &:before { content: "\e240"; } }
-.glyphicon-text-size              { &:before { content: "\e241"; } }
-.glyphicon-text-color             { &:before { content: "\e242"; } }
-.glyphicon-text-background        { &:before { content: "\e243"; } }
-.glyphicon-object-align-top       { &:before { content: "\e244"; } }
-.glyphicon-object-align-bottom    { &:before { content: "\e245"; } }
-.glyphicon-object-align-horizontal{ &:before { content: "\e246"; } }
-.glyphicon-object-align-left      { &:before { content: "\e247"; } }
-.glyphicon-object-align-vertical  { &:before { content: "\e248"; } }
-.glyphicon-object-align-right     { &:before { content: "\e249"; } }
-.glyphicon-triangle-right         { &:before { content: "\e250"; } }
-.glyphicon-triangle-left          { &:before { content: "\e251"; } }
-.glyphicon-triangle-bottom        { &:before { content: "\e252"; } }
-.glyphicon-triangle-top           { &:before { content: "\e253"; } }
-.glyphicon-console                { &:before { content: "\e254"; } }
-.glyphicon-superscript            { &:before { content: "\e255"; } }
-.glyphicon-subscript              { &:before { content: "\e256"; } }
-.glyphicon-menu-left              { &:before { content: "\e257"; } }
-.glyphicon-menu-right             { &:before { content: "\e258"; } }
-.glyphicon-menu-down              { &:before { content: "\e259"; } }
-.glyphicon-menu-up                { &:before { content: "\e260"; } }
diff --git a/doc/bootstrap/grid.less b/doc/bootstrap/grid.less
deleted file mode 100644
index 2e61c942..00000000
--- a/doc/bootstrap/grid.less
+++ /dev/null
@@ -1,84 +0,0 @@
-//
-// Grid system
-// --------------------------------------------------
-
-
-// Container widths
-//
-// Set the container width, and override it for fixed navbars in media queries.
-
-.tb-container {
-  .container-fixed();
-
-  @media (min-width: @screen-sm-min) {
-    width: @container-sm;
-  }
-  @media (min-width: @screen-md-min) {
-    width: @container-md;
-  }
-  @media (min-width: @screen-lg-min) {
-    width: @container-lg;
-  }
-}
-
-
-// Fluid container
-//
-// Utilizes the mixin meant for fixed width containers, but without any defined
-// width for fluid, full width layouts.
-
-.container-fluid {
-  .container-fixed();
-}
-
-
-// Row
-//
-// Rows contain and clear the floats of your columns.
-
-.row {
-  .make-row();
-}
-
-
-// Columns
-//
-// Common styles for small and large grid columns
-
-.make-grid-columns();
-
-
-// Extra small grid
-//
-// Columns, offsets, pushes, and pulls for extra small devices like
-// smartphones.
-
-.make-grid(xs);
-
-
-// Small grid
-//
-// Columns, offsets, pushes, and pulls for the small device range, from phones
-// to tablets.
-
-@media (min-width: @screen-sm-min) {
-  .make-grid(sm);
-}
-
-
-// Medium grid
-//
-// Columns, offsets, pushes, and pulls for the desktop device range.
-
-@media (min-width: @screen-md-min) {
-  .make-grid(md);
-}
-
-
-// Large grid
-//
-// Columns, offsets, pushes, and pulls for the large desktop device range.
-
-@media (min-width: @screen-lg-min) {
-  .make-grid(lg);
-}
diff --git a/doc/bootstrap/input-groups.less b/doc/bootstrap/input-groups.less
deleted file mode 100644
index a8712f25..00000000
--- a/doc/bootstrap/input-groups.less
+++ /dev/null
@@ -1,166 +0,0 @@
-//
-// Input groups
-// --------------------------------------------------
-
-// Base styles
-// -------------------------
-.input-group {
-  position: relative; // For dropdowns
-  display: table;
-  border-collapse: separate; // prevent input groups from inheriting border styles from table cells when placed within a table
-
-  // Undo padding and float of grid classes
-  &[class*="col-"] {
-    float: none;
-    padding-left: 0;
-    padding-right: 0;
-  }
-
-  .form-control {
-    // Ensure that the input is always above the *appended* addon button for
-    // proper border colors.
-    position: relative;
-    z-index: 2;
-
-    // IE9 fubars the placeholder attribute in text inputs and the arrows on
-    // select elements in input groups. To fix it, we float the input. Details:
-    // https://github.com/twbs/bootstrap/issues/11561#issuecomment-28936855
-    float: left;
-
-    width: 100%;
-    margin-bottom: 0;
-  }
-}
-
-// Sizing options
-//
-// Remix the default form control sizing classes into new ones for easier
-// manipulation.
-
-.input-group-lg > .form-control,
-.input-group-lg > .input-group-addon,
-.input-group-lg > .input-group-btn > .btn {
-  .input-lg();
-}
-.input-group-sm > .form-control,
-.input-group-sm > .input-group-addon,
-.input-group-sm > .input-group-btn > .btn {
-  .input-sm();
-}
-
-
-// Display as table-cell
-// -------------------------
-.input-group-addon,
-.input-group-btn,
-.input-group .form-control {
-  display: table-cell;
-
-  &:not(:first-child):not(:last-child) {
-    border-radius: 0;
-  }
-}
-// Addon and addon wrapper for buttons
-.input-group-addon,
-.input-group-btn {
-  width: 1%;
-  white-space: nowrap;
-  vertical-align: middle; // Match the inputs
-}
-
-// Text input groups
-// -------------------------
-.input-group-addon {
-  padding: @padding-base-vertical @padding-base-horizontal;
-  font-size: @font-size-base;
-  font-weight: normal;
-  line-height: 1;
-  color: @input-color;
-  text-align: center;
-  background-color: @input-group-addon-bg;
-  border: 1px solid @input-group-addon-border-color;
-  border-radius: @border-radius-base;
-
-  // Sizing
-  &.input-sm {
-    padding: @padding-small-vertical @padding-small-horizontal;
-    font-size: @font-size-small;
-    border-radius: @border-radius-small;
-  }
-  &.input-lg {
-    padding: @padding-large-vertical @padding-large-horizontal;
-    font-size: @font-size-large;
-    border-radius: @border-radius-large;
-  }
-
-  // Nuke default margins from checkboxes and radios to vertically center within.
-  input[type="radio"],
-  input[type="checkbox"] {
-    margin-top: 0;
-  }
-}
-
-// Reset rounded corners
-.input-group .form-control:first-child,
-.input-group-addon:first-child,
-.input-group-btn:first-child > .btn,
-.input-group-btn:first-child > .btn-group > .btn,
-.input-group-btn:first-child > .dropdown-toggle,
-.input-group-btn:last-child > .btn:not(:last-child):not(.dropdown-toggle),
-.input-group-btn:last-child > .btn-group:not(:last-child) > .btn {
-  .border-right-radius(0);
-}
-.input-group-addon:first-child {
-  border-right: 0;
-}
-.input-group .form-control:last-child,
-.input-group-addon:last-child,
-.input-group-btn:last-child > .btn,
-.input-group-btn:last-child > .btn-group > .btn,
-.input-group-btn:last-child > .dropdown-toggle,
-.input-group-btn:first-child > .btn:not(:first-child),
-.input-group-btn:first-child > .btn-group:not(:first-child) > .btn {
-  .border-left-radius(0);
-}
-.input-group-addon:last-child {
-  border-left: 0;
-}
-
-// Button input groups
-// -------------------------
-.input-group-btn {
-  position: relative;
-  // Jankily prevent input button groups from wrapping with `white-space` and
-  // `font-size` in combination with `inline-block` on buttons.
-  font-size: 0;
-  white-space: nowrap;
-
-  // Negative margin for spacing, position for bringing hovered/focused/actived
-  // element above the siblings.
-  > .btn {
-    position: relative;
-    + .btn {
-      margin-left: -1px;
-    }
-    // Bring the "active" button to the front
-    &:hover,
-    &:focus,
-    &:active {
-      z-index: 2;
-    }
-  }
-
-  // Negative margin to only have a 1px border between the two
-  &:first-child {
-    > .btn,
-    > .btn-group {
-      margin-right: -1px;
-    }
-  }
-  &:last-child {
-    > .btn,
-    > .btn-group {
-      margin-left: -1px;
-    }
-  }
-}
diff --git a/doc/bootstrap/jumbotron.less b/doc/bootstrap/jumbotron.less
deleted file mode 100644
index 909580f9..00000000
--- a/doc/bootstrap/jumbotron.less
+++ /dev/null
@@ -1,50 +0,0 @@
-//
-// Jumbotron
-// --------------------------------------------------
-
-
-.jumbotron {
-  padding: @jumbotron-padding (@jumbotron-padding / 2);
-  margin-bottom: @jumbotron-padding;
-  color: @jumbotron-color;
-  background-color: @jumbotron-bg;
-
-  h1,
-  .h1 {
-    color: @jumbotron-heading-color;
-  }
-
-  p {
-    margin-bottom: (@jumbotron-padding / 2);
-    font-size: @jumbotron-font-size;
-    font-weight: 200;
-  }
-
-  > hr {
-    border-top-color: darken(@jumbotron-bg, 10%);
-  }
-
-  .tb-container &,
-  .container-fluid & {
-    border-radius: @border-radius-large; // Only round corners at higher resolutions if contained in a container
-  }
-
-  .tb-container {
-    max-width: 100%;
-  }
-
-  @media screen and (min-width: @screen-sm-min) {
-    padding: (@jumbotron-padding * 1.6) 0;
-
-    .tb-container &,
-    .container-fluid & {
-      padding-left:  (@jumbotron-padding * 2);
-      padding-right: (@jumbotron-padding * 2);
-    }
-
-    h1,
-    .h1 {
-      font-size: (@font-size-base * 4.5);
-    }
-  }
-}
diff --git a/doc/bootstrap/labels.less b/doc/bootstrap/labels.less
deleted file mode 100644
index 9a5a2700..00000000
--- a/doc/bootstrap/labels.less
+++ /dev/null
@@ -1,64 +0,0 @@
-//
-// Labels
-// --------------------------------------------------
-
-.label {
-  display: inline;
-  padding: .2em .6em .3em;
-  font-size: 75%;
-  font-weight: bold;
-  line-height: 1;
-  color: @label-color;
-  text-align: center;
-  white-space: nowrap;
-  vertical-align: baseline;
-  border-radius: .25em;
-
-  // Add hover effects, but only for links
-  a& {
-    &:hover,
-    &:focus {
-      color: @label-link-hover-color;
-      text-decoration: none;
-      cursor: pointer;
-    }
-  }
-
-  // Empty labels collapse automatically (not available in IE8)
-  &:empty {
-    display: none;
-  }
-
-  // Quick fix for labels in buttons
-  .btn & {
-    position: relative;
-    top: -1px;
-  }
-}
-
-// Colors
-// Contextual variations (linked labels get darker on :hover)
-
-.label-default {
-  .label-variant(@label-default-bg);
-}
-
-.label-primary {
-  .label-variant(@label-primary-bg);
-}
-
-.label-success {
-  .label-variant(@label-success-bg);
-}
-
-.label-info {
-  .label-variant(@label-info-bg);
-}
-
-.label-warning {
-  .label-variant(@label-warning-bg);
-}
-
-.label-danger {
-  .label-variant(@label-danger-bg);
-}
diff --git a/doc/bootstrap/list-group.less b/doc/bootstrap/list-group.less
deleted file mode 100644
index 1462ce16..00000000
--- a/doc/bootstrap/list-group.less
+++ /dev/null
@@ -1,124 +0,0 @@
-//
-// List groups
-// --------------------------------------------------
-
-
-// Base class
-//
-// Easily usable on <ul>, <ol>, or <div>.
-
-.list-group {
-  // No need to set list-style: none; since .list-group-item is block level
-  margin-bottom: 20px;
-  padding-left: 0; // reset padding because ul and ol
-}
-
-
-// Individual list items
-//
-// Use on `li`s or `div`s within the `.list-group` parent.
-
-.list-group-item {
-  position: relative;
-  display: block;
-  padding: 10px 15px;
-  // Place the border on the list items and negative margin up for better styling
-  margin-bottom: -1px;
-  background-color: @list-group-bg;
-  border: 1px solid @list-group-border;
-
-  // Round the first and last items
-  &:first-child {
-    .border-top-radius(@list-group-border-radius);
-  }
-  &:last-child {
-    margin-bottom: 0;
-    .border-bottom-radius(@list-group-border-radius);
-  }
-}
-
-
-// Linked list items
-//
-// Use anchor elements instead of `li`s or `div`s to create linked list items.
-// Includes an extra `.active` modifier class for showing selected items.
-
-a.list-group-item {
-  color: @list-group-link-color;
-
-  .list-group-item-heading {
-    color: @list-group-link-heading-color;
-  }
-
-  // Hover state
-  &:hover,
-  &:focus {
-    text-decoration: none;
-    color: @list-group-link-hover-color;
-    background-color: @list-group-hover-bg;
-  }
-}
-
-.list-group-item {
-  // Disabled state
-  &.disabled,
-  &.disabled:hover,
-  &.disabled:focus {
-    background-color: @list-group-disabled-bg;
-    color: @list-group-disabled-color;
-    cursor: @cursor-disabled;
-
-    // Force color to inherit for custom content
-    .list-group-item-heading {
-      color: inherit;
-    }
-    .list-group-item-text {
-      color: @list-group-disabled-text-color;
-    }
-  }
-
-  // Active class on item itself, not parent
-  &.active,
-  &.active:hover,
-  &.active:focus {
-    z-index: 2; // Place active items above their siblings for proper border styling
-    color: @list-group-active-color;
-    background-color: @list-group-active-bg;
-    border-color: @list-group-active-border;
-
-    // Force color to inherit for custom content
-    .list-group-item-heading,
-    .list-group-item-heading > small,
-    .list-group-item-heading > .small {
-      color: inherit;
-    }
-    .list-group-item-text {
-      color: @list-group-active-text-color;
-    }
-  }
-}
-
-
-// Contextual variants
-//
-// Add modifier classes to change text and background color on individual items.
-// Organizationally, this must come after the `:hover` states.
-
-.list-group-item-variant(success; @state-success-bg; @state-success-text);
-.list-group-item-variant(info; @state-info-bg; @state-info-text);
-.list-group-item-variant(warning; @state-warning-bg; @state-warning-text);
-.list-group-item-variant(danger; @state-danger-bg; @state-danger-text);
-
-
-// Custom content options
-//
-// Extra classes for creating well-formatted content within `.list-group-item`s.
-
-.list-group-item-heading {
-  margin-top: 0;
-  margin-bottom: 5px;
-}
-.list-group-item-text {
-  margin-bottom: 0;
-  line-height: 1.3;
-}
diff --git a/doc/bootstrap/media.less b/doc/bootstrap/media.less
deleted file mode 100644
index a6bf7819..00000000
--- a/doc/bootstrap/media.less
+++ /dev/null
@@ -1,61 +0,0 @@
-.media {
-  // Proper spacing between instances of .media
-  margin-top: 15px;
-
-  &:first-child {
-    margin-top: 0;
-  }
-}
-
-.media,
-.media-body {
-  zoom: 1;
-  overflow: hidden;
-}
-
-.media-body {
-  width: 10000px;
-}
-
-.media-object {
-  display: block;
-}
-
-.media-right,
-.media > .pull-right {
-  padding-left: 10px;
-}
-
-.media-left,
-.media > .pull-left {
-  padding-right: 10px;
-}
-
-.media-left,
-.media-right,
-.media-body {
-  display: table-cell;
-  vertical-align: top;
-}
-
-.media-middle {
-  vertical-align: middle;
-}
-
-.media-bottom {
-  vertical-align: bottom;
-}
-
-// Reset margins on headings for tighter default spacing
-.media-heading {
-  margin-top: 0;
-  margin-bottom: 5px;
-}
-
-// Media list variation
-//
-// Undo default ul/ol styles
-.media-list {
-  padding-left: 0;
-  list-style: none;
-}
diff --git a/doc/bootstrap/mixins.less b/doc/bootstrap/mixins.less
deleted file mode 100644
index af4408fc..00000000
--- a/doc/bootstrap/mixins.less
+++ /dev/null
@@ -1,39 +0,0 @@
-// Mixins
-// --------------------------------------------------
-
-// Utilities
-@import "mixins/hide-text.less";
-@import "mixins/opacity.less";
-@import "mixins/image.less";
-@import "mixins/labels.less";
-@import "mixins/reset-filter.less";
-@import "mixins/resize.less";
-@import "mixins/responsive-visibility.less";
-@import "mixins/size.less";
-@import "mixins/tab-focus.less";
-@import "mixins/text-emphasis.less";
-@import "mixins/text-overflow.less";
-@import "mixins/vendor-prefixes.less";
-
-// Components
-@import "mixins/alerts.less";
-@import "mixins/buttons.less";
-@import "mixins/panels.less";
-@import "mixins/pagination.less";
-@import "mixins/list-group.less";
-@import "mixins/nav-divider.less";
-@import "mixins/forms.less";
-@import "mixins/progress-bar.less";
-@import "mixins/table-row.less";
-
-// Skins
-@import "mixins/background-variant.less";
-@import "mixins/border-radius.less";
-@import "mixins/gradients.less";
-
-// Layout
-@import "mixins/clearfix.less";
-@import "mixins/center-block.less";
-@import "mixins/nav-vertical-align.less";
-@import "mixins/grid-framework.less";
-@import "mixins/grid.less";
diff --git a/doc/bootstrap/mixins/alerts.less b/doc/bootstrap/mixins/alerts.less
deleted file mode 100644
index 396196f4..00000000
--- a/doc/bootstrap/mixins/alerts.less
+++ /dev/null
@@ -1,14 +0,0 @@
-// Alerts
-
-.alert-variant(@background; @border; @text-color) {
-  background-color: @background;
-  border-color: @border;
-  color: @text-color;
-
-  hr {
-    border-top-color: darken(@border, 5%);
-  }
-  .alert-link {
-    color: darken(@text-color, 10%);
-  }
-}
diff --git a/doc/bootstrap/mixins/background-variant.less b/doc/bootstrap/mixins/background-variant.less
deleted file mode 100644
index 556e490d..00000000
--- a/doc/bootstrap/mixins/background-variant.less
+++ /dev/null
@@ -1,8 +0,0 @@
-// Contextual backgrounds
-
-.bg-variant(@color) {
-  background-color: @color;
-  a&:hover {
-    background-color: darken(@color, 10%);
-  }
-}
diff --git a/doc/bootstrap/mixins/border-radius.less b/doc/bootstrap/mixins/border-radius.less
deleted file mode 100644
index ca05dbf4..00000000
--- a/doc/bootstrap/mixins/border-radius.less
+++ /dev/null
@@ -1,18 +0,0 @@
-// Single side border-radius
-
-.border-top-radius(@radius) {
-  border-top-right-radius: @radius;
-   border-top-left-radius: @radius;
-}
-.border-right-radius(@radius) {
-  border-bottom-right-radius: @radius;
-     border-top-right-radius: @radius;
-}
-.border-bottom-radius(@radius) {
-  border-bottom-right-radius: @radius;
-   border-bottom-left-radius: @radius;
-}
-.border-left-radius(@radius) {
-  border-bottom-left-radius: @radius;
-     border-top-left-radius: @radius;
-}
diff --git a/doc/bootstrap/mixins/buttons.less b/doc/bootstrap/mixins/buttons.less
deleted file mode 100644
index 92d8a056..00000000
--- a/doc/bootstrap/mixins/buttons.less
+++ /dev/null
@@ -1,52 +0,0 @@
-// Button variants
-//
-// Easily pump out default styles, as well as :hover, :focus, :active,
-// and disabled options for all buttons
-
-.button-variant(@color; @background; @border) {
-  color: @color;
-  background-color: @background;
-  border-color: @border;
-
-  &:hover,
-  &:focus,
-  &.focus,
-  &:active,
-  &.active,
-  .open > .dropdown-toggle& {
-    color: @color;
-    background-color: darken(@background, 10%);
-        border-color: darken(@border, 12%);
-  }
-  &:active,
-  &.active,
-  .open > .dropdown-toggle& {
-    background-image: none;
-  }
-  &.disabled,
-  &[disabled],
-  fieldset[disabled] & {
-    &,
-    &:hover,
-    &:focus,
-    &.focus,
-    &:active,
-    &.active {
-      background-color: @background;
-          border-color: @border;
-    }
-  }
-
-  .badge {
-    color: @background;
-    background-color: @color;
-  }
-}
-
-// Button sizes
-.button-size(@padding-vertical; @padding-horizontal; @font-size; @line-height; @border-radius) {
-  padding: @padding-vertical @padding-horizontal;
-  font-size: @font-size;
-  line-height: @line-height;
-  border-radius: @border-radius;
-}
diff --git a/doc/bootstrap/mixins/center-block.less b/doc/bootstrap/mixins/center-block.less
deleted file mode 100644
index d18d6de9..00000000
--- a/doc/bootstrap/mixins/center-block.less
+++ /dev/null
@@ -1,7 +0,0 @@
-// Center-align a block level element
-
-.center-block() {
-  display: block;
-  margin-left: auto;
-  margin-right: auto;
-}
diff --git a/doc/bootstrap/mixins/clearfix.less b/doc/bootstrap/mixins/clearfix.less
deleted file mode 100644
index 3f7a3820..00000000
--- a/doc/bootstrap/mixins/clearfix.less
+++ /dev/null
@@ -1,22 +0,0 @@
-// Clearfix
-//
-// For modern browsers
-// 1. The space content is one way to avoid an Opera bug when the
-//    contenteditable attribute is included anywhere else in the document.
-//    Otherwise it causes space to appear at the top and bottom of elements
-//    that are clearfixed.
-// 2. The use of `table` rather than `block` is only necessary if using
-//    `:before` to contain the top-margins of child elements.
-//
-// Source: http://nicolasgallagher.com/micro-clearfix-hack/
-
-.clearfix() {
-  &:before,
-  &:after {
-    content: " "; // 1
-    display: table; // 2
-  }
-  &:after {
-    clear: both;
-  }
-}
diff --git a/doc/bootstrap/mixins/forms.less b/doc/bootstrap/mixins/forms.less
deleted file mode 100644
index 6f55ed96..00000000
--- a/doc/bootstrap/mixins/forms.less
+++ /dev/null
@@ -1,85 +0,0 @@
-// Form validation states
-//
-// Used in forms.less to generate the form validation CSS for warnings, errors,
-// and successes.
-
-.form-control-validation(@text-color: #555; @border-color: #ccc; @background-color: #f5f5f5) {
-  // Color the label and help text
-  .help-block,
-  .control-label,
-  .radio,
-  .checkbox,
-  .radio-inline,
-  .checkbox-inline,
-  &.radio label,
-  &.checkbox label,
-  &.radio-inline label,
-  &.checkbox-inline label  {
-    color: @text-color;
-  }
-  // Set the border and box shadow on specific inputs to match
-  .form-control {
-    border-color: @border-color;
-    .box-shadow(inset 0 1px 1px rgba(0,0,0,.075)); // Redeclare so transitions work
-    &:focus {
-      border-color: darken(@border-color, 10%);
-      @shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 6px lighten(@border-color, 20%);
-      .box-shadow(@shadow);
-    }
-  }
-  // Set validation states also for addons
-  .input-group-addon {
-    color: @text-color;
-    border-color: @border-color;
-    background-color: @background-color;
-  }
-  // Optional feedback icon
-  .form-control-feedback {
-    color: @text-color;
-  }
-}
-
-
-// Form control focus state
-//
-// Generate a customized focus state and for any input with the specified color,
-// which defaults to the `@input-border-focus` variable.
-//
-// We highly encourage you to not customize the default value, but instead use
-// this to tweak colors on an as-needed basis. This aesthetic change is based on
-// WebKit's default styles, but applicable to a wider range of browsers. Its
-// usability and accessibility should be taken into account with any change.
-//
-// Example usage: change the default blue border and shadow to white for better
-// contrast against a dark gray background.
-.form-control-focus(@color: @input-border-focus) {
-  @color-rgba: rgba(red(@color), green(@color), blue(@color), .6);
-  &:focus {
-    border-color: @color;
-    outline: 0;
-    .box-shadow(~"inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px @{color-rgba}");
-  }
-}
-
-// Form control sizing
-//
-// Relative text size, padding, and border-radii changes for form controls. For
-// horizontal sizing, wrap controls in the predefined grid classes. `<select>`
-// element gets special love because it's special, and that's a fact!
-.input-size(@input-height; @padding-vertical; @padding-horizontal; @font-size; @line-height; @border-radius) {
-  height: @input-height;
-  padding: @padding-vertical @padding-horizontal;
-  font-size: @font-size;
-  line-height: @line-height;
-  border-radius: @border-radius;
-
-  select& {
-    height: @input-height;
-    line-height: @input-height;
-  }
-
-  textarea&,
-  select[multiple]& {
-    height: auto;
-  }
-}
diff --git a/doc/bootstrap/mixins/gradients.less b/doc/bootstrap/mixins/gradients.less
deleted file mode 100644
index 0b88a89c..00000000
--- a/doc/bootstrap/mixins/gradients.less
+++ /dev/null
@@ -1,59 +0,0 @@
-// Gradients
-
-#gradient {
-
-  // Horizontal gradient, from left to right
-  //
-  // Creates two color stops, start and end, by specifying a color and position for each color stop.
-  // Color stops are not available in IE9 and below.
-  .horizontal(@start-color: #555; @end-color: #333; @start-percent: 0%; @end-percent: 100%) {
-    background-image: -webkit-linear-gradient(left, @start-color @start-percent, @end-color @end-percent); // Safari 5.1-6, Chrome 10+
-    background-image: -o-linear-gradient(left, @start-color @start-percent, @end-color @end-percent); // Opera 12
-    background-image: linear-gradient(to right, @start-color @start-percent, @end-color @end-percent); // Standard, IE10, Firefox 16+, Opera 12.10+, Safari 7+, Chrome 26+
-    background-repeat: repeat-x;
-    filter: e(%("progid:DXImageTransform.Microsoft.gradient(startColorstr='%d', endColorstr='%d', GradientType=1)",argb(@start-color),argb(@end-color))); // IE9 and down
-  }
-
-  // Vertical gradient, from top to bottom
-  //
-  // Creates two color stops, start and end, by specifying a color and position for each color stop.
-  // Color stops are not available in IE9 and below.
-  .vertical(@start-color: #555; @end-color: #333; @start-percent: 0%; @end-percent: 100%) {
-    background-image: -webkit-linear-gradient(top, @start-color @start-percent, @end-color @end-percent);  // Safari 5.1-6, Chrome 10+
-    background-image: -o-linear-gradient(top, @start-color @start-percent, @end-color @end-percent);  // Opera 12
-    background-image: linear-gradient(to bottom, @start-color @start-percent, @end-color @end-percent); // Standard, IE10, Firefox 16+, Opera 12.10+, Safari 7+, Chrome 26+
-    background-repeat: repeat-x;
-    filter: e(%("progid:DXImageTransform.Microsoft.gradient(startColorstr='%d', endColorstr='%d', GradientType=0)",argb(@start-color),argb(@end-color))); // IE9 and down
-  }
-
-  .directional(@start-color: #555; @end-color: #333; @deg: 45deg) {
-    background-repeat: repeat-x;
-    background-image: -webkit-linear-gradient(@deg, @start-color, @end-color); // Safari 5.1-6, Chrome 10+
-    background-image: -o-linear-gradient(@deg, @start-color, @end-color); // Opera 12
-    background-image: linear-gradient(@deg, @start-color, @end-color); // Standard, IE10, Firefox 16+, Opera 12.10+, Safari 7+, Chrome 26+
-  }
-  .horizontal-three-colors(@start-color: #00b3ee; @mid-color: #7a43b6; @color-stop: 50%; @end-color: #c3325f) {
-    background-image: -webkit-linear-gradient(left, @start-color, @mid-color @color-stop, @end-color);
-    background-image: -o-linear-gradient(left, @start-color, @mid-color @color-stop, @end-color);
-    background-image: linear-gradient(to right, @start-color, @mid-color @color-stop, @end-color);
-    background-repeat: no-repeat;
-    filter: e(%("progid:DXImageTransform.Microsoft.gradient(startColorstr='%d', endColorstr='%d', GradientType=1)",argb(@start-color),argb(@end-color))); // IE9 and down, gets no color-stop at all for proper fallback
-  }
-  .vertical-three-colors(@start-color: #00b3ee; @mid-color: #7a43b6; @color-stop: 50%; @end-color: #c3325f) {
-    background-image: -webkit-linear-gradient(@start-color, @mid-color @color-stop, @end-color);
-    background-image: -o-linear-gradient(@start-color, @mid-color @color-stop, @end-color);
-    background-image: linear-gradient(@start-color, @mid-color @color-stop, @end-color);
-    background-repeat: no-repeat;
-    filter: e(%("progid:DXImageTransform.Microsoft.gradient(startColorstr='%d', endColorstr='%d', GradientType=0)",argb(@start-color),argb(@end-color))); // IE9 and down, gets no color-stop at all for proper fallback
-  }
-  .radial(@inner-color: #555; @outer-color: #333) {
-    background-image: -webkit-radial-gradient(circle, @inner-color, @outer-color);
-    background-image: radial-gradient(circle, @inner-color, @outer-color);
-    background-repeat: no-repeat;
-  }
-  .striped(@color: rgba(255,255,255,.15); @angle: 45deg) {
-    background-image: -webkit-linear-gradient(@angle, @color 25%, transparent 25%, transparent 50%, @color 50%, @color 75%, transparent 75%, transparent);
-    background-image: -o-linear-gradient(@angle, @color 25%, transparent 25%, transparent 50%, @color 50%, @color 75%, transparent 75%, transparent);
-    background-image: linear-gradient(@angle, @color 25%, transparent 25%, transparent 50%, @color 50%, @color 75%, transparent 75%, transparent);
-  }
-}
diff --git a/doc/bootstrap/mixins/grid-framework.less b/doc/bootstrap/mixins/grid-framework.less
deleted file mode 100644
index f3b3929d..00000000
--- a/doc/bootstrap/mixins/grid-framework.less
+++ /dev/null
@@ -1,91 +0,0 @@
-// Framework grid generation
-//
-// Used only by Bootstrap to generate the correct number of grid classes given
-// any value of `@grid-columns`.
-
-.make-grid-columns() {
-  // Common styles for all sizes of grid columns, widths 1-12
-  .col(@index) { // initial
-    @item: ~".col-xs-@{index}, .col-sm-@{index}, .col-md-@{index}, .col-lg-@{index}";
-    .col((@index + 1), @item);
-  }
-  .col(@index, @list) when (@index =< @grid-columns) { // general; "=<" isn't a typo
-    @item: ~".col-xs-@{index}, .col-sm-@{index}, .col-md-@{index}, .col-lg-@{index}";
-    .col((@index + 1), ~"@{list}, @{item}");
-  }
-  .col(@index, @list) when (@index > @grid-columns) { // terminal
-    @{list} {
-      position: relative;
-      // Prevent columns from collapsing when empty
-      min-height: 1px;
-      // Inner gutter via padding
-      padding-left:  (@grid-gutter-width / 2);
-      padding-right: (@grid-gutter-width / 2);
-    }
-  }
-  .col(1); // kickstart it
-}
-
-.float-grid-columns(@class) {
-  .col(@index) { // initial
-    @item: ~".col-@{class}-@{index}";
-    .col((@index + 1), @item);
-  }
-  .col(@index, @list) when (@index =< @grid-columns) { // general
-    @item: ~".col-@{class}-@{index}";
-    .col((@index + 1), ~"@{list}, @{item}");
-  }
-  .col(@index, @list) when (@index > @grid-columns) { // terminal
-    @{list} {
-      float: left;
-    }
-  }
-  .col(1); // kickstart it
-}
-
-.calc-grid-column(@index, @class, @type) when (@type = width) and (@index > 0) {
-  .col-@{class}-@{index} {
-    width: percentage((@index / @grid-columns));
-  }
-}
-.calc-grid-column(@index, @class, @type) when (@type = push) and (@index > 0) {
-  .col-@{class}-push-@{index} {
-    left: percentage((@index / @grid-columns));
-  }
-}
-.calc-grid-column(@index, @class, @type) when (@type = push) and (@index = 0) {
-  .col-@{class}-push-0 {
-    left: auto;
-  }
-}
-.calc-grid-column(@index, @class, @type) when (@type = pull) and (@index > 0) {
-  .col-@{class}-pull-@{index} {
-    right: percentage((@index / @grid-columns));
-  }
-}
-.calc-grid-column(@index, @class, @type) when (@type = pull) and (@index = 0) {
-  .col-@{class}-pull-0 {
-    right: auto;
-  }
-}
-.calc-grid-column(@index, @class, @type) when (@type = offset) {
-  .col-@{class}-offset-@{index} {
-    margin-left: percentage((@index / @grid-columns));
-  }
-}
-
-// Basic looping in LESS
-.loop-grid-columns(@index, @class, @type) when (@index >= 0) {
-  .calc-grid-column(@index, @class, @type);
-  // next iteration
-  .loop-grid-columns((@index - 1), @class, @type);
-}
-
-// Create grid for specific class
-.make-grid(@class) {
-  .float-grid-columns(@class);
-  .loop-grid-columns(@grid-columns, @class, width);
-  .loop-grid-columns(@grid-columns, @class, pull);
-  .loop-grid-columns(@grid-columns, @class, push);
-  .loop-grid-columns(@grid-columns, @class, offset);
-}
diff --git a/doc/bootstrap/mixins/grid.less b/doc/bootstrap/mixins/grid.less
deleted file mode 100644
index cae5eaff..00000000
--- a/doc/bootstrap/mixins/grid.less
+++ /dev/null
@@ -1,122 +0,0 @@
-// Grid system
-//
-// Generate semantic grid columns with these mixins.
-
-// Centered container element
-.container-fixed(@gutter: @grid-gutter-width) {
-  margin-right: auto;
-  margin-left: auto;
-  padding-left:  (@gutter / 2);
-  padding-right: (@gutter / 2);
-  &:extend(.clearfix all);
-}
-
-// Creates a wrapper for a series of columns
-.make-row(@gutter: @grid-gutter-width) {
-  margin-left:  (@gutter / -2);
-  margin-right: (@gutter / -2);
-  &:extend(.clearfix all);
-}
-
-// Generate the extra small columns
-.make-xs-column(@columns; @gutter: @grid-gutter-width) {
-  position: relative;
-  float: left;
-  width: percentage((@columns / @grid-columns));
-  min-height: 1px;
-  padding-left:  (@gutter / 2);
-  padding-right: (@gutter / 2);
-}
-.make-xs-column-offset(@columns) {
-  margin-left: percentage((@columns / @grid-columns));
-}
-.make-xs-column-push(@columns) {
-  left: percentage((@columns / @grid-columns));
-}
-.make-xs-column-pull(@columns) {
-  right: percentage((@columns / @grid-columns));
-}
-
-// Generate the small columns
-.make-sm-column(@columns; @gutter: @grid-gutter-width) {
-  position: relative;
-  min-height: 1px;
-  padding-left:  (@gutter / 2);
-  padding-right: (@gutter / 2);
-
-  @media (min-width: @screen-sm-min) {
-    float: left;
-    width: percentage((@columns / @grid-columns));
-  }
-}
-.make-sm-column-offset(@columns) {
-  @media (min-width: @screen-sm-min) {
-    margin-left: percentage((@columns / @grid-columns));
-  }
-}
-.make-sm-column-push(@columns) {
-  @media (min-width: @screen-sm-min) {
-    left: percentage((@columns / @grid-columns));
-  }
-}
-.make-sm-column-pull(@columns) {
-  @media (min-width: @screen-sm-min) {
-    right: percentage((@columns / @grid-columns));
-  }
-}
-
-// Generate the medium columns
-.make-md-column(@columns; @gutter: @grid-gutter-width) {
-  position: relative;
-  min-height: 1px;
-  padding-left:  (@gutter / 2);
-  padding-right: (@gutter / 2);
-
-  @media (min-width: @screen-md-min) {
-    float: left;
-    width: percentage((@columns / @grid-columns));
-  }
-}
-.make-md-column-offset(@columns) {
-  @media (min-width: @screen-md-min) {
-    margin-left: percentage((@columns / @grid-columns));
-  }
-}
-.make-md-column-push(@columns) {
-  @media (min-width: @screen-md-min) {
-    left: percentage((@columns / @grid-columns));
-  }
-}
-.make-md-column-pull(@columns) {
-  @media (min-width: @screen-md-min) {
-    right: percentage((@columns / @grid-columns));
-  }
-}
-
-// Generate the large columns
-.make-lg-column(@columns; @gutter: @grid-gutter-width) {
-  position: relative;
-  min-height: 1px;
-  padding-left:  (@gutter / 2);
-  padding-right: (@gutter / 2);
-
-  @media (min-width: @screen-lg-min) {
-    float: left;
-    width: percentage((@columns / @grid-columns));
-  }
-}
-.make-lg-column-offset(@columns) {
-  @media (min-width: @screen-lg-min) {
-    margin-left: percentage((@columns / @grid-columns));
-  }
-}
-.make-lg-column-push(@columns) {
-  @media (min-width: @screen-lg-min) {
-    left: percentage((@columns / @grid-columns));
-  }
-}
-.make-lg-column-pull(@columns) {
-  @media (min-width: @screen-lg-min) {
-    right: percentage((@columns / @grid-columns));
-  }
-}
diff --git a/doc/bootstrap/mixins/hide-text.less b/doc/bootstrap/mixins/hide-text.less
deleted file mode 100644
index c2315e57..00000000
--- a/doc/bootstrap/mixins/hide-text.less
+++ /dev/null
@@ -1,21 +0,0 @@
-// CSS image replacement
-//
-// Heads up! v3 launched with with only `.hide-text()`, but per our pattern for
-// mixins being reused as classes with the same name, this doesn't hold up. As
-// of v3.0.1 we have added `.text-hide()` and deprecated `.hide-text()`.
-//
-// Source: https://github.com/h5bp/html5-boilerplate/commit/aa0396eae757
-
-// Deprecated as of v3.0.1 (will be removed in v4)
-.hide-text() {
-  font: ~"0/0" a;
-  color: transparent;
-  text-shadow: none;
-  background-color: transparent;
-  border: 0;
-}
-
-// New mixin to use as of v3.0.1
-.text-hide() {
-  .hide-text();
-}
diff --git a/doc/bootstrap/mixins/image.less b/doc/bootstrap/mixins/image.less
deleted file mode 100644
index f233cb3e..00000000
--- a/doc/bootstrap/mixins/image.less
+++ /dev/null
@@ -1,33 +0,0 @@
-// Image Mixins
-// - Responsive image
-// - Retina image
-
-
-// Responsive image
-//
-// Keep images from scaling beyond the width of their parents.
-.img-responsive(@display: block) {
-  display: @display;
-  max-width: 100%; // Part 1: Set a maximum relative to the parent
-  height: auto; // Part 2: Scale the height according to the width, otherwise you get stretching
-}
-
-
-// Retina image
-//
-// Short retina mixin for setting background-image and -size. Note that the
-// spelling of `min--moz-device-pixel-ratio` is intentional.
-.img-retina(@file-1x; @file-2x; @width-1x; @height-1x) {
-  background-image: url("@{file-1x}");
-
-  @media
-  only screen and (-webkit-min-device-pixel-ratio: 2),
-  only screen and (   min--moz-device-pixel-ratio: 2),
-  only screen and (     -o-min-device-pixel-ratio: 2/1),
-  only screen and (        min-device-pixel-ratio: 2),
-  only screen and (                min-resolution: 192dpi),
-  only screen and (                min-resolution: 2dppx) {
-    background-image: url("@{file-2x}");
-    background-size: @width-1x @height-1x;
-  }
-}
diff --git a/doc/bootstrap/mixins/labels.less b/doc/bootstrap/mixins/labels.less
deleted file mode 100644
index 9f7a67ee..00000000
--- a/doc/bootstrap/mixins/labels.less
+++ /dev/null
@@ -1,12 +0,0 @@
-// Labels
-
-.label-variant(@color) {
-  background-color: @color;
-
-  &[href] {
-    &:hover,
-    &:focus {
-      background-color: darken(@color, 10%);
-    }
-  }
-}
diff --git a/doc/bootstrap/mixins/list-group.less b/doc/bootstrap/mixins/list-group.less
deleted file mode 100644
index 8b5b065c..00000000
--- a/doc/bootstrap/mixins/list-group.less
+++ /dev/null
@@ -1,29 +0,0 @@
-// List Groups
-
-.list-group-item-variant(@state; @background; @color) {
-  .list-group-item-@{state} {
-    color: @color;
-    background-color: @background;
-
-    a& {
-      color: @color;
-
-      .list-group-item-heading {
-        color: inherit;
-      }
-
-      &:hover,
-      &:focus {
-        color: @color;
-        background-color: darken(@background, 5%);
-      }
-      &.active,
-      &.active:hover,
-      &.active:focus {
-        color: #fff;
-        background-color: @color;
-        border-color: @color;
-      }
-    }
-  }
-}
diff --git a/doc/bootstrap/mixins/nav-divider.less b/doc/bootstrap/mixins/nav-divider.less
deleted file mode 100644
index feb1e9ed..00000000
--- a/doc/bootstrap/mixins/nav-divider.less
+++ /dev/null
@@ -1,10 +0,0 @@
-// Horizontal dividers
-//
-// Dividers (basically an hr) within dropdowns and nav lists
-
-.nav-divider(@color: #e5e5e5) {
-  height: 1px;
-  margin: ((@line-height-computed / 2) - 1) 0;
-  overflow: hidden;
-  background-color: @color;
-}
diff --git a/doc/bootstrap/mixins/nav-vertical-align.less b/doc/bootstrap/mixins/nav-vertical-align.less
deleted file mode 100644
index d458c786..00000000
--- a/doc/bootstrap/mixins/nav-vertical-align.less
+++ /dev/null
@@ -1,9 +0,0 @@
-// Navbar vertical align
-//
-// Vertically center elements in the navbar.
-// Example: an element has a height of 30px, so write out `.navbar-vertical-align(30px);` to calculate the appropriate top margin.
-
-.navbar-vertical-align(@element-height) {
-  margin-top: ((@navbar-height - @element-height) / 2);
-  margin-bottom: ((@navbar-height - @element-height) / 2);
-}
diff --git a/doc/bootstrap/mixins/opacity.less b/doc/bootstrap/mixins/opacity.less
deleted file mode 100644
index 33ed25ce..00000000
--- a/doc/bootstrap/mixins/opacity.less
+++ /dev/null
@@ -1,8 +0,0 @@
-// Opacity
-
-.opacity(@opacity) {
-  opacity: @opacity;
-  // IE8 filter
-  @opacity-ie: (@opacity * 100);
-  filter: ~"alpha(opacity=@{opacity-ie})";
-}
diff --git a/doc/bootstrap/mixins/pagination.less b/doc/bootstrap/mixins/pagination.less
deleted file mode 100644
index 7deb505d..00000000
--- a/doc/bootstrap/mixins/pagination.less
+++ /dev/null
@@ -1,23 +0,0 @@
-// Pagination
-
-.pagination-size(@padding-vertical; @padding-horizontal; @font-size; @border-radius) {
-  > li {
-    > a,
-    > span {
-      padding: @padding-vertical @padding-horizontal;
-      font-size: @font-size;
-    }
-    &:first-child {
-      > a,
-      > span {
-        .border-left-radius(@border-radius);
-      }
-    }
-    &:last-child {
-      > a,
-      > span {
-        .border-right-radius(@border-radius);
-      }
-    }
-  }
-}
diff --git a/doc/bootstrap/mixins/panels.less b/doc/bootstrap/mixins/panels.less
deleted file mode 100644
index 49ee10d4..00000000
--- a/doc/bootstrap/mixins/panels.less
+++ /dev/null
@@ -1,24 +0,0 @@
-// Panels
-
-.panel-variant(@border; @heading-text-color; @heading-bg-color; @heading-border) {
-  border-color: @border;
-
-  & > .panel-heading {
-    color: @heading-text-color;
-    background-color: @heading-bg-color;
-    border-color: @heading-border;
-
-    + .panel-collapse > .panel-body {
-      border-top-color: @border;
-    }
-    .badge {
-      color: @heading-bg-color;
-      background-color: @heading-text-color;
-    }
-  }
-  & > .panel-footer {
-    + .panel-collapse > .panel-body {
-      border-bottom-color: @border;
-    }
-  }
-}
diff --git a/doc/bootstrap/mixins/progress-bar.less b/doc/bootstrap/mixins/progress-bar.less
deleted file mode 100644
index f07996a3..00000000
--- a/doc/bootstrap/mixins/progress-bar.less
+++ /dev/null
@@ -1,10 +0,0 @@
-// Progress bars
-
-.progress-bar-variant(@color) {
-  background-color: @color;
-
-  // Deprecated parent class requirement as of v3.2.0
-  .progress-striped & {
-    #gradient > .striped();
-  }
-}
diff --git a/doc/bootstrap/mixins/reset-filter.less b/doc/bootstrap/mixins/reset-filter.less
deleted file mode 100644
index 68cdb5e1..00000000
--- a/doc/bootstrap/mixins/reset-filter.less
+++ /dev/null
@@ -1,8 +0,0 @@
-// Reset filters for IE
-//
-// When you need to remove a gradient background, do not forget to use this to reset
-// the IE filter for IE9 and below.
-
-.reset-filter() {
-  filter: e(%("progid:DXImageTransform.Microsoft.gradient(enabled = false)"));
-}
diff --git a/doc/bootstrap/mixins/resize.less b/doc/bootstrap/mixins/resize.less
deleted file mode 100644
index 3acd3afd..00000000
--- a/doc/bootstrap/mixins/resize.less
+++ /dev/null
@@ -1,6 +0,0 @@
-// Resize anything
-
-.resizable(@direction) {
-  resize: @direction; // Options: horizontal, vertical, both
-  overflow: auto; // Per CSS3 UI, `resize` only applies when `overflow` isn't `visible`
-}
diff --git a/doc/bootstrap/mixins/responsive-visibility.less b/doc/bootstrap/mixins/responsive-visibility.less
deleted file mode 100644
index f7951c3d..00000000
--- a/doc/bootstrap/mixins/responsive-visibility.less
+++ /dev/null
@@ -1,15 +0,0 @@
-// Responsive utilities
-
-//
-// More easily include all the states for responsive-utilities.less.
-.responsive-visibility() {
-  display: block !important;
-  table&  { display: table; }
-  tr&     { display: table-row !important; }
-  th&,
-  td&     { display: table-cell !important; }
-}
-
-.responsive-invisibility() {
-  display: none !important;
-}
diff --git a/doc/bootstrap/mixins/size.less b/doc/bootstrap/mixins/size.less
deleted file mode 100644
index a8be6508..00000000
--- a/doc/bootstrap/mixins/size.less
+++ /dev/null
@@ -1,10 +0,0 @@
-// Sizing shortcuts
-
-.size(@width; @height) {
-  width: @width;
-  height: @height;
-}
-
-.square(@size) {
-  .size(@size; @size);
-}
diff --git a/doc/bootstrap/mixins/tab-focus.less b/doc/bootstrap/mixins/tab-focus.less
deleted file mode 100644
index 1f1f05ab..00000000
--- a/doc/bootstrap/mixins/tab-focus.less
+++ /dev/null
@@ -1,9 +0,0 @@
-// WebKit-style focus
-
-.tab-focus() {
-  // Default
-  outline: thin dotted;
-  // WebKit
-  outline: 5px auto -webkit-focus-ring-color;
-  outline-offset: -2px;
-}
diff --git a/doc/bootstrap/mixins/table-row.less b/doc/bootstrap/mixins/table-row.less
deleted file mode 100644
index 0f287f1a..00000000
--- a/doc/bootstrap/mixins/table-row.less
+++ /dev/null
@@ -1,28 +0,0 @@
-// Tables
-
-.table-row-variant(@state; @background) {
-  // Exact selectors below required to override `.table-striped` and prevent
-  // inheritance to nested tables.
-  .table > thead > tr,
-  .table > tbody > tr,
-  .table > tfoot > tr {
-    > td.@{state},
-    > th.@{state},
-    &.@{state} > td,
-    &.@{state} > th {
-      background-color: @background;
-    }
-  }
-
-  // Hover states for `.table-hover`
-  // Note: this is not available for cells or rows within `thead` or `tfoot`.
-  .table-hover > tbody > tr {
-    > td.@{state}:hover,
-    > th.@{state}:hover,
-    &.@{state}:hover > td,
-    &:hover > .@{state},
-    &.@{state}:hover > th {
-      background-color: darken(@background, 5%);
-    }
-  }
-}
diff --git a/doc/bootstrap/mixins/text-emphasis.less b/doc/bootstrap/mixins/text-emphasis.less
deleted file mode 100644
index 0868ef9f..00000000
--- a/doc/bootstrap/mixins/text-emphasis.less
+++ /dev/null
@@ -1,8 +0,0 @@
-// Typography
-
-.text-emphasis-variant(@color) {
-  color: @color;
-  a&:hover {
-    color: darken(@color, 10%);
-  }
-}
diff --git a/doc/bootstrap/mixins/text-overflow.less b/doc/bootstrap/mixins/text-overflow.less
deleted file mode 100644
index c11ad2fb..00000000
--- a/doc/bootstrap/mixins/text-overflow.less
+++ /dev/null
@@ -1,8 +0,0 @@
-// Text overflow
-// Requires inline-block or block for proper styling
-
-.text-overflow() {
-  overflow: hidden;
-  text-overflow: ellipsis;
-  white-space: nowrap;
-}
diff --git a/doc/bootstrap/mixins/vendor-prefixes.less b/doc/bootstrap/mixins/vendor-prefixes.less
deleted file mode 100644
index afd3331c..00000000
--- a/doc/bootstrap/mixins/vendor-prefixes.less
+++ /dev/null
@@ -1,227 +0,0 @@
-// Vendor Prefixes
-//
-// All vendor mixins are deprecated as of v3.2.0 due to the introduction of
-// Autoprefixer in our Gruntfile. They will be removed in v4.
-
-// - Animations
-// - Backface visibility
-// - Box shadow
-// - Box sizing
-// - Content columns
-// - Hyphens
-// - Placeholder text
-// - Transformations
-// - Transitions
-// - User Select
-
-
-// Animations
-.animation(@animation) {
-  -webkit-animation: @animation;
-       -o-animation: @animation;
-          animation: @animation;
-}
-.animation-name(@name) {
-  -webkit-animation-name: @name;
-          animation-name: @name;
-}
-.animation-duration(@duration) {
-  -webkit-animation-duration: @duration;
-          animation-duration: @duration;
-}
-.animation-timing-function(@timing-function) {
-  -webkit-animation-timing-function: @timing-function;
-          animation-timing-function: @timing-function;
-}
-.animation-delay(@delay) {
-  -webkit-animation-delay: @delay;
-          animation-delay: @delay;
-}
-.animation-iteration-count(@iteration-count) {
-  -webkit-animation-iteration-count: @iteration-count;
-          animation-iteration-count: @iteration-count;
-}
-.animation-direction(@direction) {
-  -webkit-animation-direction: @direction;
-          animation-direction: @direction;
-}
-.animation-fill-mode(@fill-mode) {
-  -webkit-animation-fill-mode: @fill-mode;
-          animation-fill-mode: @fill-mode;
-}
-
-// Backface visibility
-// Prevent browsers from flickering when using CSS 3D transforms.
-// Default value is `visible`, but can be changed to `hidden`
-
-.backface-visibility(@visibility){
-  -webkit-backface-visibility: @visibility;
-     -moz-backface-visibility: @visibility;
-          backface-visibility: @visibility;
-}
-
-// Drop shadows
-//
-// Note: Deprecated `.box-shadow()` as of v3.1.0 since all of Bootstrap's
-// supported browsers that have box shadow capabilities now support it.
-
-.box-shadow(@shadow) {
-  -webkit-box-shadow: @shadow; // iOS <4.3 & Android <4.1
-          box-shadow: @shadow;
-}
-
-// Box sizing
-.box-sizing(@boxmodel) {
-  -webkit-box-sizing: @boxmodel;
-     -moz-box-sizing: @boxmodel;
-          box-sizing: @boxmodel;
-}
-
-// CSS3 Content Columns
-.content-columns(@column-count; @column-gap: @grid-gutter-width) {
-  -webkit-column-count: @column-count;
-     -moz-column-count: @column-count;
-          column-count: @column-count;
-  -webkit-column-gap: @column-gap;
-     -moz-column-gap: @column-gap;
-          column-gap: @column-gap;
-}
-
-// Optional hyphenation
-.hyphens(@mode: auto) {
-  word-wrap: break-word;
-  -webkit-hyphens: @mode;
-     -moz-hyphens: @mode;
-      -ms-hyphens: @mode; // IE10+
-       -o-hyphens: @mode;
-          hyphens: @mode;
-}
-
-// Placeholder text
-.placeholder(@color: @input-color-placeholder) {
-  // Firefox
-  &::-moz-placeholder {
-    color: @color;
-    opacity: 1; // Override Firefox's unusual default opacity; see https://github.com/twbs/bootstrap/pull/11526
-  }
-  &:-ms-input-placeholder { color: @color; } // Internet Explorer 10+
-  &::-webkit-input-placeholder  { color: @color; } // Safari and Chrome
-}
-
-// Transformations
-.scale(@ratio) {
-  -webkit-transform: scale(@ratio);
-      -ms-transform: scale(@ratio); // IE9 only
-       -o-transform: scale(@ratio);
-          transform: scale(@ratio);
-}
-.scale(@ratioX; @ratioY) {
-  -webkit-transform: scale(@ratioX, @ratioY);
-      -ms-transform: scale(@ratioX, @ratioY); // IE9 only
-       -o-transform: scale(@ratioX, @ratioY);
-          transform: scale(@ratioX, @ratioY);
-}
-.scaleX(@ratio) {
-  -webkit-transform: scaleX(@ratio);
-      -ms-transform: scaleX(@ratio); // IE9 only
-       -o-transform: scaleX(@ratio);
-          transform: scaleX(@ratio);
-}
-.scaleY(@ratio) {
-  -webkit-transform: scaleY(@ratio);
-      -ms-transform: scaleY(@ratio); // IE9 only
-       -o-transform: scaleY(@ratio);
-          transform: scaleY(@ratio);
-}
-.skew(@x; @y) {
-  -webkit-transform: skewX(@x) skewY(@y);
-      -ms-transform: skewX(@x) skewY(@y); // See https://github.com/twbs/bootstrap/issues/4885; IE9+
-       -o-transform: skewX(@x) skewY(@y);
-          transform: skewX(@x) skewY(@y);
-}
-.translate(@x; @y) {
-  -webkit-transform: translate(@x, @y);
-      -ms-transform: translate(@x, @y); // IE9 only
-       -o-transform: translate(@x, @y);
-          transform: translate(@x, @y);
-}
-.translate3d(@x; @y; @z) {
-  -webkit-transform: translate3d(@x, @y, @z);
-          transform: translate3d(@x, @y, @z);
-}
-.rotate(@degrees) {
-  -webkit-transform: rotate(@degrees);
-      -ms-transform: rotate(@degrees); // IE9 only
-       -o-transform: rotate(@degrees);
-          transform: rotate(@degrees);
-}
-.rotateX(@degrees) {
-  -webkit-transform: rotateX(@degrees);
-      -ms-transform: rotateX(@degrees); // IE9 only
-       -o-transform: rotateX(@degrees);
-          transform: rotateX(@degrees);
-}
-.rotateY(@degrees) {
-  -webkit-transform: rotateY(@degrees);
-      -ms-transform: rotateY(@degrees); // IE9 only
-       -o-transform: rotateY(@degrees);
-          transform: rotateY(@degrees);
-}
-.perspective(@perspective) {
-  -webkit-perspective: @perspective;
-     -moz-perspective: @perspective;
-          perspective: @perspective;
-}
-.perspective-origin(@perspective) {
-  -webkit-perspective-origin: @perspective;
-     -moz-perspective-origin: @perspective;
-          perspective-origin: @perspective;
-}
-.transform-origin(@origin) {
-  -webkit-transform-origin: @origin;
-     -moz-transform-origin: @origin;
-      -ms-transform-origin: @origin; // IE9 only
-          transform-origin: @origin;
-}
-
-
-// Transitions
-
-.transition(@transition) {
-  -webkit-transition: @transition;
-       -o-transition: @transition;
-          transition: @transition;
-}
-.transition-property(@transition-property) {
-  -webkit-transition-property: @transition-property;
-          transition-property: @transition-property;
-}
-.transition-delay(@transition-delay) {
-  -webkit-transition-delay: @transition-delay;
-          transition-delay: @transition-delay;
-}
-.transition-duration(@transition-duration) {
-  -webkit-transition-duration: @transition-duration;
-          transition-duration: @transition-duration;
-}
-.transition-timing-function(@timing-function) {
-  -webkit-transition-timing-function: @timing-function;
-          transition-timing-function: @timing-function;
-}
-.transition-transform(@transition) {
-  -webkit-transition: -webkit-transform @transition;
-     -moz-transition: -moz-transform @transition;
-       -o-transition: -o-transform @transition;
-          transition: transform @transition;
-}
-
-
-// User select
-// For selecting text on the page
-
-.user-select(@select) {
-  -webkit-user-select: @select;
-     -moz-user-select: @select;
-      -ms-user-select: @select; // IE10+
-          user-select: @select;
-}
diff --git a/doc/bootstrap/modals.less b/doc/bootstrap/modals.less
deleted file mode 100644
index 1de62205..00000000
--- a/doc/bootstrap/modals.less
+++ /dev/null
@@ -1,150 +0,0 @@
-//
-// Modals
-// --------------------------------------------------
-
-// .modal-open      - body class for killing the scroll
-// .modal           - container to scroll within
-// .modal-dialog    - positioning shell for the actual modal
-// .modal-content   - actual modal w/ bg and corners and shit
-
-// Kill the scroll on the body
-.modal-open {
-  overflow: hidden;
-}
-
-// Container that the modal scrolls within
-.modal {
-  display: none;
-  overflow: hidden;
-  position: fixed;
-  top: 0;
-  right: 0;
-  bottom: 0;
-  left: 0;
-  z-index: @zindex-modal;
-  -webkit-overflow-scrolling: touch;
-
-  // Prevent Chrome on Windows from adding a focus outline. For details, see
-  // https://github.com/twbs/bootstrap/pull/10951.
-  outline: 0;
-
-  // When fading in the modal, animate it to slide down
-  &.fade .modal-dialog {
-    .translate(0, -25%);
-    .transition-transform(~"0.3s ease-out");
-  }
-  &.in .modal-dialog { .translate(0, 0) }
-}
-.modal-open .modal {
-  overflow-x: hidden;
-  overflow-y: auto;
-}
-
-// Shell div to position the modal with bottom padding
-.modal-dialog {
-  position: relative;
-  width: auto;
-  margin: 10px;
-}
-
-// Actual modal
-.modal-content {
-  position: relative;
-  background-color: @modal-content-bg;
-  border: 1px solid @modal-content-fallback-border-color; //old browsers fallback (ie8 etc)
-  border: 1px solid @modal-content-border-color;
-  border-radius: @border-radius-large;
-  .box-shadow(0 3px 9px rgba(0,0,0,.5));
-  background-clip: padding-box;
-  // Remove focus outline from opened modal
-  outline: 0;
-}
-
-// Modal background
-.modal-backdrop {
-  position: fixed;
-  top: 0;
-  right: 0;
-  bottom: 0;
-  left: 0;
-  z-index: @zindex-modal-background;
-  background-color: @modal-backdrop-bg;
-  // Fade for backdrop
-  &.fade { .opacity(0); }
-  &.in { .opacity(@modal-backdrop-opacity); }
-}
-
-// Modal header
-// Top section of the modal w/ title and dismiss
-.modal-header {
-  padding: @modal-title-padding;
-  border-bottom: 1px solid @modal-header-border-color;
-  min-height: (@modal-title-padding + @modal-title-line-height);
-}
-// Close icon
-.modal-header .close {
-  margin-top: -2px;
-}
-
-// Title text within header
-.modal-title {
-  margin: 0;
-  line-height: @modal-title-line-height;
-}
-
-// Modal body
-// Where all modal content resides (sibling of .modal-header and .modal-footer)
-.modal-body {
-  position: relative;
-  padding: @modal-inner-padding;
-}
-
-// Footer (for actions)
-.modal-footer {
-  padding: @modal-inner-padding;
-  text-align: right; // right align buttons
-  border-top: 1px solid @modal-footer-border-color;
-  &:extend(.clearfix all); // clear it in case folks use .pull-* classes on buttons
-
-  // Properly space out buttons
-  .btn + .btn {
-    margin-left: 5px;
-    margin-bottom: 0; // account for input[type="submit"] which gets the bottom margin like all other inputs
-  }
-  // but override that for button groups
-  .btn-group .btn + .btn {
-    margin-left: -1px;
-  }
-  // and override it for block buttons as well
-  .btn-block + .btn-block {
-    margin-left: 0;
-  }
-}
-
-// Measure scrollbar width for padding body during modal show/hide
-.modal-scrollbar-measure {
-  position: absolute;
-  top: -9999px;
-  width: 50px;
-  height: 50px;
-  overflow: scroll;
-}
-
-// Scale up the modal
-@media (min-width: @screen-sm-min) {
-  // Automatically set modal's width for larger viewports
-  .modal-dialog {
-    width: @modal-md;
-    margin: 30px auto;
-  }
-  .modal-content {
-    .box-shadow(0 5px 15px rgba(0,0,0,.5));
-  }
-
-  // Modal sizes
-  .modal-sm { width: @modal-sm; }
-}
-
-@media (min-width: @screen-md-min) {
-  .modal-lg { width: @modal-lg; }
-}
diff --git a/doc/bootstrap/navbar.less b/doc/bootstrap/navbar.less
deleted file mode 100644
index 03f4e2ac..00000000
--- a/doc/bootstrap/navbar.less
+++ /dev/null
@@ -1,660 +0,0 @@
-//
-// Navbars
-// --------------------------------------------------
-
-
-// Wrapper and base class
-//
-// Provide a static navbar from which we expand to create full-width, fixed, and
-// other navbar variations.
-
-.navbar {
-  position: relative;
-  min-height: @navbar-height; // Ensure a navbar always shows (e.g., without a .navbar-brand in collapsed mode)
-  margin-bottom: @navbar-margin-bottom;
-  border: 1px solid transparent;
-
-  // Prevent floats from breaking the navbar
-  &:extend(.clearfix all);
-
-  @media (min-width: @grid-float-breakpoint) {
-    border-radius: @navbar-border-radius;
-  }
-}
-
-
-// Navbar heading
-//
-// Groups `.navbar-brand` and `.navbar-toggle` into a single component for easy
-// styling of responsive aspects.
-
-.navbar-header {
-  &:extend(.clearfix all);
-
-  @media (min-width: @grid-float-breakpoint) {
-    float: left;
-  }
-}
-
-
-// Navbar collapse (body)
-//
-// Group your navbar content into this for easy collapsing and expanding across
-// various device sizes. By default, this content is collapsed when <768px, but
-// will expand past that for a horizontal display.
-//
-// To start (on mobile devices) the navbar links, forms, and buttons are stacked
-// vertically and include a `max-height` to overflow in case you have too much
-// content for the user's viewport.
-
-.navbar-collapse {
-  overflow-x: visible;
-  padding-right: @navbar-padding-horizontal;
-  padding-left:  @navbar-padding-horizontal;
-  border-top: 1px solid transparent;
-  box-shadow: inset 0 1px 0 rgba(255,255,255,.1);
-  &:extend(.clearfix all);
-  -webkit-overflow-scrolling: touch;
-
-  &.in {
-    overflow-y: auto;
-  }
-
-  @media (min-width: @grid-float-breakpoint) {
-    width: auto;
-    border-top: 0;
-    box-shadow: none;
-
-    &.collapse {
-      display: block !important;
-      height: auto !important;
-      padding-bottom: 0; // Override default setting
-      overflow: visible !important;
-    }
-
-    &.in {
-      overflow-y: visible;
-    }
-
-    // Undo the collapse side padding for navbars with containers to ensure
-    // alignment of right-aligned contents.
-    .navbar-fixed-top &,
-    .navbar-static-top &,
-    .navbar-fixed-bottom & {
-      padding-left: 0;
-      padding-right: 0;
-    }
-  }
-}
-
-.navbar-fixed-top,
-.navbar-fixed-bottom {
-  .navbar-collapse {
-    max-height: @navbar-collapse-max-height;
-
-    @media (max-device-width: @screen-xs-min) and (orientation: landscape) {
-      max-height: 200px;
-    }
-  }
-}
-
-
-// Both navbar header and collapse
-//
-// When a container is present, change the behavior of the header and collapse.
-
-.tb-container,
-.container-fluid {
-  > .navbar-header,
-  > .navbar-collapse {
-    margin-right: -@navbar-padding-horizontal;
-    margin-left:  -@navbar-padding-horizontal;
-
-    @media (min-width: @grid-float-breakpoint) {
-      margin-right: 0;
-      margin-left:  0;
-    }
-  }
-}
-
-
-//
-// Navbar alignment options
-//
-// Display the navbar across the entirety of the page or fixed it to the top or
-// bottom of the page.
-
-// Static top (unfixed, but 100% wide) navbar
-.navbar-static-top {
-  z-index: @zindex-navbar;
-  border-width: 0 0 1px;
-
-  @media (min-width: @grid-float-breakpoint) {
-    border-radius: 0;
-  }
-}
-
-// Fix the top/bottom navbars when screen real estate supports it
-.navbar-fixed-top,
-.navbar-fixed-bottom {
-  position: fixed;
-  right: 0;
-  left: 0;
-  z-index: @zindex-navbar-fixed;
-
-  // Undo the rounded corners
-  @media (min-width: @grid-float-breakpoint) {
-    border-radius: 0;
-  }
-}
-.navbar-fixed-top {
-  top: 0;
-  border-width: 0 0 1px;
-}
-.navbar-fixed-bottom {
-  bottom: 0;
-  margin-bottom: 0; // override .navbar defaults
-  border-width: 1px 0 0;
-}
-
-
-// Brand/project name
-
-.navbar-brand {
-  float: left;
-  padding: @navbar-padding-vertical @navbar-padding-horizontal;
-  font-size: @font-size-large;
-  line-height: @line-height-computed;
-  height: @navbar-height;
-
-  &:hover,
-  &:focus {
-    text-decoration: none;
-  }
-
-  > img {
-    display: block;
-  }
-
-  @media (min-width: @grid-float-breakpoint) {
-    .navbar > .tb-container &,
-    .navbar > .container-fluid & {
-      margin-left: -@navbar-padding-horizontal;
-    }
-  }
-}
-
-
-// Navbar toggle
-//
-// Custom button for toggling the `.navbar-collapse`, powered by the collapse
-// JavaScript plugin.
-
-.navbar-toggle {
-  position: relative;
-  float: right;
-  margin-right: @navbar-padding-horizontal;
-  padding: 9px 10px;
-  .navbar-vertical-align(34px);
-  background-color: transparent;
-  background-image: none; // Reset unusual Firefox-on-Android default style; see https://github.com/necolas/normalize.css/issues/214
-  border: 1px solid transparent;
-  border-radius: @border-radius-base;
-
-  // We remove the `outline` here, but later compensate by attaching `:hover`
-  // styles to `:focus`.
-  &:focus {
-    outline: 0;
-  }
-
-  // Bars
-  .icon-bar {
-    display: block;
-    width: 22px;
-    height: 2px;
-    border-radius: 1px;
-  }
-  .icon-bar + .icon-bar {
-    margin-top: 4px;
-  }
-
-  @media (min-width: @grid-float-breakpoint) {
-    display: none;
-  }
-}
-
-
-// Navbar nav links
-//
-// Builds on top of the `.nav` components with its own modifier class to make
-// the nav the full height of the horizontal nav (above 768px).
-
-.navbar-nav {
-  margin: (@navbar-padding-vertical / 2) -@navbar-padding-horizontal;
-
-  > li > a {
-    padding-top:    10px;
-    padding-bottom: 10px;
-    line-height: @line-height-computed;
-  }
-
-  @media (max-width: @grid-float-breakpoint-max) {
-    // Dropdowns get custom display when collapsed
-    .open .dropdown-menu {
-      position: static;
-      float: none;
-      width: auto;
-      margin-top: 0;
-      background-color: transparent;
-      border: 0;
-      box-shadow: none;
-      > li > a,
-      .dropdown-header {
-        padding: 5px 15px 5px 25px;
-      }
-      > li > a {
-        line-height: @line-height-computed;
-        &:hover,
-        &:focus {
-          background-image: none;
-        }
-      }
-    }
-  }
-
-  // Uncollapse the nav
-  @media (min-width: @grid-float-breakpoint) {
-    float: left;
-    margin: 0;
-
-    > li {
-      float: left;
-      > a {
-        padding-top:    @navbar-padding-vertical;
-        padding-bottom: @navbar-padding-vertical;
-      }
-    }
-  }
-}
-
-
-// Navbar form
-//
-// Extension of the `.form-inline` with some extra flavor for optimum display in
-// our navbars.
-
-.navbar-form {
-  margin-left: -@navbar-padding-horizontal;
-  margin-right: -@navbar-padding-horizontal;
-  padding: 10px @navbar-padding-horizontal;
-  border-top: 1px solid transparent;
-  border-bottom: 1px solid transparent;
-  @shadow: inset 0 1px 0 rgba(255,255,255,.1), 0 1px 0 rgba(255,255,255,.1);
-  .box-shadow(@shadow);
-
-  // Mixin behavior for optimum display
-  .form-inline();
-
-  .form-group {
-    @media (max-width: @grid-float-breakpoint-max) {
-      margin-bottom: 5px;
-
-      &:last-child {
-        margin-bottom: 0;
-      }
-    }
-  }
-
-  // Vertically center in expanded, horizontal navbar
-  .navbar-vertical-align(@input-height-base);
-
-  // Undo 100% width for pull classes
-  @media (min-width: @grid-float-breakpoint) {
-    width: auto;
-    border: 0;
-    margin-left: 0;
-    margin-right: 0;
-    padding-top: 0;
-    padding-bottom: 0;
-    .box-shadow(none);
-  }
-}
-
-
-// Dropdown menus
-
-// Menu position and menu carets
-.navbar-nav > li > .dropdown-menu {
-  margin-top: 0;
-  .border-top-radius(0);
-}
-// Menu position and menu caret support for dropups via extra dropup class
-.navbar-fixed-bottom .navbar-nav > li > .dropdown-menu {
-  margin-bottom: 0;
-  .border-top-radius(@navbar-border-radius);
-  .border-bottom-radius(0);
-}
-
-
-// Buttons in navbars
-//
-// Vertically center a button within a navbar (when *not* in a form).
-
-.navbar-btn {
-  .navbar-vertical-align(@input-height-base);
-
-  &.btn-sm {
-    .navbar-vertical-align(@input-height-small);
-  }
-  &.btn-xs {
-    .navbar-vertical-align(22);
-  }
-}
-
-
-// Text in navbars
-//
-// Add a class to make any element properly align itself vertically within the navbars.
-
-.navbar-text {
-  .navbar-vertical-align(@line-height-computed);
-
-  @media (min-width: @grid-float-breakpoint) {
-    float: left;
-    margin-left: @navbar-padding-horizontal;
-    margin-right: @navbar-padding-horizontal;
-  }
-}
-
-
-// Component alignment
-//
-// Repurpose the pull utilities as their own navbar utilities to avoid specificity
-// issues with parents and chaining. Only do this when the navbar is uncollapsed
-// though so that navbar contents properly stack and align in mobile.
-//
-// Declared after the navbar components to ensure more specificity on the margins.
-
-@media (min-width: @grid-float-breakpoint) {
-  .navbar-left  { .pull-left(); }
-  .navbar-right {
-    .pull-right();
-    margin-right: -@navbar-padding-horizontal;
-
-    ~ .navbar-right {
-      margin-right: 0;
-    }
-  }
-}
-
-
-// Alternate navbars
-// --------------------------------------------------
-
-// Default navbar
-.navbar-default {
-  background-color: @navbar-default-bg;
-  border-color: @navbar-default-border;
-
-  .navbar-brand {
-    color: @navbar-default-brand-color;
-    &:hover,
-    &:focus {
-      color: @navbar-default-brand-hover-color;
-      background-color: @navbar-default-brand-hover-bg;
-    }
-  }
-
-  .navbar-text {
-    color: @navbar-default-color;
-  }
-
-  .navbar-nav {
-    > li > a {
-      color: @navbar-default-link-color;
-
-      &:hover,
-      &:focus {
-        color: @navbar-default-link-hover-color;
-        background-color: @navbar-default-link-hover-bg;
-      }
-    }
-    > .active > a {
-      &,
-      &:hover,
-      &:focus {
-        color: @navbar-default-link-active-color;
-        background-color: @navbar-default-link-active-bg;
-      }
-    }
-    > .disabled > a {
-      &,
-      &:hover,
-      &:focus {
-        color: @navbar-default-link-disabled-color;
-        background-color: @navbar-default-link-disabled-bg;
-      }
-    }
-  }
-
-  .navbar-toggle {
-    border-color: @navbar-default-toggle-border-color;
-    &:hover,
-    &:focus {
-      background-color: @navbar-default-toggle-hover-bg;
-    }
-    .icon-bar {
-      background-color: @navbar-default-toggle-icon-bar-bg;
-    }
-  }
-
-  .navbar-collapse,
-  .navbar-form {
-    border-color: @navbar-default-border;
-  }
-
-  // Dropdown menu items
-  .navbar-nav {
-    // Remove background color from open dropdown
-    > .open > a {
-      &,
-      &:hover,
-      &:focus {
-        background-color: @navbar-default-link-active-bg;
-        color: @navbar-default-link-active-color;
-      }
-    }
-
-    @media (max-width: @grid-float-breakpoint-max) {
-      // Dropdowns get custom display when collapsed
-      .open .dropdown-menu {
-        > li > a {
-          color: @navbar-default-link-color;
-          &:hover,
-          &:focus {
-            color: @navbar-default-link-hover-color;
-            background-color: @navbar-default-link-hover-bg;
-          }
-        }
-        > .active > a {
-          &,
-          &:hover,
-          &:focus {
-            color: @navbar-default-link-active-color;
-            background-color: @navbar-default-link-active-bg;
-          }
-        }
-        > .disabled > a {
-          &,
-          &:hover,
-          &:focus {
-            color: @navbar-default-link-disabled-color;
-            background-color: @navbar-default-link-disabled-bg;
-          }
-        }
-      }
-    }
-  }
-
-
-  // Links in navbars
-  //
-  // Add a class to ensure links outside the navbar nav are colored correctly.
-
-  .navbar-link {
-    color: @navbar-default-link-color;
-    &:hover {
-      color: @navbar-default-link-hover-color;
-    }
-  }
-
-  .btn-link {
-    color: @navbar-default-link-color;
-    &:hover,
-    &:focus {
-      color: @navbar-default-link-hover-color;
-    }
-    &[disabled],
-    fieldset[disabled] & {
-      &:hover,
-      &:focus {
-        color: @navbar-default-link-disabled-color;
-      }
-    }
-  }
-}
-
-// Inverse navbar
-
-.navbar-inverse {
-  background-color: @navbar-inverse-bg;
-  border-color: @navbar-inverse-border;
-
-  .navbar-brand {
-    color: @navbar-inverse-brand-color;
-    &:hover,
-    &:focus {
-      color: @navbar-inverse-brand-hover-color;
-      background-color: @navbar-inverse-brand-hover-bg;
-    }
-  }
-
-  .navbar-text {
-    color: @navbar-inverse-color;
-  }
-
-  .navbar-nav {
-    > li > a {
-      color: @navbar-inverse-link-color;
-
-      &:hover,
-      &:focus {
-        color: @navbar-inverse-link-hover-color;
-        background-color: @navbar-inverse-link-hover-bg;
-      }
-    }
-    > .active > a {
-      &,
-      &:hover,
-      &:focus {
-        color: @navbar-inverse-link-active-color;
-        background-color: @navbar-inverse-link-active-bg;
-      }
-    }
-    > .disabled > a {
-      &,
-      &:hover,
-      &:focus {
-        color: @navbar-inverse-link-disabled-color;
-        background-color: @navbar-inverse-link-disabled-bg;
-      }
-    }
-  }
-
-  // Darken the responsive nav toggle
-  .navbar-toggle {
-    border-color: @navbar-inverse-toggle-border-color;
-    &:hover,
-    &:focus {
-      background-color: @navbar-inverse-toggle-hover-bg;
-    }
-    .icon-bar {
-      background-color: @navbar-inverse-toggle-icon-bar-bg;
-    }
-  }
-
-  .navbar-collapse,
-  .navbar-form {
-    border-color: darken(@navbar-inverse-bg, 7%);
-  }
-
-  // Dropdowns
-  .navbar-nav {
-    > .open > a {
-      &,
-      &:hover,
-      &:focus {
-        background-color: @navbar-inverse-link-active-bg;
-        color: @navbar-inverse-link-active-color;
-      }
-    }
-
-    @media (max-width: @grid-float-breakpoint-max) {
-      // Dropdowns get custom display
-      .open .dropdown-menu {
-        > .dropdown-header {
-          border-color: @navbar-inverse-border;
-        }
-        .divider {
-          background-color: @navbar-inverse-border;
-        }
-        > li > a {
-          color: @navbar-inverse-link-color;
-          &:hover,
-          &:focus {
-            color: @navbar-inverse-link-hover-color;
-            background-color: @navbar-inverse-link-hover-bg;
-          }
-        }
-        > .active > a {
-          &,
-          &:hover,
-          &:focus {
-            color: @navbar-inverse-link-active-color;
-            background-color: @navbar-inverse-link-active-bg;
-          }
-        }
-        > .disabled > a {
-          &,
-          &:hover,
-          &:focus {
-            color: @navbar-inverse-link-disabled-color;
-            background-color: @navbar-inverse-link-disabled-bg;
-          }
-        }
-      }
-    }
-  }
-
-  .navbar-link {
-    color: @navbar-inverse-link-color;
-    &:hover {
-      color: @navbar-inverse-link-hover-color;
-    }
-  }
-
-  .btn-link {
-    color: @navbar-inverse-link-color;
-    &:hover,
-    &:focus {
-      color: @navbar-inverse-link-hover-color;
-    }
-    &[disabled],
-    fieldset[disabled] & {
-      &:hover,
-      &:focus {
-        color: @navbar-inverse-link-disabled-color;
-      }
-    }
-  }
-}
diff --git a/doc/bootstrap/navs.less b/doc/bootstrap/navs.less
deleted file mode 100644
index a3d11b13..00000000
--- a/doc/bootstrap/navs.less
+++ /dev/null
@@ -1,242 +0,0 @@
-//
-// Navs
-// --------------------------------------------------
-
-
-// Base class
-// --------------------------------------------------
-
-.nav {
-  margin-bottom: 0;
-  padding-left: 0; // Override default ul/ol
-  list-style: none;
-  &:extend(.clearfix all);
-
-  > li {
-    position: relative;
-    display: block;
-
-    > a {
-      position: relative;
-      display: block;
-      padding: @nav-link-padding;
-      &:hover,
-      &:focus {
-        text-decoration: none;
-        background-color: @nav-link-hover-bg;
-      }
-    }
-
-    // Disabled state sets text to gray and nukes hover/tab effects
-    &.disabled > a {
-      color: @nav-disabled-link-color;
-
-      &:hover,
-      &:focus {
-        color: @nav-disabled-link-hover-color;
-        text-decoration: none;
-        background-color: transparent;
-        cursor: @cursor-disabled;
-      }
-    }
-  }
-
-  // Open dropdowns
-  .open > a {
-    &,
-    &:hover,
-    &:focus {
-      background-color: @nav-link-hover-bg;
-      border-color: @link-color;
-    }
-  }
-
-  // Nav dividers (deprecated with v3.0.1)
-  //
-  // This should have been removed in v3 with the dropping of `.nav-list`, but
-  // we missed it. We don't currently support this anywhere, but in the interest
-  // of maintaining backward compatibility in case you use it, it's deprecated.
-  .nav-divider {
-    .nav-divider();
-  }
-
-  // Prevent IE8 from misplacing imgs
-  //
-  // See https://github.com/h5bp/html5-boilerplate/issues/984#issuecomment-3985989
-  > li > a > img {
-    max-width: none;
-  }
-}
-
-
-// Tabs
-// -------------------------
-
-// Give the tabs something to sit on
-.nav-tabs {
-  border-bottom: 1px solid @nav-tabs-border-color;
-  > li {
-    float: left;
-    // Make the list-items overlay the bottom border
-    margin-bottom: -1px;
-
-    // Actual tabs (as links)
-    > a {
-      margin-right: 2px;
-      line-height: @line-height-base;
-      border: 1px solid transparent;
-      border-radius: @border-radius-base @border-radius-base 0 0;
-      &:hover {
-        border-color: @nav-tabs-link-hover-border-color @nav-tabs-link-hover-border-color @nav-tabs-border-color;
-      }
-    }
-
-    // Active state, and its :hover to override normal :hover
-    &.active > a {
-      &,
-      &:hover,
-      &:focus {
-        color: @nav-tabs-active-link-hover-color;
-        background-color: @nav-tabs-active-link-hover-bg;
-        border: 1px solid @nav-tabs-active-link-hover-border-color;
-        border-bottom-color: transparent;
-        cursor: default;
-      }
-    }
-  }
-  // pulling this in mainly for less shorthand
-  &.nav-justified {
-    .nav-justified();
-    .nav-tabs-justified();
-  }
-}
-
-
-// Pills
-// -------------------------
-.nav-pills {
-  > li {
-    float: left;
-
-    // Links rendered as pills
-    > a {
-      border-radius: @nav-pills-border-radius;
-    }
-    + li {
-      margin-left: 2px;
-    }
-
-    // Active state
-    &.active > a {
-      &,
-      &:hover,
-      &:focus {
-        color: @nav-pills-active-link-hover-color;
-        background-color: @nav-pills-active-link-hover-bg;
-      }
-    }
-  }
-}
-
-
-// Stacked pills
-.nav-stacked {
-  > li {
-    float: none;
-    + li {
-      margin-top: 2px;
-      margin-left: 0; // no need for this gap between nav items
-    }
-  }
-}
-
-
-// Nav variations
-// --------------------------------------------------
-
-// Justified nav links
-// -------------------------
-
-.nav-justified {
-  width: 100%;
-
-  > li {
-    float: none;
-    > a {
-      text-align: center;
-      margin-bottom: 5px;
-    }
-  }
-
-  > .dropdown .dropdown-menu {
-    top: auto;
-    left: auto;
-  }
-
-  @media (min-width: @screen-sm-min) {
-    > li {
-      display: table-cell;
-      width: 1%;
-      > a {
-        margin-bottom: 0;
-      }
-    }
-  }
-}
-
-// Move borders to anchors instead of bottom of list
-//
-// Mixin for adding on top the shared `.nav-justified` styles for our tabs
-.nav-tabs-justified {
-  border-bottom: 0;
-
-  > li > a {
-    // Override margin from .nav-tabs
-    margin-right: 0;
-    border-radius: @border-radius-base;
-  }
-
-  > .active > a,
-  > .active > a:hover,
-  > .active > a:focus {
-    border: 1px solid @nav-tabs-justified-link-border-color;
-  }
-
-  @media (min-width: @screen-sm-min) {
-    > li > a {
-      border-bottom: 1px solid @nav-tabs-justified-link-border-color;
-      border-radius: @border-radius-base @border-radius-base 0 0;
-    }
-    > .active > a,
-    > .active > a:hover,
-    > .active > a:focus {
-      border-bottom-color: @nav-tabs-justified-active-link-border-color;
-    }
-  }
-}
-
-
-// Tabbable tabs
-// -------------------------
-
-// Hide tabbable panes to start, show them when `.active`
-.tab-content {
-  > .tab-pane {
-    display: none;
-  }
-  > .active {
-    display: block;
-  }
-}
-
-
-// Dropdowns
-// -------------------------
-
-// Specific dropdowns
-.nav-tabs .dropdown-menu {
-  // make dropdown border overlap tab border
-  margin-top: -1px;
-  // Remove the top rounded corners here since there is a hard edge above the menu
-  .border-top-radius(0);
-}
diff --git a/doc/bootstrap/normalize.less b/doc/bootstrap/normalize.less
deleted file mode 100644
index 62a085a4..00000000
--- a/doc/bootstrap/normalize.less
+++ /dev/null
@@ -1,427 +0,0 @@
-/*! normalize.css v3.0.2 | MIT License | git.io/normalize */
-
-//
-// 1. Set default font family to sans-serif.
-// 2. Prevent iOS text size adjust after orientation change, without disabling
-//    user zoom.
-//
-
-html {
-  font-family: sans-serif; // 1
-  -ms-text-size-adjust: 100%; // 2
-  -webkit-text-size-adjust: 100%; // 2
-}
-
-//
-// Remove default margin.
-//
-
-body {
-  margin: 0;
-}
-
-// HTML5 display definitions
-// ==========================================================================
-
-//
-// Correct `block` display not defined for any HTML5 element in IE 8/9.
-// Correct `block` display not defined for `details` or `summary` in IE 10/11
-// and Firefox.
-// Correct `block` display not defined for `main` in IE 11.
-//
-
-article,
-aside,
-details,
-figcaption,
-figure,
-footer,
-header,
-hgroup,
-main,
-menu,
-nav,
-section,
-summary {
-  display: block;
-}
-
-//
-// 1. Correct `inline-block` display not defined in IE 8/9.
-// 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.
-//
-
-audio,
-canvas,
-progress,
-video {
-  display: inline-block; // 1
-  vertical-align: baseline; // 2
-}
-
-//
-// Prevent modern browsers from displaying `audio` without controls.
-// Remove excess height in iOS 5 devices.
-//
-
-audio:not([controls]) {
-  display: none;
-  height: 0;
-}
-
-//
-// Address `[hidden]` styling not present in IE 8/9/10.
-// Hide the `template` element in IE 8/9/11, Safari, and Firefox < 22.
-//
-
-[hidden],
-template {
-  display: none;
-}
-
-// Links
-// ==========================================================================
-
-//
-// Remove the gray background color from active links in IE 10.
-//
-
-a {
-  background-color: transparent;
-}
-
-//
-// Improve readability when focused and also mouse hovered in all browsers.
-//
-
-a:active,
-a:hover {
-  outline: 0;
-}
-
-// Text-level semantics
-// ==========================================================================
-
-//
-// Address styling not present in IE 8/9/10/11, Safari, and Chrome.
-//
-
-abbr[title] {
-  border-bottom: 1px dotted;
-}
-
-//
-// Address style set to `bolder` in Firefox 4+, Safari, and Chrome.
-//
-
-b,
-strong {
-  font-weight: bold;
-}
-
-//
-// Address styling not present in Safari and Chrome.
-//
-
-dfn {
-  font-style: italic;
-}
-
-//
-// Address variable `h1` font-size and margin within `section` and `article`
-// contexts in Firefox 4+, Safari, and Chrome.
-//
-
-h1 {
-  font-size: 2em;
-  margin: 0.67em 0;
-}
-
-//
-// Address styling not present in IE 8/9.
-//
-
-mark {
-  background: #ff0;
-  color: #000;
-}
-
-//
-// Address inconsistent and variable font size in all browsers.
-//
-
-small {
-  font-size: 80%;
-}
-
-//
-// Prevent `sub` and `sup` affecting `line-height` in all browsers.
-//
-
-sub,
-sup {
-  font-size: 75%;
-  line-height: 0;
-  position: relative;
-  vertical-align: baseline;
-}
-
-sup {
-  top: -0.5em;
-}
-
-sub {
-  bottom: -0.25em;
-}
-
-// Embedded content
-// ==========================================================================
-
-//
-// Remove border when inside `a` element in IE 8/9/10.
-//
-
-img {
-  border: 0;
-}
-
-//
-// Correct overflow not hidden in IE 9/10/11.
-//
-
-svg:not(:root) {
-  overflow: hidden;
-}
-
-// Grouping content
-// ==========================================================================
-
-//
-// Address margin not present in IE 8/9 and Safari.
-//
-
-figure {
-  margin: 1em 40px;
-}
-
-//
-// Address differences between Firefox and other browsers.
-//
-
-hr {
-  -moz-box-sizing: content-box;
-  box-sizing: content-box;
-  height: 0;
-}
-
-//
-// Contain overflow in all browsers.
-//
-
-pre {
-  overflow: auto;
-}
-
-//
-// Address odd `em`-unit font size rendering in all browsers.
-//
-
-code,
-kbd,
-pre,
-samp {
-  font-family: monospace, monospace;
-  font-size: 1em;
-}
-
-// Forms
-// ==========================================================================
-
-//
-// Known limitation: by default, Chrome and Safari on OS X allow very limited
-// styling of `select`, unless a `border` property is set.
-//
-
-//
-// 1. Correct color not being inherited.
-//    Known issue: affects color of disabled elements.
-// 2. Correct font properties not being inherited.
-// 3. Address margins set differently in Firefox 4+, Safari, and Chrome.
-//
-
-button,
-input,
-optgroup,
-select,
-textarea {
-  color: inherit; // 1
-  font: inherit; // 2
-  margin: 0; // 3
-}
-
-//
-// Address `overflow` set to `hidden` in IE 8/9/10/11.
-//
-
-button {
-  overflow: visible;
-}
-
-//
-// Address inconsistent `text-transform` inheritance for `button` and `select`.
-// All other form control elements do not inherit `text-transform` values.
-// Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.
-// Correct `select` style inheritance in Firefox.
-//
-
-button,
-select {
-  text-transform: none;
-}
-
-//
-// 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
-//    and `video` controls.
-// 2. Correct inability to style clickable `input` types in iOS.
-// 3. Improve usability and consistency of cursor style between image-type
-//    `input` and others.
-//
-
-button,
-html input[type="button"], // 1
-input[type="reset"],
-input[type="submit"] {
-  -webkit-appearance: button; // 2
-  cursor: pointer; // 3
-}
-
-//
-// Re-set default cursor for disabled elements.
-//
-
-button[disabled],
-html input[disabled] {
-  cursor: default;
-}
-
-//
-// Remove inner padding and border in Firefox 4+.
-//
-
-button::-moz-focus-inner,
-input::-moz-focus-inner {
-  border: 0;
-  padding: 0;
-}
-
-//
-// Address Firefox 4+ setting `line-height` on `input` using `!important` in
-// the UA stylesheet.
-//
-
-input {
-  line-height: normal;
-}
-
-//
-// It's recommended that you don't attempt to style these elements.
-// Firefox's implementation doesn't respect box-sizing, padding, or width.
-//
-// 1. Address box sizing set to `content-box` in IE 8/9/10.
-// 2. Remove excess padding in IE 8/9/10.
-//
-
-input[type="checkbox"],
-input[type="radio"] {
-  box-sizing: border-box; // 1
-  padding: 0; // 2
-}
-
-//
-// Fix the cursor style for Chrome's increment/decrement buttons. For certain
-// `font-size` values of the `input`, it causes the cursor style of the
-// decrement button to change from `default` to `text`.
-//
-
-input[type="number"]::-webkit-inner-spin-button,
-input[type="number"]::-webkit-outer-spin-button {
-  height: auto;
-}
-
-//
-// 1. Address `appearance` set to `searchfield` in Safari and Chrome.
-// 2. Address `box-sizing` set to `border-box` in Safari and Chrome
-//    (include `-moz` to future-proof).
-//
-
-input[type="search"] {
-  -webkit-appearance: textfield; // 1
-  -moz-box-sizing: content-box;
-  -webkit-box-sizing: content-box; // 2
-  box-sizing: content-box;
-}
-
-//
-// Remove inner padding and search cancel button in Safari and Chrome on OS X.
-// Safari (but not Chrome) clips the cancel button when the search input has
-// padding (and `textfield` appearance).
-//
-
-input[type="search"]::-webkit-search-cancel-button,
-input[type="search"]::-webkit-search-decoration {
-  -webkit-appearance: none;
-}
-
-//
-// Define consistent border, margin, and padding.
-//
-
-fieldset {
-  border: 1px solid #c0c0c0;
-  margin: 0 2px;
-  padding: 0.35em 0.625em 0.75em;
-}
-
-//
-// 1. Correct `color` not being inherited in IE 8/9/10/11.
-// 2. Remove padding so people aren't caught out if they zero out fieldsets.
-//
-
-legend {
-  border: 0; // 1
-  padding: 0; // 2
-}
-
-//
-// Remove default vertical scrollbar in IE 8/9/10/11.
-//
-
-textarea {
-  overflow: auto;
-}
-
-//
-// Don't inherit the `font-weight` (applied by a rule above).
-// NOTE: the default cannot safely be changed in Chrome and Safari on OS X.
-//
-
-optgroup {
-  font-weight: bold;
-}
-
-// Tables
-// ==========================================================================
-
-//
-// Remove most spacing between table cells.
-//
-
-table {
-  border-collapse: collapse;
-  border-spacing: 0;
-}
-
-td,
-th {
-  padding: 0;
-}
diff --git a/doc/bootstrap/pager.less b/doc/bootstrap/pager.less
deleted file mode 100644
index 41abaaad..00000000
--- a/doc/bootstrap/pager.less
+++ /dev/null
@@ -1,54 +0,0 @@
-//
-// Pager pagination
-// --------------------------------------------------
-
-
-.pager {
-  padding-left: 0;
-  margin: @line-height-computed 0;
-  list-style: none;
-  text-align: center;
-  &:extend(.clearfix all);
-  li {
-    display: inline;
-    > a,
-    > span {
-      display: inline-block;
-      padding: 5px 14px;
-      background-color: @pager-bg;
-      border: 1px solid @pager-border;
-      border-radius: @pager-border-radius;
-    }
-
-    > a:hover,
-    > a:focus {
-      text-decoration: none;
-      background-color: @pager-hover-bg;
-    }
-  }
-
-  .next {
-    > a,
-    > span {
-      float: right;
-    }
-  }
-
-  .previous {
-    > a,
-    > span {
-      float: left;
-    }
-  }
-
-  .disabled {
-    > a,
-    > a:hover,
-    > a:focus,
-    > span {
-      color: @pager-disabled-color;
-      background-color: @pager-bg;
-      cursor: @cursor-disabled;
-    }
-  }
-}
diff --git a/doc/bootstrap/pagination.less b/doc/bootstrap/pagination.less
deleted file mode 100644
index 38c4c3d3..00000000
--- a/doc/bootstrap/pagination.less
+++ /dev/null
@@ -1,88 +0,0 @@
-//
-// Pagination (multiple pages)
-// --------------------------------------------------
-.pagination {
-  display: inline-block;
-  padding-left: 0;
-  margin: @line-height-computed 0;
-  border-radius: @border-radius-base;
-
-  > li {
-    display: inline; // Remove list-style and block-level defaults
-    > a,
-    > span {
-      position: relative;
-      float: left; // Collapse white-space
-      padding: @padding-base-vertical @padding-base-horizontal;
-      line-height: @line-height-base;
-      text-decoration: none;
-      color: @pagination-color;
-      background-color: @pagination-bg;
-      border: 1px solid @pagination-border;
-      margin-left: -1px;
-    }
-    &:first-child {
-      > a,
-      > span {
-        margin-left: 0;
-        .border-left-radius(@border-radius-base);
-      }
-    }
-    &:last-child {
-      > a,
-      > span {
-        .border-right-radius(@border-radius-base);
-      }
-    }
-  }
-
-  > li > a,
-  > li > span {
-    &:hover,
-    &:focus {
-      color: @pagination-hover-color;
-      background-color: @pagination-hover-bg;
-      border-color: @pagination-hover-border;
-    }
-  }
-
-  > .active > a,
-  > .active > span {
-    &,
-    &:hover,
-    &:focus {
-      z-index: 2;
-      color: @pagination-active-color;
-      background-color: @pagination-active-bg;
-      border-color: @pagination-active-border;
-      cursor: default;
-    }
-  }
-
-  > .disabled {
-    > span,
-    > span:hover,
-    > span:focus,
-    > a,
-    > a:hover,
-    > a:focus {
-      color: @pagination-disabled-color;
-      background-color: @pagination-disabled-bg;
-      border-color: @pagination-disabled-border;
-      cursor: @cursor-disabled;
-    }
-  }
-}
-
-// Sizing
-// --------------------------------------------------
-
-// Large
-.pagination-lg {
-  .pagination-size(@padding-large-vertical; @padding-large-horizontal; @font-size-large; @border-radius-large);
-}
-
-// Small
-.pagination-sm {
-  .pagination-size(@padding-small-vertical; @padding-small-horizontal; @font-size-small; @border-radius-small);
-}
diff --git a/doc/bootstrap/panels.less b/doc/bootstrap/panels.less
deleted file mode 100644
index 04eb2b39..00000000
--- a/doc/bootstrap/panels.less
+++ /dev/null
@@ -1,265 +0,0 @@
-//
-// Panels
-// --------------------------------------------------
-
-
-// Base class
-.panel {
-  margin-bottom: @line-height-computed;
-  background-color: @panel-bg;
-  border: 1px solid transparent;
-  border-radius: @panel-border-radius;
-  .box-shadow(0 1px 1px rgba(0,0,0,.05));
-}
-
-// Panel contents
-.panel-body {
-  padding: @panel-body-padding;
-  &:extend(.clearfix all);
-}
-
-// Optional heading
-.panel-heading {
-  padding: @panel-heading-padding;
-  border-bottom: 1px solid transparent;
-  .border-top-radius((@panel-border-radius - 1));
-
-  > .dropdown .dropdown-toggle {
-    color: inherit;
-  }
-}
-
-// Within heading, strip any `h*` tag of its default margins for spacing.
-.panel-title {
-  margin-top: 0;
-  margin-bottom: 0;
-  font-size: ceil((@font-size-base * 1.125));
-  color: inherit;
-
-  > a,
-  > small,
-  > .small,
-  > small > a,
-  > .small > a {
-    color: inherit;
-  }
-}
-
-// Optional footer (stays gray in every modifier class)
-.panel-footer {
-  padding: @panel-footer-padding;
-  background-color: @panel-footer-bg;
-  border-top: 1px solid @panel-inner-border;
-  .border-bottom-radius((@panel-border-radius - 1));
-}
-
-
-// List groups in panels
-//
-// By default, space out list group content from panel headings to account for
-// any kind of custom content between the two.
-
-.panel {
-  > .list-group,
-  > .panel-collapse > .list-group {
-    margin-bottom: 0;
-
-    .list-group-item {
-      border-width: 1px 0;
-      border-radius: 0;
-    }
-
-    // Add border top radius for first one
-    &:first-child {
-      .list-group-item:first-child {
-        border-top: 0;
-        .border-top-radius((@panel-border-radius - 1));
-      }
-    }
-    // Add border bottom radius for last one
-    &:last-child {
-      .list-group-item:last-child {
-        border-bottom: 0;
-        .border-bottom-radius((@panel-border-radius - 1));
-      }
-    }
-  }
-}
-// Collapse space between when there's no additional content.
-.panel-heading + .list-group {
-  .list-group-item:first-child {
-    border-top-width: 0;
-  }
-}
-.list-group + .panel-footer {
-  border-top-width: 0;
-}
-
-// Tables in panels
-//
-// Place a non-bordered `.table` within a panel (not within a `.panel-body`) and
-// watch it go full width.
-
-.panel {
-  > .table,
-  > .table-responsive > .table,
-  > .panel-collapse > .table {
-    margin-bottom: 0;
-
-    caption {
-      padding-left: @panel-body-padding;
-      padding-right: @panel-body-padding;
-    }
-  }
-  // Add border top radius for first one
-  > .table:first-child,
-  > .table-responsive:first-child > .table:first-child {
-    .border-top-radius((@panel-border-radius - 1));
-
-    > thead:first-child,
-    > tbody:first-child {
-      > tr:first-child {
-        border-top-left-radius: (@panel-border-radius - 1);
-        border-top-right-radius: (@panel-border-radius - 1);
-
-        td:first-child,
-        th:first-child {
-          border-top-left-radius: (@panel-border-radius - 1);
-        }
-        td:last-child,
-        th:last-child {
-          border-top-right-radius: (@panel-border-radius - 1);
-        }
-      }
-    }
-  }
-  // Add border bottom radius for last one
-  > .table:last-child,
-  > .table-responsive:last-child > .table:last-child {
-    .border-bottom-radius((@panel-border-radius - 1));
-
-    > tbody:last-child,
-    > tfoot:last-child {
-      > tr:last-child {
-        border-bottom-left-radius: (@panel-border-radius - 1);
-        border-bottom-right-radius: (@panel-border-radius - 1);
-
-        td:first-child,
-        th:first-child {
-          border-bottom-left-radius: (@panel-border-radius - 1);
-        }
-        td:last-child,
-        th:last-child {
-          border-bottom-right-radius: (@panel-border-radius - 1);
-        }
-      }
-    }
-  }
-  > .panel-body + .table,
-  > .panel-body + .table-responsive,
-  > .table + .panel-body,
-  > .table-responsive + .panel-body {
-    border-top: 1px solid @table-border-color;
-  }
-  > .table > tbody:first-child > tr:first-child th,
-  > .table > tbody:first-child > tr:first-child td {
-    border-top: 0;
-  }
-  > .table-bordered,
-  > .table-responsive > .table-bordered {
-    border: 0;
-    > thead,
-    > tbody,
-    > tfoot {
-      > tr {
-        > th:first-child,
-        > td:first-child {
-          border-left: 0;
-        }
-        > th:last-child,
-        > td:last-child {
-          border-right: 0;
-        }
-      }
-    }
-    > thead,
-    > tbody {
-      > tr:first-child {
-        > td,
-        > th {
-          border-bottom: 0;
-        }
-      }
-    }
-    > tbody,
-    > tfoot {
-      > tr:last-child {
-        > td,
-        > th {
-          border-bottom: 0;
-        }
-      }
-    }
-  }
-  > .table-responsive {
-    border: 0;
-    margin-bottom: 0;
-  }
-}
-
-
-// Collapsable panels (aka, accordion)
-//
-// Wrap a series of panels in `.panel-group` to turn them into an accordion with
-// the help of our collapse JavaScript plugin.
-
-.panel-group {
-  margin-bottom: @line-height-computed;
-
-  // Tighten up margin so it's only between panels
-  .panel {
-    margin-bottom: 0;
-    border-radius: @panel-border-radius;
-
-    + .panel {
-      margin-top: 5px;
-    }
-  }
-
-  .panel-heading {
-    border-bottom: 0;
-
-    + .panel-collapse > .panel-body,
-    + .panel-collapse > .list-group {
-      border-top: 1px solid @panel-inner-border;
-    }
-  }
-
-  .panel-footer {
-    border-top: 0;
-    + .panel-collapse .panel-body {
-      border-bottom: 1px solid @panel-inner-border;
-    }
-  }
-}
-
-
-// Contextual variations
-.panel-default {
-  .panel-variant(@panel-default-border; @panel-default-text; @panel-default-heading-bg; @panel-default-border);
-}
-.panel-primary {
-  .panel-variant(@panel-primary-border; @panel-primary-text; @panel-primary-heading-bg; @panel-primary-border);
-}
-.panel-success {
-  .panel-variant(@panel-success-border; @panel-success-text; @panel-success-heading-bg; @panel-success-border);
-}
-.panel-info {
-  .panel-variant(@panel-info-border; @panel-info-text; @panel-info-heading-bg; @panel-info-border);
-}
-.panel-warning {
-  .panel-variant(@panel-warning-border; @panel-warning-text; @panel-warning-heading-bg; @panel-warning-border);
-}
-.panel-danger {
-  .panel-variant(@panel-danger-border; @panel-danger-text; @panel-danger-heading-bg; @panel-danger-border);
-}
diff --git a/doc/bootstrap/popovers.less b/doc/bootstrap/popovers.less
deleted file mode 100644
index 2748eead..00000000
--- a/doc/bootstrap/popovers.less
+++ /dev/null
@@ -1,135 +0,0 @@
-//
-// Popovers
-// --------------------------------------------------
-
-
-.popover {
-  position: absolute;
-  top: 0;
-  left: 0;
-  z-index: @zindex-popover;
-  display: none;
-  max-width: @popover-max-width;
-  padding: 1px;
-  // Reset font and text properties given new insertion method
-  font-family: @font-family-base;
-  font-size: @font-size-base;
-  font-weight: normal;
-  line-height: @line-height-base;
-  text-align: left;
-  background-color: @popover-bg;
-  background-clip: padding-box;
-  border: 1px solid @popover-fallback-border-color;
-  border: 1px solid @popover-border-color;
-  border-radius: @border-radius-large;
-  .box-shadow(0 5px 10px rgba(0,0,0,.2));
-
-  // Overrides for proper insertion
-  white-space: normal;
-
-  // Offset the popover to account for the popover arrow
-  &.top     { margin-top: -@popover-arrow-width; }
-  &.right   { margin-left: @popover-arrow-width; }
-  &.bottom  { margin-top: @popover-arrow-width; }
-  &.left    { margin-left: -@popover-arrow-width; }
-}
-
-.popover-title {
-  margin: 0; // reset heading margin
-  padding: 8px 14px;
-  font-size: @font-size-base;
-  background-color: @popover-title-bg;
-  border-bottom: 1px solid darken(@popover-title-bg, 5%);
-  border-radius: (@border-radius-large - 1) (@border-radius-large - 1) 0 0;
-}
-
-.popover-content {
-  padding: 9px 14px;
-}
-
-// Arrows
-//
-// .arrow is outer, .arrow:after is inner
-
-.popover > .arrow {
-  &,
-  &:after {
-    position: absolute;
-    display: block;
-    width: 0;
-    height: 0;
-    border-color: transparent;
-    border-style: solid;
-  }
-}
-.popover > .arrow {
-  border-width: @popover-arrow-outer-width;
-}
-.popover > .arrow:after {
-  border-width: @popover-arrow-width;
-  content: "";
-}
-
-.popover {
-  &.top > .arrow {
-    left: 50%;
-    margin-left: -@popover-arrow-outer-width;
-    border-bottom-width: 0;
-    border-top-color: @popover-arrow-outer-fallback-color; // IE8 fallback
-    border-top-color: @popover-arrow-outer-color;
-    bottom: -@popover-arrow-outer-width;
-    &:after {
-      content: " ";
-      bottom: 1px;
-      margin-left: -@popover-arrow-width;
-      border-bottom-width: 0;
-      border-top-color: @popover-arrow-color;
-    }
-  }
-  &.right > .arrow {
-    top: 50%;
-    left: -@popover-arrow-outer-width;
-    margin-top: -@popover-arrow-outer-width;
-    border-left-width: 0;
-    border-right-color: @popover-arrow-outer-fallback-color; // IE8 fallback
-    border-right-color: @popover-arrow-outer-color;
-    &:after {
-      content: " ";
-      left: 1px;
-      bottom: -@popover-arrow-width;
-      border-left-width: 0;
-      border-right-color: @popover-arrow-color;
-    }
-  }
-  &.bottom > .arrow {
-    left: 50%;
-    margin-left: -@popover-arrow-outer-width;
-    border-top-width: 0;
-    border-bottom-color: @popover-arrow-outer-fallback-color; // IE8 fallback
-    border-bottom-color: @popover-arrow-outer-color;
-    top: -@popover-arrow-outer-width;
-    &:after {
-      content: " ";
-      top: 1px;
-      margin-left: -@popover-arrow-width;
-      border-top-width: 0;
-      border-bottom-color: @popover-arrow-color;
-    }
-  }
-
-  &.left > .arrow {
-    top: 50%;
-    right: -@popover-arrow-outer-width;
-    margin-top: -@popover-arrow-outer-width;
-    border-right-width: 0;
-    border-left-color: @popover-arrow-outer-fallback-color; // IE8 fallback
-    border-left-color: @popover-arrow-outer-color;
-    &:after {
-      content: " ";
-      right: 1px;
-      border-right-width: 0;
-      border-left-color: @popover-arrow-color;
-      bottom: -@popover-arrow-width;
-    }
-  }
-}
diff --git a/doc/bootstrap/print.less b/doc/bootstrap/print.less
deleted file mode 100644
index 94ca58f1..00000000
--- a/doc/bootstrap/print.less
+++ /dev/null
@@ -1,107 +0,0 @@
-/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */
-
-// ==========================================================================
-// Print styles.
-// Inlined to avoid the additional HTTP request: h5bp.com/r
-// ==========================================================================
-
-@media print {
-    *,
-    *:before,
-    *:after {
-        background: transparent !important;
-        color: #000 !important; // Black prints faster: h5bp.com/s
-        box-shadow: none !important;
-        text-shadow: none !important;
-    }
-
-    a,
-    a:visited {
-        text-decoration: underline;
-    }
-
-    a[href]:after {
-        content: " (" attr(href) ")";
-    }
-
-    abbr[title]:after {
-        content: " (" attr(title) ")";
-    }
-
-    // Don't show links that are fragment identifiers,
-    // or use the `javascript:` pseudo protocol
-    a[href^="#"]:after,
-    a[href^="javascript:"]:after {
-        content: "";
-    }
-
-    pre,
-    blockquote {
-        border: 1px solid #999;
-        page-break-inside: avoid;
-    }
-
-    thead {
-        display: table-header-group; // h5bp.com/t
-    }
-
-    tr,
-    img {
-        page-break-inside: avoid;
-    }
-
-    img {
-        max-width: 100% !important;
-    }
-
-    p,
-    h2,
-    h3 {
-        orphans: 3;
-        widows: 3;
-    }
-
-    h2,
-    h3 {
-        page-break-after: avoid;
-    }
-
-    // Bootstrap specific changes start
-    //
-    // Chrome (OSX) fix for https://github.com/twbs/bootstrap/issues/11245
-    // Once fixed, we can just straight up remove this.
-    select {
-        background: #fff !important;
-    }
-
-    // Bootstrap components
-    .navbar {
-        display: none;
-    }
-    .btn,
-    .dropup > .btn {
-        > .caret {
-            border-top-color: #000 !important;
-        }
-    }
-    .label {
-        border: 1px solid #000;
-    }
-
-    .table {
-        border-collapse: collapse !important;
-
-        td,
-        th {
-            background-color: #fff !important;
-        }
-    }
-    .table-bordered {
-        th,
-        td {
-            border: 1px solid #ddd !important;
-        }
-    }
-
-    // Bootstrap specific changes end
-}
diff --git a/doc/bootstrap/progress-bars.less b/doc/bootstrap/progress-bars.less
deleted file mode 100644
index 8868a1fe..00000000
--- a/doc/bootstrap/progress-bars.less
+++ /dev/null
@@ -1,87 +0,0 @@
-//
-// Progress bars
-// --------------------------------------------------
-
-
-// Bar animations
-// -------------------------
-
-// WebKit
-@-webkit-keyframes progress-bar-stripes {
-  from  { background-position: 40px 0; }
-  to    { background-position: 0 0; }
-}
-
-// Spec and IE10+
-@keyframes progress-bar-stripes {
-  from  { background-position: 40px 0; }
-  to    { background-position: 0 0; }
-}
-
-
-// Bar itself
-// -------------------------
-
-// Outer container
-.progress {
-  overflow: hidden;
-  height: @line-height-computed;
-  margin-bottom: @line-height-computed;
-  background-color: @progress-bg;
-  border-radius: @progress-border-radius;
-  .box-shadow(inset 0 1px 2px rgba(0,0,0,.1));
-}
-
-// Bar of progress
-.progress-bar {
-  float: left;
-  width: 0%;
-  height: 100%;
-  font-size: @font-size-small;
-  line-height: @line-height-computed;
-  color: @progress-bar-color;
-  text-align: center;
-  background-color: @progress-bar-bg;
-  .box-shadow(inset 0 -1px 0 rgba(0,0,0,.15));
-  .transition(width .6s ease);
-}
-
-// Striped bars
-//
-// `.progress-striped .progress-bar` is deprecated as of v3.2.0 in favor of the
-// `.progress-bar-striped` class, which you just add to an existing
-// `.progress-bar`.
-.progress-striped .progress-bar,
-.progress-bar-striped {
-  #gradient > .striped();
-  background-size: 40px 40px;
-}
-
-// Call animation for the active one
-//
-// `.progress.active .progress-bar` is deprecated as of v3.2.0 in favor of the
-// `.progress-bar.active` approach.
-.progress.active .progress-bar,
-.progress-bar.active {
-  .animation(progress-bar-stripes 2s linear infinite);
-}
-
-
-// Variations
-// -------------------------
-
-.progress-bar-success {
-  .progress-bar-variant(@progress-bar-success-bg);
-}
-
-.progress-bar-info {
-  .progress-bar-variant(@progress-bar-info-bg);
-}
-
-.progress-bar-warning {
-  .progress-bar-variant(@progress-bar-warning-bg);
-}
-
-.progress-bar-danger {
-  .progress-bar-variant(@progress-bar-danger-bg);
-}
diff --git a/doc/bootstrap/responsive-embed.less b/doc/bootstrap/responsive-embed.less
deleted file mode 100644
index 080a5118..00000000
--- a/doc/bootstrap/responsive-embed.less
+++ /dev/null
@@ -1,35 +0,0 @@
-// Embeds responsive
-//
-// Credit: Nicolas Gallagher and SUIT CSS.
-
-.embed-responsive {
-  position: relative;
-  display: block;
-  height: 0;
-  padding: 0;
-  overflow: hidden;
-
-  .embed-responsive-item,
-  iframe,
-  embed,
-  object,
-  video {
-    position: absolute;
-    top: 0;
-    left: 0;
-    bottom: 0;
-    height: 100%;
-    width: 100%;
-    border: 0;
-  }
-}
-
-// Modifier class for 16:9 aspect ratio
-.embed-responsive-16by9 {
-  padding-bottom: 56.25%;
-}
-
-// Modifier class for 4:3 aspect ratio
-.embed-responsive-4by3 {
-  padding-bottom: 75%;
-}
diff --git a/doc/bootstrap/responsive-utilities.less b/doc/bootstrap/responsive-utilities.less
deleted file mode 100644
index b1db31d7..00000000
--- a/doc/bootstrap/responsive-utilities.less
+++ /dev/null
@@ -1,194 +0,0 @@
-//
-// Responsive: Utility classes
-// --------------------------------------------------
-
-
-// IE10 in Windows (Phone) 8
-//
-// Support for responsive views via media queries is kind of borked in IE10, for
-// Surface/desktop in split view and for Windows Phone 8. This particular fix
-// must be accompanied by a snippet of JavaScript to sniff the user agent and
-// apply some conditional CSS to *only* the Surface/desktop Windows 8. Look at
-// our Getting Started page for more information on this bug.
-//
-// For more information, see the following:
-//
-// Issue: https://github.com/twbs/bootstrap/issues/10497
-// Docs: http://getbootstrap.com/getting-started/#support-ie10-width
-// Source: http://timkadlec.com/2013/01/windows-phone-8-and-device-width/
-// Source: http://timkadlec.com/2012/10/ie10-snap-mode-and-responsive-design/
-
-@-ms-viewport {
-  width: device-width;
-}
-
-
-// Visibility utilities
-// Note: Deprecated .visible-xs, .visible-sm, .visible-md, and .visible-lg as of v3.2.0
-.visible-xs,
-.visible-sm,
-.visible-md,
-.visible-lg {
-  .responsive-invisibility();
-}
-
-.visible-xs-block,
-.visible-xs-inline,
-.visible-xs-inline-block,
-.visible-sm-block,
-.visible-sm-inline,
-.visible-sm-inline-block,
-.visible-md-block,
-.visible-md-inline,
-.visible-md-inline-block,
-.visible-lg-block,
-.visible-lg-inline,
-.visible-lg-inline-block {
-  display: none !important;
-}
-
-.visible-xs {
-  @media (max-width: @screen-xs-max) {
-    .responsive-visibility();
-  }
-}
-.visible-xs-block {
-  @media (max-width: @screen-xs-max) {
-    display: block !important;
-  }
-}
-.visible-xs-inline {
-  @media (max-width: @screen-xs-max) {
-    display: inline !important;
-  }
-}
-.visible-xs-inline-block {
-  @media (max-width: @screen-xs-max) {
-    display: inline-block !important;
-  }
-}
-
-.visible-sm {
-  @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
-    .responsive-visibility();
-  }
-}
-.visible-sm-block {
-  @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
-    display: block !important;
-  }
-}
-.visible-sm-inline {
-  @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
-    display: inline !important;
-  }
-}
-.visible-sm-inline-block {
-  @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
-    display: inline-block !important;
-  }
-}
-
-.visible-md {
-  @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
-    .responsive-visibility();
-  }
-}
-.visible-md-block {
-  @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
-    display: block !important;
-  }
-}
-.visible-md-inline {
-  @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
-    display: inline !important;
-  }
-}
-.visible-md-inline-block {
-  @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
-    display: inline-block !important;
-  }
-}
-
-.visible-lg {
-  @media (min-width: @screen-lg-min) {
-    .responsive-visibility();
-  }
-}
-.visible-lg-block {
-  @media (min-width: @screen-lg-min) {
-    display: block !important;
-  }
-}
-.visible-lg-inline {
-  @media (min-width: @screen-lg-min) {
-    display: inline !important;
-  }
-}
-.visible-lg-inline-block {
-  @media (min-width: @screen-lg-min) {
-    display: inline-block !important;
-  }
-}
-
-.hidden-xs {
-  @media (max-width: @screen-xs-max) {
-    .responsive-invisibility();
-  }
-}
-.hidden-sm {
-  @media (min-width: @screen-sm-min) and (max-width: @screen-sm-max) {
-    .responsive-invisibility();
-  }
-}
-.hidden-md {
-  @media (min-width: @screen-md-min) and (max-width: @screen-md-max) {
-    .responsive-invisibility();
-  }
-}
-.hidden-lg {
-  @media (min-width: @screen-lg-min) {
-    .responsive-invisibility();
-  }
-}
-
-
-// Print utilities
-//
-// Media queries are placed on the inside to be mixin-friendly.
-
-// Note: Deprecated .visible-print as of v3.2.0
-.visible-print {
-  .responsive-invisibility();
-
-  @media print {
-    .responsive-visibility();
-  }
-}
-.visible-print-block {
-  display: none !important;
-
-  @media print {
-    display: block !important;
-  }
-}
-.visible-print-inline {
-  display: none !important;
-
-  @media print {
-    display: inline !important;
-  }
-}
-.visible-print-inline-block {
-  display: none !important;
-
-  @media print {
-    display: inline-block !important;
-  }
-}
-
-.hidden-print {
-  @media print {
-    .responsive-invisibility();
-  }
-}
diff --git a/doc/bootstrap/scaffolding.less b/doc/bootstrap/scaffolding.less
deleted file mode 100644
index 47b1d5a1..00000000
--- a/doc/bootstrap/scaffolding.less
+++ /dev/null
@@ -1,162 +0,0 @@
-//
-// Scaffolding
-// --------------------------------------------------
-
-
-// Reset the box-sizing
-//
-// Heads up! This reset may cause conflicts with some third-party widgets.
-// For recommendations on resolving such conflicts, see
-// http://getbootstrap.com/getting-started/#third-box-sizing
-* {
-  .box-sizing(border-box);
-}
-*:before,
-*:after {
-  .box-sizing(border-box);
-}
-
-
-// Body reset
-
-html {
-  font-size: 10px;
-  -webkit-tap-highlight-color: rgba(0,0,0,0);
-}
-
-body {
-  font-family: @font-family-base;
-  font-size: @font-size-base;
-  line-height: @line-height-base;
-  color: @text-color;
-  background-color: @body-bg;
-}
-
-// Reset fonts for relevant elements
-input,
-button,
-select,
-textarea {
-  font-family: inherit;
-  font-size: inherit;
-  line-height: inherit;
-}
-
-
-// Links
-
-a {
-  color: @link-color;
-  text-decoration: none;
-
-  &:hover,
-  &:focus {
-    color: @link-hover-color;
-    text-decoration: @link-hover-decoration;
-  }
-
-  &:focus {
-    .tab-focus();
-  }
-}
-
-
-// Figures
-//
-// We reset this here because previously Normalize had no `figure` margins. This
-// ensures we don't break anyone's use of the element.
-
-figure {
-  margin: 0;
-}
-
-
-// Images
-
-img {
-  vertical-align: middle;
-}
-
-// Responsive images (ensure images don't scale beyond their parents)
-.img-responsive {
-  .img-responsive();
-}
-
-// Rounded corners
-.img-rounded {
-  border-radius: @border-radius-large;
-}
-
-// Image thumbnails
-//
-// Heads up! This is mixin-ed into thumbnails.less for `.thumbnail`.
-.img-thumbnail {
-  padding: @thumbnail-padding;
-  line-height: @line-height-base;
-  background-color: @thumbnail-bg;
-  border: 1px solid @thumbnail-border;
-  border-radius: @thumbnail-border-radius;
-  .transition(all .2s ease-in-out);
-
-  // Keep them at most 100% wide
-  .img-responsive(inline-block);
-}
-
-// Perfect circle
-.img-circle {
-  border-radius: 50%; // set radius in percents
-}
-
-
-// Horizontal rules
-
-hr {
-  margin-top:    @line-height-computed;
-  margin-bottom: @line-height-computed;
-  border: 0;
-  border-top: 1px solid @hr-border;
-}
-
-
-// Only display content to screen readers
-//
-// See: http://a11yproject.com/posts/how-to-hide-content/
-
-.sr-only {
-  position: absolute;
-  width: 1px;
-  height: 1px;
-  margin: -1px;
-  padding: 0;
-  overflow: hidden;
-  clip: rect(0,0,0,0);
-  border: 0;
-}
-
-// Use in conjunction with .sr-only to only display content when it's focused.
-// Useful for "Skip to main content" links; see http://www.w3.org/TR/2013/NOTE-WCAG20-TECHS-20130905/G1
-// Credit: HTML5 Boilerplate
-
-.sr-only-focusable {
-  &:active,
-  &:focus {
-    position: static;
-    width: auto;
-    height: auto;
-    margin: 0;
-    overflow: visible;
-    clip: auto;
-  }
-}
-
-
-// iOS "clickable elements" fix for role="button"
-//
-// Fixes "clickability" issue (and more generally, the firing of events such as focus as well)
-// for traditionally non-focusable elements with role="button"
-// see https://developer.mozilla.org/en-US/docs/Web/Events/click#Safari_Mobile
-// Upstream patch for normalize.css submitted: https://github.com/necolas/normalize.css/pull/379 - remove this fix once that is merged
-
-[role="button"] {
-  cursor: pointer;
-}
\ No newline at end of file
diff --git a/doc/bootstrap/tables.less b/doc/bootstrap/tables.less
deleted file mode 100644
index 2242c036..00000000
--- a/doc/bootstrap/tables.less
+++ /dev/null
@@ -1,234 +0,0 @@
-//
-// Tables
-// --------------------------------------------------
-
-
-table {
-  background-color: @table-bg;
-}
-caption {
-  padding-top: @table-cell-padding;
-  padding-bottom: @table-cell-padding;
-  color: @text-muted;
-  text-align: left;
-}
-th {
-  text-align: left;
-}
-
-
-// Baseline styles
-
-.table {
-  width: 100%;
-  max-width: 100%;
-  margin-bottom: @line-height-computed;
-  // Cells
-  > thead,
-  > tbody,
-  > tfoot {
-    > tr {
-      > th,
-      > td {
-        padding: @table-cell-padding;
-        line-height: @line-height-base;
-        vertical-align: top;
-        border-top: 1px solid @table-border-color;
-      }
-    }
-  }
-  // Bottom align for column headings
-  > thead > tr > th {
-    vertical-align: bottom;
-    border-bottom: 2px solid @table-border-color;
-  }
-  // Remove top border from thead by default
-  > caption + thead,
-  > colgroup + thead,
-  > thead:first-child {
-    > tr:first-child {
-      > th,
-      > td {
-        border-top: 0;
-      }
-    }
-  }
-  // Account for multiple tbody instances
-  > tbody + tbody {
-    border-top: 2px solid @table-border-color;
-  }
-
-  // Nesting
-  .table {
-    background-color: @body-bg;
-  }
-}
-
-
-// Condensed table w/ half padding
-
-.table-condensed {
-  > thead,
-  > tbody,
-  > tfoot {
-    > tr {
-      > th,
-      > td {
-        padding: @table-condensed-cell-padding;
-      }
-    }
-  }
-}
-
-
-// Bordered version
-//
-// Add borders all around the table and between all the columns.
-
-.table-bordered {
-  border: 1px solid @table-border-color;
-  > thead,
-  > tbody,
-  > tfoot {
-    > tr {
-      > th,
-      > td {
-        border: 1px solid @table-border-color;
-      }
-    }
-  }
-  > thead > tr {
-    > th,
-    > td {
-      border-bottom-width: 2px;
-    }
-  }
-}
-
-
-// Zebra-striping
-//
-// Default zebra-stripe styles (alternating gray and transparent backgrounds)
-
-.table-striped {
-  > tbody > tr:nth-of-type(odd) {
-    background-color: @table-bg-accent;
-  }
-}
-
-
-// Hover effect
-//
-// Placed here since it has to come after the potential zebra striping
-
-.table-hover {
-  > tbody > tr:hover {
-    background-color: @table-bg-hover;
-  }
-}
-
-
-// Table cell sizing
-//
-// Reset default table behavior
-
-table col[class*="col-"] {
-  position: static; // Prevent border hiding in Firefox and IE9-11 (see https://github.com/twbs/bootstrap/issues/11623)
-  float: none;
-  display: table-column;
-}
-table {
-  td,
-  th {
-    &[class*="col-"] {
-      position: static; // Prevent border hiding in Firefox and IE9-11 (see https://github.com/twbs/bootstrap/issues/11623)
-      float: none;
-      display: table-cell;
-    }
-  }
-}
-
-
-// Table backgrounds
-//
-// Exact selectors below required to override `.table-striped` and prevent
-// inheritance to nested tables.
-
-// Generate the contextual variants
-.table-row-variant(active; @table-bg-active);
-.table-row-variant(success; @state-success-bg);
-.table-row-variant(info; @state-info-bg);
-.table-row-variant(warning; @state-warning-bg);
-.table-row-variant(danger; @state-danger-bg);
-
-
-// Responsive tables
-//
-// Wrap your tables in `.table-responsive` and we'll make them mobile friendly
-// by enabling horizontal scrolling. Only applies <768px. Everything above that
-// will display normally.
-
-.table-responsive {
-  overflow-x: auto;
-  min-height: 0.01%; // Workaround for IE9 bug (see https://github.com/twbs/bootstrap/issues/14837)
-
-  @media screen and (max-width: @screen-xs-max) {
-    width: 100%;
-    margin-bottom: (@line-height-computed * 0.75);
-    overflow-y: hidden;
-    -ms-overflow-style: -ms-autohiding-scrollbar;
-    border: 1px solid @table-border-color;
-
-    // Tighten up spacing
-    > .table {
-      margin-bottom: 0;
-
-      // Ensure the content doesn't wrap
-      > thead,
-      > tbody,
-      > tfoot {
-        > tr {
-          > th,
-          > td {
-            white-space: nowrap;
-          }
-        }
-      }
-    }
-
-    // Special overrides for the bordered tables
-    > .table-bordered {
-      border: 0;
-
-      // Nuke the appropriate borders so that the parent can handle them
-      > thead,
-      > tbody,
-      > tfoot {
-        > tr {
-          > th:first-child,
-          > td:first-child {
-            border-left: 0;
-          }
-          > th:last-child,
-          > td:last-child {
-            border-right: 0;
-          }
-        }
-      }
-
-      // Only nuke the last row's bottom-border in `tbody` and `tfoot` since
-      // chances are there will be only one `tr` in a `thead` and that would
-      // remove the border altogether.
-      > tbody,
-      > tfoot {
-        > tr:last-child {
-          > th,
-          > td {
-            border-bottom: 0;
-          }
-        }
-      }
-
-    }
-  }
-}
diff --git a/doc/bootstrap/theme.less b/doc/bootstrap/theme.less
deleted file mode 100644
index 6f2eb621..00000000
--- a/doc/bootstrap/theme.less
+++ /dev/null
@@ -1,273 +0,0 @@
-
-//
-// Load core variables and mixins
-// --------------------------------------------------
-
-@import "variables.less";
-@import "mixins.less";
-
-
-//
-// Buttons
-// --------------------------------------------------
-
-// Common styles
-.btn-default,
-.btn-primary,
-.btn-success,
-.btn-info,
-.btn-warning,
-.btn-danger {
-  text-shadow: 0 -1px 0 rgba(0,0,0,.2);
-  @shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 1px 1px rgba(0,0,0,.075);
-  .box-shadow(@shadow);
-
-  // Reset the shadow
-  &:active,
-  &.active {
-    .box-shadow(inset 0 3px 5px rgba(0,0,0,.125));
-  }
-
-  .badge {
-    text-shadow: none;
-  }
-}
-
-// Mixin for generating new styles
-.btn-styles(@btn-color: #555) {
-  #gradient > .vertical(@start-color: @btn-color; @end-color: darken(@btn-color, 12%));
-  .reset-filter(); // Disable gradients for IE9 because filter bleeds through rounded corners; see https://github.com/twbs/bootstrap/issues/10620
-  background-repeat: repeat-x;
-  border-color: darken(@btn-color, 14%);
-
-  &:hover,
-  &:focus  {
-    background-color: darken(@btn-color, 12%);
-    background-position: 0 -15px;
-  }
-
-  &:active,
-  &.active {
-    background-color: darken(@btn-color, 12%);
-    border-color: darken(@btn-color, 14%);
-  }
-
-  &.disabled,
-  &:disabled,
-  &[disabled] {
-    background-color: darken(@btn-color, 12%);
-    background-image: none;
-  }
-}
-
-// Common styles
-.btn {
-  // Remove the gradient for the pressed/active state
-  &:active,
-  &.active {
-    background-image: none;
-  }
-}
-
-// Apply the mixin to the buttons
-.btn-default { .btn-styles(@btn-default-bg); text-shadow: 0 1px 0 #fff; border-color: #ccc; }
-.btn-primary { .btn-styles(@btn-primary-bg); }
-.btn-success { .btn-styles(@btn-success-bg); }
-.btn-info    { .btn-styles(@btn-info-bg); }
-.btn-warning { .btn-styles(@btn-warning-bg); }
-.btn-danger  { .btn-styles(@btn-danger-bg); }
-
-
-//
-// Images
-// --------------------------------------------------
-
-.thumbnail,
-.img-thumbnail {
-  .box-shadow(0 1px 2px rgba(0,0,0,.075));
-}
-
-
-//
-// Dropdowns
-// --------------------------------------------------
-
-.dropdown-menu > li > a:hover,
-.dropdown-menu > li > a:focus {
-  #gradient > .vertical(@start-color: @dropdown-link-hover-bg; @end-color: darken(@dropdown-link-hover-bg, 5%));
-  background-color: darken(@dropdown-link-hover-bg, 5%);
-}
-.dropdown-menu > .active > a,
-.dropdown-menu > .active > a:hover,
-.dropdown-menu > .active > a:focus {
-  #gradient > .vertical(@start-color: @dropdown-link-active-bg; @end-color: darken(@dropdown-link-active-bg, 5%));
-  background-color: darken(@dropdown-link-active-bg, 5%);
-}
-
-
-//
-// Navbar
-// --------------------------------------------------
-
-// Default navbar
-.navbar-default {
-  #gradient > .vertical(@start-color: lighten(@navbar-default-bg, 10%); @end-color: @navbar-default-bg);
-  .reset-filter(); // Remove gradient in IE<10 to fix bug where dropdowns don't get triggered
-  border-radius: @navbar-border-radius;
-  @shadow: inset 0 1px 0 rgba(255,255,255,.15), 0 1px 5px rgba(0,0,0,.075);
-  .box-shadow(@shadow);
-
-  .navbar-nav > .open > a,
-  .navbar-nav > .active > a {
-    #gradient > .vertical(@start-color: darken(@navbar-default-link-active-bg, 5%); @end-color: darken(@navbar-default-link-active-bg, 2%));
-    .box-shadow(inset 0 3px 9px rgba(0,0,0,.075));
-  }
-}
-.navbar-brand,
-.navbar-nav > li > a {
-  text-shadow: 0 1px 0 rgba(255,255,255,.25);
-}
-
-// Inverted navbar
-.navbar-inverse {
-  #gradient > .vertical(@start-color: lighten(@navbar-inverse-bg, 10%); @end-color: @navbar-inverse-bg);
-  .reset-filter(); // Remove gradient in IE<10 to fix bug where dropdowns don't get triggered; see https://github.com/twbs/bootstrap/issues/10257
-
-  .navbar-nav > .open > a,
-  .navbar-nav > .active > a {
-    #gradient > .vertical(@start-color: @navbar-inverse-link-active-bg; @end-color: lighten(@navbar-inverse-link-active-bg, 2.5%));
-    .box-shadow(inset 0 3px 9px rgba(0,0,0,.25));
-  }
-
-  .navbar-brand,
-  .navbar-nav > li > a {
-    text-shadow: 0 -1px 0 rgba(0,0,0,.25);
-  }
-}
-
-// Undo rounded corners in static and fixed navbars
-.navbar-static-top,
-.navbar-fixed-top,
-.navbar-fixed-bottom {
-  border-radius: 0;
-}
-
-// Fix active state of dropdown items in collapsed mode
-@media (max-width: @grid-float-breakpoint-max) {
-  .navbar .navbar-nav .open .dropdown-menu > .active > a {
-    &,
-    &:hover,
-    &:focus {
-      color: #fff;
-      #gradient > .vertical(@start-color: @dropdown-link-active-bg; @end-color: darken(@dropdown-link-active-bg, 5%));
-    }
-  }
-}
-
-
-//
-// Alerts
-// --------------------------------------------------
-
-// Common styles
-.alert {
-  text-shadow: 0 1px 0 rgba(255,255,255,.2);
-  @shadow: inset 0 1px 0 rgba(255,255,255,.25), 0 1px 2px rgba(0,0,0,.05);
-  .box-shadow(@shadow);
-}
-
-// Mixin for generating new styles
-.alert-styles(@color) {
-  #gradient > .vertical(@start-color: @color; @end-color: darken(@color, 7.5%));
-  border-color: darken(@color, 15%);
-}
-
-// Apply the mixin to the alerts
-.alert-success    { .alert-styles(@alert-success-bg); }
-.alert-info       { .alert-styles(@alert-info-bg); }
-.alert-warning    { .alert-styles(@alert-warning-bg); }
-.alert-danger     { .alert-styles(@alert-danger-bg); }
-
-
-//
-// Progress bars
-// --------------------------------------------------
-
-// Give the progress background some depth
-.progress {
-  #gradient > .vertical(@start-color: darken(@progress-bg, 4%); @end-color: @progress-bg)
-}
-
-// Mixin for generating new styles
-.progress-bar-styles(@color) {
-  #gradient > .vertical(@start-color: @color; @end-color: darken(@color, 10%));
-}
-
-// Apply the mixin to the progress bars
-.progress-bar            { .progress-bar-styles(@progress-bar-bg); }
-.progress-bar-success    { .progress-bar-styles(@progress-bar-success-bg); }
-.progress-bar-info       { .progress-bar-styles(@progress-bar-info-bg); }
-.progress-bar-warning    { .progress-bar-styles(@progress-bar-warning-bg); }
-.progress-bar-danger     { .progress-bar-styles(@progress-bar-danger-bg); }
-
-// Reset the striped class because our mixins don't do multiple gradients and
-// the above custom styles override the new `.progress-bar-striped` in v3.2.0.
-.progress-bar-striped {
-  #gradient > .striped();
-}
-
-
-//
-// List groups
-// --------------------------------------------------
-
-.list-group {
-  border-radius: @border-radius-base;
-  .box-shadow(0 1px 2px rgba(0,0,0,.075));
-}
-.list-group-item.active,
-.list-group-item.active:hover,
-.list-group-item.active:focus {
-  text-shadow: 0 -1px 0 darken(@list-group-active-bg, 10%);
-  #gradient > .vertical(@start-color: @list-group-active-bg; @end-color: darken(@list-group-active-bg, 7.5%));
-  border-color: darken(@list-group-active-border, 7.5%);
-
-  .badge {
-    text-shadow: none;
-  }
-}
-
-
-//
-// Panels
-// --------------------------------------------------
-
-// Common styles
-.panel {
-  .box-shadow(0 1px 2px rgba(0,0,0,.05));
-}
-
-// Mixin for generating new styles
-.panel-heading-styles(@color) {
-  #gradient > .vertical(@start-color: @color; @end-color: darken(@color, 5%));
-}
-
-// Apply the mixin to the panel headings only
-.panel-default > .panel-heading   { .panel-heading-styles(@panel-default-heading-bg); }
-.panel-primary > .panel-heading   { .panel-heading-styles(@panel-primary-heading-bg); }
-.panel-success > .panel-heading   { .panel-heading-styles(@panel-success-heading-bg); }
-.panel-info > .panel-heading      { .panel-heading-styles(@panel-info-heading-bg); }
-.panel-warning > .panel-heading   { .panel-heading-styles(@panel-warning-heading-bg); }
-.panel-danger > .panel-heading    { .panel-heading-styles(@panel-danger-heading-bg); }
-
-
-//
-// Wells
-// --------------------------------------------------
-
-.well {
-  #gradient > .vertical(@start-color: darken(@well-bg, 5%); @end-color: @well-bg);
-  border-color: darken(@well-bg, 10%);
-  @shadow: inset 0 1px 3px rgba(0,0,0,.05), 0 1px 0 rgba(255,255,255,.1);
-  .box-shadow(@shadow);
-}
diff --git a/doc/bootstrap/thumbnails.less b/doc/bootstrap/thumbnails.less
deleted file mode 100644
index 0713e67d..00000000
--- a/doc/bootstrap/thumbnails.less
+++ /dev/null
@@ -1,36 +0,0 @@
-//
-// Thumbnails
-// --------------------------------------------------
-
-
-// Mixin and adjust the regular image class
-.thumbnail {
-  display: block;
-  padding: @thumbnail-padding;
-  margin-bottom: @line-height-computed;
-  line-height: @line-height-base;
-  background-color: @thumbnail-bg;
-  border: 1px solid @thumbnail-border;
-  border-radius: @thumbnail-border-radius;
-  .transition(border .2s ease-in-out);
-
-  > img,
-  a > img {
-    &:extend(.img-responsive);
-    margin-left: auto;
-    margin-right: auto;
-  }
-
-  // Add a hover state for linked versions only
-  a&:hover,
-  a&:focus,
-  a&.active {
-    border-color: @link-color;
-  }
-
-  // Image captions
-  .caption {
-    padding: @thumbnail-caption-padding;
-    color: @thumbnail-caption-color;
-  }
-}
diff --git a/doc/bootstrap/tooltip.less b/doc/bootstrap/tooltip.less
deleted file mode 100644
index 9d568474..00000000
--- a/doc/bootstrap/tooltip.less
+++ /dev/null
@@ -1,102 +0,0 @@
-//
-// Tooltips
-// --------------------------------------------------
-
-
-// Base class
-.tooltip {
-  position: absolute;
-  z-index: @zindex-tooltip;
-  display: block;
-  // Reset font and text properties given new insertion method
-  font-family: @font-family-base;
-  font-size: @font-size-small;
-  font-weight: normal;
-  line-height: 1.4;
-  .opacity(0);
-
-  &.in     { .opacity(@tooltip-opacity); }
-  &.top    { margin-top:  -3px; padding: @tooltip-arrow-width 0; }
-  &.right  { margin-left:  3px; padding: 0 @tooltip-arrow-width; }
-  &.bottom { margin-top:   3px; padding: @tooltip-arrow-width 0; }
-  &.left   { margin-left: -3px; padding: 0 @tooltip-arrow-width; }
-}
-
-// Wrapper for the tooltip content
-.tooltip-inner {
-  max-width: @tooltip-max-width;
-  padding: 3px 8px;
-  color: @tooltip-color;
-  text-align: center;
-  text-decoration: none;
-  background-color: @tooltip-bg;
-  border-radius: @border-radius-base;
-}
-
-// Arrows
-.tooltip-arrow {
-  position: absolute;
-  width: 0;
-  height: 0;
-  border-color: transparent;
-  border-style: solid;
-}
-// Note: Deprecated .top-left, .top-right, .bottom-left, and .bottom-right as of v3.3.1
-.tooltip {
-  &.top .tooltip-arrow {
-    bottom: 0;
-    left: 50%;
-    margin-left: -@tooltip-arrow-width;
-    border-width: @tooltip-arrow-width @tooltip-arrow-width 0;
-    border-top-color: @tooltip-arrow-color;
-  }
-  &.top-left .tooltip-arrow {
-    bottom: 0;
-    right: @tooltip-arrow-width;
-    margin-bottom: -@tooltip-arrow-width;
-    border-width: @tooltip-arrow-width @tooltip-arrow-width 0;
-    border-top-color: @tooltip-arrow-color;
-  }
-  &.top-right .tooltip-arrow {
-    bottom: 0;
-    left: @tooltip-arrow-width;
-    margin-bottom: -@tooltip-arrow-width;
-    border-width: @tooltip-arrow-width @tooltip-arrow-width 0;
-    border-top-color: @tooltip-arrow-color;
-  }
-  &.right .tooltip-arrow {
-    top: 50%;
-    left: 0;
-    margin-top: -@tooltip-arrow-width;
-    border-width: @tooltip-arrow-width @tooltip-arrow-width @tooltip-arrow-width 0;
-    border-right-color: @tooltip-arrow-color;
-  }
-  &.left .tooltip-arrow {
-    top: 50%;
-    right: 0;
-    margin-top: -@tooltip-arrow-width;
-    border-width: @tooltip-arrow-width 0 @tooltip-arrow-width @tooltip-arrow-width;
-    border-left-color: @tooltip-arrow-color;
-  }
-  &.bottom .tooltip-arrow {
-    top: 0;
-    left: 50%;
-    margin-left: -@tooltip-arrow-width;
-    border-width: 0 @tooltip-arrow-width @tooltip-arrow-width;
-    border-bottom-color: @tooltip-arrow-color;
-  }
-  &.bottom-left .tooltip-arrow {
-    top: 0;
-    right: @tooltip-arrow-width;
-    margin-top: -@tooltip-arrow-width;
-    border-width: 0 @tooltip-arrow-width @tooltip-arrow-width;
-    border-bottom-color: @tooltip-arrow-color;
-  }
-  &.bottom-right .tooltip-arrow {
-    top: 0;
-    left: @tooltip-arrow-width;
-    margin-top: -@tooltip-arrow-width;
-    border-width: 0 @tooltip-arrow-width @tooltip-arrow-width;
-    border-bottom-color: @tooltip-arrow-color;
-  }
-}
diff --git a/doc/bootstrap/type.less b/doc/bootstrap/type.less
deleted file mode 100644
index 68ba6017..00000000
--- a/doc/bootstrap/type.less
+++ /dev/null
@@ -1,302 +0,0 @@
-//
-// Typography
-// --------------------------------------------------
-
-
-// Headings
-// -------------------------
-
-h1, h2, h3, h4, h5, h6,
-.h1, .h2, .h3, .h4, .h5, .h6 {
-  font-family: @headings-font-family;
-  font-weight: @headings-font-weight;
-  line-height: @headings-line-height;
-  color: @headings-color;
-
-  small,
-  .small {
-    font-weight: normal;
-    line-height: 1;
-    color: @headings-small-color;
-  }
-}
-
-h1, .h1,
-h2, .h2,
-h3, .h3 {
-  margin-top: @line-height-computed;
-  margin-bottom: (@line-height-computed / 2);
-
-  small,
-  .small {
-    font-size: 65%;
-  }
-}
-h4, .h4,
-h5, .h5,
-h6, .h6 {
-  margin-top: (@line-height-computed / 2);
-  margin-bottom: (@line-height-computed / 2);
-
-  small,
-  .small {
-    font-size: 75%;
-  }
-}
-
-h1, .h1 { font-size: @font-size-h1; }
-h2, .h2 { font-size: @font-size-h2; }
-h3, .h3 { font-size: @font-size-h3; }
-h4, .h4 { font-size: @font-size-h4; }
-h5, .h5 { font-size: @font-size-h5; }
-h6, .h6 { font-size: @font-size-h6; }
-
-
-// Body text
-// -------------------------
-
-p {
-  margin: 0 0 (@line-height-computed / 2);
-}
-
-.lead {
-  margin-bottom: @line-height-computed;
-  font-size: floor((@font-size-base * 1.15));
-  font-weight: 300;
-  line-height: 1.4;
-
-  @media (min-width: @screen-sm-min) {
-    font-size: (@font-size-base * 1.5);
-  }
-}
-
-
-// Emphasis & misc
-// -------------------------
-
-// Ex: (12px small font / 14px base font) * 100% = about 85%
-small,
-.small {
-  font-size: floor((100% * @font-size-small / @font-size-base));
-}
-
-mark,
-.mark {
-  background-color: @state-warning-bg;
-  padding: .2em;
-}
-
-// Alignment
-.text-left           { text-align: left; }
-.text-right          { text-align: right; }
-.text-center         { text-align: center; }
-.text-justify        { text-align: justify; }
-.text-nowrap         { white-space: nowrap; }
-
-// Transformation
-.text-lowercase      { text-transform: lowercase; }
-.text-uppercase      { text-transform: uppercase; }
-.text-capitalize     { text-transform: capitalize; }
-
-// Contextual colors
-.text-muted {
-  color: @text-muted;
-}
-.text-primary {
-  .text-emphasis-variant(@brand-primary);
-}
-.text-success {
-  .text-emphasis-variant(@state-success-text);
-}
-.text-info {
-  .text-emphasis-variant(@state-info-text);
-}
-.text-warning {
-  .text-emphasis-variant(@state-warning-text);
-}
-.text-danger {
-  .text-emphasis-variant(@state-danger-text);
-}
-
-// Contextual backgrounds
-// For now we'll leave these alongside the text classes until v4 when we can
-// safely shift things around (per SemVer rules).
-.bg-primary {
-  // Given the contrast here, this is the only class to have its color inverted
-  // automatically.
-  color: #fff;
-  .bg-variant(@brand-primary);
-}
-.bg-success {
-  .bg-variant(@state-success-bg);
-}
-.bg-info {
-  .bg-variant(@state-info-bg);
-}
-.bg-warning {
-  .bg-variant(@state-warning-bg);
-}
-.bg-danger {
-  .bg-variant(@state-danger-bg);
-}
-
-
-// Page header
-// -------------------------
-
-.page-header {
-  padding-bottom: ((@line-height-computed / 2) - 1);
-  margin: (@line-height-computed * 2) 0 @line-height-computed;
-  border-bottom: 1px solid @page-header-border-color;
-}
-
-
-// Lists
-// -------------------------
-
-// Unordered and Ordered lists
-ul,
-ol {
-  margin-top: 0;
-  margin-bottom: (@line-height-computed / 2);
-  ul,
-  ol {
-    margin-bottom: 0;
-  }
-}
-
-// List options
-
-// Unstyled keeps list items block level, just removes default browser padding and list-style
-.list-unstyled {
-  padding-left: 0;
-  list-style: none;
-}
-
-// Inline turns list items into inline-block
-.list-inline {
-  .list-unstyled();
-  margin-left: -5px;
-
-  > li {
-    display: inline-block;
-    padding-left: 5px;
-    padding-right: 5px;
-  }
-}
-
-// Description Lists
-dl {
-  margin-top: 0; // Remove browser default
-  margin-bottom: @line-height-computed;
-}
-dt,
-dd {
-  line-height: @line-height-base;
-}
-dt {
-  font-weight: bold;
-}
-dd {
-  margin-left: 0; // Undo browser default
-}
-
-// Horizontal description lists
-//
-// Defaults to being stacked without any of the below styles applied, until the
-// grid breakpoint is reached (default of ~768px).
-
-.dl-horizontal {
-  dd {
-    &:extend(.clearfix all); // Clear the floated `dt` if an empty `dd` is present
-  }
-
-  @media (min-width: @grid-float-breakpoint) {
-    dt {
-      float: left;
-      width: (@dl-horizontal-offset - 20);
-      clear: left;
-      text-align: right;
-      .text-overflow();
-    }
-    dd {
-      margin-left: @dl-horizontal-offset;
-    }
-  }
-}
-
-
-// Misc
-// -------------------------
-
-// Abbreviations and acronyms
-abbr[title],
-// Add data-* attribute to help out our tooltip plugin, per https://github.com/twbs/bootstrap/issues/5257
-abbr[data-original-title] {
-  cursor: help;
-  border-bottom: 1px dotted @abbr-border-color;
-}
-.initialism {
-  font-size: 90%;
-  .text-uppercase();
-}
-
-// Blockquotes
-blockquote {
-  padding: (@line-height-computed / 2) @line-height-computed;
-  margin: 0 0 @line-height-computed;
-  font-size: @blockquote-font-size;
-  border-left: 5px solid @blockquote-border-color;
-
-  p,
-  ul,
-  ol {
-    &:last-child {
-      margin-bottom: 0;
-    }
-  }
-
-  // Note: Deprecated small and .small as of v3.1.0
-  // Context: https://github.com/twbs/bootstrap/issues/11660
-  footer,
-  small,
-  .small {
-    display: block;
-    font-size: 80%; // back to default font-size
-    line-height: @line-height-base;
-    color: @blockquote-small-color;
-
-    &:before {
-      content: '\2014 \00A0'; // em dash, nbsp
-    }
-  }
-}
-
-// Opposite alignment of blockquote
-//
-// Heads up: `blockquote.pull-right` has been deprecated as of v3.1.0.
-.blockquote-reverse,
-blockquote.pull-right {
-  padding-right: 15px;
-  padding-left: 0;
-  border-right: 5px solid @blockquote-border-color;
-  border-left: 0;
-  text-align: right;
-
-  // Account for citation
-  footer,
-  small,
-  .small {
-    &:before { content: ''; }
-    &:after {
-      content: '\00A0 \2014'; // nbsp, em dash
-    }
-  }
-}
-
-// Addresses
-address {
-  margin-bottom: @line-height-computed;
-  font-style: normal;
-  line-height: @line-height-base;
-}
diff --git a/doc/bootstrap/utilities.less b/doc/bootstrap/utilities.less
deleted file mode 100644
index 7a8ca27a..00000000
--- a/doc/bootstrap/utilities.less
+++ /dev/null
@@ -1,55 +0,0 @@
-//
-// Utility classes
-// --------------------------------------------------
-
-
-// Floats
-// -------------------------
-
-.clearfix {
-  .clearfix();
-}
-.center-block {
-  .center-block();
-}
-.pull-right {
-  float: right !important;
-}
-.pull-left {
-  float: left !important;
-}
-
-
-// Toggling content
-// -------------------------
-
-// Note: Deprecated .hide in favor of .hidden or .sr-only (as appropriate) in v3.0.1
-.hide {
-  display: none !important;
-}
-.show {
-  display: block !important;
-}
-.invisible {
-  visibility: hidden;
-}
-.text-hide {
-  .text-hide();
-}
-
-
-// Hide from screenreaders and browsers
-//
-// Credit: HTML5 Boilerplate
-
-.hidden {
-  display: none !important;
-}
-
-
-// For Affix plugin
-// -------------------------
-
-.affix {
-  position: fixed;
-}
diff --git a/doc/bootstrap/variables.less b/doc/bootstrap/variables.less
deleted file mode 100644
index b5fb9d02..00000000
--- a/doc/bootstrap/variables.less
+++ /dev/null
@@ -1,861 +0,0 @@
-//
-// Variables
-// --------------------------------------------------
-
-
-//== Colors
-//
-//## Gray and brand colors for use across Bootstrap.
-
-@gray-base:              #000;
-@gray-darker:            lighten(@gray-base, 13.5%); // #222
-@gray-dark:              lighten(@gray-base, 20%);   // #333
-@gray:                   lighten(@gray-base, 33.5%); // #555
-@gray-light:             lighten(@gray-base, 46.7%); // #777
-@gray-lighter:           lighten(@gray-base, 93.5%); // #eee
-
-@brand-primary:         darken(#428bca, 6.5%); // #337ab7
-@brand-success:         #5cb85c;
-@brand-info:            #5bc0de;
-@brand-warning:         #f0ad4e;
-@brand-danger:          #d9534f;
-
-
-//== Scaffolding
-//
-//## Settings for some of the most global styles.
-
-//** Background color for `<body>`.
-@body-bg:               #fff;
-//** Global text color on `<body>`.
-@text-color:            @gray-dark;
-
-//** Global textual link color.
-@link-color:            @brand-primary;
-//** Link hover color set via `darken()` function.
-@link-hover-color:      darken(@link-color, 15%);
-//** Link hover decoration.
-@link-hover-decoration: underline;
-
-
-//== Typography
-//
-//## Font, line-height, and color for body text, headings, and more.
-
-@font-family-sans-serif:  "Helvetica Neue", Helvetica, Arial, sans-serif;
-@font-family-serif:       Georgia, "Times New Roman", Times, serif;
-//** Default monospace fonts for `<code>`, `<kbd>`, and `<pre>`.
-@font-family-monospace:   Menlo, Monaco, Consolas, "Courier New", monospace;
-@font-family-base:        @font-family-sans-serif;
-
-@font-size-base:          14px;
-@font-size-large:         ceil((@font-size-base * 1.25)); // ~18px
-@font-size-small:         ceil((@font-size-base * 0.85)); // ~12px
-
-@font-size-h1:            floor((@font-size-base * 2.6)); // ~36px
-@font-size-h2:            floor((@font-size-base * 2.15)); // ~30px
-@font-size-h3:            ceil((@font-size-base * 1.7)); // ~24px
-@font-size-h4:            ceil((@font-size-base * 1.25)); // ~18px
-@font-size-h5:            @font-size-base;
-@font-size-h6:            ceil((@font-size-base * 0.85)); // ~12px
-
-//** Unit-less `line-height` for use in components like buttons.
-@line-height-base:        1.428571429; // 20/14
-//** Computed "line-height" (`font-size` * `line-height`) for use with `margin`, `padding`, etc.
-@line-height-computed:    floor((@font-size-base * @line-height-base)); // ~20px
-
-//** By default, this inherits from the `<body>`.
-@headings-font-family:    inherit;
-@headings-font-weight:    500;
-@headings-line-height:    1.1;
-@headings-color:          inherit;
-
-
-//== Iconography
-//
-//## Specify custom location and filename of the included Glyphicons icon font. Useful for those including Bootstrap via Bower.
-
-//** Load fonts from this directory.
-@icon-font-path:          "../fonts/";
-//** File name for all font files.
-@icon-font-name:          "glyphicons-halflings-regular";
-//** Element ID within SVG icon file.
-@icon-font-svg-id:        "glyphicons_halflingsregular";
-
-
-//== Components
-//
-//## Define common padding and border radius sizes and more. Values based on 14px text and 1.428 line-height (~20px to start).
-
-@padding-base-vertical:     6px;
-@padding-base-horizontal:   12px;
-
-@padding-large-vertical:    10px;
-@padding-large-horizontal:  16px;
-
-@padding-small-vertical:    5px;
-@padding-small-horizontal:  10px;
-
-@padding-xs-vertical:       1px;
-@padding-xs-horizontal:     5px;
-
-@line-height-large:         1.3333333; // extra decimals for Win 8.1 Chrome
-@line-height-small:         1.5;
-
-@border-radius-base:        4px;
-@border-radius-large:       6px;
-@border-radius-small:       3px;
-
-//** Global color for active items (e.g., navs or dropdowns).
-@component-active-color:    #fff;
-//** Global background color for active items (e.g., navs or dropdowns).
-@component-active-bg:       @brand-primary;
-
-//** Width of the `border` for generating carets that indicator dropdowns.
-@caret-width-base:          4px;
-//** Carets increase slightly in size for larger components.
-@caret-width-large:         5px;
-
-
-//== Tables
-//
-//## Customizes the `.table` component with basic values, each used across all table variations.
-
-//** Padding for `<th>`s and `<td>`s.
-@table-cell-padding:            8px;
-//** Padding for cells in `.table-condensed`.
-@table-condensed-cell-padding:  5px;
-
-//** Default background color used for all tables.
-@table-bg:                      transparent;
-//** Background color used for `.table-striped`.
-@table-bg-accent:               #f9f9f9;
-//** Background color used for `.table-hover`.
-@table-bg-hover:                #f5f5f5;
-@table-bg-active:               @table-bg-hover;
-
-//** Border color for table and cell borders.
-@table-border-color:            #ddd;
-
-
-//== Buttons
-//
-//## For each of Bootstrap's buttons, define text, background and border color.
-
-@btn-font-weight:                normal;
-
-@btn-default-color:              #333;
-@btn-default-bg:                 #fff;
-@btn-default-border:             #ccc;
-
-@btn-primary-color:              #fff;
-@btn-primary-bg:                 @brand-primary;
-@btn-primary-border:             darken(@btn-primary-bg, 5%);
-
-@btn-success-color:              #fff;
-@btn-success-bg:                 @brand-success;
-@btn-success-border:             darken(@btn-success-bg, 5%);
-
-@btn-info-color:                 #fff;
-@btn-info-bg:                    @brand-info;
-@btn-info-border:                darken(@btn-info-bg, 5%);
-
-@btn-warning-color:              #fff;
-@btn-warning-bg:                 @brand-warning;
-@btn-warning-border:             darken(@btn-warning-bg, 5%);
-
-@btn-danger-color:               #fff;
-@btn-danger-bg:                  @brand-danger;
-@btn-danger-border:              darken(@btn-danger-bg, 5%);
-
-@btn-link-disabled-color:        @gray-light;
-
-
-//== Forms
-//
-//##
-
-//** `<input>` background color
-@input-bg:                       #fff;
-//** `<input disabled>` background color
-@input-bg-disabled:              @gray-lighter;
-
-//** Text color for `<input>`s
-@input-color:                    @gray;
-//** `<input>` border color
-@input-border:                   #ccc;
-
-// TODO: Rename `@input-border-radius` to `@input-border-radius-base` in v4
-//** Default `.form-control` border radius
-// This has no effect on `<select>`s in some browsers, due to the limited stylability of `<select>`s in CSS.
-@input-border-radius:            @border-radius-base;
-//** Large `.form-control` border radius
-@input-border-radius-large:      @border-radius-large;
-//** Small `.form-control` border radius
-@input-border-radius-small:      @border-radius-small;
-
-//** Border color for inputs on focus
-@input-border-focus:             #66afe9;
-
-//** Placeholder text color
-@input-color-placeholder:        #999;
-
-//** Default `.form-control` height
-@input-height-base:              (@line-height-computed + (@padding-base-vertical * 2) + 2);
-//** Large `.form-control` height
-@input-height-large:             (ceil(@font-size-large * @line-height-large) + (@padding-large-vertical * 2) + 2);
-//** Small `.form-control` height
-@input-height-small:             (floor(@font-size-small * @line-height-small) + (@padding-small-vertical * 2) + 2);
-
-//** `.form-group` margin
-@form-group-margin-bottom:       15px;
-
-@legend-color:                   @gray-dark;
-@legend-border-color:            #e5e5e5;
-
-//** Background color for textual input addons
-@input-group-addon-bg:           @gray-lighter;
-//** Border color for textual input addons
-@input-group-addon-border-color: @input-border;
-
-//** Disabled cursor for form controls and buttons.
-@cursor-disabled:                not-allowed;
-
-
-//== Dropdowns
-//
-//## Dropdown menu container and contents.
-
-//** Background for the dropdown menu.
-@dropdown-bg:                    #fff;
-//** Dropdown menu `border-color`.
-@dropdown-border:                rgba(0,0,0,.15);
-//** Dropdown menu `border-color` **for IE8**.
-@dropdown-fallback-border:       #ccc;
-//** Divider color for between dropdown items.
-@dropdown-divider-bg:            #e5e5e5;
-
-//** Dropdown link text color.
-@dropdown-link-color:            @gray-dark;
-//** Hover color for dropdown links.
-@dropdown-link-hover-color:      darken(@gray-dark, 5%);
-//** Hover background for dropdown links.
-@dropdown-link-hover-bg:         #f5f5f5;
-
-//** Active dropdown menu item text color.
-@dropdown-link-active-color:     @component-active-color;
-//** Active dropdown menu item background color.
-@dropdown-link-active-bg:        @component-active-bg;
-
-//** Disabled dropdown menu item background color.
-@dropdown-link-disabled-color:   @gray-light;
-
-//** Text color for headers within dropdown menus.
-@dropdown-header-color:          @gray-light;
-
-//** Deprecated `@dropdown-caret-color` as of v3.1.0
-@dropdown-caret-color:           #000;
-
-
-//-- Z-index master list
-//
-// Warning: Avoid customizing these values. They're used for a bird's eye view
-// of components dependent on the z-axis and are designed to all work together.
-//
-// Note: These variables are not generated into the Customizer.
-
-@zindex-navbar:            1000;
-@zindex-dropdown:          1000;
-@zindex-popover:           1060;
-@zindex-tooltip:           1070;
-@zindex-navbar-fixed:      1030;
-@zindex-modal-background:  1040;
-@zindex-modal:             1050;
-
-
-//== Media queries breakpoints
-//
-//## Define the breakpoints at which your layout will change, adapting to different screen sizes.
-
-// Extra small screen / phone
-//** Deprecated `@screen-xs` as of v3.0.1
-@screen-xs:                  480px;
-//** Deprecated `@screen-xs-min` as of v3.2.0
-@screen-xs-min:              @screen-xs;
-//** Deprecated `@screen-phone` as of v3.0.1
-@screen-phone:               @screen-xs-min;
-
-// Small screen / tablet
-//** Deprecated `@screen-sm` as of v3.0.1
-@screen-sm:                  768px;
-@screen-sm-min:              @screen-sm;
-//** Deprecated `@screen-tablet` as of v3.0.1
-@screen-tablet:              @screen-sm-min;
-
-// Medium screen / desktop
-//** Deprecated `@screen-md` as of v3.0.1
-@screen-md:                  992px;
-@screen-md-min:              @screen-md;
-//** Deprecated `@screen-desktop` as of v3.0.1
-@screen-desktop:             @screen-md-min;
-
-// Large screen / wide desktop
-//** Deprecated `@screen-lg` as of v3.0.1
-@screen-lg:                  1200px;
-@screen-lg-min:              @screen-lg;
-//** Deprecated `@screen-lg-desktop` as of v3.0.1
-@screen-lg-desktop:          @screen-lg-min;
-
-// So media queries don't overlap when required, provide a maximum
-@screen-xs-max:              (@screen-sm-min - 1);
-@screen-sm-max:              (@screen-md-min - 1);
-@screen-md-max:              (@screen-lg-min - 1);
-
-
-//== Grid system
-//
-//## Define your custom responsive grid.
-
-//** Number of columns in the grid.
-@grid-columns:              12;
-//** Padding between columns. Gets divided in half for the left and right.
-@grid-gutter-width:         30px;
-// Navbar collapse
-//** Point at which the navbar becomes uncollapsed.
-@grid-float-breakpoint:     @screen-sm-min;
-//** Point at which the navbar begins collapsing.
-@grid-float-breakpoint-max: (@grid-float-breakpoint - 1);
-
-
-//== Container sizes
-//
-//## Define the maximum width of `.container` for different screen sizes.
-
-// Small screen / tablet
-@container-tablet:             (720px + @grid-gutter-width);
-//** For `@screen-sm-min` and up.
-@container-sm:                 @container-tablet;
-
-// Medium screen / desktop
-@container-desktop:            (940px + @grid-gutter-width);
-//** For `@screen-md-min` and up.
-@container-md:                 @container-desktop;
-
-// Large screen / wide desktop
-@container-large-desktop:      (1140px + @grid-gutter-width);
-//** For `@screen-lg-min` and up.
-@container-lg:                 @container-large-desktop;
-
-
-//== Navbar
-//
-//##
-
-// Basics of a navbar
-@navbar-height:                    50px;
-@navbar-margin-bottom:             @line-height-computed;
-@navbar-border-radius:             @border-radius-base;
-@navbar-padding-horizontal:        floor((@grid-gutter-width / 2));
-@navbar-padding-vertical:          ((@navbar-height - @line-height-computed) / 2);
-@navbar-collapse-max-height:       340px;
-
-@navbar-default-color:             #777;
-@navbar-default-bg:                #f8f8f8;
-@navbar-default-border:            darken(@navbar-default-bg, 6.5%);
-
-// Navbar links
-@navbar-default-link-color:                #777;
-@navbar-default-link-hover-color:          #333;
-@navbar-default-link-hover-bg:             transparent;
-@navbar-default-link-active-color:         #555;
-@navbar-default-link-active-bg:            darken(@navbar-default-bg, 6.5%);
-@navbar-default-link-disabled-color:       #ccc;
-@navbar-default-link-disabled-bg:          transparent;
-
-// Navbar brand label
-@navbar-default-brand-color:               @navbar-default-link-color;
-@navbar-default-brand-hover-color:         darken(@navbar-default-brand-color, 10%);
-@navbar-default-brand-hover-bg:            transparent;
-
-// Navbar toggle
-@navbar-default-toggle-hover-bg:           #ddd;
-@navbar-default-toggle-icon-bar-bg:        #888;
-@navbar-default-toggle-border-color:       #ddd;
-
-
-// Inverted navbar
-// Reset inverted navbar basics
-@navbar-inverse-color:                      lighten(@gray-light, 15%);
-@navbar-inverse-bg:                         #222;
-@navbar-inverse-border:                     darken(@navbar-inverse-bg, 10%);
-
-// Inverted navbar links
-@navbar-inverse-link-color:                 lighten(@gray-light, 15%);
-@navbar-inverse-link-hover-color:           #fff;
-@navbar-inverse-link-hover-bg:              transparent;
-@navbar-inverse-link-active-color:          @navbar-inverse-link-hover-color;
-@navbar-inverse-link-active-bg:             darken(@navbar-inverse-bg, 10%);
-@navbar-inverse-link-disabled-color:        #444;
-@navbar-inverse-link-disabled-bg:           transparent;
-
-// Inverted navbar brand label
-@navbar-inverse-brand-color:                @navbar-inverse-link-color;
-@navbar-inverse-brand-hover-color:          #fff;
-@navbar-inverse-brand-hover-bg:             transparent;
-
-// Inverted navbar toggle
-@navbar-inverse-toggle-hover-bg:            #333;
-@navbar-inverse-toggle-icon-bar-bg:         #fff;
-@navbar-inverse-toggle-border-color:        #333;
-
-
-//== Navs
-//
-//##
-
-//=== Shared nav styles
-@nav-link-padding:                          10px 15px;
-@nav-link-hover-bg:                         @gray-lighter;
-
-@nav-disabled-link-color:                   @gray-light;
-@nav-disabled-link-hover-color:             @gray-light;
-
-//== Tabs
-@nav-tabs-border-color:                     #ddd;
-
-@nav-tabs-link-hover-border-color:          @gray-lighter;
-
-@nav-tabs-active-link-hover-bg:             @body-bg;
-@nav-tabs-active-link-hover-color:          @gray;
-@nav-tabs-active-link-hover-border-color:   #ddd;
-
-@nav-tabs-justified-link-border-color:            #ddd;
-@nav-tabs-justified-active-link-border-color:     @body-bg;
-
-//== Pills
-@nav-pills-border-radius:                   @border-radius-base;
-@nav-pills-active-link-hover-bg:            @component-active-bg;
-@nav-pills-active-link-hover-color:         @component-active-color;
-
-
-//== Pagination
-//
-//##
-
-@pagination-color:                     @link-color;
-@pagination-bg:                        #fff;
-@pagination-border:                    #ddd;
-
-@pagination-hover-color:               @link-hover-color;
-@pagination-hover-bg:                  @gray-lighter;
-@pagination-hover-border:              #ddd;
-
-@pagination-active-color:              #fff;
-@pagination-active-bg:                 @brand-primary;
-@pagination-active-border:             @brand-primary;
-
-@pagination-disabled-color:            @gray-light;
-@pagination-disabled-bg:               #fff;
-@pagination-disabled-border:           #ddd;
-
-
-//== Pager
-//
-//##
-
-@pager-bg:                             @pagination-bg;
-@pager-border:                         @pagination-border;
-@pager-border-radius:                  15px;
-
-@pager-hover-bg:                       @pagination-hover-bg;
-
-@pager-active-bg:                      @pagination-active-bg;
-@pager-active-color:                   @pagination-active-color;
-
-@pager-disabled-color:                 @pagination-disabled-color;
-
-
-//== Jumbotron
-//
-//##
-
-@jumbotron-padding:              30px;
-@jumbotron-color:                inherit;
-@jumbotron-bg:                   @gray-lighter;
-@jumbotron-heading-color:        inherit;
-@jumbotron-font-size:            ceil((@font-size-base * 1.5));
-
-
-//== Form states and alerts
-//
-//## Define colors for form feedback states and, by default, alerts.
-
-@state-success-text:             #3c763d;
-@state-success-bg:               #dff0d8;
-@state-success-border:           darken(spin(@state-success-bg, -10), 5%);
-
-@state-info-text:                #31708f;
-@state-info-bg:                  #d9edf7;
-@state-info-border:              darken(spin(@state-info-bg, -10), 7%);
-
-@state-warning-text:             #8a6d3b;
-@state-warning-bg:               #fcf8e3;
-@state-warning-border:           darken(spin(@state-warning-bg, -10), 5%);
-
-@state-danger-text:              #a94442;
-@state-danger-bg:                #f2dede;
-@state-danger-border:            darken(spin(@state-danger-bg, -10), 5%);
-
-
-//== Tooltips
-//
-//##
-
-//** Tooltip max width
-@tooltip-max-width:           200px;
-//** Tooltip text color
-@tooltip-color:               #fff;
-//** Tooltip background color
-@tooltip-bg:                  #000;
-@tooltip-opacity:             .9;
-
-//** Tooltip arrow width
-@tooltip-arrow-width:         5px;
-//** Tooltip arrow color
-@tooltip-arrow-color:         @tooltip-bg;
-
-
-//== Popovers
-//
-//##
-
-//** Popover body background color
-@popover-bg:                          #fff;
-//** Popover maximum width
-@popover-max-width:                   276px;
-//** Popover border color
-@popover-border-color:                rgba(0,0,0,.2);
-//** Popover fallback border color
-@popover-fallback-border-color:       #ccc;
-
-//** Popover title background color
-@popover-title-bg:                    darken(@popover-bg, 3%);
-
-//** Popover arrow width
-@popover-arrow-width:                 10px;
-//** Popover arrow color
-@popover-arrow-color:                 @popover-bg;
-
-//** Popover outer arrow width
-@popover-arrow-outer-width:           (@popover-arrow-width + 1);
-//** Popover outer arrow color
-@popover-arrow-outer-color:           fadein(@popover-border-color, 5%);
-//** Popover outer arrow fallback color
-@popover-arrow-outer-fallback-color:  darken(@popover-fallback-border-color, 20%);
-
-
-//== Labels
-//
-//##
-
-//** Default label background color
-@label-default-bg:            @gray-light;
-//** Primary label background color
-@label-primary-bg:            @brand-primary;
-//** Success label background color
-@label-success-bg:            @brand-success;
-//** Info label background color
-@label-info-bg:               @brand-info;
-//** Warning label background color
-@label-warning-bg:            @brand-warning;
-//** Danger label background color
-@label-danger-bg:             @brand-danger;
-
-//** Default label text color
-@label-color:                 #fff;
-//** Default text color of a linked label
-@label-link-hover-color:      #fff;
-
-
-//== Modals
-//
-//##
-
-//** Padding applied to the modal body
-@modal-inner-padding:         15px;
-
-//** Padding applied to the modal title
-@modal-title-padding:         15px;
-//** Modal title line-height
-@modal-title-line-height:     @line-height-base;
-
-//** Background color of modal content area
-@modal-content-bg:                             #fff;
-//** Modal content border color
-@modal-content-border-color:                   rgba(0,0,0,.2);
-//** Modal content border color **for IE8**
-@modal-content-fallback-border-color:          #999;
-
-//** Modal backdrop background color
-@modal-backdrop-bg:           #000;
-//** Modal backdrop opacity
-@modal-backdrop-opacity:      .5;
-//** Modal header border color
-@modal-header-border-color:   #e5e5e5;
-//** Modal footer border color
-@modal-footer-border-color:   @modal-header-border-color;
-
-@modal-lg:                    900px;
-@modal-md:                    600px;
-@modal-sm:                    300px;
-
-
-//== Alerts
-//
-//## Define alert colors, border radius, and padding.
-
-@alert-padding:               15px;
-@alert-border-radius:         @border-radius-base;
-@alert-link-font-weight:      bold;
-
-@alert-success-bg:            @state-success-bg;
-@alert-success-text:          @state-success-text;
-@alert-success-border:        @state-success-border;
-
-@alert-info-bg:               @state-info-bg;
-@alert-info-text:             @state-info-text;
-@alert-info-border:           @state-info-border;
-
-@alert-warning-bg:            @state-warning-bg;
-@alert-warning-text:          @state-warning-text;
-@alert-warning-border:        @state-warning-border;
-
-@alert-danger-bg:             @state-danger-bg;
-@alert-danger-text:           @state-danger-text;
-@alert-danger-border:         @state-danger-border;
-
-
-//== Progress bars
-//
-//##
-
-//** Background color of the whole progress component
-@progress-bg:                 #f5f5f5;
-//** Progress bar text color
-@progress-bar-color:          #fff;
-//** Variable for setting rounded corners on progress bar.
-@progress-border-radius:      @border-radius-base;
-
-//** Default progress bar color
-@progress-bar-bg:             @brand-primary;
-//** Success progress bar color
-@progress-bar-success-bg:     @brand-success;
-//** Warning progress bar color
-@progress-bar-warning-bg:     @brand-warning;
-//** Danger progress bar color
-@progress-bar-danger-bg:      @brand-danger;
-//** Info progress bar color
-@progress-bar-info-bg:        @brand-info;
-
-
-//== List group
-//
-//##
-
-//** Background color on `.list-group-item`
-@list-group-bg:                 #fff;
-//** `.list-group-item` border color
-@list-group-border:             #ddd;
-//** List group border radius
-@list-group-border-radius:      @border-radius-base;
-
-//** Background color of single list items on hover
-@list-group-hover-bg:           #f5f5f5;
-//** Text color of active list items
-@list-group-active-color:       @component-active-color;
-//** Background color of active list items
-@list-group-active-bg:          @component-active-bg;
-//** Border color of active list elements
-@list-group-active-border:      @list-group-active-bg;
-//** Text color for content within active list items
-@list-group-active-text-color:  lighten(@list-group-active-bg, 40%);
-
-//** Text color of disabled list items
-@list-group-disabled-color:      @gray-light;
-//** Background color of disabled list items
-@list-group-disabled-bg:         @gray-lighter;
-//** Text color for content within disabled list items
-@list-group-disabled-text-color: @list-group-disabled-color;
-
-@list-group-link-color:         #555;
-@list-group-link-hover-color:   @list-group-link-color;
-@list-group-link-heading-color: #333;
-
-
-//== Panels
-//
-//##
-
-@panel-bg:                    #fff;
-@panel-body-padding:          15px;
-@panel-heading-padding:       10px 15px;
-@panel-footer-padding:        @panel-heading-padding;
-@panel-border-radius:         @border-radius-base;
-
-//** Border color for elements within panels
-@panel-inner-border:          #ddd;
-@panel-footer-bg:             #f5f5f5;
-
-@panel-default-text:          @gray-dark;
-@panel-default-border:        #ddd;
-@panel-default-heading-bg:    #f5f5f5;
-
-@panel-primary-text:          #fff;
-@panel-primary-border:        @brand-primary;
-@panel-primary-heading-bg:    @brand-primary;
-
-@panel-success-text:          @state-success-text;
-@panel-success-border:        @state-success-border;
-@panel-success-heading-bg:    @state-success-bg;
-
-@panel-info-text:             @state-info-text;
-@panel-info-border:           @state-info-border;
-@panel-info-heading-bg:       @state-info-bg;
-
-@panel-warning-text:          @state-warning-text;
-@panel-warning-border:        @state-warning-border;
-@panel-warning-heading-bg:    @state-warning-bg;
-
-@panel-danger-text:           @state-danger-text;
-@panel-danger-border:         @state-danger-border;
-@panel-danger-heading-bg:     @state-danger-bg;
-
-
-//== Thumbnails
-//
-//##
-
-//** Padding around the thumbnail image
-@thumbnail-padding:           4px;
-//** Thumbnail background color
-@thumbnail-bg:                @body-bg;
-//** Thumbnail border color
-@thumbnail-border:            #ddd;
-//** Thumbnail border radius
-@thumbnail-border-radius:     @border-radius-base;
-
-//** Custom text color for thumbnail captions
-@thumbnail-caption-color:     @text-color;
-//** Padding around the thumbnail caption
-@thumbnail-caption-padding:   9px;
-
-
-//== Wells
-//
-//##
-
-@well-bg:                     #f5f5f5;
-@well-border:                 darken(@well-bg, 7%);
-
-
-//== Badges
-//
-//##
-
-@badge-color:                 #fff;
-//** Linked badge text color on hover
-@badge-link-hover-color:      #fff;
-@badge-bg:                    @gray-light;
-
-//** Badge text color in active nav link
-@badge-active-color:          @link-color;
-//** Badge background color in active nav link
-@badge-active-bg:             #fff;
-
-@badge-font-weight:           bold;
-@badge-line-height:           1;
-@badge-border-radius:         10px;
-
-
-//== Breadcrumbs
-//
-//##
-
-@breadcrumb-padding-vertical:   8px;
-@breadcrumb-padding-horizontal: 15px;
-//** Breadcrumb background color
-@breadcrumb-bg:                 #f5f5f5;
-//** Breadcrumb text color
-@breadcrumb-color:              #ccc;
-//** Text color of current page in the breadcrumb
-@breadcrumb-active-color:       @gray-light;
-//** Textual separator for between breadcrumb elements
-@breadcrumb-separator:          "/";
-
-
-//== Carousel
-//
-//##
-
-@carousel-text-shadow:                        0 1px 2px rgba(0,0,0,.6);
-
-@carousel-control-color:                      #fff;
-@carousel-control-width:                      15%;
-@carousel-control-opacity:                    .5;
-@carousel-control-font-size:                  20px;
-
-@carousel-indicator-active-bg:                #fff;
-@carousel-indicator-border-color:             #fff;
-
-@carousel-caption-color:                      #fff;
-
-
-//== Close
-//
-//##
-
-@close-font-weight:           bold;
-@close-color:                 #000;
-@close-text-shadow:           0 1px 0 #fff;
-
-
-//== Code
-//
-//##
-
-@code-color:                  #c7254e;
-@code-bg:                     #f9f2f4;
-
-@kbd-color:                   #fff;
-@kbd-bg:                      #333;
-
-@pre-bg:                      #f5f5f5;
-@pre-color:                   @gray-dark;
-@pre-border-color:            #ccc;
-@pre-scrollable-max-height:   340px;
-
-
-//== Type
-//
-//##
-
-//** Horizontal offset for forms and lists.
-@component-offset-horizontal: 180px;
-//** Text muted color
-@text-muted:                  @gray-light;
-//** Abbreviations and acronyms border color
-@abbr-border-color:           @gray-light;
-//** Headings small color
-@headings-small-color:        @gray-light;
-//** Blockquote small color
-@blockquote-small-color:      @gray-light;
-//** Blockquote font size
-@blockquote-font-size:        (@font-size-base * 1.25);
-//** Blockquote border color
-@blockquote-border-color:     @gray-lighter;
-//** Page header border color
-@page-header-border-color:    @gray-lighter;
-//** Width of horizontal description list titles
-@dl-horizontal-offset:        @component-offset-horizontal;
-//** Horizontal line color.
-@hr-border:                   @gray-lighter;
diff --git a/doc/bootstrap/wells.less b/doc/bootstrap/wells.less
deleted file mode 100644
index 15d072b0..00000000
--- a/doc/bootstrap/wells.less
+++ /dev/null
@@ -1,29 +0,0 @@
-//
-// Wells
-// --------------------------------------------------
-
-
-// Base class
-.well {
-  min-height: 20px;
-  padding: 19px;
-  margin-bottom: 20px;
-  background-color: @well-bg;
-  border: 1px solid @well-border;
-  border-radius: @border-radius-base;
-  .box-shadow(inset 0 1px 1px rgba(0,0,0,.05));
-  blockquote {
-    border-color: #ddd;
-    border-color: rgba(0,0,0,.15);
-  }
-}
-
-// Sizes
-.well-lg {
-  padding: 24px;
-  border-radius: @border-radius-large;
-}
-.well-sm {
-  padding: 9px;
-  border-radius: @border-radius-small;
-}
diff --git a/doc/build.py b/doc/build.py
deleted file mode 100755
index a6ae8f85..00000000
--- a/doc/build.py
+++ /dev/null
@@ -1,126 +0,0 @@
-#!/usr/bin/env python3
-# Build the documentation.
-
-import errno, os, re, sys
-from subprocess import check_call, CalledProcessError, Popen, PIPE, STDOUT
-
-versions = [
-  '1.0.0', '1.1.0', '2.0.0', '3.0.2', '4.0.0', '4.1.0', '5.0.0', '5.1.0',
-  '5.2.0', '5.2.1', '5.3.0', '6.0.0', '6.1.0', '6.1.1', '6.1.2', '6.2.0',
-  '6.2.1', '7.0.0', '7.0.1', '7.0.2', '7.0.3', '7.1.0', '7.1.1', '7.1.2',
-  '7.1.3', '8.0.0', '8.0.1', '8.1.0', '8.1.1', '9.0.0', '9.1.0']
-versions += ['10.0.0', '10.1.0', '10.1.1', '10.1.1', '10.2.0']
-
-class Pip:
-  def __init__(self, venv_dir):
-    self.path = os.path.join(venv_dir, 'bin', 'pip')
-
-  def install(self, package, commit=None):
-    "Install package using pip."
-    if commit:
-      package = 'git+https://github.com/{0}.git@{1}'.format(package, commit)
-    print('Installing {0}'.format(package))
-    check_call([self.path, 'install', package])
-
-def create_build_env(venv_dir='virtualenv'):
-  # Create virtualenv.
-  if not os.path.exists(venv_dir):
-    check_call(['python3', '-m', 'venv', venv_dir])
-  # Install Sphinx and Breathe. Require the exact version of Sphinx which is
-  # compatible with Breathe.
-  pip = Pip(venv_dir)
-  pip.install('wheel')
-  pip.install('six')
-  # See: https://github.com/sphinx-doc/sphinx/issues/9777
-  pip.install('docutils==0.17.1')
-  # Jinja2 >= 3.1 incompatible with sphinx 3.3.0
-  # See: https://github.com/sphinx-doc/sphinx/issues/10291
-  pip.install('Jinja2<3.1')
-  pip.install('sphinx==3.3.0')
-  pip.install('michaeljones/breathe', 'v4.25.0')
-
-def build_docs(version='dev', **kwargs):
-  doc_dir = kwargs.get('doc_dir', os.path.dirname(os.path.realpath(__file__)))
-  work_dir = kwargs.get('work_dir', '.')
-  include_dir = kwargs.get(
-      'include_dir', os.path.join(os.path.dirname(doc_dir), 'include', 'fmt'))
-  # Build docs.
-  cmd = ['doxygen', '-']
-  p = Popen(cmd, stdin=PIPE, stdout=PIPE, stderr=STDOUT)
-  doxyxml_dir = os.path.join(work_dir, 'doxyxml')
-  out, _ = p.communicate(input=r'''
-      PROJECT_NAME      = fmt
-      GENERATE_LATEX    = NO
-      GENERATE_MAN      = NO
-      GENERATE_RTF      = NO
-      CASE_SENSE_NAMES  = NO
-      INPUT             = {0}/args.h {0}/chrono.h {0}/color.h {0}/core.h \
-                          {0}/compile.h {0}/format.h {0}/os.h {0}/ostream.h \
-                          {0}/printf.h {0}/xchar.h
-      QUIET             = YES
-      JAVADOC_AUTOBRIEF = YES
-      AUTOLINK_SUPPORT  = NO
-      GENERATE_HTML     = NO
-      GENERATE_XML      = YES
-      XML_OUTPUT        = {1}
-      ALIASES           = "rst=\verbatim embed:rst"
-      ALIASES          += "endrst=\endverbatim"
-      MACRO_EXPANSION   = YES
-      PREDEFINED        = _WIN32=1 \
-                          __linux__=1 \
-                          FMT_ENABLE_IF(...)= \
-                          FMT_USE_VARIADIC_TEMPLATES=1 \
-                          FMT_USE_RVALUE_REFERENCES=1 \
-                          FMT_USE_USER_DEFINED_LITERALS=1 \
-                          FMT_USE_ALIAS_TEMPLATES=1 \
-                          FMT_USE_NONTYPE_TEMPLATE_ARGS=1 \
-                          FMT_API= \
-                          "FMT_BEGIN_NAMESPACE=namespace fmt {{" \
-                          "FMT_END_NAMESPACE=}}" \
-                          "FMT_STRING_ALIAS=1" \
-                          "FMT_VARIADIC(...)=" \
-                          "FMT_VARIADIC_W(...)=" \
-                          "FMT_DOC=1"
-      EXCLUDE_SYMBOLS   = fmt::formatter fmt::printf_formatter fmt::arg_join \
-                          fmt::basic_format_arg::handle
-    '''.format(include_dir, doxyxml_dir).encode('UTF-8'))
-  out = out.decode('utf-8')
-  internal_symbols = [
-    'fmt::detail::.*',
-    'basic_data<>',
-    'fmt::type_identity'
-  ]
-  noisy_warnings = [
-    'warning: (Compound|Member .* of class) (' + '|'.join(internal_symbols) + \
-      ') is not documented.',
-    'warning: Internal inconsistency: .* does not belong to any container!'
-  ]
-  for w in noisy_warnings:
-      out = re.sub('.*' + w + '\n', '', out)
-  print(out)
-  if p.returncode != 0:
-    raise CalledProcessError(p.returncode, cmd)
-
-  html_dir = os.path.join(work_dir, 'html')
-  main_versions = reversed(versions[-3:])
-  check_call([os.path.join(work_dir, 'virtualenv', 'bin', 'sphinx-build'),
-              '-Dbreathe_projects.format=' + os.path.abspath(doxyxml_dir),
-              '-Dversion=' + version, '-Drelease=' + version,
-              '-Aversion=' + version, '-Aversions=' + ','.join(main_versions),
-              '-b', 'html', doc_dir, html_dir])
-  try:
-    check_call(['lessc', '--verbose', '--clean-css',
-                '--include-path=' + os.path.join(doc_dir, 'bootstrap'),
-                os.path.join(doc_dir, 'fmt.less'),
-                os.path.join(html_dir, '_static', 'fmt.css')])
-  except OSError as e:
-    if e.errno != errno.ENOENT:
-      raise
-    print('lessc not found; make sure that Less (http://lesscss.org/) ' +
-          'is installed')
-    sys.exit(1)
-  return html_dir
-
-if __name__ == '__main__':
-  create_build_env()
-  build_docs(sys.argv[1])
diff --git a/doc/conf.py b/doc/conf.py
deleted file mode 100644
index 0756192b..00000000
--- a/doc/conf.py
+++ /dev/null
@@ -1,256 +0,0 @@
-# -*- coding: utf-8 -*-
-#
-# format documentation build configuration file, created by
-# sphinx-quickstart on Tue Dec 18 06:46:16 2012.
-#
-# This file is execfile()d with the current directory set to its containing dir.
-#
-# Note that not all possible configuration values are present in this
-# autogenerated file.
-#
-# All configuration values have a default; values that are commented out
-# serve to show the default.
-
-import sys, os, re, subprocess
-
-# If extensions (or modules to document with autodoc) are in another directory,
-# add these directories to sys.path here. If the directory is relative to the
-# documentation root, use os.path.abspath to make it absolute, like shown here.
-#sys.path.insert(0, os.path.abspath('.'))
-
-# -- General configuration -----------------------------------------------------
-
-# If your documentation needs a minimal Sphinx version, state it here.
-needs_sphinx = '1.2'
-
-if os.environ.get('READTHEDOCS', None) == 'True':
-  subprocess.call('doxygen')
-
-# Add any Sphinx extension module names here, as strings. They can be extensions
-# coming with Sphinx (named 'sphinx.ext.*') or your custom ones.
-extensions = ['sphinx.ext.ifconfig', 'breathe']
-
-breathe_default_project = "format"
-breathe_domain_by_extension = {"h" : "cpp"}
-
-# Add any paths that contain templates here, relative to this directory.
-templates_path = ['_templates']
-
-# The suffix of source filenames.
-source_suffix = '.rst'
-
-# The encoding of source files.
-#source_encoding = 'utf-8-sig'
-
-# The master toctree document.
-#master_doc = 'contents'
-
-# General information about the project.
-project = u'fmt'
-copyright = u'2012-present, Victor Zverovich'
-
-# The version info for the project you're documenting, acts as replacement for
-# |version| and |release|, also used in various other places throughout the
-# built documents.
-#
-# The short X.Y version.
-
-# Version and release are passed from CMake.
-#version = None
-
-# The full version, including alpha/beta/rc tags.
-#release = version
-
-# The language for content autogenerated by Sphinx. Refer to documentation
-# for a list of supported languages.
-#language = None
-
-# There are two options for replacing |today|: either, you set today to some
-# non-false value, then it is used:
-#today = ''
-# Else, today_fmt is used as the format for a strftime call.
-#today_fmt = '%B %d, %Y'
-
-# List of patterns, relative to source directory, that match files and
-# directories to ignore when looking for source files.
-exclude_patterns = ['virtualenv']
-
-# The reST default role (used for this markup: `text`) to use for all documents.
-default_role = 'cpp:any'
-
-# If true, '()' will be appended to :func: etc. cross-reference text.
-#add_function_parentheses = True
-
-# If true, the current module name will be prepended to all description
-# unit titles (such as .. function::).
-#add_module_names = True
-
-# If true, sectionauthor and moduleauthor directives will be shown in the
-# output. They are ignored by default.
-#show_authors = False
-
-# The name of the Pygments (syntax highlighting) style to use.
-pygments_style = 'sphinx'
-
-highlight_language = 'c++'
-
-primary_domain = 'cpp'
-
-# A list of ignored prefixes for module index sorting.
-#modindex_common_prefix = []
-
-
-# -- Options for HTML output ---------------------------------------------------
-
-# The theme to use for HTML and HTML Help pages.  See the documentation for
-# a list of builtin themes.
-html_theme = 'basic-bootstrap'
-
-# Theme options are theme-specific and customize the look and feel of a theme
-# further.  For a list of options available for each theme, see the
-# documentation.
-#html_theme_options = {}
-
-# Add any paths that contain custom themes here, relative to this directory.
-html_theme_path = ['.']
-
-# The name for this set of Sphinx documents.  If None, it defaults to
-# "<project> v<release> documentation".
-#html_title = None
-
-# A shorter title for the navigation bar.  Default is the same as html_title.
-#html_short_title = None
-
-# The name of an image file (relative to this directory) to place at the top
-# of the sidebar.
-#html_logo = None
-
-# The name of an image file (within the static path) to use as favicon of the
-# docs.  This file should be a Windows icon file (.ico) being 16x16 or 32x32
-# pixels large.
-#html_favicon = None
-
-# Add any paths that contain custom static files (such as style sheets) here,
-# relative to this directory. They are copied after the builtin static files,
-# so a file named "default.css" will overwrite the builtin "default.css".
-html_static_path = ['_static']
-
-# If not '', a 'Last updated on:' timestamp is inserted at every page bottom,
-# using the given strftime format.
-#html_last_updated_fmt = '%b %d, %Y'
-
-# If true, SmartyPants will be used to convert quotes and dashes to
-# typographically correct entities.
-#html_use_smartypants = True
-
-# Custom sidebar templates, maps document names to template names.
-html_sidebars = {
-  '**': ['localtoc.html', 'relations.html', 'sourcelink.html', 'searchbox.html']
-}
-
-# Additional templates that should be rendered to pages, maps page names to
-# template names.
-#html_additional_pages = {}
-
-# If false, no module index is generated.
-#html_domain_indices = True
-
-# If false, no index is generated.
-#html_use_index = True
-
-# If true, the index is split into individual pages for each letter.
-#html_split_index = False
-
-# If true, links to the reST sources are added to the pages.
-#html_show_sourcelink = True
-
-# If true, "Created using Sphinx" is shown in the HTML footer. Default is True.
-#html_show_sphinx = True
-
-# If true, "(C) Copyright ..." is shown in the HTML footer. Default is True.
-#html_show_copyright = True
-
-# If true, an OpenSearch description file will be output, and all pages will
-# contain a <link> tag referring to it.  The value of this option must be the
-# base URL from which the finished HTML is served.
-#html_use_opensearch = ''
-
-# This is the file name suffix for HTML files (e.g. ".xhtml").
-#html_file_suffix = None
-
-# Output file base name for HTML help builder.
-htmlhelp_basename = 'formatdoc'
-
-
-# -- Options for LaTeX output --------------------------------------------------
-
-latex_elements = {
-# The paper size ('letterpaper' or 'a4paper').
-#'papersize': 'letterpaper',
-
-# The font size ('10pt', '11pt' or '12pt').
-#'pointsize': '10pt',
-
-# Additional stuff for the LaTeX preamble.
-#'preamble': '',
-}
-
-# Grouping the document tree into LaTeX files. List of tuples
-# (source start file, target name, title, author, documentclass [howto/manual]).
-latex_documents = [
-  ('index', 'format.tex', u'fmt documentation',
-   u'Victor Zverovich', 'manual'),
-]
-
-# The name of an image file (relative to this directory) to place at the top of
-# the title page.
-#latex_logo = None
-
-# For "manual" documents, if this is true, then toplevel headings are parts,
-# not chapters.
-#latex_use_parts = False
-
-# If true, show page references after internal links.
-#latex_show_pagerefs = False
-
-# If true, show URL addresses after external links.
-#latex_show_urls = False
-
-# Documents to append as an appendix to all manuals.
-#latex_appendices = []
-
-# If false, no module index is generated.
-#latex_domain_indices = True
-
-
-# -- Options for manual page output --------------------------------------------
-
-# One entry per manual page. List of tuples
-# (source start file, name, description, authors, manual section).
-man_pages = [
-    ('index', 'fmt', u'fmt documentation', [u'Victor Zverovich'], 1)
-]
-
-# If true, show URL addresses after external links.
-#man_show_urls = False
-
-
-# -- Options for Texinfo output ------------------------------------------------
-
-# Grouping the document tree into Texinfo files. List of tuples
-# (source start file, target name, title, author,
-#  dir menu entry, description, category)
-texinfo_documents = [
-  ('index', 'fmt', u'fmt documentation',
-   u'Victor Zverovich', 'fmt', 'One line description of project.',
-   'Miscellaneous'),
-]
-
-# Documents to append as an appendix to all manuals.
-#texinfo_appendices = []
-
-# If false, no module index is generated.
-#texinfo_domain_indices = True
-
-# How to display URL addresses: 'footnote', 'no', or 'inline'.
-#texinfo_show_urls = 'footnote'
diff --git a/doc/contents.rst b/doc/contents.rst
deleted file mode 100644
index d38691e4..00000000
--- a/doc/contents.rst
+++ /dev/null
@@ -1,10 +0,0 @@
-########
-Contents
-########
-
-.. toctree::
-   :maxdepth: 2
-
-   usage
-   api
-   syntax
diff --git a/doc/fmt.css b/doc/fmt.css
new file mode 100644
index 00000000..994d6e2e
--- /dev/null
+++ b/doc/fmt.css
@@ -0,0 +1,61 @@
+:root {
+  --md-primary-fg-color: #0050D0;
+}
+
+.md-grid {
+  max-width: 960px;
+}
+
+@media (min-width: 400px) {
+  .md-tabs {
+    display: block;
+  }
+}
+
+.docblock {
+  border-left: .05rem solid var(--md-primary-fg-color);
+}
+
+.docblock-desc {
+  margin-left: 1em;
+}
+
+pre > code.decl {
+  white-space: pre-wrap;
+}
+
+
+code.decl > div {
+  text-indent: -2ch; /* Negative indent to counteract the indent on the first line */
+  padding-left: 2ch; /* Add padding to the left to create an indent */
+}
+
+.features-container {
+  display: flex;
+  flex-wrap: wrap;
+  gap: 20px;
+  justify-content: center; /* Center the items horizontally */
+}
+
+.feature {
+  flex: 1 1 calc(50% - 20px); /* Two columns with space between */
+  max-width: 600px; /* Set the maximum width for the feature boxes */
+  box-sizing: border-box;
+  padding: 10px;
+  overflow: hidden; /* Hide overflow content */
+  text-overflow: ellipsis; /* Handle text overflow */
+  white-space: normal; /* Allow text wrapping */
+}
+
+.feature h2 {
+  margin-top: 0px;
+  font-weight: bold;
+}
+
+@media (max-width: 768px) {
+  .feature {
+      flex: 1 1 100%; /* Stack columns on smaller screens */
+      max-width: 100%; /* Allow full width on smaller screens */
+      white-space: normal; /* Allow text wrapping on smaller screens */
+  }
+}
diff --git a/doc/fmt.js b/doc/fmt.js
new file mode 100644
index 00000000..da7e95b7
--- /dev/null
+++ b/doc/fmt.js
@@ -0,0 +1,4 @@
+document$.subscribe(() => {
+  hljs.highlightAll(),
+  { language: 'c++' }
+})
diff --git a/doc/fmt.less b/doc/fmt.less
deleted file mode 100644
index 3a97b9fd..00000000
--- a/doc/fmt.less
+++ /dev/null
@@ -1,71 +0,0 @@
-@import 'bootstrap.less';
-
-@header-bg: #094d75;
-@icon-font-path: "fonts/";
-
-html {
-  overflow-y: scroll;
-}
-
-.navbar {
-  border-radius: 0;
-  margin-bottom: 0;
-  background-color: darken(@header-bg, 10%);
-}
-
-.jumbotron {
-  #gradient > .vertical(@header-bg; darken(@header-bg, 2%); 50%; 50%);
-  background-size: 100% 4px;
-  background-color: @header-bg;
-  background-repeat: repeat-y;
-  color: white;
-  text-align: center;
-}
-
-div.sphinxsidebar {
-  margin-left: 0;
-}
-
-// Keep content not too wide for better readability.
-.navbar-content, .content {
-  .make-md-column-offset(1);
-  .make-md-column(10);
-  .make-lg-column-offset(2);
-  .make-lg-column(8);
-}
-
-.footer {
-  padding-top: 20px;
-  padding-bottom: 20px;
-  border-top: 1px solid @gray-lighter;
-  text-align: center;
-}
-
-// Indent descriptions of classes, functions and macros.
-.class dd, .function dd, .macro dd {
-  margin-left: 20px;
-}
-
-// Remove Bootstrap padding for Sphinx containers.
-.breathe-sectiondef.container {
-  padding: 0;
-}
-
-// Remove Bootstrap padding for Sphinx code elements in API signatures.
-.descclassname, .descname {
-  padding: 0;
-}
-
-// Override center alignment in tables.
-td {
-  text-align: left;
-}
-
-p.rubric {
-  margin-top: 10px;
-}
-
-.github-btn {
-  border: 0;
-  overflow: hidden;
-}
diff --git a/doc/get-started.md b/doc/get-started.md
new file mode 100644
index 00000000..e61da882
--- /dev/null
+++ b/doc/get-started.md
@@ -0,0 +1,222 @@
+# Get Started
+
+Compile and run {fmt} examples online with [Compiler Explorer](
+https://godbolt.org/z/P7h6cd6o3).
+
+{fmt} is compatible with any build system. The next section describes its usage
+with CMake, while the [Build Systems](#build-systems) section covers the rest.
+
+## CMake
+
+{fmt} provides two CMake targets: `fmt::fmt` for the compiled library and
+`fmt::fmt-header-only` for the header-only library. It is recommended to use
+the compiled library for improved build times.
+
+There are three primary ways to use {fmt} with CMake:
+
+* **FetchContent**: Starting from CMake 3.11, you can use [`FetchContent`](
+  https://cmake.org/cmake/help/v3.30/module/FetchContent.html) to automatically
+  download {fmt} as a dependency at configure time:
+
+        include(FetchContent)
+
+        FetchContent_Declare(
+          fmt
+          GIT_REPOSITORY https://github.com/fmtlib/fmt
+          GIT_TAG        e69e5f977d458f2650bb346dadf2ad30c5320281) # 10.2.1
+        FetchContent_MakeAvailable(fmt)
+
+        target_link_libraries(<your-target> fmt::fmt)
+
+* **Installed**: You can find and use an [installed](#installation) version of
+  {fmt} in your `CMakeLists.txt` file as follows:
+
+        find_package(fmt)
+        target_link_libraries(<your-target> fmt::fmt)
+
+* **Embedded**: You can add the {fmt} source tree to your project and include it
+  in your `CMakeLists.txt` file:
+
+        add_subdirectory(fmt)
+        target_link_libraries(<your-target> fmt::fmt)
+
+## Installation
+
+### Debian/Ubuntu
+
+To install {fmt} on Debian, Ubuntu, or any other Debian-based Linux
+distribution, use the following command:
+
+    apt install libfmt-dev
+
+### Homebrew
+
+Install {fmt} on macOS using [Homebrew](https://brew.sh/):
+
+    brew install fmt
+
+### Conda
+
+Install {fmt} on Linux, macOS, and Windows with [Conda](
+https://docs.conda.io/en/latest/), using its [conda-forge package](
+https://github.com/conda-forge/fmt-feedstock):
+
+    conda install -c conda-forge fmt
+
+### vcpkg
+
+Download and install {fmt} using the vcpkg package manager:
+
+    git clone https://github.com/Microsoft/vcpkg.git
+    cd vcpkg
+    ./bootstrap-vcpkg.sh
+    ./vcpkg integrate install
+    ./vcpkg install fmt
+
+<!-- The fmt package in vcpkg is kept up to date by Microsoft team members and
+community contributors. If the version is out of date, please [create an
+issue or pull request](https://github.com/Microsoft/vcpkg) on the vcpkg
+repository. -->
+
+## Building from Source
+
+CMake works by generating native makefiles or project files that can be
+used in the compiler environment of your choice. The typical workflow
+starts with:
+
+    mkdir build  # Create a directory to hold the build output.
+    cd build
+    cmake ..     # Generate native build scripts.
+
+run in the `fmt` repository.
+
+If you are on a Unix-like system, you should now see a Makefile in the
+current directory. Now you can build the library by running `make`.
+
+Once the library has been built you can invoke `make test` to run the tests.
+
+You can control generation of the make `test` target with the `FMT_TEST`
+CMake option. This can be useful if you include fmt as a subdirectory in
+your project but don't want to add fmt's tests to your `test` target.
+
+To build a shared library set the `BUILD_SHARED_LIBS` CMake variable to `TRUE`:
+
+    cmake -DBUILD_SHARED_LIBS=TRUE ..
+
+To build a static library with position-independent code (e.g. for
+linking it into another shared library such as a Python extension), set the
+`CMAKE_POSITION_INDEPENDENT_CODE` CMake variable to `TRUE`:
+
+    cmake -DCMAKE_POSITION_INDEPENDENT_CODE=TRUE ..
+
+After building the library you can install it on a Unix-like system by
+running `sudo make install`.
+
+### Building the Docs
+
+To build the documentation you need the following software installed on
+your system:
+
+- [Python](https://www.python.org/)
+- [Doxygen](http://www.stack.nl/~dimitri/doxygen/)
+- [MkDocs](https://www.mkdocs.org/) with `mkdocs-material`, `mkdocstrings`,
+  `pymdown-extensions` and `mike`
+
+First generate makefiles or project files using CMake as described in
+the previous section. Then compile the `doc` target/project, for example:
+
+    make doc
+
+This will generate the HTML documentation in `doc/html`.
+
+## Build Systems
+
+### build2
+
+You can use [build2](https://build2.org), a dependency manager and a build
+system, to use {fmt}.
+
+Currently this package is available in these package repositories:
+
+- <https://cppget.org/fmt/> for released and published versions.
+- <https://github.com/build2-packaging/fmt> for unreleased or custom versions.
+
+**Usage:**
+
+- `build2` package name: `fmt`
+- Library target name: `lib{fmt}`
+
+To make your `build2` project depend on `fmt`:
+
+- Add one of the repositories to your configurations, or in your
+  `repositories.manifest`, if not already there:
+
+        :
+        role: prerequisite
+        location: https://pkg.cppget.org/1/stable
+
+- Add this package as a dependency to your `manifest` file (example
+  for version 10):
+
+        depends: fmt ~10.0.0
+
+- Import the target and use it as a prerequisite to your own target
+  using `fmt` in the appropriate `buildfile`:
+
+        import fmt = fmt%lib{fmt}
+        lib{mylib} : cxx{**} ... $fmt
+
+Then build your project as usual with `b` or `bdep update`.
+
+### Meson
+
+[Meson WrapDB](https://mesonbuild.com/Wrapdb-projects.html) includes an `fmt`
+package.
+
+**Usage:**
+
+- Install the `fmt` subproject from the WrapDB by running:
+
+        meson wrap install fmt
+
+  from the root of your project.
+
+- In your project's `meson.build` file, add an entry for the new subproject:
+
+        fmt = subproject('fmt')
+        fmt_dep = fmt.get_variable('fmt_dep')
+
+- Include the new dependency object to link with fmt:
+
+        my_build_target = executable(
+          'name', 'src/main.cc', dependencies: [fmt_dep])
+
+**Options:**
+
+If desired, {fmt} can be built as a static library, or as a header-only library.
+
+For a static build, use the following subproject definition:
+
+    fmt = subproject('fmt', default_options: 'default_library=static')
+    fmt_dep = fmt.get_variable('fmt_dep')
+
+For the header-only version, use:
+
+    fmt = subproject('fmt')
+    fmt_dep = fmt.get_variable('fmt_header_only_dep')
+
+### Android NDK
+
+{fmt} provides [Android.mk file](
+https://github.com/fmtlib/fmt/blob/master/support/Android.mk) that can be used
+to build the library with [Android NDK](
+https://developer.android.com/tools/sdk/ndk/index.html).
+
+### Other
+
+To use the {fmt} library with any other build system, add
+`include/fmt/base.h`, `include/fmt/format.h`, `include/fmt/format-inl.h`,
+`src/format.cc` and optionally other headers from a [release archive](
+https://github.com/fmtlib/fmt/releases) or the [git repository](
+https://github.com/fmtlib/fmt) to your project, add `include` to include
+directories and make sure `src/format.cc` is compiled and linked with your code.
diff --git a/doc/index.md b/doc/index.md
new file mode 100644
index 00000000..b170f9f2
--- /dev/null
+++ b/doc/index.md
@@ -0,0 +1,151 @@
+---
+hide:
+  - navigation
+  - toc
+---
+
+# A modern formatting library
+
+<div class="features-container">
+
+<div class="feature">
+<h2>Safety</h2>
+<p>
+  Inspired by Python's formatting facility, {fmt} provides a safe replacement
+  for the <code>printf</code> family of functions. Errors in format strings,
+  which are a common source of vulnerabilities in C, are <b>reported at
+  compile time</b>. For example:
+
+  <pre><code class="language-cpp"
+  >fmt::format("{:d}", "I am not a number");</code></pre>
+
+  will give a compile-time error because <code>d</code> is not a valid
+  format specifier for strings. APIs like <a href="api/#format">
+  <code>fmt::format</code></a> <b>prevent buffer overflow errors</b> via
+  automatic memory management.
+</p>
+<a href="api#compile-time-checks"> Learn more</a>
+</div>
+
+<div class="feature">
+<h2>Extensibility</h2>
+<p>
+  Formatting of most <b>standard types</b>, including all containers, dates,
+  and times is <b>supported out-of-the-box</b>. For example:
+  
+  <pre><code class="language-cpp"
+  >fmt::print("{}", std::vector{1, 2, 3});</code></pre>
+
+  prints the vector in a JSON-like format:
+
+  <pre><code>[1, 2, 3]</code></pre>
+
+  You can <b>make your own types formattable</b> and even make compile-time
+  checks work for them.
+</p>
+<a href="api#udt"> Learn more</a>
+</div>
+
+<div class="feature">
+<h2>Performance</h2>
+<p>
+  {fmt} can be anywhere from <b>tens of percent to 20-30 times faster</b> than
+  iostreams and <code>sprintf</code>, especially for numeric formatting.
+
+<a href="https://github.com/fmtlib/fmt?tab=readme-ov-file#benchmarks">
+<img src="perf.svg">
+</a>
+
+  The library <b>minimizes dynamic memory allocations</b> and can optionally
+  <a href="api#compile-api">compile format strings</a> to optimal code.
+</p>
+</div>
+
+<div class="feature">
+<h2>Unicode support</h2>
+<p>
+  {fmt} provides <b>portable Unicode support</b> on major operating systems
+  with UTF-8 and <code>char</code> strings. For example:
+
+  <pre><code class="language-cpp"
+  >fmt::print(" !");</code></pre>
+
+  will be printed correctly on Linux, macOS, and even Windows console,
+  irrespective of the codepages.
+</p>
+<p>
+  The default is <b>locale-independent</b>, but you can opt into localized
+  formatting and {fmt} makes it work with Unicode, addressing issues in the
+  standard libary.
+</p>
+</div>
+
+<div class="feature">
+<h2>Fast compilation</h2>
+<p>
+  The library makes extensive use of <b>type erasure</b> to achieve fast
+  compilation. <code>fmt/base.h</code> provides a subset of the API with
+  <b>minimal include dependencies</b> and enough functionality to replace
+  all uses of <code>*printf</code>.
+</p>
+<p>
+  Code using {fmt} is usually several times faster to compile than the
+  equivalent iostreams code, and while <code>printf</code> compiles faster
+  still, the gap is narrowing.
+</p>
+<a href=
+"https://github.com/fmtlib/fmt?tab=readme-ov-file#compile-time-and-code-bloat">
+ Learn more</a>
+</div>
+
+<div class="feature">
+<h2>Small binary footprint</h2>
+<p>
+  Type erasure is also used to prevent template bloat, resulting in <b>compact
+  per-call binary code</b>. For example, a call to <code>fmt::print</code> with
+  a single argument is just <a href="https://godbolt.org/g/TZU4KF">a few
+  instructions</a>, comparable to <code>printf</code> despite adding
+  runtime safety, and much smaller than the equivalent iostreams code.
+</p>
+<p>
+  The library itself has small binary footprint and some components such as
+  floating-point formatting can be disabled to make it even smaller for
+  resource-constrained devices.
+</p>
+</div>
+
+<div class="feature">
+<h2>Portability</h2>
+<p>
+  {fmt} has a <b>small self-contained codebase</b> with the core consisting of
+  just three headers and no external dependencies.
+</p>
+<p>
+  The library is highly portable and requires only a minimal <b>subset of
+  C++11</b> features which are available in GCC 4.9, Clang 3.4, MSVC 19.0
+  (2015) and later. Newer compiler and standard library features are used
+  if available, and enable additional functionality.
+</p>
+<p>
+  Where possible, the output of formatting functions is <b>consistent across
+  platforms</b>.
+</p>
+</p>
+</div>
+
+<div class="feature">
+<h2>Open source</h2>
+<p>
+  {fmt} is in the top hundred open-source C++ libraries on GitHub and has
+  <a href="https://github.com/fmtlib/fmt/graphs/contributors">hundreds of
+  all-time contributors</a>.
+</p>
+<p>
+  The library is distributed under a permissive MIT
+  <a href="https://github.com/fmtlib/fmt#license">license</a> and is
+  <b>relied upon by many open-source projects</b>, including Blender, PyTorch,
+  Apple's FoundationDB, Windows Terminal, MongoDB, and others.
+</p>
+</div>
+
+</div>
diff --git a/doc/index.rst b/doc/index.rst
deleted file mode 100644
index 8d55c7a1..00000000
--- a/doc/index.rst
+++ /dev/null
@@ -1,198 +0,0 @@
-Overview
-========
-
-**{fmt}** is an open-source formatting library providing a fast and safe
-alternative to C stdio and C++ iostreams.
-
-.. raw:: html
-
-   <div class="panel panel-default">
-     <div class="panel-heading">What users say:</div>
-     <div class="panel-body">
-       Thanks for creating this library. Its been a hole in C++ for
-       a long time. Ive used both <code>boost::format</code> and
-       <code>loki::SPrintf</code>, and neither felt like the right answer.
-       This does.
-     </div>
-   </div>
-
-.. _format-api-intro:
-
-Format API
-----------
-
-The format API is similar in spirit to the C ``printf`` family of function but
-is safer, simpler and several times `faster
-<https://www.zverovich.net/2020/06/13/fast-int-to-string-revisited.html>`_
-than common standard library implementations.
-The `format string syntax <syntax.html>`_ is similar to the one used by
-`str.format <https://docs.python.org/3/library/stdtypes.html#str.format>`_ in
-Python:
-
-.. code:: c++
-
-  std::string s = fmt::format("The answer is {}.", 42);
-  
-The ``fmt::format`` function returns a string "The answer is 42.". You can use
-``fmt::memory_buffer`` to avoid constructing ``std::string``:
-
-.. code:: c++
-
-  auto out = fmt::memory_buffer();
-  fmt::format_to(std::back_inserter(out),
-            "For a moment, {} happened.", "nothing");
-  auto data = out.data(); // pointer to the formatted data
-  auto size = out.size(); // size of the formatted data
-
-The ``fmt::print`` function performs formatting and writes the result to a stream:
-
-.. code:: c++
-
-  fmt::print(stderr, "System error code = {}\n", errno);
-
-If you omit the file argument the function will print to ``stdout``:
-
-.. code:: c++
-
-  fmt::print("Don't {}\n", "panic");
-
-The format API also supports positional arguments useful for localization:
-
-.. code:: c++
-
-  fmt::print("I'd rather be {1} than {0}.", "right", "happy");
-
-You can pass named arguments with ``fmt::arg``:
-
-.. code:: c++
-
-  fmt::print("Hello, {name}! The answer is {number}. Goodbye, {name}.",
-             fmt::arg("name", "World"), fmt::arg("number", 42));
-
-If your compiler supports C++11 user-defined literals, the suffix ``_a`` offers 
-an alternative, slightly terser syntax for named arguments:
-
-.. code:: c++
-
-  using namespace fmt::literals;
-  fmt::print("Hello, {name}! The answer is {number}. Goodbye, {name}.",
-             "name"_a="World", "number"_a=42);
-
-.. _safety:
-
-Safety
-------
-
-The library is fully type safe, automatic memory management prevents buffer
-overflow, errors in format strings are reported using exceptions or at compile
-time. For example, the code
-
-.. code:: c++
-
-  fmt::format("The answer is {:d}", "forty-two");
-
-throws the ``format_error`` exception because the argument ``"forty-two"`` is a
-string while the format code ``d`` only applies to integers.
-
-The code
-
-.. code:: c++
-
-  format(FMT_STRING("The answer is {:d}"), "forty-two");
-
-reports a compile-time error on compilers that support relaxed ``constexpr``.
-See `here <api.html#compile-time-format-string-checks>`_ for details.
-
-The following code
-
-.. code:: c++
-
-  fmt::format("Cyrillic letter {}", L'\x42e');
-  
-produces a compile-time error because wide character ``L'\x42e'`` cannot be
-formatted into a narrow string. For comparison, writing a wide character to
-``std::ostream`` results in its numeric value being written to the stream
-(i.e. 1070 instead of letter '' which is represented by ``L'\x42e'`` if we
-use Unicode) which is rarely desirable.
-
-Compact Binary Code
--------------------
-
-The library produces compact per-call compiled code. For example
-(`godbolt <https://godbolt.org/g/TZU4KF>`_),
-
-.. code:: c++
-
-   #include <fmt/core.h>
-
-   int main() {
-     fmt::print("The answer is {}.", 42);
-   }
-
-compiles to just
-
-.. code:: asm
-
-   main: # @main
-     sub rsp, 24
-     mov qword ptr [rsp], 42
-     mov rcx, rsp
-     mov edi, offset .L.str
-     mov esi, 17
-     mov edx, 1
-     call fmt::v7::vprint(fmt::v7::basic_string_view<char>, fmt::v7::format_args)
-     xor eax, eax
-     add rsp, 24
-     ret
-   .L.str:
-     .asciz "The answer is {}."
-
-.. _portability:
-
-Portability
------------
-
-The library is highly portable and relies only on a small set of C++11 features:
-
-* variadic templates
-* type traits
-* rvalue references
-* decltype
-* trailing return types
-* deleted functions
-* alias templates
-
-These are available in GCC 4.8, Clang 3.4, MSVC 19.0 (2015) and more recent
-compiler version. For older compilers use {fmt} `version 4.x
-<https://github.com/fmtlib/fmt/releases/tag/4.1.0>`_ which is maintained and
-only requires C++98.
-
-The output of all formatting functions is consistent across platforms.
-For example,
-
-.. code::
-
-  fmt::print("{}", std::numeric_limits<double>::infinity());
-
-always prints ``inf`` while the output of ``printf`` is platform-dependent.
-
-.. _ease-of-use:
-
-Ease of Use
------------
-
-{fmt} has a small self-contained code base with the core library consisting of
-just three header files and no external dependencies.
-A permissive MIT `license <https://github.com/fmtlib/fmt#license>`_ allows
-using the library both in open-source and commercial projects.
-
-`Learn more... <contents.html>`_
-
-.. raw:: html
-
-  <a class="btn btn-success" href="https://github.com/fmtlib/fmt">GitHub Repository</a>
-
-  <div class="section footer">
-    <iframe src="https://ghbtns.com/github-btn.html?user=fmtlib&amp;repo=fmt&amp;type=watch&amp;count=true"
-            class="github-btn" width="100" height="20"></iframe>
-  </div>
diff --git a/doc/perf.svg b/doc/perf.svg
new file mode 100644
index 00000000..7867a154
--- /dev/null
+++ b/doc/perf.svg
@@ -0,0 +1 @@
+<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="20 0 550 300" aria-label="A chart." style="overflow: hidden;"><defs id="_ABSTRACT_RENDERER_ID_0"><clipPath id="_ABSTRACT_RENDERER_ID_1"><rect x="120" y="45" width="560" height="210"></rect></clipPath></defs><rect x="0" y="0" width="800" height="300" stroke="none" stroke-width="0" fill="#ffffff"></rect><g><text text-anchor="start" x="120" y="27.05" font-family="Arial" font-size="13" font-weight="bold" stroke="none" stroke-width="0" fill="#000000">double to string</text><rect x="120" y="16" width="560" height="13" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect></g><g><rect x="120" y="45" width="560" height="210" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect><g clip-path="url(#_ABSTRACT_RENDERER_ID_1)"><g><rect x="120" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="213" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="306" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="400" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="493" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="586" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#cccccc"></rect><rect x="679" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#cccccc"></rect></g><g><rect x="121" y="53" width="450" height="26" stroke="#ff9900" stroke-width="1" fill="#ff9900"></rect><rect x="121" y="95" width="421" height="26" stroke="#109618" stroke-width="1" fill="#109618"></rect><rect x="121" y="137" width="341" height="26" stroke="#990099" stroke-width="1" fill="#990099"></rect><rect x="121" y="179" width="31" height="26" stroke="#3366cc" stroke-width="1" fill="#3366cc"></rect><rect x="121" y="221" width="15" height="26" stroke="#dc3912" stroke-width="1" fill="#dc3912"></rect></g><g><rect x="120" y="45" width="1" height="210" stroke="none" stroke-width="0" fill="#333333"></rect></g></g><g></g><g><g><text text-anchor="middle" x="120.5" y="272.3833333333333" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#444444">0</text></g><g><text text-anchor="middle" x="213.6667" y="272.3833333333333" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#444444">250</text></g><g><text text-anchor="middle" x="306.8333" y="272.3833333333333" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#444444">500</text></g><g><text text-anchor="middle" x="400" y="272.3833333333333" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#444444">750</text></g><g><text text-anchor="middle" x="493.1667" y="272.3833333333333" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#444444">1,000</text></g><g><text text-anchor="middle" x="586.3333" y="272.3833333333333" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#444444">1,250</text></g><g><text text-anchor="middle" x="679.5" y="272.3833333333333" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#444444">1,500</text></g><g><text text-anchor="end" x="107" y="70.95" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#222222">ostringstream</text></g><g><text text-anchor="end" x="107" y="112.74999999999999" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#222222">ostrstream</text></g><g><text text-anchor="end" x="107" y="154.55" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#222222">sprintf</text></g><g><text text-anchor="end" x="107" y="196.35" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#222222">doubleconv</text></g><g><text text-anchor="end" x="107" y="238.15" font-family="Arial" font-size="13" stroke="none" stroke-width="0" fill="#222222">fmt</text></g></g></g><g><g><text text-anchor="middle" x="300" y="291.71666666666664" font-family="Arial" font-size="13" font-style="italic" stroke="none" stroke-width="0" fill="#222222">Time (ns), smaller is better</text><rect x="120" y="280.66666666666663" width="560" height="13" stroke="none" stroke-width="0" fill-opacity="0" fill="#ffffff"></rect></g></g><g></g></svg>
\ No newline at end of file
diff --git a/doc/syntax.md b/doc/syntax.md
new file mode 100644
index 00000000..1a44e867
--- /dev/null
+++ b/doc/syntax.md
@@ -0,0 +1,886 @@
+# Format String Syntax
+
+Formatting functions such as [`fmt::format`](api.md#format) and [`fmt::print`](
+api.md#print) use the same format string syntax described in this section.
+
+Format strings contain "replacement fields" surrounded by curly braces `{}`.
+Anything that is not contained in braces is considered literal text, which is
+copied unchanged to the output. If you need to include a brace character in
+the literal text, it can be escaped by doubling: `{{` and `}}`.
+
+The grammar for a replacement field is as follows:
+
+<a id="replacement-field"></a>
+<pre><code class="language-json"
+>replacement_field ::= "{" [arg_id] [":" (<a href="#format-spec"
+  >format_spec</a> | <a href="#chrono-format-spec">chrono_format_spec</a>)] "}"
+arg_id            ::= integer | identifier
+integer           ::= digit+
+digit             ::= "0"..."9"
+identifier        ::= id_start id_continue*
+id_start          ::= "a"..."z" | "A"..."Z" | "_"
+id_continue       ::= id_start | digit</code>
+</pre>
+
+In less formal terms, the replacement field can start with an *arg_id* that
+specifies the argument whose value is to be formatted and inserted into the
+output instead of the replacement field. The *arg_id* is optionally followed
+by a *format_spec*, which is preceded by a colon `':'`. These specify a
+non-default format for the replacement value.
+
+See also the [Format Specification
+Mini-Language](#format-specification-mini-language) section.
+
+If the numerical arg_ids in a format string are 0, 1, 2, ... in sequence,
+they can all be omitted (not just some) and the numbers 0, 1, 2, ... will be
+automatically inserted in that order.
+
+Named arguments can be referred to by their names or indices.
+
+Some simple format string examples:
+
+```c++
+"First, thou shalt count to {0}" // References the first argument
+"Bring me a {}"                  // Implicitly references the first argument
+"From {} to {}"                  // Same as "From {0} to {1}"
+```
+
+The *format_spec* field contains a specification of how the value should
+be presented, including such details as field width, alignment, padding,
+decimal precision and so on. Each value type can define its own
+"formatting mini-language" or interpretation of the *format_spec*.
+
+Most built-in types support a common formatting mini-language, which is
+described in the next section.
+
+A *format_spec* field can also include nested replacement fields in
+certain positions within it. These nested replacement fields can contain
+only an argument id; format specifications are not allowed. This allows
+the formatting of a value to be dynamically specified.
+
+See the [Format Examples](#format-examples) section for some examples.
+
+## Format Specification Mini-Language
+
+"Format specifications" are used within replacement fields contained within a
+format string to define how individual values are presented. Each formattable
+type may define how the format specification is to be interpreted.
+
+Most built-in types implement the following options for format
+specifications, although some of the formatting options are only
+supported by the numeric types.
+
+The general form of a *standard format specifier* is:
+
+<a id="format-spec"></a>
+<pre><code class="language-json"
+>format_spec ::= [[fill]align][sign]["#"]["0"][width]["." precision]["L"][type]
+fill        ::= &lt;a character other than '{' or '}'>
+align       ::= "<" | ">" | "^"
+sign        ::= "+" | "-" | " "
+width       ::= <a href="#replacement-field">integer</a> | "{" [<a
+  href="#replacement-field">arg_id</a>] "}"
+precision   ::= <a href="#replacement-field">integer</a> | "{" [<a
+  href="#replacement-field">arg_id</a>] "}"
+type        ::= "a" | "A" | "b" | "B" | "c" | "d" | "e" | "E" | "f" | "F" |
+                "g" | "G" | "o" | "p" | "s" | "x" | "X" | "?"</code>
+</pre>
+
+The *fill* character can be any Unicode code point other than `'{'` or `'}'`.
+The presence of a fill character is signaled by the character following it,
+which must be one of the alignment options. If the second character of
+*format_spec* is not a valid alignment option, then it is assumed that both
+the fill character and the alignment option are absent.
+
+The meaning of the various alignment options is as follows:
+
+<table>
+<tr>
+  <th>Option</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'<'</code></td>
+  <td>
+    Forces the field to be left-aligned within the available space (this is the
+    default for most objects).
+  </td>
+</tr>
+<tr>
+  <td><code>'>'</code></td>
+  <td>
+    Forces the field to be right-aligned within the available space (this is
+    the default for numbers).
+  </td>
+</tr>
+<tr>
+  <td><code>'^'</code></td>
+  <td>Forces the field to be centered within the available space.</td>
+</tr>
+</table>
+
+Note that unless a minimum field width is defined, the field width will
+always be the same size as the data to fill it, so that the alignment
+option has no meaning in this case.
+
+The *sign* option is only valid for floating point and signed integer types,
+and can be one of the following:
+
+<table>
+<tr>
+  <th>Option</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'+'</code></td>
+  <td>
+    Indicates that a sign should be used for both nonnegative as well as
+    negative numbers.
+  </td>
+</tr>
+<tr>
+  <td><code>'-'</code></td>
+  <td>
+    Indicates that a sign should be used only for negative numbers (this is the
+    default behavior).
+  </td>
+</tr>
+<tr>
+  <td>space</td>
+  <td>
+    Indicates that a leading space should be used on nonnegative numbers, and a
+    minus sign on negative numbers.
+  </td>
+</tr>
+</table>
+
+The `'#'` option causes the "alternate form" to be used for the
+conversion. The alternate form is defined differently for different
+types. This option is only valid for integer and floating-point types.
+For integers, when binary, octal, or hexadecimal output is used, this
+option adds the prefix respective `"0b"` (`"0B"`), `"0"`, or `"0x"`
+(`"0X"`) to the output value. Whether the prefix is lower-case or
+upper-case is determined by the case of the type specifier, for example,
+the prefix `"0x"` is used for the type `'x'` and `"0X"` is used for
+`'X'`. For floating-point numbers the alternate form causes the result
+of the conversion to always contain a decimal-point character, even if
+no digits follow it. Normally, a decimal-point character appears in the
+result of these conversions only if a digit follows it. In addition, for
+`'g'` and `'G'` conversions, trailing zeros are not removed from the
+result.
+
+*width* is a decimal integer defining the minimum field width. If not
+specified, then the field width will be determined by the content.
+
+Preceding the *width* field by a zero (`'0'`) character enables
+sign-aware zero-padding for numeric types. It forces the padding to be
+placed after the sign or base (if any) but before the digits. This is
+used for printing fields in the form "+000000120". This option is only
+valid for numeric types and it has no effect on formatting of infinity
+and NaN. This option is ignored when any alignment specifier is present.
+
+The *precision* is a decimal number indicating how many digits should be
+displayed after the decimal point for a floating-point value formatted
+with `'f'` and `'F'`, or before and after the decimal point for a
+floating-point value formatted with `'g'` or `'G'`. For non-number types
+the field indicates the maximum field size - in other words, how many
+characters will be used from the field content. The *precision* is not
+allowed for integer, character, Boolean, and pointer values. Note that a
+C string must be null-terminated even if precision is specified.
+
+The `'L'` option uses the current locale setting to insert the appropriate
+number separator characters. This option is only valid for numeric types.
+
+Finally, the *type* determines how the data should be presented.
+
+The available string presentation types are:
+
+<table>
+<tr>
+  <th>Type</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'s'</code></td>
+  <td>
+    String format. This is the default type for strings and may be omitted.
+  </td>
+</tr>
+<tr>
+  <td><code>'?'</code></td>
+  <td>Debug format. The string is quoted and special characters escaped.</td>
+</tr>
+<tr>
+  <td>none</td>
+  <td>The same as <code>'s'</code>.</td>
+</tr>
+</table>
+
+The available character presentation types are:
+
+<table>
+<tr>
+  <th>Type</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'c'</code></td>
+  <td>
+    Character format. This is the default type for characters and may be
+    omitted.
+  </td>
+</tr>
+<tr>
+  <td><code>'?'</code></td>
+  <td>Debug format. The character is quoted and special characters escaped.</td>
+</tr>
+<tr>
+  <td>none</td>
+  <td>The same as <code>'c'</code>.</td>
+</tr>
+</table>
+
+The available integer presentation types are:
+
+<table>
+<tr>
+  <th>Type</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'b'</code></td>
+  <td>
+    Binary format. Outputs the number in base 2. Using the <code>'#'</code>
+    option with this type adds the prefix <code>"0b"</code> to the output value.    
+  </td>
+</tr>
+<tr>
+  <td><code>'B'</code></td>
+  <td>
+    Binary format. Outputs the number in base 2. Using the <code>'#'</code>
+    option with this type adds the prefix <code>"0B"</code> to the output value.
+  </td>
+</tr>
+<tr>
+  <td><code>'c'</code></td>
+  <td>Character format. Outputs the number as a character.</td>
+</tr>
+<tr>
+  <td><code>'d'</code></td>
+  <td>Decimal integer. Outputs the number in base 10.</td>
+</tr>
+<tr>
+  <td><code>'o'</code></td>
+  <td>Octal format. Outputs the number in base 8.</td>
+</tr>
+<tr>
+  <td><code>'x'</code></td>
+  <td>
+    Hex format. Outputs the number in base 16, using lower-case letters for the
+    digits above 9. Using the <code>'#'</code> option with this type adds the
+    prefix <code>"0x"</code> to the output value.
+  </td>
+</tr>
+<tr>
+  <td><code>'X'</code></td>
+  <td>
+    Hex format. Outputs the number in base 16, using upper-case letters for the
+    digits above 9. Using the <code>'#'</code> option with this type adds the
+    prefix <code>"0X"</code> to the output value.
+  </td>
+</tr>
+<tr>
+  <td>none</td>
+  <td>The same as <code>'d'</code>.</td>
+</tr>
+</table>
+
+Integer presentation types can also be used with character and Boolean values
+with the only exception that `'c'` cannot be used with `bool`. Boolean values
+are formatted using textual representation, either `true` or `false`, if the
+presentation type is not specified.
+
+The available presentation types for floating-point values are:
+
+<table>
+<tr>
+  <th>Type</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'a'</code></td>
+  <td>
+    Hexadecimal floating point format. Prints the number in base 16 with
+    prefix <code>"0x"</code> and lower-case letters for digits above 9.
+    Uses <code>'p'</code> to indicate the exponent.
+  </td>
+</tr>
+<tr>
+  <td><code>'A'</code></td>
+  <td>
+    Same as <code>'a'</code> except it uses upper-case letters for the
+    prefix, digits above 9 and to indicate the exponent.
+  </td>
+</tr>
+<tr>
+  <td><code>'e'</code></td>
+  <td>
+    Exponent notation. Prints the number in scientific notation using
+    the letter 'e' to indicate the exponent.
+  </td>
+</tr>
+<tr>
+  <td><code>'E'</code></td>
+  <td>
+    Exponent notation. Same as <code>'e'</code> except it uses an
+    upper-case <code>'E'</code> as the separator character.
+  </td>
+</tr>
+<tr>
+  <td><code>'f'</code></td>
+  <td>Fixed point. Displays the number as a fixed-point number.</td>
+</tr>
+<tr>
+  <td><code>'F'</code></td>
+  <td>
+    Fixed point. Same as <code>'f'</code>, but converts <code>nan</code>
+    to <code>NAN</code> and <code>inf</code> to <code>INF</code>.
+  </td>
+</tr>
+<tr>
+  <td><code>'g'</code></td>
+  <td>
+    <p>General format. For a given precision <code>p &gt;= 1</code>,
+    this rounds the number to <code>p</code> significant digits and then
+    formats the result in either fixed-point format or in scientific
+    notation, depending on its magnitude.</p>
+    <p>A precision of <code>0</code> is treated as equivalent to a precision
+    of <code>1</code>.</p>
+  </td>
+</tr>
+<tr>
+  <td><code>'G'</code></td>
+  <td>
+    General format. Same as <code>'g'</code> except switches to
+    <code>'E'</code> if the number gets too large. The representations of
+    infinity and NaN are uppercased, too.
+  </td>
+</tr>
+<tr>
+  <td>none</td>
+  <td>
+    Similar to <code>'g'</code>, except that the default precision is as
+    high as needed to represent the particular value.
+  </td>
+</tr>
+</table>
+
+The available presentation types for pointers are:
+
+<table>
+<tr>
+  <th>Type</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'p'</code></td>
+  <td>
+    Pointer format. This is the default type for pointers and may be omitted.
+  </td>
+</tr>
+<tr>
+  <td>none</td>
+  <td>The same as <code>'p'</code>.</td>
+</tr>
+</table>
+
+## Chrono Format Specifications
+
+Format specifications for chrono duration and time point types as well as
+`std::tm` have the following syntax:
+
+<a id="chrono-format-spec"></a>
+<pre><code class="language-json"
+>chrono_format_spec ::= [[<a href="#format-spec">fill</a>]<a href="#format-spec"
+  >align</a>][<a href="#format-spec">width</a>]["." <a href="#format-spec"
+  >precision</a>][chrono_specs]
+chrono_specs       ::= conversion_spec |
+                       chrono_specs (conversion_spec | literal_char)
+conversion_spec    ::= "%" [padding_modifier] [locale_modifier] chrono_type
+literal_char       ::= &lt;a character other than '{', '}' or '%'>
+padding_modifier   ::= "-" | "_"  | "0"
+locale_modifier    ::= "E" | "O"
+chrono_type        ::= "a" | "A" | "b" | "B" | "c" | "C" | "d" | "D" | "e" |
+                       "F" | "g" | "G" | "h" | "H" | "I" | "j" | "m" | "M" |
+                       "n" | "p" | "q" | "Q" | "r" | "R" | "S" | "t" | "T" |
+                       "u" | "U" | "V" | "w" | "W" | "x" | "X" | "y" | "Y" |
+                       "z" | "Z" | "%"</code>
+</pre>
+
+Literal chars are copied unchanged to the output. Precision is valid only
+for `std::chrono::duration` types with a floating-point representation type.
+
+The available presentation types (*chrono_type*) are:
+
+<table>
+<tr>
+  <th>Type</th>
+  <th>Meaning</th>
+</tr>
+<tr>
+  <td><code>'a'</code></td>
+  <td>
+    The abbreviated weekday name, e.g. "Sat". If the value does not contain a
+    valid weekday, an exception of type <code>format_error</code> is thrown.
+  </td>
+</tr>
+<tr>
+  <td><code>'A'</code></td>
+  <td>
+    The full weekday name, e.g. "Saturday". If the value does not contain a
+    valid weekday, an exception of type <code>format_error</code> is thrown.
+  </td>
+</tr>
+<tr>
+  <td><code>'b'</code></td>
+  <td>
+    The abbreviated month name, e.g. "Nov". If the value does not contain a
+    valid month, an exception of type <code>format_error</code> is thrown.
+  </td>
+</tr>
+<tr>
+  <td><code>'B'</code></td>
+  <td>
+    The full month name, e.g. "November". If the value does not contain a valid
+    month, an exception of type <code>format_error</code> is thrown.
+  </td>
+</tr>
+<tr>
+  <td><code>'c'</code></td>
+  <td>
+    The date and time representation, e.g. "Sat Nov 12 22:04:00 1955". The
+    modified command <code>%Ec</code> produces the locale's alternate date and
+    time representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'C'</code></td>
+  <td>
+    The year divided by 100 using floored division, e.g. "19". If the result
+    is a single decimal digit, it is prefixed with 0. The modified command
+    <code>%EC</code> produces the locale's alternative representation of the
+    century.
+  </td>
+</tr>
+<tr>
+  <td><code>'d'</code></td>
+  <td>
+    The day of month as a decimal number. If the result is a single decimal
+    digit, it is prefixed with 0. The modified command <code>%Od</code>
+    produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'D'</code></td>
+  <td>Equivalent to <code>%m/%d/%y</code>, e.g. "11/12/55".</td>
+</tr>
+<tr>
+  <td><code>'e'</code></td>
+  <td>
+    The day of month as a decimal number. If the result is a single decimal
+    digit, it is prefixed with a space. The modified command <code>%Oe</code>
+    produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'F'</code></td>
+  <td>Equivalent to <code>%Y-%m-%d</code>, e.g. "1955-11-12".</td>
+</tr>
+<tr>
+  <td><code>'g'</code></td>
+  <td>
+    The last two decimal digits of the ISO week-based year. If the result is a
+    single digit it is prefixed by 0.
+  </td>
+</tr>
+<tr>
+  <td><code>'G'</code></td>
+  <td>
+    The ISO week-based year as a decimal number. If the result is less than
+    four digits it is left-padded with 0 to four digits.
+  </td>
+</tr>
+<tr>
+  <td><code>'h'</code></td>
+  <td>Equivalent to <code>%b</code>, e.g. "Nov".</td>
+</tr>
+<tr>
+  <td><code>'H'</code></td>
+  <td>
+    The hour (24-hour clock) as a decimal number. If the result is a single
+    digit, it is prefixed with 0. The modified command <code>%OH</code>
+    produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'I'</code></td>
+  <td>
+    The hour (12-hour clock) as a decimal number. If the result is a single
+    digit, it is prefixed with 0. The modified command <code>%OI</code>
+    produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'j'</code></td>
+  <td>
+    If the type being formatted is a specialization of duration, the decimal
+    number of days without padding. Otherwise, the day of the year as a decimal
+    number. Jan 1 is 001. If the result is less than three digits, it is
+    left-padded with 0 to three digits.
+  </td>
+</tr>
+<tr>
+  <td><code>'m'</code></td>
+  <td>
+    The month as a decimal number. Jan is 01. If the result is a single digit,
+    it is prefixed with 0. The modified command <code>%Om</code> produces the
+    locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'M'</code></td>
+  <td>
+    The minute as a decimal number. If the result is a single digit, it
+    is prefixed with 0. The modified command <code>%OM</code> produces the
+    locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'n'</code></td>
+  <td>A new-line character.</td>
+</tr>
+<tr>
+  <td><code>'p'</code></td>
+  <td>The AM/PM designations associated with a 12-hour clock.</td>
+</tr>
+<tr>
+  <td><code>'q'</code></td>
+  <td>The duration's unit suffix.</td>
+</tr>
+<tr>
+  <td><code>'Q'</code></td>
+  <td>
+    The duration's numeric value (as if extracted via <code>.count()</code>).
+  </td>
+</tr>
+<tr>
+  <td><code>'r'</code></td>
+  <td>The 12-hour clock time, e.g. "10:04:00 PM".</td>
+</tr>
+<tr>
+  <td><code>'R'</code></td>
+  <td>Equivalent to <code>%H:%M</code>, e.g. "22:04".</td>
+</tr>
+<tr>
+  <td><code>'S'</code></td>
+  <td>
+    Seconds as a decimal number. If the number of seconds is less than 10, the
+    result is prefixed with 0. If the precision of the input cannot be exactly
+    represented with seconds, then the format is a decimal floating-point number
+    with a fixed format and a precision matching that of the precision of the
+    input (or to a microseconds precision if the conversion to floating-point
+    decimal seconds cannot be made within 18 fractional digits). The modified
+    command <code>%OS</code> produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'t'</code></td>
+  <td>A horizontal-tab character.</td>
+</tr>
+<tr>
+  <td><code>'T'</code></td>
+  <td>Equivalent to <code>%H:%M:%S</code>.</td>
+</tr>
+<tr>
+  <td><code>'u'</code></td>
+  <td>
+    The ISO weekday as a decimal number (1-7), where Monday is 1. The modified
+    command <code>%Ou</code> produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'U'</code></td>
+  <td>
+    The week number of the year as a decimal number. The first Sunday of the
+    year is the first day of week 01. Days of the same year prior to that are
+    in week 00. If the result is a single digit, it is prefixed with 0.
+    The modified command <code>%OU</code> produces the locale's alternative
+    representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'V'</code></td>
+  <td>
+    The ISO week-based week number as a decimal number. If the result is a
+    single digit, it is prefixed with 0. The modified command <code>%OV</code>
+    produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'w'</code></td>
+  <td>
+    The weekday as a decimal number (0-6), where Sunday is 0. The modified
+    command <code>%Ow</code> produces the locale's alternative representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'W'</code></td>
+  <td>
+    The week number of the year as a decimal number. The first Monday of the
+    year is the first day of week 01. Days of the same year prior to that are
+    in week 00. If the result is a single digit, it is prefixed with 0.
+    The modified command <code>%OW</code> produces the locale's alternative
+    representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'x'</code></td>
+  <td>
+    The date representation, e.g. "11/12/55". The modified command
+    <code>%Ex</code> produces the locale's alternate date representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'X'</code></td>
+  <td>
+    The time representation, e.g. "10:04:00". The modified command
+    <code>%EX</code> produces the locale's alternate time representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'y'</code></td>
+  <td>
+    The last two decimal digits of the year. If the result is a single digit
+    it is prefixed by 0. The modified command <code>%Oy</code> produces the
+    locale's alternative representation. The modified command <code>%Ey</code>
+    produces the locale's alternative representation of offset from
+    <code>%EC</code> (year only).
+  </td>
+</tr>
+<tr>
+  <td><code>'Y'</code></td>
+  <td>
+    The year as a decimal number. If the result is less than four digits it is
+    left-padded with 0 to four digits. The modified command <code>%EY</code>
+    produces the locale's alternative full year representation.
+  </td>
+</tr>
+<tr>
+  <td><code>'z'</code></td>
+  <td>
+    The offset from UTC in the ISO 8601:2004 format. For example -0430 refers
+    to 4 hours 30 minutes behind UTC. If the offset is zero, +0000 is used.
+    The modified commands <code>%Ez</code> and <code>%Oz</code> insert a
+    <code>:</code> between the hours and minutes: -04:30. If the offset
+    information is not available, an exception of type
+    <code>format_error</code> is thrown.
+  </td>
+</tr>
+<tr>
+  <td><code>'Z'</code></td>
+  <td>
+    The time zone abbreviation. If the time zone abbreviation is not available,
+    an exception of type <code>format_error</code> is thrown.
+  </td>
+</tr>
+<tr>
+  <td><code>'%'</code></td>
+  <td>A % character.</td>
+</tr>
+</table>
+
+Specifiers that have a calendaric component such as `'d'` (the day of month)
+are valid only for `std::tm` and time points but not durations.
+
+The available padding modifiers (*padding_modifier*) are:
+
+| Type  | Meaning                                 |
+|-------|-----------------------------------------|
+| `'-'` | Pad a numeric result with spaces.       |
+| `'_'` | Do not pad a numeric result string.     |
+| `'0'` | Pad a numeric result string with zeros. |
+
+These modifiers are only supported for the `'H'`, `'I'`, `'M'`, `'S'`, `'U'`,
+`'V'`, `'W'`, `'m'`, `'j'`, `'Y'` presentation types.
+
+## Range Format Specifications
+
+Format specifications for range types have the following syntax:
+
+<pre><code class="language-json"
+>range_format_spec ::= ["n"][range_type][range_underlying_spec]</code>
+</pre>
+
+The `'n'` option formats the range without the opening and closing brackets.
+
+The available presentation types for `range_type` are:
+
+| Type   | Meaning                                                    |
+|--------|------------------------------------------------------------|
+| none   | Default format.                                            |
+| `'s'`  | String format. The range is formatted as a string.         |
+| `'?s'` | Debug format. The range is formatted as an escaped string. |
+
+If `range_type` is `'s'` or `'?s'`, the range element type must be a character
+type. The `'n'` option and `range_underlying_spec` are mutually exclusive with
+`'s'` and `'?s'`.
+
+The `range_underlying_spec` is parsed based on the formatter of the range's
+element type.
+
+By default, a range of characters or strings is printed escaped and quoted.
+But if any `range_underlying_spec` is provided (even if it is empty), then the
+characters or strings are printed according to the provided specification.
+
+Examples:
+
+```c++
+fmt::print("{}", std::vector{10, 20, 30});
+// Output: [10, 20, 30]
+fmt::print("{::#x}", std::vector{10, 20, 30});
+// Output: [0xa, 0x14, 0x1e]
+fmt::print("{}", std::vector{'h', 'e', 'l', 'l', 'o'});
+// Output: ['h', 'e', 'l', 'l', 'o']
+fmt::print("{:n}", std::vector{'h', 'e', 'l', 'l', 'o'});
+// Output: 'h', 'e', 'l', 'l', 'o'
+fmt::print("{:s}", std::vector{'h', 'e', 'l', 'l', 'o'});
+// Output: "hello"
+fmt::print("{:?s}", std::vector{'h', 'e', 'l', 'l', 'o', '\n'});
+// Output: "hello\n"
+fmt::print("{::}", std::vector{'h', 'e', 'l', 'l', 'o'});
+// Output: [h, e, l, l, o]
+fmt::print("{::d}", std::vector{'h', 'e', 'l', 'l', 'o'});
+// Output: [104, 101, 108, 108, 111]
+```
+
+## Format Examples
+
+This section contains examples of the format syntax and comparison with
+the printf formatting.
+
+In most of the cases the syntax is similar to the printf formatting,
+with the addition of the `{}` and with `:` used instead of `%`. For
+example, `"%03.2f"` can be translated to `"{:03.2f}"`.
+
+The new format syntax also supports new and different options, shown in
+the following examples.
+
+Accessing arguments by position:
+
+```c++
+fmt::format("{0}, {1}, {2}", 'a', 'b', 'c');
+// Result: "a, b, c"
+fmt::format("{}, {}, {}", 'a', 'b', 'c');
+// Result: "a, b, c"
+fmt::format("{2}, {1}, {0}", 'a', 'b', 'c');
+// Result: "c, b, a"
+fmt::format("{0}{1}{0}", "abra", "cad");  // arguments' indices can be repeated
+// Result: "abracadabra"
+```
+
+Aligning the text and specifying a width:
+
+```c++
+fmt::format("{:<30}", "left aligned");
+// Result: "left aligned                  "
+fmt::format("{:>30}", "right aligned");
+// Result: "                 right aligned"
+fmt::format("{:^30}", "centered");
+// Result: "           centered           "
+fmt::format("{:*^30}", "centered");  // use '*' as a fill char
+// Result: "***********centered***********"
+```
+
+Dynamic width:
+
+```c++
+fmt::format("{:<{}}", "left aligned", 30);
+// Result: "left aligned                  "
+```
+
+Dynamic precision:
+
+```c++
+fmt::format("{:.{}f}", 3.14, 1);
+// Result: "3.1"
+```
+
+Replacing `%+f`, `%-f`, and `% f` and specifying a sign:
+
+```c++
+fmt::format("{:+f}; {:+f}", 3.14, -3.14);  // show it always
+// Result: "+3.140000; -3.140000"
+fmt::format("{: f}; {: f}", 3.14, -3.14);  // show a space for positive numbers
+// Result: " 3.140000; -3.140000"
+fmt::format("{:-f}; {:-f}", 3.14, -3.14);  // show only the minus -- same as '{:f}; {:f}'
+// Result: "3.140000; -3.140000"
+```
+
+Replacing `%x` and `%o` and converting the value to different bases:
+
+```c++
+fmt::format("int: {0:d};  hex: {0:x};  oct: {0:o}; bin: {0:b}", 42);
+// Result: "int: 42;  hex: 2a;  oct: 52; bin: 101010"
+// with 0x or 0 or 0b as prefix:
+fmt::format("int: {0:d};  hex: {0:#x};  oct: {0:#o};  bin: {0:#b}", 42);
+// Result: "int: 42;  hex: 0x2a;  oct: 052;  bin: 0b101010"
+```
+
+Padded hex byte with prefix and always prints both hex characters:
+
+```c++
+fmt::format("{:#04x}", 0);
+// Result: "0x00"
+```
+
+Box drawing using Unicode fill:
+
+```c++
+fmt::print(
+    "{0:^{2}}\n"
+    "{1: ^{2}}\n"
+    "{0:^{2}}\n", "", "Hello, world!", 20);
+```
+
+prints:
+
+```
+
+   Hello, world!    
+
+```
+
+Using type-specific formatting:
+
+```c++
+#include <fmt/chrono.h>
+
+auto t = tm();
+t.tm_year = 2010 - 1900;
+t.tm_mon = 7;
+t.tm_mday = 4;
+t.tm_hour = 12;
+t.tm_min = 15;
+t.tm_sec = 58;
+fmt::print("{:%Y-%m-%d %H:%M:%S}", t);
+// Prints: 2010-08-04 12:15:58
+```
+
+Using the comma as a thousands separator:
+
+```c++
+#include <fmt/format.h>
+
+auto s = fmt::format(std::locale("en_US.UTF-8"), "{:L}", 1234567890);
+// s == "1,234,567,890"
+```
diff --git a/doc/syntax.rst b/doc/syntax.rst
deleted file mode 100644
index 3c21902c..00000000
--- a/doc/syntax.rst
+++ /dev/null
@@ -1,647 +0,0 @@
-.. _syntax:
-
-********************
-Format String Syntax
-********************
-
-Formatting functions such as :ref:`fmt::format() <format>` and
-:ref:`fmt::print() <print>` use the same format string syntax described in this
-section.
-
-Format strings contain "replacement fields" surrounded by curly braces ``{}``.
-Anything that is not contained in braces is considered literal text, which is
-copied unchanged to the output.  If you need to include a brace character in the
-literal text, it can be escaped by doubling: ``{{`` and ``}}``.
-
-The grammar for a replacement field is as follows:
-
-.. productionlist:: sf
-   replacement_field: "{" [`arg_id`] [":" (`format_spec` | `chrono_format_spec`)] "}"
-   arg_id: `integer` | `identifier`
-   integer: `digit`+
-   digit: "0"..."9"
-   identifier: `id_start` `id_continue`*
-   id_start: "a"..."z" | "A"..."Z" | "_"
-   id_continue: `id_start` | `digit`
-
-In less formal terms, the replacement field can start with an *arg_id*
-that specifies the argument whose value is to be formatted and inserted into
-the output instead of the replacement field.
-The *arg_id* is optionally followed by a *format_spec*, which is preceded by a
-colon ``':'``.  These specify a non-default format for the replacement value.
-
-See also the :ref:`formatspec` section.
-
-If the numerical arg_ids in a format string are 0, 1, 2, ... in sequence,
-they can all be omitted (not just some) and the numbers 0, 1, 2, ... will be
-automatically inserted in that order.
-
-Named arguments can be referred to by their names or indices.
-
-Some simple format string examples::
-
-   "First, thou shalt count to {0}" // References the first argument
-   "Bring me a {}"                  // Implicitly references the first argument
-   "From {} to {}"                  // Same as "From {0} to {1}"
-
-The *format_spec* field contains a specification of how the value should be
-presented, including such details as field width, alignment, padding, decimal
-precision and so on.  Each value type can define its own "formatting
-mini-language" or interpretation of the *format_spec*.
-
-Most built-in types support a common formatting mini-language, which is
-described in the next section.
-
-A *format_spec* field can also include nested replacement fields in certain
-positions within it. These nested replacement fields can contain only an
-argument id; format specifications are not allowed. This allows the formatting
-of a value to be dynamically specified.
-
-See the :ref:`formatexamples` section for some examples.
-
-.. _formatspec:
-
-Format Specification Mini-Language
-==================================
-
-"Format specifications" are used within replacement fields contained within a
-format string to define how individual values are presented (see
-:ref:`syntax`).  Each formattable type may define how the format
-specification is to be interpreted.
-
-Most built-in types implement the following options for format specifications,
-although some of the formatting options are only supported by the numeric types.
-
-The general form of a *standard format specifier* is:
-
-.. productionlist:: sf
-   format_spec: [[`fill`]`align`][`sign`]["#"]["0"][`width`]["." `precision`]["L"][`type`]
-   fill: <a character other than '{' or '}'>
-   align: "<" | ">" | "^"
-   sign: "+" | "-" | " "
-   width: `integer` | "{" [`arg_id`] "}"
-   precision: `integer` | "{" [`arg_id`] "}"
-   type: "a" | "A" | "b" | "B" | "c" | "d" | "e" | "E" | "f" | "F" | "g" | "G" |
-       : "o" | "p" | "s" | "x" | "X" | "?"
-
-The *fill* character can be any Unicode code point other than ``'{'`` or
-``'}'``. The presence of a fill character is signaled by the character following
-it, which must be one of the alignment options. If the second character of
-*format_spec* is not a valid alignment option, then it is assumed that both the
-fill character and the alignment option are absent.
-
-The meaning of the various alignment options is as follows:
-
-+---------+----------------------------------------------------------+
-| Option  | Meaning                                                  |
-+=========+==========================================================+
-| ``'<'`` | Forces the field to be left-aligned within the available |
-|         | space (this is the default for most objects).            |
-+---------+----------------------------------------------------------+
-| ``'>'`` | Forces the field to be right-aligned within the          |
-|         | available space (this is the default for numbers).       |
-+---------+----------------------------------------------------------+
-| ``'^'`` | Forces the field to be centered within the available     |
-|         | space.                                                   |
-+---------+----------------------------------------------------------+
-
-Note that unless a minimum field width is defined, the field width will always
-be the same size as the data to fill it, so that the alignment option has no
-meaning in this case.
-
-The *sign* option is only valid for floating point and signed integer types,
-and can be one of the following:
-
-+---------+------------------------------------------------------------+
-| Option  | Meaning                                                    |
-+=========+============================================================+
-| ``'+'`` | indicates that a sign should be used for both              |
-|         | nonnegative as well as negative numbers.                   |
-+---------+------------------------------------------------------------+
-| ``'-'`` | indicates that a sign should be used only for negative     |
-|         | numbers (this is the default behavior).                    |
-+---------+------------------------------------------------------------+
-| space   | indicates that a leading space should be used on           |
-|         | nonnegative numbers, and a minus sign on negative numbers. |
-+---------+------------------------------------------------------------+
-
-The ``'#'`` option causes the "alternate form" to be used for the
-conversion.  The alternate form is defined differently for different
-types.  This option is only valid for integer and floating-point types.
-For integers, when binary, octal, or hexadecimal output is used, this
-option adds the prefix respective ``"0b"`` (``"0B"``), ``"0"``, or
-``"0x"`` (``"0X"``) to the output value.  Whether the prefix is
-lower-case or upper-case is determined by the case of the type
-specifier, for example, the prefix ``"0x"`` is used for the type ``'x'``
-and ``"0X"`` is used for ``'X'``.  For floating-point numbers the
-alternate form causes the result of the conversion to always contain a
-decimal-point character, even if no digits follow it. Normally, a
-decimal-point character appears in the result of these conversions
-only if a digit follows it. In addition, for ``'g'`` and ``'G'``
-conversions, trailing zeros are not removed from the result.
-
-.. ifconfig:: False
-
-   The ``','`` option signals the use of a comma for a thousands separator.
-   For a locale aware separator, use the ``'L'`` integer presentation type
-   instead.
-
-*width* is a decimal integer defining the minimum field width.  If not
-specified, then the field width will be determined by the content.
-
-Preceding the *width* field by a zero (``'0'``) character enables sign-aware
-zero-padding for numeric types. It forces the padding to be placed after the
-sign or base (if any) but before the digits. This is used for printing fields in
-the form '+000000120'. This option is only valid for numeric types and it has no
-effect on formatting of infinity and NaN.
-
-The *precision* is a decimal number indicating how many digits should be
-displayed after the decimal point for a floating-point value formatted with
-``'f'`` and ``'F'``, or before and after the decimal point for a floating-point
-value formatted with ``'g'`` or ``'G'``.  For non-number types the field
-indicates the maximum field size - in other words, how many characters will be
-used from the field content. The *precision* is not allowed for integer,
-character, Boolean, and pointer values. Note that a C string must be
-null-terminated even if precision is specified.
-
-The ``'L'`` option uses the current locale setting to insert the appropriate
-number separator characters. This option is only valid for numeric types.
-
-Finally, the *type* determines how the data should be presented.
-
-The available string presentation types are:
-
-+---------+----------------------------------------------------------+
-| Type    | Meaning                                                  |
-+=========+==========================================================+
-| ``'s'`` | String format. This is the default type for strings and  |
-|         | may be omitted.                                          |
-+---------+----------------------------------------------------------+
-| ``'?'`` | Debug format. The string is quoted and special           |
-|         | characters escaped.                                      |
-+---------+----------------------------------------------------------+
-| none    | The same as ``'s'``.                                     |
-+---------+----------------------------------------------------------+
-
-The available character presentation types are:
-
-+---------+----------------------------------------------------------+
-| Type    | Meaning                                                  |
-+=========+==========================================================+
-| ``'c'`` | Character format. This is the default type for           |
-|         | characters and may be omitted.                           |
-+---------+----------------------------------------------------------+
-| ``'?'`` | Debug format. The character is quoted and special        |
-|         | characters escaped.                                      |
-+---------+----------------------------------------------------------+
-| none    | The same as ``'c'``.                                     |
-+---------+----------------------------------------------------------+
-
-The available integer presentation types are:
-
-+---------+----------------------------------------------------------+
-| Type    | Meaning                                                  |
-+=========+==========================================================+
-| ``'b'`` | Binary format. Outputs the number in base 2. Using the   |
-|         | ``'#'`` option with this type adds the prefix ``"0b"``   |
-|         | to the output value.                                     |
-+---------+----------------------------------------------------------+
-| ``'B'`` | Binary format. Outputs the number in base 2. Using the   |
-|         | ``'#'`` option with this type adds the prefix ``"0B"``   |
-|         | to the output value.                                     |
-+---------+----------------------------------------------------------+
-| ``'c'`` | Character format. Outputs the number as a character.     |
-+---------+----------------------------------------------------------+
-| ``'d'`` | Decimal integer. Outputs the number in base 10.          |
-+---------+----------------------------------------------------------+
-| ``'o'`` | Octal format. Outputs the number in base 8.              |
-+---------+----------------------------------------------------------+
-| ``'x'`` | Hex format. Outputs the number in base 16, using         |
-|         | lower-case letters for the digits above 9. Using the     |
-|         | ``'#'`` option with this type adds the prefix ``"0x"``   |
-|         | to the output value.                                     |
-+---------+----------------------------------------------------------+
-| ``'X'`` | Hex format. Outputs the number in base 16, using         |
-|         | upper-case letters for the digits above 9. Using the     |
-|         | ``'#'`` option with this type adds the prefix ``"0X"``   |
-|         | to the output value.                                     |
-+---------+----------------------------------------------------------+
-| none    | The same as ``'d'``.                                     |
-+---------+----------------------------------------------------------+
-
-Integer presentation types can also be used with character and Boolean values
-with the only exception that ``'c'`` cannot be used with `bool`. Boolean values
-are formatted using textual representation, either ``true`` or ``false``, if the
-presentation type is not specified.
-
-The available presentation types for floating-point values are:
-
-+---------+----------------------------------------------------------+
-| Type    | Meaning                                                  |
-+=========+==========================================================+
-| ``'a'`` | Hexadecimal floating point format. Prints the number in  |
-|         | base 16 with prefix ``"0x"`` and lower-case letters for  |
-|         | digits above 9. Uses ``'p'`` to indicate the exponent.   |
-+---------+----------------------------------------------------------+
-| ``'A'`` | Same as ``'a'`` except it uses upper-case letters for    |
-|         | the prefix, digits above 9 and to indicate the exponent. |
-+---------+----------------------------------------------------------+
-| ``'e'`` | Exponent notation. Prints the number in scientific       |
-|         | notation using the letter 'e' to indicate the exponent.  |
-+---------+----------------------------------------------------------+
-| ``'E'`` | Exponent notation. Same as ``'e'`` except it uses an     |
-|         | upper-case ``'E'`` as the separator character.           |
-+---------+----------------------------------------------------------+
-| ``'f'`` | Fixed point. Displays the number as a fixed-point        |
-|         | number.                                                  |
-+---------+----------------------------------------------------------+
-| ``'F'`` | Fixed point. Same as ``'f'``, but converts ``nan`` to    |
-|         | ``NAN`` and ``inf`` to ``INF``.                          |
-+---------+----------------------------------------------------------+
-| ``'g'`` | General format.  For a given precision ``p >= 1``,       |
-|         | this rounds the number to ``p`` significant digits and   |
-|         | then formats the result in either fixed-point format     |
-|         | or in scientific notation, depending on its magnitude.   |
-|         |                                                          |
-|         | A precision of ``0`` is treated as equivalent to a       |
-|         | precision of ``1``.                                      |
-+---------+----------------------------------------------------------+
-| ``'G'`` | General format. Same as ``'g'`` except switches to       |
-|         | ``'E'`` if the number gets too large. The                |
-|         | representations of infinity and NaN are uppercased, too. |
-+---------+----------------------------------------------------------+
-| none    | Similar to ``'g'``, except that the default precision is |
-|         | as high as needed to represent the particular value.     |
-+---------+----------------------------------------------------------+
-
-.. ifconfig:: False
-
-   +---------+----------------------------------------------------------+
-   |         | The precise rules are as follows: suppose that the       |
-   |         | result formatted with presentation type ``'e'`` and      |
-   |         | precision ``p-1`` would have exponent ``exp``.  Then     |
-   |         | if ``-4 <= exp < p``, the number is formatted            |
-   |         | with presentation type ``'f'`` and precision             |
-   |         | ``p-1-exp``.  Otherwise, the number is formatted         |
-   |         | with presentation type ``'e'`` and precision ``p-1``.    |
-   |         | In both cases insignificant trailing zeros are removed   |
-   |         | from the significand, and the decimal point is also      |
-   |         | removed if there are no remaining digits following it.   |
-   |         |                                                          |
-   |         | Positive and negative infinity, positive and negative    |
-   |         | zero, and nans, are formatted as ``inf``, ``-inf``,      |
-   |         | ``0``, ``-0`` and ``nan`` respectively, regardless of    |
-   |         | the precision.                                           |
-   |         |                                                          |
-   +---------+----------------------------------------------------------+
-
-The available presentation types for pointers are:
-
-+---------+----------------------------------------------------------+
-| Type    | Meaning                                                  |
-+=========+==========================================================+
-| ``'p'`` | Pointer format. This is the default type for             |
-|         | pointers and may be omitted.                             |
-+---------+----------------------------------------------------------+
-| none    | The same as ``'p'``.                                     |
-+---------+----------------------------------------------------------+
-
-.. _chrono-specs:
-
-Chrono Format Specifications
-============================
-
-Format specifications for chrono duration and time point types as well as
-``std::tm`` have the following syntax:
-
-.. productionlist:: sf
-   chrono_format_spec: [[`fill`]`align`][`width`]["." `precision`][`chrono_specs`]
-   chrono_specs: [`chrono_specs`] `conversion_spec` | `chrono_specs` `literal_char`
-   conversion_spec: "%" [`modifier`] `chrono_type`
-   literal_char: <a character other than '{', '}' or '%'>
-   modifier: "E" | "O"
-   chrono_type: "a" | "A" | "b" | "B" | "c" | "C" | "d" | "D" | "e" | "F" |
-              : "g" | "G" | "h" | "H" | "I" | "j" | "m" | "M" | "n" | "p" |
-              : "q" | "Q" | "r" | "R" | "S" | "t" | "T" | "u" | "U" | "V" |
-              : "w" | "W" | "x" | "X" | "y" | "Y" | "z" | "Z" | "%"
-
-Literal chars are copied unchanged to the output. Precision is valid only for
-``std::chrono::duration`` types with a floating-point representation type.
-
-The available presentation types (*chrono_type*) are:
-
-+---------+--------------------------------------------------------------------+
-| Type    | Meaning                                                            |
-+=========+====================================================================+
-| ``'a'`` | The abbreviated weekday name, e.g. "Sat". If the value does not    |
-|         | contain a valid weekday, an exception of type ``format_error`` is  |
-|         | thrown.                                                            |
-+---------+--------------------------------------------------------------------+
-| ``'A'`` | The full weekday name, e.g. "Saturday". If the value does not      |
-|         | contain a valid weekday, an exception of type ``format_error`` is  |
-|         | thrown.                                                            |
-+---------+--------------------------------------------------------------------+
-| ``'b'`` | The abbreviated month name, e.g. "Nov". If the value does not      |
-|         | contain a valid month, an exception of type ``format_error`` is    |
-|         | thrown.                                                            |
-+---------+--------------------------------------------------------------------+
-| ``'B'`` | The full month name, e.g. "November". If the value does not        |
-|         | contain a valid month, an exception of type ``format_error`` is    |
-|         | thrown.                                                            |
-+---------+--------------------------------------------------------------------+
-| ``'c'`` | The date and time representation, e.g. "Sat Nov 12 22:04:00 1955". |
-|         | The modified command ``%Ec`` produces the locale's alternate date  |
-|         | and time representation.                                           |
-+---------+--------------------------------------------------------------------+
-| ``'C'`` | The year divided by 100 using floored division, e.g. "55". If the  |
-|         | result is a single decimal digit, it is prefixed with 0.           |
-|         | The modified command ``%EC`` produces the locale's alternative     |
-|         | representation of the century.                                     |
-+---------+--------------------------------------------------------------------+
-| ``'d'`` | The day of month as a decimal number. If the result is a single    |
-|         | decimal digit, it is prefixed with 0. The modified command ``%Od`` |
-|         | produces the locale's alternative representation.                  |
-+---------+--------------------------------------------------------------------+
-| ``'D'`` | Equivalent to ``%m/%d/%y``, e.g. "11/12/55".                       |
-+---------+--------------------------------------------------------------------+
-| ``'e'`` | The day of month as a decimal number. If the result is a single    |
-|         | decimal digit, it is prefixed with a space. The modified command   |
-|         | ``%Oe`` produces the locale's alternative representation.          |
-+---------+--------------------------------------------------------------------+
-| ``'F'`` | Equivalent to ``%Y-%m-%d``, e.g. "1955-11-12".                     |
-+---------+--------------------------------------------------------------------+
-| ``'g'`` | The last two decimal digits of the ISO week-based year. If the     |
-|         | result is a single digit it is prefixed by 0.                      |
-+---------+--------------------------------------------------------------------+
-| ``'G'`` | The ISO week-based year as a decimal number. If the result is less |
-|         | than four digits it is left-padded with 0 to four digits.          |
-+---------+--------------------------------------------------------------------+
-| ``'h'`` | Equivalent to ``%b``, e.g. "Nov".                                  |
-+---------+--------------------------------------------------------------------+
-| ``'H'`` | The hour (24-hour clock) as a decimal number. If the result is a   |
-|         | single digit, it is prefixed with 0. The modified command ``%OH``  |
-|         | produces the locale's alternative representation.                  |
-+---------+--------------------------------------------------------------------+
-| ``'I'`` | The hour (12-hour clock) as a decimal number. If the result is a   |
-|         | single digit, it is prefixed with 0. The modified command ``%OI``  |
-|         | produces the locale's alternative representation.                  |
-+---------+--------------------------------------------------------------------+
-| ``'j'`` | If the type being formatted is a specialization of duration, the   |
-|         | decimal number of days without padding. Otherwise, the day of the  |
-|         | year as a decimal number. Jan 1 is 001. If the result is less than |
-|         | three digits, it is left-padded with 0 to three digits.            |
-+---------+--------------------------------------------------------------------+
-| ``'m'`` | The month as a decimal number. Jan is 01. If the result is a       |
-|         | single digit, it is prefixed with 0. The modified command ``%Om``  |
-|         | produces the locale's alternative representation.                  |
-+---------+--------------------------------------------------------------------+
-| ``'M'`` | The minute as a decimal number. If the result is a single digit,   |
-|         | it is prefixed with 0. The modified command ``%OM`` produces the   |
-|         | locale's alternative representation.                               |
-+---------+--------------------------------------------------------------------+
-| ``'n'`` | A new-line character.                                              |
-+---------+--------------------------------------------------------------------+
-| ``'p'`` | The AM/PM designations associated with a 12-hour clock.            |
-+---------+--------------------------------------------------------------------+
-| ``'q'`` | The duration's unit suffix.                                        |
-+---------+--------------------------------------------------------------------+
-| ``'Q'`` | The duration's numeric value (as if extracted via ``.count()``).   |
-+---------+--------------------------------------------------------------------+
-| ``'r'`` | The 12-hour clock time, e.g. "10:04:00 PM".                        |
-+---------+--------------------------------------------------------------------+
-| ``'R'`` | Equivalent to ``%H:%M``, e.g. "22:04".                             |
-+---------+--------------------------------------------------------------------+
-| ``'S'`` | Seconds as a decimal number. If the number of seconds is less than |
-|         | 10, the result is prefixed with 0. If the precision of the input   |
-|         | cannot be exactly represented with seconds, then the format is a   |
-|         | decimal floating-point number with a fixed format and a precision  |
-|         | matching that of the precision of the input (or to a microseconds  |
-|         | precision if the conversion to floating-point decimal seconds      |
-|         | cannot be made within 18 fractional digits). The character for the |
-|         | decimal point is localized according to the locale. The modified   |
-|         | command ``%OS`` produces the locale's alternative representation.  |
-+---------+--------------------------------------------------------------------+
-| ``'t'`` | A horizontal-tab character.                                        |
-+---------+--------------------------------------------------------------------+
-| ``'T'`` | Equivalent to ``%H:%M:%S``.                                        |
-+---------+--------------------------------------------------------------------+
-| ``'u'`` | The ISO weekday as a decimal number (1-7), where Monday is 1. The  |
-|         | modified command ``%Ou`` produces the locale's alternative         |
-|         | representation.                                                    |
-+---------+--------------------------------------------------------------------+
-| ``'U'`` | The week number of the year as a decimal number. The first Sunday  |
-|         | of the year is the first day of week 01. Days of the same year     |
-|         | prior to that are in week 00. If the result is a single digit, it  |
-|         | is prefixed with 0. The modified command ``%OU`` produces the      |
-|         | locale's alternative representation.                               |
-+---------+--------------------------------------------------------------------+
-| ``'V'`` | The ISO week-based week number as a decimal number. If the result  |
-|         | is a single digit, it is prefixed with 0. The modified command     |
-|         | ``%OV`` produces the locale's alternative representation.          |
-+---------+--------------------------------------------------------------------+
-| ``'w'`` | The weekday as a decimal number (0-6), where Sunday is 0.          |
-|         | The modified command ``%Ow`` produces the locale's alternative     |
-|         | representation.                                                    |
-+---------+--------------------------------------------------------------------+
-| ``'W'`` | The week number of the year as a decimal number. The first Monday  |
-|         | of the year is the first day of week 01. Days of the same year     |
-|         | prior to that are in week 00. If the result is a single digit, it  |
-|         | is prefixed with 0. The modified command ``%OW`` produces the      |
-|         | locale's alternative representation.                               |
-+---------+--------------------------------------------------------------------+
-| ``'x'`` | The date representation, e.g. "11/12/55". The modified command     |
-|         | ``%Ex`` produces the locale's alternate date representation.       |
-+---------+--------------------------------------------------------------------+
-| ``'X'`` | The time representation, e.g. "10:04:00". The modified command     |
-|         | ``%EX`` produces the locale's alternate time representation.       |
-+---------+--------------------------------------------------------------------+
-| ``'y'`` | The last two decimal digits of the year. If the result is a single |
-|         | digit it is prefixed by 0. The modified command ``%Oy`` produces   |
-|         | the locale's alternative representation. The modified command      |
-|         | ``%Ey`` produces the locale's alternative representation of offset |
-|         | from ``%EC`` (year only).                                          |
-+---------+--------------------------------------------------------------------+
-| ``'Y'`` | The year as a decimal number. If the result is less than four      |
-|         | digits it is left-padded with 0 to four digits. The modified       |
-|         | command ``%EY`` produces the locale's alternative full year        |
-|         | representation.                                                    |
-+---------+--------------------------------------------------------------------+
-| ``'z'`` | The offset from UTC in the ISO 8601:2004 format. For example -0430 |
-|         | refers to 4 hours 30 minutes behind UTC. If the offset is zero,    |
-|         | +0000 is used. The modified commands ``%Ez`` and ``%Oz`` insert a  |
-|         | ``:`` between the hours and minutes: -04:30. If the offset         |
-|         | information is not available, an exception of type                 |
-|         | ``format_error`` is thrown.                                        |
-+---------+--------------------------------------------------------------------+
-| ``'Z'`` | The time zone abbreviation. If the time zone abbreviation is not   |
-|         | available, an exception of type ``format_error`` is thrown.        |
-+---------+--------------------------------------------------------------------+
-| ``'%'`` | A % character.                                                     |
-+---------+--------------------------------------------------------------------+
-
-Specifiers that have a calendaric component such as ``'d'`` (the day of month)
-are valid only for ``std::tm`` and time points but not durations.
-
-.. range-specs:
-
-Range Format Specifications
-===========================
-
-Format specifications for range types have the following syntax:
-
-.. productionlist:: sf
-   range_format_spec: [":" [`underlying_spec`]]
-
-The `underlying_spec` is parsed based on the formatter of the range's
-reference type.
-
-By default, a range of characters or strings is printed escaped and quoted. But
-if any `underlying_spec` is provided (even if it is empty), then the characters
-or strings are printed according to the provided specification.
-
-Examples::
-
-  fmt::format("{}", std::vector{10, 20, 30});
-  // Result: [10, 20, 30]
-  fmt::format("{::#x}", std::vector{10, 20, 30});
-  // Result: [0xa, 0x14, 0x1e]
-  fmt::format("{}", vector{'h', 'e', 'l', 'l', 'o'});
-  // Result: ['h', 'e', 'l', 'l', 'o']
-  fmt::format("{::}", vector{'h', 'e', 'l', 'l', 'o'});
-  // Result: [h, e, l, l, o]
-  fmt::format("{::d}", vector{'h', 'e', 'l', 'l', 'o'});
-  // Result: [104, 101, 108, 108, 111]
-
-.. _formatexamples:
-
-Format Examples
-===============
-
-This section contains examples of the format syntax and comparison with
-the printf formatting.
-
-In most of the cases the syntax is similar to the printf formatting, with the
-addition of the ``{}`` and with ``:`` used instead of ``%``.
-For example, ``"%03.2f"`` can be translated to ``"{:03.2f}"``.
-
-The new format syntax also supports new and different options, shown in the
-following examples.
-
-Accessing arguments by position::
-
-   fmt::format("{0}, {1}, {2}", 'a', 'b', 'c');
-   // Result: "a, b, c"
-   fmt::format("{}, {}, {}", 'a', 'b', 'c');
-   // Result: "a, b, c"
-   fmt::format("{2}, {1}, {0}", 'a', 'b', 'c');
-   // Result: "c, b, a"
-   fmt::format("{0}{1}{0}", "abra", "cad");  // arguments' indices can be repeated
-   // Result: "abracadabra"
-
-Aligning the text and specifying a width::
-
-   fmt::format("{:<30}", "left aligned");
-   // Result: "left aligned                  "
-   fmt::format("{:>30}", "right aligned");
-   // Result: "                 right aligned"
-   fmt::format("{:^30}", "centered");
-   // Result: "           centered           "
-   fmt::format("{:*^30}", "centered");  // use '*' as a fill char
-   // Result: "***********centered***********"
-
-Dynamic width::
-
-   fmt::format("{:<{}}", "left aligned", 30);
-   // Result: "left aligned                  "
-
-Dynamic precision::
-
-   fmt::format("{:.{}f}", 3.14, 1);
-   // Result: "3.1"
-
-Replacing ``%+f``, ``%-f``, and ``% f`` and specifying a sign::
-
-   fmt::format("{:+f}; {:+f}", 3.14, -3.14);  // show it always
-   // Result: "+3.140000; -3.140000"
-   fmt::format("{: f}; {: f}", 3.14, -3.14);  // show a space for positive numbers
-   // Result: " 3.140000; -3.140000"
-   fmt::format("{:-f}; {:-f}", 3.14, -3.14);  // show only the minus -- same as '{:f}; {:f}'
-   // Result: "3.140000; -3.140000"
-
-Replacing ``%x`` and ``%o`` and converting the value to different bases::
-
-   fmt::format("int: {0:d};  hex: {0:x};  oct: {0:o}; bin: {0:b}", 42);
-   // Result: "int: 42;  hex: 2a;  oct: 52; bin: 101010"
-   // with 0x or 0 or 0b as prefix:
-   fmt::format("int: {0:d};  hex: {0:#x};  oct: {0:#o};  bin: {0:#b}", 42);
-   // Result: "int: 42;  hex: 0x2a;  oct: 052;  bin: 0b101010"
-
-Padded hex byte with prefix and always prints both hex characters::
-
-   fmt::format("{:#04x}", 0);
-   // Result: "0x00"
-
-Box drawing using Unicode fill::
-
-   fmt::print(
-     "{0:^{2}}\n"
-     "{1: ^{2}}\n"
-     "{0:^{2}}\n", "", "Hello, world!", 20);
-
-prints::
-
-   
-      Hello, world!    
-   
-
-Using type-specific formatting::
-
-   #include <fmt/chrono.h>
-
-   auto t = tm();
-   t.tm_year = 2010 - 1900;
-   t.tm_mon = 7;
-   t.tm_mday = 4;
-   t.tm_hour = 12;
-   t.tm_min = 15;
-   t.tm_sec = 58;
-   fmt::print("{:%Y-%m-%d %H:%M:%S}", t);
-   // Prints: 2010-08-04 12:15:58
-
-Using the comma as a thousands separator::
-
-   #include <fmt/format.h>
-
-   auto s = fmt::format(std::locale("en_US.UTF-8"), "{:L}", 1234567890);
-   // s == "1,234,567,890"
-
-.. ifconfig:: False
-
-   Nesting arguments and more complex examples::
-
-      >>> for align, text in zip('<^>', ['left', 'center', 'right']):
-      ...     '{0:{fill}{align}16}") << text, fill=align, align=align)
-      ...
-      'left<<<<<<<<<<<<'
-      '^^^^^center^^^^^'
-      '>>>>>>>>>>>right'
-      >>>
-      >>> octets = [192, 168, 0, 1]
-      Format("{:02X}{:02X}{:02X}{:02X}") << *octets)
-      'C0A80001'
-      >>> int(_, 16)
-      3232235521
-      >>>
-      >>> width = 5
-      >>> for num in range(5,12):
-      ...     for base in 'dXob':
-      ...         print('{0:{width}{base}}") << num, base=base, width=width), end=' ')
-      ...     print()
-      ...
-          5     5     5   101
-          6     6     6   110
-          7     7     7   111
-          8     8    10  1000
-          9     9    11  1001
-         10     A    12  1010
-         11     B    13  1011
diff --git a/doc/usage.rst b/doc/usage.rst
deleted file mode 100644
index 717fd1cd..00000000
--- a/doc/usage.rst
+++ /dev/null
@@ -1,250 +0,0 @@
-*****
-Usage
-*****
-
-To use the {fmt} library, add :file:`fmt/core.h`, :file:`fmt/format.h`,
-:file:`fmt/format-inl.h`, :file:`src/format.cc` and optionally other headers
-from a `release archive <https://github.com/fmtlib/fmt/releases/latest>`_ or
-the `Git repository <https://github.com/fmtlib/fmt>`_ to your project.
-Alternatively, you can :ref:`build the library with CMake <building>`.
-
-.. _building:
-
-Building the Library
-====================
-
-The included `CMake build script`__ can be used to build the fmt
-library on a wide range of platforms. CMake is freely available for
-download from https://www.cmake.org/download/.
-
-__ https://github.com/fmtlib/fmt/blob/master/CMakeLists.txt
-
-CMake works by generating native makefiles or project files that can
-be used in the compiler environment of your choice. The typical
-workflow starts with::
-
-  mkdir build          # Create a directory to hold the build output.
-  cd build
-  cmake ..  # Generate native build scripts.
-
-where :file:`{<path/to/fmt>}` is a path to the ``fmt`` repository.
-
-If you are on a \*nix system, you should now see a Makefile in the
-current directory. Now you can build the library by running :command:`make`.
-
-Once the library has been built you can invoke :command:`make test` to run
-the tests.
-
-You can control generation of the make ``test`` target with the ``FMT_TEST``
-CMake option. This can be useful if you include fmt as a subdirectory in
-your project but don't want to add fmt's tests to your ``test`` target.
-
-If you use Windows and have Visual Studio installed, a :file:`FMT.sln`
-file and several :file:`.vcproj` files will be created. You can then build them
-using Visual Studio or msbuild.
-
-On Mac OS X with Xcode installed, an :file:`.xcodeproj` file will be generated.
-
-To build a `shared library`__ set the ``BUILD_SHARED_LIBS`` CMake variable to
-``TRUE``::
-
-  cmake -DBUILD_SHARED_LIBS=TRUE ...
-
-__ https://en.wikipedia.org/wiki/Library_%28computing%29#Shared_libraries
-
-
-To build a `static library` with position independent code (required if the main
-consumer of the fmt library is a shared library i.e. a Python extension) set the
-``CMAKE_POSITION_INDEPENDENT_CODE`` CMake variable to ``TRUE``::
-
-  cmake -DCMAKE_POSITION_INDEPENDENT_CODE=TRUE ...
-
-
-Installing the Library
-======================
-
-After building the library you can install it on a Unix-like system by running
-:command:`sudo make install`.
-
-Usage with CMake
-================
-
-You can add the ``fmt`` library directory into your project and include it in
-your ``CMakeLists.txt`` file::
-
-   add_subdirectory(fmt)
-
-or
-
-::
-
-   add_subdirectory(fmt EXCLUDE_FROM_ALL)
-
-to exclude it from ``make``, ``make all``, or ``cmake --build .``.
-
-You can detect and use an installed version of {fmt} as follows::
-
-   find_package(fmt)
-   target_link_libraries(<your-target> fmt::fmt)
-
-Setting up your target to use a header-only version of ``fmt`` is equally easy::
-
-   target_link_libraries(<your-target> PRIVATE fmt::fmt-header-only)
-
-Usage with build2
-=================
-
-You can use `build2 <https://build2.org>`_, a dependency manager and a
-build-system combined, to use ``fmt``.
-
-Currently this package is available in these package repositories:
-
-- **https://cppget.org/fmt/** for released and published versions.
-- `The git repository with the sources of the build2 package of fmt <https://github.com/build2-packaging/fmt.git>`_
-  for unreleased or custom revisions of ``fmt``.
-
-**Usage:**
-
-- ``build2`` package name: ``fmt``
-- Library target name : ``lib{fmt}``
-
-For example, to make your ``build2`` project depend on ``fmt``:
-
-- Add one of the repositories to your configurations, or in your
-  ``repositories.manifest``, if not already there::
-
-    :
-    role: prerequisite
-    location: https://pkg.cppget.org/1/stable
-
-- Add this package as a dependency to your ``./manifest`` file
-  (example for ``v7.0.x``)::
-
-    depends: fmt ~7.0.0
-
-- Import the target and use it as a prerequisite to your own target
-  using `fmt` in the appropriate ``buildfile``::
-
-    import fmt = fmt%lib{fmt}
-    lib{mylib} : cxx{**} ... $fmt
-
-Then build your project as usual with `b` or `bdep update`.
-
-For ``build2`` newcomers or to get more details and use cases, you can read the
-``build2``
-`toolchain introduction <https://build2.org/build2-toolchain/doc/build2-toolchain-intro.xhtml>`_.
-
-Usage with Meson
-================
-
-`Meson's WrapDB <https://mesonbuild.com/Wrapdb-projects.html>` includes a ``fmt``
-package, which repackages fmt to be built by Meson as a subproject.
-
-**Usage:**
-
-- Install the ``fmt`` subproject from the WrapDB by running::
-
-    meson wrap install fmt
-
-  from the root of your project.
-
-- In your project's ``meson.build`` file, add an entry for the new subproject::
-
-    fmt = subproject('fmt')
-    fmt_dep = fmt.get_variable('fmt_dep')
-
-- Include the new dependency object to link with fmt::
-
-    my_build_target = executable('name', 'src/main.cc', dependencies: [fmt_dep])
-
-**Options:**
-
-If desired, ``fmt`` may be built as a static library, or as a header-only
-library.
-
-For a static build, use the following subproject definition::
-
-  fmt = subproject('fmt', default_options: 'default_library=static')
-  fmt_dep = fmt.get_variable('fmt_dep')
-
-For the header-only version, use::
-
-  fmt = subproject('fmt')
-  fmt_dep = fmt.get_variable('fmt_header_only_dep')
-
-Building the Documentation
-==========================
-
-To build the documentation you need the following software installed on your
-system:
-
-* `Python <https://www.python.org/>`_ with pip and virtualenv
-* `Doxygen <http://www.stack.nl/~dimitri/doxygen/>`_
-* `Less <http://lesscss.org/>`_ with ``less-plugin-clean-css``.
-  Ubuntu doesn't package the ``clean-css`` plugin so you should use ``npm``
-  instead of ``apt`` to install both ``less`` and the plugin::
-
-    sudo npm install -g less less-plugin-clean-css.
-
-First generate makefiles or project files using CMake as described in
-the previous section. Then compile the ``doc`` target/project, for example::
-
-  make doc
-
-This will generate the HTML documentation in ``doc/html``.
-
-Conda
-=====
-
-fmt can be installed on Linux, macOS and Windows with
-`Conda <https://docs.conda.io/en/latest/>`__, using its
-`conda-forge <https://conda-forge.org>`__
-`package <https://github.com/conda-forge/fmt-feedstock>`__, as follows::
-
-  conda install -c conda-forge fmt
-
-Vcpkg
-=====
-
-You can download and install fmt using the `vcpkg
-<https://github.com/Microsoft/vcpkg>`__ dependency manager::
-
-  git clone https://github.com/Microsoft/vcpkg.git
-  cd vcpkg
-  ./bootstrap-vcpkg.sh
-  ./vcpkg integrate install
-  ./vcpkg install fmt
-
-The fmt port in vcpkg is kept up to date by Microsoft team members and community
-contributors. If the version is out of date, please `create an issue or pull
-request <https://github.com/Microsoft/vcpkg>`__ on the vcpkg repository.
-
-LHelper
-=======
-
-You can download and install fmt using
-`lhelper <https://github.com/franko/lhelper>`__ dependency manager::
-
-  lhelper activate <some-environment>
-  lhelper install fmt
-
-All the recipes for lhelper are kept in the
-`lhelper's recipe <https://github.com/franko/lhelper-recipes>`__ repository.
-
-Android NDK
-===========
-
-fmt provides `Android.mk file`__ that can be used to build the library
-with `Android NDK <https://developer.android.com/tools/sdk/ndk/index.html>`_.
-For an example of using fmt with Android NDK, see the
-`android-ndk-example <https://github.com/fmtlib/android-ndk-example>`_
-repository.
-
-__ https://github.com/fmtlib/fmt/blob/master/support/Android.mk
-
-Homebrew
-========
-
-fmt can be installed on OS X using `Homebrew <https://brew.sh/>`_::
-
-  brew install fmt
diff --git a/include/fmt/args.h b/include/fmt/args.h
index ad1654bb..6ed30c0b 100644
--- a/include/fmt/args.h
+++ b/include/fmt/args.h
@@ -8,14 +8,15 @@
 #ifndef FMT_ARGS_H_
 #define FMT_ARGS_H_
 
-#include <functional>  // std::reference_wrapper
-#include <memory>      // std::unique_ptr
-#include <vector>
+#ifndef FMT_MODULE
+#  include <functional>  // std::reference_wrapper
+#  include <memory>      // std::unique_ptr
+#  include <vector>
+#endif
 
-#include "core.h"
+#include "format.h"  // std_string_view
 
 FMT_BEGIN_NAMESPACE
-
 namespace detail {
 
 template <typename T> struct is_reference_wrapper : std::false_type {};
@@ -28,15 +29,18 @@ auto unwrap(const std::reference_wrapper<T>& v) -> const T& {
   return static_cast<const T&>(v);
 }
 
-class dynamic_arg_list {
-  // Workaround for clang's -Wweak-vtables. Unlike for regular classes, for
-  // templates it doesn't complain about inability to deduce single translation
-  // unit for placing vtable. So storage_node_base is made a fake template.
-  template <typename = void> struct node {
-    virtual ~node() = default;
-    std::unique_ptr<node<>> next;
-  };
+// node is defined outside dynamic_arg_list to workaround a C2504 bug in MSVC
+// 2022 (v17.10.0).
+//
+// Workaround for clang's -Wweak-vtables. Unlike for regular classes, for
+// templates it doesn't complain about inability to deduce single translation
+// unit for placing vtable. So node is made a fake template.
+template <typename = void> struct node {
+  virtual ~node() = default;
+  std::unique_ptr<node<>> next;
+};
 
+class dynamic_arg_list {
   template <typename T> struct typed_node : node<> {
     T value;
 
@@ -62,28 +66,18 @@ class dynamic_arg_list {
 }  // namespace detail
 
 /**
-  \rst
-  A dynamic version of `fmt::format_arg_store`.
-  It's equipped with a storage to potentially temporary objects which lifetimes
-  could be shorter than the format arguments object.
-
-  It can be implicitly converted into `~fmt::basic_format_args` for passing
-  into type-erased formatting functions such as `~fmt::vformat`.
-  \endrst
+ * A dynamic list of formatting arguments with storage.
+ *
+ * It can be implicitly converted into `fmt::basic_format_args` for passing
+ * into type-erased formatting functions such as `fmt::vformat`.
  */
-template <typename Context>
-class dynamic_format_arg_store
-#if FMT_GCC_VERSION && FMT_GCC_VERSION < 409
-    // Workaround a GCC template argument substitution bug.
-    : public basic_format_args<Context>
-#endif
-{
+template <typename Context> class dynamic_format_arg_store {
  private:
   using char_type = typename Context::char_type;
 
   template <typename T> struct need_copy {
     static constexpr detail::type mapped_type =
-        detail::mapped_type_constant<T, Context>::value;
+        detail::mapped_type_constant<T, char_type>::value;
 
     enum {
       value = !(detail::is_reference_wrapper<T>::value ||
@@ -96,7 +90,7 @@ class dynamic_format_arg_store
   };
 
   template <typename T>
-  using stored_type = conditional_t<
+  using stored_t = conditional_t<
       std::is_convertible<T, std::basic_string<char_type>>::value &&
           !detail::is_reference_wrapper<T>::value,
       std::basic_string<char_type>, T>;
@@ -111,80 +105,72 @@ class dynamic_format_arg_store
 
   friend class basic_format_args<Context>;
 
-  auto get_types() const -> unsigned long long {
-    return detail::is_unpacked_bit | data_.size() |
-           (named_info_.empty()
-                ? 0ULL
-                : static_cast<unsigned long long>(detail::has_named_args_bit));
-  }
-
   auto data() const -> const basic_format_arg<Context>* {
     return named_info_.empty() ? data_.data() : data_.data() + 1;
   }
 
   template <typename T> void emplace_arg(const T& arg) {
-    data_.emplace_back(detail::make_arg<Context>(arg));
+    data_.emplace_back(arg);
   }
 
   template <typename T>
   void emplace_arg(const detail::named_arg<char_type, T>& arg) {
-    if (named_info_.empty()) {
-      constexpr const detail::named_arg_info<char_type>* zero_ptr{nullptr};
-      data_.insert(data_.begin(), {zero_ptr, 0});
-    }
-    data_.emplace_back(detail::make_arg<Context>(detail::unwrap(arg.value)));
+    if (named_info_.empty())
+      data_.insert(data_.begin(), basic_format_arg<Context>(nullptr, 0));
+    data_.emplace_back(detail::unwrap(arg.value));
     auto pop_one = [](std::vector<basic_format_arg<Context>>* data) {
       data->pop_back();
     };
     std::unique_ptr<std::vector<basic_format_arg<Context>>, decltype(pop_one)>
         guard{&data_, pop_one};
     named_info_.push_back({arg.name, static_cast<int>(data_.size() - 2u)});
-    data_[0].value_.named_args = {named_info_.data(), named_info_.size()};
+    data_[0] = {named_info_.data(), named_info_.size()};
     guard.release();
   }
 
  public:
   constexpr dynamic_format_arg_store() = default;
 
+  operator basic_format_args<Context>() const {
+    return basic_format_args<Context>(data(), static_cast<int>(data_.size()),
+                                      !named_info_.empty());
+  }
+
   /**
-    \rst
-    Adds an argument into the dynamic store for later passing to a formatting
-    function.
-
-    Note that custom types and string types (but not string views) are copied
-    into the store dynamically allocating memory if necessary.
-
-    **Example**::
-
-      fmt::dynamic_format_arg_store<fmt::format_context> store;
-      store.push_back(42);
-      store.push_back("abc");
-      store.push_back(1.5f);
-      std::string result = fmt::vformat("{} and {} and {}", store);
-    \endrst
-  */
+   * Adds an argument into the dynamic store for later passing to a formatting
+   * function.
+   *
+   * Note that custom types and string types (but not string views) are copied
+   * into the store dynamically allocating memory if necessary.
+   *
+   * **Example**:
+   *
+   *     fmt::dynamic_format_arg_store<fmt::format_context> store;
+   *     store.push_back(42);
+   *     store.push_back("abc");
+   *     store.push_back(1.5f);
+   *     std::string result = fmt::vformat("{} and {} and {}", store);
+   */
   template <typename T> void push_back(const T& arg) {
     if (detail::const_check(need_copy<T>::value))
-      emplace_arg(dynamic_args_.push<stored_type<T>>(arg));
+      emplace_arg(dynamic_args_.push<stored_t<T>>(arg));
     else
       emplace_arg(detail::unwrap(arg));
   }
 
   /**
-    \rst
-    Adds a reference to the argument into the dynamic store for later passing to
-    a formatting function.
-
-    **Example**::
-
-      fmt::dynamic_format_arg_store<fmt::format_context> store;
-      char band[] = "Rolling Stones";
-      store.push_back(std::cref(band));
-      band[9] = 'c'; // Changing str affects the output.
-      std::string result = fmt::vformat("{}", store);
-      // result == "Rolling Scones"
-    \endrst
-  */
+   * Adds a reference to the argument into the dynamic store for later passing
+   * to a formatting function.
+   *
+   * **Example**:
+   *
+   *     fmt::dynamic_format_arg_store<fmt::format_context> store;
+   *     char band[] = "Rolling Stones";
+   *     store.push_back(std::cref(band));
+   *     band[9] = 'c'; // Changing str affects the output.
+   *     std::string result = fmt::vformat("{}", store);
+   *     // result == "Rolling Scones"
+   */
   template <typename T> void push_back(std::reference_wrapper<T> arg) {
     static_assert(
         need_copy<T>::value,
@@ -193,38 +179,34 @@ class dynamic_format_arg_store
   }
 
   /**
-    Adds named argument into the dynamic store for later passing to a formatting
-    function. ``std::reference_wrapper`` is supported to avoid copying of the
-    argument. The name is always copied into the store.
-  */
+   * Adds named argument into the dynamic store for later passing to a
+   * formatting function. `std::reference_wrapper` is supported to avoid
+   * copying of the argument. The name is always copied into the store.
+   */
   template <typename T>
   void push_back(const detail::named_arg<char_type, T>& arg) {
     const char_type* arg_name =
         dynamic_args_.push<std::basic_string<char_type>>(arg.name).c_str();
     if (detail::const_check(need_copy<T>::value)) {
       emplace_arg(
-          fmt::arg(arg_name, dynamic_args_.push<stored_type<T>>(arg.value)));
+          fmt::arg(arg_name, dynamic_args_.push<stored_t<T>>(arg.value)));
     } else {
       emplace_arg(fmt::arg(arg_name, arg.value));
     }
   }
 
-  /** Erase all elements from the store */
+  /// Erase all elements from the store.
   void clear() {
     data_.clear();
     named_info_.clear();
-    dynamic_args_ = detail::dynamic_arg_list();
+    dynamic_args_ = {};
   }
 
-  /**
-    \rst
-    Reserves space to store at least *new_cap* arguments including
-    *new_cap_named* named arguments.
-    \endrst
-  */
+  /// Reserves space to store at least `new_cap` arguments including
+  /// `new_cap_named` named arguments.
   void reserve(size_t new_cap, size_t new_cap_named) {
     FMT_ASSERT(new_cap >= new_cap_named,
-               "Set of arguments includes set of named arguments");
+               "set of arguments includes set of named arguments");
     data_.reserve(new_cap);
     named_info_.reserve(new_cap_named);
   }
diff --git a/include/fmt/base.h b/include/fmt/base.h
new file mode 100644
index 00000000..21444176
--- /dev/null
+++ b/include/fmt/base.h
@@ -0,0 +1,2906 @@
+// Formatting library for C++ - the base API for char/UTF-8
+//
+// Copyright (c) 2012 - present, Victor Zverovich
+// All rights reserved.
+//
+// For the license information refer to format.h.
+
+#ifndef FMT_BASE_H_
+#define FMT_BASE_H_
+
+#if defined(FMT_IMPORT_STD) && !defined(FMT_MODULE)
+#  define FMT_MODULE
+#endif
+
+#ifndef FMT_MODULE
+#  include <limits.h>  // CHAR_BIT
+#  include <stdio.h>   // FILE
+#  include <string.h>  // memcmp
+
+#  include <type_traits>  // std::enable_if
+#endif
+
+// The fmt library version in the form major * 10000 + minor * 100 + patch.
+#define FMT_VERSION 110002
+
+// Detect compiler versions.
+#if defined(__clang__) && !defined(__ibmxl__)
+#  define FMT_CLANG_VERSION (__clang_major__ * 100 + __clang_minor__)
+#else
+#  define FMT_CLANG_VERSION 0
+#endif
+#if defined(__GNUC__) && !defined(__clang__) && !defined(__INTEL_COMPILER)
+#  define FMT_GCC_VERSION (__GNUC__ * 100 + __GNUC_MINOR__)
+#else
+#  define FMT_GCC_VERSION 0
+#endif
+#if defined(__ICL)
+#  define FMT_ICC_VERSION __ICL
+#elif defined(__INTEL_COMPILER)
+#  define FMT_ICC_VERSION __INTEL_COMPILER
+#else
+#  define FMT_ICC_VERSION 0
+#endif
+#if defined(_MSC_VER)
+#  define FMT_MSC_VERSION _MSC_VER
+#else
+#  define FMT_MSC_VERSION 0
+#endif
+
+// Detect standard library versions.
+#ifdef _GLIBCXX_RELEASE
+#  define FMT_GLIBCXX_RELEASE _GLIBCXX_RELEASE
+#else
+#  define FMT_GLIBCXX_RELEASE 0
+#endif
+#ifdef _LIBCPP_VERSION
+#  define FMT_LIBCPP_VERSION _LIBCPP_VERSION
+#else
+#  define FMT_LIBCPP_VERSION 0
+#endif
+
+#ifdef _MSVC_LANG
+#  define FMT_CPLUSPLUS _MSVC_LANG
+#else
+#  define FMT_CPLUSPLUS __cplusplus
+#endif
+
+// Detect __has_*.
+#ifdef __has_feature
+#  define FMT_HAS_FEATURE(x) __has_feature(x)
+#else
+#  define FMT_HAS_FEATURE(x) 0
+#endif
+#ifdef __has_include
+#  define FMT_HAS_INCLUDE(x) __has_include(x)
+#else
+#  define FMT_HAS_INCLUDE(x) 0
+#endif
+#ifdef __has_builtin
+#  define FMT_HAS_BUILTIN(x) __has_builtin(x)
+#else
+#  define FMT_HAS_BUILTIN(x) 0
+#endif
+#ifdef __has_cpp_attribute
+#  define FMT_HAS_CPP_ATTRIBUTE(x) __has_cpp_attribute(x)
+#else
+#  define FMT_HAS_CPP_ATTRIBUTE(x) 0
+#endif
+
+#define FMT_HAS_CPP14_ATTRIBUTE(attribute) \
+  (FMT_CPLUSPLUS >= 201402L && FMT_HAS_CPP_ATTRIBUTE(attribute))
+
+#define FMT_HAS_CPP17_ATTRIBUTE(attribute) \
+  (FMT_CPLUSPLUS >= 201703L && FMT_HAS_CPP_ATTRIBUTE(attribute))
+
+// Detect C++14 relaxed constexpr.
+#ifdef FMT_USE_CONSTEXPR
+// Use the provided definition.
+#elif FMT_GCC_VERSION >= 600 && FMT_CPLUSPLUS >= 201402L
+// GCC only allows throw in constexpr since version 6:
+// https://gcc.gnu.org/bugzilla/show_bug.cgi?id=67371.
+#  define FMT_USE_CONSTEXPR 1
+#elif FMT_ICC_VERSION
+#  define FMT_USE_CONSTEXPR 0  // https://github.com/fmtlib/fmt/issues/1628
+#elif FMT_HAS_FEATURE(cxx_relaxed_constexpr) || FMT_MSC_VERSION >= 1912
+#  define FMT_USE_CONSTEXPR 1
+#else
+#  define FMT_USE_CONSTEXPR 0
+#endif
+#if FMT_USE_CONSTEXPR
+#  define FMT_CONSTEXPR constexpr
+#else
+#  define FMT_CONSTEXPR
+#endif
+
+// Detect consteval, C++20 constexpr extensions and std::is_constant_evaluated.
+#if !defined(__cpp_lib_is_constant_evaluated)
+#  define FMT_USE_CONSTEVAL 0
+#elif FMT_CPLUSPLUS < 201709L
+#  define FMT_USE_CONSTEVAL 0
+#elif FMT_GLIBCXX_RELEASE && FMT_GLIBCXX_RELEASE < 10
+#  define FMT_USE_CONSTEVAL 0
+#elif FMT_LIBCPP_VERSION && FMT_LIBCPP_VERSION < 10000
+#  define FMT_USE_CONSTEVAL 0
+#elif defined(__apple_build_version__) && __apple_build_version__ < 14000029L
+#  define FMT_USE_CONSTEVAL 0  // consteval is broken in Apple clang < 14.
+#elif FMT_MSC_VERSION && FMT_MSC_VERSION < 1929
+#  define FMT_USE_CONSTEVAL 0  // consteval is broken in MSVC VS2019 < 16.10.
+#elif defined(__cpp_consteval)
+#  define FMT_USE_CONSTEVAL 1
+#elif FMT_GCC_VERSION >= 1002 || FMT_CLANG_VERSION >= 1101
+#  define FMT_USE_CONSTEVAL 1
+#else
+#  define FMT_USE_CONSTEVAL 0
+#endif
+#if FMT_USE_CONSTEVAL
+#  define FMT_CONSTEVAL consteval
+#  define FMT_CONSTEXPR20 constexpr
+#else
+#  define FMT_CONSTEVAL
+#  define FMT_CONSTEXPR20
+#endif
+
+// Check if exceptions are disabled.
+#ifdef FMT_USE_EXCEPTIONS
+// Use the provided definition.
+#elif defined(__GNUC__) && !defined(__EXCEPTIONS)
+#  define FMT_USE_EXCEPTIONS 0
+#elif FMT_MSC_VERSION && !_HAS_EXCEPTIONS
+#  define FMT_USE_EXCEPTIONS 0
+#else
+#  define FMT_USE_EXCEPTIONS 1
+#endif
+#if FMT_USE_EXCEPTIONS
+#  define FMT_TRY try
+#  define FMT_CATCH(x) catch (x)
+#else
+#  define FMT_TRY if (true)
+#  define FMT_CATCH(x) if (false)
+#endif
+
+#if FMT_HAS_CPP17_ATTRIBUTE(fallthrough)
+#  define FMT_FALLTHROUGH [[fallthrough]]
+#elif defined(__clang__)
+#  define FMT_FALLTHROUGH [[clang::fallthrough]]
+#elif FMT_GCC_VERSION >= 700 && \
+    (!defined(__EDG_VERSION__) || __EDG_VERSION__ >= 520)
+#  define FMT_FALLTHROUGH [[gnu::fallthrough]]
+#else
+#  define FMT_FALLTHROUGH
+#endif
+
+// Disable [[noreturn]] on MSVC/NVCC because of bogus unreachable code warnings.
+#if FMT_HAS_CPP_ATTRIBUTE(noreturn) && !FMT_MSC_VERSION && !defined(__NVCC__)
+#  define FMT_NORETURN [[noreturn]]
+#else
+#  define FMT_NORETURN
+#endif
+
+#ifdef FMT_NODISCARD
+// Use the provided definition.
+#elif FMT_HAS_CPP17_ATTRIBUTE(nodiscard)
+#  define FMT_NODISCARD [[nodiscard]]
+#else
+#  define FMT_NODISCARD
+#endif
+
+#ifdef FMT_DEPRECATED
+// Use the provided definition.
+#elif FMT_HAS_CPP14_ATTRIBUTE(deprecated)
+#  define FMT_DEPRECATED [[deprecated]]
+#else
+#  define FMT_DEPRECATED /* deprecated */
+#endif
+
+#ifdef FMT_ALWAYS_INLINE
+// Use the provided definition.
+#elif FMT_GCC_VERSION || FMT_CLANG_VERSION
+#  define FMT_ALWAYS_INLINE inline __attribute__((always_inline))
+#else
+#  define FMT_ALWAYS_INLINE inline
+#endif
+// A version of FMT_ALWAYS_INLINE to prevent code bloat in debug mode.
+#ifdef NDEBUG
+#  define FMT_INLINE FMT_ALWAYS_INLINE
+#else
+#  define FMT_INLINE inline
+#endif
+
+#if FMT_GCC_VERSION || FMT_CLANG_VERSION
+#  define FMT_VISIBILITY(value) __attribute__((visibility(value)))
+#else
+#  define FMT_VISIBILITY(value)
+#endif
+
+// Detect pragmas.
+#define FMT_PRAGMA_IMPL(x) _Pragma(#x)
+#if FMT_GCC_VERSION >= 504 && !defined(__NVCOMPILER)
+// Workaround a _Pragma bug https://gcc.gnu.org/bugzilla/show_bug.cgi?id=59884
+// and an nvhpc warning: https://github.com/fmtlib/fmt/pull/2582.
+#  define FMT_PRAGMA_GCC(x) FMT_PRAGMA_IMPL(GCC x)
+#else
+#  define FMT_PRAGMA_GCC(x)
+#endif
+#if FMT_CLANG_VERSION
+#  define FMT_PRAGMA_CLANG(x) FMT_PRAGMA_IMPL(clang x)
+#else
+#  define FMT_PRAGMA_CLANG(x)
+#endif
+#if FMT_MSC_VERSION
+#  define FMT_MSC_WARNING(...) __pragma(warning(__VA_ARGS__))
+#else
+#  define FMT_MSC_WARNING(...)
+#endif
+
+#ifndef FMT_BEGIN_NAMESPACE
+#  define FMT_BEGIN_NAMESPACE \
+    namespace fmt {           \
+    inline namespace v11 {
+#  define FMT_END_NAMESPACE \
+    }                       \
+    }
+#endif
+
+#ifndef FMT_EXPORT
+#  define FMT_EXPORT
+#  define FMT_BEGIN_EXPORT
+#  define FMT_END_EXPORT
+#endif
+
+#ifdef _WIN32
+#  define FMT_WIN32 1
+#else
+#  define FMT_WIN32 0
+#endif
+
+#if !defined(FMT_HEADER_ONLY) && FMT_WIN32
+#  if defined(FMT_LIB_EXPORT)
+#    define FMT_API __declspec(dllexport)
+#  elif defined(FMT_SHARED)
+#    define FMT_API __declspec(dllimport)
+#  endif
+#elif defined(FMT_LIB_EXPORT) || defined(FMT_SHARED)
+#  define FMT_API FMT_VISIBILITY("default")
+#endif
+#ifndef FMT_API
+#  define FMT_API
+#endif
+
+#ifndef FMT_OPTIMIZE_SIZE
+#  define FMT_OPTIMIZE_SIZE 0
+#endif
+
+// FMT_BUILTIN_TYPE=0 may result in smaller library size at the cost of higher
+// per-call binary size by passing built-in types through the extension API.
+#ifndef FMT_BUILTIN_TYPES
+#  define FMT_BUILTIN_TYPES 1
+#endif
+
+#define FMT_APPLY_VARIADIC(expr) \
+  using ignore = int[];          \
+  (void)ignore { 0, (expr, 0)... }
+
+// Enable minimal optimizations for more compact code in debug mode.
+FMT_PRAGMA_GCC(push_options)
+#if !defined(__OPTIMIZE__) && !defined(__CUDACC__)
+FMT_PRAGMA_GCC(optimize("Og"))
+#endif
+FMT_PRAGMA_CLANG(diagnostic push)
+
+FMT_BEGIN_NAMESPACE
+
+// Implementations of enable_if_t and other metafunctions for older systems.
+template <bool B, typename T = void>
+using enable_if_t = typename std::enable_if<B, T>::type;
+template <bool B, typename T, typename F>
+using conditional_t = typename std::conditional<B, T, F>::type;
+template <bool B> using bool_constant = std::integral_constant<bool, B>;
+template <typename T>
+using remove_reference_t = typename std::remove_reference<T>::type;
+template <typename T>
+using remove_const_t = typename std::remove_const<T>::type;
+template <typename T>
+using remove_cvref_t = typename std::remove_cv<remove_reference_t<T>>::type;
+template <typename T>
+using make_unsigned_t = typename std::make_unsigned<T>::type;
+template <typename T>
+using underlying_t = typename std::underlying_type<T>::type;
+template <typename T> using decay_t = typename std::decay<T>::type;
+using nullptr_t = decltype(nullptr);
+
+#if FMT_GCC_VERSION && FMT_GCC_VERSION < 500
+// A workaround for gcc 4.9 to make void_t work in a SFINAE context.
+template <typename...> struct void_t_impl {
+  using type = void;
+};
+template <typename... T> using void_t = typename void_t_impl<T...>::type;
+#else
+template <typename...> using void_t = void;
+#endif
+
+struct monostate {
+  constexpr monostate() {}
+};
+
+// An enable_if helper to be used in template parameters which results in much
+// shorter symbols: https://godbolt.org/z/sWw4vP. Extra parentheses are needed
+// to workaround a bug in MSVC 2019 (see #1140 and #1186).
+#ifdef FMT_DOC
+#  define FMT_ENABLE_IF(...)
+#else
+#  define FMT_ENABLE_IF(...) fmt::enable_if_t<(__VA_ARGS__), int> = 0
+#endif
+
+template <typename T> constexpr auto min_of(T a, T b) -> T {
+  return a < b ? a : b;
+}
+template <typename T> constexpr auto max_of(T a, T b) -> T {
+  return a > b ? a : b;
+}
+
+namespace detail {
+// Suppresses "unused variable" warnings with the method described in
+// https://herbsutter.com/2009/10/18/mailbag-shutting-up-compiler-warnings/.
+// (void)var does not work on many Intel compilers.
+template <typename... T> FMT_CONSTEXPR void ignore_unused(const T&...) {}
+
+constexpr auto is_constant_evaluated(bool default_value = false) noexcept
+    -> bool {
+// Workaround for incompatibility between clang 14 and libstdc++ consteval-based
+// std::is_constant_evaluated: https://github.com/fmtlib/fmt/issues/3247.
+#if FMT_CPLUSPLUS >= 202002L && FMT_GLIBCXX_RELEASE >= 12 && \
+    (FMT_CLANG_VERSION >= 1400 && FMT_CLANG_VERSION < 1500)
+  ignore_unused(default_value);
+  return __builtin_is_constant_evaluated();
+#elif defined(__cpp_lib_is_constant_evaluated)
+  ignore_unused(default_value);
+  return std::is_constant_evaluated();
+#else
+  return default_value;
+#endif
+}
+
+// Suppresses "conditional expression is constant" warnings.
+template <typename T> constexpr auto const_check(T value) -> T { return value; }
+
+FMT_NORETURN FMT_API void assert_fail(const char* file, int line,
+                                      const char* message);
+
+#if defined(FMT_ASSERT)
+// Use the provided definition.
+#elif defined(NDEBUG)
+// FMT_ASSERT is not empty to avoid -Wempty-body.
+#  define FMT_ASSERT(condition, message) \
+    fmt::detail::ignore_unused((condition), (message))
+#else
+#  define FMT_ASSERT(condition, message)                                    \
+    ((condition) /* void() fails with -Winvalid-constexpr on clang 4.0.1 */ \
+         ? (void)0                                                          \
+         : fmt::detail::assert_fail(__FILE__, __LINE__, (message)))
+#endif
+
+#ifdef FMT_USE_INT128
+// Use the provided definition.
+#elif defined(__SIZEOF_INT128__) && !defined(__NVCC__) && \
+    !(FMT_CLANG_VERSION && FMT_MSC_VERSION)
+#  define FMT_USE_INT128 1
+using int128_opt = __int128_t;  // An optional native 128-bit integer.
+using uint128_opt = __uint128_t;
+inline auto map(int128_opt x) -> int128_opt { return x; }
+inline auto map(uint128_opt x) -> uint128_opt { return x; }
+#else
+#  define FMT_USE_INT128 0
+#endif
+#if !FMT_USE_INT128
+enum class int128_opt {};
+enum class uint128_opt {};
+// Reduce template instantiations.
+inline auto map(int128_opt) -> monostate { return {}; }
+inline auto map(uint128_opt) -> monostate { return {}; }
+#endif
+
+#ifndef FMT_USE_BITINT
+#  define FMT_USE_BITINT (FMT_CLANG_VERSION >= 1500)
+#endif
+
+#if FMT_USE_BITINT
+FMT_PRAGMA_CLANG(diagnostic ignored "-Wbit-int-extension")
+template <int N> using bitint = _BitInt(N);
+template <int N> using ubitint = unsigned _BitInt(N);
+#else
+template <int N> struct bitint {};
+template <int N> struct ubitint {};
+#endif  // FMT_USE_BITINT
+
+// Casts a nonnegative integer to unsigned.
+template <typename Int>
+FMT_CONSTEXPR auto to_unsigned(Int value) -> make_unsigned_t<Int> {
+  FMT_ASSERT(std::is_unsigned<Int>::value || value >= 0, "negative value");
+  return static_cast<make_unsigned_t<Int>>(value);
+}
+
+template <typename Char>
+using unsigned_char = conditional_t<sizeof(Char) == 1, unsigned char, unsigned>;
+
+// A heuristic to detect std::string and std::[experimental::]string_view.
+// It is mainly used to avoid dependency on <[experimental/]string_view>.
+template <typename T, typename Enable = void>
+struct is_std_string_like : std::false_type {};
+template <typename T>
+struct is_std_string_like<T, void_t<decltype(std::declval<T>().find_first_of(
+                                 typename T::value_type(), 0))>>
+    : std::is_convertible<decltype(std::declval<T>().data()),
+                          const typename T::value_type*> {};
+
+// Check if the literal encoding is UTF-8.
+enum { is_utf8_enabled = "\u00A7"[1] == '\xA7' };
+enum { use_utf8 = !FMT_WIN32 || is_utf8_enabled };
+
+#ifndef FMT_UNICODE
+#  define FMT_UNICODE 1
+#endif
+
+static_assert(!FMT_UNICODE || use_utf8,
+              "Unicode support requires compiling with /utf-8");
+
+template <typename T> constexpr const char* narrow(const T*) { return nullptr; }
+constexpr FMT_ALWAYS_INLINE const char* narrow(const char* s) { return s; }
+
+template <typename Char>
+FMT_CONSTEXPR auto compare(const Char* s1, const Char* s2, std::size_t n)
+    -> int {
+  if (!is_constant_evaluated() && sizeof(Char) == 1) return memcmp(s1, s2, n);
+  for (; n != 0; ++s1, ++s2, --n) {
+    if (*s1 < *s2) return -1;
+    if (*s1 > *s2) return 1;
+  }
+  return 0;
+}
+
+namespace adl {
+using namespace std;
+
+template <typename Container>
+auto invoke_back_inserter()
+    -> decltype(back_inserter(std::declval<Container&>()));
+}  // namespace adl
+
+template <typename It, typename Enable = std::true_type>
+struct is_back_insert_iterator : std::false_type {};
+
+template <typename It>
+struct is_back_insert_iterator<
+    It, bool_constant<std::is_same<
+            decltype(adl::invoke_back_inserter<typename It::container_type>()),
+            It>::value>> : std::true_type {};
+
+// Extracts a reference to the container from *insert_iterator.
+template <typename OutputIt>
+inline FMT_CONSTEXPR20 auto get_container(OutputIt it) ->
+    typename OutputIt::container_type& {
+  struct accessor : OutputIt {
+    FMT_CONSTEXPR20 accessor(OutputIt base) : OutputIt(base) {}
+    using OutputIt::container;
+  };
+  return *accessor(it).container;
+}
+}  // namespace detail
+
+// Parsing-related public API and forward declarations.
+FMT_BEGIN_EXPORT
+
+/**
+ * An implementation of `std::basic_string_view` for pre-C++17. It provides a
+ * subset of the API. `fmt::basic_string_view` is used for format strings even
+ * if `std::basic_string_view` is available to prevent issues when a library is
+ * compiled with a different `-std` option than the client code (which is not
+ * recommended).
+ */
+template <typename Char> class basic_string_view {
+ private:
+  const Char* data_;
+  size_t size_;
+
+ public:
+  using value_type = Char;
+  using iterator = const Char*;
+
+  constexpr basic_string_view() noexcept : data_(nullptr), size_(0) {}
+
+  /// Constructs a string reference object from a C string and a size.
+  constexpr basic_string_view(const Char* s, size_t count) noexcept
+      : data_(s), size_(count) {}
+
+  constexpr basic_string_view(nullptr_t) = delete;
+
+  /// Constructs a string reference object from a C string.
+#if FMT_GCC_VERSION
+  FMT_ALWAYS_INLINE
+#endif
+  FMT_CONSTEXPR20 basic_string_view(const Char* s) : data_(s) {
+#if FMT_HAS_BUILTIN(__buitin_strlen) || FMT_GCC_VERSION || FMT_CLANG_VERSION
+    if (std::is_same<Char, char>::value) {
+      size_ = __builtin_strlen(detail::narrow(s));
+      return;
+    }
+#endif
+    size_t len = 0;
+    while (*s++) ++len;
+    size_ = len;
+  }
+
+  /// Constructs a string reference from a `std::basic_string` or a
+  /// `std::basic_string_view` object.
+  template <typename S,
+            FMT_ENABLE_IF(detail::is_std_string_like<S>::value&& std::is_same<
+                          typename S::value_type, Char>::value)>
+  FMT_CONSTEXPR basic_string_view(const S& s) noexcept
+      : data_(s.data()), size_(s.size()) {}
+
+  /// Returns a pointer to the string data.
+  constexpr auto data() const noexcept -> const Char* { return data_; }
+
+  /// Returns the string size.
+  constexpr auto size() const noexcept -> size_t { return size_; }
+
+  constexpr auto begin() const noexcept -> iterator { return data_; }
+  constexpr auto end() const noexcept -> iterator { return data_ + size_; }
+
+  constexpr auto operator[](size_t pos) const noexcept -> const Char& {
+    return data_[pos];
+  }
+
+  FMT_CONSTEXPR void remove_prefix(size_t n) noexcept {
+    data_ += n;
+    size_ -= n;
+  }
+
+  FMT_CONSTEXPR auto starts_with(basic_string_view<Char> sv) const noexcept
+      -> bool {
+    return size_ >= sv.size_ && detail::compare(data_, sv.data_, sv.size_) == 0;
+  }
+  FMT_CONSTEXPR auto starts_with(Char c) const noexcept -> bool {
+    return size_ >= 1 && *data_ == c;
+  }
+  FMT_CONSTEXPR auto starts_with(const Char* s) const -> bool {
+    return starts_with(basic_string_view<Char>(s));
+  }
+
+  // Lexicographically compare this string reference to other.
+  FMT_CONSTEXPR auto compare(basic_string_view other) const -> int {
+    int result =
+        detail::compare(data_, other.data_, min_of(size_, other.size_));
+    if (result != 0) return result;
+    return size_ == other.size_ ? 0 : (size_ < other.size_ ? -1 : 1);
+  }
+
+  FMT_CONSTEXPR friend auto operator==(basic_string_view lhs,
+                                       basic_string_view rhs) -> bool {
+    return lhs.compare(rhs) == 0;
+  }
+  friend auto operator!=(basic_string_view lhs, basic_string_view rhs) -> bool {
+    return lhs.compare(rhs) != 0;
+  }
+  friend auto operator<(basic_string_view lhs, basic_string_view rhs) -> bool {
+    return lhs.compare(rhs) < 0;
+  }
+  friend auto operator<=(basic_string_view lhs, basic_string_view rhs) -> bool {
+    return lhs.compare(rhs) <= 0;
+  }
+  friend auto operator>(basic_string_view lhs, basic_string_view rhs) -> bool {
+    return lhs.compare(rhs) > 0;
+  }
+  friend auto operator>=(basic_string_view lhs, basic_string_view rhs) -> bool {
+    return lhs.compare(rhs) >= 0;
+  }
+};
+
+using string_view = basic_string_view<char>;
+
+/// Specifies if `T` is an extended character type. Can be specialized by users.
+template <typename T> struct is_xchar : std::false_type {};
+template <> struct is_xchar<wchar_t> : std::true_type {};
+template <> struct is_xchar<char16_t> : std::true_type {};
+template <> struct is_xchar<char32_t> : std::true_type {};
+#ifdef __cpp_char8_t
+template <> struct is_xchar<char8_t> : std::true_type {};
+#endif
+
+// DEPRECATED! Will be replaced with an alias to prevent specializations.
+template <typename T> struct is_char : is_xchar<T> {};
+template <> struct is_char<char> : std::true_type {};
+
+template <typename T> class basic_appender;
+using appender = basic_appender<char>;
+
+// Checks whether T is a container with contiguous storage.
+template <typename T> struct is_contiguous : std::false_type {};
+
+class context;
+template <typename OutputIt, typename Char> class generic_context;
+template <typename Char> class parse_context;
+
+// Longer aliases for C++20 compatibility.
+template <typename Char> using basic_format_parse_context = parse_context<Char>;
+using format_parse_context = parse_context<char>;
+template <typename OutputIt, typename Char>
+using basic_format_context =
+    conditional_t<std::is_same<OutputIt, appender>::value, context,
+                  generic_context<OutputIt, Char>>;
+using format_context = context;
+
+template <typename Char>
+using buffered_context =
+    conditional_t<std::is_same<Char, char>::value, context,
+                  generic_context<basic_appender<Char>, Char>>;
+
+template <typename Context> class basic_format_arg;
+template <typename Context> class basic_format_args;
+
+// A separate type would result in shorter symbols but break ABI compatibility
+// between clang and gcc on ARM (#1919).
+using format_args = basic_format_args<context>;
+
+// A formatter for objects of type T.
+template <typename T, typename Char = char, typename Enable = void>
+struct formatter {
+  // A deleted default constructor indicates a disabled formatter.
+  formatter() = delete;
+};
+
+/// Reports a format error at compile time or, via a `format_error` exception,
+/// at runtime.
+// This function is intentionally not constexpr to give a compile-time error.
+FMT_NORETURN FMT_API void report_error(const char* message);
+
+enum class presentation_type : unsigned char {
+  // Common specifiers:
+  none = 0,
+  debug = 1,   // '?'
+  string = 2,  // 's' (string, bool)
+
+  // Integral, bool and character specifiers:
+  dec = 3,  // 'd'
+  hex,      // 'x' or 'X'
+  oct,      // 'o'
+  bin,      // 'b' or 'B'
+  chr,      // 'c'
+
+  // String and pointer specifiers:
+  pointer = 3,  // 'p'
+
+  // Floating-point specifiers:
+  exp = 1,  // 'e' or 'E' (1 since there is no FP debug presentation)
+  fixed,    // 'f' or 'F'
+  general,  // 'g' or 'G'
+  hexfloat  // 'a' or 'A'
+};
+
+enum class align { none, left, right, center, numeric };
+enum class sign { none, minus, plus, space };
+enum class arg_id_kind { none, index, name };
+
+// Basic format specifiers for built-in and string types.
+class basic_specs {
+ private:
+  // Data is arranged as follows:
+  //
+  //  0                   1                   2                   3
+  //  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+  // +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
+  // |type |align| w | p | s |u|#|L|  f  |          unused           |
+  // +-----+-----+---+---+---+-+-+-+-----+---------------------------+
+  //
+  //   w - dynamic width info
+  //   p - dynamic precision info
+  //   s - sign
+  //   u - uppercase (e.g. 'X' for 'x')
+  //   # - alternate form ('#')
+  //   L - localized
+  //   f - fill size
+  //
+  // Bitfields are not used because of compiler bugs such as gcc bug 61414.
+  enum : unsigned {
+    type_mask = 0x00007,
+    align_mask = 0x00038,
+    width_mask = 0x000C0,
+    precision_mask = 0x00300,
+    sign_mask = 0x00C00,
+    uppercase_mask = 0x01000,
+    alternate_mask = 0x02000,
+    localized_mask = 0x04000,
+    fill_size_mask = 0x38000,
+
+    align_shift = 3,
+    width_shift = 6,
+    precision_shift = 8,
+    sign_shift = 10,
+    fill_size_shift = 15,
+
+    max_fill_size = 4
+  };
+
+  unsigned long data_ = 1 << fill_size_shift;
+
+  // Character (code unit) type is erased to prevent template bloat.
+  char fill_data_[max_fill_size] = {' '};
+
+  FMT_CONSTEXPR void set_fill_size(size_t size) {
+    data_ = (data_ & ~fill_size_mask) | (size << fill_size_shift);
+  }
+
+ public:
+  constexpr auto type() const -> presentation_type {
+    return static_cast<presentation_type>(data_ & type_mask);
+  }
+  FMT_CONSTEXPR void set_type(presentation_type t) {
+    data_ = (data_ & ~type_mask) | static_cast<unsigned>(t);
+  }
+
+  constexpr auto align() const -> align {
+    return static_cast<fmt::align>((data_ & align_mask) >> align_shift);
+  }
+  FMT_CONSTEXPR void set_align(fmt::align a) {
+    data_ = (data_ & ~align_mask) | (static_cast<unsigned>(a) << align_shift);
+  }
+
+  constexpr auto dynamic_width() const -> arg_id_kind {
+    return static_cast<arg_id_kind>((data_ & width_mask) >> width_shift);
+  }
+  FMT_CONSTEXPR void set_dynamic_width(arg_id_kind w) {
+    data_ = (data_ & ~width_mask) | (static_cast<unsigned>(w) << width_shift);
+  }
+
+  FMT_CONSTEXPR auto dynamic_precision() const -> arg_id_kind {
+    return static_cast<arg_id_kind>((data_ & precision_mask) >>
+                                    precision_shift);
+  }
+  FMT_CONSTEXPR void set_dynamic_precision(arg_id_kind p) {
+    data_ = (data_ & ~precision_mask) |
+            (static_cast<unsigned>(p) << precision_shift);
+  }
+
+  constexpr bool dynamic() const {
+    return (data_ & (width_mask | precision_mask)) != 0;
+  }
+
+  constexpr auto sign() const -> sign {
+    return static_cast<fmt::sign>((data_ & sign_mask) >> sign_shift);
+  }
+  FMT_CONSTEXPR void set_sign(fmt::sign s) {
+    data_ = (data_ & ~sign_mask) | (static_cast<unsigned>(s) << sign_shift);
+  }
+
+  constexpr auto upper() const -> bool { return (data_ & uppercase_mask) != 0; }
+  FMT_CONSTEXPR void set_upper() { data_ |= uppercase_mask; }
+
+  constexpr auto alt() const -> bool { return (data_ & alternate_mask) != 0; }
+  FMT_CONSTEXPR void set_alt() { data_ |= alternate_mask; }
+  FMT_CONSTEXPR void clear_alt() { data_ &= ~alternate_mask; }
+
+  constexpr auto localized() const -> bool {
+    return (data_ & localized_mask) != 0;
+  }
+  FMT_CONSTEXPR void set_localized() { data_ |= localized_mask; }
+
+  constexpr auto fill_size() const -> size_t {
+    return (data_ & fill_size_mask) >> fill_size_shift;
+  }
+
+  template <typename Char, FMT_ENABLE_IF(std::is_same<Char, char>::value)>
+  constexpr auto fill() const -> const Char* {
+    return fill_data_;
+  }
+  template <typename Char, FMT_ENABLE_IF(!std::is_same<Char, char>::value)>
+  constexpr auto fill() const -> const Char* {
+    return nullptr;
+  }
+
+  template <typename Char> constexpr auto fill_unit() const -> Char {
+    using uchar = unsigned char;
+    return static_cast<Char>(static_cast<uchar>(fill_data_[0]) |
+                             (static_cast<uchar>(fill_data_[1]) << 8));
+  }
+
+  FMT_CONSTEXPR void set_fill(char c) {
+    fill_data_[0] = c;
+    set_fill_size(1);
+  }
+
+  template <typename Char>
+  FMT_CONSTEXPR void set_fill(basic_string_view<Char> s) {
+    auto size = s.size();
+    set_fill_size(size);
+    if (size == 1) {
+      unsigned uchar = static_cast<detail::unsigned_char<Char>>(s[0]);
+      fill_data_[0] = static_cast<char>(uchar);
+      fill_data_[1] = static_cast<char>(uchar >> 8);
+      return;
+    }
+    FMT_ASSERT(size <= max_fill_size, "invalid fill");
+    for (size_t i = 0; i < size; ++i)
+      fill_data_[i & 3] = static_cast<char>(s[i]);
+  }
+};
+
+// Format specifiers for built-in and string types.
+struct format_specs : basic_specs {
+  int width;
+  int precision;
+
+  constexpr format_specs() : width(0), precision(-1) {}
+};
+
+/**
+ * Parsing context consisting of a format string range being parsed and an
+ * argument counter for automatic indexing.
+ */
+template <typename Char = char> class parse_context {
+ private:
+  basic_string_view<Char> fmt_;
+  int next_arg_id_;
+
+  enum { use_constexpr_cast = !FMT_GCC_VERSION || FMT_GCC_VERSION >= 1200 };
+
+  FMT_CONSTEXPR void do_check_arg_id(int arg_id);
+
+ public:
+  using char_type = Char;
+  using iterator = const Char*;
+
+  explicit constexpr parse_context(basic_string_view<Char> fmt,
+                                   int next_arg_id = 0)
+      : fmt_(fmt), next_arg_id_(next_arg_id) {}
+
+  /// Returns an iterator to the beginning of the format string range being
+  /// parsed.
+  constexpr auto begin() const noexcept -> iterator { return fmt_.begin(); }
+
+  /// Returns an iterator past the end of the format string range being parsed.
+  constexpr auto end() const noexcept -> iterator { return fmt_.end(); }
+
+  /// Advances the begin iterator to `it`.
+  FMT_CONSTEXPR void advance_to(iterator it) {
+    fmt_.remove_prefix(detail::to_unsigned(it - begin()));
+  }
+
+  /// Reports an error if using the manual argument indexing; otherwise returns
+  /// the next argument index and switches to the automatic indexing.
+  FMT_CONSTEXPR auto next_arg_id() -> int {
+    if (next_arg_id_ < 0) {
+      report_error("cannot switch from manual to automatic argument indexing");
+      return 0;
+    }
+    int id = next_arg_id_++;
+    do_check_arg_id(id);
+    return id;
+  }
+
+  /// Reports an error if using the automatic argument indexing; otherwise
+  /// switches to the manual indexing.
+  FMT_CONSTEXPR void check_arg_id(int id) {
+    if (next_arg_id_ > 0) {
+      report_error("cannot switch from automatic to manual argument indexing");
+      return;
+    }
+    next_arg_id_ = -1;
+    do_check_arg_id(id);
+  }
+  FMT_CONSTEXPR void check_arg_id(basic_string_view<Char>) {
+    next_arg_id_ = -1;
+  }
+  FMT_CONSTEXPR void check_dynamic_spec(int arg_id);
+};
+
+FMT_END_EXPORT
+
+namespace detail {
+
+// Constructs fmt::basic_string_view<Char> from types implicitly convertible
+// to it, deducing Char. Explicitly convertible types such as the ones returned
+// from FMT_STRING are intentionally excluded.
+template <typename Char, FMT_ENABLE_IF(is_char<Char>::value)>
+constexpr auto to_string_view(const Char* s) -> basic_string_view<Char> {
+  return s;
+}
+template <typename T, FMT_ENABLE_IF(is_std_string_like<T>::value)>
+constexpr auto to_string_view(const T& s)
+    -> basic_string_view<typename T::value_type> {
+  return s;
+}
+template <typename Char>
+constexpr auto to_string_view(basic_string_view<Char> s)
+    -> basic_string_view<Char> {
+  return s;
+}
+
+template <typename T, typename Enable = void>
+struct has_to_string_view : std::false_type {};
+// detail:: is intentional since to_string_view is not an extension point.
+template <typename T>
+struct has_to_string_view<
+    T, void_t<decltype(detail::to_string_view(std::declval<T>()))>>
+    : std::true_type {};
+
+/// String's character (code unit) type. detail:: is intentional to prevent ADL.
+template <typename S,
+          typename V = decltype(detail::to_string_view(std::declval<S>()))>
+using char_t = typename V::value_type;
+
+enum class type {
+  none_type,
+  // Integer types should go first,
+  int_type,
+  uint_type,
+  long_long_type,
+  ulong_long_type,
+  int128_type,
+  uint128_type,
+  bool_type,
+  char_type,
+  last_integer_type = char_type,
+  // followed by floating-point types.
+  float_type,
+  double_type,
+  long_double_type,
+  last_numeric_type = long_double_type,
+  cstring_type,
+  string_type,
+  pointer_type,
+  custom_type
+};
+
+// Maps core type T to the corresponding type enum constant.
+template <typename T, typename Char>
+struct type_constant : std::integral_constant<type, type::custom_type> {};
+
+#define FMT_TYPE_CONSTANT(Type, constant) \
+  template <typename Char>                \
+  struct type_constant<Type, Char>        \
+      : std::integral_constant<type, type::constant> {}
+
+FMT_TYPE_CONSTANT(int, int_type);
+FMT_TYPE_CONSTANT(unsigned, uint_type);
+FMT_TYPE_CONSTANT(long long, long_long_type);
+FMT_TYPE_CONSTANT(unsigned long long, ulong_long_type);
+FMT_TYPE_CONSTANT(int128_opt, int128_type);
+FMT_TYPE_CONSTANT(uint128_opt, uint128_type);
+FMT_TYPE_CONSTANT(bool, bool_type);
+FMT_TYPE_CONSTANT(Char, char_type);
+FMT_TYPE_CONSTANT(float, float_type);
+FMT_TYPE_CONSTANT(double, double_type);
+FMT_TYPE_CONSTANT(long double, long_double_type);
+FMT_TYPE_CONSTANT(const Char*, cstring_type);
+FMT_TYPE_CONSTANT(basic_string_view<Char>, string_type);
+FMT_TYPE_CONSTANT(const void*, pointer_type);
+
+constexpr auto is_integral_type(type t) -> bool {
+  return t > type::none_type && t <= type::last_integer_type;
+}
+constexpr auto is_arithmetic_type(type t) -> bool {
+  return t > type::none_type && t <= type::last_numeric_type;
+}
+
+constexpr auto set(type rhs) -> int { return 1 << static_cast<int>(rhs); }
+constexpr auto in(type t, int set) -> bool {
+  return ((set >> static_cast<int>(t)) & 1) != 0;
+}
+
+// Bitsets of types.
+enum {
+  sint_set =
+      set(type::int_type) | set(type::long_long_type) | set(type::int128_type),
+  uint_set = set(type::uint_type) | set(type::ulong_long_type) |
+             set(type::uint128_type),
+  bool_set = set(type::bool_type),
+  char_set = set(type::char_type),
+  float_set = set(type::float_type) | set(type::double_type) |
+              set(type::long_double_type),
+  string_set = set(type::string_type),
+  cstring_set = set(type::cstring_type),
+  pointer_set = set(type::pointer_type)
+};
+
+struct view {};
+
+template <typename Char, typename T> struct named_arg;
+template <typename T> struct is_named_arg : std::false_type {};
+template <typename T> struct is_static_named_arg : std::false_type {};
+
+template <typename Char, typename T>
+struct is_named_arg<named_arg<Char, T>> : std::true_type {};
+
+template <typename Char, typename T> struct named_arg : view {
+  const Char* name;
+  const T& value;
+
+  named_arg(const Char* n, const T& v) : name(n), value(v) {}
+  static_assert(!is_named_arg<T>::value, "nested named arguments");
+};
+
+template <bool B = false> constexpr auto count() -> size_t { return B ? 1 : 0; }
+template <bool B1, bool B2, bool... Tail> constexpr auto count() -> size_t {
+  return (B1 ? 1 : 0) + count<B2, Tail...>();
+}
+
+template <typename... Args> constexpr auto count_named_args() -> size_t {
+  return count<is_named_arg<Args>::value...>();
+}
+template <typename... Args> constexpr auto count_static_named_args() -> size_t {
+  return count<is_static_named_arg<Args>::value...>();
+}
+
+template <typename Char> struct named_arg_info {
+  const Char* name;
+  int id;
+};
+
+template <typename Char, typename T, FMT_ENABLE_IF(!is_named_arg<T>::value)>
+void init_named_arg(named_arg_info<Char>*, int& arg_index, int&, const T&) {
+  ++arg_index;
+}
+template <typename Char, typename T, FMT_ENABLE_IF(is_named_arg<T>::value)>
+void init_named_arg(named_arg_info<Char>* named_args, int& arg_index,
+                    int& named_arg_index, const T& arg) {
+  named_args[named_arg_index++] = {arg.name, arg_index++};
+}
+
+template <typename T, typename Char,
+          FMT_ENABLE_IF(!is_static_named_arg<T>::value)>
+FMT_CONSTEXPR void init_static_named_arg(named_arg_info<Char>*, int& arg_index,
+                                         int&) {
+  ++arg_index;
+}
+template <typename T, typename Char,
+          FMT_ENABLE_IF(is_static_named_arg<T>::value)>
+FMT_CONSTEXPR void init_static_named_arg(named_arg_info<Char>* named_args,
+                                         int& arg_index, int& named_arg_index) {
+  named_args[named_arg_index++] = {T::name, arg_index++};
+}
+
+// To minimize the number of types we need to deal with, long is translated
+// either to int or to long long depending on its size.
+enum { long_short = sizeof(long) == sizeof(int) };
+using long_type = conditional_t<long_short, int, long long>;
+using ulong_type = conditional_t<long_short, unsigned, unsigned long long>;
+
+template <typename T>
+using format_as_result =
+    remove_cvref_t<decltype(format_as(std::declval<const T&>()))>;
+template <typename T>
+using format_as_member_result =
+    remove_cvref_t<decltype(formatter<T>::format_as(std::declval<const T&>()))>;
+
+template <typename T, typename Enable = std::true_type>
+struct use_format_as : std::false_type {};
+// format_as member is only used to avoid injection into the std namespace.
+template <typename T, typename Enable = std::true_type>
+struct use_format_as_member : std::false_type {};
+
+// Only map owning types because mapping views can be unsafe.
+template <typename T>
+struct use_format_as<
+    T, bool_constant<std::is_arithmetic<format_as_result<T>>::value>>
+    : std::true_type {};
+template <typename T>
+struct use_format_as_member<
+    T, bool_constant<std::is_arithmetic<format_as_member_result<T>>::value>>
+    : std::true_type {};
+
+template <typename T, typename U = remove_const_t<T>>
+using use_formatter =
+    bool_constant<(std::is_class<T>::value || std::is_enum<T>::value ||
+                   std::is_union<T>::value || std::is_array<T>::value) &&
+                  !has_to_string_view<T>::value && !is_named_arg<T>::value &&
+                  !use_format_as<T>::value && !use_format_as_member<T>::value>;
+
+template <typename Char, typename T, typename U = remove_const_t<T>>
+auto has_formatter_impl(T* p, buffered_context<Char>* ctx = nullptr)
+    -> decltype(formatter<U, Char>().format(*p, *ctx), std::true_type());
+template <typename Char> auto has_formatter_impl(...) -> std::false_type;
+
+// T can be const-qualified to check if it is const-formattable.
+template <typename T, typename Char> constexpr auto has_formatter() -> bool {
+  return decltype(has_formatter_impl<Char>(static_cast<T*>(nullptr)))::value;
+}
+
+// Maps formatting argument types to natively supported types or user-defined
+// types with formatters. Returns void on errors to be SFINAE-friendly.
+template <typename Char> struct type_mapper {
+  static auto map(signed char) -> int;
+  static auto map(unsigned char) -> unsigned;
+  static auto map(short) -> int;
+  static auto map(unsigned short) -> unsigned;
+  static auto map(int) -> int;
+  static auto map(unsigned) -> unsigned;
+  static auto map(long) -> long_type;
+  static auto map(unsigned long) -> ulong_type;
+  static auto map(long long) -> long long;
+  static auto map(unsigned long long) -> unsigned long long;
+  static auto map(int128_opt) -> int128_opt;
+  static auto map(uint128_opt) -> uint128_opt;
+  static auto map(bool) -> bool;
+
+  template <int N>
+  static auto map(bitint<N>) -> conditional_t<N <= 64, long long, void>;
+  template <int N>
+  static auto map(ubitint<N>)
+      -> conditional_t<N <= 64, unsigned long long, void>;
+
+  template <typename T, FMT_ENABLE_IF(is_char<T>::value)>
+  static auto map(T) -> conditional_t<
+      std::is_same<T, char>::value || std::is_same<T, Char>::value, Char, void>;
+
+  static auto map(float) -> float;
+  static auto map(double) -> double;
+  static auto map(long double) -> long double;
+
+  static auto map(Char*) -> const Char*;
+  static auto map(const Char*) -> const Char*;
+  template <typename T, typename C = char_t<T>,
+            FMT_ENABLE_IF(!std::is_pointer<T>::value)>
+  static auto map(const T&) -> conditional_t<std::is_same<C, Char>::value,
+                                             basic_string_view<C>, void>;
+
+  static auto map(void*) -> const void*;
+  static auto map(const void*) -> const void*;
+  static auto map(volatile void*) -> const void*;
+  static auto map(const volatile void*) -> const void*;
+  static auto map(nullptr_t) -> const void*;
+  template <typename T, FMT_ENABLE_IF(std::is_pointer<T>::value ||
+                                      std::is_member_pointer<T>::value)>
+  static auto map(const T&) -> void;
+
+  template <typename T, FMT_ENABLE_IF(use_format_as<T>::value)>
+  static auto map(const T& x) -> decltype(map(format_as(x)));
+  template <typename T, FMT_ENABLE_IF(use_format_as_member<T>::value)>
+  static auto map(const T& x) -> decltype(map(formatter<T>::format_as(x)));
+
+  template <typename T, FMT_ENABLE_IF(use_formatter<T>::value)>
+  static auto map(T&) -> conditional_t<has_formatter<T, Char>(), T&, void>;
+
+  template <typename T, FMT_ENABLE_IF(is_named_arg<T>::value)>
+  static auto map(const T& named_arg) -> decltype(map(named_arg.value));
+};
+
+// detail:: is used to workaround a bug in MSVC 2017.
+template <typename T, typename Char>
+using mapped_t = decltype(detail::type_mapper<Char>::map(std::declval<T&>()));
+
+// A type constant after applying type_mapper.
+template <typename T, typename Char = char>
+using mapped_type_constant = type_constant<mapped_t<T, Char>, Char>;
+
+template <typename T, typename Context,
+          type TYPE =
+              mapped_type_constant<T, typename Context::char_type>::value>
+using stored_type_constant = std::integral_constant<
+    type, Context::builtin_types || TYPE == type::int_type ? TYPE
+                                                           : type::custom_type>;
+// A parse context with extra data used only in compile-time checks.
+template <typename Char>
+class compile_parse_context : public parse_context<Char> {
+ private:
+  int num_args_;
+  const type* types_;
+  using base = parse_context<Char>;
+
+ public:
+  explicit FMT_CONSTEXPR compile_parse_context(basic_string_view<Char> fmt,
+                                               int num_args, const type* types,
+                                               int next_arg_id = 0)
+      : base(fmt, next_arg_id), num_args_(num_args), types_(types) {}
+
+  constexpr auto num_args() const -> int { return num_args_; }
+  constexpr auto arg_type(int id) const -> type { return types_[id]; }
+
+  FMT_CONSTEXPR auto next_arg_id() -> int {
+    int id = base::next_arg_id();
+    if (id >= num_args_) report_error("argument not found");
+    return id;
+  }
+
+  FMT_CONSTEXPR void check_arg_id(int id) {
+    base::check_arg_id(id);
+    if (id >= num_args_) report_error("argument not found");
+  }
+  using base::check_arg_id;
+
+  FMT_CONSTEXPR void check_dynamic_spec(int arg_id) {
+    ignore_unused(arg_id);
+    if (arg_id < num_args_ && types_ && !is_integral_type(types_[arg_id]))
+      report_error("width/precision is not integer");
+  }
+};
+
+// An argument reference.
+template <typename Char> union arg_ref {
+  FMT_CONSTEXPR arg_ref(int idx = 0) : index(idx) {}
+  FMT_CONSTEXPR arg_ref(basic_string_view<Char> n) : name(n) {}
+
+  int index;
+  basic_string_view<Char> name;
+};
+
+// Format specifiers with width and precision resolved at formatting rather
+// than parsing time to allow reusing the same parsed specifiers with
+// different sets of arguments (precompilation of format strings).
+template <typename Char = char> struct dynamic_format_specs : format_specs {
+  arg_ref<Char> width_ref;
+  arg_ref<Char> precision_ref;
+};
+
+// Converts a character to ASCII. Returns '\0' on conversion failure.
+template <typename Char, FMT_ENABLE_IF(std::is_integral<Char>::value)>
+constexpr auto to_ascii(Char c) -> char {
+  return c <= 0xff ? static_cast<char>(c) : '\0';
+}
+
+// Returns the number of code units in a code point or 1 on error.
+template <typename Char>
+FMT_CONSTEXPR auto code_point_length(const Char* begin) -> int {
+  if (const_check(sizeof(Char) != 1)) return 1;
+  auto c = static_cast<unsigned char>(*begin);
+  return static_cast<int>((0x3a55000000000000ull >> (2 * (c >> 3))) & 3) + 1;
+}
+
+// Parses the range [begin, end) as an unsigned integer. This function assumes
+// that the range is non-empty and the first character is a digit.
+template <typename Char>
+FMT_CONSTEXPR auto parse_nonnegative_int(const Char*& begin, const Char* end,
+                                         int error_value) noexcept -> int {
+  FMT_ASSERT(begin != end && '0' <= *begin && *begin <= '9', "");
+  unsigned value = 0, prev = 0;
+  auto p = begin;
+  do {
+    prev = value;
+    value = value * 10 + unsigned(*p - '0');
+    ++p;
+  } while (p != end && '0' <= *p && *p <= '9');
+  auto num_digits = p - begin;
+  begin = p;
+  int digits10 = static_cast<int>(sizeof(int) * CHAR_BIT * 3 / 10);
+  if (num_digits <= digits10) return static_cast<int>(value);
+  // Check for overflow.
+  unsigned max = INT_MAX;
+  return num_digits == digits10 + 1 &&
+                 prev * 10ull + unsigned(p[-1] - '0') <= max
+             ? static_cast<int>(value)
+             : error_value;
+}
+
+FMT_CONSTEXPR inline auto parse_align(char c) -> align {
+  switch (c) {
+  case '<': return align::left;
+  case '>': return align::right;
+  case '^': return align::center;
+  }
+  return align::none;
+}
+
+template <typename Char> constexpr auto is_name_start(Char c) -> bool {
+  return ('a' <= c && c <= 'z') || ('A' <= c && c <= 'Z') || c == '_';
+}
+
+template <typename Char, typename Handler>
+FMT_CONSTEXPR auto parse_arg_id(const Char* begin, const Char* end,
+                                Handler&& handler) -> const Char* {
+  Char c = *begin;
+  if (c >= '0' && c <= '9') {
+    int index = 0;
+    if (c != '0')
+      index = parse_nonnegative_int(begin, end, INT_MAX);
+    else
+      ++begin;
+    if (begin == end || (*begin != '}' && *begin != ':'))
+      report_error("invalid format string");
+    else
+      handler.on_index(index);
+    return begin;
+  }
+  if (FMT_OPTIMIZE_SIZE > 1 || !is_name_start(c)) {
+    report_error("invalid format string");
+    return begin;
+  }
+  auto it = begin;
+  do {
+    ++it;
+  } while (it != end && (is_name_start(*it) || ('0' <= *it && *it <= '9')));
+  handler.on_name({begin, to_unsigned(it - begin)});
+  return it;
+}
+
+template <typename Char> struct dynamic_spec_handler {
+  parse_context<Char>& ctx;
+  arg_ref<Char>& ref;
+  arg_id_kind& kind;
+
+  FMT_CONSTEXPR void on_index(int id) {
+    ref = id;
+    kind = arg_id_kind::index;
+    ctx.check_arg_id(id);
+    ctx.check_dynamic_spec(id);
+  }
+  FMT_CONSTEXPR void on_name(basic_string_view<Char> id) {
+    ref = id;
+    kind = arg_id_kind::name;
+    ctx.check_arg_id(id);
+  }
+};
+
+template <typename Char> struct parse_dynamic_spec_result {
+  const Char* end;
+  arg_id_kind kind;
+};
+
+// Parses integer | "{" [arg_id] "}".
+template <typename Char>
+FMT_CONSTEXPR auto parse_dynamic_spec(const Char* begin, const Char* end,
+                                      int& value, arg_ref<Char>& ref,
+                                      parse_context<Char>& ctx)
+    -> parse_dynamic_spec_result<Char> {
+  FMT_ASSERT(begin != end, "");
+  auto kind = arg_id_kind::none;
+  if ('0' <= *begin && *begin <= '9') {
+    int val = parse_nonnegative_int(begin, end, -1);
+    if (val == -1) report_error("number is too big");
+    value = val;
+  } else {
+    if (*begin == '{') {
+      ++begin;
+      if (begin != end) {
+        Char c = *begin;
+        if (c == '}' || c == ':') {
+          int id = ctx.next_arg_id();
+          ref = id;
+          kind = arg_id_kind::index;
+          ctx.check_dynamic_spec(id);
+        } else {
+          begin = parse_arg_id(begin, end,
+                               dynamic_spec_handler<Char>{ctx, ref, kind});
+        }
+      }
+      if (begin != end && *begin == '}') return {++begin, kind};
+    }
+    report_error("invalid format string");
+  }
+  return {begin, kind};
+}
+
+template <typename Char>
+FMT_CONSTEXPR auto parse_width(const Char* begin, const Char* end,
+                               format_specs& specs, arg_ref<Char>& width_ref,
+                               parse_context<Char>& ctx) -> const Char* {
+  auto result = parse_dynamic_spec(begin, end, specs.width, width_ref, ctx);
+  specs.set_dynamic_width(result.kind);
+  return result.end;
+}
+
+template <typename Char>
+FMT_CONSTEXPR auto parse_precision(const Char* begin, const Char* end,
+                                   format_specs& specs,
+                                   arg_ref<Char>& precision_ref,
+                                   parse_context<Char>& ctx) -> const Char* {
+  ++begin;
+  if (begin == end) {
+    report_error("invalid precision");
+    return begin;
+  }
+  auto result =
+      parse_dynamic_spec(begin, end, specs.precision, precision_ref, ctx);
+  specs.set_dynamic_precision(result.kind);
+  return result.end;
+}
+
+enum class state { start, align, sign, hash, zero, width, precision, locale };
+
+// Parses standard format specifiers.
+template <typename Char>
+FMT_CONSTEXPR auto parse_format_specs(const Char* begin, const Char* end,
+                                      dynamic_format_specs<Char>& specs,
+                                      parse_context<Char>& ctx, type arg_type)
+    -> const Char* {
+  auto c = '\0';
+  if (end - begin > 1) {
+    auto next = to_ascii(begin[1]);
+    c = parse_align(next) == align::none ? to_ascii(*begin) : '\0';
+  } else {
+    if (begin == end) return begin;
+    c = to_ascii(*begin);
+  }
+
+  struct {
+    state current_state = state::start;
+    FMT_CONSTEXPR void operator()(state s, bool valid = true) {
+      if (current_state >= s || !valid)
+        report_error("invalid format specifier");
+      current_state = s;
+    }
+  } enter_state;
+
+  using pres = presentation_type;
+  constexpr auto integral_set = sint_set | uint_set | bool_set | char_set;
+  struct {
+    const Char*& begin;
+    format_specs& specs;
+    type arg_type;
+
+    FMT_CONSTEXPR auto operator()(pres pres_type, int set) -> const Char* {
+      if (!in(arg_type, set)) report_error("invalid format specifier");
+      specs.set_type(pres_type);
+      return begin + 1;
+    }
+  } parse_presentation_type{begin, specs, arg_type};
+
+  for (;;) {
+    switch (c) {
+    case '<':
+    case '>':
+    case '^':
+      enter_state(state::align);
+      specs.set_align(parse_align(c));
+      ++begin;
+      break;
+    case '+':
+    case ' ':
+      specs.set_sign(c == ' ' ? sign::space : sign::plus);
+      FMT_FALLTHROUGH;
+    case '-':
+      enter_state(state::sign, in(arg_type, sint_set | float_set));
+      ++begin;
+      break;
+    case '#':
+      enter_state(state::hash, is_arithmetic_type(arg_type));
+      specs.set_alt();
+      ++begin;
+      break;
+    case '0':
+      enter_state(state::zero);
+      if (!is_arithmetic_type(arg_type))
+        report_error("format specifier requires numeric argument");
+      if (specs.align() == align::none) {
+        // Ignore 0 if align is specified for compatibility with std::format.
+        specs.set_align(align::numeric);
+        specs.set_fill('0');
+      }
+      ++begin;
+      break;
+      // clang-format off
+    case '1': case '2': case '3': case '4': case '5':
+    case '6': case '7': case '8': case '9': case '{':
+      // clang-format on
+      enter_state(state::width);
+      begin = parse_width(begin, end, specs, specs.width_ref, ctx);
+      break;
+    case '.':
+      enter_state(state::precision,
+                  in(arg_type, float_set | string_set | cstring_set));
+      begin = parse_precision(begin, end, specs, specs.precision_ref, ctx);
+      break;
+    case 'L':
+      enter_state(state::locale, is_arithmetic_type(arg_type));
+      specs.set_localized();
+      ++begin;
+      break;
+    case 'd': return parse_presentation_type(pres::dec, integral_set);
+    case 'X': specs.set_upper(); FMT_FALLTHROUGH;
+    case 'x': return parse_presentation_type(pres::hex, integral_set);
+    case 'o': return parse_presentation_type(pres::oct, integral_set);
+    case 'B': specs.set_upper(); FMT_FALLTHROUGH;
+    case 'b': return parse_presentation_type(pres::bin, integral_set);
+    case 'E': specs.set_upper(); FMT_FALLTHROUGH;
+    case 'e': return parse_presentation_type(pres::exp, float_set);
+    case 'F': specs.set_upper(); FMT_FALLTHROUGH;
+    case 'f': return parse_presentation_type(pres::fixed, float_set);
+    case 'G': specs.set_upper(); FMT_FALLTHROUGH;
+    case 'g': return parse_presentation_type(pres::general, float_set);
+    case 'A': specs.set_upper(); FMT_FALLTHROUGH;
+    case 'a': return parse_presentation_type(pres::hexfloat, float_set);
+    case 'c':
+      if (arg_type == type::bool_type) report_error("invalid format specifier");
+      return parse_presentation_type(pres::chr, integral_set);
+    case 's':
+      return parse_presentation_type(pres::string,
+                                     bool_set | string_set | cstring_set);
+    case 'p':
+      return parse_presentation_type(pres::pointer, pointer_set | cstring_set);
+    case '?':
+      return parse_presentation_type(pres::debug,
+                                     char_set | string_set | cstring_set);
+    case '}': return begin;
+    default:  {
+      if (*begin == '}') return begin;
+      // Parse fill and alignment.
+      auto fill_end = begin + code_point_length(begin);
+      if (end - fill_end <= 0) {
+        report_error("invalid format specifier");
+        return begin;
+      }
+      if (*begin == '{') {
+        report_error("invalid fill character '{'");
+        return begin;
+      }
+      auto alignment = parse_align(to_ascii(*fill_end));
+      enter_state(state::align, alignment != align::none);
+      specs.set_fill(
+          basic_string_view<Char>(begin, to_unsigned(fill_end - begin)));
+      specs.set_align(alignment);
+      begin = fill_end + 1;
+    }
+    }
+    if (begin == end) return begin;
+    c = to_ascii(*begin);
+  }
+}
+
+template <typename Char, typename Handler>
+FMT_CONSTEXPR FMT_INLINE auto parse_replacement_field(const Char* begin,
+                                                      const Char* end,
+                                                      Handler&& handler)
+    -> const Char* {
+  ++begin;
+  if (begin == end) {
+    handler.on_error("invalid format string");
+    return end;
+  }
+  int arg_id = 0;
+  switch (*begin) {
+  case '}':
+    handler.on_replacement_field(handler.on_arg_id(), begin);
+    return begin + 1;
+  case '{': handler.on_text(begin, begin + 1); return begin + 1;
+  case ':': arg_id = handler.on_arg_id(); break;
+  default:  {
+    struct id_adapter {
+      Handler& handler;
+      int arg_id;
+
+      FMT_CONSTEXPR void on_index(int id) { arg_id = handler.on_arg_id(id); }
+      FMT_CONSTEXPR void on_name(basic_string_view<Char> id) {
+        arg_id = handler.on_arg_id(id);
+      }
+    } adapter = {handler, 0};
+    begin = parse_arg_id(begin, end, adapter);
+    arg_id = adapter.arg_id;
+    Char c = begin != end ? *begin : Char();
+    if (c == '}') {
+      handler.on_replacement_field(arg_id, begin);
+      return begin + 1;
+    }
+    if (c != ':') {
+      handler.on_error("missing '}' in format string");
+      return end;
+    }
+    break;
+  }
+  }
+  begin = handler.on_format_specs(arg_id, begin + 1, end);
+  if (begin == end || *begin != '}')
+    return handler.on_error("unknown format specifier"), end;
+  return begin + 1;
+}
+
+template <typename Char, typename Handler>
+FMT_CONSTEXPR void parse_format_string(basic_string_view<Char> fmt,
+                                       Handler&& handler) {
+  auto begin = fmt.data(), end = begin + fmt.size();
+  auto p = begin;
+  while (p != end) {
+    auto c = *p++;
+    if (c == '{') {
+      handler.on_text(begin, p - 1);
+      begin = p = parse_replacement_field(p - 1, end, handler);
+    } else if (c == '}') {
+      if (p == end || *p != '}')
+        return handler.on_error("unmatched '}' in format string");
+      handler.on_text(begin, p);
+      begin = ++p;
+    }
+  }
+  handler.on_text(begin, end);
+}
+
+// Checks char specs and returns true iff the presentation type is char-like.
+FMT_CONSTEXPR inline auto check_char_specs(const format_specs& specs) -> bool {
+  auto type = specs.type();
+  if (type != presentation_type::none && type != presentation_type::chr &&
+      type != presentation_type::debug) {
+    return false;
+  }
+  if (specs.align() == align::numeric || specs.sign() != sign::none ||
+      specs.alt()) {
+    report_error("invalid format specifier for char");
+  }
+  return true;
+}
+
+// A base class for compile-time strings.
+struct compile_string {};
+
+template <typename T, typename Char>
+FMT_VISIBILITY("hidden")  // Suppress an ld warning on macOS (#3769).
+FMT_CONSTEXPR auto invoke_parse(parse_context<Char>& ctx) -> const Char* {
+  using mapped_type = remove_cvref_t<mapped_t<T, Char>>;
+  constexpr bool formattable =
+      std::is_constructible<formatter<mapped_type, Char>>::value;
+  if (!formattable) return ctx.begin();  // Error is reported in the value ctor.
+  using formatted_type = conditional_t<formattable, mapped_type, int>;
+  return formatter<formatted_type, Char>().parse(ctx);
+}
+
+template <typename... T> struct arg_pack {};
+
+template <typename Char, int NUM_ARGS, int NUM_NAMED_ARGS, bool DYNAMIC_NAMES>
+class format_string_checker {
+ private:
+  type types_[max_of(1, NUM_ARGS)];
+  named_arg_info<Char> named_args_[max_of(1, NUM_NAMED_ARGS)];
+  compile_parse_context<Char> context_;
+
+  using parse_func = auto (*)(parse_context<Char>&) -> const Char*;
+  parse_func parse_funcs_[max_of(1, NUM_ARGS)];
+
+ public:
+  template <typename... T>
+  explicit FMT_CONSTEXPR format_string_checker(basic_string_view<Char> fmt,
+                                               arg_pack<T...>)
+      : types_{mapped_type_constant<T, Char>::value...},
+        named_args_{},
+        context_(fmt, NUM_ARGS, types_),
+        parse_funcs_{&invoke_parse<T, Char>...} {
+    int arg_index = 0, named_arg_index = 0;
+    FMT_APPLY_VARIADIC(
+        init_static_named_arg<T>(named_args_, arg_index, named_arg_index));
+    ignore_unused(arg_index, named_arg_index);
+  }
+
+  FMT_CONSTEXPR void on_text(const Char*, const Char*) {}
+
+  FMT_CONSTEXPR auto on_arg_id() -> int { return context_.next_arg_id(); }
+  FMT_CONSTEXPR auto on_arg_id(int id) -> int {
+    context_.check_arg_id(id);
+    return id;
+  }
+  FMT_CONSTEXPR auto on_arg_id(basic_string_view<Char> id) -> int {
+    for (int i = 0; i < NUM_NAMED_ARGS; ++i) {
+      if (named_args_[i].name == id) return named_args_[i].id;
+    }
+    if (!DYNAMIC_NAMES) on_error("argument not found");
+    return -1;
+  }
+
+  FMT_CONSTEXPR void on_replacement_field(int id, const Char* begin) {
+    on_format_specs(id, begin, begin);  // Call parse() on empty specs.
+  }
+
+  FMT_CONSTEXPR auto on_format_specs(int id, const Char* begin, const Char* end)
+      -> const Char* {
+    context_.advance_to(begin);
+    if (id >= 0 && id < NUM_ARGS) return parse_funcs_[id](context_);
+    while (begin != end && *begin != '}') ++begin;
+    return begin;
+  }
+
+  FMT_NORETURN FMT_CONSTEXPR void on_error(const char* message) {
+    report_error(message);
+  }
+};
+
+/// A contiguous memory buffer with an optional growing ability. It is an
+/// internal class and shouldn't be used directly, only via `memory_buffer`.
+template <typename T> class buffer {
+ private:
+  T* ptr_;
+  size_t size_;
+  size_t capacity_;
+
+  using grow_fun = void (*)(buffer& buf, size_t capacity);
+  grow_fun grow_;
+
+ protected:
+  // Don't initialize ptr_ since it is not accessed to save a few cycles.
+  FMT_MSC_WARNING(suppress : 26495)
+  FMT_CONSTEXPR buffer(grow_fun grow, size_t sz) noexcept
+      : size_(sz), capacity_(sz), grow_(grow) {}
+
+  constexpr buffer(grow_fun grow, T* p = nullptr, size_t sz = 0,
+                   size_t cap = 0) noexcept
+      : ptr_(p), size_(sz), capacity_(cap), grow_(grow) {}
+
+  FMT_CONSTEXPR20 ~buffer() = default;
+  buffer(buffer&&) = default;
+
+  /// Sets the buffer data and capacity.
+  FMT_CONSTEXPR void set(T* buf_data, size_t buf_capacity) noexcept {
+    ptr_ = buf_data;
+    capacity_ = buf_capacity;
+  }
+
+ public:
+  using value_type = T;
+  using const_reference = const T&;
+
+  buffer(const buffer&) = delete;
+  void operator=(const buffer&) = delete;
+
+  auto begin() noexcept -> T* { return ptr_; }
+  auto end() noexcept -> T* { return ptr_ + size_; }
+
+  auto begin() const noexcept -> const T* { return ptr_; }
+  auto end() const noexcept -> const T* { return ptr_ + size_; }
+
+  /// Returns the size of this buffer.
+  constexpr auto size() const noexcept -> size_t { return size_; }
+
+  /// Returns the capacity of this buffer.
+  constexpr auto capacity() const noexcept -> size_t { return capacity_; }
+
+  /// Returns a pointer to the buffer data (not null-terminated).
+  FMT_CONSTEXPR auto data() noexcept -> T* { return ptr_; }
+  FMT_CONSTEXPR auto data() const noexcept -> const T* { return ptr_; }
+
+  /// Clears this buffer.
+  FMT_CONSTEXPR void clear() { size_ = 0; }
+
+  // Tries resizing the buffer to contain `count` elements. If T is a POD type
+  // the new elements may not be initialized.
+  FMT_CONSTEXPR void try_resize(size_t count) {
+    try_reserve(count);
+    size_ = min_of(count, capacity_);
+  }
+
+  // Tries increasing the buffer capacity to `new_capacity`. It can increase the
+  // capacity by a smaller amount than requested but guarantees there is space
+  // for at least one additional element either by increasing the capacity or by
+  // flushing the buffer if it is full.
+  FMT_CONSTEXPR void try_reserve(size_t new_capacity) {
+    if (new_capacity > capacity_) grow_(*this, new_capacity);
+  }
+
+  FMT_CONSTEXPR void push_back(const T& value) {
+    try_reserve(size_ + 1);
+    ptr_[size_++] = value;
+  }
+
+  /// Appends data to the end of the buffer.
+  template <typename U>
+// Workaround for MSVC2019 to fix error C2893: Failed to specialize function
+// template 'void fmt::v11::detail::buffer<T>::append(const U *,const U *)'.
+#if !FMT_MSC_VERSION || FMT_MSC_VERSION >= 1940
+  FMT_CONSTEXPR20
+#endif
+      void
+      append(const U* begin, const U* end) {
+    while (begin != end) {
+      auto count = to_unsigned(end - begin);
+      try_reserve(size_ + count);
+      auto free_cap = capacity_ - size_;
+      if (free_cap < count) count = free_cap;
+      // A loop is faster than memcpy on small sizes.
+      T* out = ptr_ + size_;
+      for (size_t i = 0; i < count; ++i) out[i] = begin[i];
+      size_ += count;
+      begin += count;
+    }
+  }
+
+  template <typename Idx> FMT_CONSTEXPR auto operator[](Idx index) -> T& {
+    return ptr_[index];
+  }
+  template <typename Idx>
+  FMT_CONSTEXPR auto operator[](Idx index) const -> const T& {
+    return ptr_[index];
+  }
+};
+
+struct buffer_traits {
+  constexpr explicit buffer_traits(size_t) {}
+  constexpr auto count() const -> size_t { return 0; }
+  constexpr auto limit(size_t size) const -> size_t { return size; }
+};
+
+class fixed_buffer_traits {
+ private:
+  size_t count_ = 0;
+  size_t limit_;
+
+ public:
+  constexpr explicit fixed_buffer_traits(size_t limit) : limit_(limit) {}
+  constexpr auto count() const -> size_t { return count_; }
+  FMT_CONSTEXPR auto limit(size_t size) -> size_t {
+    size_t n = limit_ > count_ ? limit_ - count_ : 0;
+    count_ += size;
+    return min_of(size, n);
+  }
+};
+
+// A buffer that writes to an output iterator when flushed.
+template <typename OutputIt, typename T, typename Traits = buffer_traits>
+class iterator_buffer : public Traits, public buffer<T> {
+ private:
+  OutputIt out_;
+  enum { buffer_size = 256 };
+  T data_[buffer_size];
+
+  static FMT_CONSTEXPR void grow(buffer<T>& buf, size_t) {
+    if (buf.size() == buffer_size) static_cast<iterator_buffer&>(buf).flush();
+  }
+
+  void flush() {
+    auto size = this->size();
+    this->clear();
+    const T* begin = data_;
+    const T* end = begin + this->limit(size);
+    while (begin != end) *out_++ = *begin++;
+  }
+
+ public:
+  explicit iterator_buffer(OutputIt out, size_t n = buffer_size)
+      : Traits(n), buffer<T>(grow, data_, 0, buffer_size), out_(out) {}
+  iterator_buffer(iterator_buffer&& other) noexcept
+      : Traits(other),
+        buffer<T>(grow, data_, 0, buffer_size),
+        out_(other.out_) {}
+  ~iterator_buffer() {
+    // Don't crash if flush fails during unwinding.
+    FMT_TRY { flush(); }
+    FMT_CATCH(...) {}
+  }
+
+  auto out() -> OutputIt {
+    flush();
+    return out_;
+  }
+  auto count() const -> size_t { return Traits::count() + this->size(); }
+};
+
+template <typename T>
+class iterator_buffer<T*, T, fixed_buffer_traits> : public fixed_buffer_traits,
+                                                    public buffer<T> {
+ private:
+  T* out_;
+  enum { buffer_size = 256 };
+  T data_[buffer_size];
+
+  static FMT_CONSTEXPR void grow(buffer<T>& buf, size_t) {
+    if (buf.size() == buf.capacity())
+      static_cast<iterator_buffer&>(buf).flush();
+  }
+
+  void flush() {
+    size_t n = this->limit(this->size());
+    if (this->data() == out_) {
+      out_ += n;
+      this->set(data_, buffer_size);
+    }
+    this->clear();
+  }
+
+ public:
+  explicit iterator_buffer(T* out, size_t n = buffer_size)
+      : fixed_buffer_traits(n), buffer<T>(grow, out, 0, n), out_(out) {}
+  iterator_buffer(iterator_buffer&& other) noexcept
+      : fixed_buffer_traits(other),
+        buffer<T>(static_cast<iterator_buffer&&>(other)),
+        out_(other.out_) {
+    if (this->data() != out_) {
+      this->set(data_, buffer_size);
+      this->clear();
+    }
+  }
+  ~iterator_buffer() { flush(); }
+
+  auto out() -> T* {
+    flush();
+    return out_;
+  }
+  auto count() const -> size_t {
+    return fixed_buffer_traits::count() + this->size();
+  }
+};
+
+template <typename T> class iterator_buffer<T*, T> : public buffer<T> {
+ public:
+  explicit iterator_buffer(T* out, size_t = 0)
+      : buffer<T>([](buffer<T>&, size_t) {}, out, 0, ~size_t()) {}
+
+  auto out() -> T* { return &*this->end(); }
+};
+
+template <typename Container>
+class container_buffer : public buffer<typename Container::value_type> {
+ private:
+  using value_type = typename Container::value_type;
+
+  static FMT_CONSTEXPR void grow(buffer<value_type>& buf, size_t capacity) {
+    auto& self = static_cast<container_buffer&>(buf);
+    self.container.resize(capacity);
+    self.set(&self.container[0], capacity);
+  }
+
+ public:
+  Container& container;
+
+  explicit container_buffer(Container& c)
+      : buffer<value_type>(grow, c.size()), container(c) {}
+};
+
+// A buffer that writes to a container with the contiguous storage.
+template <typename OutputIt>
+class iterator_buffer<
+    OutputIt,
+    enable_if_t<is_back_insert_iterator<OutputIt>::value &&
+                    is_contiguous<typename OutputIt::container_type>::value,
+                typename OutputIt::container_type::value_type>>
+    : public container_buffer<typename OutputIt::container_type> {
+ private:
+  using base = container_buffer<typename OutputIt::container_type>;
+
+ public:
+  explicit iterator_buffer(typename OutputIt::container_type& c) : base(c) {}
+  explicit iterator_buffer(OutputIt out, size_t = 0)
+      : base(get_container(out)) {}
+
+  auto out() -> OutputIt { return OutputIt(this->container); }
+};
+
+// A buffer that counts the number of code units written discarding the output.
+template <typename T = char> class counting_buffer : public buffer<T> {
+ private:
+  enum { buffer_size = 256 };
+  T data_[buffer_size];
+  size_t count_ = 0;
+
+  static FMT_CONSTEXPR void grow(buffer<T>& buf, size_t) {
+    if (buf.size() != buffer_size) return;
+    static_cast<counting_buffer&>(buf).count_ += buf.size();
+    buf.clear();
+  }
+
+ public:
+  FMT_CONSTEXPR counting_buffer() : buffer<T>(grow, data_, 0, buffer_size) {}
+
+  constexpr auto count() const noexcept -> size_t {
+    return count_ + this->size();
+  }
+};
+
+template <typename T>
+struct is_back_insert_iterator<basic_appender<T>> : std::true_type {};
+
+// An optimized version of std::copy with the output value type (T).
+template <typename T, typename InputIt, typename OutputIt,
+          FMT_ENABLE_IF(is_back_insert_iterator<OutputIt>::value)>
+FMT_CONSTEXPR20 auto copy(InputIt begin, InputIt end, OutputIt out)
+    -> OutputIt {
+  get_container(out).append(begin, end);
+  return out;
+}
+
+template <typename T, typename InputIt, typename OutputIt,
+          FMT_ENABLE_IF(!is_back_insert_iterator<OutputIt>::value)>
+FMT_CONSTEXPR auto copy(InputIt begin, InputIt end, OutputIt out) -> OutputIt {
+  while (begin != end) *out++ = static_cast<T>(*begin++);
+  return out;
+}
+
+template <typename T, typename V, typename OutputIt>
+FMT_CONSTEXPR auto copy(basic_string_view<V> s, OutputIt out) -> OutputIt {
+  return copy<T>(s.begin(), s.end(), out);
+}
+
+template <typename It, typename Enable = std::true_type>
+struct is_buffer_appender : std::false_type {};
+template <typename It>
+struct is_buffer_appender<
+    It, bool_constant<
+            is_back_insert_iterator<It>::value &&
+            std::is_base_of<buffer<typename It::container_type::value_type>,
+                            typename It::container_type>::value>>
+    : std::true_type {};
+
+// Maps an output iterator to a buffer.
+template <typename T, typename OutputIt,
+          FMT_ENABLE_IF(!is_buffer_appender<OutputIt>::value)>
+auto get_buffer(OutputIt out) -> iterator_buffer<OutputIt, T> {
+  return iterator_buffer<OutputIt, T>(out);
+}
+template <typename T, typename OutputIt,
+          FMT_ENABLE_IF(is_buffer_appender<OutputIt>::value)>
+auto get_buffer(OutputIt out) -> buffer<T>& {
+  return get_container(out);
+}
+
+template <typename Buf, typename OutputIt>
+auto get_iterator(Buf& buf, OutputIt) -> decltype(buf.out()) {
+  return buf.out();
+}
+template <typename T, typename OutputIt>
+auto get_iterator(buffer<T>&, OutputIt out) -> OutputIt {
+  return out;
+}
+
+// This type is intentionally undefined, only used for errors.
+template <typename T, typename Char> struct type_is_unformattable_for;
+
+template <typename Char> struct string_value {
+  const Char* data;
+  size_t size;
+  auto str() const -> basic_string_view<Char> { return {data, size}; }
+};
+
+template <typename Context> struct custom_value {
+  using char_type = typename Context::char_type;
+  void* value;
+  void (*format)(void* arg, parse_context<char_type>& parse_ctx, Context& ctx);
+};
+
+template <typename Char> struct named_arg_value {
+  const named_arg_info<Char>* data;
+  size_t size;
+};
+
+struct custom_tag {};
+
+#if !FMT_BUILTIN_TYPES
+#  define FMT_BUILTIN , monostate
+#else
+#  define FMT_BUILTIN
+#endif
+
+// A formatting argument value.
+template <typename Context> class value {
+ public:
+  using char_type = typename Context::char_type;
+
+  union {
+    monostate no_value;
+    int int_value;
+    unsigned uint_value;
+    long long long_long_value;
+    unsigned long long ulong_long_value;
+    int128_opt int128_value;
+    uint128_opt uint128_value;
+    bool bool_value;
+    char_type char_value;
+    float float_value;
+    double double_value;
+    long double long_double_value;
+    const void* pointer;
+    string_value<char_type> string;
+    custom_value<Context> custom;
+    named_arg_value<char_type> named_args;
+  };
+
+  constexpr FMT_INLINE value() : no_value() {}
+  constexpr FMT_INLINE value(signed char x) : int_value(x) {}
+  constexpr FMT_INLINE value(unsigned char x FMT_BUILTIN) : uint_value(x) {}
+  constexpr FMT_INLINE value(signed short x) : int_value(x) {}
+  constexpr FMT_INLINE value(unsigned short x FMT_BUILTIN) : uint_value(x) {}
+  constexpr FMT_INLINE value(int x) : int_value(x) {}
+  constexpr FMT_INLINE value(unsigned x FMT_BUILTIN) : uint_value(x) {}
+  FMT_CONSTEXPR FMT_INLINE value(long x FMT_BUILTIN) : value(long_type(x)) {}
+  FMT_CONSTEXPR FMT_INLINE value(unsigned long x FMT_BUILTIN)
+      : value(ulong_type(x)) {}
+  constexpr FMT_INLINE value(long long x FMT_BUILTIN) : long_long_value(x) {}
+  constexpr FMT_INLINE value(unsigned long long x FMT_BUILTIN)
+      : ulong_long_value(x) {}
+  FMT_INLINE value(int128_opt x FMT_BUILTIN) : int128_value(x) {}
+  FMT_INLINE value(uint128_opt x FMT_BUILTIN) : uint128_value(x) {}
+  constexpr FMT_INLINE value(bool x FMT_BUILTIN) : bool_value(x) {}
+
+  template <int N>
+  constexpr FMT_INLINE value(bitint<N> x FMT_BUILTIN) : long_long_value(x) {
+    static_assert(N <= 64, "unsupported _BitInt");
+  }
+  template <int N>
+  constexpr FMT_INLINE value(ubitint<N> x FMT_BUILTIN) : ulong_long_value(x) {
+    static_assert(N <= 64, "unsupported _BitInt");
+  }
+
+  template <typename T, FMT_ENABLE_IF(is_char<T>::value)>
+  constexpr FMT_INLINE value(T x FMT_BUILTIN) : char_value(x) {
+    static_assert(
+        std::is_same<T, char>::value || std::is_same<T, char_type>::value,
+        "mixing character types is disallowed");
+  }
+
+  constexpr FMT_INLINE value(float x FMT_BUILTIN) : float_value(x) {}
+  constexpr FMT_INLINE value(double x FMT_BUILTIN) : double_value(x) {}
+  FMT_INLINE value(long double x FMT_BUILTIN) : long_double_value(x) {}
+
+  FMT_CONSTEXPR FMT_INLINE value(char_type* x FMT_BUILTIN) {
+    string.data = x;
+    if (is_constant_evaluated()) string.size = 0;
+  }
+  FMT_CONSTEXPR FMT_INLINE value(const char_type* x FMT_BUILTIN) {
+    string.data = x;
+    if (is_constant_evaluated()) string.size = 0;
+  }
+  template <typename T, typename C = char_t<T>,
+            FMT_ENABLE_IF(!std::is_pointer<T>::value)>
+  FMT_CONSTEXPR value(const T& x FMT_BUILTIN) {
+    static_assert(std::is_same<C, char_type>::value,
+                  "mixing character types is disallowed");
+    auto sv = to_string_view(x);
+    string.data = sv.data();
+    string.size = sv.size();
+  }
+  FMT_INLINE value(void* x FMT_BUILTIN) : pointer(x) {}
+  FMT_INLINE value(const void* x FMT_BUILTIN) : pointer(x) {}
+  FMT_INLINE value(volatile void* x FMT_BUILTIN)
+      : pointer(const_cast<const void*>(x)) {}
+  FMT_INLINE value(const volatile void* x FMT_BUILTIN)
+      : pointer(const_cast<const void*>(x)) {}
+  FMT_INLINE value(nullptr_t) : pointer(nullptr) {}
+
+  template <typename T, FMT_ENABLE_IF(std::is_pointer<T>::value ||
+                                      std::is_member_pointer<T>::value)>
+  value(const T&) {
+    // Formatting of arbitrary pointers is disallowed. If you want to format a
+    // pointer cast it to `void*` or `const void*`. In particular, this forbids
+    // formatting of `[const] volatile char*` printed as bool by iostreams.
+    static_assert(sizeof(T) == 0,
+                  "formatting of non-void pointers is disallowed");
+  }
+
+  template <typename T, FMT_ENABLE_IF(use_format_as<T>::value)>
+  value(const T& x) : value(format_as(x)) {}
+  template <typename T, FMT_ENABLE_IF(use_format_as_member<T>::value)>
+  value(const T& x) : value(formatter<T>::format_as(x)) {}
+
+  template <typename T, FMT_ENABLE_IF(is_named_arg<T>::value)>
+  value(const T& named_arg) : value(named_arg.value) {}
+
+  template <typename T,
+            FMT_ENABLE_IF(use_formatter<T>::value || !FMT_BUILTIN_TYPES)>
+  FMT_CONSTEXPR20 FMT_INLINE value(T& x) : value(x, custom_tag()) {}
+
+  FMT_ALWAYS_INLINE value(const named_arg_info<char_type>* args, size_t size)
+      : named_args{args, size} {}
+
+ private:
+  template <typename T, FMT_ENABLE_IF(has_formatter<T, char_type>())>
+  FMT_CONSTEXPR value(T& x, custom_tag) {
+    using value_type = remove_const_t<T>;
+    // T may overload operator& e.g. std::vector<bool>::reference in libc++.
+    if (!is_constant_evaluated()) {
+      custom.value =
+          const_cast<char*>(&reinterpret_cast<const volatile char&>(x));
+    } else {
+      custom.value = nullptr;
+#if defined(__cpp_if_constexpr)
+      if constexpr (std::is_same<decltype(&x), remove_reference_t<T>*>::value)
+        custom.value = const_cast<value_type*>(&x);
+#endif
+    }
+    custom.format = format_custom<value_type, formatter<value_type, char_type>>;
+  }
+
+  template <typename T, FMT_ENABLE_IF(!has_formatter<T, char_type>())>
+  FMT_CONSTEXPR value(const T&, custom_tag) {
+    // Cannot format an argument; to make type T formattable provide a
+    // formatter<T> specialization: https://fmt.dev/latest/api.html#udt.
+    type_is_unformattable_for<T, char_type> _;
+  }
+
+  // Formats an argument of a custom type, such as a user-defined class.
+  template <typename T, typename Formatter>
+  static void format_custom(void* arg, parse_context<char_type>& parse_ctx,
+                            Context& ctx) {
+    auto f = Formatter();
+    parse_ctx.advance_to(f.parse(parse_ctx));
+    using qualified_type =
+        conditional_t<has_formatter<const T, char_type>(), const T, T>;
+    // format must be const for compatibility with std::format and compilation.
+    const auto& cf = f;
+    ctx.advance_to(cf.format(*static_cast<qualified_type*>(arg), ctx));
+  }
+};
+
+enum { packed_arg_bits = 4 };
+// Maximum number of arguments with packed types.
+enum { max_packed_args = 62 / packed_arg_bits };
+enum : unsigned long long { is_unpacked_bit = 1ULL << 63 };
+enum : unsigned long long { has_named_args_bit = 1ULL << 62 };
+
+template <typename It, typename T, typename Enable = void>
+struct is_output_iterator : std::false_type {};
+
+template <> struct is_output_iterator<appender, char> : std::true_type {};
+
+template <typename It, typename T>
+struct is_output_iterator<
+    It, T,
+    void_t<decltype(*std::declval<decay_t<It>&>()++ = std::declval<T>())>>
+    : std::true_type {};
+
+#ifndef FMT_USE_LOCALE
+#  define FMT_USE_LOCALE (FMT_OPTIMIZE_SIZE <= 1)
+#endif
+
+// A type-erased reference to an std::locale to avoid a heavy <locale> include.
+struct locale_ref {
+#if FMT_USE_LOCALE
+ private:
+  const void* locale_;  // A type-erased pointer to std::locale.
+
+ public:
+  constexpr locale_ref() : locale_(nullptr) {}
+
+  template <typename Locale, FMT_ENABLE_IF(sizeof(Locale::collate) != 0)>
+  locale_ref(const Locale& loc);
+
+  inline explicit operator bool() const noexcept { return locale_ != nullptr; }
+#endif  // FMT_USE_LOCALE
+
+  template <typename Locale> auto get() const -> Locale;
+};
+
+template <typename> constexpr auto encode_types() -> unsigned long long {
+  return 0;
+}
+
+template <typename Context, typename Arg, typename... Args>
+constexpr auto encode_types() -> unsigned long long {
+  return static_cast<unsigned>(stored_type_constant<Arg, Context>::value) |
+         (encode_types<Context, Args...>() << packed_arg_bits);
+}
+
+template <typename Context, typename... T, size_t NUM_ARGS = sizeof...(T)>
+constexpr auto make_descriptor() -> unsigned long long {
+  return NUM_ARGS <= max_packed_args ? encode_types<Context, T...>()
+                                     : is_unpacked_bit | NUM_ARGS;
+}
+
+template <typename Context, size_t NUM_ARGS>
+using arg_t = conditional_t<NUM_ARGS <= max_packed_args, value<Context>,
+                            basic_format_arg<Context>>;
+
+template <typename Context, size_t NUM_ARGS, size_t NUM_NAMED_ARGS,
+          unsigned long long DESC>
+struct named_arg_store {
+  // args_[0].named_args points to named_args to avoid bloating format_args.
+  arg_t<Context, NUM_ARGS> args[1 + NUM_ARGS];
+  named_arg_info<typename Context::char_type> named_args[NUM_NAMED_ARGS];
+
+  template <typename... T>
+  FMT_CONSTEXPR FMT_ALWAYS_INLINE named_arg_store(T&... values)
+      : args{{named_args, NUM_NAMED_ARGS}, values...} {
+    int arg_index = 0, named_arg_index = 0;
+    FMT_APPLY_VARIADIC(
+        init_named_arg(named_args, arg_index, named_arg_index, values));
+  }
+
+  named_arg_store(named_arg_store&& rhs) {
+    args[0] = {named_args, NUM_NAMED_ARGS};
+    for (size_t i = 1; i < sizeof(args) / sizeof(*args); ++i)
+      args[i] = rhs.args[i];
+    for (size_t i = 0; i < NUM_NAMED_ARGS; ++i)
+      named_args[i] = rhs.named_args[i];
+  }
+
+  named_arg_store(const named_arg_store& rhs) = delete;
+  named_arg_store& operator=(const named_arg_store& rhs) = delete;
+  named_arg_store& operator=(named_arg_store&& rhs) = delete;
+  operator const arg_t<Context, NUM_ARGS>*() const { return args + 1; }
+};
+
+// An array of references to arguments. It can be implicitly converted to
+// `basic_format_args` for passing into type-erased formatting functions
+// such as `vformat`. It is a plain struct to reduce binary size in debug mode.
+template <typename Context, size_t NUM_ARGS, size_t NUM_NAMED_ARGS,
+          unsigned long long DESC>
+struct format_arg_store {
+  // +1 to workaround a bug in gcc 7.5 that causes duplicated-branches warning.
+  using type =
+      conditional_t<NUM_NAMED_ARGS == 0,
+                    arg_t<Context, NUM_ARGS>[max_of<size_t>(1, NUM_ARGS)],
+                    named_arg_store<Context, NUM_ARGS, NUM_NAMED_ARGS, DESC>>;
+  type args;
+};
+
+// TYPE can be different from type_constant<T>, e.g. for __float128.
+template <typename T, typename Char, type TYPE> struct native_formatter {
+ private:
+  dynamic_format_specs<Char> specs_;
+
+ public:
+  using nonlocking = void;
+
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    if (ctx.begin() == ctx.end() || *ctx.begin() == '}') return ctx.begin();
+    auto end = parse_format_specs(ctx.begin(), ctx.end(), specs_, ctx, TYPE);
+    if (const_check(TYPE == type::char_type)) check_char_specs(specs_);
+    return end;
+  }
+
+  template <type U = TYPE,
+            FMT_ENABLE_IF(U == type::string_type || U == type::cstring_type ||
+                          U == type::char_type)>
+  FMT_CONSTEXPR void set_debug_format(bool set = true) {
+    specs_.set_type(set ? presentation_type::debug : presentation_type::none);
+  }
+
+  FMT_PRAGMA_CLANG(diagnostic ignored "-Wundefined-inline")
+  template <typename FormatContext>
+  FMT_CONSTEXPR auto format(const T& val, FormatContext& ctx) const
+      -> decltype(ctx.out());
+};
+
+template <typename T, typename Enable = void>
+struct locking
+    : bool_constant<mapped_type_constant<T>::value == type::custom_type> {};
+template <typename T>
+struct locking<T, void_t<typename formatter<remove_cvref_t<T>>::nonlocking>>
+    : std::false_type {};
+
+template <typename T = int> FMT_CONSTEXPR inline auto is_locking() -> bool {
+  return locking<T>::value;
+}
+template <typename T1, typename T2, typename... Tail>
+FMT_CONSTEXPR inline auto is_locking() -> bool {
+  return locking<T1>::value || is_locking<T2, Tail...>();
+}
+
+FMT_API void vformat_to(buffer<char>& buf, string_view fmt, format_args args,
+                        locale_ref loc = {});
+
+#if FMT_WIN32
+FMT_API void vprint_mojibake(FILE*, string_view, format_args, bool);
+#else  // format_args is passed by reference since it is defined later.
+inline void vprint_mojibake(FILE*, string_view, const format_args&, bool) {}
+#endif
+}  // namespace detail
+
+// The main public API.
+
+template <typename Char>
+FMT_CONSTEXPR void parse_context<Char>::do_check_arg_id(int arg_id) {
+  // Argument id is only checked at compile time during parsing because
+  // formatting has its own validation.
+  if (detail::is_constant_evaluated() && use_constexpr_cast) {
+    auto ctx = static_cast<detail::compile_parse_context<Char>*>(this);
+    if (arg_id >= ctx->num_args()) report_error("argument not found");
+  }
+}
+
+template <typename Char>
+FMT_CONSTEXPR void parse_context<Char>::check_dynamic_spec(int arg_id) {
+  using detail::compile_parse_context;
+  if (detail::is_constant_evaluated() && use_constexpr_cast)
+    static_cast<compile_parse_context<Char>*>(this)->check_dynamic_spec(arg_id);
+}
+
+FMT_BEGIN_EXPORT
+
+// An output iterator that appends to a buffer. It is used instead of
+// back_insert_iterator to reduce symbol sizes and avoid <iterator> dependency.
+template <typename T> class basic_appender {
+ protected:
+  detail::buffer<T>* container;
+
+ public:
+  using container_type = detail::buffer<T>;
+
+  FMT_CONSTEXPR basic_appender(detail::buffer<T>& buf) : container(&buf) {}
+
+  FMT_CONSTEXPR20 auto operator=(T c) -> basic_appender& {
+    container->push_back(c);
+    return *this;
+  }
+  FMT_CONSTEXPR20 auto operator*() -> basic_appender& { return *this; }
+  FMT_CONSTEXPR20 auto operator++() -> basic_appender& { return *this; }
+  FMT_CONSTEXPR20 auto operator++(int) -> basic_appender { return *this; }
+};
+
+// A formatting argument. Context is a template parameter for the compiled API
+// where output can be unbuffered.
+template <typename Context> class basic_format_arg {
+ private:
+  detail::value<Context> value_;
+  detail::type type_;
+
+  friend class basic_format_args<Context>;
+
+  using char_type = typename Context::char_type;
+
+ public:
+  class handle {
+   private:
+    detail::custom_value<Context> custom_;
+
+   public:
+    explicit handle(detail::custom_value<Context> custom) : custom_(custom) {}
+
+    void format(parse_context<char_type>& parse_ctx, Context& ctx) const {
+      custom_.format(custom_.value, parse_ctx, ctx);
+    }
+  };
+
+  constexpr basic_format_arg() : type_(detail::type::none_type) {}
+  basic_format_arg(const detail::named_arg_info<char_type>* args, size_t size)
+      : value_(args, size) {}
+  template <typename T>
+  basic_format_arg(T&& val)
+      : value_(val), type_(detail::stored_type_constant<T, Context>::value) {}
+
+  constexpr explicit operator bool() const noexcept {
+    return type_ != detail::type::none_type;
+  }
+  auto type() const -> detail::type { return type_; }
+
+  /**
+   * Visits an argument dispatching to the appropriate visit method based on
+   * the argument type. For example, if the argument type is `double` then
+   * `vis(value)` will be called with the value of type `double`.
+   */
+  template <typename Visitor>
+  FMT_CONSTEXPR FMT_INLINE auto visit(Visitor&& vis) const -> decltype(vis(0)) {
+    using detail::map;
+    switch (type_) {
+    case detail::type::none_type:        break;
+    case detail::type::int_type:         return vis(value_.int_value);
+    case detail::type::uint_type:        return vis(value_.uint_value);
+    case detail::type::long_long_type:   return vis(value_.long_long_value);
+    case detail::type::ulong_long_type:  return vis(value_.ulong_long_value);
+    case detail::type::int128_type:      return vis(map(value_.int128_value));
+    case detail::type::uint128_type:     return vis(map(value_.uint128_value));
+    case detail::type::bool_type:        return vis(value_.bool_value);
+    case detail::type::char_type:        return vis(value_.char_value);
+    case detail::type::float_type:       return vis(value_.float_value);
+    case detail::type::double_type:      return vis(value_.double_value);
+    case detail::type::long_double_type: return vis(value_.long_double_value);
+    case detail::type::cstring_type:     return vis(value_.string.data);
+    case detail::type::string_type:      return vis(value_.string.str());
+    case detail::type::pointer_type:     return vis(value_.pointer);
+    case detail::type::custom_type:      return vis(handle(value_.custom));
+    }
+    return vis(monostate());
+  }
+
+  auto format_custom(const char_type* parse_begin,
+                     parse_context<char_type>& parse_ctx, Context& ctx)
+      -> bool {
+    if (type_ != detail::type::custom_type) return false;
+    parse_ctx.advance_to(parse_begin);
+    value_.custom.format(value_.custom.value, parse_ctx, ctx);
+    return true;
+  }
+};
+
+/**
+ * A view of a collection of formatting arguments. To avoid lifetime issues it
+ * should only be used as a parameter type in type-erased functions such as
+ * `vformat`:
+ *
+ *     void vlog(fmt::string_view fmt, fmt::format_args args);  // OK
+ *     fmt::format_args args = fmt::make_format_args();  // Dangling reference
+ */
+template <typename Context> class basic_format_args {
+ private:
+  // A descriptor that contains information about formatting arguments.
+  // If the number of arguments is less or equal to max_packed_args then
+  // argument types are passed in the descriptor. This reduces binary code size
+  // per formatting function call.
+  unsigned long long desc_;
+  union {
+    // If is_packed() returns true then argument values are stored in values_;
+    // otherwise they are stored in args_. This is done to improve cache
+    // locality and reduce compiled code size since storing larger objects
+    // may require more code (at least on x86-64) even if the same amount of
+    // data is actually copied to stack. It saves ~10% on the bloat test.
+    const detail::value<Context>* values_;
+    const basic_format_arg<Context>* args_;
+  };
+
+  constexpr auto is_packed() const -> bool {
+    return (desc_ & detail::is_unpacked_bit) == 0;
+  }
+  constexpr auto has_named_args() const -> bool {
+    return (desc_ & detail::has_named_args_bit) != 0;
+  }
+
+  FMT_CONSTEXPR auto type(int index) const -> detail::type {
+    int shift = index * detail::packed_arg_bits;
+    unsigned mask = (1 << detail::packed_arg_bits) - 1;
+    return static_cast<detail::type>((desc_ >> shift) & mask);
+  }
+
+  template <size_t NUM_ARGS, size_t NUM_NAMED_ARGS, unsigned long long DESC>
+  using store =
+      detail::format_arg_store<Context, NUM_ARGS, NUM_NAMED_ARGS, DESC>;
+
+ public:
+  using format_arg = basic_format_arg<Context>;
+
+  constexpr basic_format_args() : desc_(0), args_(nullptr) {}
+
+  /// Constructs a `basic_format_args` object from `format_arg_store`.
+  template <size_t NUM_ARGS, size_t NUM_NAMED_ARGS, unsigned long long DESC,
+            FMT_ENABLE_IF(NUM_ARGS <= detail::max_packed_args)>
+  constexpr FMT_ALWAYS_INLINE basic_format_args(
+      const store<NUM_ARGS, NUM_NAMED_ARGS, DESC>& s)
+      : desc_(DESC | (NUM_NAMED_ARGS != 0 ? +detail::has_named_args_bit : 0)),
+        values_(s.args) {}
+
+  template <size_t NUM_ARGS, size_t NUM_NAMED_ARGS, unsigned long long DESC,
+            FMT_ENABLE_IF(NUM_ARGS > detail::max_packed_args)>
+  constexpr basic_format_args(const store<NUM_ARGS, NUM_NAMED_ARGS, DESC>& s)
+      : desc_(DESC | (NUM_NAMED_ARGS != 0 ? +detail::has_named_args_bit : 0)),
+        args_(s.args) {}
+
+  /// Constructs a `basic_format_args` object from a dynamic list of arguments.
+  constexpr basic_format_args(const format_arg* args, int count,
+                              bool has_named = false)
+      : desc_(detail::is_unpacked_bit | detail::to_unsigned(count) |
+              (has_named ? +detail::has_named_args_bit : 0)),
+        args_(args) {}
+
+  /// Returns the argument with the specified id.
+  FMT_CONSTEXPR auto get(int id) const -> format_arg {
+    auto arg = format_arg();
+    if (!is_packed()) {
+      if (id < max_size()) arg = args_[id];
+      return arg;
+    }
+    if (static_cast<unsigned>(id) >= detail::max_packed_args) return arg;
+    arg.type_ = type(id);
+    if (arg.type_ != detail::type::none_type) arg.value_ = values_[id];
+    return arg;
+  }
+
+  template <typename Char>
+  auto get(basic_string_view<Char> name) const -> format_arg {
+    int id = get_id(name);
+    return id >= 0 ? get(id) : format_arg();
+  }
+
+  template <typename Char>
+  FMT_CONSTEXPR auto get_id(basic_string_view<Char> name) const -> int {
+    if (!has_named_args()) return -1;
+    const auto& named_args =
+        (is_packed() ? values_[-1] : args_[-1].value_).named_args;
+    for (size_t i = 0; i < named_args.size; ++i) {
+      if (named_args.data[i].name == name) return named_args.data[i].id;
+    }
+    return -1;
+  }
+
+  auto max_size() const -> int {
+    unsigned long long max_packed = detail::max_packed_args;
+    return static_cast<int>(is_packed() ? max_packed
+                                        : desc_ & ~detail::is_unpacked_bit);
+  }
+};
+
+// A formatting context.
+class context : private detail::locale_ref {
+ private:
+  appender out_;
+  format_args args_;
+
+ public:
+  /// The character type for the output.
+  using char_type = char;
+
+  using iterator = appender;
+  using format_arg = basic_format_arg<context>;
+  using parse_context_type FMT_DEPRECATED = parse_context<>;
+  template <typename T> using formatter_type FMT_DEPRECATED = formatter<T>;
+  enum { builtin_types = FMT_BUILTIN_TYPES };
+
+  /// Constructs a `context` object. References to the arguments are stored
+  /// in the object so make sure they have appropriate lifetimes.
+  FMT_CONSTEXPR context(iterator out, format_args args,
+                        detail::locale_ref loc = {})
+      : locale_ref(loc), out_(out), args_(args) {}
+  context(context&&) = default;
+  context(const context&) = delete;
+  void operator=(const context&) = delete;
+
+  FMT_CONSTEXPR auto arg(int id) const -> format_arg { return args_.get(id); }
+  inline auto arg(string_view name) -> format_arg { return args_.get(name); }
+  FMT_CONSTEXPR auto arg_id(string_view name) -> int {
+    return args_.get_id(name);
+  }
+
+  // Returns an iterator to the beginning of the output range.
+  FMT_CONSTEXPR auto out() -> iterator { return out_; }
+
+  // Advances the begin iterator to `it`.
+  FMT_CONSTEXPR void advance_to(iterator) {}
+
+  FMT_CONSTEXPR auto locale() -> detail::locale_ref { return *this; }
+};
+
+template <typename Char = char> struct runtime_format_string {
+  basic_string_view<Char> str;
+};
+
+/**
+ * Creates a runtime format string.
+ *
+ * **Example**:
+ *
+ *     // Check format string at runtime instead of compile-time.
+ *     fmt::print(fmt::runtime("{:d}"), "I am not a number");
+ */
+inline auto runtime(string_view s) -> runtime_format_string<> { return {{s}}; }
+
+/// A compile-time format string.
+template <typename... T> struct fstring {
+ private:
+  static constexpr int num_static_named_args =
+      detail::count_static_named_args<T...>();
+
+  using checker = detail::format_string_checker<
+      char, static_cast<int>(sizeof...(T)), num_static_named_args,
+      num_static_named_args != detail::count_named_args<T...>()>;
+
+  using arg_pack = detail::arg_pack<T...>;
+
+ public:
+  string_view str;
+  using t = fstring;
+
+  // Reports a compile-time error if S is not a valid format string for T.
+  template <size_t N>
+  FMT_CONSTEVAL FMT_ALWAYS_INLINE fstring(const char (&s)[N]) : str(s, N - 1) {
+    using namespace detail;
+    static_assert(count<(std::is_base_of<view, remove_reference_t<T>>::value &&
+                         std::is_reference<T>::value)...>() == 0,
+                  "passing views as lvalues is disallowed");
+    if (FMT_USE_CONSTEVAL) parse_format_string<char>(s, checker(s, arg_pack()));
+#ifdef FMT_ENFORCE_COMPILE_STRING
+    static_assert(
+        FMT_USE_CONSTEVAL && sizeof(s) != 0,
+        "FMT_ENFORCE_COMPILE_STRING requires format strings to use FMT_STRING");
+#endif
+  }
+  template <typename S,
+            FMT_ENABLE_IF(std::is_convertible<const S&, string_view>::value)>
+  FMT_CONSTEVAL FMT_ALWAYS_INLINE fstring(const S& s) : str(s) {
+    auto sv = string_view(str);
+    if (FMT_USE_CONSTEVAL)
+      detail::parse_format_string<char>(sv, checker(sv, arg_pack()));
+#ifdef FMT_ENFORCE_COMPILE_STRING
+    static_assert(
+        FMT_USE_CONSTEVAL && sizeof(s) != 0,
+        "FMT_ENFORCE_COMPILE_STRING requires format strings to use FMT_STRING");
+#endif
+  }
+  template <typename S,
+            FMT_ENABLE_IF(std::is_base_of<detail::compile_string, S>::value&&
+                              std::is_same<typename S::char_type, char>::value)>
+  FMT_ALWAYS_INLINE fstring(const S&) : str(S()) {
+    FMT_CONSTEXPR auto sv = string_view(S());
+    FMT_CONSTEXPR int ignore =
+        (parse_format_string(sv, checker(sv, arg_pack())), 0);
+    detail::ignore_unused(ignore);
+  }
+  fstring(runtime_format_string<> fmt) : str(fmt.str) {}
+
+  // Returning by reference generates better code in debug mode.
+  FMT_ALWAYS_INLINE operator const string_view&() const { return str; }
+  auto get() const -> string_view { return str; }
+};
+
+template <typename... T> using format_string = typename fstring<T...>::t;
+
+template <typename T, typename Char = char>
+using is_formattable = bool_constant<!std::is_same<
+    detail::mapped_t<conditional_t<std::is_void<T>::value, int*, T>, Char>,
+    void>::value>;
+#ifdef __cpp_concepts
+template <typename T, typename Char = char>
+concept formattable = is_formattable<remove_reference_t<T>, Char>::value;
+#endif
+
+template <typename T, typename Char>
+using has_formatter FMT_DEPRECATED = std::is_constructible<formatter<T, Char>>;
+
+// A formatter specialization for natively supported types.
+template <typename T, typename Char>
+struct formatter<T, Char,
+                 enable_if_t<detail::type_constant<T, Char>::value !=
+                             detail::type::custom_type>>
+    : detail::native_formatter<T, Char, detail::type_constant<T, Char>::value> {
+};
+
+/**
+ * Constructs an object that stores references to arguments and can be
+ * implicitly converted to `format_args`. `Context` can be omitted in which case
+ * it defaults to `context`. See `arg` for lifetime considerations.
+ */
+// Take arguments by lvalue references to avoid some lifetime issues, e.g.
+//   auto args = make_format_args(std::string());
+template <typename Context = context, typename... T,
+          size_t NUM_ARGS = sizeof...(T),
+          size_t NUM_NAMED_ARGS = detail::count_named_args<T...>(),
+          unsigned long long DESC = detail::make_descriptor<Context, T...>()>
+constexpr FMT_ALWAYS_INLINE auto make_format_args(T&... args)
+    -> detail::format_arg_store<Context, NUM_ARGS, NUM_NAMED_ARGS, DESC> {
+  // Suppress warnings for pathological types convertible to detail::value.
+  FMT_PRAGMA_GCC(diagnostic ignored "-Wconversion")
+  return {{args...}};
+}
+
+template <typename... T>
+using vargs =
+    detail::format_arg_store<context, sizeof...(T),
+                             detail::count_named_args<T...>(),
+                             detail::make_descriptor<context, T...>()>;
+
+/**
+ * Returns a named argument to be used in a formatting function.
+ * It should only be used in a call to a formatting function.
+ *
+ * **Example**:
+ *
+ *     fmt::print("The answer is {answer}.", fmt::arg("answer", 42));
+ */
+template <typename Char, typename T>
+inline auto arg(const Char* name, const T& arg) -> detail::named_arg<Char, T> {
+  return {name, arg};
+}
+
+/// Formats a string and writes the output to `out`.
+template <typename OutputIt,
+          FMT_ENABLE_IF(detail::is_output_iterator<remove_cvref_t<OutputIt>,
+                                                   char>::value)>
+auto vformat_to(OutputIt&& out, string_view fmt, format_args args)
+    -> remove_cvref_t<OutputIt> {
+  auto&& buf = detail::get_buffer<char>(out);
+  detail::vformat_to(buf, fmt, args, {});
+  return detail::get_iterator(buf, out);
+}
+
+/**
+ * Formats `args` according to specifications in `fmt`, writes the result to
+ * the output iterator `out` and returns the iterator past the end of the output
+ * range. `format_to` does not append a terminating null character.
+ *
+ * **Example**:
+ *
+ *     auto out = std::vector<char>();
+ *     fmt::format_to(std::back_inserter(out), "{}", 42);
+ */
+template <typename OutputIt, typename... T,
+          FMT_ENABLE_IF(detail::is_output_iterator<remove_cvref_t<OutputIt>,
+                                                   char>::value)>
+FMT_INLINE auto format_to(OutputIt&& out, format_string<T...> fmt, T&&... args)
+    -> remove_cvref_t<OutputIt> {
+  return vformat_to(out, fmt.str, vargs<T...>{{args...}});
+}
+
+template <typename OutputIt> struct format_to_n_result {
+  /// Iterator past the end of the output range.
+  OutputIt out;
+  /// Total (not truncated) output size.
+  size_t size;
+};
+
+template <typename OutputIt, typename... T,
+          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
+auto vformat_to_n(OutputIt out, size_t n, string_view fmt, format_args args)
+    -> format_to_n_result<OutputIt> {
+  using traits = detail::fixed_buffer_traits;
+  auto buf = detail::iterator_buffer<OutputIt, char, traits>(out, n);
+  detail::vformat_to(buf, fmt, args, {});
+  return {buf.out(), buf.count()};
+}
+
+/**
+ * Formats `args` according to specifications in `fmt`, writes up to `n`
+ * characters of the result to the output iterator `out` and returns the total
+ * (not truncated) output size and the iterator past the end of the output
+ * range. `format_to_n` does not append a terminating null character.
+ */
+template <typename OutputIt, typename... T,
+          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
+FMT_INLINE auto format_to_n(OutputIt out, size_t n, format_string<T...> fmt,
+                            T&&... args) -> format_to_n_result<OutputIt> {
+  return vformat_to_n(out, n, fmt.str, vargs<T...>{{args...}});
+}
+
+struct format_to_result {
+  /// Pointer to just after the last successful write in the array.
+  char* out;
+  /// Specifies if the output was truncated.
+  bool truncated;
+
+  FMT_CONSTEXPR operator char*() const {
+    // Report truncation to prevent silent data loss.
+    if (truncated) report_error("output is truncated");
+    return out;
+  }
+};
+
+template <size_t N>
+auto vformat_to(char (&out)[N], string_view fmt, format_args args)
+    -> format_to_result {
+  auto result = vformat_to_n(out, N, fmt, args);
+  return {result.out, result.size > N};
+}
+
+template <size_t N, typename... T>
+FMT_INLINE auto format_to(char (&out)[N], format_string<T...> fmt, T&&... args)
+    -> format_to_result {
+  auto result = vformat_to_n(out, N, fmt.str, vargs<T...>{{args...}});
+  return {result.out, result.size > N};
+}
+
+/// Returns the number of chars in the output of `format(fmt, args...)`.
+template <typename... T>
+FMT_NODISCARD FMT_INLINE auto formatted_size(format_string<T...> fmt,
+                                             T&&... args) -> size_t {
+  auto buf = detail::counting_buffer<>();
+  detail::vformat_to(buf, fmt.str, vargs<T...>{{args...}}, {});
+  return buf.count();
+}
+
+FMT_API void vprint(string_view fmt, format_args args);
+FMT_API void vprint(FILE* f, string_view fmt, format_args args);
+FMT_API void vprintln(FILE* f, string_view fmt, format_args args);
+FMT_API void vprint_buffered(FILE* f, string_view fmt, format_args args);
+
+/**
+ * Formats `args` according to specifications in `fmt` and writes the output
+ * to `stdout`.
+ *
+ * **Example**:
+ *
+ *     fmt::print("The answer is {}.", 42);
+ */
+template <typename... T>
+FMT_INLINE void print(format_string<T...> fmt, T&&... args) {
+  vargs<T...> va = {{args...}};
+  if (!detail::use_utf8)
+    return detail::vprint_mojibake(stdout, fmt.str, va, false);
+  return detail::is_locking<T...>() ? vprint_buffered(stdout, fmt.str, va)
+                                    : vprint(fmt.str, va);
+}
+
+/**
+ * Formats `args` according to specifications in `fmt` and writes the
+ * output to the file `f`.
+ *
+ * **Example**:
+ *
+ *     fmt::print(stderr, "Don't {}!", "panic");
+ */
+template <typename... T>
+FMT_INLINE void print(FILE* f, format_string<T...> fmt, T&&... args) {
+  vargs<T...> va = {{args...}};
+  if (!detail::use_utf8) return detail::vprint_mojibake(f, fmt.str, va, false);
+  return detail::is_locking<T...>() ? vprint_buffered(f, fmt.str, va)
+                                    : vprint(f, fmt.str, va);
+}
+
+/// Formats `args` according to specifications in `fmt` and writes the output
+/// to the file `f` followed by a newline.
+template <typename... T>
+FMT_INLINE void println(FILE* f, format_string<T...> fmt, T&&... args) {
+  vargs<T...> va = {{args...}};
+  return detail::use_utf8 ? vprintln(f, fmt.str, va)
+                          : detail::vprint_mojibake(f, fmt.str, va, true);
+}
+
+/// Formats `args` according to specifications in `fmt` and writes the output
+/// to `stdout` followed by a newline.
+template <typename... T>
+FMT_INLINE void println(format_string<T...> fmt, T&&... args) {
+  return fmt::println(stdout, fmt, static_cast<T&&>(args)...);
+}
+
+FMT_END_EXPORT
+FMT_PRAGMA_CLANG(diagnostic pop)
+FMT_PRAGMA_GCC(pop_options)
+FMT_END_NAMESPACE
+
+#ifdef FMT_HEADER_ONLY
+#  include "format.h"
+#endif
+#endif  // FMT_BASE_H_
diff --git a/include/fmt/chrono.h b/include/fmt/chrono.h
index 9d54574e..abf3671e 100644
--- a/include/fmt/chrono.h
+++ b/include/fmt/chrono.h
@@ -8,51 +8,36 @@
 #ifndef FMT_CHRONO_H_
 #define FMT_CHRONO_H_
 
-#include <algorithm>
-#include <chrono>
-#include <cmath>    // std::isfinite
-#include <cstring>  // std::memcpy
-#include <ctime>
-#include <iterator>
-#include <locale>
-#include <ostream>
-#include <type_traits>
-
-#include "ostream.h"  // formatbuf
+#ifndef FMT_MODULE
+#  include <algorithm>
+#  include <chrono>
+#  include <cmath>    // std::isfinite
+#  include <cstring>  // std::memcpy
+#  include <ctime>
+#  include <iterator>
+#  include <locale>
+#  include <ostream>
+#  include <type_traits>
+#endif
 
-FMT_BEGIN_NAMESPACE
+#include "format.h"
 
-// Check if std::chrono::local_t is available.
-#ifndef FMT_USE_LOCAL_TIME
-#  ifdef __cpp_lib_chrono
-#    define FMT_USE_LOCAL_TIME (__cpp_lib_chrono >= 201907L)
-#  else
-#    define FMT_USE_LOCAL_TIME 0
-#  endif
-#endif
+namespace fmt_detail {
+struct time_zone {
+  template <typename Duration, typename T>
+  auto to_sys(T)
+      -> std::chrono::time_point<std::chrono::system_clock, Duration> {
+    return {};
+  }
+};
+template <typename... T> inline auto current_zone(T...) -> time_zone* {
+  return nullptr;
+}
 
-// Check if std::chrono::utc_timestamp is available.
-#ifndef FMT_USE_UTC_TIME
-#  ifdef __cpp_lib_chrono
-#    define FMT_USE_UTC_TIME (__cpp_lib_chrono >= 201907L)
-#  else
-#    define FMT_USE_UTC_TIME 0
-#  endif
-#endif
+template <typename... T> inline void _tzset(T...) {}
+}  // namespace fmt_detail
 
-// Enable tzset.
-#ifndef FMT_USE_TZSET
-// UWP doesn't provide _tzset.
-#  if FMT_HAS_INCLUDE("winapifamily.h")
-#    include <winapifamily.h>
-#  endif
-#  if defined(_WIN32) && (!defined(WINAPI_FAMILY) || \
-                          (WINAPI_FAMILY == WINAPI_FAMILY_DESKTOP_APP))
-#    define FMT_USE_TZSET 1
-#  else
-#    define FMT_USE_TZSET 0
-#  endif
-#endif
+FMT_BEGIN_NAMESPACE
 
 // Enable safe chrono durations, unless explicitly disabled.
 #ifndef FMT_SAFE_DURATION_CAST
@@ -94,10 +79,8 @@ FMT_CONSTEXPR auto lossless_integral_conversion(const From from, int& ec)
   return static_cast<To>(from);
 }
 
-/**
- * converts From to To, without loss. If the dynamic value of from
- * can't be converted to To without loss, ec is set.
- */
+/// Converts From to To, without loss. If the dynamic value of from
+/// can't be converted to To without loss, ec is set.
 template <typename To, typename From,
           FMT_ENABLE_IF(!std::is_same<From, To>::value &&
                         std::numeric_limits<From>::is_signed !=
@@ -185,61 +168,7 @@ FMT_CONSTEXPR auto safe_float_conversion(const From from, int& ec) -> To {
   return from;
 }
 
-/**
- * safe duration cast between integral durations
- */
-template <typename To, typename FromRep, typename FromPeriod,
-          FMT_ENABLE_IF(std::is_integral<FromRep>::value),
-          FMT_ENABLE_IF(std::is_integral<typename To::rep>::value)>
-auto safe_duration_cast(std::chrono::duration<FromRep, FromPeriod> from,
-                        int& ec) -> To {
-  using From = std::chrono::duration<FromRep, FromPeriod>;
-  ec = 0;
-  // the basic idea is that we need to convert from count() in the from type
-  // to count() in the To type, by multiplying it with this:
-  struct Factor
-      : std::ratio_divide<typename From::period, typename To::period> {};
-
-  static_assert(Factor::num > 0, "num must be positive");
-  static_assert(Factor::den > 0, "den must be positive");
-
-  // the conversion is like this: multiply from.count() with Factor::num
-  // /Factor::den and convert it to To::rep, all this without
-  // overflow/underflow. let's start by finding a suitable type that can hold
-  // both To, From and Factor::num
-  using IntermediateRep =
-      typename std::common_type<typename From::rep, typename To::rep,
-                                decltype(Factor::num)>::type;
-
-  // safe conversion to IntermediateRep
-  IntermediateRep count =
-      lossless_integral_conversion<IntermediateRep>(from.count(), ec);
-  if (ec) return {};
-  // multiply with Factor::num without overflow or underflow
-  if (detail::const_check(Factor::num != 1)) {
-    const auto max1 = detail::max_value<IntermediateRep>() / Factor::num;
-    if (count > max1) {
-      ec = 1;
-      return {};
-    }
-    const auto min1 =
-        (std::numeric_limits<IntermediateRep>::min)() / Factor::num;
-    if (detail::const_check(!std::is_unsigned<IntermediateRep>::value) &&
-        count < min1) {
-      ec = 1;
-      return {};
-    }
-    count *= Factor::num;
-  }
-
-  if (detail::const_check(Factor::den != 1)) count /= Factor::den;
-  auto tocount = lossless_integral_conversion<typename To::rep>(count, ec);
-  return ec ? To() : To(tocount);
-}
-
-/**
- * safe duration_cast between floating point durations
- */
+/// Safe duration_cast between floating point durations
 template <typename To, typename FromRep, typename FromPeriod,
           FMT_ENABLE_IF(std::is_floating_point<FromRep>::value),
           FMT_ENABLE_IF(std::is_floating_point<typename To::rep>::value)>
@@ -318,17 +247,94 @@ auto safe_duration_cast(std::chrono::duration<FromRep, FromPeriod> from,
 }  // namespace safe_duration_cast
 #endif
 
+namespace detail {
+
+// Check if std::chrono::utc_time is available.
+#ifdef FMT_USE_UTC_TIME
+// Use the provided definition.
+#elif defined(__cpp_lib_chrono)
+#  define FMT_USE_UTC_TIME (__cpp_lib_chrono >= 201907L)
+#else
+#  define FMT_USE_UTC_TIME 0
+#endif
+#if FMT_USE_UTC_TIME
+using utc_clock = std::chrono::utc_clock;
+#else
+struct utc_clock {
+  void to_sys();
+};
+#endif
+
+// Check if std::chrono::local_time is available.
+#ifdef FMT_USE_LOCAL_TIME
+// Use the provided definition.
+#elif defined(__cpp_lib_chrono)
+#  define FMT_USE_LOCAL_TIME (__cpp_lib_chrono >= 201907L)
+#else
+#  define FMT_USE_LOCAL_TIME 0
+#endif
+#if FMT_USE_LOCAL_TIME
+using local_t = std::chrono::local_t;
+#else
+struct local_t {};
+#endif
+
+}  // namespace detail
+
+template <typename Duration>
+using sys_time = std::chrono::time_point<std::chrono::system_clock, Duration>;
+
+template <typename Duration>
+using utc_time = std::chrono::time_point<detail::utc_clock, Duration>;
+
+template <class Duration>
+using local_time = std::chrono::time_point<detail::local_t, Duration>;
+
+namespace detail {
+
 // Prevents expansion of a preceding token as a function-style macro.
 // Usage: f FMT_NOMACRO()
 #define FMT_NOMACRO
 
-namespace detail {
 template <typename T = void> struct null {};
 inline auto localtime_r FMT_NOMACRO(...) -> null<> { return null<>(); }
 inline auto localtime_s(...) -> null<> { return null<>(); }
 inline auto gmtime_r(...) -> null<> { return null<>(); }
 inline auto gmtime_s(...) -> null<> { return null<>(); }
 
+// It is defined here and not in ostream.h because the latter has expensive
+// includes.
+template <typename StreamBuf> class formatbuf : public StreamBuf {
+ private:
+  using char_type = typename StreamBuf::char_type;
+  using streamsize = decltype(std::declval<StreamBuf>().sputn(nullptr, 0));
+  using int_type = typename StreamBuf::int_type;
+  using traits_type = typename StreamBuf::traits_type;
+
+  buffer<char_type>& buffer_;
+
+ public:
+  explicit formatbuf(buffer<char_type>& buf) : buffer_(buf) {}
+
+ protected:
+  // The put area is always empty. This makes the implementation simpler and has
+  // the advantage that the streambuf and the buffer are always in sync and
+  // sputc never writes into uninitialized memory. A disadvantage is that each
+  // call to sputc always results in a (virtual) call to overflow. There is no
+  // disadvantage here for sputn since this always results in a call to xsputn.
+
+  auto overflow(int_type ch) -> int_type override {
+    if (!traits_type::eq_int_type(ch, traits_type::eof()))
+      buffer_.push_back(static_cast<char_type>(ch));
+    return ch;
+  }
+
+  auto xsputn(const char_type* s, streamsize count) -> streamsize override {
+    buffer_.append(s, s + count);
+    return count;
+  }
+};
+
 inline auto get_classic_locale() -> const std::locale& {
   static const auto& locale = std::locale::classic();
   return locale;
@@ -341,20 +347,16 @@ template <typename CodeUnit> struct codecvt_result {
 };
 
 template <typename CodeUnit>
-void write_codecvt(codecvt_result<CodeUnit>& out, string_view in_buf,
+void write_codecvt(codecvt_result<CodeUnit>& out, string_view in,
                    const std::locale& loc) {
-#if FMT_CLANG_VERSION
-#  pragma clang diagnostic push
-#  pragma clang diagnostic ignored "-Wdeprecated"
-  auto& f = std::use_facet<std::codecvt<CodeUnit, char, std::mbstate_t>>(loc);
-#  pragma clang diagnostic pop
-#else
+  FMT_PRAGMA_CLANG(diagnostic push)
+  FMT_PRAGMA_CLANG(diagnostic ignored "-Wdeprecated")
   auto& f = std::use_facet<std::codecvt<CodeUnit, char, std::mbstate_t>>(loc);
-#endif
+  FMT_PRAGMA_CLANG(diagnostic pop)
   auto mb = std::mbstate_t();
   const char* from_next = nullptr;
-  auto result = f.in(mb, in_buf.begin(), in_buf.end(), from_next,
-                     std::begin(out.buf), std::end(out.buf), out.end);
+  auto result = f.in(mb, in.begin(), in.end(), from_next, std::begin(out.buf),
+                     std::end(out.buf), out.end);
   if (result != std::codecvt_base::ok)
     FMT_THROW(format_error("failed to format time"));
 }
@@ -362,11 +364,12 @@ void write_codecvt(codecvt_result<CodeUnit>& out, string_view in_buf,
 template <typename OutputIt>
 auto write_encoded_tm_str(OutputIt out, string_view in, const std::locale& loc)
     -> OutputIt {
-  if (detail::is_utf8() && loc != get_classic_locale()) {
+  if (detail::use_utf8 && loc != get_classic_locale()) {
     // char16_t and char32_t codecvts are broken in MSVC (linkage errors) and
     // gcc-4.
-#if FMT_MSC_VERSION != 0 || \
-    (defined(__GLIBCXX__) && !defined(_GLIBCXX_USE_DUAL_ABI))
+#if FMT_MSC_VERSION != 0 ||  \
+    (defined(__GLIBCXX__) && \
+     (!defined(_GLIBCXX_USE_DUAL_ABI) || _GLIBCXX_USE_DUAL_ABI == 0))
     // The _GLIBCXX_USE_DUAL_ABI macro is always defined in libstdc++ from gcc-5
     // and newer.
     using code_unit = wchar_t;
@@ -382,9 +385,9 @@ auto write_encoded_tm_str(OutputIt out, string_view in, const std::locale& loc)
         to_utf8<code_unit, basic_memory_buffer<char, unit_t::max_size * 4>>();
     if (!u.convert({unit.buf, to_unsigned(unit.end - unit.buf)}))
       FMT_THROW(format_error("failed to format time"));
-    return copy_str<char>(u.c_str(), u.c_str() + u.size(), out);
+    return copy<char>(u.c_str(), u.c_str() + u.size(), out);
   }
-  return copy_str<char>(in.data(), in.data() + in.size(), out);
+  return copy<char>(in.data(), in.data() + in.size(), out);
 }
 
 template <typename Char, typename OutputIt,
@@ -393,7 +396,7 @@ auto write_tm_str(OutputIt out, string_view sv, const std::locale& loc)
     -> OutputIt {
   codecvt_result<Char> unit;
   write_codecvt(unit, sv, loc);
-  return copy_str<Char>(unit.buf, unit.end, out);
+  return copy<Char>(unit.buf, unit.end, out);
 }
 
 template <typename Char, typename OutputIt,
@@ -441,16 +444,56 @@ struct is_same_arithmetic_type
                                          std::is_floating_point<Rep2>::value)> {
 };
 
-template <
-    typename To, typename FromRep, typename FromPeriod,
-    FMT_ENABLE_IF(is_same_arithmetic_type<FromRep, typename To::rep>::value)>
-auto fmt_duration_cast(std::chrono::duration<FromRep, FromPeriod> from) -> To {
+FMT_NORETURN inline void throw_duration_error() {
+  FMT_THROW(format_error("cannot format duration"));
+}
+
+// Cast one integral duration to another with an overflow check.
+template <typename To, typename FromRep, typename FromPeriod,
+          FMT_ENABLE_IF(std::is_integral<FromRep>::value&&
+                            std::is_integral<typename To::rep>::value)>
+auto duration_cast(std::chrono::duration<FromRep, FromPeriod> from) -> To {
+#if !FMT_SAFE_DURATION_CAST
+  return std::chrono::duration_cast<To>(from);
+#else
+  // The conversion factor: to.count() == factor * from.count().
+  using factor = std::ratio_divide<FromPeriod, typename To::period>;
+
+  using common_rep = typename std::common_type<FromRep, typename To::rep,
+                                               decltype(factor::num)>::type;
+
+  int ec = 0;
+  auto count = safe_duration_cast::lossless_integral_conversion<common_rep>(
+      from.count(), ec);
+  if (ec) throw_duration_error();
+
+  // Multiply from.count() by factor and check for overflow.
+  if (const_check(factor::num != 1)) {
+    if (count > max_value<common_rep>() / factor::num) throw_duration_error();
+    const auto min = (std::numeric_limits<common_rep>::min)() / factor::num;
+    if (const_check(!std::is_unsigned<common_rep>::value) && count < min)
+      throw_duration_error();
+    count *= factor::num;
+  }
+  if (const_check(factor::den != 1)) count /= factor::den;
+  auto to =
+      To(safe_duration_cast::lossless_integral_conversion<typename To::rep>(
+          count, ec));
+  if (ec) throw_duration_error();
+  return to;
+#endif
+}
+
+template <typename To, typename FromRep, typename FromPeriod,
+          FMT_ENABLE_IF(std::is_floating_point<FromRep>::value&&
+                            std::is_floating_point<typename To::rep>::value)>
+auto duration_cast(std::chrono::duration<FromRep, FromPeriod> from) -> To {
 #if FMT_SAFE_DURATION_CAST
   // Throwing version of safe_duration_cast is only available for
   // integer to integer or float to float casts.
   int ec;
   To to = safe_duration_cast::safe_duration_cast<To>(from, ec);
-  if (ec) FMT_THROW(format_error("cannot format duration"));
+  if (ec) throw_duration_error();
   return to;
 #else
   // Standard duration cast, may overflow.
@@ -461,54 +504,60 @@ auto fmt_duration_cast(std::chrono::duration<FromRep, FromPeriod> from) -> To {
 template <
     typename To, typename FromRep, typename FromPeriod,
     FMT_ENABLE_IF(!is_same_arithmetic_type<FromRep, typename To::rep>::value)>
-auto fmt_duration_cast(std::chrono::duration<FromRep, FromPeriod> from) -> To {
+auto duration_cast(std::chrono::duration<FromRep, FromPeriod> from) -> To {
   // Mixed integer <-> float cast is not supported by safe_duration_cast.
   return std::chrono::duration_cast<To>(from);
 }
 
 template <typename Duration>
-auto to_time_t(
-    std::chrono::time_point<std::chrono::system_clock, Duration> time_point)
-    -> std::time_t {
+auto to_time_t(sys_time<Duration> time_point) -> std::time_t {
   // Cannot use std::chrono::system_clock::to_time_t since this would first
   // require a cast to std::chrono::system_clock::time_point, which could
   // overflow.
-  return fmt_duration_cast<std::chrono::duration<std::time_t>>(
+  return detail::duration_cast<std::chrono::duration<std::time_t>>(
              time_point.time_since_epoch())
       .count();
 }
+
+// Workaround a bug in libstdc++ which sets __cpp_lib_chrono to 201907 without
+// providing current_zone(): https://github.com/fmtlib/fmt/issues/4160.
+template <typename T> FMT_CONSTEXPR auto has_current_zone() -> bool {
+  using namespace std::chrono;
+  using namespace fmt_detail;
+  return !std::is_same<decltype(current_zone()), fmt_detail::time_zone*>::value;
+}
 }  // namespace detail
 
 FMT_BEGIN_EXPORT
 
 /**
-  Converts given time since epoch as ``std::time_t`` value into calendar time,
-  expressed in local time. Unlike ``std::localtime``, this function is
-  thread-safe on most platforms.
+ * Converts given time since epoch as `std::time_t` value into calendar time,
+ * expressed in local time. Unlike `std::localtime`, this function is
+ * thread-safe on most platforms.
  */
 inline auto localtime(std::time_t time) -> std::tm {
   struct dispatcher {
     std::time_t time_;
     std::tm tm_;
 
-    dispatcher(std::time_t t) : time_(t) {}
+    inline dispatcher(std::time_t t) : time_(t) {}
 
-    auto run() -> bool {
+    inline auto run() -> bool {
       using namespace fmt::detail;
       return handle(localtime_r(&time_, &tm_));
     }
 
-    auto handle(std::tm* tm) -> bool { return tm != nullptr; }
+    inline auto handle(std::tm* tm) -> bool { return tm != nullptr; }
 
-    auto handle(detail::null<>) -> bool {
+    inline auto handle(detail::null<>) -> bool {
       using namespace fmt::detail;
       return fallback(localtime_s(&tm_, &time_));
     }
 
-    auto fallback(int res) -> bool { return res == 0; }
+    inline auto fallback(int res) -> bool { return res == 0; }
 
 #if !FMT_MSC_VERSION
-    auto fallback(detail::null<>) -> bool {
+    inline auto fallback(detail::null<>) -> bool {
       using namespace fmt::detail;
       std::tm* tm = std::localtime(&time_);
       if (tm) tm_ = *tm;
@@ -523,41 +572,43 @@ inline auto localtime(std::time_t time) -> std::tm {
 }
 
 #if FMT_USE_LOCAL_TIME
-template <typename Duration>
+template <typename Duration,
+          FMT_ENABLE_IF(detail::has_current_zone<Duration>())>
 inline auto localtime(std::chrono::local_time<Duration> time) -> std::tm {
-  return localtime(
-      detail::to_time_t(std::chrono::current_zone()->to_sys(time)));
+  using namespace std::chrono;
+  using namespace fmt_detail;
+  return localtime(detail::to_time_t(current_zone()->to_sys<Duration>(time)));
 }
 #endif
 
 /**
-  Converts given time since epoch as ``std::time_t`` value into calendar time,
-  expressed in Coordinated Universal Time (UTC). Unlike ``std::gmtime``, this
-  function is thread-safe on most platforms.
+ * Converts given time since epoch as `std::time_t` value into calendar time,
+ * expressed in Coordinated Universal Time (UTC). Unlike `std::gmtime`, this
+ * function is thread-safe on most platforms.
  */
 inline auto gmtime(std::time_t time) -> std::tm {
   struct dispatcher {
     std::time_t time_;
     std::tm tm_;
 
-    dispatcher(std::time_t t) : time_(t) {}
+    inline dispatcher(std::time_t t) : time_(t) {}
 
-    auto run() -> bool {
+    inline auto run() -> bool {
       using namespace fmt::detail;
       return handle(gmtime_r(&time_, &tm_));
     }
 
-    auto handle(std::tm* tm) -> bool { return tm != nullptr; }
+    inline auto handle(std::tm* tm) -> bool { return tm != nullptr; }
 
-    auto handle(detail::null<>) -> bool {
+    inline auto handle(detail::null<>) -> bool {
       using namespace fmt::detail;
       return fallback(gmtime_s(&tm_, &time_));
     }
 
-    auto fallback(int res) -> bool { return res == 0; }
+    inline auto fallback(int res) -> bool { return res == 0; }
 
 #if !FMT_MSC_VERSION
-    auto fallback(detail::null<>) -> bool {
+    inline auto fallback(detail::null<>) -> bool {
       std::tm* tm = std::gmtime(&time_);
       if (tm) tm_ = *tm;
       return tm != nullptr;
@@ -571,9 +622,7 @@ inline auto gmtime(std::time_t time) -> std::tm {
 }
 
 template <typename Duration>
-inline auto gmtime(
-    std::chrono::time_point<std::chrono::system_clock, Duration> time_point)
-    -> std::tm {
+inline auto gmtime(sys_time<Duration> time_point) -> std::tm {
   return gmtime(detail::to_time_t(time_point));
 }
 
@@ -619,7 +668,8 @@ FMT_CONSTEXPR inline auto get_units() -> const char* {
   if (std::is_same<Period, std::femto>::value) return "fs";
   if (std::is_same<Period, std::pico>::value) return "ps";
   if (std::is_same<Period, std::nano>::value) return "ns";
-  if (std::is_same<Period, std::micro>::value) return "s";
+  if (std::is_same<Period, std::micro>::value)
+    return detail::use_utf8 ? "s" : "us";
   if (std::is_same<Period, std::milli>::value) return "ms";
   if (std::is_same<Period, std::centi>::value) return "cs";
   if (std::is_same<Period, std::deci>::value) return "ds";
@@ -646,12 +696,10 @@ enum class numeric_system {
 
 // Glibc extensions for formatting numeric values.
 enum class pad_type {
-  unspecified,
+  // Pad a numeric result string with zeros (the default).
+  zero,
   // Do not pad a numeric result string.
   none,
-  // Pad a numeric result string with zeros even if the conversion specifier
-  // character uses space-padding by default.
-  zero,
   // Pad a numeric result string with spaces.
   space,
 };
@@ -659,7 +707,7 @@ enum class pad_type {
 template <typename OutputIt>
 auto write_padding(OutputIt out, pad_type pad, int width) -> OutputIt {
   if (pad == pad_type::none) return out;
-  return std::fill_n(out, width, pad == pad_type::space ? ' ' : '0');
+  return detail::fill_n(out, width, pad == pad_type::space ? ' ' : '0');
 }
 
 template <typename OutputIt>
@@ -675,8 +723,8 @@ FMT_CONSTEXPR auto parse_chrono_format(const Char* begin, const Char* end,
   if (begin == end || *begin == '}') return begin;
   if (*begin != '%') FMT_THROW(format_error("invalid format"));
   auto ptr = begin;
-  pad_type pad = pad_type::unspecified;
   while (ptr != end) {
+    pad_type pad = pad_type::zero;
     auto c = *ptr;
     if (c == '}') break;
     if (c != '%') {
@@ -696,17 +744,11 @@ FMT_CONSTEXPR auto parse_chrono_format(const Char* begin, const Char* end,
       pad = pad_type::none;
       ++ptr;
       break;
-    case '0':
-      pad = pad_type::zero;
-      ++ptr;
-      break;
     }
     if (ptr == end) FMT_THROW(format_error("invalid format"));
     c = *ptr++;
     switch (c) {
-    case '%':
-      handler.on_text(ptr - 1, ptr);
-      break;
+    case '%': handler.on_text(ptr - 1, ptr); break;
     case 'n': {
       const Char newline[] = {'\n'};
       handler.on_text(newline, newline + 1);
@@ -718,145 +760,66 @@ FMT_CONSTEXPR auto parse_chrono_format(const Char* begin, const Char* end,
       break;
     }
     // Year:
-    case 'Y':
-      handler.on_year(numeric_system::standard);
-      break;
-    case 'y':
-      handler.on_short_year(numeric_system::standard);
-      break;
-    case 'C':
-      handler.on_century(numeric_system::standard);
-      break;
-    case 'G':
-      handler.on_iso_week_based_year();
-      break;
-    case 'g':
-      handler.on_iso_week_based_short_year();
-      break;
+    case 'Y': handler.on_year(numeric_system::standard, pad); break;
+    case 'y': handler.on_short_year(numeric_system::standard); break;
+    case 'C': handler.on_century(numeric_system::standard); break;
+    case 'G': handler.on_iso_week_based_year(); break;
+    case 'g': handler.on_iso_week_based_short_year(); break;
     // Day of the week:
-    case 'a':
-      handler.on_abbr_weekday();
-      break;
-    case 'A':
-      handler.on_full_weekday();
-      break;
-    case 'w':
-      handler.on_dec0_weekday(numeric_system::standard);
-      break;
-    case 'u':
-      handler.on_dec1_weekday(numeric_system::standard);
-      break;
+    case 'a': handler.on_abbr_weekday(); break;
+    case 'A': handler.on_full_weekday(); break;
+    case 'w': handler.on_dec0_weekday(numeric_system::standard); break;
+    case 'u': handler.on_dec1_weekday(numeric_system::standard); break;
     // Month:
     case 'b':
-    case 'h':
-      handler.on_abbr_month();
-      break;
-    case 'B':
-      handler.on_full_month();
-      break;
-    case 'm':
-      handler.on_dec_month(numeric_system::standard);
-      break;
+    case 'h': handler.on_abbr_month(); break;
+    case 'B': handler.on_full_month(); break;
+    case 'm': handler.on_dec_month(numeric_system::standard, pad); break;
     // Day of the year/month:
     case 'U':
-      handler.on_dec0_week_of_year(numeric_system::standard);
+      handler.on_dec0_week_of_year(numeric_system::standard, pad);
       break;
     case 'W':
-      handler.on_dec1_week_of_year(numeric_system::standard);
-      break;
-    case 'V':
-      handler.on_iso_week_of_year(numeric_system::standard);
-      break;
-    case 'j':
-      handler.on_day_of_year();
-      break;
-    case 'd':
-      handler.on_day_of_month(numeric_system::standard);
+      handler.on_dec1_week_of_year(numeric_system::standard, pad);
       break;
+    case 'V': handler.on_iso_week_of_year(numeric_system::standard, pad); break;
+    case 'j': handler.on_day_of_year(pad); break;
+    case 'd': handler.on_day_of_month(numeric_system::standard, pad); break;
     case 'e':
-      handler.on_day_of_month_space(numeric_system::standard);
+      handler.on_day_of_month(numeric_system::standard, pad_type::space);
       break;
     // Hour, minute, second:
-    case 'H':
-      handler.on_24_hour(numeric_system::standard, pad);
-      break;
-    case 'I':
-      handler.on_12_hour(numeric_system::standard, pad);
-      break;
-    case 'M':
-      handler.on_minute(numeric_system::standard, pad);
-      break;
-    case 'S':
-      handler.on_second(numeric_system::standard, pad);
-      break;
+    case 'H': handler.on_24_hour(numeric_system::standard, pad); break;
+    case 'I': handler.on_12_hour(numeric_system::standard, pad); break;
+    case 'M': handler.on_minute(numeric_system::standard, pad); break;
+    case 'S': handler.on_second(numeric_system::standard, pad); break;
     // Other:
-    case 'c':
-      handler.on_datetime(numeric_system::standard);
-      break;
-    case 'x':
-      handler.on_loc_date(numeric_system::standard);
-      break;
-    case 'X':
-      handler.on_loc_time(numeric_system::standard);
-      break;
-    case 'D':
-      handler.on_us_date();
-      break;
-    case 'F':
-      handler.on_iso_date();
-      break;
-    case 'r':
-      handler.on_12_hour_time();
-      break;
-    case 'R':
-      handler.on_24_hour_time();
-      break;
-    case 'T':
-      handler.on_iso_time();
-      break;
-    case 'p':
-      handler.on_am_pm();
-      break;
-    case 'Q':
-      handler.on_duration_value();
-      break;
-    case 'q':
-      handler.on_duration_unit();
-      break;
-    case 'z':
-      handler.on_utc_offset(numeric_system::standard);
-      break;
-    case 'Z':
-      handler.on_tz_name();
-      break;
+    case 'c': handler.on_datetime(numeric_system::standard); break;
+    case 'x': handler.on_loc_date(numeric_system::standard); break;
+    case 'X': handler.on_loc_time(numeric_system::standard); break;
+    case 'D': handler.on_us_date(); break;
+    case 'F': handler.on_iso_date(); break;
+    case 'r': handler.on_12_hour_time(); break;
+    case 'R': handler.on_24_hour_time(); break;
+    case 'T': handler.on_iso_time(); break;
+    case 'p': handler.on_am_pm(); break;
+    case 'Q': handler.on_duration_value(); break;
+    case 'q': handler.on_duration_unit(); break;
+    case 'z': handler.on_utc_offset(numeric_system::standard); break;
+    case 'Z': handler.on_tz_name(); break;
     // Alternative representation:
     case 'E': {
       if (ptr == end) FMT_THROW(format_error("invalid format"));
       c = *ptr++;
       switch (c) {
-      case 'Y':
-        handler.on_year(numeric_system::alternative);
-        break;
-      case 'y':
-        handler.on_offset_year();
-        break;
-      case 'C':
-        handler.on_century(numeric_system::alternative);
-        break;
-      case 'c':
-        handler.on_datetime(numeric_system::alternative);
-        break;
-      case 'x':
-        handler.on_loc_date(numeric_system::alternative);
-        break;
-      case 'X':
-        handler.on_loc_time(numeric_system::alternative);
-        break;
-      case 'z':
-        handler.on_utc_offset(numeric_system::alternative);
-        break;
-      default:
-        FMT_THROW(format_error("invalid format"));
+      case 'Y': handler.on_year(numeric_system::alternative, pad); break;
+      case 'y': handler.on_offset_year(); break;
+      case 'C': handler.on_century(numeric_system::alternative); break;
+      case 'c': handler.on_datetime(numeric_system::alternative); break;
+      case 'x': handler.on_loc_date(numeric_system::alternative); break;
+      case 'X': handler.on_loc_time(numeric_system::alternative); break;
+      case 'z': handler.on_utc_offset(numeric_system::alternative); break;
+      default:  FMT_THROW(format_error("invalid format"));
       }
       break;
     }
@@ -864,54 +827,34 @@ FMT_CONSTEXPR auto parse_chrono_format(const Char* begin, const Char* end,
       if (ptr == end) FMT_THROW(format_error("invalid format"));
       c = *ptr++;
       switch (c) {
-      case 'y':
-        handler.on_short_year(numeric_system::alternative);
-        break;
-      case 'm':
-        handler.on_dec_month(numeric_system::alternative);
-        break;
+      case 'y': handler.on_short_year(numeric_system::alternative); break;
+      case 'm': handler.on_dec_month(numeric_system::alternative, pad); break;
       case 'U':
-        handler.on_dec0_week_of_year(numeric_system::alternative);
+        handler.on_dec0_week_of_year(numeric_system::alternative, pad);
         break;
       case 'W':
-        handler.on_dec1_week_of_year(numeric_system::alternative);
+        handler.on_dec1_week_of_year(numeric_system::alternative, pad);
         break;
       case 'V':
-        handler.on_iso_week_of_year(numeric_system::alternative);
+        handler.on_iso_week_of_year(numeric_system::alternative, pad);
         break;
       case 'd':
-        handler.on_day_of_month(numeric_system::alternative);
+        handler.on_day_of_month(numeric_system::alternative, pad);
         break;
       case 'e':
-        handler.on_day_of_month_space(numeric_system::alternative);
-        break;
-      case 'w':
-        handler.on_dec0_weekday(numeric_system::alternative);
-        break;
-      case 'u':
-        handler.on_dec1_weekday(numeric_system::alternative);
-        break;
-      case 'H':
-        handler.on_24_hour(numeric_system::alternative, pad);
-        break;
-      case 'I':
-        handler.on_12_hour(numeric_system::alternative, pad);
-        break;
-      case 'M':
-        handler.on_minute(numeric_system::alternative, pad);
+        handler.on_day_of_month(numeric_system::alternative, pad_type::space);
         break;
-      case 'S':
-        handler.on_second(numeric_system::alternative, pad);
-        break;
-      case 'z':
-        handler.on_utc_offset(numeric_system::alternative);
-        break;
-      default:
-        FMT_THROW(format_error("invalid format"));
+      case 'w': handler.on_dec0_weekday(numeric_system::alternative); break;
+      case 'u': handler.on_dec1_weekday(numeric_system::alternative); break;
+      case 'H': handler.on_24_hour(numeric_system::alternative, pad); break;
+      case 'I': handler.on_12_hour(numeric_system::alternative, pad); break;
+      case 'M': handler.on_minute(numeric_system::alternative, pad); break;
+      case 'S': handler.on_second(numeric_system::alternative, pad); break;
+      case 'z': handler.on_utc_offset(numeric_system::alternative); break;
+      default:  FMT_THROW(format_error("invalid format"));
       }
       break;
-    default:
-      FMT_THROW(format_error("invalid format"));
+    default: FMT_THROW(format_error("invalid format"));
     }
     begin = ptr;
   }
@@ -923,7 +866,7 @@ template <typename Derived> struct null_chrono_spec_handler {
   FMT_CONSTEXPR void unsupported() {
     static_cast<Derived*>(this)->unsupported();
   }
-  FMT_CONSTEXPR void on_year(numeric_system) { unsupported(); }
+  FMT_CONSTEXPR void on_year(numeric_system, pad_type) { unsupported(); }
   FMT_CONSTEXPR void on_short_year(numeric_system) { unsupported(); }
   FMT_CONSTEXPR void on_offset_year() { unsupported(); }
   FMT_CONSTEXPR void on_century(numeric_system) { unsupported(); }
@@ -935,13 +878,20 @@ template <typename Derived> struct null_chrono_spec_handler {
   FMT_CONSTEXPR void on_dec1_weekday(numeric_system) { unsupported(); }
   FMT_CONSTEXPR void on_abbr_month() { unsupported(); }
   FMT_CONSTEXPR void on_full_month() { unsupported(); }
-  FMT_CONSTEXPR void on_dec_month(numeric_system) { unsupported(); }
-  FMT_CONSTEXPR void on_dec0_week_of_year(numeric_system) { unsupported(); }
-  FMT_CONSTEXPR void on_dec1_week_of_year(numeric_system) { unsupported(); }
-  FMT_CONSTEXPR void on_iso_week_of_year(numeric_system) { unsupported(); }
-  FMT_CONSTEXPR void on_day_of_year() { unsupported(); }
-  FMT_CONSTEXPR void on_day_of_month(numeric_system) { unsupported(); }
-  FMT_CONSTEXPR void on_day_of_month_space(numeric_system) { unsupported(); }
+  FMT_CONSTEXPR void on_dec_month(numeric_system, pad_type) { unsupported(); }
+  FMT_CONSTEXPR void on_dec0_week_of_year(numeric_system, pad_type) {
+    unsupported();
+  }
+  FMT_CONSTEXPR void on_dec1_week_of_year(numeric_system, pad_type) {
+    unsupported();
+  }
+  FMT_CONSTEXPR void on_iso_week_of_year(numeric_system, pad_type) {
+    unsupported();
+  }
+  FMT_CONSTEXPR void on_day_of_year(pad_type) { unsupported(); }
+  FMT_CONSTEXPR void on_day_of_month(numeric_system, pad_type) {
+    unsupported();
+  }
   FMT_CONSTEXPR void on_24_hour(numeric_system) { unsupported(); }
   FMT_CONSTEXPR void on_12_hour(numeric_system) { unsupported(); }
   FMT_CONSTEXPR void on_minute(numeric_system) { unsupported(); }
@@ -962,11 +912,13 @@ template <typename Derived> struct null_chrono_spec_handler {
 };
 
 struct tm_format_checker : null_chrono_spec_handler<tm_format_checker> {
-  FMT_NORETURN void unsupported() { FMT_THROW(format_error("no format")); }
+  FMT_NORETURN inline void unsupported() {
+    FMT_THROW(format_error("no format"));
+  }
 
   template <typename Char>
   FMT_CONSTEXPR void on_text(const Char*, const Char*) {}
-  FMT_CONSTEXPR void on_year(numeric_system) {}
+  FMT_CONSTEXPR void on_year(numeric_system, pad_type) {}
   FMT_CONSTEXPR void on_short_year(numeric_system) {}
   FMT_CONSTEXPR void on_offset_year() {}
   FMT_CONSTEXPR void on_century(numeric_system) {}
@@ -978,13 +930,12 @@ struct tm_format_checker : null_chrono_spec_handler<tm_format_checker> {
   FMT_CONSTEXPR void on_dec1_weekday(numeric_system) {}
   FMT_CONSTEXPR void on_abbr_month() {}
   FMT_CONSTEXPR void on_full_month() {}
-  FMT_CONSTEXPR void on_dec_month(numeric_system) {}
-  FMT_CONSTEXPR void on_dec0_week_of_year(numeric_system) {}
-  FMT_CONSTEXPR void on_dec1_week_of_year(numeric_system) {}
-  FMT_CONSTEXPR void on_iso_week_of_year(numeric_system) {}
-  FMT_CONSTEXPR void on_day_of_year() {}
-  FMT_CONSTEXPR void on_day_of_month(numeric_system) {}
-  FMT_CONSTEXPR void on_day_of_month_space(numeric_system) {}
+  FMT_CONSTEXPR void on_dec_month(numeric_system, pad_type) {}
+  FMT_CONSTEXPR void on_dec0_week_of_year(numeric_system, pad_type) {}
+  FMT_CONSTEXPR void on_dec1_week_of_year(numeric_system, pad_type) {}
+  FMT_CONSTEXPR void on_iso_week_of_year(numeric_system, pad_type) {}
+  FMT_CONSTEXPR void on_day_of_year(pad_type) {}
+  FMT_CONSTEXPR void on_day_of_month(numeric_system, pad_type) {}
   FMT_CONSTEXPR void on_24_hour(numeric_system, pad_type) {}
   FMT_CONSTEXPR void on_12_hour(numeric_system, pad_type) {}
   FMT_CONSTEXPR void on_minute(numeric_system, pad_type) {}
@@ -1040,15 +991,14 @@ template <typename T>
 struct has_member_data_tm_zone<T, void_t<decltype(T::tm_zone)>>
     : std::true_type {};
 
-#if FMT_USE_TZSET
 inline void tzset_once() {
-  static bool init = []() -> bool {
+  static bool init = []() {
+    using namespace fmt_detail;
     _tzset();
-    return true;
+    return false;
   }();
   ignore_unused(init);
 }
-#endif
 
 // Converts value to Int and checks that it's in the range [0, upper).
 template <typename T, typename Int, FMT_ENABLE_IF(std::is_integral<T>::value)>
@@ -1061,9 +1011,10 @@ inline auto to_nonnegative_int(T value, Int upper) -> Int {
 }
 template <typename T, typename Int, FMT_ENABLE_IF(!std::is_integral<T>::value)>
 inline auto to_nonnegative_int(T value, Int upper) -> Int {
-  if (value < 0 || value > static_cast<T>(upper))
+  auto int_value = static_cast<Int>(value);
+  if (int_value < 0 || value > static_cast<T>(upper))
     FMT_THROW(format_error("invalid value"));
-  return static_cast<Int>(value);
+  return int_value;
 }
 
 constexpr auto pow10(std::uint32_t n) -> long long {
@@ -1098,16 +1049,16 @@ void write_fractional_seconds(OutputIt& out, Duration d, int precision = -1) {
   using subsecond_precision = std::chrono::duration<
       typename std::common_type<typename Duration::rep,
                                 std::chrono::seconds::rep>::type,
-      std::ratio<1, detail::pow10(num_fractional_digits)>>;
+      std::ratio<1, pow10(num_fractional_digits)>>;
 
-  const auto fractional = d - fmt_duration_cast<std::chrono::seconds>(d);
+  const auto fractional = d - detail::duration_cast<std::chrono::seconds>(d);
   const auto subseconds =
       std::chrono::treat_as_floating_point<
           typename subsecond_precision::rep>::value
           ? fractional.count()
-          : fmt_duration_cast<subsecond_precision>(fractional).count();
+          : detail::duration_cast<subsecond_precision>(fractional).count();
   auto n = static_cast<uint32_or_64_or_128_t<long long>>(subseconds);
-  const int num_digits = detail::count_digits(n);
+  const int num_digits = count_digits(n);
 
   int leading_zeroes = (std::max)(0, num_fractional_digits - num_digits);
   if (precision < 0) {
@@ -1115,22 +1066,25 @@ void write_fractional_seconds(OutputIt& out, Duration d, int precision = -1) {
     if (std::ratio_less<typename subsecond_precision::period,
                         std::chrono::seconds::period>::value) {
       *out++ = '.';
-      out = std::fill_n(out, leading_zeroes, '0');
-      out = format_decimal<Char>(out, n, num_digits).end;
+      out = detail::fill_n(out, leading_zeroes, '0');
+      out = format_decimal<Char>(out, n, num_digits);
     }
-  } else {
+  } else if (precision > 0) {
     *out++ = '.';
-    leading_zeroes = (std::min)(leading_zeroes, precision);
-    out = std::fill_n(out, leading_zeroes, '0');
+    leading_zeroes = min_of(leading_zeroes, precision);
     int remaining = precision - leading_zeroes;
-    if (remaining != 0 && remaining < num_digits) {
-      n /= to_unsigned(detail::pow10(to_unsigned(num_digits - remaining)));
-      out = format_decimal<Char>(out, n, remaining).end;
+    out = detail::fill_n(out, leading_zeroes, '0');
+    if (remaining < num_digits) {
+      int num_truncated_digits = num_digits - remaining;
+      n /= to_unsigned(pow10(to_unsigned(num_truncated_digits)));
+      if (n != 0) out = format_decimal<Char>(out, n, remaining);
       return;
     }
-    out = format_decimal<Char>(out, n, num_digits).end;
-    remaining -= num_digits;
-    out = std::fill_n(out, remaining, '0');
+    if (n != 0) {
+      out = format_decimal<Char>(out, n, num_digits);
+      remaining -= num_digits;
+    }
+    out = detail::fill_n(out, remaining, '0');
   }
 }
 
@@ -1271,29 +1225,28 @@ class tm_writer {
     }
   }
 
-  void write_year_extended(long long year) {
+  void write_year_extended(long long year, pad_type pad) {
     // At least 4 characters.
     int width = 4;
-    if (year < 0) {
-      *out_++ = '-';
+    bool negative = year < 0;
+    if (negative) {
       year = 0 - year;
       --width;
     }
     uint32_or_64_or_128_t<long long> n = to_unsigned(year);
     const int num_digits = count_digits(n);
-    if (width > num_digits) out_ = std::fill_n(out_, width - num_digits, '0');
-    out_ = format_decimal<Char>(out_, n, num_digits).end;
-  }
-  void write_year(long long year) {
-    if (year >= 0 && year < 10000) {
-      write2(static_cast<int>(year / 100));
-      write2(static_cast<int>(year % 100));
-    } else {
-      write_year_extended(year);
+    if (negative && pad == pad_type::zero) *out_++ = '-';
+    if (width > num_digits) {
+      out_ = detail::write_padding(out_, pad, width - num_digits);
     }
+    if (negative && pad != pad_type::zero) *out_++ = '-';
+    out_ = format_decimal<Char>(out_, n, num_digits);
+  }
+  void write_year(long long year, pad_type pad) {
+    write_year_extended(year, pad);
   }
 
-  void write_utc_offset(long offset, numeric_system ns) {
+  void write_utc_offset(long long offset, numeric_system ns) {
     if (offset < 0) {
       *out_++ = '-';
       offset = -offset;
@@ -1305,6 +1258,7 @@ class tm_writer {
     if (ns != numeric_system::standard) *out_++ = ':';
     write2(static_cast<int>(offset % 60));
   }
+
   template <typename T, FMT_ENABLE_IF(has_member_data_tm_gmtoff<T>::value)>
   void format_utc_offset_impl(const T& tm, numeric_system ns) {
     write_utc_offset(tm.tm_gmtoff, ns);
@@ -1312,9 +1266,7 @@ class tm_writer {
   template <typename T, FMT_ENABLE_IF(!has_member_data_tm_gmtoff<T>::value)>
   void format_utc_offset_impl(const T& tm, numeric_system ns) {
 #if defined(_WIN32) && defined(_UCRT)
-#  if FMT_USE_TZSET
     tzset_once();
-#  endif
     long offset = 0;
     _get_timezone(&offset);
     if (tm.tm_isdst) {
@@ -1331,7 +1283,7 @@ class tm_writer {
     std::time_t gt = std::mktime(&gtm);
     std::tm ltm = gmtime(gt);
     std::time_t lt = std::mktime(&ltm);
-    long offset = gt - lt;
+    long long offset = gt - lt;
     write_utc_offset(offset, ns);
 #endif
   }
@@ -1364,7 +1316,7 @@ class tm_writer {
   auto out() const -> OutputIt { return out_; }
 
   FMT_CONSTEXPR void on_text(const Char* begin, const Char* end) {
-    out_ = copy_str<Char>(begin, end, out_);
+    out_ = copy<Char>(begin, end, out_);
   }
 
   void on_abbr_weekday() {
@@ -1411,11 +1363,11 @@ class tm_writer {
       *out_++ = ' ';
       on_abbr_month();
       *out_++ = ' ';
-      on_day_of_month_space(numeric_system::standard);
+      on_day_of_month(numeric_system::standard, pad_type::space);
       *out_++ = ' ';
       on_iso_time();
       *out_++ = ' ';
-      on_year(numeric_system::standard);
+      on_year(numeric_system::standard, pad_type::space);
     } else {
       format_localized('c', ns == numeric_system::standard ? '\0' : 'E');
     }
@@ -1437,31 +1389,31 @@ class tm_writer {
     write_digit2_separated(buf, to_unsigned(tm_mon() + 1),
                            to_unsigned(tm_mday()),
                            to_unsigned(split_year_lower(tm_year())), '/');
-    out_ = copy_str<Char>(std::begin(buf), std::end(buf), out_);
+    out_ = copy<Char>(std::begin(buf), std::end(buf), out_);
   }
   void on_iso_date() {
     auto year = tm_year();
     char buf[10];
     size_t offset = 0;
     if (year >= 0 && year < 10000) {
-      copy2(buf, digits2(static_cast<size_t>(year / 100)));
+      write2digits(buf, static_cast<size_t>(year / 100));
     } else {
       offset = 4;
-      write_year_extended(year);
+      write_year_extended(year, pad_type::zero);
       year = 0;
     }
     write_digit2_separated(buf + 2, static_cast<unsigned>(year % 100),
                            to_unsigned(tm_mon() + 1), to_unsigned(tm_mday()),
                            '-');
-    out_ = copy_str<Char>(std::begin(buf) + offset, std::end(buf), out_);
+    out_ = copy<Char>(std::begin(buf) + offset, std::end(buf), out_);
   }
 
   void on_utc_offset(numeric_system ns) { format_utc_offset_impl(tm_, ns); }
   void on_tz_name() { format_tz_name_impl(tm_); }
 
-  void on_year(numeric_system ns) {
+  void on_year(numeric_system ns, pad_type pad) {
     if (is_classic_ || ns == numeric_system::standard)
-      return write_year(tm_year());
+      return write_year(tm_year(), pad);
     format_localized('Y', 'E');
   }
   void on_short_year(numeric_system ns) {
@@ -1492,56 +1444,57 @@ class tm_writer {
     }
   }
 
-  void on_dec_month(numeric_system ns) {
+  void on_dec_month(numeric_system ns, pad_type pad) {
     if (is_classic_ || ns == numeric_system::standard)
-      return write2(tm_mon() + 1);
+      return write2(tm_mon() + 1, pad);
     format_localized('m', 'O');
   }
 
-  void on_dec0_week_of_year(numeric_system ns) {
+  void on_dec0_week_of_year(numeric_system ns, pad_type pad) {
     if (is_classic_ || ns == numeric_system::standard)
-      return write2((tm_yday() + days_per_week - tm_wday()) / days_per_week);
+      return write2((tm_yday() + days_per_week - tm_wday()) / days_per_week,
+                    pad);
     format_localized('U', 'O');
   }
-  void on_dec1_week_of_year(numeric_system ns) {
+  void on_dec1_week_of_year(numeric_system ns, pad_type pad) {
     if (is_classic_ || ns == numeric_system::standard) {
       auto wday = tm_wday();
       write2((tm_yday() + days_per_week -
               (wday == 0 ? (days_per_week - 1) : (wday - 1))) /
-             days_per_week);
+                 days_per_week,
+             pad);
     } else {
       format_localized('W', 'O');
     }
   }
-  void on_iso_week_of_year(numeric_system ns) {
+  void on_iso_week_of_year(numeric_system ns, pad_type pad) {
     if (is_classic_ || ns == numeric_system::standard)
-      return write2(tm_iso_week_of_year());
+      return write2(tm_iso_week_of_year(), pad);
     format_localized('V', 'O');
   }
 
-  void on_iso_week_based_year() { write_year(tm_iso_week_year()); }
+  void on_iso_week_based_year() {
+    write_year(tm_iso_week_year(), pad_type::zero);
+  }
   void on_iso_week_based_short_year() {
     write2(split_year_lower(tm_iso_week_year()));
   }
 
-  void on_day_of_year() {
+  void on_day_of_year(pad_type pad) {
     auto yday = tm_yday() + 1;
-    write1(yday / 100);
-    write2(yday % 100);
-  }
-  void on_day_of_month(numeric_system ns) {
-    if (is_classic_ || ns == numeric_system::standard) return write2(tm_mday());
-    format_localized('d', 'O');
-  }
-  void on_day_of_month_space(numeric_system ns) {
-    if (is_classic_ || ns == numeric_system::standard) {
-      auto mday = to_unsigned(tm_mday()) % 100;
-      const char* d2 = digits2(mday);
-      *out_++ = mday < 10 ? ' ' : d2[0];
-      *out_++ = d2[1];
+    auto digit1 = yday / 100;
+    if (digit1 != 0) {
+      write1(digit1);
     } else {
-      format_localized('e', 'O');
+      out_ = detail::write_padding(out_, pad);
     }
+    write2(yday % 100, pad);
+  }
+
+  void on_day_of_month(numeric_system ns, pad_type pad) {
+    if (is_classic_ || ns == numeric_system::standard)
+      return write2(tm_mday(), pad);
+    format_localized('d', 'O');
   }
 
   void on_24_hour(numeric_system ns, pad_type pad) {
@@ -1569,7 +1522,7 @@ class tm_writer {
           write_floating_seconds(buf, *subsecs_);
           if (buf.size() > 1) {
             // Remove the leading "0", write something like ".123".
-            out_ = std::copy(buf.begin() + 1, buf.end(), out_);
+            out_ = copy<Char>(buf.begin() + 1, buf.end(), out_);
           }
         } else {
           write_fractional_seconds<Char>(out_, *subsecs_);
@@ -1586,7 +1539,7 @@ class tm_writer {
       char buf[8];
       write_digit2_separated(buf, to_unsigned(tm_hour12()),
                              to_unsigned(tm_min()), to_unsigned(tm_sec()), ':');
-      out_ = copy_str<Char>(std::begin(buf), std::end(buf), out_);
+      out_ = copy<Char>(std::begin(buf), std::end(buf), out_);
       *out_++ = ' ';
       on_am_pm();
     } else {
@@ -1601,7 +1554,7 @@ class tm_writer {
   void on_iso_time() {
     on_24_hour_time();
     *out_++ = ':';
-    on_second(numeric_system::standard, pad_type::unspecified);
+    on_second(numeric_system::standard, pad_type::zero);
   }
 
   void on_am_pm() {
@@ -1621,11 +1574,11 @@ class tm_writer {
 struct chrono_format_checker : null_chrono_spec_handler<chrono_format_checker> {
   bool has_precision_integral = false;
 
-  FMT_NORETURN void unsupported() { FMT_THROW(format_error("no date")); }
+  FMT_NORETURN inline void unsupported() { FMT_THROW(format_error("no date")); }
 
   template <typename Char>
   FMT_CONSTEXPR void on_text(const Char*, const Char*) {}
-  FMT_CONSTEXPR void on_day_of_year() {}
+  FMT_CONSTEXPR void on_day_of_year(pad_type) {}
   FMT_CONSTEXPR void on_24_hour(numeric_system, pad_type) {}
   FMT_CONSTEXPR void on_12_hour(numeric_system, pad_type) {}
   FMT_CONSTEXPR void on_minute(numeric_system, pad_type) {}
@@ -1635,9 +1588,8 @@ struct chrono_format_checker : null_chrono_spec_handler<chrono_format_checker> {
   FMT_CONSTEXPR void on_iso_time() {}
   FMT_CONSTEXPR void on_am_pm() {}
   FMT_CONSTEXPR void on_duration_value() const {
-    if (has_precision_integral) {
+    if (has_precision_integral)
       FMT_THROW(format_error("precision not allowed for this argument type"));
-    }
   }
   FMT_CONSTEXPR void on_duration_unit() {}
 };
@@ -1677,17 +1629,17 @@ inline auto get_milliseconds(std::chrono::duration<Rep, Period> d)
 #if FMT_SAFE_DURATION_CAST
   using CommonSecondsType =
       typename std::common_type<decltype(d), std::chrono::seconds>::type;
-  const auto d_as_common = fmt_duration_cast<CommonSecondsType>(d);
+  const auto d_as_common = detail::duration_cast<CommonSecondsType>(d);
   const auto d_as_whole_seconds =
-      fmt_duration_cast<std::chrono::seconds>(d_as_common);
+      detail::duration_cast<std::chrono::seconds>(d_as_common);
   // this conversion should be nonproblematic
   const auto diff = d_as_common - d_as_whole_seconds;
   const auto ms =
-      fmt_duration_cast<std::chrono::duration<Rep, std::milli>>(diff);
+      detail::duration_cast<std::chrono::duration<Rep, std::milli>>(diff);
   return ms;
 #else
-  auto s = fmt_duration_cast<std::chrono::seconds>(d);
-  return fmt_duration_cast<std::chrono::milliseconds>(d - s);
+  auto s = detail::duration_cast<std::chrono::seconds>(d);
+  return detail::duration_cast<std::chrono::milliseconds>(d - s);
 #endif
 }
 
@@ -1700,16 +1652,16 @@ auto format_duration_value(OutputIt out, Rep val, int) -> OutputIt {
 template <typename Char, typename Rep, typename OutputIt,
           FMT_ENABLE_IF(std::is_floating_point<Rep>::value)>
 auto format_duration_value(OutputIt out, Rep val, int precision) -> OutputIt {
-  auto specs = format_specs<Char>();
+  auto specs = format_specs();
   specs.precision = precision;
-  specs.type = precision >= 0 ? presentation_type::fixed_lower
-                              : presentation_type::general_lower;
+  specs.set_type(precision >= 0 ? presentation_type::fixed
+                                : presentation_type::general);
   return write<Char>(out, val, specs);
 }
 
 template <typename Char, typename OutputIt>
 auto copy_unit(string_view unit, OutputIt out, Char) -> OutputIt {
-  return std::copy(unit.begin(), unit.end(), out);
+  return copy<Char>(unit.begin(), unit.end(), out);
 }
 
 template <typename OutputIt>
@@ -1717,7 +1669,7 @@ auto copy_unit(string_view unit, OutputIt out, wchar_t) -> OutputIt {
   // This works when wchar_t is UTF-32 because units only contain characters
   // that have the same representation in UTF-16 and UTF-32.
   utf8_to_utf16 u(unit);
-  return std::copy(u.c_str(), u.c_str() + u.size(), out);
+  return copy<wchar_t>(u.c_str(), u.c_str() + u.size(), out);
 }
 
 template <typename Char, typename Period, typename OutputIt>
@@ -1743,14 +1695,14 @@ class get_locale {
   bool has_locale_ = false;
 
  public:
-  get_locale(bool localized, locale_ref loc) : has_locale_(localized) {
+  inline get_locale(bool localized, locale_ref loc) : has_locale_(localized) {
     if (localized)
       ::new (&locale_) std::locale(loc.template get<std::locale>());
   }
-  ~get_locale() {
+  inline ~get_locale() {
     if (has_locale_) locale_.~locale();
   }
-  operator const std::locale&() const {
+  inline operator const std::locale&() const {
     return has_locale_ ? locale_ : get_classic_locale();
   }
 };
@@ -1789,7 +1741,7 @@ struct chrono_formatter {
     // this may overflow and/or the result may not fit in the
     // target type.
     // might need checked conversion (rep!=Rep)
-    s = fmt_duration_cast<seconds>(std::chrono::duration<rep, Period>(val));
+    s = detail::duration_cast<seconds>(std::chrono::duration<rep, Period>(val));
   }
 
   // returns true if nan or inf, writes to out.
@@ -1840,7 +1792,7 @@ struct chrono_formatter {
     }
   }
 
-  void write(Rep value, int width, pad_type pad = pad_type::unspecified) {
+  void write(Rep value, int width, pad_type pad = pad_type::zero) {
     write_sign();
     if (isnan(value)) return write_nan();
     uint32_or_64_or_128_t<int> n =
@@ -1849,7 +1801,7 @@ struct chrono_formatter {
     if (width > num_digits) {
       out = detail::write_padding(out, pad, width - num_digits);
     }
-    out = format_decimal<char_type>(out, n, num_digits).end;
+    out = format_decimal<char_type>(out, n, num_digits);
   }
 
   void write_nan() { std::copy_n("nan", 3, out); }
@@ -1866,7 +1818,7 @@ struct chrono_formatter {
   }
 
   void on_text(const char_type* begin, const char_type* end) {
-    std::copy(begin, end, out);
+    copy<char_type>(begin, end, out);
   }
 
   // These are not implemented because durations don't have date information.
@@ -1883,20 +1835,19 @@ struct chrono_formatter {
   void on_iso_date() {}
   void on_utc_offset(numeric_system) {}
   void on_tz_name() {}
-  void on_year(numeric_system) {}
+  void on_year(numeric_system, pad_type) {}
   void on_short_year(numeric_system) {}
   void on_offset_year() {}
   void on_century(numeric_system) {}
   void on_iso_week_based_year() {}
   void on_iso_week_based_short_year() {}
-  void on_dec_month(numeric_system) {}
-  void on_dec0_week_of_year(numeric_system) {}
-  void on_dec1_week_of_year(numeric_system) {}
-  void on_iso_week_of_year(numeric_system) {}
-  void on_day_of_month(numeric_system) {}
-  void on_day_of_month_space(numeric_system) {}
-
-  void on_day_of_year() {
+  void on_dec_month(numeric_system, pad_type) {}
+  void on_dec0_week_of_year(numeric_system, pad_type) {}
+  void on_dec1_week_of_year(numeric_system, pad_type) {}
+  void on_iso_week_of_year(numeric_system, pad_type) {}
+  void on_day_of_month(numeric_system, pad_type) {}
+
+  void on_day_of_year(pad_type) {
     if (handle_nan_inf()) return;
     write(days(), 0);
   }
@@ -1940,7 +1891,7 @@ struct chrono_formatter {
         if (buf.size() < 2 || buf[1] == '.') {
           out = detail::write_padding(out, pad);
         }
-        out = std::copy(buf.begin(), buf.end(), out);
+        out = copy<char_type>(buf.begin(), buf.end(), out);
       } else {
         write(second(), 2, pad);
         write_fractional_seconds<char_type>(
@@ -1974,7 +1925,7 @@ struct chrono_formatter {
     on_24_hour_time();
     *out++ = ':';
     if (handle_nan_inf()) return;
-    on_second(numeric_system::standard, pad_type::unspecified);
+    on_second(numeric_system::standard, pad_type::zero);
   }
 
   void on_am_pm() {
@@ -1997,82 +1948,240 @@ struct chrono_formatter {
 
 #if defined(__cpp_lib_chrono) && __cpp_lib_chrono >= 201907
 using weekday = std::chrono::weekday;
+using day = std::chrono::day;
+using month = std::chrono::month;
+using year = std::chrono::year;
+using year_month_day = std::chrono::year_month_day;
 #else
 // A fallback version of weekday.
 class weekday {
  private:
-  unsigned char value;
+  unsigned char value_;
 
  public:
   weekday() = default;
-  explicit constexpr weekday(unsigned wd) noexcept
-      : value(static_cast<unsigned char>(wd != 7 ? wd : 0)) {}
-  constexpr auto c_encoding() const noexcept -> unsigned { return value; }
+  constexpr explicit weekday(unsigned wd) noexcept
+      : value_(static_cast<unsigned char>(wd != 7 ? wd : 0)) {}
+  constexpr auto c_encoding() const noexcept -> unsigned { return value_; }
+};
+
+class day {
+ private:
+  unsigned char value_;
+
+ public:
+  day() = default;
+  constexpr explicit day(unsigned d) noexcept
+      : value_(static_cast<unsigned char>(d)) {}
+  constexpr explicit operator unsigned() const noexcept { return value_; }
 };
 
-class year_month_day {};
+class month {
+ private:
+  unsigned char value_;
+
+ public:
+  month() = default;
+  constexpr explicit month(unsigned m) noexcept
+      : value_(static_cast<unsigned char>(m)) {}
+  constexpr explicit operator unsigned() const noexcept { return value_; }
+};
+
+class year {
+ private:
+  int value_;
+
+ public:
+  year() = default;
+  constexpr explicit year(int y) noexcept : value_(y) {}
+  constexpr explicit operator int() const noexcept { return value_; }
+};
+
+class year_month_day {
+ private:
+  fmt::year year_;
+  fmt::month month_;
+  fmt::day day_;
+
+ public:
+  year_month_day() = default;
+  constexpr year_month_day(const year& y, const month& m, const day& d) noexcept
+      : year_(y), month_(m), day_(d) {}
+  constexpr auto year() const noexcept -> fmt::year { return year_; }
+  constexpr auto month() const noexcept -> fmt::month { return month_; }
+  constexpr auto day() const noexcept -> fmt::day { return day_; }
+};
 #endif
 
-// A rudimentary weekday formatter.
-template <typename Char> struct formatter<weekday, Char> {
+template <typename Char>
+struct formatter<weekday, Char> : private formatter<std::tm, Char> {
  private:
-  bool localized = false;
+  bool localized_ = false;
+  bool use_tm_formatter_ = false;
 
  public:
-  FMT_CONSTEXPR auto parse(basic_format_parse_context<Char>& ctx)
-      -> decltype(ctx.begin()) {
-    auto begin = ctx.begin(), end = ctx.end();
-    if (begin != end && *begin == 'L') {
-      ++begin;
-      localized = true;
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    auto it = ctx.begin(), end = ctx.end();
+    if (it != end && *it == 'L') {
+      ++it;
+      localized_ = true;
+      return it;
     }
-    return begin;
+    use_tm_formatter_ = it != end && *it != '}';
+    return use_tm_formatter_ ? formatter<std::tm, Char>::parse(ctx) : it;
   }
 
   template <typename FormatContext>
   auto format(weekday wd, FormatContext& ctx) const -> decltype(ctx.out()) {
     auto time = std::tm();
     time.tm_wday = static_cast<int>(wd.c_encoding());
-    detail::get_locale loc(localized, ctx.locale());
+    if (use_tm_formatter_) return formatter<std::tm, Char>::format(time, ctx);
+    detail::get_locale loc(localized_, ctx.locale());
     auto w = detail::tm_writer<decltype(ctx.out()), Char>(loc, ctx.out(), time);
     w.on_abbr_weekday();
     return w.out();
   }
 };
 
+template <typename Char>
+struct formatter<day, Char> : private formatter<std::tm, Char> {
+ private:
+  bool use_tm_formatter_ = false;
+
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    auto it = ctx.begin(), end = ctx.end();
+    use_tm_formatter_ = it != end && *it != '}';
+    return use_tm_formatter_ ? formatter<std::tm, Char>::parse(ctx) : it;
+  }
+
+  template <typename FormatContext>
+  auto format(day d, FormatContext& ctx) const -> decltype(ctx.out()) {
+    auto time = std::tm();
+    time.tm_mday = static_cast<int>(static_cast<unsigned>(d));
+    if (use_tm_formatter_) return formatter<std::tm, Char>::format(time, ctx);
+    detail::get_locale loc(false, ctx.locale());
+    auto w = detail::tm_writer<decltype(ctx.out()), Char>(loc, ctx.out(), time);
+    w.on_day_of_month(detail::numeric_system::standard, detail::pad_type::zero);
+    return w.out();
+  }
+};
+
+template <typename Char>
+struct formatter<month, Char> : private formatter<std::tm, Char> {
+ private:
+  bool localized_ = false;
+  bool use_tm_formatter_ = false;
+
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    auto it = ctx.begin(), end = ctx.end();
+    if (it != end && *it == 'L') {
+      ++it;
+      localized_ = true;
+      return it;
+    }
+    use_tm_formatter_ = it != end && *it != '}';
+    return use_tm_formatter_ ? formatter<std::tm, Char>::parse(ctx) : it;
+  }
+
+  template <typename FormatContext>
+  auto format(month m, FormatContext& ctx) const -> decltype(ctx.out()) {
+    auto time = std::tm();
+    time.tm_mon = static_cast<int>(static_cast<unsigned>(m)) - 1;
+    if (use_tm_formatter_) return formatter<std::tm, Char>::format(time, ctx);
+    detail::get_locale loc(localized_, ctx.locale());
+    auto w = detail::tm_writer<decltype(ctx.out()), Char>(loc, ctx.out(), time);
+    w.on_abbr_month();
+    return w.out();
+  }
+};
+
+template <typename Char>
+struct formatter<year, Char> : private formatter<std::tm, Char> {
+ private:
+  bool use_tm_formatter_ = false;
+
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    auto it = ctx.begin(), end = ctx.end();
+    use_tm_formatter_ = it != end && *it != '}';
+    return use_tm_formatter_ ? formatter<std::tm, Char>::parse(ctx) : it;
+  }
+
+  template <typename FormatContext>
+  auto format(year y, FormatContext& ctx) const -> decltype(ctx.out()) {
+    auto time = std::tm();
+    time.tm_year = static_cast<int>(y) - 1900;
+    if (use_tm_formatter_) return formatter<std::tm, Char>::format(time, ctx);
+    detail::get_locale loc(false, ctx.locale());
+    auto w = detail::tm_writer<decltype(ctx.out()), Char>(loc, ctx.out(), time);
+    w.on_year(detail::numeric_system::standard, detail::pad_type::zero);
+    return w.out();
+  }
+};
+
+template <typename Char>
+struct formatter<year_month_day, Char> : private formatter<std::tm, Char> {
+ private:
+  bool use_tm_formatter_ = false;
+
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    auto it = ctx.begin(), end = ctx.end();
+    use_tm_formatter_ = it != end && *it != '}';
+    return use_tm_formatter_ ? formatter<std::tm, Char>::parse(ctx) : it;
+  }
+
+  template <typename FormatContext>
+  auto format(year_month_day val, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    auto time = std::tm();
+    time.tm_year = static_cast<int>(val.year()) - 1900;
+    time.tm_mon = static_cast<int>(static_cast<unsigned>(val.month())) - 1;
+    time.tm_mday = static_cast<int>(static_cast<unsigned>(val.day()));
+    if (use_tm_formatter_) return formatter<std::tm, Char>::format(time, ctx);
+    detail::get_locale loc(true, ctx.locale());
+    auto w = detail::tm_writer<decltype(ctx.out()), Char>(loc, ctx.out(), time);
+    w.on_iso_date();
+    return w.out();
+  }
+};
+
 template <typename Rep, typename Period, typename Char>
 struct formatter<std::chrono::duration<Rep, Period>, Char> {
  private:
-  format_specs<Char> specs_;
+  format_specs specs_;
   detail::arg_ref<Char> width_ref_;
   detail::arg_ref<Char> precision_ref_;
   bool localized_ = false;
-  basic_string_view<Char> format_str_;
+  basic_string_view<Char> fmt_;
 
  public:
-  FMT_CONSTEXPR auto parse(basic_format_parse_context<Char>& ctx)
-      -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     auto it = ctx.begin(), end = ctx.end();
     if (it == end || *it == '}') return it;
 
     it = detail::parse_align(it, end, specs_);
     if (it == end) return it;
 
-    it = detail::parse_dynamic_spec(it, end, specs_.width, width_ref_, ctx);
-    if (it == end) return it;
+    Char c = *it;
+    if ((c >= '0' && c <= '9') || c == '{') {
+      it = detail::parse_width(it, end, specs_, width_ref_, ctx);
+      if (it == end) return it;
+    }
 
     auto checker = detail::chrono_format_checker();
     if (*it == '.') {
       checker.has_precision_integral = !std::is_floating_point<Rep>::value;
-      it = detail::parse_precision(it, end, specs_.precision, precision_ref_,
-                                   ctx);
+      it = detail::parse_precision(it, end, specs_, precision_ref_, ctx);
     }
     if (it != end && *it == 'L') {
       localized_ = true;
       ++it;
     }
     end = detail::parse_chrono_format(it, end, checker);
-    format_str_ = {it, detail::to_unsigned(end - it)};
+    fmt_ = {it, detail::to_unsigned(end - it)};
     return end;
   }
 
@@ -2082,15 +2191,15 @@ struct formatter<std::chrono::duration<Rep, Period>, Char> {
     auto specs = specs_;
     auto precision = specs.precision;
     specs.precision = -1;
-    auto begin = format_str_.begin(), end = format_str_.end();
+    auto begin = fmt_.begin(), end = fmt_.end();
     // As a possible future optimization, we could avoid extra copying if width
     // is not specified.
     auto buf = basic_memory_buffer<Char>();
-    auto out = std::back_inserter(buf);
-    detail::handle_dynamic_spec<detail::width_checker>(specs.width, width_ref_,
-                                                       ctx);
-    detail::handle_dynamic_spec<detail::precision_checker>(precision,
-                                                           precision_ref_, ctx);
+    auto out = basic_appender<Char>(buf);
+    detail::handle_dynamic_spec(specs.dynamic_width(), specs.width, width_ref_,
+                                ctx);
+    detail::handle_dynamic_spec(specs.dynamic_precision(), precision,
+                                precision_ref_, ctx);
     if (begin == end || *begin == '}') {
       out = detail::format_duration_value<Char>(out, d.count(), precision);
       detail::format_duration_unit<Char, Period>(out);
@@ -2107,130 +2216,119 @@ struct formatter<std::chrono::duration<Rep, Period>, Char> {
   }
 };
 
-template <typename Char, typename Duration>
-struct formatter<std::chrono::time_point<std::chrono::system_clock, Duration>,
-                 Char> : formatter<std::tm, Char> {
-  FMT_CONSTEXPR formatter() {
-    this->format_str_ = detail::string_literal<Char, '%', 'F', ' ', '%', 'T'>{};
-  }
-
-  template <typename FormatContext>
-  auto format(std::chrono::time_point<std::chrono::system_clock, Duration> val,
-              FormatContext& ctx) const -> decltype(ctx.out()) {
-    using period = typename Duration::period;
-    if (detail::const_check(
-            period::num != 1 || period::den != 1 ||
-            std::is_floating_point<typename Duration::rep>::value)) {
-      const auto epoch = val.time_since_epoch();
-      auto subsecs = detail::fmt_duration_cast<Duration>(
-          epoch - detail::fmt_duration_cast<std::chrono::seconds>(epoch));
-
-      if (subsecs.count() < 0) {
-        auto second =
-            detail::fmt_duration_cast<Duration>(std::chrono::seconds(1));
-        if (epoch.count() < ((Duration::min)() + second).count())
-          FMT_THROW(format_error("duration is too small"));
-        subsecs += second;
-        val -= second;
-      }
-
-      return formatter<std::tm, Char>::do_format(gmtime(val), ctx, &subsecs);
-    }
-
-    return formatter<std::tm, Char>::format(gmtime(val), ctx);
-  }
-};
-
-#if FMT_USE_LOCAL_TIME
-template <typename Char, typename Duration>
-struct formatter<std::chrono::local_time<Duration>, Char>
-    : formatter<std::tm, Char> {
-  FMT_CONSTEXPR formatter() {
-    this->format_str_ = detail::string_literal<Char, '%', 'F', ' ', '%', 'T'>{};
-  }
-
-  template <typename FormatContext>
-  auto format(std::chrono::local_time<Duration> val, FormatContext& ctx) const
-      -> decltype(ctx.out()) {
-    using period = typename Duration::period;
-    if (period::num != 1 || period::den != 1 ||
-        std::is_floating_point<typename Duration::rep>::value) {
-      const auto epoch = val.time_since_epoch();
-      const auto subsecs = detail::fmt_duration_cast<Duration>(
-          epoch - detail::fmt_duration_cast<std::chrono::seconds>(epoch));
-
-      return formatter<std::tm, Char>::do_format(localtime(val), ctx, &subsecs);
-    }
-
-    return formatter<std::tm, Char>::format(localtime(val), ctx);
-  }
-};
-#endif
-
-#if FMT_USE_UTC_TIME
-template <typename Char, typename Duration>
-struct formatter<std::chrono::time_point<std::chrono::utc_clock, Duration>,
-                 Char>
-    : formatter<std::chrono::time_point<std::chrono::system_clock, Duration>,
-                Char> {
-  template <typename FormatContext>
-  auto format(std::chrono::time_point<std::chrono::utc_clock, Duration> val,
-              FormatContext& ctx) const -> decltype(ctx.out()) {
-    return formatter<
-        std::chrono::time_point<std::chrono::system_clock, Duration>,
-        Char>::format(std::chrono::utc_clock::to_sys(val), ctx);
-  }
-};
-#endif
-
 template <typename Char> struct formatter<std::tm, Char> {
  private:
-  format_specs<Char> specs_;
+  format_specs specs_;
   detail::arg_ref<Char> width_ref_;
 
  protected:
-  basic_string_view<Char> format_str_;
+  basic_string_view<Char> fmt_;
 
-  template <typename FormatContext, typename Duration>
+  template <typename Duration, typename FormatContext>
   auto do_format(const std::tm& tm, FormatContext& ctx,
                  const Duration* subsecs) const -> decltype(ctx.out()) {
     auto specs = specs_;
     auto buf = basic_memory_buffer<Char>();
-    auto out = std::back_inserter(buf);
-    detail::handle_dynamic_spec<detail::width_checker>(specs.width, width_ref_,
-                                                       ctx);
+    auto out = basic_appender<Char>(buf);
+    detail::handle_dynamic_spec(specs.dynamic_width(), specs.width, width_ref_,
+                                ctx);
 
     auto loc_ref = ctx.locale();
     detail::get_locale loc(static_cast<bool>(loc_ref), loc_ref);
     auto w =
         detail::tm_writer<decltype(out), Char, Duration>(loc, out, tm, subsecs);
-    detail::parse_chrono_format(format_str_.begin(), format_str_.end(), w);
+    detail::parse_chrono_format(fmt_.begin(), fmt_.end(), w);
     return detail::write(
         ctx.out(), basic_string_view<Char>(buf.data(), buf.size()), specs);
   }
 
  public:
-  FMT_CONSTEXPR auto parse(basic_format_parse_context<Char>& ctx)
-      -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     auto it = ctx.begin(), end = ctx.end();
     if (it == end || *it == '}') return it;
 
     it = detail::parse_align(it, end, specs_);
     if (it == end) return it;
 
-    it = detail::parse_dynamic_spec(it, end, specs_.width, width_ref_, ctx);
-    if (it == end) return it;
+    Char c = *it;
+    if ((c >= '0' && c <= '9') || c == '{') {
+      it = detail::parse_width(it, end, specs_, width_ref_, ctx);
+      if (it == end) return it;
+    }
 
     end = detail::parse_chrono_format(it, end, detail::tm_format_checker());
-    // Replace the default format_str only if the new spec is not empty.
-    if (end != it) format_str_ = {it, detail::to_unsigned(end - it)};
+    // Replace the default format string only if the new spec is not empty.
+    if (end != it) fmt_ = {it, detail::to_unsigned(end - it)};
     return end;
   }
 
   template <typename FormatContext>
   auto format(const std::tm& tm, FormatContext& ctx) const
       -> decltype(ctx.out()) {
-    return do_format<FormatContext, std::chrono::seconds>(tm, ctx, nullptr);
+    return do_format<std::chrono::seconds>(tm, ctx, nullptr);
+  }
+};
+
+template <typename Char, typename Duration>
+struct formatter<sys_time<Duration>, Char> : formatter<std::tm, Char> {
+  FMT_CONSTEXPR formatter() {
+    this->fmt_ = detail::string_literal<Char, '%', 'F', ' ', '%', 'T'>();
+  }
+
+  template <typename FormatContext>
+  auto format(sys_time<Duration> val, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    std::tm tm = gmtime(val);
+    using period = typename Duration::period;
+    if (detail::const_check(
+            period::num == 1 && period::den == 1 &&
+            !std::is_floating_point<typename Duration::rep>::value)) {
+      return formatter<std::tm, Char>::format(tm, ctx);
+    }
+    Duration epoch = val.time_since_epoch();
+    Duration subsecs = detail::duration_cast<Duration>(
+        epoch - detail::duration_cast<std::chrono::seconds>(epoch));
+    if (subsecs.count() < 0) {
+      auto second = detail::duration_cast<Duration>(std::chrono::seconds(1));
+      if (tm.tm_sec != 0)
+        --tm.tm_sec;
+      else
+        tm = gmtime(val - second);
+      subsecs += detail::duration_cast<Duration>(std::chrono::seconds(1));
+    }
+    return formatter<std::tm, Char>::do_format(tm, ctx, &subsecs);
+  }
+};
+
+template <typename Duration, typename Char>
+struct formatter<utc_time<Duration>, Char>
+    : formatter<sys_time<Duration>, Char> {
+  template <typename FormatContext>
+  auto format(utc_time<Duration> val, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    return formatter<sys_time<Duration>, Char>::format(
+        detail::utc_clock::to_sys(val), ctx);
+  }
+};
+
+template <typename Duration, typename Char>
+struct formatter<local_time<Duration>, Char> : formatter<std::tm, Char> {
+  FMT_CONSTEXPR formatter() {
+    this->fmt_ = detail::string_literal<Char, '%', 'F', ' ', '%', 'T'>();
+  }
+
+  template <typename FormatContext>
+  auto format(local_time<Duration> val, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    using period = typename Duration::period;
+    if (period::num == 1 && period::den == 1 &&
+        !std::is_floating_point<typename Duration::rep>::value) {
+      return formatter<std::tm, Char>::format(localtime(val), ctx);
+    }
+    auto epoch = val.time_since_epoch();
+    auto subsecs = detail::duration_cast<Duration>(
+        epoch - detail::duration_cast<std::chrono::seconds>(epoch));
+    return formatter<std::tm, Char>::do_format(localtime(val), ctx, &subsecs);
   }
 };
 
diff --git a/include/fmt/color.h b/include/fmt/color.h
index 367849a8..2faaf3a0 100644
--- a/include/fmt/color.h
+++ b/include/fmt/color.h
@@ -227,7 +227,7 @@ struct color_type {
 };
 }  // namespace detail
 
-/** A text style consisting of foreground and background colors and emphasis. */
+/// A text style consisting of foreground and background colors and emphasis.
 class text_style {
  public:
   FMT_CONSTEXPR text_style(emphasis em = emphasis()) noexcept
@@ -239,7 +239,7 @@ class text_style {
       foreground_color = rhs.foreground_color;
     } else if (rhs.set_foreground_color) {
       if (!foreground_color.is_rgb || !rhs.foreground_color.is_rgb)
-        FMT_THROW(format_error("can't OR a terminal color"));
+        report_error("can't OR a terminal color");
       foreground_color.value.rgb_color |= rhs.foreground_color.value.rgb_color;
     }
 
@@ -248,7 +248,7 @@ class text_style {
       background_color = rhs.background_color;
     } else if (rhs.set_background_color) {
       if (!background_color.is_rgb || !rhs.background_color.is_rgb)
-        FMT_THROW(format_error("can't OR a terminal color"));
+        report_error("can't OR a terminal color");
       background_color.value.rgb_color |= rhs.background_color.value.rgb_color;
     }
 
@@ -310,13 +310,13 @@ class text_style {
   emphasis ems;
 };
 
-/** Creates a text style from the foreground (text) color. */
+/// Creates a text style from the foreground (text) color.
 FMT_CONSTEXPR inline auto fg(detail::color_type foreground) noexcept
     -> text_style {
   return text_style(true, foreground);
 }
 
-/** Creates a text style from the background color. */
+/// Creates a text style from the background color.
 FMT_CONSTEXPR inline auto bg(detail::color_type background) noexcept
     -> text_style {
   return text_style(false, background);
@@ -330,7 +330,7 @@ FMT_CONSTEXPR inline auto operator|(emphasis lhs, emphasis rhs) noexcept
 namespace detail {
 
 template <typename Char> struct ansi_color_escape {
-  FMT_CONSTEXPR ansi_color_escape(detail::color_type text_color,
+  FMT_CONSTEXPR ansi_color_escape(color_type text_color,
                                   const char* esc) noexcept {
     // If we have a terminal color, we need to output another escape code
     // sequence.
@@ -390,8 +390,8 @@ template <typename Char> struct ansi_color_escape {
   FMT_CONSTEXPR operator const Char*() const noexcept { return buffer; }
 
   FMT_CONSTEXPR auto begin() const noexcept -> const Char* { return buffer; }
-  FMT_CONSTEXPR_CHAR_TRAITS auto end() const noexcept -> const Char* {
-    return buffer + std::char_traits<Char>::length(buffer);
+  FMT_CONSTEXPR20 auto end() const noexcept -> const Char* {
+    return buffer + basic_string_view<Char>(buffer).size();
   }
 
  private:
@@ -412,13 +412,13 @@ template <typename Char> struct ansi_color_escape {
 };
 
 template <typename Char>
-FMT_CONSTEXPR auto make_foreground_color(detail::color_type foreground) noexcept
+FMT_CONSTEXPR auto make_foreground_color(color_type foreground) noexcept
     -> ansi_color_escape<Char> {
   return ansi_color_escape<Char>(foreground, "\x1b[38;2;");
 }
 
 template <typename Char>
-FMT_CONSTEXPR auto make_background_color(detail::color_type background) noexcept
+FMT_CONSTEXPR auto make_background_color(color_type background) noexcept
     -> ansi_color_escape<Char> {
   return ansi_color_escape<Char>(background, "\x1b[48;2;");
 }
@@ -434,7 +434,7 @@ template <typename Char> inline void reset_color(buffer<Char>& buffer) {
   buffer.append(reset_color.begin(), reset_color.end());
 }
 
-template <typename T> struct styled_arg : detail::view {
+template <typename T> struct styled_arg : view {
   const T& value;
   text_style style;
   styled_arg(const T& v, text_style s) : value(v), style(s) {}
@@ -442,145 +442,115 @@ template <typename T> struct styled_arg : detail::view {
 
 template <typename Char>
 void vformat_to(buffer<Char>& buf, const text_style& ts,
-                basic_string_view<Char> format_str,
-                basic_format_args<buffer_context<type_identity_t<Char>>> args) {
+                basic_string_view<Char> fmt,
+                basic_format_args<buffered_context<Char>> args) {
   bool has_style = false;
   if (ts.has_emphasis()) {
     has_style = true;
-    auto emphasis = detail::make_emphasis<Char>(ts.get_emphasis());
+    auto emphasis = make_emphasis<Char>(ts.get_emphasis());
     buf.append(emphasis.begin(), emphasis.end());
   }
   if (ts.has_foreground()) {
     has_style = true;
-    auto foreground = detail::make_foreground_color<Char>(ts.get_foreground());
+    auto foreground = make_foreground_color<Char>(ts.get_foreground());
     buf.append(foreground.begin(), foreground.end());
   }
   if (ts.has_background()) {
     has_style = true;
-    auto background = detail::make_background_color<Char>(ts.get_background());
+    auto background = make_background_color<Char>(ts.get_background());
     buf.append(background.begin(), background.end());
   }
-  detail::vformat_to(buf, format_str, args, {});
-  if (has_style) detail::reset_color<Char>(buf);
+  vformat_to(buf, fmt, args);
+  if (has_style) reset_color<Char>(buf);
 }
-
 }  // namespace detail
 
-inline void vprint(std::FILE* f, const text_style& ts, string_view fmt,
+inline void vprint(FILE* f, const text_style& ts, string_view fmt,
                    format_args args) {
-  // Legacy wide streams are not supported.
   auto buf = memory_buffer();
   detail::vformat_to(buf, ts, fmt, args);
-  if (detail::is_utf8()) {
-    detail::print(f, string_view(buf.begin(), buf.size()));
-    return;
-  }
-  buf.push_back('\0');
-  int result = std::fputs(buf.data(), f);
-  if (result < 0)
-    FMT_THROW(system_error(errno, FMT_STRING("cannot write to file")));
+  print(f, FMT_STRING("{}"), string_view(buf.begin(), buf.size()));
 }
 
 /**
-  \rst
-  Formats a string and prints it to the specified file stream using ANSI
-  escape sequences to specify text formatting.
-
-  **Example**::
-
-    fmt::print(fmt::emphasis::bold | fg(fmt::color::red),
-               "Elapsed time: {0:.2f} seconds", 1.23);
-  \endrst
+ * Formats a string and prints it to the specified file stream using ANSI
+ * escape sequences to specify text formatting.
+ *
+ * **Example**:
+ *
+ *     fmt::print(fmt::emphasis::bold | fg(fmt::color::red),
+ *                "Elapsed time: {0:.2f} seconds", 1.23);
  */
-template <typename S, typename... Args,
-          FMT_ENABLE_IF(detail::is_string<S>::value)>
-void print(std::FILE* f, const text_style& ts, const S& format_str,
-           const Args&... args) {
-  vprint(f, ts, format_str,
-         fmt::make_format_args<buffer_context<char_t<S>>>(args...));
+template <typename... T>
+void print(FILE* f, const text_style& ts, format_string<T...> fmt,
+           T&&... args) {
+  vprint(f, ts, fmt.str, vargs<T...>{{args...}});
 }
 
 /**
-  \rst
-  Formats a string and prints it to stdout using ANSI escape sequences to
-  specify text formatting.
-
-  **Example**::
-
-    fmt::print(fmt::emphasis::bold | fg(fmt::color::red),
-               "Elapsed time: {0:.2f} seconds", 1.23);
-  \endrst
+ * Formats a string and prints it to stdout using ANSI escape sequences to
+ * specify text formatting.
+ *
+ * **Example**:
+ *
+ *     fmt::print(fmt::emphasis::bold | fg(fmt::color::red),
+ *                "Elapsed time: {0:.2f} seconds", 1.23);
  */
-template <typename S, typename... Args,
-          FMT_ENABLE_IF(detail::is_string<S>::value)>
-void print(const text_style& ts, const S& format_str, const Args&... args) {
-  return print(stdout, ts, format_str, args...);
+template <typename... T>
+void print(const text_style& ts, format_string<T...> fmt, T&&... args) {
+  return print(stdout, ts, fmt, std::forward<T>(args)...);
 }
 
-template <typename S, typename Char = char_t<S>>
-inline auto vformat(
-    const text_style& ts, const S& format_str,
-    basic_format_args<buffer_context<type_identity_t<Char>>> args)
-    -> std::basic_string<Char> {
-  basic_memory_buffer<Char> buf;
-  detail::vformat_to(buf, ts, detail::to_string_view(format_str), args);
+inline auto vformat(const text_style& ts, string_view fmt, format_args args)
+    -> std::string {
+  auto buf = memory_buffer();
+  detail::vformat_to(buf, ts, fmt, args);
   return fmt::to_string(buf);
 }
 
 /**
-  \rst
-  Formats arguments and returns the result as a string using ANSI
-  escape sequences to specify text formatting.
-
-  **Example**::
-
-    #include <fmt/color.h>
-    std::string message = fmt::format(fmt::emphasis::bold | fg(fmt::color::red),
-                                      "The answer is {}", 42);
-  \endrst
-*/
-template <typename S, typename... Args, typename Char = char_t<S>>
-inline auto format(const text_style& ts, const S& format_str,
-                   const Args&... args) -> std::basic_string<Char> {
-  return fmt::vformat(ts, detail::to_string_view(format_str),
-                      fmt::make_format_args<buffer_context<Char>>(args...));
+ * Formats arguments and returns the result as a string using ANSI escape
+ * sequences to specify text formatting.
+ *
+ * **Example**:
+ *
+ * ```
+ * #include <fmt/color.h>
+ * std::string message = fmt::format(fmt::emphasis::bold | fg(fmt::color::red),
+ *                                   "The answer is {}", 42);
+ * ```
+ */
+template <typename... T>
+inline auto format(const text_style& ts, format_string<T...> fmt, T&&... args)
+    -> std::string {
+  return fmt::vformat(ts, fmt.str, vargs<T...>{{args...}});
 }
 
-/**
-  Formats a string with the given text_style and writes the output to ``out``.
- */
-template <typename OutputIt, typename Char,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, Char>::value)>
-auto vformat_to(OutputIt out, const text_style& ts,
-                basic_string_view<Char> format_str,
-                basic_format_args<buffer_context<type_identity_t<Char>>> args)
-    -> OutputIt {
-  auto&& buf = detail::get_buffer<Char>(out);
-  detail::vformat_to(buf, ts, format_str, args);
+/// Formats a string with the given text_style and writes the output to `out`.
+template <typename OutputIt,
+          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
+auto vformat_to(OutputIt out, const text_style& ts, string_view fmt,
+                format_args args) -> OutputIt {
+  auto&& buf = detail::get_buffer<char>(out);
+  detail::vformat_to(buf, ts, fmt, args);
   return detail::get_iterator(buf, out);
 }
 
 /**
-  \rst
-  Formats arguments with the given text_style, writes the result to the output
-  iterator ``out`` and returns the iterator past the end of the output range.
-
-  **Example**::
-
-    std::vector<char> out;
-    fmt::format_to(std::back_inserter(out),
-                   fmt::emphasis::bold | fg(fmt::color::red), "{}", 42);
-  \endrst
-*/
-template <
-    typename OutputIt, typename S, typename... Args,
-    bool enable = detail::is_output_iterator<OutputIt, char_t<S>>::value &&
-                  detail::is_string<S>::value>
-inline auto format_to(OutputIt out, const text_style& ts, const S& format_str,
-                      Args&&... args) ->
-    typename std::enable_if<enable, OutputIt>::type {
-  return vformat_to(out, ts, detail::to_string_view(format_str),
-                    fmt::make_format_args<buffer_context<char_t<S>>>(args...));
+ * Formats arguments with the given text style, writes the result to the output
+ * iterator `out` and returns the iterator past the end of the output range.
+ *
+ * **Example**:
+ *
+ *     std::vector<char> out;
+ *     fmt::format_to(std::back_inserter(out),
+ *                    fmt::emphasis::bold | fg(fmt::color::red), "{}", 42);
+ */
+template <typename OutputIt, typename... T,
+          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
+inline auto format_to(OutputIt out, const text_style& ts,
+                      format_string<T...> fmt, T&&... args) -> OutputIt {
+  return vformat_to(out, ts, fmt.str, vargs<T...>{{args...}});
 }
 
 template <typename T, typename Char>
@@ -589,47 +559,44 @@ struct formatter<detail::styled_arg<T>, Char> : formatter<T, Char> {
   auto format(const detail::styled_arg<T>& arg, FormatContext& ctx) const
       -> decltype(ctx.out()) {
     const auto& ts = arg.style;
-    const auto& value = arg.value;
     auto out = ctx.out();
 
     bool has_style = false;
     if (ts.has_emphasis()) {
       has_style = true;
       auto emphasis = detail::make_emphasis<Char>(ts.get_emphasis());
-      out = std::copy(emphasis.begin(), emphasis.end(), out);
+      out = detail::copy<Char>(emphasis.begin(), emphasis.end(), out);
     }
     if (ts.has_foreground()) {
       has_style = true;
       auto foreground =
           detail::make_foreground_color<Char>(ts.get_foreground());
-      out = std::copy(foreground.begin(), foreground.end(), out);
+      out = detail::copy<Char>(foreground.begin(), foreground.end(), out);
     }
     if (ts.has_background()) {
       has_style = true;
       auto background =
           detail::make_background_color<Char>(ts.get_background());
-      out = std::copy(background.begin(), background.end(), out);
+      out = detail::copy<Char>(background.begin(), background.end(), out);
     }
-    out = formatter<T, Char>::format(value, ctx);
+    out = formatter<T, Char>::format(arg.value, ctx);
     if (has_style) {
       auto reset_color = string_view("\x1b[0m");
-      out = std::copy(reset_color.begin(), reset_color.end(), out);
+      out = detail::copy<Char>(reset_color.begin(), reset_color.end(), out);
     }
     return out;
   }
 };
 
 /**
-  \rst
-  Returns an argument that will be formatted using ANSI escape sequences,
-  to be used in a formatting function.
-
-  **Example**::
-
-    fmt::print("Elapsed time: {0:.2f} seconds",
-               fmt::styled(1.23, fmt::fg(fmt::color::green) |
-                                 fmt::bg(fmt::color::blue)));
-  \endrst
+ * Returns an argument that will be formatted using ANSI escape sequences,
+ * to be used in a formatting function.
+ *
+ * **Example**:
+ *
+ *     fmt::print("Elapsed time: {0:.2f} seconds",
+ *                fmt::styled(1.23, fmt::fg(fmt::color::green) |
+ *                                  fmt::bg(fmt::color::blue)));
  */
 template <typename T>
 FMT_CONSTEXPR auto styled(const T& value, text_style ts)
diff --git a/include/fmt/compile.h b/include/fmt/compile.h
index 3b3f166e..29226350 100644
--- a/include/fmt/compile.h
+++ b/include/fmt/compile.h
@@ -8,46 +8,41 @@
 #ifndef FMT_COMPILE_H_
 #define FMT_COMPILE_H_
 
+#ifndef FMT_MODULE
+#  include <iterator>  // std::back_inserter
+#endif
+
 #include "format.h"
 
 FMT_BEGIN_NAMESPACE
-namespace detail {
-
-template <typename Char, typename InputIt>
-FMT_CONSTEXPR inline auto copy_str(InputIt begin, InputIt end,
-                                   counting_iterator it) -> counting_iterator {
-  return it + (end - begin);
-}
 
 // A compile-time string which is compiled into fast formatting code.
-class compiled_string {};
+FMT_EXPORT class compiled_string {};
+
+namespace detail {
 
 template <typename S>
 struct is_compiled_string : std::is_base_of<compiled_string, S> {};
 
 /**
-  \rst
-  Converts a string literal *s* into a format string that will be parsed at
-  compile time and converted into efficient formatting code. Requires C++17
-  ``constexpr if`` compiler support.
-
-  **Example**::
-
-    // Converts 42 into std::string using the most efficient method and no
-    // runtime format string processing.
-    std::string s = fmt::format(FMT_COMPILE("{}"), 42);
-  \endrst
+ * Converts a string literal `s` into a format string that will be parsed at
+ * compile time and converted into efficient formatting code. Requires C++17
+ * `constexpr if` compiler support.
+ *
+ * **Example**:
+ *
+ *     // Converts 42 into std::string using the most efficient method and no
+ *     // runtime format string processing.
+ *     std::string s = fmt::format(FMT_COMPILE("{}"), 42);
  */
 #if defined(__cpp_if_constexpr) && defined(__cpp_return_type_deduction)
-#  define FMT_COMPILE(s) \
-    FMT_STRING_IMPL(s, fmt::detail::compiled_string, explicit)
+#  define FMT_COMPILE(s) FMT_STRING_IMPL(s, fmt::compiled_string)
 #else
 #  define FMT_COMPILE(s) FMT_STRING(s)
 #endif
 
 #if FMT_USE_NONTYPE_TEMPLATE_ARGS
-template <typename Char, size_t N,
-          fmt::detail_exported::fixed_string<Char, N> Str>
+template <typename Char, size_t N, fmt::detail::fixed_string<Char, N> Str>
 struct udl_compiled_string : compiled_string {
   using char_type = Char;
   explicit constexpr operator basic_string_view<char_type>() const {
@@ -75,6 +70,29 @@ constexpr const auto& get([[maybe_unused]] const T& first,
     return detail::get<N - 1>(rest...);
 }
 
+#  if FMT_USE_NONTYPE_TEMPLATE_ARGS
+template <int N, typename T, typename... Args, typename Char>
+constexpr auto get_arg_index_by_name(basic_string_view<Char> name) -> int {
+  if constexpr (is_static_named_arg<T>()) {
+    if (name == T::name) return N;
+  }
+  if constexpr (sizeof...(Args) > 0)
+    return get_arg_index_by_name<N + 1, Args...>(name);
+  (void)name;  // Workaround an MSVC bug about "unused" parameter.
+  return -1;
+}
+#  endif
+
+template <typename... Args, typename Char>
+FMT_CONSTEXPR auto get_arg_index_by_name(basic_string_view<Char> name) -> int {
+#  if FMT_USE_NONTYPE_TEMPLATE_ARGS
+  if constexpr (sizeof...(Args) > 0)
+    return get_arg_index_by_name<0, Args...>(name);
+#  endif
+  (void)name;
+  return -1;
+}
+
 template <typename Char, typename... Args>
 constexpr int get_arg_index_by_name(basic_string_view<Char> name,
                                     type_list<Args...>) {
@@ -144,11 +162,12 @@ template <typename Char, typename T, int N> struct field {
   template <typename OutputIt, typename... Args>
   constexpr OutputIt format(OutputIt out, const Args&... args) const {
     const T& arg = get_arg_checked<T, N>(args...);
-    if constexpr (std::is_convertible_v<T, basic_string_view<Char>>) {
+    if constexpr (std::is_convertible<T, basic_string_view<Char>>::value) {
       auto s = basic_string_view<Char>(arg);
-      return copy_str<Char>(s.begin(), s.end(), out);
+      return copy<Char>(s.begin(), s.end(), out);
+    } else {
+      return write<Char>(out, arg);
     }
-    return write<Char>(out, arg);
   }
 };
 
@@ -236,13 +255,12 @@ constexpr size_t parse_text(basic_string_view<Char> str, size_t pos) {
 }
 
 template <typename Args, size_t POS, int ID, typename S>
-constexpr auto compile_format_string(S format_str);
+constexpr auto compile_format_string(S fmt);
 
 template <typename Args, size_t POS, int ID, typename T, typename S>
-constexpr auto parse_tail(T head, S format_str) {
-  if constexpr (POS !=
-                basic_string_view<typename S::char_type>(format_str).size()) {
-    constexpr auto tail = compile_format_string<Args, POS, ID>(format_str);
+constexpr auto parse_tail(T head, S fmt) {
+  if constexpr (POS != basic_string_view<typename S::char_type>(fmt).size()) {
+    constexpr auto tail = compile_format_string<Args, POS, ID>(fmt);
     if constexpr (std::is_same<remove_cvref_t<decltype(tail)>,
                                unknown_format>())
       return tail;
@@ -274,6 +292,7 @@ constexpr parse_specs_result<T, Char> parse_specs(basic_string_view<Char> str,
 }
 
 template <typename Char> struct arg_id_handler {
+  arg_id_kind kind;
   arg_ref<Char> arg_id;
 
   constexpr int on_auto() {
@@ -281,25 +300,28 @@ template <typename Char> struct arg_id_handler {
     return 0;
   }
   constexpr int on_index(int id) {
+    kind = arg_id_kind::index;
     arg_id = arg_ref<Char>(id);
     return 0;
   }
   constexpr int on_name(basic_string_view<Char> id) {
+    kind = arg_id_kind::name;
     arg_id = arg_ref<Char>(id);
     return 0;
   }
 };
 
 template <typename Char> struct parse_arg_id_result {
+  arg_id_kind kind;
   arg_ref<Char> arg_id;
   const Char* arg_id_end;
 };
 
 template <int ID, typename Char>
 constexpr auto parse_arg_id(const Char* begin, const Char* end) {
-  auto handler = arg_id_handler<Char>{arg_ref<Char>{}};
+  auto handler = arg_id_handler<Char>{arg_id_kind::none, arg_ref<Char>{}};
   auto arg_id_end = parse_arg_id(begin, end, handler);
-  return parse_arg_id_result<Char>{handler.arg_id, arg_id_end};
+  return parse_arg_id_result<Char>{handler.kind, handler.arg_id, arg_id_end};
 }
 
 template <typename T, typename Enable = void> struct field_type {
@@ -313,14 +335,13 @@ struct field_type<T, enable_if_t<detail::is_named_arg<T>::value>> {
 
 template <typename T, typename Args, size_t END_POS, int ARG_INDEX, int NEXT_ID,
           typename S>
-constexpr auto parse_replacement_field_then_tail(S format_str) {
+constexpr auto parse_replacement_field_then_tail(S fmt) {
   using char_type = typename S::char_type;
-  constexpr auto str = basic_string_view<char_type>(format_str);
+  constexpr auto str = basic_string_view<char_type>(fmt);
   constexpr char_type c = END_POS != str.size() ? str[END_POS] : char_type();
   if constexpr (c == '}') {
     return parse_tail<Args, END_POS + 1, NEXT_ID>(
-        field<char_type, typename field_type<T>::type, ARG_INDEX>(),
-        format_str);
+        field<char_type, typename field_type<T>::type, ARG_INDEX>(), fmt);
   } else if constexpr (c != ':') {
     FMT_THROW(format_error("expected ':'"));
   } else {
@@ -333,7 +354,7 @@ constexpr auto parse_replacement_field_then_tail(S format_str) {
       return parse_tail<Args, result.end + 1, result.next_arg_id>(
           spec_field<char_type, typename field_type<T>::type, ARG_INDEX>{
               result.fmt},
-          format_str);
+          fmt);
     }
   }
 }
@@ -341,22 +362,21 @@ constexpr auto parse_replacement_field_then_tail(S format_str) {
 // Compiles a non-empty format string and returns the compiled representation
 // or unknown_format() on unrecognized input.
 template <typename Args, size_t POS, int ID, typename S>
-constexpr auto compile_format_string(S format_str) {
+constexpr auto compile_format_string(S fmt) {
   using char_type = typename S::char_type;
-  constexpr auto str = basic_string_view<char_type>(format_str);
+  constexpr auto str = basic_string_view<char_type>(fmt);
   if constexpr (str[POS] == '{') {
     if constexpr (POS + 1 == str.size())
       FMT_THROW(format_error("unmatched '{' in format string"));
     if constexpr (str[POS + 1] == '{') {
-      return parse_tail<Args, POS + 2, ID>(make_text(str, POS, 1), format_str);
+      return parse_tail<Args, POS + 2, ID>(make_text(str, POS, 1), fmt);
     } else if constexpr (str[POS + 1] == '}' || str[POS + 1] == ':') {
       static_assert(ID != manual_indexing_id,
                     "cannot switch from manual to automatic argument indexing");
       constexpr auto next_id =
           ID != manual_indexing_id ? ID + 1 : manual_indexing_id;
       return parse_replacement_field_then_tail<get_type<ID, Args>, Args,
-                                               POS + 1, ID, next_id>(
-          format_str);
+                                               POS + 1, ID, next_id>(fmt);
     } else {
       constexpr auto arg_id_result =
           parse_arg_id<ID>(str.data() + POS + 1, str.data() + str.size());
@@ -364,28 +384,27 @@ constexpr auto compile_format_string(S format_str) {
       constexpr char_type c =
           arg_id_end_pos != str.size() ? str[arg_id_end_pos] : char_type();
       static_assert(c == '}' || c == ':', "missing '}' in format string");
-      if constexpr (arg_id_result.arg_id.kind == arg_id_kind::index) {
+      if constexpr (arg_id_result.kind == arg_id_kind::index) {
         static_assert(
             ID == manual_indexing_id || ID == 0,
             "cannot switch from automatic to manual argument indexing");
-        constexpr auto arg_index = arg_id_result.arg_id.val.index;
+        constexpr auto arg_index = arg_id_result.arg_id.index;
         return parse_replacement_field_then_tail<get_type<arg_index, Args>,
                                                  Args, arg_id_end_pos,
                                                  arg_index, manual_indexing_id>(
-            format_str);
-      } else if constexpr (arg_id_result.arg_id.kind == arg_id_kind::name) {
+            fmt);
+      } else if constexpr (arg_id_result.kind == arg_id_kind::name) {
         constexpr auto arg_index =
-            get_arg_index_by_name(arg_id_result.arg_id.val.name, Args{});
+            get_arg_index_by_name(arg_id_result.arg_id.name, Args{});
         if constexpr (arg_index >= 0) {
           constexpr auto next_id =
               ID != manual_indexing_id ? ID + 1 : manual_indexing_id;
           return parse_replacement_field_then_tail<
               decltype(get_type<arg_index, Args>::value), Args, arg_id_end_pos,
-              arg_index, next_id>(format_str);
+              arg_index, next_id>(fmt);
         } else if constexpr (c == '}') {
           return parse_tail<Args, arg_id_end_pos + 1, ID>(
-              runtime_named_field<char_type>{arg_id_result.arg_id.val.name},
-              format_str);
+              runtime_named_field<char_type>{arg_id_result.arg_id.name}, fmt);
         } else if constexpr (c == ':') {
           return unknown_format();  // no type info for specs parsing
         }
@@ -394,29 +413,26 @@ constexpr auto compile_format_string(S format_str) {
   } else if constexpr (str[POS] == '}') {
     if constexpr (POS + 1 == str.size())
       FMT_THROW(format_error("unmatched '}' in format string"));
-    return parse_tail<Args, POS + 2, ID>(make_text(str, POS, 1), format_str);
+    return parse_tail<Args, POS + 2, ID>(make_text(str, POS, 1), fmt);
   } else {
     constexpr auto end = parse_text(str, POS + 1);
     if constexpr (end - POS > 1) {
-      return parse_tail<Args, end, ID>(make_text(str, POS, end - POS),
-                                       format_str);
+      return parse_tail<Args, end, ID>(make_text(str, POS, end - POS), fmt);
     } else {
-      return parse_tail<Args, end, ID>(code_unit<char_type>{str[POS]},
-                                       format_str);
+      return parse_tail<Args, end, ID>(code_unit<char_type>{str[POS]}, fmt);
     }
   }
 }
 
 template <typename... Args, typename S,
           FMT_ENABLE_IF(detail::is_compiled_string<S>::value)>
-constexpr auto compile(S format_str) {
-  constexpr auto str = basic_string_view<typename S::char_type>(format_str);
+constexpr auto compile(S fmt) {
+  constexpr auto str = basic_string_view<typename S::char_type>(fmt);
   if constexpr (str.size() == 0) {
     return detail::make_text(str, 0, 0);
   } else {
     constexpr auto result =
-        detail::compile_format_string<detail::type_list<Args...>, 0, 0>(
-            format_str);
+        detail::compile_format_string<detail::type_list<Args...>, 0, 0>(fmt);
     return result;
   }
 }
@@ -488,40 +504,40 @@ FMT_CONSTEXPR OutputIt format_to(OutputIt out, const S&, Args&&... args) {
 
 template <typename OutputIt, typename S, typename... Args,
           FMT_ENABLE_IF(detail::is_compiled_string<S>::value)>
-auto format_to_n(OutputIt out, size_t n, const S& format_str, Args&&... args)
+auto format_to_n(OutputIt out, size_t n, const S& fmt, Args&&... args)
     -> format_to_n_result<OutputIt> {
   using traits = detail::fixed_buffer_traits;
   auto buf = detail::iterator_buffer<OutputIt, char, traits>(out, n);
-  fmt::format_to(std::back_inserter(buf), format_str,
-                 std::forward<Args>(args)...);
+  fmt::format_to(std::back_inserter(buf), fmt, std::forward<Args>(args)...);
   return {buf.out(), buf.count()};
 }
 
 template <typename S, typename... Args,
           FMT_ENABLE_IF(detail::is_compiled_string<S>::value)>
-FMT_CONSTEXPR20 auto formatted_size(const S& format_str, const Args&... args)
+FMT_CONSTEXPR20 auto formatted_size(const S& fmt, const Args&... args)
     -> size_t {
-  return fmt::format_to(detail::counting_iterator(), format_str, args...)
-      .count();
+  auto buf = detail::counting_buffer<>();
+  fmt::format_to(appender(buf), fmt, args...);
+  return buf.count();
 }
 
 template <typename S, typename... Args,
           FMT_ENABLE_IF(detail::is_compiled_string<S>::value)>
-void print(std::FILE* f, const S& format_str, const Args&... args) {
+void print(std::FILE* f, const S& fmt, const Args&... args) {
   memory_buffer buffer;
-  fmt::format_to(std::back_inserter(buffer), format_str, args...);
+  fmt::format_to(std::back_inserter(buffer), fmt, args...);
   detail::print(f, {buffer.data(), buffer.size()});
 }
 
 template <typename S, typename... Args,
           FMT_ENABLE_IF(detail::is_compiled_string<S>::value)>
-void print(const S& format_str, const Args&... args) {
-  print(stdout, format_str, args...);
+void print(const S& fmt, const Args&... args) {
+  print(stdout, fmt, args...);
 }
 
 #if FMT_USE_NONTYPE_TEMPLATE_ARGS
 inline namespace literals {
-template <detail_exported::fixed_string Str> constexpr auto operator""_cf() {
+template <detail::fixed_string Str> constexpr auto operator""_cf() {
   using char_t = remove_cvref_t<decltype(Str.data[0])>;
   return detail::udl_compiled_string<char_t, sizeof(Str.data) / sizeof(char_t),
                                      Str>();
diff --git a/include/fmt/core.h b/include/fmt/core.h
index 94f3f22b..8ca735f0 100644
--- a/include/fmt/core.h
+++ b/include/fmt/core.h
@@ -1,2969 +1,5 @@
-// Formatting library for C++ - the core API for char/UTF-8
-//
-// Copyright (c) 2012 - present, Victor Zverovich
-// All rights reserved.
-//
-// For the license information refer to format.h.
+// This file is only provided for compatibility and may be removed in future
+// versions. Use fmt/base.h if you don't need fmt::format and fmt/format.h
+// otherwise.
 
-#ifndef FMT_CORE_H_
-#define FMT_CORE_H_
-
-#include <cstddef>  // std::byte
-#include <cstdio>   // std::FILE
-#include <cstring>  // std::strlen
-#include <iterator>
-#include <limits>
-#include <memory>  // std::addressof
-#include <string>
-#include <type_traits>
-
-// The fmt library version in the form major * 10000 + minor * 100 + patch.
-#define FMT_VERSION 100200
-
-#if defined(__clang__) && !defined(__ibmxl__)
-#  define FMT_CLANG_VERSION (__clang_major__ * 100 + __clang_minor__)
-#else
-#  define FMT_CLANG_VERSION 0
-#endif
-
-#if defined(__GNUC__) && !defined(__clang__) && !defined(__INTEL_COMPILER) && \
-    !defined(__NVCOMPILER)
-#  define FMT_GCC_VERSION (__GNUC__ * 100 + __GNUC_MINOR__)
-#else
-#  define FMT_GCC_VERSION 0
-#endif
-
-#ifndef FMT_GCC_PRAGMA
-// Workaround _Pragma bug https://gcc.gnu.org/bugzilla/show_bug.cgi?id=59884.
-#  if FMT_GCC_VERSION >= 504
-#    define FMT_GCC_PRAGMA(arg) _Pragma(arg)
-#  else
-#    define FMT_GCC_PRAGMA(arg)
-#  endif
-#endif
-
-#ifdef __ICL
-#  define FMT_ICC_VERSION __ICL
-#elif defined(__INTEL_COMPILER)
-#  define FMT_ICC_VERSION __INTEL_COMPILER
-#else
-#  define FMT_ICC_VERSION 0
-#endif
-
-#ifdef _MSC_VER
-#  define FMT_MSC_VERSION _MSC_VER
-#  define FMT_MSC_WARNING(...) __pragma(warning(__VA_ARGS__))
-#else
-#  define FMT_MSC_VERSION 0
-#  define FMT_MSC_WARNING(...)
-#endif
-
-#ifdef _MSVC_LANG
-#  define FMT_CPLUSPLUS _MSVC_LANG
-#else
-#  define FMT_CPLUSPLUS __cplusplus
-#endif
-
-#ifdef __has_feature
-#  define FMT_HAS_FEATURE(x) __has_feature(x)
-#else
-#  define FMT_HAS_FEATURE(x) 0
-#endif
-
-#if defined(__has_include) || FMT_ICC_VERSION >= 1600 || FMT_MSC_VERSION > 1900
-#  define FMT_HAS_INCLUDE(x) __has_include(x)
-#else
-#  define FMT_HAS_INCLUDE(x) 0
-#endif
-
-#ifdef __has_cpp_attribute
-#  define FMT_HAS_CPP_ATTRIBUTE(x) __has_cpp_attribute(x)
-#else
-#  define FMT_HAS_CPP_ATTRIBUTE(x) 0
-#endif
-
-#define FMT_HAS_CPP14_ATTRIBUTE(attribute) \
-  (FMT_CPLUSPLUS >= 201402L && FMT_HAS_CPP_ATTRIBUTE(attribute))
-
-#define FMT_HAS_CPP17_ATTRIBUTE(attribute) \
-  (FMT_CPLUSPLUS >= 201703L && FMT_HAS_CPP_ATTRIBUTE(attribute))
-
-// Check if relaxed C++14 constexpr is supported.
-// GCC doesn't allow throw in constexpr until version 6 (bug 67371).
-#ifndef FMT_USE_CONSTEXPR
-#  if (FMT_HAS_FEATURE(cxx_relaxed_constexpr) || FMT_MSC_VERSION >= 1912 || \
-       (FMT_GCC_VERSION >= 600 && FMT_CPLUSPLUS >= 201402L)) &&             \
-      !FMT_ICC_VERSION && (!defined(__NVCC__) || FMT_CPLUSPLUS >= 202002L)
-#    define FMT_USE_CONSTEXPR 1
-#  else
-#    define FMT_USE_CONSTEXPR 0
-#  endif
-#endif
-#if FMT_USE_CONSTEXPR
-#  define FMT_CONSTEXPR constexpr
-#else
-#  define FMT_CONSTEXPR
-#endif
-
-#if (FMT_CPLUSPLUS >= 202002L ||                                \
-     (FMT_CPLUSPLUS >= 201709L && FMT_GCC_VERSION >= 1002)) &&  \
-    ((!defined(_GLIBCXX_RELEASE) || _GLIBCXX_RELEASE >= 10) &&  \
-     (!defined(_LIBCPP_VERSION) || _LIBCPP_VERSION >= 10000) && \
-     (!FMT_MSC_VERSION || FMT_MSC_VERSION >= 1928)) &&          \
-    defined(__cpp_lib_is_constant_evaluated)
-#  define FMT_CONSTEXPR20 constexpr
-#else
-#  define FMT_CONSTEXPR20
-#endif
-
-// Check if constexpr std::char_traits<>::{compare,length} are supported.
-#if defined(__GLIBCXX__)
-#  if FMT_CPLUSPLUS >= 201703L && defined(_GLIBCXX_RELEASE) && \
-      _GLIBCXX_RELEASE >= 7  // GCC 7+ libstdc++ has _GLIBCXX_RELEASE.
-#    define FMT_CONSTEXPR_CHAR_TRAITS constexpr
-#  endif
-#elif defined(_LIBCPP_VERSION) && FMT_CPLUSPLUS >= 201703L && \
-    _LIBCPP_VERSION >= 4000
-#  define FMT_CONSTEXPR_CHAR_TRAITS constexpr
-#elif FMT_MSC_VERSION >= 1914 && FMT_CPLUSPLUS >= 201703L
-#  define FMT_CONSTEXPR_CHAR_TRAITS constexpr
-#endif
-#ifndef FMT_CONSTEXPR_CHAR_TRAITS
-#  define FMT_CONSTEXPR_CHAR_TRAITS
-#endif
-
-// Check if exceptions are disabled.
-#ifndef FMT_EXCEPTIONS
-#  if (defined(__GNUC__) && !defined(__EXCEPTIONS)) || \
-      (FMT_MSC_VERSION && !_HAS_EXCEPTIONS)
-#    define FMT_EXCEPTIONS 0
-#  else
-#    define FMT_EXCEPTIONS 1
-#  endif
-#endif
-
-// Disable [[noreturn]] on MSVC/NVCC because of bogus unreachable code warnings.
-#if FMT_EXCEPTIONS && FMT_HAS_CPP_ATTRIBUTE(noreturn) && !FMT_MSC_VERSION && \
-    !defined(__NVCC__)
-#  define FMT_NORETURN [[noreturn]]
-#else
-#  define FMT_NORETURN
-#endif
-
-#ifndef FMT_NODISCARD
-#  if FMT_HAS_CPP17_ATTRIBUTE(nodiscard)
-#    define FMT_NODISCARD [[nodiscard]]
-#  else
-#    define FMT_NODISCARD
-#  endif
-#endif
-
-#ifndef FMT_INLINE
-#  if FMT_GCC_VERSION || FMT_CLANG_VERSION
-#    define FMT_INLINE inline __attribute__((always_inline))
-#  else
-#    define FMT_INLINE inline
-#  endif
-#endif
-
-#ifdef _MSC_VER
-#  define FMT_UNCHECKED_ITERATOR(It) \
-    using _Unchecked_type = It  // Mark iterator as checked.
-#else
-#  define FMT_UNCHECKED_ITERATOR(It) using unchecked_type = It
-#endif
-
-#ifndef FMT_BEGIN_NAMESPACE
-#  define FMT_BEGIN_NAMESPACE \
-    namespace fmt {           \
-    inline namespace v10 {
-#  define FMT_END_NAMESPACE \
-    }                       \
-    }
-#endif
-
-#ifndef FMT_EXPORT
-#  define FMT_EXPORT
-#  define FMT_BEGIN_EXPORT
-#  define FMT_END_EXPORT
-#endif
-
-#if FMT_GCC_VERSION || FMT_CLANG_VERSION
-#  define FMT_VISIBILITY(value) __attribute__((visibility(value)))
-#else
-#  define FMT_VISIBILITY(value)
-#endif
-
-#if !defined(FMT_HEADER_ONLY) && defined(_WIN32)
-#  if defined(FMT_LIB_EXPORT)
-#    define FMT_API __declspec(dllexport)
-#  elif defined(FMT_SHARED)
-#    define FMT_API __declspec(dllimport)
-#  endif
-#elif defined(FMT_LIB_EXPORT) || defined(FMT_SHARED)
-#  define FMT_API FMT_VISIBILITY("default")
-#endif
-#ifndef FMT_API
-#  define FMT_API
-#endif
-
-// libc++ supports string_view in pre-c++17.
-#if FMT_HAS_INCLUDE(<string_view>) && \
-    (FMT_CPLUSPLUS >= 201703L || defined(_LIBCPP_VERSION))
-#  include <string_view>
-#  define FMT_USE_STRING_VIEW
-#elif FMT_HAS_INCLUDE("experimental/string_view") && FMT_CPLUSPLUS >= 201402L
-#  include <experimental/string_view>
-#  define FMT_USE_EXPERIMENTAL_STRING_VIEW
-#endif
-
-#ifndef FMT_UNICODE
-#  define FMT_UNICODE !FMT_MSC_VERSION
-#endif
-
-#ifndef FMT_CONSTEVAL
-#  if ((FMT_GCC_VERSION >= 1000 || FMT_CLANG_VERSION >= 1101) && \
-       (!defined(__apple_build_version__) ||                     \
-        __apple_build_version__ >= 14000029L) &&                 \
-       FMT_CPLUSPLUS >= 202002L) ||                              \
-      (defined(__cpp_consteval) &&                               \
-       (!FMT_MSC_VERSION || FMT_MSC_VERSION >= 1929))
-// consteval is broken in MSVC before VS2019 version 16.10 and Apple clang
-// before 14.
-#    define FMT_CONSTEVAL consteval
-#    define FMT_HAS_CONSTEVAL
-#  else
-#    define FMT_CONSTEVAL
-#  endif
-#endif
-
-#ifndef FMT_USE_NONTYPE_TEMPLATE_ARGS
-#  if defined(__cpp_nontype_template_args) &&                  \
-      ((FMT_GCC_VERSION >= 903 && FMT_CPLUSPLUS >= 201709L) || \
-       __cpp_nontype_template_args >= 201911L) &&              \
-      !defined(__NVCOMPILER) && !defined(__LCC__)
-#    define FMT_USE_NONTYPE_TEMPLATE_ARGS 1
-#  else
-#    define FMT_USE_NONTYPE_TEMPLATE_ARGS 0
-#  endif
-#endif
-
-// GCC < 5 requires this-> in decltype
-#ifndef FMT_DECLTYPE_THIS
-#  if FMT_GCC_VERSION && FMT_GCC_VERSION < 500
-#    define FMT_DECLTYPE_THIS this->
-#  else
-#    define FMT_DECLTYPE_THIS
-#  endif
-#endif
-
-// Enable minimal optimizations for more compact code in debug mode.
-FMT_GCC_PRAGMA("GCC push_options")
-#if !defined(__OPTIMIZE__) && !defined(__NVCOMPILER) && !defined(__LCC__) && \
-    !defined(__CUDACC__)
-FMT_GCC_PRAGMA("GCC optimize(\"Og\")")
-#endif
-
-FMT_BEGIN_NAMESPACE
-
-// Implementations of enable_if_t and other metafunctions for older systems.
-template <bool B, typename T = void>
-using enable_if_t = typename std::enable_if<B, T>::type;
-template <bool B, typename T, typename F>
-using conditional_t = typename std::conditional<B, T, F>::type;
-template <bool B> using bool_constant = std::integral_constant<bool, B>;
-template <typename T>
-using remove_reference_t = typename std::remove_reference<T>::type;
-template <typename T>
-using remove_const_t = typename std::remove_const<T>::type;
-template <typename T>
-using remove_cvref_t = typename std::remove_cv<remove_reference_t<T>>::type;
-template <typename T> struct type_identity {
-  using type = T;
-};
-template <typename T> using type_identity_t = typename type_identity<T>::type;
-template <typename T>
-using underlying_t = typename std::underlying_type<T>::type;
-
-// Checks whether T is a container with contiguous storage.
-template <typename T> struct is_contiguous : std::false_type {};
-template <typename Char>
-struct is_contiguous<std::basic_string<Char>> : std::true_type {};
-
-struct monostate {
-  constexpr monostate() {}
-};
-
-// An enable_if helper to be used in template parameters which results in much
-// shorter symbols: https://godbolt.org/z/sWw4vP. Extra parentheses are needed
-// to workaround a bug in MSVC 2019 (see #1140 and #1186).
-#ifdef FMT_DOC
-#  define FMT_ENABLE_IF(...)
-#else
-#  define FMT_ENABLE_IF(...) fmt::enable_if_t<(__VA_ARGS__), int> = 0
-#endif
-
-// This is defined in core.h instead of format.h to avoid injecting in std.
-// It is a template to avoid undesirable implicit conversions to std::byte.
-#ifdef __cpp_lib_byte
-template <typename T, FMT_ENABLE_IF(std::is_same<T, std::byte>::value)>
-inline auto format_as(T b) -> unsigned char {
-  return static_cast<unsigned char>(b);
-}
-#endif
-
-namespace detail {
-// Suppresses "unused variable" warnings with the method described in
-// https://herbsutter.com/2009/10/18/mailbag-shutting-up-compiler-warnings/.
-// (void)var does not work on many Intel compilers.
-template <typename... T> FMT_CONSTEXPR void ignore_unused(const T&...) {}
-
-constexpr FMT_INLINE auto is_constant_evaluated(
-    bool default_value = false) noexcept -> bool {
-// Workaround for incompatibility between libstdc++ consteval-based
-// std::is_constant_evaluated() implementation and clang-14.
-// https://github.com/fmtlib/fmt/issues/3247
-#if FMT_CPLUSPLUS >= 202002L && defined(_GLIBCXX_RELEASE) && \
-    _GLIBCXX_RELEASE >= 12 &&                                \
-    (FMT_CLANG_VERSION >= 1400 && FMT_CLANG_VERSION < 1500)
-  ignore_unused(default_value);
-  return __builtin_is_constant_evaluated();
-#elif defined(__cpp_lib_is_constant_evaluated)
-  ignore_unused(default_value);
-  return std::is_constant_evaluated();
-#else
-  return default_value;
-#endif
-}
-
-// Suppresses "conditional expression is constant" warnings.
-template <typename T> constexpr FMT_INLINE auto const_check(T value) -> T {
-  return value;
-}
-
-FMT_NORETURN FMT_API void assert_fail(const char* file, int line,
-                                      const char* message);
-
-#ifndef FMT_ASSERT
-#  ifdef NDEBUG
-// FMT_ASSERT is not empty to avoid -Wempty-body.
-#    define FMT_ASSERT(condition, message) \
-      fmt::detail::ignore_unused((condition), (message))
-#  else
-#    define FMT_ASSERT(condition, message)                                    \
-      ((condition) /* void() fails with -Winvalid-constexpr on clang 4.0.1 */ \
-           ? (void)0                                                          \
-           : fmt::detail::assert_fail(__FILE__, __LINE__, (message)))
-#  endif
-#endif
-
-#if defined(FMT_USE_STRING_VIEW)
-template <typename Char> using std_string_view = std::basic_string_view<Char>;
-#elif defined(FMT_USE_EXPERIMENTAL_STRING_VIEW)
-template <typename Char>
-using std_string_view = std::experimental::basic_string_view<Char>;
-#else
-template <typename T> struct std_string_view {};
-#endif
-
-#ifdef FMT_USE_INT128
-// Do nothing.
-#elif defined(__SIZEOF_INT128__) && !defined(__NVCC__) && \
-    !(FMT_CLANG_VERSION && FMT_MSC_VERSION)
-#  define FMT_USE_INT128 1
-using int128_opt = __int128_t;  // An optional native 128-bit integer.
-using uint128_opt = __uint128_t;
-template <typename T> inline auto convert_for_visit(T value) -> T {
-  return value;
-}
-#else
-#  define FMT_USE_INT128 0
-#endif
-#if !FMT_USE_INT128
-enum class int128_opt {};
-enum class uint128_opt {};
-// Reduce template instantiations.
-template <typename T> auto convert_for_visit(T) -> monostate { return {}; }
-#endif
-
-// Casts a nonnegative integer to unsigned.
-template <typename Int>
-FMT_CONSTEXPR auto to_unsigned(Int value) ->
-    typename std::make_unsigned<Int>::type {
-  FMT_ASSERT(std::is_unsigned<Int>::value || value >= 0, "negative value");
-  return static_cast<typename std::make_unsigned<Int>::type>(value);
-}
-
-FMT_CONSTEXPR inline auto is_utf8() -> bool {
-  FMT_MSC_WARNING(suppress : 4566) constexpr unsigned char section[] = "\u00A7";
-
-  // Avoid buggy sign extensions in MSVC's constant evaluation mode (#2297).
-  using uchar = unsigned char;
-  return FMT_UNICODE || (sizeof(section) == 3 && uchar(section[0]) == 0xC2 &&
-                         uchar(section[1]) == 0xA7);
-}
-}  // namespace detail
-
-/**
-  An implementation of ``std::basic_string_view`` for pre-C++17. It provides a
-  subset of the API. ``fmt::basic_string_view`` is used for format strings even
-  if ``std::string_view`` is available to prevent issues when a library is
-  compiled with a different ``-std`` option than the client code (which is not
-  recommended).
- */
-FMT_EXPORT
-template <typename Char> class basic_string_view {
- private:
-  const Char* data_;
-  size_t size_;
-
- public:
-  using value_type = Char;
-  using iterator = const Char*;
-
-  constexpr basic_string_view() noexcept : data_(nullptr), size_(0) {}
-
-  /** Constructs a string reference object from a C string and a size. */
-  constexpr basic_string_view(const Char* s, size_t count) noexcept
-      : data_(s), size_(count) {}
-
-  /**
-    \rst
-    Constructs a string reference object from a C string computing
-    the size with ``std::char_traits<Char>::length``.
-    \endrst
-   */
-  FMT_CONSTEXPR_CHAR_TRAITS
-  FMT_INLINE
-  basic_string_view(const Char* s)
-      : data_(s),
-        size_(detail::const_check(std::is_same<Char, char>::value &&
-                                  !detail::is_constant_evaluated(true))
-                  ? std::strlen(reinterpret_cast<const char*>(s))
-                  : std::char_traits<Char>::length(s)) {}
-
-  /** Constructs a string reference from a ``std::basic_string`` object. */
-  template <typename Traits, typename Alloc>
-  FMT_CONSTEXPR basic_string_view(
-      const std::basic_string<Char, Traits, Alloc>& s) noexcept
-      : data_(s.data()), size_(s.size()) {}
-
-  template <typename S, FMT_ENABLE_IF(std::is_same<
-                                      S, detail::std_string_view<Char>>::value)>
-  FMT_CONSTEXPR basic_string_view(S s) noexcept
-      : data_(s.data()), size_(s.size()) {}
-
-  /** Returns a pointer to the string data. */
-  constexpr auto data() const noexcept -> const Char* { return data_; }
-
-  /** Returns the string size. */
-  constexpr auto size() const noexcept -> size_t { return size_; }
-
-  constexpr auto begin() const noexcept -> iterator { return data_; }
-  constexpr auto end() const noexcept -> iterator { return data_ + size_; }
-
-  constexpr auto operator[](size_t pos) const noexcept -> const Char& {
-    return data_[pos];
-  }
-
-  FMT_CONSTEXPR void remove_prefix(size_t n) noexcept {
-    data_ += n;
-    size_ -= n;
-  }
-
-  FMT_CONSTEXPR_CHAR_TRAITS auto starts_with(
-      basic_string_view<Char> sv) const noexcept -> bool {
-    return size_ >= sv.size_ &&
-           std::char_traits<Char>::compare(data_, sv.data_, sv.size_) == 0;
-  }
-  FMT_CONSTEXPR_CHAR_TRAITS auto starts_with(Char c) const noexcept -> bool {
-    return size_ >= 1 && std::char_traits<Char>::eq(*data_, c);
-  }
-  FMT_CONSTEXPR_CHAR_TRAITS auto starts_with(const Char* s) const -> bool {
-    return starts_with(basic_string_view<Char>(s));
-  }
-
-  // Lexicographically compare this string reference to other.
-  FMT_CONSTEXPR_CHAR_TRAITS auto compare(basic_string_view other) const -> int {
-    size_t str_size = size_ < other.size_ ? size_ : other.size_;
-    int result = std::char_traits<Char>::compare(data_, other.data_, str_size);
-    if (result == 0)
-      result = size_ == other.size_ ? 0 : (size_ < other.size_ ? -1 : 1);
-    return result;
-  }
-
-  FMT_CONSTEXPR_CHAR_TRAITS friend auto operator==(basic_string_view lhs,
-                                                   basic_string_view rhs)
-      -> bool {
-    return lhs.compare(rhs) == 0;
-  }
-  friend auto operator!=(basic_string_view lhs, basic_string_view rhs) -> bool {
-    return lhs.compare(rhs) != 0;
-  }
-  friend auto operator<(basic_string_view lhs, basic_string_view rhs) -> bool {
-    return lhs.compare(rhs) < 0;
-  }
-  friend auto operator<=(basic_string_view lhs, basic_string_view rhs) -> bool {
-    return lhs.compare(rhs) <= 0;
-  }
-  friend auto operator>(basic_string_view lhs, basic_string_view rhs) -> bool {
-    return lhs.compare(rhs) > 0;
-  }
-  friend auto operator>=(basic_string_view lhs, basic_string_view rhs) -> bool {
-    return lhs.compare(rhs) >= 0;
-  }
-};
-
-FMT_EXPORT
-using string_view = basic_string_view<char>;
-
-/** Specifies if ``T`` is a character type. Can be specialized by users. */
-FMT_EXPORT
-template <typename T> struct is_char : std::false_type {};
-template <> struct is_char<char> : std::true_type {};
-
-namespace detail {
-
-// A base class for compile-time strings.
-struct compile_string {};
-
-template <typename S>
-struct is_compile_string : std::is_base_of<compile_string, S> {};
-
-template <typename Char, FMT_ENABLE_IF(is_char<Char>::value)>
-FMT_INLINE auto to_string_view(const Char* s) -> basic_string_view<Char> {
-  return s;
-}
-template <typename Char, typename Traits, typename Alloc>
-inline auto to_string_view(const std::basic_string<Char, Traits, Alloc>& s)
-    -> basic_string_view<Char> {
-  return s;
-}
-template <typename Char>
-constexpr auto to_string_view(basic_string_view<Char> s)
-    -> basic_string_view<Char> {
-  return s;
-}
-template <typename Char,
-          FMT_ENABLE_IF(!std::is_empty<std_string_view<Char>>::value)>
-inline auto to_string_view(std_string_view<Char> s) -> basic_string_view<Char> {
-  return s;
-}
-template <typename S, FMT_ENABLE_IF(is_compile_string<S>::value)>
-constexpr auto to_string_view(const S& s)
-    -> basic_string_view<typename S::char_type> {
-  return basic_string_view<typename S::char_type>(s);
-}
-void to_string_view(...);
-
-// Specifies whether S is a string type convertible to fmt::basic_string_view.
-// It should be a constexpr function but MSVC 2017 fails to compile it in
-// enable_if and MSVC 2015 fails to compile it as an alias template.
-// ADL is intentionally disabled as to_string_view is not an extension point.
-template <typename S>
-struct is_string
-    : std::is_class<decltype(detail::to_string_view(std::declval<S>()))> {};
-
-template <typename S, typename = void> struct char_t_impl {};
-template <typename S> struct char_t_impl<S, enable_if_t<is_string<S>::value>> {
-  using result = decltype(to_string_view(std::declval<S>()));
-  using type = typename result::value_type;
-};
-
-enum class type {
-  none_type,
-  // Integer types should go first,
-  int_type,
-  uint_type,
-  long_long_type,
-  ulong_long_type,
-  int128_type,
-  uint128_type,
-  bool_type,
-  char_type,
-  last_integer_type = char_type,
-  // followed by floating-point types.
-  float_type,
-  double_type,
-  long_double_type,
-  last_numeric_type = long_double_type,
-  cstring_type,
-  string_type,
-  pointer_type,
-  custom_type
-};
-
-// Maps core type T to the corresponding type enum constant.
-template <typename T, typename Char>
-struct type_constant : std::integral_constant<type, type::custom_type> {};
-
-#define FMT_TYPE_CONSTANT(Type, constant) \
-  template <typename Char>                \
-  struct type_constant<Type, Char>        \
-      : std::integral_constant<type, type::constant> {}
-
-FMT_TYPE_CONSTANT(int, int_type);
-FMT_TYPE_CONSTANT(unsigned, uint_type);
-FMT_TYPE_CONSTANT(long long, long_long_type);
-FMT_TYPE_CONSTANT(unsigned long long, ulong_long_type);
-FMT_TYPE_CONSTANT(int128_opt, int128_type);
-FMT_TYPE_CONSTANT(uint128_opt, uint128_type);
-FMT_TYPE_CONSTANT(bool, bool_type);
-FMT_TYPE_CONSTANT(Char, char_type);
-FMT_TYPE_CONSTANT(float, float_type);
-FMT_TYPE_CONSTANT(double, double_type);
-FMT_TYPE_CONSTANT(long double, long_double_type);
-FMT_TYPE_CONSTANT(const Char*, cstring_type);
-FMT_TYPE_CONSTANT(basic_string_view<Char>, string_type);
-FMT_TYPE_CONSTANT(const void*, pointer_type);
-
-constexpr auto is_integral_type(type t) -> bool {
-  return t > type::none_type && t <= type::last_integer_type;
-}
-constexpr auto is_arithmetic_type(type t) -> bool {
-  return t > type::none_type && t <= type::last_numeric_type;
-}
-
-constexpr auto set(type rhs) -> int { return 1 << static_cast<int>(rhs); }
-constexpr auto in(type t, int set) -> bool {
-  return ((set >> static_cast<int>(t)) & 1) != 0;
-}
-
-// Bitsets of types.
-enum {
-  sint_set =
-      set(type::int_type) | set(type::long_long_type) | set(type::int128_type),
-  uint_set = set(type::uint_type) | set(type::ulong_long_type) |
-             set(type::uint128_type),
-  bool_set = set(type::bool_type),
-  char_set = set(type::char_type),
-  float_set = set(type::float_type) | set(type::double_type) |
-              set(type::long_double_type),
-  string_set = set(type::string_type),
-  cstring_set = set(type::cstring_type),
-  pointer_set = set(type::pointer_type)
-};
-
-// DEPRECATED!
-FMT_NORETURN FMT_API void throw_format_error(const char* message);
-
-struct error_handler {
-  constexpr error_handler() = default;
-
-  // This function is intentionally not constexpr to give a compile-time error.
-  FMT_NORETURN void on_error(const char* message) {
-    throw_format_error(message);
-  }
-};
-}  // namespace detail
-
-/** Throws ``format_error`` with a given message. */
-using detail::throw_format_error;
-
-/** String's character type. */
-template <typename S> using char_t = typename detail::char_t_impl<S>::type;
-
-/**
-  \rst
-  Parsing context consisting of a format string range being parsed and an
-  argument counter for automatic indexing.
-  You can use the ``format_parse_context`` type alias for ``char`` instead.
-  \endrst
- */
-FMT_EXPORT
-template <typename Char> class basic_format_parse_context {
- private:
-  basic_string_view<Char> format_str_;
-  int next_arg_id_;
-
-  FMT_CONSTEXPR void do_check_arg_id(int id);
-
- public:
-  using char_type = Char;
-  using iterator = const Char*;
-
-  explicit constexpr basic_format_parse_context(
-      basic_string_view<Char> format_str, int next_arg_id = 0)
-      : format_str_(format_str), next_arg_id_(next_arg_id) {}
-
-  /**
-    Returns an iterator to the beginning of the format string range being
-    parsed.
-   */
-  constexpr auto begin() const noexcept -> iterator {
-    return format_str_.begin();
-  }
-
-  /**
-    Returns an iterator past the end of the format string range being parsed.
-   */
-  constexpr auto end() const noexcept -> iterator { return format_str_.end(); }
-
-  /** Advances the begin iterator to ``it``. */
-  FMT_CONSTEXPR void advance_to(iterator it) {
-    format_str_.remove_prefix(detail::to_unsigned(it - begin()));
-  }
-
-  /**
-    Reports an error if using the manual argument indexing; otherwise returns
-    the next argument index and switches to the automatic indexing.
-   */
-  FMT_CONSTEXPR auto next_arg_id() -> int {
-    if (next_arg_id_ < 0) {
-      detail::throw_format_error(
-          "cannot switch from manual to automatic argument indexing");
-      return 0;
-    }
-    int id = next_arg_id_++;
-    do_check_arg_id(id);
-    return id;
-  }
-
-  /**
-    Reports an error if using the automatic argument indexing; otherwise
-    switches to the manual indexing.
-   */
-  FMT_CONSTEXPR void check_arg_id(int id) {
-    if (next_arg_id_ > 0) {
-      detail::throw_format_error(
-          "cannot switch from automatic to manual argument indexing");
-      return;
-    }
-    next_arg_id_ = -1;
-    do_check_arg_id(id);
-  }
-  FMT_CONSTEXPR void check_arg_id(basic_string_view<Char>) {}
-  FMT_CONSTEXPR void check_dynamic_spec(int arg_id);
-};
-
-FMT_EXPORT
-using format_parse_context = basic_format_parse_context<char>;
-
-namespace detail {
-// A parse context with extra data used only in compile-time checks.
-template <typename Char>
-class compile_parse_context : public basic_format_parse_context<Char> {
- private:
-  int num_args_;
-  const type* types_;
-  using base = basic_format_parse_context<Char>;
-
- public:
-  explicit FMT_CONSTEXPR compile_parse_context(
-      basic_string_view<Char> format_str, int num_args, const type* types,
-      int next_arg_id = 0)
-      : base(format_str, next_arg_id), num_args_(num_args), types_(types) {}
-
-  constexpr auto num_args() const -> int { return num_args_; }
-  constexpr auto arg_type(int id) const -> type { return types_[id]; }
-
-  FMT_CONSTEXPR auto next_arg_id() -> int {
-    int id = base::next_arg_id();
-    if (id >= num_args_) throw_format_error("argument not found");
-    return id;
-  }
-
-  FMT_CONSTEXPR void check_arg_id(int id) {
-    base::check_arg_id(id);
-    if (id >= num_args_) throw_format_error("argument not found");
-  }
-  using base::check_arg_id;
-
-  FMT_CONSTEXPR void check_dynamic_spec(int arg_id) {
-    detail::ignore_unused(arg_id);
-#if !defined(__LCC__)
-    if (arg_id < num_args_ && types_ && !is_integral_type(types_[arg_id]))
-      throw_format_error("width/precision is not integer");
-#endif
-  }
-};
-
-// Extracts a reference to the container from back_insert_iterator.
-template <typename Container>
-inline auto get_container(std::back_insert_iterator<Container> it)
-    -> Container& {
-  using base = std::back_insert_iterator<Container>;
-  struct accessor : base {
-    accessor(base b) : base(b) {}
-    using base::container;
-  };
-  return *accessor(it).container;
-}
-
-template <typename Char, typename InputIt, typename OutputIt>
-FMT_CONSTEXPR auto copy_str(InputIt begin, InputIt end, OutputIt out)
-    -> OutputIt {
-  while (begin != end) *out++ = static_cast<Char>(*begin++);
-  return out;
-}
-
-template <typename Char, typename T, typename U,
-          FMT_ENABLE_IF(
-              std::is_same<remove_const_t<T>, U>::value&& is_char<U>::value)>
-FMT_CONSTEXPR auto copy_str(T* begin, T* end, U* out) -> U* {
-  if (is_constant_evaluated()) return copy_str<Char, T*, U*>(begin, end, out);
-  auto size = to_unsigned(end - begin);
-  if (size > 0) memcpy(out, begin, size * sizeof(U));
-  return out + size;
-}
-
-/**
-  \rst
-  A contiguous memory buffer with an optional growing ability. It is an internal
-  class and shouldn't be used directly, only via `~fmt::basic_memory_buffer`.
-  \endrst
- */
-template <typename T> class buffer {
- private:
-  T* ptr_;
-  size_t size_;
-  size_t capacity_;
-
- protected:
-  // Don't initialize ptr_ since it is not accessed to save a few cycles.
-  FMT_MSC_WARNING(suppress : 26495)
-  FMT_CONSTEXPR buffer(size_t sz) noexcept : size_(sz), capacity_(sz) {}
-
-  FMT_CONSTEXPR20 buffer(T* p = nullptr, size_t sz = 0, size_t cap = 0) noexcept
-      : ptr_(p), size_(sz), capacity_(cap) {}
-
-  FMT_CONSTEXPR20 ~buffer() = default;
-  buffer(buffer&&) = default;
-
-  /** Sets the buffer data and capacity. */
-  FMT_CONSTEXPR void set(T* buf_data, size_t buf_capacity) noexcept {
-    ptr_ = buf_data;
-    capacity_ = buf_capacity;
-  }
-
-  /** Increases the buffer capacity to hold at least *capacity* elements. */
-  // DEPRECATED!
-  virtual FMT_CONSTEXPR20 void grow(size_t capacity) = 0;
-
- public:
-  using value_type = T;
-  using const_reference = const T&;
-
-  buffer(const buffer&) = delete;
-  void operator=(const buffer&) = delete;
-
-  FMT_INLINE auto begin() noexcept -> T* { return ptr_; }
-  FMT_INLINE auto end() noexcept -> T* { return ptr_ + size_; }
-
-  FMT_INLINE auto begin() const noexcept -> const T* { return ptr_; }
-  FMT_INLINE auto end() const noexcept -> const T* { return ptr_ + size_; }
-
-  /** Returns the size of this buffer. */
-  constexpr auto size() const noexcept -> size_t { return size_; }
-
-  /** Returns the capacity of this buffer. */
-  constexpr auto capacity() const noexcept -> size_t { return capacity_; }
-
-  /** Returns a pointer to the buffer data (not null-terminated). */
-  FMT_CONSTEXPR auto data() noexcept -> T* { return ptr_; }
-  FMT_CONSTEXPR auto data() const noexcept -> const T* { return ptr_; }
-
-  /** Clears this buffer. */
-  void clear() { size_ = 0; }
-
-  // Tries resizing the buffer to contain *count* elements. If T is a POD type
-  // the new elements may not be initialized.
-  FMT_CONSTEXPR20 void try_resize(size_t count) {
-    try_reserve(count);
-    size_ = count <= capacity_ ? count : capacity_;
-  }
-
-  // Tries increasing the buffer capacity to *new_capacity*. It can increase the
-  // capacity by a smaller amount than requested but guarantees there is space
-  // for at least one additional element either by increasing the capacity or by
-  // flushing the buffer if it is full.
-  FMT_CONSTEXPR20 void try_reserve(size_t new_capacity) {
-    if (new_capacity > capacity_) grow(new_capacity);
-  }
-
-  FMT_CONSTEXPR20 void push_back(const T& value) {
-    try_reserve(size_ + 1);
-    ptr_[size_++] = value;
-  }
-
-  /** Appends data to the end of the buffer. */
-  template <typename U> void append(const U* begin, const U* end);
-
-  template <typename Idx> FMT_CONSTEXPR auto operator[](Idx index) -> T& {
-    return ptr_[index];
-  }
-  template <typename Idx>
-  FMT_CONSTEXPR auto operator[](Idx index) const -> const T& {
-    return ptr_[index];
-  }
-};
-
-struct buffer_traits {
-  explicit buffer_traits(size_t) {}
-  auto count() const -> size_t { return 0; }
-  auto limit(size_t size) -> size_t { return size; }
-};
-
-class fixed_buffer_traits {
- private:
-  size_t count_ = 0;
-  size_t limit_;
-
- public:
-  explicit fixed_buffer_traits(size_t limit) : limit_(limit) {}
-  auto count() const -> size_t { return count_; }
-  auto limit(size_t size) -> size_t {
-    size_t n = limit_ > count_ ? limit_ - count_ : 0;
-    count_ += size;
-    return size < n ? size : n;
-  }
-};
-
-// A buffer that writes to an output iterator when flushed.
-template <typename OutputIt, typename T, typename Traits = buffer_traits>
-class iterator_buffer final : public Traits, public buffer<T> {
- private:
-  OutputIt out_;
-  enum { buffer_size = 256 };
-  T data_[buffer_size];
-
- protected:
-  FMT_CONSTEXPR20 void grow(size_t) override {
-    if (this->size() == buffer_size) flush();
-  }
-
-  void flush() {
-    auto size = this->size();
-    this->clear();
-    out_ = copy_str<T>(data_, data_ + this->limit(size), out_);
-  }
-
- public:
-  explicit iterator_buffer(OutputIt out, size_t n = buffer_size)
-      : Traits(n), buffer<T>(data_, 0, buffer_size), out_(out) {}
-  iterator_buffer(iterator_buffer&& other)
-      : Traits(other), buffer<T>(data_, 0, buffer_size), out_(other.out_) {}
-  ~iterator_buffer() { flush(); }
-
-  auto out() -> OutputIt {
-    flush();
-    return out_;
-  }
-  auto count() const -> size_t { return Traits::count() + this->size(); }
-};
-
-template <typename T>
-class iterator_buffer<T*, T, fixed_buffer_traits> final
-    : public fixed_buffer_traits,
-      public buffer<T> {
- private:
-  T* out_;
-  enum { buffer_size = 256 };
-  T data_[buffer_size];
-
- protected:
-  FMT_CONSTEXPR20 void grow(size_t) override {
-    if (this->size() == this->capacity()) flush();
-  }
-
-  void flush() {
-    size_t n = this->limit(this->size());
-    if (this->data() == out_) {
-      out_ += n;
-      this->set(data_, buffer_size);
-    }
-    this->clear();
-  }
-
- public:
-  explicit iterator_buffer(T* out, size_t n = buffer_size)
-      : fixed_buffer_traits(n), buffer<T>(out, 0, n), out_(out) {}
-  iterator_buffer(iterator_buffer&& other)
-      : fixed_buffer_traits(other),
-        buffer<T>(std::move(other)),
-        out_(other.out_) {
-    if (this->data() != out_) {
-      this->set(data_, buffer_size);
-      this->clear();
-    }
-  }
-  ~iterator_buffer() { flush(); }
-
-  auto out() -> T* {
-    flush();
-    return out_;
-  }
-  auto count() const -> size_t {
-    return fixed_buffer_traits::count() + this->size();
-  }
-};
-
-template <typename T> class iterator_buffer<T*, T> final : public buffer<T> {
- protected:
-  FMT_CONSTEXPR20 void grow(size_t) override {}
-
- public:
-  explicit iterator_buffer(T* out, size_t = 0) : buffer<T>(out, 0, ~size_t()) {}
-
-  auto out() -> T* { return &*this->end(); }
-};
-
-// A buffer that writes to a container with the contiguous storage.
-template <typename Container>
-class iterator_buffer<std::back_insert_iterator<Container>,
-                      enable_if_t<is_contiguous<Container>::value,
-                                  typename Container::value_type>>
-    final : public buffer<typename Container::value_type> {
- private:
-  Container& container_;
-
- protected:
-  FMT_CONSTEXPR20 void grow(size_t capacity) override {
-    container_.resize(capacity);
-    this->set(&container_[0], capacity);
-  }
-
- public:
-  explicit iterator_buffer(Container& c)
-      : buffer<typename Container::value_type>(c.size()), container_(c) {}
-  explicit iterator_buffer(std::back_insert_iterator<Container> out, size_t = 0)
-      : iterator_buffer(get_container(out)) {}
-
-  auto out() -> std::back_insert_iterator<Container> {
-    return std::back_inserter(container_);
-  }
-};
-
-// A buffer that counts the number of code units written discarding the output.
-template <typename T = char> class counting_buffer final : public buffer<T> {
- private:
-  enum { buffer_size = 256 };
-  T data_[buffer_size];
-  size_t count_ = 0;
-
- protected:
-  FMT_CONSTEXPR20 void grow(size_t) override {
-    if (this->size() != buffer_size) return;
-    count_ += this->size();
-    this->clear();
-  }
-
- public:
-  counting_buffer() : buffer<T>(data_, 0, buffer_size) {}
-
-  auto count() -> size_t { return count_ + this->size(); }
-};
-}  // namespace detail
-
-template <typename Char>
-FMT_CONSTEXPR void basic_format_parse_context<Char>::do_check_arg_id(int id) {
-  // Argument id is only checked at compile-time during parsing because
-  // formatting has its own validation.
-  if (detail::is_constant_evaluated() &&
-      (!FMT_GCC_VERSION || FMT_GCC_VERSION >= 1200)) {
-    using context = detail::compile_parse_context<Char>;
-    if (id >= static_cast<context*>(this)->num_args())
-      detail::throw_format_error("argument not found");
-  }
-}
-
-template <typename Char>
-FMT_CONSTEXPR void basic_format_parse_context<Char>::check_dynamic_spec(
-    int arg_id) {
-  if (detail::is_constant_evaluated() &&
-      (!FMT_GCC_VERSION || FMT_GCC_VERSION >= 1200)) {
-    using context = detail::compile_parse_context<Char>;
-    static_cast<context*>(this)->check_dynamic_spec(arg_id);
-  }
-}
-
-FMT_EXPORT template <typename Context> class basic_format_arg;
-FMT_EXPORT template <typename Context> class basic_format_args;
-FMT_EXPORT template <typename Context> class dynamic_format_arg_store;
-
-// A formatter for objects of type T.
-FMT_EXPORT
-template <typename T, typename Char = char, typename Enable = void>
-struct formatter {
-  // A deleted default constructor indicates a disabled formatter.
-  formatter() = delete;
-};
-
-// Specifies if T has an enabled formatter specialization. A type can be
-// formattable even if it doesn't have a formatter e.g. via a conversion.
-template <typename T, typename Context>
-using has_formatter =
-    std::is_constructible<typename Context::template formatter_type<T>>;
-
-// An output iterator that appends to a buffer.
-// It is used to reduce symbol sizes for the common case.
-class appender : public std::back_insert_iterator<detail::buffer<char>> {
-  using base = std::back_insert_iterator<detail::buffer<char>>;
-
- public:
-  using std::back_insert_iterator<detail::buffer<char>>::back_insert_iterator;
-  appender(base it) noexcept : base(it) {}
-  FMT_UNCHECKED_ITERATOR(appender);
-
-  auto operator++() noexcept -> appender& { return *this; }
-  auto operator++(int) noexcept -> appender { return *this; }
-};
-
-namespace detail {
-
-template <typename Context, typename T>
-constexpr auto has_const_formatter_impl(T*)
-    -> decltype(typename Context::template formatter_type<T>().format(
-                    std::declval<const T&>(), std::declval<Context&>()),
-                true) {
-  return true;
-}
-template <typename Context>
-constexpr auto has_const_formatter_impl(...) -> bool {
-  return false;
-}
-template <typename T, typename Context>
-constexpr auto has_const_formatter() -> bool {
-  return has_const_formatter_impl<Context>(static_cast<T*>(nullptr));
-}
-
-template <typename T>
-using buffer_appender = conditional_t<std::is_same<T, char>::value, appender,
-                                      std::back_insert_iterator<buffer<T>>>;
-
-// Maps an output iterator to a buffer.
-template <typename T, typename OutputIt>
-auto get_buffer(OutputIt out) -> iterator_buffer<OutputIt, T> {
-  return iterator_buffer<OutputIt, T>(out);
-}
-template <typename T, typename Buf,
-          FMT_ENABLE_IF(std::is_base_of<buffer<char>, Buf>::value)>
-auto get_buffer(std::back_insert_iterator<Buf> out) -> buffer<char>& {
-  return get_container(out);
-}
-
-template <typename Buf, typename OutputIt>
-FMT_INLINE auto get_iterator(Buf& buf, OutputIt) -> decltype(buf.out()) {
-  return buf.out();
-}
-template <typename T, typename OutputIt>
-auto get_iterator(buffer<T>&, OutputIt out) -> OutputIt {
-  return out;
-}
-
-struct view {};
-
-template <typename Char, typename T> struct named_arg : view {
-  const Char* name;
-  const T& value;
-  named_arg(const Char* n, const T& v) : name(n), value(v) {}
-};
-
-template <typename Char> struct named_arg_info {
-  const Char* name;
-  int id;
-};
-
-template <typename T, typename Char, size_t NUM_ARGS, size_t NUM_NAMED_ARGS>
-struct arg_data {
-  // args_[0].named_args points to named_args_ to avoid bloating format_args.
-  // +1 to workaround a bug in gcc 7.5 that causes duplicated-branches warning.
-  T args_[1 + (NUM_ARGS != 0 ? NUM_ARGS : +1)];
-  named_arg_info<Char> named_args_[NUM_NAMED_ARGS];
-
-  template <typename... U>
-  arg_data(const U&... init) : args_{T(named_args_, NUM_NAMED_ARGS), init...} {}
-  arg_data(const arg_data& other) = delete;
-  auto args() const -> const T* { return args_ + 1; }
-  auto named_args() -> named_arg_info<Char>* { return named_args_; }
-};
-
-template <typename T, typename Char, size_t NUM_ARGS>
-struct arg_data<T, Char, NUM_ARGS, 0> {
-  // +1 to workaround a bug in gcc 7.5 that causes duplicated-branches warning.
-  T args_[NUM_ARGS != 0 ? NUM_ARGS : +1];
-
-  template <typename... U>
-  FMT_CONSTEXPR FMT_INLINE arg_data(const U&... init) : args_{init...} {}
-  FMT_CONSTEXPR FMT_INLINE auto args() const -> const T* { return args_; }
-  FMT_CONSTEXPR FMT_INLINE auto named_args() -> std::nullptr_t {
-    return nullptr;
-  }
-};
-
-template <typename Char>
-inline void init_named_args(named_arg_info<Char>*, int, int) {}
-
-template <typename T> struct is_named_arg : std::false_type {};
-template <typename T> struct is_statically_named_arg : std::false_type {};
-
-template <typename T, typename Char>
-struct is_named_arg<named_arg<Char, T>> : std::true_type {};
-
-template <typename Char, typename T, typename... Tail,
-          FMT_ENABLE_IF(!is_named_arg<T>::value)>
-void init_named_args(named_arg_info<Char>* named_args, int arg_count,
-                     int named_arg_count, const T&, const Tail&... args) {
-  init_named_args(named_args, arg_count + 1, named_arg_count, args...);
-}
-
-template <typename Char, typename T, typename... Tail,
-          FMT_ENABLE_IF(is_named_arg<T>::value)>
-void init_named_args(named_arg_info<Char>* named_args, int arg_count,
-                     int named_arg_count, const T& arg, const Tail&... args) {
-  named_args[named_arg_count++] = {arg.name, arg_count};
-  init_named_args(named_args, arg_count + 1, named_arg_count, args...);
-}
-
-template <typename... Args>
-FMT_CONSTEXPR FMT_INLINE void init_named_args(std::nullptr_t, int, int,
-                                              const Args&...) {}
-
-template <bool B = false> constexpr auto count() -> size_t { return B ? 1 : 0; }
-template <bool B1, bool B2, bool... Tail> constexpr auto count() -> size_t {
-  return (B1 ? 1 : 0) + count<B2, Tail...>();
-}
-
-template <typename... Args> constexpr auto count_named_args() -> size_t {
-  return count<is_named_arg<Args>::value...>();
-}
-
-template <typename... Args>
-constexpr auto count_statically_named_args() -> size_t {
-  return count<is_statically_named_arg<Args>::value...>();
-}
-
-struct unformattable {};
-struct unformattable_char : unformattable {};
-struct unformattable_pointer : unformattable {};
-
-template <typename Char> struct string_value {
-  const Char* data;
-  size_t size;
-};
-
-template <typename Char> struct named_arg_value {
-  const named_arg_info<Char>* data;
-  size_t size;
-};
-
-template <typename Context> struct custom_value {
-  using parse_context = typename Context::parse_context_type;
-  void* value;
-  void (*format)(void* arg, parse_context& parse_ctx, Context& ctx);
-};
-
-// A formatting argument value.
-template <typename Context> class value {
- public:
-  using char_type = typename Context::char_type;
-
-  union {
-    monostate no_value;
-    int int_value;
-    unsigned uint_value;
-    long long long_long_value;
-    unsigned long long ulong_long_value;
-    int128_opt int128_value;
-    uint128_opt uint128_value;
-    bool bool_value;
-    char_type char_value;
-    float float_value;
-    double double_value;
-    long double long_double_value;
-    const void* pointer;
-    string_value<char_type> string;
-    custom_value<Context> custom;
-    named_arg_value<char_type> named_args;
-  };
-
-  constexpr FMT_INLINE value() : no_value() {}
-  constexpr FMT_INLINE value(int val) : int_value(val) {}
-  constexpr FMT_INLINE value(unsigned val) : uint_value(val) {}
-  constexpr FMT_INLINE value(long long val) : long_long_value(val) {}
-  constexpr FMT_INLINE value(unsigned long long val) : ulong_long_value(val) {}
-  FMT_INLINE value(int128_opt val) : int128_value(val) {}
-  FMT_INLINE value(uint128_opt val) : uint128_value(val) {}
-  constexpr FMT_INLINE value(float val) : float_value(val) {}
-  constexpr FMT_INLINE value(double val) : double_value(val) {}
-  FMT_INLINE value(long double val) : long_double_value(val) {}
-  constexpr FMT_INLINE value(bool val) : bool_value(val) {}
-  constexpr FMT_INLINE value(char_type val) : char_value(val) {}
-  FMT_CONSTEXPR FMT_INLINE value(const char_type* val) {
-    string.data = val;
-    if (is_constant_evaluated()) string.size = {};
-  }
-  FMT_CONSTEXPR FMT_INLINE value(basic_string_view<char_type> val) {
-    string.data = val.data();
-    string.size = val.size();
-  }
-  FMT_INLINE value(const void* val) : pointer(val) {}
-  FMT_INLINE value(const named_arg_info<char_type>* args, size_t size)
-      : named_args{args, size} {}
-
-  template <typename T> FMT_CONSTEXPR20 FMT_INLINE value(T& val) {
-    using value_type = remove_const_t<T>;
-    custom.value = const_cast<value_type*>(std::addressof(val));
-    // Get the formatter type through the context to allow different contexts
-    // have different extension points, e.g. `formatter<T>` for `format` and
-    // `printf_formatter<T>` for `printf`.
-    custom.format = format_custom_arg<
-        value_type, typename Context::template formatter_type<value_type>>;
-  }
-  value(unformattable);
-  value(unformattable_char);
-  value(unformattable_pointer);
-
- private:
-  // Formats an argument of a custom type, such as a user-defined class.
-  template <typename T, typename Formatter>
-  static void format_custom_arg(void* arg,
-                                typename Context::parse_context_type& parse_ctx,
-                                Context& ctx) {
-    auto f = Formatter();
-    parse_ctx.advance_to(f.parse(parse_ctx));
-    using qualified_type =
-        conditional_t<has_const_formatter<T, Context>(), const T, T>;
-    // Calling format through a mutable reference is deprecated.
-    ctx.advance_to(f.format(*static_cast<qualified_type*>(arg), ctx));
-  }
-};
-
-// To minimize the number of types we need to deal with, long is translated
-// either to int or to long long depending on its size.
-enum { long_short = sizeof(long) == sizeof(int) };
-using long_type = conditional_t<long_short, int, long long>;
-using ulong_type = conditional_t<long_short, unsigned, unsigned long long>;
-
-template <typename T> struct format_as_result {
-  template <typename U,
-            FMT_ENABLE_IF(std::is_enum<U>::value || std::is_class<U>::value)>
-  static auto map(U*) -> remove_cvref_t<decltype(format_as(std::declval<U>()))>;
-  static auto map(...) -> void;
-
-  using type = decltype(map(static_cast<T*>(nullptr)));
-};
-template <typename T> using format_as_t = typename format_as_result<T>::type;
-
-template <typename T>
-struct has_format_as
-    : bool_constant<!std::is_same<format_as_t<T>, void>::value> {};
-
-// Maps formatting arguments to core types.
-// arg_mapper reports errors by returning unformattable instead of using
-// static_assert because it's used in the is_formattable trait.
-template <typename Context> struct arg_mapper {
-  using char_type = typename Context::char_type;
-
-  FMT_CONSTEXPR FMT_INLINE auto map(signed char val) -> int { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(unsigned char val) -> unsigned {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(short val) -> int { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(unsigned short val) -> unsigned {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(int val) -> int { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(unsigned val) -> unsigned { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(long val) -> long_type { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(unsigned long val) -> ulong_type {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(long long val) -> long long { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(unsigned long long val)
-      -> unsigned long long {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(int128_opt val) -> int128_opt {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(uint128_opt val) -> uint128_opt {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(bool val) -> bool { return val; }
-
-  template <typename T, FMT_ENABLE_IF(std::is_same<T, char>::value ||
-                                      std::is_same<T, char_type>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto map(T val) -> char_type {
-    return val;
-  }
-  template <typename T, enable_if_t<(std::is_same<T, wchar_t>::value ||
-#ifdef __cpp_char8_t
-                                     std::is_same<T, char8_t>::value ||
-#endif
-                                     std::is_same<T, char16_t>::value ||
-                                     std::is_same<T, char32_t>::value) &&
-                                        !std::is_same<T, char_type>::value,
-                                    int> = 0>
-  FMT_CONSTEXPR FMT_INLINE auto map(T) -> unformattable_char {
-    return {};
-  }
-
-  FMT_CONSTEXPR FMT_INLINE auto map(float val) -> float { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(double val) -> double { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(long double val) -> long double {
-    return val;
-  }
-
-  FMT_CONSTEXPR FMT_INLINE auto map(char_type* val) -> const char_type* {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(const char_type* val) -> const char_type* {
-    return val;
-  }
-  template <typename T,
-            FMT_ENABLE_IF(is_string<T>::value && !std::is_pointer<T>::value &&
-                          std::is_same<char_type, char_t<T>>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto map(const T& val)
-      -> basic_string_view<char_type> {
-    return to_string_view(val);
-  }
-  template <typename T,
-            FMT_ENABLE_IF(is_string<T>::value && !std::is_pointer<T>::value &&
-                          !std::is_same<char_type, char_t<T>>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto map(const T&) -> unformattable_char {
-    return {};
-  }
-
-  FMT_CONSTEXPR FMT_INLINE auto map(void* val) -> const void* { return val; }
-  FMT_CONSTEXPR FMT_INLINE auto map(const void* val) -> const void* {
-    return val;
-  }
-  FMT_CONSTEXPR FMT_INLINE auto map(std::nullptr_t val) -> const void* {
-    return val;
-  }
-
-  // Use SFINAE instead of a const T* parameter to avoid a conflict with the
-  // array overload.
-  template <
-      typename T,
-      FMT_ENABLE_IF(
-          std::is_pointer<T>::value || std::is_member_pointer<T>::value ||
-          std::is_function<typename std::remove_pointer<T>::type>::value ||
-          (std::is_array<T>::value &&
-           !std::is_convertible<T, const char_type*>::value))>
-  FMT_CONSTEXPR auto map(const T&) -> unformattable_pointer {
-    return {};
-  }
-
-  template <typename T, std::size_t N,
-            FMT_ENABLE_IF(!std::is_same<T, wchar_t>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto map(const T (&values)[N]) -> const T (&)[N] {
-    return values;
-  }
-
-  // Only map owning types because mapping views can be unsafe.
-  template <typename T, typename U = format_as_t<T>,
-            FMT_ENABLE_IF(std::is_arithmetic<U>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto map(const T& val)
-      -> decltype(FMT_DECLTYPE_THIS map(U())) {
-    return map(format_as(val));
-  }
-
-  template <typename T, typename U = remove_const_t<T>>
-  struct formattable : bool_constant<has_const_formatter<U, Context>() ||
-                                     (has_formatter<U, Context>::value &&
-                                      !std::is_const<T>::value)> {};
-
-  template <typename T, FMT_ENABLE_IF(formattable<T>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto do_map(T& val) -> T& {
-    return val;
-  }
-  template <typename T, FMT_ENABLE_IF(!formattable<T>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto do_map(T&) -> unformattable {
-    return {};
-  }
-
-  template <typename T, typename U = remove_const_t<T>,
-            FMT_ENABLE_IF((std::is_class<U>::value || std::is_enum<U>::value ||
-                           std::is_union<U>::value) &&
-                          !is_string<U>::value && !is_char<U>::value &&
-                          !is_named_arg<U>::value &&
-                          !std::is_arithmetic<format_as_t<U>>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto map(T& val)
-      -> decltype(FMT_DECLTYPE_THIS do_map(val)) {
-    return do_map(val);
-  }
-
-  template <typename T, FMT_ENABLE_IF(is_named_arg<T>::value)>
-  FMT_CONSTEXPR FMT_INLINE auto map(const T& named_arg)
-      -> decltype(FMT_DECLTYPE_THIS map(named_arg.value)) {
-    return map(named_arg.value);
-  }
-
-  auto map(...) -> unformattable { return {}; }
-};
-
-// A type constant after applying arg_mapper<Context>.
-template <typename T, typename Context>
-using mapped_type_constant =
-    type_constant<decltype(arg_mapper<Context>().map(std::declval<const T&>())),
-                  typename Context::char_type>;
-
-enum { packed_arg_bits = 4 };
-// Maximum number of arguments with packed types.
-enum { max_packed_args = 62 / packed_arg_bits };
-enum : unsigned long long { is_unpacked_bit = 1ULL << 63 };
-enum : unsigned long long { has_named_args_bit = 1ULL << 62 };
-
-template <typename Char, typename InputIt>
-auto copy_str(InputIt begin, InputIt end, appender out) -> appender {
-  get_container(out).append(begin, end);
-  return out;
-}
-template <typename Char, typename InputIt>
-auto copy_str(InputIt begin, InputIt end,
-              std::back_insert_iterator<std::string> out)
-    -> std::back_insert_iterator<std::string> {
-  get_container(out).append(begin, end);
-  return out;
-}
-
-template <typename Char, typename R, typename OutputIt>
-FMT_CONSTEXPR auto copy_str(R&& rng, OutputIt out) -> OutputIt {
-  return detail::copy_str<Char>(rng.begin(), rng.end(), out);
-}
-
-#if FMT_GCC_VERSION && FMT_GCC_VERSION < 500
-// A workaround for gcc 4.8 to make void_t work in a SFINAE context.
-template <typename...> struct void_t_impl {
-  using type = void;
-};
-template <typename... T> using void_t = typename void_t_impl<T...>::type;
-#else
-template <typename...> using void_t = void;
-#endif
-
-template <typename It, typename T, typename Enable = void>
-struct is_output_iterator : std::false_type {};
-
-template <typename It, typename T>
-struct is_output_iterator<
-    It, T,
-    void_t<typename std::iterator_traits<It>::iterator_category,
-           decltype(*std::declval<It>() = std::declval<T>())>>
-    : std::true_type {};
-
-template <typename It> struct is_back_insert_iterator : std::false_type {};
-template <typename Container>
-struct is_back_insert_iterator<std::back_insert_iterator<Container>>
-    : std::true_type {};
-
-// A type-erased reference to an std::locale to avoid a heavy <locale> include.
-class locale_ref {
- private:
-  const void* locale_;  // A type-erased pointer to std::locale.
-
- public:
-  constexpr FMT_INLINE locale_ref() : locale_(nullptr) {}
-  template <typename Locale> explicit locale_ref(const Locale& loc);
-
-  explicit operator bool() const noexcept { return locale_ != nullptr; }
-
-  template <typename Locale> auto get() const -> Locale;
-};
-
-template <typename> constexpr auto encode_types() -> unsigned long long {
-  return 0;
-}
-
-template <typename Context, typename Arg, typename... Args>
-constexpr auto encode_types() -> unsigned long long {
-  return static_cast<unsigned>(mapped_type_constant<Arg, Context>::value) |
-         (encode_types<Context, Args...>() << packed_arg_bits);
-}
-
-#if defined(__cpp_if_constexpr)
-// This type is intentionally undefined, only used for errors
-template <typename T, typename Char> struct type_is_unformattable_for;
-#endif
-
-template <bool PACKED, typename Context, typename T, FMT_ENABLE_IF(PACKED)>
-FMT_CONSTEXPR FMT_INLINE auto make_arg(T& val) -> value<Context> {
-  using arg_type = remove_cvref_t<decltype(arg_mapper<Context>().map(val))>;
-
-  constexpr bool formattable_char =
-      !std::is_same<arg_type, unformattable_char>::value;
-  static_assert(formattable_char, "Mixing character types is disallowed.");
-
-  // Formatting of arbitrary pointers is disallowed. If you want to format a
-  // pointer cast it to `void*` or `const void*`. In particular, this forbids
-  // formatting of `[const] volatile char*` printed as bool by iostreams.
-  constexpr bool formattable_pointer =
-      !std::is_same<arg_type, unformattable_pointer>::value;
-  static_assert(formattable_pointer,
-                "Formatting of non-void pointers is disallowed.");
-
-  constexpr bool formattable = !std::is_same<arg_type, unformattable>::value;
-#if defined(__cpp_if_constexpr)
-  if constexpr (!formattable) {
-    type_is_unformattable_for<T, typename Context::char_type> _;
-  }
-#endif
-  static_assert(
-      formattable,
-      "Cannot format an argument. To make type T formattable provide a "
-      "formatter<T> specialization: https://fmt.dev/latest/api.html#udt");
-  return {arg_mapper<Context>().map(val)};
-}
-
-template <typename Context, typename T>
-FMT_CONSTEXPR auto make_arg(T& val) -> basic_format_arg<Context> {
-  auto arg = basic_format_arg<Context>();
-  arg.type_ = mapped_type_constant<T, Context>::value;
-  arg.value_ = make_arg<true, Context>(val);
-  return arg;
-}
-
-template <bool PACKED, typename Context, typename T, FMT_ENABLE_IF(!PACKED)>
-FMT_CONSTEXPR inline auto make_arg(T& val) -> basic_format_arg<Context> {
-  return make_arg<Context>(val);
-}
-}  // namespace detail
-FMT_BEGIN_EXPORT
-
-// A formatting argument. Context is a template parameter for the compiled API
-// where output can be unbuffered.
-template <typename Context> class basic_format_arg {
- private:
-  detail::value<Context> value_;
-  detail::type type_;
-
-  template <typename ContextType, typename T>
-  friend FMT_CONSTEXPR auto detail::make_arg(T& value)
-      -> basic_format_arg<ContextType>;
-
-  template <typename Visitor, typename Ctx>
-  friend FMT_CONSTEXPR auto visit_format_arg(Visitor&& vis,
-                                             const basic_format_arg<Ctx>& arg)
-      -> decltype(vis(0));
-
-  friend class basic_format_args<Context>;
-  friend class dynamic_format_arg_store<Context>;
-
-  using char_type = typename Context::char_type;
-
-  template <typename T, typename Char, size_t NUM_ARGS, size_t NUM_NAMED_ARGS>
-  friend struct detail::arg_data;
-
-  basic_format_arg(const detail::named_arg_info<char_type>* args, size_t size)
-      : value_(args, size) {}
-
- public:
-  class handle {
-   public:
-    explicit handle(detail::custom_value<Context> custom) : custom_(custom) {}
-
-    void format(typename Context::parse_context_type& parse_ctx,
-                Context& ctx) const {
-      custom_.format(custom_.value, parse_ctx, ctx);
-    }
-
-   private:
-    detail::custom_value<Context> custom_;
-  };
-
-  constexpr basic_format_arg() : type_(detail::type::none_type) {}
-
-  constexpr explicit operator bool() const noexcept {
-    return type_ != detail::type::none_type;
-  }
-
-  auto type() const -> detail::type { return type_; }
-
-  auto is_integral() const -> bool { return detail::is_integral_type(type_); }
-  auto is_arithmetic() const -> bool {
-    return detail::is_arithmetic_type(type_);
-  }
-
-  FMT_INLINE auto format_custom(const char_type* parse_begin,
-                                typename Context::parse_context_type& parse_ctx,
-                                Context& ctx) -> bool {
-    if (type_ != detail::type::custom_type) return false;
-    parse_ctx.advance_to(parse_begin);
-    value_.custom.format(value_.custom.value, parse_ctx, ctx);
-    return true;
-  }
-};
-
-/**
-  \rst
-  Visits an argument dispatching to the appropriate visit method based on
-  the argument type. For example, if the argument type is ``double`` then
-  ``vis(value)`` will be called with the value of type ``double``.
-  \endrst
- */
-// DEPRECATED!
-template <typename Visitor, typename Context>
-FMT_CONSTEXPR FMT_INLINE auto visit_format_arg(
-    Visitor&& vis, const basic_format_arg<Context>& arg) -> decltype(vis(0)) {
-  switch (arg.type_) {
-  case detail::type::none_type:
-    break;
-  case detail::type::int_type:
-    return vis(arg.value_.int_value);
-  case detail::type::uint_type:
-    return vis(arg.value_.uint_value);
-  case detail::type::long_long_type:
-    return vis(arg.value_.long_long_value);
-  case detail::type::ulong_long_type:
-    return vis(arg.value_.ulong_long_value);
-  case detail::type::int128_type:
-    return vis(detail::convert_for_visit(arg.value_.int128_value));
-  case detail::type::uint128_type:
-    return vis(detail::convert_for_visit(arg.value_.uint128_value));
-  case detail::type::bool_type:
-    return vis(arg.value_.bool_value);
-  case detail::type::char_type:
-    return vis(arg.value_.char_value);
-  case detail::type::float_type:
-    return vis(arg.value_.float_value);
-  case detail::type::double_type:
-    return vis(arg.value_.double_value);
-  case detail::type::long_double_type:
-    return vis(arg.value_.long_double_value);
-  case detail::type::cstring_type:
-    return vis(arg.value_.string.data);
-  case detail::type::string_type:
-    using sv = basic_string_view<typename Context::char_type>;
-    return vis(sv(arg.value_.string.data, arg.value_.string.size));
-  case detail::type::pointer_type:
-    return vis(arg.value_.pointer);
-  case detail::type::custom_type:
-    return vis(typename basic_format_arg<Context>::handle(arg.value_.custom));
-  }
-  return vis(monostate());
-}
-
-// Formatting context.
-template <typename OutputIt, typename Char> class basic_format_context {
- private:
-  OutputIt out_;
-  basic_format_args<basic_format_context> args_;
-  detail::locale_ref loc_;
-
- public:
-  using iterator = OutputIt;
-  using format_arg = basic_format_arg<basic_format_context>;
-  using format_args = basic_format_args<basic_format_context>;
-  using parse_context_type = basic_format_parse_context<Char>;
-  template <typename T> using formatter_type = formatter<T, Char>;
-
-  /** The character type for the output. */
-  using char_type = Char;
-
-  basic_format_context(basic_format_context&&) = default;
-  basic_format_context(const basic_format_context&) = delete;
-  void operator=(const basic_format_context&) = delete;
-  /**
-    Constructs a ``basic_format_context`` object. References to the arguments
-    are stored in the object so make sure they have appropriate lifetimes.
-   */
-  constexpr basic_format_context(OutputIt out, format_args ctx_args,
-                                 detail::locale_ref loc = {})
-      : out_(out), args_(ctx_args), loc_(loc) {}
-
-  constexpr auto arg(int id) const -> format_arg { return args_.get(id); }
-  FMT_CONSTEXPR auto arg(basic_string_view<Char> name) -> format_arg {
-    return args_.get(name);
-  }
-  FMT_CONSTEXPR auto arg_id(basic_string_view<Char> name) -> int {
-    return args_.get_id(name);
-  }
-  auto args() const -> const format_args& { return args_; }
-
-  // DEPRECATED!
-  FMT_CONSTEXPR auto error_handler() -> detail::error_handler { return {}; }
-  void on_error(const char* message) { error_handler().on_error(message); }
-
-  // Returns an iterator to the beginning of the output range.
-  FMT_CONSTEXPR auto out() -> iterator { return out_; }
-
-  // Advances the begin iterator to ``it``.
-  void advance_to(iterator it) {
-    if (!detail::is_back_insert_iterator<iterator>()) out_ = it;
-  }
-
-  FMT_CONSTEXPR auto locale() -> detail::locale_ref { return loc_; }
-};
-
-template <typename Char>
-using buffer_context =
-    basic_format_context<detail::buffer_appender<Char>, Char>;
-using format_context = buffer_context<char>;
-
-template <typename T, typename Char = char>
-using is_formattable = bool_constant<!std::is_base_of<
-    detail::unformattable, decltype(detail::arg_mapper<buffer_context<Char>>()
-                                        .map(std::declval<T&>()))>::value>;
-
-/**
-  \rst
-  An array of references to arguments. It can be implicitly converted into
-  `~fmt::basic_format_args` for passing into type-erased formatting functions
-  such as `~fmt::vformat`.
-  \endrst
- */
-template <typename Context, typename... Args>
-class format_arg_store
-#if FMT_GCC_VERSION && FMT_GCC_VERSION < 409
-    // Workaround a GCC template argument substitution bug.
-    : public basic_format_args<Context>
-#endif
-{
- private:
-  static const size_t num_args = sizeof...(Args);
-  static constexpr size_t num_named_args = detail::count_named_args<Args...>();
-  static const bool is_packed = num_args <= detail::max_packed_args;
-
-  using value_type = conditional_t<is_packed, detail::value<Context>,
-                                   basic_format_arg<Context>>;
-
-  detail::arg_data<value_type, typename Context::char_type, num_args,
-                   num_named_args>
-      data_;
-
-  friend class basic_format_args<Context>;
-
-  static constexpr unsigned long long desc =
-      (is_packed ? detail::encode_types<Context, Args...>()
-                 : detail::is_unpacked_bit | num_args) |
-      (num_named_args != 0
-           ? static_cast<unsigned long long>(detail::has_named_args_bit)
-           : 0);
-
- public:
-  template <typename... T>
-  FMT_CONSTEXPR FMT_INLINE format_arg_store(T&... args)
-      :
-#if FMT_GCC_VERSION && FMT_GCC_VERSION < 409
-        basic_format_args<Context>(*this),
-#endif
-        data_{detail::make_arg<is_packed, Context>(args)...} {
-    if (detail::const_check(num_named_args != 0))
-      detail::init_named_args(data_.named_args(), 0, 0, args...);
-  }
-};
-
-/**
-  \rst
-  Constructs a `~fmt::format_arg_store` object that contains references to
-  arguments and can be implicitly converted to `~fmt::format_args`. `Context`
-  can be omitted in which case it defaults to `~fmt::format_context`.
-  See `~fmt::arg` for lifetime considerations.
-  \endrst
- */
-// Arguments are taken by lvalue references to avoid some lifetime issues.
-template <typename Context = format_context, typename... T>
-constexpr auto make_format_args(T&... args)
-    -> format_arg_store<Context, remove_cvref_t<T>...> {
-  return {args...};
-}
-
-/**
-  \rst
-  Returns a named argument to be used in a formatting function.
-  It should only be used in a call to a formatting function or
-  `dynamic_format_arg_store::push_back`.
-
-  **Example**::
-
-    fmt::print("Elapsed time: {s:.2f} seconds", fmt::arg("s", 1.23));
-  \endrst
- */
-template <typename Char, typename T>
-inline auto arg(const Char* name, const T& arg) -> detail::named_arg<Char, T> {
-  static_assert(!detail::is_named_arg<T>(), "nested named arguments");
-  return {name, arg};
-}
-FMT_END_EXPORT
-
-/**
-  \rst
-  A view of a collection of formatting arguments. To avoid lifetime issues it
-  should only be used as a parameter type in type-erased functions such as
-  ``vformat``::
-
-    void vlog(string_view format_str, format_args args);  // OK
-    format_args args = make_format_args();  // Error: dangling reference
-  \endrst
- */
-template <typename Context> class basic_format_args {
- public:
-  using size_type = int;
-  using format_arg = basic_format_arg<Context>;
-
- private:
-  // A descriptor that contains information about formatting arguments.
-  // If the number of arguments is less or equal to max_packed_args then
-  // argument types are passed in the descriptor. This reduces binary code size
-  // per formatting function call.
-  unsigned long long desc_;
-  union {
-    // If is_packed() returns true then argument values are stored in values_;
-    // otherwise they are stored in args_. This is done to improve cache
-    // locality and reduce compiled code size since storing larger objects
-    // may require more code (at least on x86-64) even if the same amount of
-    // data is actually copied to stack. It saves ~10% on the bloat test.
-    const detail::value<Context>* values_;
-    const format_arg* args_;
-  };
-
-  constexpr auto is_packed() const -> bool {
-    return (desc_ & detail::is_unpacked_bit) == 0;
-  }
-  auto has_named_args() const -> bool {
-    return (desc_ & detail::has_named_args_bit) != 0;
-  }
-
-  FMT_CONSTEXPR auto type(int index) const -> detail::type {
-    int shift = index * detail::packed_arg_bits;
-    unsigned int mask = (1 << detail::packed_arg_bits) - 1;
-    return static_cast<detail::type>((desc_ >> shift) & mask);
-  }
-
-  constexpr FMT_INLINE basic_format_args(unsigned long long desc,
-                                         const detail::value<Context>* values)
-      : desc_(desc), values_(values) {}
-  constexpr basic_format_args(unsigned long long desc, const format_arg* args)
-      : desc_(desc), args_(args) {}
-
- public:
-  constexpr basic_format_args() : desc_(0), args_(nullptr) {}
-
-  /**
-   \rst
-   Constructs a `basic_format_args` object from `~fmt::format_arg_store`.
-   \endrst
-   */
-  template <typename... Args>
-  constexpr FMT_INLINE basic_format_args(
-      const format_arg_store<Context, Args...>& store)
-      : basic_format_args(format_arg_store<Context, Args...>::desc,
-                          store.data_.args()) {}
-
-  /**
-   \rst
-   Constructs a `basic_format_args` object from
-   `~fmt::dynamic_format_arg_store`.
-   \endrst
-   */
-  constexpr FMT_INLINE basic_format_args(
-      const dynamic_format_arg_store<Context>& store)
-      : basic_format_args(store.get_types(), store.data()) {}
-
-  /**
-   \rst
-   Constructs a `basic_format_args` object from a dynamic set of arguments.
-   \endrst
-   */
-  constexpr basic_format_args(const format_arg* args, int count)
-      : basic_format_args(detail::is_unpacked_bit | detail::to_unsigned(count),
-                          args) {}
-
-  /** Returns the argument with the specified id. */
-  FMT_CONSTEXPR auto get(int id) const -> format_arg {
-    format_arg arg;
-    if (!is_packed()) {
-      if (id < max_size()) arg = args_[id];
-      return arg;
-    }
-    if (id >= detail::max_packed_args) return arg;
-    arg.type_ = type(id);
-    if (arg.type_ == detail::type::none_type) return arg;
-    arg.value_ = values_[id];
-    return arg;
-  }
-
-  template <typename Char>
-  auto get(basic_string_view<Char> name) const -> format_arg {
-    int id = get_id(name);
-    return id >= 0 ? get(id) : format_arg();
-  }
-
-  template <typename Char>
-  auto get_id(basic_string_view<Char> name) const -> int {
-    if (!has_named_args()) return -1;
-    const auto& named_args =
-        (is_packed() ? values_[-1] : args_[-1].value_).named_args;
-    for (size_t i = 0; i < named_args.size; ++i) {
-      if (named_args.data[i].name == name) return named_args.data[i].id;
-    }
-    return -1;
-  }
-
-  auto max_size() const -> int {
-    unsigned long long max_packed = detail::max_packed_args;
-    return static_cast<int>(is_packed() ? max_packed
-                                        : desc_ & ~detail::is_unpacked_bit);
-  }
-};
-
-/** An alias to ``basic_format_args<format_context>``. */
-// A separate type would result in shorter symbols but break ABI compatibility
-// between clang and gcc on ARM (#1919).
-FMT_EXPORT using format_args = basic_format_args<format_context>;
-
-// We cannot use enum classes as bit fields because of a gcc bug, so we put them
-// in namespaces instead (https://gcc.gnu.org/bugzilla/show_bug.cgi?id=61414).
-// Additionally, if an underlying type is specified, older gcc incorrectly warns
-// that the type is too small. Both bugs are fixed in gcc 9.3.
-#if FMT_GCC_VERSION && FMT_GCC_VERSION < 903
-#  define FMT_ENUM_UNDERLYING_TYPE(type)
-#else
-#  define FMT_ENUM_UNDERLYING_TYPE(type) : type
-#endif
-namespace align {
-enum type FMT_ENUM_UNDERLYING_TYPE(unsigned char){none, left, right, center,
-                                                  numeric};
-}
-using align_t = align::type;
-namespace sign {
-enum type FMT_ENUM_UNDERLYING_TYPE(unsigned char){none, minus, plus, space};
-}
-using sign_t = sign::type;
-
-namespace detail {
-
-// Workaround an array initialization issue in gcc 4.8.
-template <typename Char> struct fill_t {
- private:
-  enum { max_size = 4 };
-  Char data_[max_size] = {Char(' '), Char(0), Char(0), Char(0)};
-  unsigned char size_ = 1;
-
- public:
-  FMT_CONSTEXPR void operator=(basic_string_view<Char> s) {
-    auto size = s.size();
-    FMT_ASSERT(size <= max_size, "invalid fill");
-    for (size_t i = 0; i < size; ++i) data_[i] = s[i];
-    size_ = static_cast<unsigned char>(size);
-  }
-
-  constexpr auto size() const -> size_t { return size_; }
-  constexpr auto data() const -> const Char* { return data_; }
-
-  FMT_CONSTEXPR auto operator[](size_t index) -> Char& { return data_[index]; }
-  FMT_CONSTEXPR auto operator[](size_t index) const -> const Char& {
-    return data_[index];
-  }
-};
-}  // namespace detail
-
-enum class presentation_type : unsigned char {
-  none,
-  dec,             // 'd'
-  oct,             // 'o'
-  hex_lower,       // 'x'
-  hex_upper,       // 'X'
-  bin_lower,       // 'b'
-  bin_upper,       // 'B'
-  hexfloat_lower,  // 'a'
-  hexfloat_upper,  // 'A'
-  exp_lower,       // 'e'
-  exp_upper,       // 'E'
-  fixed_lower,     // 'f'
-  fixed_upper,     // 'F'
-  general_lower,   // 'g'
-  general_upper,   // 'G'
-  chr,             // 'c'
-  string,          // 's'
-  pointer,         // 'p'
-  debug            // '?'
-};
-
-// Format specifiers for built-in and string types.
-template <typename Char = char> struct format_specs {
-  int width;
-  int precision;
-  presentation_type type;
-  align_t align : 4;
-  sign_t sign : 3;
-  bool alt : 1;  // Alternate form ('#').
-  bool localized : 1;
-  detail::fill_t<Char> fill;
-
-  constexpr format_specs()
-      : width(0),
-        precision(-1),
-        type(presentation_type::none),
-        align(align::none),
-        sign(sign::none),
-        alt(false),
-        localized(false) {}
-};
-
-namespace detail {
-
-enum class arg_id_kind { none, index, name };
-
-// An argument reference.
-template <typename Char> struct arg_ref {
-  FMT_CONSTEXPR arg_ref() : kind(arg_id_kind::none), val() {}
-
-  FMT_CONSTEXPR explicit arg_ref(int index)
-      : kind(arg_id_kind::index), val(index) {}
-  FMT_CONSTEXPR explicit arg_ref(basic_string_view<Char> name)
-      : kind(arg_id_kind::name), val(name) {}
-
-  FMT_CONSTEXPR auto operator=(int idx) -> arg_ref& {
-    kind = arg_id_kind::index;
-    val.index = idx;
-    return *this;
-  }
-
-  arg_id_kind kind;
-  union value {
-    FMT_CONSTEXPR value(int idx = 0) : index(idx) {}
-    FMT_CONSTEXPR value(basic_string_view<Char> n) : name(n) {}
-
-    int index;
-    basic_string_view<Char> name;
-  } val;
-};
-
-// Format specifiers with width and precision resolved at formatting rather
-// than parsing time to allow reusing the same parsed specifiers with
-// different sets of arguments (precompilation of format strings).
-template <typename Char = char>
-struct dynamic_format_specs : format_specs<Char> {
-  arg_ref<Char> width_ref;
-  arg_ref<Char> precision_ref;
-};
-
-// Converts a character to ASCII. Returns '\0' on conversion failure.
-template <typename Char, FMT_ENABLE_IF(std::is_integral<Char>::value)>
-constexpr auto to_ascii(Char c) -> char {
-  return c <= 0xff ? static_cast<char>(c) : '\0';
-}
-template <typename Char, FMT_ENABLE_IF(std::is_enum<Char>::value)>
-constexpr auto to_ascii(Char c) -> char {
-  return c <= 0xff ? static_cast<char>(c) : '\0';
-}
-
-// Returns the number of code units in a code point or 1 on error.
-template <typename Char>
-FMT_CONSTEXPR auto code_point_length(const Char* begin) -> int {
-  if (const_check(sizeof(Char) != 1)) return 1;
-  auto c = static_cast<unsigned char>(*begin);
-  return static_cast<int>((0x3a55000000000000ull >> (2 * (c >> 3))) & 0x3) + 1;
-}
-
-// Return the result via the out param to workaround gcc bug 77539.
-template <bool IS_CONSTEXPR, typename T, typename Ptr = const T*>
-FMT_CONSTEXPR auto find(Ptr first, Ptr last, T value, Ptr& out) -> bool {
-  for (out = first; out != last; ++out) {
-    if (*out == value) return true;
-  }
-  return false;
-}
-
-template <>
-inline auto find<false, char>(const char* first, const char* last, char value,
-                              const char*& out) -> bool {
-  out = static_cast<const char*>(
-      std::memchr(first, value, to_unsigned(last - first)));
-  return out != nullptr;
-}
-
-// Parses the range [begin, end) as an unsigned integer. This function assumes
-// that the range is non-empty and the first character is a digit.
-template <typename Char>
-FMT_CONSTEXPR auto parse_nonnegative_int(const Char*& begin, const Char* end,
-                                         int error_value) noexcept -> int {
-  FMT_ASSERT(begin != end && '0' <= *begin && *begin <= '9', "");
-  unsigned value = 0, prev = 0;
-  auto p = begin;
-  do {
-    prev = value;
-    value = value * 10 + unsigned(*p - '0');
-    ++p;
-  } while (p != end && '0' <= *p && *p <= '9');
-  auto num_digits = p - begin;
-  begin = p;
-  if (num_digits <= std::numeric_limits<int>::digits10)
-    return static_cast<int>(value);
-  // Check for overflow.
-  const unsigned max = to_unsigned((std::numeric_limits<int>::max)());
-  return num_digits == std::numeric_limits<int>::digits10 + 1 &&
-                 prev * 10ull + unsigned(p[-1] - '0') <= max
-             ? static_cast<int>(value)
-             : error_value;
-}
-
-FMT_CONSTEXPR inline auto parse_align(char c) -> align_t {
-  switch (c) {
-  case '<':
-    return align::left;
-  case '>':
-    return align::right;
-  case '^':
-    return align::center;
-  }
-  return align::none;
-}
-
-template <typename Char> constexpr auto is_name_start(Char c) -> bool {
-  return ('a' <= c && c <= 'z') || ('A' <= c && c <= 'Z') || c == '_';
-}
-
-template <typename Char, typename Handler>
-FMT_CONSTEXPR auto do_parse_arg_id(const Char* begin, const Char* end,
-                                   Handler&& handler) -> const Char* {
-  Char c = *begin;
-  if (c >= '0' && c <= '9') {
-    int index = 0;
-    constexpr int max = (std::numeric_limits<int>::max)();
-    if (c != '0')
-      index = parse_nonnegative_int(begin, end, max);
-    else
-      ++begin;
-    if (begin == end || (*begin != '}' && *begin != ':'))
-      throw_format_error("invalid format string");
-    else
-      handler.on_index(index);
-    return begin;
-  }
-  if (!is_name_start(c)) {
-    throw_format_error("invalid format string");
-    return begin;
-  }
-  auto it = begin;
-  do {
-    ++it;
-  } while (it != end && (is_name_start(*it) || ('0' <= *it && *it <= '9')));
-  handler.on_name({begin, to_unsigned(it - begin)});
-  return it;
-}
-
-template <typename Char, typename Handler>
-FMT_CONSTEXPR FMT_INLINE auto parse_arg_id(const Char* begin, const Char* end,
-                                           Handler&& handler) -> const Char* {
-  FMT_ASSERT(begin != end, "");
-  Char c = *begin;
-  if (c != '}' && c != ':') return do_parse_arg_id(begin, end, handler);
-  handler.on_auto();
-  return begin;
-}
-
-template <typename Char> struct dynamic_spec_id_handler {
-  basic_format_parse_context<Char>& ctx;
-  arg_ref<Char>& ref;
-
-  FMT_CONSTEXPR void on_auto() {
-    int id = ctx.next_arg_id();
-    ref = arg_ref<Char>(id);
-    ctx.check_dynamic_spec(id);
-  }
-  FMT_CONSTEXPR void on_index(int id) {
-    ref = arg_ref<Char>(id);
-    ctx.check_arg_id(id);
-    ctx.check_dynamic_spec(id);
-  }
-  FMT_CONSTEXPR void on_name(basic_string_view<Char> id) {
-    ref = arg_ref<Char>(id);
-    ctx.check_arg_id(id);
-  }
-};
-
-// Parses [integer | "{" [arg_id] "}"].
-template <typename Char>
-FMT_CONSTEXPR auto parse_dynamic_spec(const Char* begin, const Char* end,
-                                      int& value, arg_ref<Char>& ref,
-                                      basic_format_parse_context<Char>& ctx)
-    -> const Char* {
-  FMT_ASSERT(begin != end, "");
-  if ('0' <= *begin && *begin <= '9') {
-    int val = parse_nonnegative_int(begin, end, -1);
-    if (val != -1)
-      value = val;
-    else
-      throw_format_error("number is too big");
-  } else if (*begin == '{') {
-    ++begin;
-    auto handler = dynamic_spec_id_handler<Char>{ctx, ref};
-    if (begin != end) begin = parse_arg_id(begin, end, handler);
-    if (begin != end && *begin == '}') return ++begin;
-    throw_format_error("invalid format string");
-  }
-  return begin;
-}
-
-template <typename Char>
-FMT_CONSTEXPR auto parse_precision(const Char* begin, const Char* end,
-                                   int& value, arg_ref<Char>& ref,
-                                   basic_format_parse_context<Char>& ctx)
-    -> const Char* {
-  ++begin;
-  if (begin == end || *begin == '}') {
-    throw_format_error("invalid precision");
-    return begin;
-  }
-  return parse_dynamic_spec(begin, end, value, ref, ctx);
-}
-
-enum class state { start, align, sign, hash, zero, width, precision, locale };
-
-// Parses standard format specifiers.
-template <typename Char>
-FMT_CONSTEXPR FMT_INLINE auto parse_format_specs(
-    const Char* begin, const Char* end, dynamic_format_specs<Char>& specs,
-    basic_format_parse_context<Char>& ctx, type arg_type) -> const Char* {
-  auto c = '\0';
-  if (end - begin > 1) {
-    auto next = to_ascii(begin[1]);
-    c = parse_align(next) == align::none ? to_ascii(*begin) : '\0';
-  } else {
-    if (begin == end) return begin;
-    c = to_ascii(*begin);
-  }
-
-  struct {
-    state current_state = state::start;
-    FMT_CONSTEXPR void operator()(state s, bool valid = true) {
-      if (current_state >= s || !valid)
-        throw_format_error("invalid format specifier");
-      current_state = s;
-    }
-  } enter_state;
-
-  using pres = presentation_type;
-  constexpr auto integral_set = sint_set | uint_set | bool_set | char_set;
-  struct {
-    const Char*& begin;
-    dynamic_format_specs<Char>& specs;
-    type arg_type;
-
-    FMT_CONSTEXPR auto operator()(pres pres_type, int set) -> const Char* {
-      if (!in(arg_type, set)) {
-        if (arg_type == type::none_type) return begin;
-        throw_format_error("invalid format specifier");
-      }
-      specs.type = pres_type;
-      return begin + 1;
-    }
-  } parse_presentation_type{begin, specs, arg_type};
-
-  for (;;) {
-    switch (c) {
-    case '<':
-    case '>':
-    case '^':
-      enter_state(state::align);
-      specs.align = parse_align(c);
-      ++begin;
-      break;
-    case '+':
-    case '-':
-    case ' ':
-      if (arg_type == type::none_type) return begin;
-      enter_state(state::sign, in(arg_type, sint_set | float_set));
-      switch (c) {
-      case '+':
-        specs.sign = sign::plus;
-        break;
-      case '-':
-        specs.sign = sign::minus;
-        break;
-      case ' ':
-        specs.sign = sign::space;
-        break;
-      }
-      ++begin;
-      break;
-    case '#':
-      if (arg_type == type::none_type) return begin;
-      enter_state(state::hash, is_arithmetic_type(arg_type));
-      specs.alt = true;
-      ++begin;
-      break;
-    case '0':
-      enter_state(state::zero);
-      if (!is_arithmetic_type(arg_type)) {
-        if (arg_type == type::none_type) return begin;
-        throw_format_error("format specifier requires numeric argument");
-      }
-      if (specs.align == align::none) {
-        // Ignore 0 if align is specified for compatibility with std::format.
-        specs.align = align::numeric;
-        specs.fill[0] = Char('0');
-      }
-      ++begin;
-      break;
-    case '1':
-    case '2':
-    case '3':
-    case '4':
-    case '5':
-    case '6':
-    case '7':
-    case '8':
-    case '9':
-    case '{':
-      enter_state(state::width);
-      begin = parse_dynamic_spec(begin, end, specs.width, specs.width_ref, ctx);
-      break;
-    case '.':
-      if (arg_type == type::none_type) return begin;
-      enter_state(state::precision,
-                  in(arg_type, float_set | string_set | cstring_set));
-      begin = parse_precision(begin, end, specs.precision, specs.precision_ref,
-                              ctx);
-      break;
-    case 'L':
-      if (arg_type == type::none_type) return begin;
-      enter_state(state::locale, is_arithmetic_type(arg_type));
-      specs.localized = true;
-      ++begin;
-      break;
-    case 'd':
-      return parse_presentation_type(pres::dec, integral_set);
-    case 'o':
-      return parse_presentation_type(pres::oct, integral_set);
-    case 'x':
-      return parse_presentation_type(pres::hex_lower, integral_set);
-    case 'X':
-      return parse_presentation_type(pres::hex_upper, integral_set);
-    case 'b':
-      return parse_presentation_type(pres::bin_lower, integral_set);
-    case 'B':
-      return parse_presentation_type(pres::bin_upper, integral_set);
-    case 'a':
-      return parse_presentation_type(pres::hexfloat_lower, float_set);
-    case 'A':
-      return parse_presentation_type(pres::hexfloat_upper, float_set);
-    case 'e':
-      return parse_presentation_type(pres::exp_lower, float_set);
-    case 'E':
-      return parse_presentation_type(pres::exp_upper, float_set);
-    case 'f':
-      return parse_presentation_type(pres::fixed_lower, float_set);
-    case 'F':
-      return parse_presentation_type(pres::fixed_upper, float_set);
-    case 'g':
-      return parse_presentation_type(pres::general_lower, float_set);
-    case 'G':
-      return parse_presentation_type(pres::general_upper, float_set);
-    case 'c':
-      if (arg_type == type::bool_type)
-        throw_format_error("invalid format specifier");
-      return parse_presentation_type(pres::chr, integral_set);
-    case 's':
-      return parse_presentation_type(pres::string,
-                                     bool_set | string_set | cstring_set);
-    case 'p':
-      return parse_presentation_type(pres::pointer, pointer_set | cstring_set);
-    case '?':
-      return parse_presentation_type(pres::debug,
-                                     char_set | string_set | cstring_set);
-    case '}':
-      return begin;
-    default: {
-      if (*begin == '}') return begin;
-      // Parse fill and alignment.
-      auto fill_end = begin + code_point_length(begin);
-      if (end - fill_end <= 0) {
-        throw_format_error("invalid format specifier");
-        return begin;
-      }
-      if (*begin == '{') {
-        throw_format_error("invalid fill character '{'");
-        return begin;
-      }
-      auto align = parse_align(to_ascii(*fill_end));
-      enter_state(state::align, align != align::none);
-      specs.fill = {begin, to_unsigned(fill_end - begin)};
-      specs.align = align;
-      begin = fill_end + 1;
-    }
-    }
-    if (begin == end) return begin;
-    c = to_ascii(*begin);
-  }
-}
-
-template <typename Char, typename Handler>
-FMT_CONSTEXPR auto parse_replacement_field(const Char* begin, const Char* end,
-                                           Handler&& handler) -> const Char* {
-  struct id_adapter {
-    Handler& handler;
-    int arg_id;
-
-    FMT_CONSTEXPR void on_auto() { arg_id = handler.on_arg_id(); }
-    FMT_CONSTEXPR void on_index(int id) { arg_id = handler.on_arg_id(id); }
-    FMT_CONSTEXPR void on_name(basic_string_view<Char> id) {
-      arg_id = handler.on_arg_id(id);
-    }
-  };
-
-  ++begin;
-  if (begin == end) return handler.on_error("invalid format string"), end;
-  if (*begin == '}') {
-    handler.on_replacement_field(handler.on_arg_id(), begin);
-  } else if (*begin == '{') {
-    handler.on_text(begin, begin + 1);
-  } else {
-    auto adapter = id_adapter{handler, 0};
-    begin = parse_arg_id(begin, end, adapter);
-    Char c = begin != end ? *begin : Char();
-    if (c == '}') {
-      handler.on_replacement_field(adapter.arg_id, begin);
-    } else if (c == ':') {
-      begin = handler.on_format_specs(adapter.arg_id, begin + 1, end);
-      if (begin == end || *begin != '}')
-        return handler.on_error("unknown format specifier"), end;
-    } else {
-      return handler.on_error("missing '}' in format string"), end;
-    }
-  }
-  return begin + 1;
-}
-
-template <bool IS_CONSTEXPR, typename Char, typename Handler>
-FMT_CONSTEXPR FMT_INLINE void parse_format_string(
-    basic_string_view<Char> format_str, Handler&& handler) {
-  auto begin = format_str.data();
-  auto end = begin + format_str.size();
-  if (end - begin < 32) {
-    // Use a simple loop instead of memchr for small strings.
-    const Char* p = begin;
-    while (p != end) {
-      auto c = *p++;
-      if (c == '{') {
-        handler.on_text(begin, p - 1);
-        begin = p = parse_replacement_field(p - 1, end, handler);
-      } else if (c == '}') {
-        if (p == end || *p != '}')
-          return handler.on_error("unmatched '}' in format string");
-        handler.on_text(begin, p);
-        begin = ++p;
-      }
-    }
-    handler.on_text(begin, end);
-    return;
-  }
-  struct writer {
-    FMT_CONSTEXPR void operator()(const Char* from, const Char* to) {
-      if (from == to) return;
-      for (;;) {
-        const Char* p = nullptr;
-        if (!find<IS_CONSTEXPR>(from, to, Char('}'), p))
-          return handler_.on_text(from, to);
-        ++p;
-        if (p == to || *p != '}')
-          return handler_.on_error("unmatched '}' in format string");
-        handler_.on_text(from, p);
-        from = p + 1;
-      }
-    }
-    Handler& handler_;
-  } write = {handler};
-  while (begin != end) {
-    // Doing two passes with memchr (one for '{' and another for '}') is up to
-    // 2.5x faster than the naive one-pass implementation on big format strings.
-    const Char* p = begin;
-    if (*begin != '{' && !find<IS_CONSTEXPR>(begin + 1, end, Char('{'), p))
-      return write(begin, end);
-    write(begin, p);
-    begin = parse_replacement_field(p, end, handler);
-  }
-}
-
-template <typename T, bool = is_named_arg<T>::value> struct strip_named_arg {
-  using type = T;
-};
-template <typename T> struct strip_named_arg<T, true> {
-  using type = remove_cvref_t<decltype(T::value)>;
-};
-
-template <typename T, typename ParseContext>
-FMT_CONSTEXPR auto parse_format_specs(ParseContext& ctx)
-    -> decltype(ctx.begin()) {
-  using char_type = typename ParseContext::char_type;
-  using context = buffer_context<char_type>;
-  using mapped_type = conditional_t<
-      mapped_type_constant<T, context>::value != type::custom_type,
-      decltype(arg_mapper<context>().map(std::declval<const T&>())),
-      typename strip_named_arg<T>::type>;
-#if defined(__cpp_if_constexpr)
-  if constexpr (std::is_default_constructible<
-                    formatter<mapped_type, char_type>>::value) {
-    return formatter<mapped_type, char_type>().parse(ctx);
-  } else {
-    type_is_unformattable_for<T, char_type> _;
-    return ctx.begin();
-  }
-#else
-  return formatter<mapped_type, char_type>().parse(ctx);
-#endif
-}
-
-// Checks char specs and returns true iff the presentation type is char-like.
-template <typename Char>
-FMT_CONSTEXPR auto check_char_specs(const format_specs<Char>& specs) -> bool {
-  if (specs.type != presentation_type::none &&
-      specs.type != presentation_type::chr &&
-      specs.type != presentation_type::debug) {
-    return false;
-  }
-  if (specs.align == align::numeric || specs.sign != sign::none || specs.alt)
-    throw_format_error("invalid format specifier for char");
-  return true;
-}
-
-#if FMT_USE_NONTYPE_TEMPLATE_ARGS
-template <int N, typename T, typename... Args, typename Char>
-constexpr auto get_arg_index_by_name(basic_string_view<Char> name) -> int {
-  if constexpr (is_statically_named_arg<T>()) {
-    if (name == T::name) return N;
-  }
-  if constexpr (sizeof...(Args) > 0)
-    return get_arg_index_by_name<N + 1, Args...>(name);
-  (void)name;  // Workaround an MSVC bug about "unused" parameter.
-  return -1;
-}
-#endif
-
-template <typename... Args, typename Char>
-FMT_CONSTEXPR auto get_arg_index_by_name(basic_string_view<Char> name) -> int {
-#if FMT_USE_NONTYPE_TEMPLATE_ARGS
-  if constexpr (sizeof...(Args) > 0)
-    return get_arg_index_by_name<0, Args...>(name);
-#endif
-  (void)name;
-  return -1;
-}
-
-template <typename Char, typename... Args> class format_string_checker {
- private:
-  using parse_context_type = compile_parse_context<Char>;
-  static constexpr int num_args = sizeof...(Args);
-
-  // Format specifier parsing function.
-  // In the future basic_format_parse_context will replace compile_parse_context
-  // here and will use is_constant_evaluated and downcasting to access the data
-  // needed for compile-time checks: https://godbolt.org/z/GvWzcTjh1.
-  using parse_func = const Char* (*)(parse_context_type&);
-
-  type types_[num_args > 0 ? static_cast<size_t>(num_args) : 1];
-  parse_context_type context_;
-  parse_func parse_funcs_[num_args > 0 ? static_cast<size_t>(num_args) : 1];
-
- public:
-  explicit FMT_CONSTEXPR format_string_checker(basic_string_view<Char> fmt)
-      : types_{mapped_type_constant<Args, buffer_context<Char>>::value...},
-        context_(fmt, num_args, types_),
-        parse_funcs_{&parse_format_specs<Args, parse_context_type>...} {}
-
-  FMT_CONSTEXPR void on_text(const Char*, const Char*) {}
-
-  FMT_CONSTEXPR auto on_arg_id() -> int { return context_.next_arg_id(); }
-  FMT_CONSTEXPR auto on_arg_id(int id) -> int {
-    return context_.check_arg_id(id), id;
-  }
-  FMT_CONSTEXPR auto on_arg_id(basic_string_view<Char> id) -> int {
-#if FMT_USE_NONTYPE_TEMPLATE_ARGS
-    auto index = get_arg_index_by_name<Args...>(id);
-    if (index < 0) on_error("named argument is not found");
-    return index;
-#else
-    (void)id;
-    on_error("compile-time checks for named arguments require C++20 support");
-    return 0;
-#endif
-  }
-
-  FMT_CONSTEXPR void on_replacement_field(int id, const Char* begin) {
-    on_format_specs(id, begin, begin);  // Call parse() on empty specs.
-  }
-
-  FMT_CONSTEXPR auto on_format_specs(int id, const Char* begin, const Char*)
-      -> const Char* {
-    context_.advance_to(begin);
-    // id >= 0 check is a workaround for gcc 10 bug (#2065).
-    return id >= 0 && id < num_args ? parse_funcs_[id](context_) : begin;
-  }
-
-  FMT_CONSTEXPR void on_error(const char* message) {
-    throw_format_error(message);
-  }
-};
-
-// Reports a compile-time error if S is not a valid format string.
-template <typename..., typename S, FMT_ENABLE_IF(!is_compile_string<S>::value)>
-FMT_INLINE void check_format_string(const S&) {
-#ifdef FMT_ENFORCE_COMPILE_STRING
-  static_assert(is_compile_string<S>::value,
-                "FMT_ENFORCE_COMPILE_STRING requires all format strings to use "
-                "FMT_STRING.");
-#endif
-}
-template <typename... Args, typename S,
-          FMT_ENABLE_IF(is_compile_string<S>::value)>
-void check_format_string(S format_str) {
-  using char_t = typename S::char_type;
-  FMT_CONSTEXPR auto s = basic_string_view<char_t>(format_str);
-  using checker = format_string_checker<char_t, remove_cvref_t<Args>...>;
-  FMT_CONSTEXPR bool error = (parse_format_string<true>(s, checker(s)), true);
-  ignore_unused(error);
-}
-
-template <typename Char = char> struct vformat_args {
-  using type = basic_format_args<
-      basic_format_context<std::back_insert_iterator<buffer<Char>>, Char>>;
-};
-template <> struct vformat_args<char> {
-  using type = format_args;
-};
-
-// Use vformat_args and avoid type_identity to keep symbols short.
-template <typename Char>
-void vformat_to(buffer<Char>& buf, basic_string_view<Char> fmt,
-                typename vformat_args<Char>::type args, locale_ref loc = {});
-
-FMT_API void vprint_mojibake(std::FILE*, string_view, format_args);
-#ifndef _WIN32
-inline void vprint_mojibake(std::FILE*, string_view, format_args) {}
-#endif
-}  // namespace detail
-
-FMT_BEGIN_EXPORT
-
-// A formatter specialization for natively supported types.
-template <typename T, typename Char>
-struct formatter<T, Char,
-                 enable_if_t<detail::type_constant<T, Char>::value !=
-                             detail::type::custom_type>> {
- private:
-  detail::dynamic_format_specs<Char> specs_;
-
- public:
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> const Char* {
-    auto type = detail::type_constant<T, Char>::value;
-    auto end =
-        detail::parse_format_specs(ctx.begin(), ctx.end(), specs_, ctx, type);
-    if (type == detail::type::char_type) detail::check_char_specs(specs_);
-    return end;
-  }
-
-  template <detail::type U = detail::type_constant<T, Char>::value,
-            FMT_ENABLE_IF(U == detail::type::string_type ||
-                          U == detail::type::cstring_type ||
-                          U == detail::type::char_type)>
-  FMT_CONSTEXPR void set_debug_format(bool set = true) {
-    specs_.type = set ? presentation_type::debug : presentation_type::none;
-  }
-
-  template <typename FormatContext>
-  FMT_CONSTEXPR auto format(const T& val, FormatContext& ctx) const
-      -> decltype(ctx.out());
-};
-
-template <typename Char = char> struct runtime_format_string {
-  basic_string_view<Char> str;
-};
-
-/** A compile-time format string. */
-template <typename Char, typename... Args> class basic_format_string {
- private:
-  basic_string_view<Char> str_;
-
- public:
-  template <typename S,
-            FMT_ENABLE_IF(
-                std::is_convertible<const S&, basic_string_view<Char>>::value)>
-  FMT_CONSTEVAL FMT_INLINE basic_format_string(const S& s) : str_(s) {
-    static_assert(
-        detail::count<
-            (std::is_base_of<detail::view, remove_reference_t<Args>>::value &&
-             std::is_reference<Args>::value)...>() == 0,
-        "passing views as lvalues is disallowed");
-#ifdef FMT_HAS_CONSTEVAL
-    if constexpr (detail::count_named_args<Args...>() ==
-                  detail::count_statically_named_args<Args...>()) {
-      using checker =
-          detail::format_string_checker<Char, remove_cvref_t<Args>...>;
-      detail::parse_format_string<true>(str_, checker(s));
-    }
-#else
-    detail::check_format_string<Args...>(s);
-#endif
-  }
-  basic_format_string(runtime_format_string<Char> fmt) : str_(fmt.str) {}
-
-  FMT_INLINE operator basic_string_view<Char>() const { return str_; }
-  FMT_INLINE auto get() const -> basic_string_view<Char> { return str_; }
-};
-
-#if FMT_GCC_VERSION && FMT_GCC_VERSION < 409
-// Workaround broken conversion on older gcc.
-template <typename...> using format_string = string_view;
-inline auto runtime(string_view s) -> string_view { return s; }
-#else
-template <typename... Args>
-using format_string = basic_format_string<char, type_identity_t<Args>...>;
-/**
-  \rst
-  Creates a runtime format string.
-
-  **Example**::
-
-    // Check format string at runtime instead of compile-time.
-    fmt::print(fmt::runtime("{:d}"), "I am not a number");
-  \endrst
- */
-inline auto runtime(string_view s) -> runtime_format_string<> { return {{s}}; }
-#endif
-
-FMT_API auto vformat(string_view fmt, format_args args) -> std::string;
-
-/**
-  \rst
-  Formats ``args`` according to specifications in ``fmt`` and returns the result
-  as a string.
-
-  **Example**::
-
-    #include <fmt/core.h>
-    std::string message = fmt::format("The answer is {}.", 42);
-  \endrst
-*/
-template <typename... T>
-FMT_NODISCARD FMT_INLINE auto format(format_string<T...> fmt, T&&... args)
-    -> std::string {
-  return vformat(fmt, fmt::make_format_args(args...));
-}
-
-/** Formats a string and writes the output to ``out``. */
-template <typename OutputIt,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
-auto vformat_to(OutputIt out, string_view fmt, format_args args) -> OutputIt {
-  auto&& buf = detail::get_buffer<char>(out);
-  detail::vformat_to(buf, fmt, args, {});
-  return detail::get_iterator(buf, out);
-}
-
-/**
- \rst
- Formats ``args`` according to specifications in ``fmt``, writes the result to
- the output iterator ``out`` and returns the iterator past the end of the output
- range. `format_to` does not append a terminating null character.
-
- **Example**::
-
-   auto out = std::vector<char>();
-   fmt::format_to(std::back_inserter(out), "{}", 42);
- \endrst
- */
-template <typename OutputIt, typename... T,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
-FMT_INLINE auto format_to(OutputIt out, format_string<T...> fmt, T&&... args)
-    -> OutputIt {
-  return vformat_to(out, fmt, fmt::make_format_args(args...));
-}
-
-template <typename OutputIt> struct format_to_n_result {
-  /** Iterator past the end of the output range. */
-  OutputIt out;
-  /** Total (not truncated) output size. */
-  size_t size;
-};
-
-template <typename OutputIt, typename... T,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
-auto vformat_to_n(OutputIt out, size_t n, string_view fmt, format_args args)
-    -> format_to_n_result<OutputIt> {
-  using traits = detail::fixed_buffer_traits;
-  auto buf = detail::iterator_buffer<OutputIt, char, traits>(out, n);
-  detail::vformat_to(buf, fmt, args, {});
-  return {buf.out(), buf.count()};
-}
-
-/**
-  \rst
-  Formats ``args`` according to specifications in ``fmt``, writes up to ``n``
-  characters of the result to the output iterator ``out`` and returns the total
-  (not truncated) output size and the iterator past the end of the output range.
-  `format_to_n` does not append a terminating null character.
-  \endrst
- */
-template <typename OutputIt, typename... T,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
-FMT_INLINE auto format_to_n(OutputIt out, size_t n, format_string<T...> fmt,
-                            T&&... args) -> format_to_n_result<OutputIt> {
-  return vformat_to_n(out, n, fmt, fmt::make_format_args(args...));
-}
-
-/** Returns the number of chars in the output of ``format(fmt, args...)``. */
-template <typename... T>
-FMT_NODISCARD FMT_INLINE auto formatted_size(format_string<T...> fmt,
-                                             T&&... args) -> size_t {
-  auto buf = detail::counting_buffer<>();
-  detail::vformat_to<char>(buf, fmt, fmt::make_format_args(args...), {});
-  return buf.count();
-}
-
-FMT_API void vprint(string_view fmt, format_args args);
-FMT_API void vprint(std::FILE* f, string_view fmt, format_args args);
-
-/**
-  \rst
-  Formats ``args`` according to specifications in ``fmt`` and writes the output
-  to ``stdout``.
-
-  **Example**::
-
-    fmt::print("Elapsed time: {0:.2f} seconds", 1.23);
-  \endrst
- */
-template <typename... T>
-FMT_INLINE void print(format_string<T...> fmt, T&&... args) {
-  const auto& vargs = fmt::make_format_args(args...);
-  return detail::is_utf8() ? vprint(fmt, vargs)
-                           : detail::vprint_mojibake(stdout, fmt, vargs);
-}
-
-/**
-  \rst
-  Formats ``args`` according to specifications in ``fmt`` and writes the
-  output to the file ``f``.
-
-  **Example**::
-
-    fmt::print(stderr, "Don't {}!", "panic");
-  \endrst
- */
-template <typename... T>
-FMT_INLINE void print(std::FILE* f, format_string<T...> fmt, T&&... args) {
-  const auto& vargs = fmt::make_format_args(args...);
-  return detail::is_utf8() ? vprint(f, fmt, vargs)
-                           : detail::vprint_mojibake(f, fmt, vargs);
-}
-
-/**
-  Formats ``args`` according to specifications in ``fmt`` and writes the
-  output to the file ``f`` followed by a newline.
- */
-template <typename... T>
-FMT_INLINE void println(std::FILE* f, format_string<T...> fmt, T&&... args) {
-  return fmt::print(f, "{}\n", fmt::format(fmt, std::forward<T>(args)...));
-}
-
-/**
-  Formats ``args`` according to specifications in ``fmt`` and writes the output
-  to ``stdout`` followed by a newline.
- */
-template <typename... T>
-FMT_INLINE void println(format_string<T...> fmt, T&&... args) {
-  return fmt::println(stdout, fmt, std::forward<T>(args)...);
-}
-
-FMT_END_EXPORT
-FMT_GCC_PRAGMA("GCC pop_options")
-FMT_END_NAMESPACE
-
-#ifdef FMT_HEADER_ONLY
-#  include "format.h"
-#endif
-#endif  // FMT_CORE_H_
+#include "format.h"
diff --git a/include/fmt/format-inl.h b/include/fmt/format-inl.h
index e9a4ca45..38308bf2 100644
--- a/include/fmt/format-inl.h
+++ b/include/fmt/format-inl.h
@@ -8,36 +8,36 @@
 #ifndef FMT_FORMAT_INL_H_
 #define FMT_FORMAT_INL_H_
 
-#include <algorithm>
-#include <cerrno>  // errno
-#include <climits>
-#include <cmath>
-#include <exception>
-
-#ifndef FMT_STATIC_THOUSANDS_SEPARATOR
-#  include <locale>
+#ifndef FMT_MODULE
+#  include <algorithm>
+#  include <cerrno>  // errno
+#  include <climits>
+#  include <cmath>
+#  include <exception>
 #endif
 
-#if defined(_WIN32) && !defined(FMT_WINDOWS_NO_WCHAR)
+#if defined(_WIN32) && !defined(FMT_USE_WRITE_CONSOLE)
 #  include <io.h>  // _isatty
 #endif
 
 #include "format.h"
 
+#if FMT_USE_LOCALE
+#  include <locale>
+#endif
+
+#ifndef FMT_FUNC
+#  define FMT_FUNC
+#endif
+
 FMT_BEGIN_NAMESPACE
 namespace detail {
 
 FMT_FUNC void assert_fail(const char* file, int line, const char* message) {
   // Use unchecked std::fprintf to avoid triggering another assertion when
-  // writing to stderr fails
-  std::fprintf(stderr, "%s:%d: assertion failed: %s", file, line, message);
-  // Chosen instead of std::abort to satisfy Clang in CUDA mode during device
-  // code pass.
-  std::terminate();
-}
-
-FMT_FUNC void throw_format_error(const char* message) {
-  FMT_THROW(format_error(message));
+  // writing to stderr fails.
+  fprintf(stderr, "%s:%d: assertion failed: %s", file, line, message);
+  abort();
 }
 
 FMT_FUNC void format_error_code(detail::buffer<char>& out, int error_code,
@@ -56,89 +56,103 @@ FMT_FUNC void format_error_code(detail::buffer<char>& out, int error_code,
     ++error_code_size;
   }
   error_code_size += detail::to_unsigned(detail::count_digits(abs_value));
-  auto it = buffer_appender<char>(out);
+  auto it = appender(out);
   if (message.size() <= inline_buffer_size - error_code_size)
     fmt::format_to(it, FMT_STRING("{}{}"), message, SEP);
   fmt::format_to(it, FMT_STRING("{}{}"), ERROR_STR, error_code);
   FMT_ASSERT(out.size() <= inline_buffer_size, "");
 }
 
-FMT_FUNC void report_error(format_func func, int error_code,
-                           const char* message) noexcept {
+FMT_FUNC void do_report_error(format_func func, int error_code,
+                              const char* message) noexcept {
   memory_buffer full_message;
   func(full_message, error_code, message);
-  // Don't use fwrite_fully because the latter may throw.
+  // Don't use fwrite_all because the latter may throw.
   if (std::fwrite(full_message.data(), full_message.size(), 1, stderr) > 0)
     std::fputc('\n', stderr);
 }
 
 // A wrapper around fwrite that throws on error.
-inline void fwrite_fully(const void* ptr, size_t count, FILE* stream) {
+inline void fwrite_all(const void* ptr, size_t count, FILE* stream) {
   size_t written = std::fwrite(ptr, 1, count, stream);
   if (written < count)
     FMT_THROW(system_error(errno, FMT_STRING("cannot write to file")));
 }
 
-#ifndef FMT_STATIC_THOUSANDS_SEPARATOR
-template <typename Locale>
+#if FMT_USE_LOCALE
+using std::locale;
+using std::numpunct;
+using std::use_facet;
+
+template <typename Locale, enable_if_t<(sizeof(Locale::collate) != 0), int>>
 locale_ref::locale_ref(const Locale& loc) : locale_(&loc) {
-  static_assert(std::is_same<Locale, std::locale>::value, "");
+  static_assert(std::is_same<Locale, locale>::value, "");
 }
+#else
+struct locale {};
+template <typename Char> struct numpunct {
+  auto grouping() const -> std::string { return "\03"; }
+  auto thousands_sep() const -> Char { return ','; }
+  auto decimal_point() const -> Char { return '.'; }
+};
+template <typename Facet> Facet use_facet(locale) { return {}; }
+#endif  // FMT_USE_LOCALE
 
 template <typename Locale> auto locale_ref::get() const -> Locale {
-  static_assert(std::is_same<Locale, std::locale>::value, "");
-  return locale_ ? *static_cast<const std::locale*>(locale_) : std::locale();
+  static_assert(std::is_same<Locale, locale>::value, "");
+#if FMT_USE_LOCALE
+  if (locale_) return *static_cast<const locale*>(locale_);
+#endif
+  return locale();
 }
 
 template <typename Char>
 FMT_FUNC auto thousands_sep_impl(locale_ref loc) -> thousands_sep_result<Char> {
-  auto& facet = std::use_facet<std::numpunct<Char>>(loc.get<std::locale>());
+  auto&& facet = use_facet<numpunct<Char>>(loc.get<locale>());
   auto grouping = facet.grouping();
   auto thousands_sep = grouping.empty() ? Char() : facet.thousands_sep();
   return {std::move(grouping), thousands_sep};
 }
 template <typename Char>
 FMT_FUNC auto decimal_point_impl(locale_ref loc) -> Char {
-  return std::use_facet<std::numpunct<Char>>(loc.get<std::locale>())
-      .decimal_point();
-}
-#else
-template <typename Char>
-FMT_FUNC auto thousands_sep_impl(locale_ref) -> thousands_sep_result<Char> {
-  return {"\03", FMT_STATIC_THOUSANDS_SEPARATOR};
+  return use_facet<numpunct<Char>>(loc.get<locale>()).decimal_point();
 }
-template <typename Char> FMT_FUNC Char decimal_point_impl(locale_ref) {
-  return '.';
-}
-#endif
 
+#if FMT_USE_LOCALE
 FMT_FUNC auto write_loc(appender out, loc_value value,
-                        const format_specs<>& specs, locale_ref loc) -> bool {
-#ifndef FMT_STATIC_THOUSANDS_SEPARATOR
+                        const format_specs& specs, locale_ref loc) -> bool {
   auto locale = loc.get<std::locale>();
   // We cannot use the num_put<char> facet because it may produce output in
   // a wrong encoding.
   using facet = format_facet<std::locale>;
   if (std::has_facet<facet>(locale))
-    return std::use_facet<facet>(locale).put(out, value, specs);
+    return use_facet<facet>(locale).put(out, value, specs);
   return facet(locale).put(out, value, specs);
-#endif
-  return false;
 }
+#endif
 }  // namespace detail
 
+FMT_FUNC void report_error(const char* message) {
+#if FMT_USE_EXCEPTIONS
+  throw format_error(message);
+#else
+  fputs(message, stderr);
+  abort();
+#endif
+}
+
 template <typename Locale> typename Locale::id format_facet<Locale>::id;
 
-#ifndef FMT_STATIC_THOUSANDS_SEPARATOR
 template <typename Locale> format_facet<Locale>::format_facet(Locale& loc) {
-  auto& numpunct = std::use_facet<std::numpunct<char>>(loc);
-  grouping_ = numpunct.grouping();
-  if (!grouping_.empty()) separator_ = std::string(1, numpunct.thousands_sep());
+  auto& np = detail::use_facet<detail::numpunct<char>>(loc);
+  grouping_ = np.grouping();
+  if (!grouping_.empty()) separator_ = std::string(1, np.thousands_sep());
 }
 
+#if FMT_USE_LOCALE
 template <>
 FMT_API FMT_FUNC auto format_facet<std::locale>::do_put(
-    appender out, loc_value val, const format_specs<>& specs) const -> bool {
+    appender out, loc_value val, const format_specs& specs) const -> bool {
   return val.visit(
       detail::loc_writer<>{out, specs, separator_, grouping_, decimal_point_});
 }
@@ -1411,7 +1425,7 @@ FMT_FUNC void format_system_error(detail::buffer<char>& out, int error_code,
                                   const char* message) noexcept {
   FMT_TRY {
     auto ec = std::error_code(error_code, std::generic_category());
-    write(std::back_inserter(out), std::system_error(ec, message).what());
+    detail::write(appender(out), std::system_error(ec, message).what());
     return;
   }
   FMT_CATCH(...) {}
@@ -1420,7 +1434,7 @@ FMT_FUNC void format_system_error(detail::buffer<char>& out, int error_code,
 
 FMT_FUNC void report_system_error(int error_code,
                                   const char* message) noexcept {
-  report_error(format_system_error, error_code, message);
+  do_report_error(format_system_error, error_code, message);
 }
 
 FMT_FUNC auto vformat(string_view fmt, format_args args) -> std::string {
@@ -1432,7 +1446,251 @@ FMT_FUNC auto vformat(string_view fmt, format_args args) -> std::string {
 }
 
 namespace detail {
-#if !defined(_WIN32) || defined(FMT_WINDOWS_NO_WCHAR)
+
+FMT_FUNC void vformat_to(buffer<char>& buf, string_view fmt, format_args args,
+                         locale_ref loc) {
+  auto out = appender(buf);
+  if (fmt.size() == 2 && equal2(fmt.data(), "{}"))
+    return args.get(0).visit(default_arg_formatter<char>{out});
+  parse_format_string(
+      fmt, format_handler<char>{parse_context<char>(fmt), {out, args, loc}});
+}
+
+template <typename T> struct span {
+  T* data;
+  size_t size;
+};
+
+template <typename F> auto flockfile(F* f) -> decltype(_lock_file(f)) {
+  _lock_file(f);
+}
+template <typename F> auto funlockfile(F* f) -> decltype(_unlock_file(f)) {
+  _unlock_file(f);
+}
+
+#ifndef getc_unlocked
+template <typename F> auto getc_unlocked(F* f) -> decltype(_fgetc_nolock(f)) {
+  return _fgetc_nolock(f);
+}
+#endif
+
+template <typename F = FILE, typename Enable = void>
+struct has_flockfile : std::false_type {};
+
+template <typename F>
+struct has_flockfile<F, void_t<decltype(flockfile(&std::declval<F&>()))>>
+    : std::true_type {};
+
+// A FILE wrapper. F is FILE defined as a template parameter to make system API
+// detection work.
+template <typename F> class file_base {
+ public:
+  F* file_;
+
+ public:
+  file_base(F* file) : file_(file) {}
+  operator F*() const { return file_; }
+
+  // Reads a code unit from the stream.
+  auto get() -> int {
+    int result = getc_unlocked(file_);
+    if (result == EOF && ferror(file_) != 0)
+      FMT_THROW(system_error(errno, FMT_STRING("getc failed")));
+    return result;
+  }
+
+  // Puts the code unit back into the stream buffer.
+  void unget(char c) {
+    if (ungetc(c, file_) == EOF)
+      FMT_THROW(system_error(errno, FMT_STRING("ungetc failed")));
+  }
+
+  void flush() { fflush(this->file_); }
+};
+
+// A FILE wrapper for glibc.
+template <typename F> class glibc_file : public file_base<F> {
+ private:
+  enum {
+    line_buffered = 0x200,  // _IO_LINE_BUF
+    unbuffered = 2          // _IO_UNBUFFERED
+  };
+
+ public:
+  using file_base<F>::file_base;
+
+  auto is_buffered() const -> bool {
+    return (this->file_->_flags & unbuffered) == 0;
+  }
+
+  void init_buffer() {
+    if (this->file_->_IO_write_ptr) return;
+    // Force buffer initialization by placing and removing a char in a buffer.
+    assume(this->file_->_IO_write_ptr >= this->file_->_IO_write_end);
+    putc_unlocked(0, this->file_);
+    --this->file_->_IO_write_ptr;
+  }
+
+  // Returns the file's read buffer.
+  auto get_read_buffer() const -> span<const char> {
+    auto ptr = this->file_->_IO_read_ptr;
+    return {ptr, to_unsigned(this->file_->_IO_read_end - ptr)};
+  }
+
+  // Returns the file's write buffer.
+  auto get_write_buffer() const -> span<char> {
+    auto ptr = this->file_->_IO_write_ptr;
+    return {ptr, to_unsigned(this->file_->_IO_buf_end - ptr)};
+  }
+
+  void advance_write_buffer(size_t size) { this->file_->_IO_write_ptr += size; }
+
+  bool needs_flush() const {
+    if ((this->file_->_flags & line_buffered) == 0) return false;
+    char* end = this->file_->_IO_write_end;
+    return memchr(end, '\n', to_unsigned(this->file_->_IO_write_ptr - end));
+  }
+
+  void flush() { fflush_unlocked(this->file_); }
+};
+
+// A FILE wrapper for Apple's libc.
+template <typename F> class apple_file : public file_base<F> {
+ private:
+  enum {
+    line_buffered = 1,  // __SNBF
+    unbuffered = 2      // __SLBF
+  };
+
+ public:
+  using file_base<F>::file_base;
+
+  auto is_buffered() const -> bool {
+    return (this->file_->_flags & unbuffered) == 0;
+  }
+
+  void init_buffer() {
+    if (this->file_->_p) return;
+    // Force buffer initialization by placing and removing a char in a buffer.
+    putc_unlocked(0, this->file_);
+    --this->file_->_p;
+    ++this->file_->_w;
+  }
+
+  auto get_read_buffer() const -> span<const char> {
+    return {reinterpret_cast<char*>(this->file_->_p),
+            to_unsigned(this->file_->_r)};
+  }
+
+  auto get_write_buffer() const -> span<char> {
+    return {reinterpret_cast<char*>(this->file_->_p),
+            to_unsigned(this->file_->_bf._base + this->file_->_bf._size -
+                        this->file_->_p)};
+  }
+
+  void advance_write_buffer(size_t size) {
+    this->file_->_p += size;
+    this->file_->_w -= size;
+  }
+
+  bool needs_flush() const {
+    if ((this->file_->_flags & line_buffered) == 0) return false;
+    return memchr(this->file_->_p + this->file_->_w, '\n',
+                  to_unsigned(-this->file_->_w));
+  }
+};
+
+// A fallback FILE wrapper.
+template <typename F> class fallback_file : public file_base<F> {
+ private:
+  char next_;  // The next unconsumed character in the buffer.
+  bool has_next_ = false;
+
+ public:
+  using file_base<F>::file_base;
+
+  auto is_buffered() const -> bool { return false; }
+  auto needs_flush() const -> bool { return false; }
+  void init_buffer() {}
+
+  auto get_read_buffer() const -> span<const char> {
+    return {&next_, has_next_ ? 1u : 0u};
+  }
+
+  auto get_write_buffer() const -> span<char> { return {nullptr, 0}; }
+
+  void advance_write_buffer(size_t) {}
+
+  auto get() -> int {
+    has_next_ = false;
+    return file_base<F>::get();
+  }
+
+  void unget(char c) {
+    file_base<F>::unget(c);
+    next_ = c;
+    has_next_ = true;
+  }
+};
+
+#ifndef FMT_USE_FALLBACK_FILE
+#  define FMT_USE_FALLBACK_FILE 0
+#endif
+
+template <typename F,
+          FMT_ENABLE_IF(sizeof(F::_p) != 0 && !FMT_USE_FALLBACK_FILE)>
+auto get_file(F* f, int) -> apple_file<F> {
+  return f;
+}
+template <typename F,
+          FMT_ENABLE_IF(sizeof(F::_IO_read_ptr) != 0 && !FMT_USE_FALLBACK_FILE)>
+inline auto get_file(F* f, int) -> glibc_file<F> {
+  return f;
+}
+
+inline auto get_file(FILE* f, ...) -> fallback_file<FILE> { return f; }
+
+using file_ref = decltype(get_file(static_cast<FILE*>(nullptr), 0));
+
+template <typename F = FILE, typename Enable = void>
+class file_print_buffer : public buffer<char> {
+ public:
+  explicit file_print_buffer(F*) : buffer(nullptr, size_t()) {}
+};
+
+template <typename F>
+class file_print_buffer<F, enable_if_t<has_flockfile<F>::value>>
+    : public buffer<char> {
+ private:
+  file_ref file_;
+
+  static void grow(buffer<char>& base, size_t) {
+    auto& self = static_cast<file_print_buffer&>(base);
+    self.file_.advance_write_buffer(self.size());
+    if (self.file_.get_write_buffer().size == 0) self.file_.flush();
+    auto buf = self.file_.get_write_buffer();
+    FMT_ASSERT(buf.size > 0, "");
+    self.set(buf.data, buf.size);
+    self.clear();
+  }
+
+ public:
+  explicit file_print_buffer(F* f) : buffer(grow, size_t()), file_(f) {
+    flockfile(f);
+    file_.init_buffer();
+    auto buf = file_.get_write_buffer();
+    set(buf.data, buf.size);
+  }
+  ~file_print_buffer() {
+    file_.advance_write_buffer(size());
+    bool flush = file_.needs_flush();
+    F* f = file_;    // Make funlockfile depend on the template parameter F
+    funlockfile(f);  // for the system API detection to work.
+    if (flush) fflush(file_);
+  }
+};
+
+#if !defined(_WIN32) || defined(FMT_USE_WRITE_CONSOLE)
 FMT_FUNC auto write_console(int, string_view) -> bool { return false; }
 #else
 using dword = conditional_t<sizeof(long) == 4, unsigned long, unsigned>;
@@ -1448,28 +1706,44 @@ FMT_FUNC bool write_console(int fd, string_view text) {
 
 #ifdef _WIN32
 // Print assuming legacy (non-Unicode) encoding.
-FMT_FUNC void vprint_mojibake(std::FILE* f, string_view fmt, format_args args) {
+FMT_FUNC void vprint_mojibake(std::FILE* f, string_view fmt, format_args args,
+                              bool newline) {
   auto buffer = memory_buffer();
   detail::vformat_to(buffer, fmt, args);
-  fwrite_fully(buffer.data(), buffer.size(), f);
+  if (newline) buffer.push_back('\n');
+  fwrite_all(buffer.data(), buffer.size(), f);
 }
 #endif
 
 FMT_FUNC void print(std::FILE* f, string_view text) {
-#ifdef _WIN32
+#if defined(_WIN32) && !defined(FMT_USE_WRITE_CONSOLE)
   int fd = _fileno(f);
   if (_isatty(fd)) {
     std::fflush(f);
     if (write_console(fd, text)) return;
   }
 #endif
-  fwrite_fully(text.data(), text.size(), f);
+  fwrite_all(text.data(), text.size(), f);
 }
 }  // namespace detail
 
+FMT_FUNC void vprint_buffered(std::FILE* f, string_view fmt, format_args args) {
+  auto buffer = memory_buffer();
+  detail::vformat_to(buffer, fmt, args);
+  detail::print(f, {buffer.data(), buffer.size()});
+}
+
 FMT_FUNC void vprint(std::FILE* f, string_view fmt, format_args args) {
+  if (!detail::file_ref(f).is_buffered() || !detail::has_flockfile<>())
+    return vprint_buffered(f, fmt, args);
+  auto&& buffer = detail::file_print_buffer<>(f);
+  return detail::vformat_to(buffer, fmt, args);
+}
+
+FMT_FUNC void vprintln(std::FILE* f, string_view fmt, format_args args) {
   auto buffer = memory_buffer();
   detail::vformat_to(buffer, fmt, args);
+  buffer.push_back('\n');
   detail::print(f, {buffer.data(), buffer.size()});
 }
 
diff --git a/include/fmt/format.h b/include/fmt/format.h
index f0ca55cf..ffe4fe09 100644
--- a/include/fmt/format.h
+++ b/include/fmt/format.h
@@ -33,20 +33,60 @@
 #ifndef FMT_FORMAT_H_
 #define FMT_FORMAT_H_
 
-#include <cmath>             // std::signbit
-#include <cstdint>           // uint32_t
-#include <cstring>           // std::memcpy
-#include <initializer_list>  // std::initializer_list
-#include <limits>            // std::numeric_limits
-#include <memory>            // std::uninitialized_copy
-#include <stdexcept>         // std::runtime_error
-#include <system_error>      // std::system_error
-
-#ifdef __cpp_lib_bit_cast
-#  include <bit>  // std::bit_cast
+#ifndef _LIBCPP_REMOVE_TRANSITIVE_INCLUDES
+#  define _LIBCPP_REMOVE_TRANSITIVE_INCLUDES
+#  define FMT_REMOVE_TRANSITIVE_INCLUDES
 #endif
 
-#include "core.h"
+#include "base.h"
+
+#ifndef FMT_MODULE
+#  include <cmath>             // std::signbit
+#  include <cstddef>           // std::byte
+#  include <cstdint>           // uint32_t
+#  include <cstring>           // std::memcpy
+#  include <initializer_list>  // std::initializer_list
+#  include <limits>            // std::numeric_limits
+#  include <new>               // std::bad_alloc
+#  if defined(__GLIBCXX__) && !defined(_GLIBCXX_USE_DUAL_ABI)
+// Workaround for pre gcc 5 libstdc++.
+#    include <memory>  // std::allocator_traits
+#  endif
+#  include <stdexcept>     // std::runtime_error
+#  include <string>        // std::string
+#  include <system_error>  // std::system_error
+
+// Checking FMT_CPLUSPLUS for warning suppression in MSVC.
+#  if FMT_HAS_INCLUDE(<bit>) && FMT_CPLUSPLUS > 201703L
+#    include <bit>  // std::bit_cast
+#  endif
+
+// libc++ supports string_view in pre-c++17.
+#  if FMT_HAS_INCLUDE(<string_view>) && \
+      (FMT_CPLUSPLUS >= 201703L || defined(_LIBCPP_VERSION))
+#    include <string_view>
+#    define FMT_USE_STRING_VIEW
+#  endif
+
+#  if FMT_MSC_VERSION
+#    include <intrin.h>  // _BitScanReverse[64], _BitScanForward[64], _umul128
+#  endif
+#endif  // FMT_MODULE
+
+#if defined(FMT_USE_NONTYPE_TEMPLATE_ARGS)
+// Use the provided definition.
+#elif defined(__NVCOMPILER)
+#  define FMT_USE_NONTYPE_TEMPLATE_ARGS 0
+#elif FMT_GCC_VERSION >= 903 && FMT_CPLUSPLUS >= 201709L
+#  define FMT_USE_NONTYPE_TEMPLATE_ARGS 1
+#elif defined(__cpp_nontype_template_args) && \
+    __cpp_nontype_template_args >= 201911L
+#  define FMT_USE_NONTYPE_TEMPLATE_ARGS 1
+#elif FMT_CLANG_VERSION >= 1200 && FMT_CPLUSPLUS >= 202002L
+#  define FMT_USE_NONTYPE_TEMPLATE_ARGS 1
+#else
+#  define FMT_USE_NONTYPE_TEMPLATE_ARGS 0
+#endif
 
 #if defined __cpp_inline_variables && __cpp_inline_variables >= 201606L
 #  define FMT_INLINE_VARIABLE inline
@@ -54,43 +94,15 @@
 #  define FMT_INLINE_VARIABLE
 #endif
 
-#if FMT_HAS_CPP17_ATTRIBUTE(fallthrough)
-#  define FMT_FALLTHROUGH [[fallthrough]]
-#elif defined(__clang__)
-#  define FMT_FALLTHROUGH [[clang::fallthrough]]
-#elif FMT_GCC_VERSION >= 700 && \
-    (!defined(__EDG_VERSION__) || __EDG_VERSION__ >= 520)
-#  define FMT_FALLTHROUGH [[gnu::fallthrough]]
+// Check if RTTI is disabled.
+#ifdef FMT_USE_RTTI
+// Use the provided definition.
+#elif defined(__GXX_RTTI) || FMT_HAS_FEATURE(cxx_rtti) || defined(_CPPRTTI) || \
+    defined(__INTEL_RTTI__) || defined(__RTTI)
+// __RTTI is for EDG compilers. _CPPRTTI is for MSVC.
+#  define FMT_USE_RTTI 1
 #else
-#  define FMT_FALLTHROUGH
-#endif
-
-#ifndef FMT_DEPRECATED
-#  if FMT_HAS_CPP14_ATTRIBUTE(deprecated) || FMT_MSC_VERSION >= 1900
-#    define FMT_DEPRECATED [[deprecated]]
-#  else
-#    if (defined(__GNUC__) && !defined(__LCC__)) || defined(__clang__)
-#      define FMT_DEPRECATED __attribute__((deprecated))
-#    elif FMT_MSC_VERSION
-#      define FMT_DEPRECATED __declspec(deprecated)
-#    else
-#      define FMT_DEPRECATED /* deprecated */
-#    endif
-#  endif
-#endif
-
-#ifndef FMT_NO_UNIQUE_ADDRESS
-#  if FMT_CPLUSPLUS >= 202002L
-#    if FMT_HAS_CPP_ATTRIBUTE(no_unique_address)
-#      define FMT_NO_UNIQUE_ADDRESS [[no_unique_address]]
-// VS2019 v16.10 and later except clang-cl (https://reviews.llvm.org/D110485)
-#    elif (FMT_MSC_VERSION >= 1929) && !FMT_CLANG_VERSION
-#      define FMT_NO_UNIQUE_ADDRESS [[msvc::no_unique_address]]
-#    endif
-#  endif
-#endif
-#ifndef FMT_NO_UNIQUE_ADDRESS
-#  define FMT_NO_UNIQUE_ADDRESS
+#  define FMT_USE_RTTI 0
 #endif
 
 // Visibility when compiled as a shared library/object.
@@ -100,20 +112,25 @@
 #  define FMT_SO_VISIBILITY(value)
 #endif
 
-#ifdef __has_builtin
-#  define FMT_HAS_BUILTIN(x) __has_builtin(x)
-#else
-#  define FMT_HAS_BUILTIN(x) 0
-#endif
-
 #if FMT_GCC_VERSION || FMT_CLANG_VERSION
 #  define FMT_NOINLINE __attribute__((noinline))
 #else
 #  define FMT_NOINLINE
 #endif
 
+namespace std {
+template <class T> struct iterator_traits<fmt::basic_appender<T>> {
+  using iterator_category = output_iterator_tag;
+  using value_type = T;
+  using difference_type =
+      decltype(static_cast<int*>(nullptr) - static_cast<int*>(nullptr));
+  using pointer = void;
+  using reference = void;
+};
+}  // namespace std
+
 #ifndef FMT_THROW
-#  if FMT_EXCEPTIONS
+#  if FMT_USE_EXCEPTIONS
 #    if FMT_MSC_VERSION || defined(__NVCC__)
 FMT_BEGIN_NAMESPACE
 namespace detail {
@@ -135,34 +152,18 @@ FMT_END_NAMESPACE
 #  endif
 #endif
 
-#if FMT_EXCEPTIONS
-#  define FMT_TRY try
-#  define FMT_CATCH(x) catch (x)
-#else
-#  define FMT_TRY if (true)
-#  define FMT_CATCH(x) if (false)
-#endif
-
-#ifndef FMT_MAYBE_UNUSED
-#  if FMT_HAS_CPP17_ATTRIBUTE(maybe_unused)
-#    define FMT_MAYBE_UNUSED [[maybe_unused]]
-#  else
-#    define FMT_MAYBE_UNUSED
-#  endif
+#ifdef FMT_NO_UNIQUE_ADDRESS
+// Use the provided definition.
+#elif FMT_CPLUSPLUS < 202002L
+// Not supported.
+#elif FMT_HAS_CPP_ATTRIBUTE(no_unique_address)
+#  define FMT_NO_UNIQUE_ADDRESS [[no_unique_address]]
+// VS2019 v16.10 and later except clang-cl (https://reviews.llvm.org/D110485).
+#elif FMT_MSC_VERSION >= 1929 && !FMT_CLANG_VERSION
+#  define FMT_NO_UNIQUE_ADDRESS [[msvc::no_unique_address]]
 #endif
-
-#ifndef FMT_USE_USER_DEFINED_LITERALS
-// EDG based compilers (Intel, NVIDIA, Elbrus, etc), GCC and MSVC support UDLs.
-//
-// GCC before 4.9 requires a space in `operator"" _a` which is invalid in later
-// compiler versions.
-#  if (FMT_HAS_FEATURE(cxx_user_literals) || FMT_GCC_VERSION >= 409 || \
-       FMT_MSC_VERSION >= 1900) &&                                     \
-      (!defined(__EDG_VERSION__) || __EDG_VERSION__ >= /* UDL feature */ 480)
-#    define FMT_USE_USER_DEFINED_LITERALS 1
-#  else
-#    define FMT_USE_USER_DEFINED_LITERALS 0
-#  endif
+#ifndef FMT_NO_UNIQUE_ADDRESS
+#  define FMT_NO_UNIQUE_ADDRESS
 #endif
 
 // Defining FMT_REDUCE_INT_INSTANTIATIONS to 1, will reduce the number of
@@ -173,7 +174,7 @@ FMT_END_NAMESPACE
 #  define FMT_REDUCE_INT_INSTANTIATIONS 0
 #endif
 
-// __builtin_clz is broken in clang with Microsoft CodeGen:
+// __builtin_clz is broken in clang with Microsoft codegen:
 // https://github.com/fmtlib/fmt/issues/519.
 #if !FMT_MSC_VERSION
 #  if FMT_HAS_BUILTIN(__builtin_clz) || FMT_GCC_VERSION || FMT_ICC_VERSION
@@ -197,10 +198,6 @@ FMT_END_NAMESPACE
 #  endif
 #endif
 
-#if FMT_MSC_VERSION
-#  include <intrin.h>  // _BitScanReverse[64], _BitScanForward[64], _umul128
-#endif
-
 // Some compilers masquerade as both MSVC and GCC-likes or otherwise support
 // __builtin_clz and __builtin_clzll, so only define FMT_BUILTIN_CLZ using the
 // MSVC intrinsics if the clz and clzll builtins are not available.
@@ -277,6 +274,11 @@ FMT_END_NAMESPACE
 #endif
 
 FMT_BEGIN_NAMESPACE
+
+template <typename Char, typename Traits, typename Allocator>
+struct is_contiguous<std::basic_string<Char, Traits, Allocator>>
+    : std::true_type {};
+
 namespace detail {
 
 FMT_CONSTEXPR inline void abort_fuzzing_if(bool condition) {
@@ -286,16 +288,21 @@ FMT_CONSTEXPR inline void abort_fuzzing_if(bool condition) {
 #endif
 }
 
-template <typename CharT, CharT... C> struct string_literal {
-  static constexpr CharT value[sizeof...(C)] = {C...};
-  constexpr operator basic_string_view<CharT>() const {
+#if defined(FMT_USE_STRING_VIEW)
+template <typename Char> using std_string_view = std::basic_string_view<Char>;
+#else
+template <typename T> struct std_string_view {};
+#endif
+
+template <typename Char, Char... C> struct string_literal {
+  static constexpr Char value[sizeof...(C)] = {C...};
+  constexpr operator basic_string_view<Char>() const {
     return {value, sizeof...(C)};
   }
 };
-
 #if FMT_CPLUSPLUS < 201703L
-template <typename CharT, CharT... C>
-constexpr CharT string_literal<CharT, C...>::value[sizeof...(C)];
+template <typename Char, Char... C>
+constexpr Char string_literal<Char, C...>::value[sizeof...(C)];
 #endif
 
 // Implementation of std::bit_cast for pre-C++20.
@@ -367,13 +374,14 @@ class uint128_fallback {
       -> uint128_fallback {
     return {~n.hi_, ~n.lo_};
   }
-  friend auto operator+(const uint128_fallback& lhs,
-                        const uint128_fallback& rhs) -> uint128_fallback {
+  friend FMT_CONSTEXPR auto operator+(const uint128_fallback& lhs,
+                                      const uint128_fallback& rhs)
+      -> uint128_fallback {
     auto result = uint128_fallback(lhs);
     result += rhs;
     return result;
   }
-  friend auto operator*(const uint128_fallback& lhs, uint32_t rhs)
+  friend FMT_CONSTEXPR auto operator*(const uint128_fallback& lhs, uint32_t rhs)
       -> uint128_fallback {
     FMT_ASSERT(lhs.hi_ == 0, "");
     uint64_t hi = (lhs.lo_ >> 32) * rhs;
@@ -381,7 +389,7 @@ class uint128_fallback {
     uint64_t new_lo = (hi << 32) + lo;
     return {(hi >> 32) + (new_lo < lo ? 1 : 0), new_lo};
   }
-  friend auto operator-(const uint128_fallback& lhs, uint64_t rhs)
+  friend constexpr auto operator-(const uint128_fallback& lhs, uint64_t rhs)
       -> uint128_fallback {
     return {lhs.hi_ - (lhs.lo_ < rhs ? 1 : 0), lhs.lo_ - rhs};
   }
@@ -454,7 +462,8 @@ template <typename T> constexpr auto num_bits() -> int {
 }
 // std::numeric_limits<T>::digits may return 0 for 128-bit ints.
 template <> constexpr auto num_bits<int128_opt>() -> int { return 128; }
-template <> constexpr auto num_bits<uint128_t>() -> int { return 128; }
+template <> constexpr auto num_bits<uint128_opt>() -> int { return 128; }
+template <> constexpr auto num_bits<uint128_fallback>() -> int { return 128; }
 
 // A heterogeneous bit_cast used for converting 96-bit long double to uint128_t
 // and 128-bit pointers to uint128_fallback.
@@ -506,38 +515,25 @@ FMT_INLINE void assume(bool condition) {
 #endif
 }
 
-// An approximation of iterator_t for pre-C++20 systems.
-template <typename T>
-using iterator_t = decltype(std::begin(std::declval<T&>()));
-template <typename T> using sentinel_t = decltype(std::end(std::declval<T&>()));
-
-// A workaround for std::string not having mutable data() until C++17.
-template <typename Char>
-inline auto get_data(std::basic_string<Char>& s) -> Char* {
-  return &s[0];
-}
-template <typename Container>
-inline auto get_data(Container& c) -> typename Container::value_type* {
-  return c.data();
-}
-
 // Attempts to reserve space for n extra characters in the output range.
 // Returns a pointer to the reserved range or a reference to it.
-template <typename Container, FMT_ENABLE_IF(is_contiguous<Container>::value)>
+template <typename OutputIt,
+          FMT_ENABLE_IF(is_back_insert_iterator<OutputIt>::value&&
+                            is_contiguous<typename OutputIt::container>::value)>
 #if FMT_CLANG_VERSION >= 307 && !FMT_ICC_VERSION
 __attribute__((no_sanitize("undefined")))
 #endif
-inline auto
-reserve(std::back_insert_iterator<Container> it, size_t n) ->
-    typename Container::value_type* {
-  Container& c = get_container(it);
+FMT_CONSTEXPR20 inline auto
+reserve(OutputIt it, size_t n) -> typename OutputIt::value_type* {
+  auto& c = get_container(it);
   size_t size = c.size();
   c.resize(size + n);
-  return get_data(c) + size;
+  return &c[size];
 }
 
 template <typename T>
-inline auto reserve(buffer_appender<T> it, size_t n) -> buffer_appender<T> {
+FMT_CONSTEXPR20 inline auto reserve(basic_appender<T> it, size_t n)
+    -> basic_appender<T> {
   buffer<T>& buf = get_container(it);
   buf.try_reserve(buf.size() + n);
   return it;
@@ -556,18 +552,22 @@ template <typename T, typename OutputIt>
 constexpr auto to_pointer(OutputIt, size_t) -> T* {
   return nullptr;
 }
-template <typename T> auto to_pointer(buffer_appender<T> it, size_t n) -> T* {
+template <typename T>
+FMT_CONSTEXPR20 auto to_pointer(basic_appender<T> it, size_t n) -> T* {
   buffer<T>& buf = get_container(it);
   auto size = buf.size();
+  buf.try_reserve(size + n);
   if (buf.capacity() < size + n) return nullptr;
   buf.try_resize(size + n);
   return buf.data() + size;
 }
 
-template <typename Container, FMT_ENABLE_IF(is_contiguous<Container>::value)>
-inline auto base_iterator(std::back_insert_iterator<Container> it,
-                          typename Container::value_type*)
-    -> std::back_insert_iterator<Container> {
+template <typename OutputIt,
+          FMT_ENABLE_IF(is_back_insert_iterator<OutputIt>::value&&
+                            is_contiguous<typename OutputIt::container>::value)>
+inline auto base_iterator(OutputIt it,
+                          typename OutputIt::container_type::value_type*)
+    -> OutputIt {
   return it;
 }
 
@@ -586,23 +586,15 @@ FMT_CONSTEXPR auto fill_n(OutputIt out, Size count, const T& value)
 }
 template <typename T, typename Size>
 FMT_CONSTEXPR20 auto fill_n(T* out, Size count, char value) -> T* {
-  if (is_constant_evaluated()) {
-    return fill_n<T*, Size, T>(out, count, value);
-  }
+  if (is_constant_evaluated()) return fill_n<T*, Size, T>(out, count, value);
   std::memset(out, value, to_unsigned(count));
   return out + count;
 }
 
-#ifdef __cpp_char8_t
-using char8_type = char8_t;
-#else
-enum char8_type : unsigned char {};
-#endif
-
 template <typename OutChar, typename InputIt, typename OutputIt>
-FMT_CONSTEXPR FMT_NOINLINE auto copy_str_noinline(InputIt begin, InputIt end,
-                                                  OutputIt out) -> OutputIt {
-  return copy_str<OutChar>(begin, end, out);
+FMT_CONSTEXPR FMT_NOINLINE auto copy_noinline(InputIt begin, InputIt end,
+                                              OutputIt out) -> OutputIt {
+  return copy<OutChar>(begin, end, out);
 }
 
 // A public domain branchless UTF-8 decoder by Christopher Wellons:
@@ -673,6 +665,7 @@ FMT_CONSTEXPR void for_each_codepoint(string_view s, F f) {
                     string_view(ptr, error ? 1 : to_unsigned(end - buf_ptr)));
     return result ? (error ? buf_ptr + 1 : end) : nullptr;
   };
+
   auto p = s.data();
   const size_t block_size = 4;  // utf8_decode always reads blocks of 4 chars.
   if (s.size() >= block_size) {
@@ -681,17 +674,19 @@ FMT_CONSTEXPR void for_each_codepoint(string_view s, F f) {
       if (!p) return;
     }
   }
-  if (auto num_chars_left = s.data() + s.size() - p) {
-    char buf[2 * block_size - 1] = {};
-    copy_str<char>(p, p + num_chars_left, buf);
-    const char* buf_ptr = buf;
-    do {
-      auto end = decode(buf_ptr, p);
-      if (!end) return;
-      p += end - buf_ptr;
-      buf_ptr = end;
-    } while (buf_ptr - buf < num_chars_left);
-  }
+  auto num_chars_left = to_unsigned(s.data() + s.size() - p);
+  if (num_chars_left == 0) return;
+
+  FMT_ASSERT(num_chars_left < block_size, "");
+  char buf[2 * block_size - 1] = {};
+  copy<char>(p, p + num_chars_left, buf);
+  const char* buf_ptr = buf;
+  do {
+    auto end = decode(buf_ptr, p);
+    if (!end) return;
+    p += end - buf_ptr;
+    buf_ptr = end;
+  } while (buf_ptr < buf + num_chars_left);
 }
 
 template <typename Char>
@@ -706,7 +701,7 @@ FMT_CONSTEXPR inline auto compute_width(string_view s) -> size_t {
   struct count_code_points {
     size_t* count;
     FMT_CONSTEXPR auto operator()(uint32_t cp, string_view) const -> bool {
-      *count += detail::to_unsigned(
+      *count += to_unsigned(
           1 +
           (cp >= 0x1100 &&
            (cp <= 0x115f ||  // Hangul Jamo init. consonants
@@ -734,15 +729,9 @@ FMT_CONSTEXPR inline auto compute_width(string_view s) -> size_t {
   return num_code_points;
 }
 
-inline auto compute_width(basic_string_view<char8_type> s) -> size_t {
-  return compute_width(
-      string_view(reinterpret_cast<const char*>(s.data()), s.size()));
-}
-
 template <typename Char>
 inline auto code_point_index(basic_string_view<Char> s, size_t n) -> size_t {
-  size_t size = s.size();
-  return n < size ? n : size;
+  return min_of(n, s.size());
 }
 
 // Calculates the index of the nth code point in a UTF-8 string.
@@ -760,12 +749,6 @@ inline auto code_point_index(string_view s, size_t n) -> size_t {
   return result;
 }
 
-inline auto code_point_index(basic_string_view<char8_type> s, size_t n)
-    -> size_t {
-  return code_point_index(
-      string_view(reinterpret_cast<const char*>(s.data()), s.size()), n);
-}
-
 template <typename T> struct is_integral : std::is_integral<T> {};
 template <> struct is_integral<int128_opt> : std::true_type {};
 template <> struct is_integral<uint128_t> : std::true_type {};
@@ -781,38 +764,22 @@ using is_integer =
                   !std::is_same<T, char>::value &&
                   !std::is_same<T, wchar_t>::value>;
 
-#ifndef FMT_USE_FLOAT
-#  define FMT_USE_FLOAT 1
-#endif
-#ifndef FMT_USE_DOUBLE
-#  define FMT_USE_DOUBLE 1
-#endif
-#ifndef FMT_USE_LONG_DOUBLE
-#  define FMT_USE_LONG_DOUBLE 1
-#endif
-
-#ifndef FMT_USE_FLOAT128
-#  ifdef __clang__
-// Clang emulates GCC, so it has to appear early.
-#    if FMT_HAS_INCLUDE(<quadmath.h>)
-#      define FMT_USE_FLOAT128 1
-#    endif
-#  elif defined(__GNUC__)
-// GNU C++:
-#    if defined(_GLIBCXX_USE_FLOAT128) && !defined(__STRICT_ANSI__)
-#      define FMT_USE_FLOAT128 1
-#    endif
-#  endif
-#  ifndef FMT_USE_FLOAT128
-#    define FMT_USE_FLOAT128 0
-#  endif
+#if defined(FMT_USE_FLOAT128)
+// Use the provided definition.
+#elif FMT_CLANG_VERSION && FMT_HAS_INCLUDE(<quadmath.h>)
+#  define FMT_USE_FLOAT128 1
+#elif FMT_GCC_VERSION && defined(_GLIBCXX_USE_FLOAT128) && \
+    !defined(__STRICT_ANSI__)
+#  define FMT_USE_FLOAT128 1
+#else
+#  define FMT_USE_FLOAT128 0
 #endif
-
 #if FMT_USE_FLOAT128
 using float128 = __float128;
 #else
-using float128 = void;
+struct float128 {};
 #endif
+
 template <typename T> using is_float128 = std::is_same<T, float128>;
 
 template <typename T>
@@ -831,24 +798,21 @@ using is_double_double = bool_constant<std::numeric_limits<T>::digits == 106>;
 #  define FMT_USE_FULL_CACHE_DRAGONBOX 0
 #endif
 
-template <typename T>
-template <typename U>
-void buffer<T>::append(const U* begin, const U* end) {
-  while (begin != end) {
-    auto count = to_unsigned(end - begin);
-    try_reserve(size_ + count);
-    auto free_cap = capacity_ - size_;
-    if (free_cap < count) count = free_cap;
-    std::uninitialized_copy_n(begin, count, ptr_ + size_);
-    size_ += count;
-    begin += count;
+// An allocator that uses malloc/free to allow removing dependency on the C++
+// standard libary runtime.
+template <typename T> struct allocator {
+  using value_type = T;
+
+  T* allocate(size_t n) {
+    FMT_ASSERT(n <= max_value<size_t>() / sizeof(T), "");
+    T* p = static_cast<T*>(malloc(n * sizeof(T)));
+    if (!p) FMT_THROW(std::bad_alloc());
+    return p;
   }
-}
 
-template <typename T, typename Enable = void>
-struct is_locale : std::false_type {};
-template <typename T>
-struct is_locale<T, void_t<decltype(T::classic())>> : std::true_type {};
+  void deallocate(T* p, size_t) { free(p); }
+};
+
 }  // namespace detail
 
 FMT_BEGIN_EXPORT
@@ -858,29 +822,21 @@ FMT_BEGIN_EXPORT
 enum { inline_buffer_size = 500 };
 
 /**
-  \rst
-  A dynamically growing memory buffer for trivially copyable/constructible types
-  with the first ``SIZE`` elements stored in the object itself.
-
-  You can use the ``memory_buffer`` type alias for ``char`` instead.
-
-  **Example**::
-
-     auto out = fmt::memory_buffer();
-     fmt::format_to(std::back_inserter(out), "The answer is {}.", 42);
-
-  This will append the following output to the ``out`` object:
-
-  .. code-block:: none
-
-     The answer is 42.
-
-  The output can be converted to an ``std::string`` with ``to_string(out)``.
-  \endrst
+ * A dynamically growing memory buffer for trivially copyable/constructible
+ * types with the first `SIZE` elements stored in the object itself. Most
+ * commonly used via the `memory_buffer` alias for `char`.
+ *
+ * **Example**:
+ *
+ *     auto out = fmt::memory_buffer();
+ *     fmt::format_to(std::back_inserter(out), "The answer is {}.", 42);
+ *
+ * This will append "The answer is 42." to `out`. The buffer content can be
+ * converted to `std::string` with `to_string(out)`.
  */
 template <typename T, size_t SIZE = inline_buffer_size,
-          typename Allocator = std::allocator<T>>
-class basic_memory_buffer final : public detail::buffer<T> {
+          typename Allocator = detail::allocator<T>>
+class basic_memory_buffer : public detail::buffer<T> {
  private:
   T store_[SIZE];
 
@@ -893,37 +849,37 @@ class basic_memory_buffer final : public detail::buffer<T> {
     if (data != store_) alloc_.deallocate(data, this->capacity());
   }
 
- protected:
-  FMT_CONSTEXPR20 void grow(size_t size) override {
+  static FMT_CONSTEXPR20 void grow(detail::buffer<T>& buf, size_t size) {
     detail::abort_fuzzing_if(size > 5000);
-    const size_t max_size = std::allocator_traits<Allocator>::max_size(alloc_);
-    size_t old_capacity = this->capacity();
+    auto& self = static_cast<basic_memory_buffer&>(buf);
+    const size_t max_size =
+        std::allocator_traits<Allocator>::max_size(self.alloc_);
+    size_t old_capacity = buf.capacity();
     size_t new_capacity = old_capacity + old_capacity / 2;
     if (size > new_capacity)
       new_capacity = size;
     else if (new_capacity > max_size)
-      new_capacity = size > max_size ? size : max_size;
-    T* old_data = this->data();
-    T* new_data =
-        std::allocator_traits<Allocator>::allocate(alloc_, new_capacity);
+      new_capacity = max_of(size, max_size);
+    T* old_data = buf.data();
+    T* new_data = self.alloc_.allocate(new_capacity);
     // Suppress a bogus -Wstringop-overflow in gcc 13.1 (#3481).
-    detail::assume(this->size() <= new_capacity);
+    detail::assume(buf.size() <= new_capacity);
     // The following code doesn't throw, so the raw pointer above doesn't leak.
-    std::uninitialized_copy_n(old_data, this->size(), new_data);
-    this->set(new_data, new_capacity);
+    memcpy(new_data, old_data, buf.size() * sizeof(T));
+    self.set(new_data, new_capacity);
     // deallocate must not throw according to the standard, but even if it does,
     // the buffer already uses the new storage and will deallocate it in
     // destructor.
-    if (old_data != store_) alloc_.deallocate(old_data, old_capacity);
+    if (old_data != self.store_) self.alloc_.deallocate(old_data, old_capacity);
   }
 
  public:
   using value_type = T;
   using const_reference = const T&;
 
-  FMT_CONSTEXPR20 explicit basic_memory_buffer(
+  FMT_CONSTEXPR explicit basic_memory_buffer(
       const Allocator& alloc = Allocator())
-      : alloc_(alloc) {
+      : detail::buffer<T>(grow), alloc_(alloc) {
     this->set(store_, SIZE);
     if (detail::is_constant_evaluated()) detail::fill_n(store_, SIZE, T());
   }
@@ -937,7 +893,7 @@ class basic_memory_buffer final : public detail::buffer<T> {
     size_t size = other.size(), capacity = other.capacity();
     if (data == other.store_) {
       this->set(store_, capacity);
-      detail::copy_str<T>(other.store_, other.store_ + size, store_);
+      detail::copy<T>(other.store_, other.store_ + size, store_);
     } else {
       this->set(data, capacity);
       // Set pointer to the inline array so that delete is not called
@@ -949,21 +905,14 @@ class basic_memory_buffer final : public detail::buffer<T> {
   }
 
  public:
-  /**
-    \rst
-    Constructs a :class:`fmt::basic_memory_buffer` object moving the content
-    of the other object to it.
-    \endrst
-   */
-  FMT_CONSTEXPR20 basic_memory_buffer(basic_memory_buffer&& other) noexcept {
+  /// Constructs a `basic_memory_buffer` object moving the content of the other
+  /// object to it.
+  FMT_CONSTEXPR20 basic_memory_buffer(basic_memory_buffer&& other) noexcept
+      : detail::buffer<T>(grow) {
     move(other);
   }
 
-  /**
-    \rst
-    Moves the content of the other ``basic_memory_buffer`` object to this one.
-    \endrst
-   */
+  /// Moves the content of the other `basic_memory_buffer` object to this one.
   auto operator=(basic_memory_buffer&& other) noexcept -> basic_memory_buffer& {
     FMT_ASSERT(this != &other, "");
     deallocate();
@@ -974,24 +923,65 @@ class basic_memory_buffer final : public detail::buffer<T> {
   // Returns a copy of the allocator associated with this buffer.
   auto get_allocator() const -> Allocator { return alloc_; }
 
-  /**
-    Resizes the buffer to contain *count* elements. If T is a POD type new
-    elements may not be initialized.
-   */
-  FMT_CONSTEXPR20 void resize(size_t count) { this->try_resize(count); }
+  /// Resizes the buffer to contain `count` elements. If T is a POD type new
+  /// elements may not be initialized.
+  FMT_CONSTEXPR void resize(size_t count) { this->try_resize(count); }
 
-  /** Increases the buffer capacity to *new_capacity*. */
+  /// Increases the buffer capacity to `new_capacity`.
   void reserve(size_t new_capacity) { this->try_reserve(new_capacity); }
 
   using detail::buffer<T>::append;
   template <typename ContiguousRange>
-  void append(const ContiguousRange& range) {
+  FMT_CONSTEXPR20 void append(const ContiguousRange& range) {
     append(range.data(), range.data() + range.size());
   }
 };
 
 using memory_buffer = basic_memory_buffer<char>;
 
+template <size_t SIZE>
+FMT_NODISCARD auto to_string(basic_memory_buffer<char, SIZE>& buf)
+    -> std::string {
+  auto size = buf.size();
+  detail::assume(size < std::string().max_size());
+  return {buf.data(), size};
+}
+
+// A writer to a buffered stream. It doesn't own the underlying stream.
+class writer {
+ private:
+  detail::buffer<char>* buf_;
+
+  // We cannot create a file buffer in advance because any write to a FILE may
+  // invalidate it.
+  FILE* file_;
+
+ public:
+  inline writer(FILE* f) : buf_(nullptr), file_(f) {}
+  inline writer(detail::buffer<char>& buf) : buf_(&buf) {}
+
+  /// Formats `args` according to specifications in `fmt` and writes the
+  /// output to the file.
+  template <typename... T> void print(format_string<T...> fmt, T&&... args) {
+    if (buf_)
+      fmt::format_to(appender(*buf_), fmt, std::forward<T>(args)...);
+    else
+      fmt::print(file_, fmt, std::forward<T>(args)...);
+  }
+};
+
+class string_buffer {
+ private:
+  std::string str_;
+  detail::container_buffer<std::string> buf_;
+
+ public:
+  inline string_buffer() : buf_(str_) {}
+
+  inline operator writer() { return buf_; }
+  inline std::string& str() { return str_; }
+};
+
 template <typename T, size_t SIZE, typename Allocator>
 struct is_contiguous<basic_memory_buffer<T, SIZE, Allocator>> : std::true_type {
 };
@@ -999,32 +989,28 @@ struct is_contiguous<basic_memory_buffer<T, SIZE, Allocator>> : std::true_type {
 FMT_END_EXPORT
 namespace detail {
 FMT_API auto write_console(int fd, string_view text) -> bool;
-FMT_API void print(std::FILE*, string_view);
+FMT_API void print(FILE*, string_view);
 }  // namespace detail
 
 FMT_BEGIN_EXPORT
 
 // Suppress a misleading warning in older versions of clang.
-#if FMT_CLANG_VERSION
-#  pragma clang diagnostic ignored "-Wweak-vtables"
-#endif
+FMT_PRAGMA_CLANG(diagnostic ignored "-Wweak-vtables")
 
-/** An error reported from a formatting function. */
+/// An error reported from a formatting function.
 class FMT_SO_VISIBILITY("default") format_error : public std::runtime_error {
  public:
   using std::runtime_error::runtime_error;
 };
 
-namespace detail_exported {
-#if FMT_USE_NONTYPE_TEMPLATE_ARGS
+namespace detail {
 template <typename Char, size_t N> struct fixed_string {
-  constexpr fixed_string(const Char (&str)[N]) {
-    detail::copy_str<Char, const Char*, Char*>(static_cast<const Char*>(str),
-                                               str + N, data);
+  FMT_CONSTEXPR20 fixed_string(const Char (&s)[N]) {
+    detail::copy<Char, const Char*, Char*>(static_cast<const Char*>(s), s + N,
+                                           data);
   }
   Char data[N] = {};
 };
-#endif
 
 // Converts a compile-time string to basic_string_view.
 template <typename Char, size_t N>
@@ -1035,25 +1021,69 @@ constexpr auto compile_string_to_view(const Char (&s)[N])
   return {s, N - (std::char_traits<Char>::to_int_type(s[N - 1]) == 0 ? 1 : 0)};
 }
 template <typename Char>
-constexpr auto compile_string_to_view(detail::std_string_view<Char> s)
+constexpr auto compile_string_to_view(basic_string_view<Char> s)
     -> basic_string_view<Char> {
-  return {s.data(), s.size()};
+  return s;
 }
-}  // namespace detail_exported
+}  // namespace detail
+
+// A generic formatting context with custom output iterator and character
+// (code unit) support. Char is the format string code unit type which can be
+// different from OutputIt::value_type.
+template <typename OutputIt, typename Char> class generic_context {
+ private:
+  OutputIt out_;
+  basic_format_args<generic_context> args_;
+  detail::locale_ref loc_;
+
+ public:
+  using char_type = Char;
+  using iterator = OutputIt;
+  using parse_context_type FMT_DEPRECATED = parse_context<Char>;
+  template <typename T>
+  using formatter_type FMT_DEPRECATED = formatter<T, Char>;
+  enum { builtin_types = FMT_BUILTIN_TYPES };
+
+  constexpr generic_context(OutputIt out,
+                            basic_format_args<generic_context> args,
+                            detail::locale_ref loc = {})
+      : out_(out), args_(args), loc_(loc) {}
+  generic_context(generic_context&&) = default;
+  generic_context(const generic_context&) = delete;
+  void operator=(const generic_context&) = delete;
+
+  constexpr auto arg(int id) const -> basic_format_arg<generic_context> {
+    return args_.get(id);
+  }
+  auto arg(basic_string_view<Char> name) -> basic_format_arg<generic_context> {
+    return args_.get(name);
+  }
+  FMT_CONSTEXPR auto arg_id(basic_string_view<Char> name) -> int {
+    return args_.get_id(name);
+  }
+
+  FMT_CONSTEXPR auto out() -> iterator { return out_; }
+
+  void advance_to(iterator it) {
+    if (!detail::is_back_insert_iterator<iterator>()) out_ = it;
+  }
+
+  FMT_CONSTEXPR auto locale() -> detail::locale_ref { return loc_; }
+};
 
 class loc_value {
  private:
-  basic_format_arg<format_context> value_;
+  basic_format_arg<context> value_;
 
  public:
   template <typename T, FMT_ENABLE_IF(!detail::is_float128<T>::value)>
-  loc_value(T value) : value_(detail::make_arg<format_context>(value)) {}
+  loc_value(T value) : value_(value) {}
 
   template <typename T, FMT_ENABLE_IF(detail::is_float128<T>::value)>
   loc_value(T) {}
 
   template <typename Visitor> auto visit(Visitor&& vis) -> decltype(vis(0)) {
-    return visit_format_arg(vis, value_);
+    return value_.visit(vis);
   }
 };
 
@@ -1067,7 +1097,7 @@ template <typename Locale> class format_facet : public Locale::facet {
 
  protected:
   virtual auto do_put(appender out, loc_value val,
-                      const format_specs<>& specs) const -> bool;
+                      const format_specs& specs) const -> bool;
 
  public:
   static FMT_API typename Locale::id id;
@@ -1080,12 +1110,14 @@ template <typename Locale> class format_facet : public Locale::facet {
         grouping_(g.begin(), g.end()),
         decimal_point_(decimal_point) {}
 
-  auto put(appender out, loc_value val, const format_specs<>& specs) const
+  auto put(appender out, loc_value val, const format_specs& specs) const
       -> bool {
     return do_put(out, val, specs);
   }
 };
 
+FMT_END_EXPORT
+
 namespace detail {
 
 // Returns true if value is negative, false otherwise.
@@ -1099,14 +1131,6 @@ constexpr auto is_negative(T) -> bool {
   return false;
 }
 
-template <typename T>
-FMT_CONSTEXPR auto is_supported_floating_point(T) -> bool {
-  if (std::is_same<T, float>()) return FMT_USE_FLOAT;
-  if (std::is_same<T, double>()) return FMT_USE_DOUBLE;
-  if (std::is_same<T, long double>()) return FMT_USE_LONG_DOUBLE;
-  return true;
-}
-
 // Smallest of uint32_t, uint64_t, uint128_t that is large enough to
 // represent all values of an integral type T.
 template <typename T>
@@ -1123,21 +1147,22 @@ using uint64_or_128_t = conditional_t<num_bits<T>() <= 64, uint64_t, uint128_t>;
       (factor) * 100000000, (factor) * 1000000000
 
 // Converts value in the range [0, 100) to a string.
-constexpr auto digits2(size_t value) -> const char* {
-  // GCC generates slightly better code when value is pointer-size.
-  return &"0001020304050607080910111213141516171819"
-         "2021222324252627282930313233343536373839"
-         "4041424344454647484950515253545556575859"
-         "6061626364656667686970717273747576777879"
-         "8081828384858687888990919293949596979899"[value * 2];
-}
-
-// Sign is a template parameter to workaround a bug in gcc 4.8.
-template <typename Char, typename Sign> constexpr auto sign(Sign s) -> Char {
-#if !FMT_GCC_VERSION || FMT_GCC_VERSION >= 604
-  static_assert(std::is_same<Sign, sign_t>::value, "");
-#endif
-  return static_cast<Char>("\0-+ "[s]);
+// GCC generates slightly better code when value is pointer-size.
+inline auto digits2(size_t value) -> const char* {
+  // Align data since unaligned access may be slower when crossing a
+  // hardware-specific boundary.
+  alignas(2) static const char data[] =
+      "0001020304050607080910111213141516171819"
+      "2021222324252627282930313233343536373839"
+      "4041424344454647484950515253545556575859"
+      "6061626364656667686970717273747576777879"
+      "8081828384858687888990919293949596979899";
+  return &data[value * 2];
+}
+
+template <typename Char> constexpr auto getsign(sign s) -> Char {
+  return static_cast<char>(((' ' << 24) | ('+' << 16) | ('-' << 8)) >>
+                           (static_cast<int>(s) * 8));
 }
 
 template <typename T> FMT_CONSTEXPR auto count_digits_fallback(T n) -> int {
@@ -1185,9 +1210,7 @@ inline auto do_count_digits(uint64_t n) -> int {
 // except for n == 0 in which case count_digits returns 1.
 FMT_CONSTEXPR20 inline auto count_digits(uint64_t n) -> int {
 #ifdef FMT_BUILTIN_CLZLL
-  if (!is_constant_evaluated()) {
-    return do_count_digits(n);
-  }
+  if (!is_constant_evaluated() && !FMT_OPTIMIZE_SIZE) return do_count_digits(n);
 #endif
   return count_digits_fallback(n);
 }
@@ -1237,9 +1260,7 @@ FMT_INLINE auto do_count_digits(uint32_t n) -> int {
 // Optional version of count_digits for better performance on 32-bit platforms.
 FMT_CONSTEXPR20 inline auto count_digits(uint32_t n) -> int {
 #ifdef FMT_BUILTIN_CLZ
-  if (!is_constant_evaluated()) {
-    return do_count_digits(n);
-  }
+  if (!is_constant_evaluated() && !FMT_OPTIMIZE_SIZE) return do_count_digits(n);
 #endif
   return count_digits_fallback(n);
 }
@@ -1276,6 +1297,17 @@ template <> inline auto decimal_point(locale_ref loc) -> wchar_t {
   return decimal_point_impl<wchar_t>(loc);
 }
 
+#ifndef FMT_HEADER_ONLY
+FMT_BEGIN_EXPORT
+extern template FMT_API auto thousands_sep_impl<char>(locale_ref)
+    -> thousands_sep_result<char>;
+extern template FMT_API auto thousands_sep_impl<wchar_t>(locale_ref)
+    -> thousands_sep_result<wchar_t>;
+extern template FMT_API auto decimal_point_impl(locale_ref) -> char;
+extern template FMT_API auto decimal_point_impl(locale_ref) -> wchar_t;
+FMT_END_EXPORT
+#endif  // FMT_HEADER_ONLY
+
 // Compares two characters for equality.
 template <typename Char> auto equal2(const Char* lhs, const char* rhs) -> bool {
   return lhs[0] == Char(rhs[0]) && lhs[1] == Char(rhs[1]);
@@ -1284,83 +1316,99 @@ inline auto equal2(const char* lhs, const char* rhs) -> bool {
   return memcmp(lhs, rhs, 2) == 0;
 }
 
-// Copies two characters from src to dst.
+// Writes a two-digit value to out.
 template <typename Char>
-FMT_CONSTEXPR20 FMT_INLINE void copy2(Char* dst, const char* src) {
-  if (!is_constant_evaluated() && sizeof(Char) == sizeof(char)) {
-    memcpy(dst, src, 2);
+FMT_CONSTEXPR20 FMT_INLINE void write2digits(Char* out, size_t value) {
+  if (!is_constant_evaluated() && std::is_same<Char, char>::value &&
+      !FMT_OPTIMIZE_SIZE) {
+    memcpy(out, digits2(value), 2);
     return;
   }
-  *dst++ = static_cast<Char>(*src++);
-  *dst = static_cast<Char>(*src);
+  *out++ = static_cast<Char>('0' + value / 10);
+  *out = static_cast<Char>('0' + value % 10);
 }
 
-template <typename Iterator> struct format_decimal_result {
-  Iterator begin;
-  Iterator end;
-};
-
-// Formats a decimal unsigned integer value writing into out pointing to a
-// buffer of specified size. The caller must ensure that the buffer is large
-// enough.
+// Formats a decimal unsigned integer value writing to out pointing to a buffer
+// of specified size. The caller must ensure that the buffer is large enough.
 template <typename Char, typename UInt>
-FMT_CONSTEXPR20 auto format_decimal(Char* out, UInt value, int size)
-    -> format_decimal_result<Char*> {
+FMT_CONSTEXPR20 auto do_format_decimal(Char* out, UInt value, int size)
+    -> Char* {
   FMT_ASSERT(size >= count_digits(value), "invalid digit count");
-  out += size;
-  Char* end = out;
+  unsigned n = to_unsigned(size);
   while (value >= 100) {
     // Integer division is slow so do it for a group of two digits instead
     // of for every digit. The idea comes from the talk by Alexandrescu
     // "Three Optimization Tips for C++". See speed-test for a comparison.
-    out -= 2;
-    copy2(out, digits2(static_cast<size_t>(value % 100)));
+    n -= 2;
+    write2digits(out + n, static_cast<unsigned>(value % 100));
     value /= 100;
   }
-  if (value < 10) {
-    *--out = static_cast<Char>('0' + value);
-    return {out, end};
+  if (value >= 10) {
+    n -= 2;
+    write2digits(out + n, static_cast<unsigned>(value));
+  } else {
+    out[--n] = static_cast<Char>('0' + value);
   }
-  out -= 2;
-  copy2(out, digits2(static_cast<size_t>(value)));
-  return {out, end};
+  return out + n;
+}
+
+template <typename Char, typename UInt>
+FMT_CONSTEXPR FMT_INLINE auto format_decimal(Char* out, UInt value,
+                                             int num_digits) -> Char* {
+  do_format_decimal(out, value, num_digits);
+  return out + num_digits;
 }
 
-template <typename Char, typename UInt, typename Iterator,
-          FMT_ENABLE_IF(!std::is_pointer<remove_cvref_t<Iterator>>::value)>
-FMT_CONSTEXPR inline auto format_decimal(Iterator out, UInt value, int size)
-    -> format_decimal_result<Iterator> {
+template <typename Char, typename UInt, typename OutputIt,
+          FMT_ENABLE_IF(is_back_insert_iterator<OutputIt>::value)>
+FMT_CONSTEXPR auto format_decimal(OutputIt out, UInt value, int num_digits)
+    -> OutputIt {
+  if (auto ptr = to_pointer<Char>(out, to_unsigned(num_digits))) {
+    do_format_decimal(ptr, value, num_digits);
+    return out;
+  }
   // Buffer is large enough to hold all digits (digits10 + 1).
-  Char buffer[digits10<UInt>() + 1] = {};
-  auto end = format_decimal(buffer, value, size).end;
-  return {out, detail::copy_str_noinline<Char>(buffer, end, out)};
+  char buffer[digits10<UInt>() + 1];
+  if (is_constant_evaluated()) fill_n(buffer, sizeof(buffer), '\0');
+  do_format_decimal(buffer, value, num_digits);
+  return copy_noinline<Char>(buffer, buffer + num_digits, out);
 }
 
-template <unsigned BASE_BITS, typename Char, typename UInt>
-FMT_CONSTEXPR auto format_uint(Char* buffer, UInt value, int num_digits,
-                               bool upper = false) -> Char* {
-  buffer += num_digits;
-  Char* end = buffer;
+template <typename Char, typename UInt>
+FMT_CONSTEXPR auto do_format_base2e(int base_bits, Char* out, UInt value,
+                                    int size, bool upper = false) -> Char* {
+  out += size;
   do {
     const char* digits = upper ? "0123456789ABCDEF" : "0123456789abcdef";
-    unsigned digit = static_cast<unsigned>(value & ((1 << BASE_BITS) - 1));
-    *--buffer = static_cast<Char>(BASE_BITS < 4 ? static_cast<char>('0' + digit)
-                                                : digits[digit]);
-  } while ((value >>= BASE_BITS) != 0);
-  return end;
+    unsigned digit = static_cast<unsigned>(value & ((1 << base_bits) - 1));
+    *--out = static_cast<Char>(base_bits < 4 ? static_cast<char>('0' + digit)
+                                             : digits[digit]);
+  } while ((value >>= base_bits) != 0);
+  return out;
+}
+
+// Formats an unsigned integer in the power of two base (binary, octal, hex).
+template <typename Char, typename UInt>
+FMT_CONSTEXPR auto format_base2e(int base_bits, Char* out, UInt value,
+                                 int num_digits, bool upper = false) -> Char* {
+  do_format_base2e(base_bits, out, value, num_digits, upper);
+  return out + num_digits;
 }
 
-template <unsigned BASE_BITS, typename Char, typename It, typename UInt>
-FMT_CONSTEXPR inline auto format_uint(It out, UInt value, int num_digits,
-                                      bool upper = false) -> It {
+template <typename Char, typename OutputIt, typename UInt,
+          FMT_ENABLE_IF(is_back_insert_iterator<OutputIt>::value)>
+FMT_CONSTEXPR inline auto format_base2e(int base_bits, OutputIt out, UInt value,
+                                        int num_digits, bool upper = false)
+    -> OutputIt {
   if (auto ptr = to_pointer<Char>(out, to_unsigned(num_digits))) {
-    format_uint<BASE_BITS>(ptr, value, num_digits, upper);
+    format_base2e(base_bits, ptr, value, num_digits, upper);
     return out;
   }
-  // Buffer should be large enough to hold all digits (digits / BASE_BITS + 1).
-  char buffer[num_bits<UInt>() / BASE_BITS + 1] = {};
-  format_uint<BASE_BITS>(buffer, value, num_digits, upper);
-  return detail::copy_str_noinline<Char>(buffer, buffer + num_digits, out);
+  // Make buffer large enough for any base.
+  char buffer[num_bits<UInt>()];
+  if (is_constant_evaluated()) fill_n(buffer, sizeof(buffer), '\0');
+  format_base2e(base_bits, buffer, value, num_digits, upper);
+  return detail::copy_noinline<Char>(buffer, buffer + num_digits, out);
 }
 
 // A converter from UTF-8 to UTF-16.
@@ -1370,10 +1418,12 @@ class utf8_to_utf16 {
 
  public:
   FMT_API explicit utf8_to_utf16(string_view s);
-  operator basic_string_view<wchar_t>() const { return {&buffer_[0], size()}; }
-  auto size() const -> size_t { return buffer_.size() - 1; }
-  auto c_str() const -> const wchar_t* { return &buffer_[0]; }
-  auto str() const -> std::wstring { return {&buffer_[0], size()}; }
+  inline operator basic_string_view<wchar_t>() const {
+    return {&buffer_[0], size()};
+  }
+  inline auto size() const -> size_t { return buffer_.size() - 1; }
+  inline auto c_str() const -> const wchar_t* { return &buffer_[0]; }
+  inline auto str() const -> std::wstring { return {&buffer_[0], size()}; }
 };
 
 enum class to_utf8_error_policy { abort, replace };
@@ -1420,10 +1470,12 @@ template <typename WChar, typename Buffer = memory_buffer> class to_utf8 {
           if (policy == to_utf8_error_policy::abort) return false;
           buf.append(string_view("\xEF\xBF\xBD"));
           --p;
+          continue;
         } else {
           c = (c << 10) + static_cast<uint32_t>(*p) - 0x35fdc00;
         }
-      } else if (c < 0x80) {
+      }
+      if (c < 0x80) {
         buf.push_back(static_cast<char>(c));
       } else if (c < 0x800) {
         buf.push_back(static_cast<char>(0xc0 | (c >> 6)));
@@ -1591,25 +1643,30 @@ template <typename Float> constexpr auto exponent_bias() -> int {
 }
 
 // Writes the exponent exp in the form "[+-]d{2,3}" to buffer.
-template <typename Char, typename It>
-FMT_CONSTEXPR auto write_exponent(int exp, It it) -> It {
+template <typename Char, typename OutputIt>
+FMT_CONSTEXPR auto write_exponent(int exp, OutputIt out) -> OutputIt {
   FMT_ASSERT(-10000 < exp && exp < 10000, "exponent out of range");
   if (exp < 0) {
-    *it++ = static_cast<Char>('-');
+    *out++ = static_cast<Char>('-');
     exp = -exp;
   } else {
-    *it++ = static_cast<Char>('+');
+    *out++ = static_cast<Char>('+');
   }
-  if (exp >= 100) {
-    const char* top = digits2(to_unsigned(exp / 100));
-    if (exp >= 1000) *it++ = static_cast<Char>(top[0]);
-    *it++ = static_cast<Char>(top[1]);
-    exp %= 100;
-  }
-  const char* d = digits2(to_unsigned(exp));
-  *it++ = static_cast<Char>(d[0]);
-  *it++ = static_cast<Char>(d[1]);
-  return it;
+  auto uexp = static_cast<uint32_t>(exp);
+  if (is_constant_evaluated()) {
+    if (uexp < 10) *out++ = '0';
+    return format_decimal<Char>(out, uexp, count_digits(uexp));
+  }
+  if (uexp >= 100u) {
+    const char* top = digits2(uexp / 100);
+    if (uexp >= 1000u) *out++ = static_cast<Char>(top[0]);
+    *out++ = static_cast<Char>(top[1]);
+    uexp %= 100;
+  }
+  const char* d = digits2(uexp);
+  *out++ = static_cast<Char>(d[0]);
+  *out++ = static_cast<Char>(d[1]);
+  return out;
 }
 
 // A floating-point number f * pow(2, e) where F is an unsigned type.
@@ -1710,67 +1767,69 @@ constexpr auto convert_float(T value) -> convert_float_result<T> {
   return static_cast<convert_float_result<T>>(value);
 }
 
-template <typename OutputIt, typename Char>
+template <typename Char, typename OutputIt>
 FMT_NOINLINE FMT_CONSTEXPR auto fill(OutputIt it, size_t n,
-                                     const fill_t<Char>& fill) -> OutputIt {
-  auto fill_size = fill.size();
-  if (fill_size == 1) return detail::fill_n(it, n, fill[0]);
-  auto data = fill.data();
-  for (size_t i = 0; i < n; ++i)
-    it = copy_str<Char>(data, data + fill_size, it);
+                                     const basic_specs& specs) -> OutputIt {
+  auto fill_size = specs.fill_size();
+  if (fill_size == 1) return detail::fill_n(it, n, specs.fill_unit<Char>());
+  if (const Char* data = specs.fill<Char>()) {
+    for (size_t i = 0; i < n; ++i) it = copy<Char>(data, data + fill_size, it);
+  }
   return it;
 }
 
 // Writes the output of f, padded according to format specifications in specs.
 // size: output size in code units.
 // width: output display width in (terminal) column positions.
-template <align::type align = align::left, typename OutputIt, typename Char,
+template <typename Char, align default_align = align::left, typename OutputIt,
           typename F>
-FMT_CONSTEXPR auto write_padded(OutputIt out, const format_specs<Char>& specs,
+FMT_CONSTEXPR auto write_padded(OutputIt out, const format_specs& specs,
                                 size_t size, size_t width, F&& f) -> OutputIt {
-  static_assert(align == align::left || align == align::right, "");
+  static_assert(default_align == align::left || default_align == align::right,
+                "");
   unsigned spec_width = to_unsigned(specs.width);
   size_t padding = spec_width > width ? spec_width - width : 0;
   // Shifts are encoded as string literals because static constexpr is not
   // supported in constexpr functions.
-  auto* shifts = align == align::left ? "\x1f\x1f\x00\x01" : "\x00\x1f\x00\x01";
-  size_t left_padding = padding >> shifts[specs.align];
+  auto* shifts =
+      default_align == align::left ? "\x1f\x1f\x00\x01" : "\x00\x1f\x00\x01";
+  size_t left_padding = padding >> shifts[static_cast<int>(specs.align())];
   size_t right_padding = padding - left_padding;
-  auto it = reserve(out, size + padding * specs.fill.size());
-  if (left_padding != 0) it = fill(it, left_padding, specs.fill);
+  auto it = reserve(out, size + padding * specs.fill_size());
+  if (left_padding != 0) it = fill<Char>(it, left_padding, specs);
   it = f(it);
-  if (right_padding != 0) it = fill(it, right_padding, specs.fill);
+  if (right_padding != 0) it = fill<Char>(it, right_padding, specs);
   return base_iterator(out, it);
 }
 
-template <align::type align = align::left, typename OutputIt, typename Char,
+template <typename Char, align default_align = align::left, typename OutputIt,
           typename F>
-constexpr auto write_padded(OutputIt out, const format_specs<Char>& specs,
+constexpr auto write_padded(OutputIt out, const format_specs& specs,
                             size_t size, F&& f) -> OutputIt {
-  return write_padded<align>(out, specs, size, size, f);
+  return write_padded<Char, default_align>(out, specs, size, size, f);
 }
 
-template <align::type align = align::left, typename Char, typename OutputIt>
+template <typename Char, align default_align = align::left, typename OutputIt>
 FMT_CONSTEXPR auto write_bytes(OutputIt out, string_view bytes,
-                               const format_specs<Char>& specs) -> OutputIt {
-  return write_padded<align>(
+                               const format_specs& specs = {}) -> OutputIt {
+  return write_padded<Char, default_align>(
       out, specs, bytes.size(), [bytes](reserve_iterator<OutputIt> it) {
         const char* data = bytes.data();
-        return copy_str<Char>(data, data + bytes.size(), it);
+        return copy<Char>(data, data + bytes.size(), it);
       });
 }
 
 template <typename Char, typename OutputIt, typename UIntPtr>
-auto write_ptr(OutputIt out, UIntPtr value, const format_specs<Char>* specs)
+auto write_ptr(OutputIt out, UIntPtr value, const format_specs* specs)
     -> OutputIt {
   int num_digits = count_digits<4>(value);
   auto size = to_unsigned(num_digits) + size_t(2);
   auto write = [=](reserve_iterator<OutputIt> it) {
     *it++ = static_cast<Char>('0');
     *it++ = static_cast<Char>('x');
-    return format_uint<4, Char>(it, value, num_digits);
+    return format_base2e<Char>(4, it, value, num_digits);
   };
-  return specs ? write_padded<align::right>(out, *specs, size, write)
+  return specs ? write_padded<Char, align::right>(out, *specs, size, write)
                : base_iterator(out, write(reserve(out, size)));
 }
 
@@ -1778,8 +1837,9 @@ auto write_ptr(OutputIt out, UIntPtr value, const format_specs<Char>* specs)
 FMT_API auto is_printable(uint32_t cp) -> bool;
 
 inline auto needs_escape(uint32_t cp) -> bool {
-  return cp < 0x20 || cp == 0x7f || cp == '"' || cp == '\\' ||
-         !is_printable(cp);
+  if (cp < 0x20 || cp == 0x7f || cp == '"' || cp == '\\') return true;
+  if (FMT_OPTIMIZE_SIZE > 1) return false;
+  return !is_printable(cp);
 }
 
 template <typename Char> struct find_escape_result {
@@ -1788,17 +1848,11 @@ template <typename Char> struct find_escape_result {
   uint32_t cp;
 };
 
-template <typename Char>
-using make_unsigned_char =
-    typename conditional_t<std::is_integral<Char>::value,
-                           std::make_unsigned<Char>,
-                           type_identity<uint32_t>>::type;
-
 template <typename Char>
 auto find_escape(const Char* begin, const Char* end)
     -> find_escape_result<Char> {
   for (; begin != end; ++begin) {
-    uint32_t cp = static_cast<make_unsigned_char<Char>>(*begin);
+    uint32_t cp = static_cast<unsigned_char<Char>>(*begin);
     if (const_check(sizeof(Char) == 1) && cp >= 0x80) continue;
     if (needs_escape(cp)) return {begin, begin + 1, cp};
   }
@@ -1807,7 +1861,7 @@ auto find_escape(const Char* begin, const Char* end)
 
 inline auto find_escape(const char* begin, const char* end)
     -> find_escape_result<char> {
-  if (!is_utf8()) return find_escape<char>(begin, end);
+  if (!detail::use_utf8) return find_escape<char>(begin, end);
   auto result = find_escape_result<char>{end, nullptr, 0};
   for_each_codepoint(string_view(begin, to_unsigned(end - begin)),
                      [&](uint32_t cp, string_view sv) {
@@ -1820,40 +1874,14 @@ inline auto find_escape(const char* begin, const char* end)
   return result;
 }
 
-#define FMT_STRING_IMPL(s, base, explicit)                                    \
-  [] {                                                                        \
-    /* Use the hidden visibility as a workaround for a GCC bug (#1973). */    \
-    /* Use a macro-like name to avoid shadowing warnings. */                  \
-    struct FMT_VISIBILITY("hidden") FMT_COMPILE_STRING : base {               \
-      using char_type FMT_MAYBE_UNUSED = fmt::remove_cvref_t<decltype(s[0])>; \
-      FMT_MAYBE_UNUSED FMT_CONSTEXPR explicit                                 \
-      operator fmt::basic_string_view<char_type>() const {                    \
-        return fmt::detail_exported::compile_string_to_view<char_type>(s);    \
-      }                                                                       \
-    };                                                                        \
-    return FMT_COMPILE_STRING();                                              \
-  }()
-
-/**
-  \rst
-  Constructs a compile-time format string from a string literal *s*.
-
-  **Example**::
-
-    // A compile-time error because 'd' is an invalid specifier for strings.
-    std::string s = fmt::format(FMT_STRING("{:d}"), "foo");
-  \endrst
- */
-#define FMT_STRING(s) FMT_STRING_IMPL(s, fmt::detail::compile_string, )
-
 template <size_t width, typename Char, typename OutputIt>
 auto write_codepoint(OutputIt out, char prefix, uint32_t cp) -> OutputIt {
   *out++ = static_cast<Char>('\\');
   *out++ = static_cast<Char>(prefix);
   Char buf[width];
   fill_n(buf, width, static_cast<Char>('0'));
-  format_uint<4>(buf, cp, width);
-  return copy_str<Char>(buf, buf + width, out);
+  format_base2e(4, buf, cp, width);
+  return copy<Char>(buf, buf + width, out);
 }
 
 template <typename OutputIt, typename Char>
@@ -1873,23 +1901,15 @@ auto write_escaped_cp(OutputIt out, const find_escape_result<Char>& escape)
     *out++ = static_cast<Char>('\\');
     c = static_cast<Char>('t');
     break;
-  case '"':
-    FMT_FALLTHROUGH;
-  case '\'':
-    FMT_FALLTHROUGH;
-  case '\\':
-    *out++ = static_cast<Char>('\\');
-    break;
+  case '"':  FMT_FALLTHROUGH;
+  case '\'': FMT_FALLTHROUGH;
+  case '\\': *out++ = static_cast<Char>('\\'); break;
   default:
-    if (escape.cp < 0x100) {
-      return write_codepoint<2, Char>(out, 'x', escape.cp);
-    }
-    if (escape.cp < 0x10000) {
+    if (escape.cp < 0x100) return write_codepoint<2, Char>(out, 'x', escape.cp);
+    if (escape.cp < 0x10000)
       return write_codepoint<4, Char>(out, 'u', escape.cp);
-    }
-    if (escape.cp < 0x110000) {
+    if (escape.cp < 0x110000)
       return write_codepoint<8, Char>(out, 'U', escape.cp);
-    }
     for (Char escape_char : basic_string_view<Char>(
              escape.begin, to_unsigned(escape.end - escape.begin))) {
       out = write_codepoint<2, Char>(out, 'x',
@@ -1908,7 +1928,7 @@ auto write_escaped_string(OutputIt out, basic_string_view<Char> str)
   auto begin = str.begin(), end = str.end();
   do {
     auto escape = find_escape(begin, end);
-    out = copy_str<Char>(begin, escape.begin, out);
+    out = copy<Char>(begin, escape.begin, out);
     begin = escape.end;
     if (!begin) break;
     out = write_escaped_cp<OutputIt, Char>(out, escape);
@@ -1935,74 +1955,23 @@ auto write_escaped_char(OutputIt out, Char v) -> OutputIt {
 
 template <typename Char, typename OutputIt>
 FMT_CONSTEXPR auto write_char(OutputIt out, Char value,
-                              const format_specs<Char>& specs) -> OutputIt {
-  bool is_debug = specs.type == presentation_type::debug;
-  return write_padded(out, specs, 1, [=](reserve_iterator<OutputIt> it) {
+                              const format_specs& specs) -> OutputIt {
+  bool is_debug = specs.type() == presentation_type::debug;
+  return write_padded<Char>(out, specs, 1, [=](reserve_iterator<OutputIt> it) {
     if (is_debug) return write_escaped_char(it, value);
     *it++ = value;
     return it;
   });
 }
 template <typename Char, typename OutputIt>
-FMT_CONSTEXPR auto write(OutputIt out, Char value,
-                         const format_specs<Char>& specs, locale_ref loc = {})
-    -> OutputIt {
+FMT_CONSTEXPR auto write(OutputIt out, Char value, const format_specs& specs,
+                         locale_ref loc = {}) -> OutputIt {
   // char is formatted as unsigned char for consistency across platforms.
   using unsigned_type =
       conditional_t<std::is_same<Char, char>::value, unsigned char, unsigned>;
   return check_char_specs(specs)
-             ? write_char(out, value, specs)
-             : write(out, static_cast<unsigned_type>(value), specs, loc);
-}
-
-// Data for write_int that doesn't depend on output iterator type. It is used to
-// avoid template code bloat.
-template <typename Char> struct write_int_data {
-  size_t size;
-  size_t padding;
-
-  FMT_CONSTEXPR write_int_data(int num_digits, unsigned prefix,
-                               const format_specs<Char>& specs)
-      : size((prefix >> 24) + to_unsigned(num_digits)), padding(0) {
-    if (specs.align == align::numeric) {
-      auto width = to_unsigned(specs.width);
-      if (width > size) {
-        padding = width - size;
-        size = width;
-      }
-    } else if (specs.precision > num_digits) {
-      size = (prefix >> 24) + to_unsigned(specs.precision);
-      padding = to_unsigned(specs.precision - num_digits);
-    }
-  }
-};
-
-// Writes an integer in the format
-//   <left-padding><prefix><numeric-padding><digits><right-padding>
-// where <digits> are written by write_digits(it).
-// prefix contains chars in three lower bytes and the size in the fourth byte.
-template <typename OutputIt, typename Char, typename W>
-FMT_CONSTEXPR FMT_INLINE auto write_int(OutputIt out, int num_digits,
-                                        unsigned prefix,
-                                        const format_specs<Char>& specs,
-                                        W write_digits) -> OutputIt {
-  // Slightly faster check for specs.width == 0 && specs.precision == -1.
-  if ((specs.width | (specs.precision + 1)) == 0) {
-    auto it = reserve(out, to_unsigned(num_digits) + (prefix >> 24));
-    if (prefix != 0) {
-      for (unsigned p = prefix & 0xffffff; p != 0; p >>= 8)
-        *it++ = static_cast<Char>(p & 0xff);
-    }
-    return base_iterator(out, write_digits(it));
-  }
-  auto data = write_int_data<Char>(num_digits, prefix, specs);
-  return write_padded<align::right>(
-      out, specs, data.size, [=](reserve_iterator<OutputIt> it) {
-        for (unsigned p = prefix & 0xffffff; p != 0; p >>= 8)
-          *it++ = static_cast<Char>(p & 0xff);
-        it = detail::fill_n(it, data.padding, static_cast<Char>('0'));
-        return write_digits(it);
-      });
+             ? write_char<Char>(out, value, specs)
+             : write<Char>(out, static_cast<unsigned_type>(value), specs, loc);
 }
 
 template <typename Char> class digit_grouping {
@@ -2059,9 +2028,8 @@ template <typename Char> class digit_grouping {
     for (int i = 0, sep_index = static_cast<int>(separators.size() - 1);
          i < num_digits; ++i) {
       if (num_digits - i == separators[sep_index]) {
-        out =
-            copy_str<Char>(thousands_sep_.data(),
-                           thousands_sep_.data() + thousands_sep_.size(), out);
+        out = copy<Char>(thousands_sep_.data(),
+                         thousands_sep_.data() + thousands_sep_.size(), out);
         --sep_index;
       }
       *out++ = static_cast<Char>(digits[to_unsigned(i)]);
@@ -2078,54 +2046,45 @@ FMT_CONSTEXPR inline void prefix_append(unsigned& prefix, unsigned value) {
 // Writes a decimal integer with digit grouping.
 template <typename OutputIt, typename UInt, typename Char>
 auto write_int(OutputIt out, UInt value, unsigned prefix,
-               const format_specs<Char>& specs,
-               const digit_grouping<Char>& grouping) -> OutputIt {
+               const format_specs& specs, const digit_grouping<Char>& grouping)
+    -> OutputIt {
   static_assert(std::is_same<uint64_or_128_t<UInt>, UInt>::value, "");
   int num_digits = 0;
   auto buffer = memory_buffer();
-  switch (specs.type) {
+  switch (specs.type()) {
+  default: FMT_ASSERT(false, ""); FMT_FALLTHROUGH;
   case presentation_type::none:
-  case presentation_type::dec: {
+  case presentation_type::dec:
     num_digits = count_digits(value);
     format_decimal<char>(appender(buffer), value, num_digits);
     break;
-  }
-  case presentation_type::hex_lower:
-  case presentation_type::hex_upper: {
-    bool upper = specs.type == presentation_type::hex_upper;
-    if (specs.alt)
-      prefix_append(prefix, unsigned(upper ? 'X' : 'x') << 8 | '0');
+  case presentation_type::hex:
+    if (specs.alt())
+      prefix_append(prefix, unsigned(specs.upper() ? 'X' : 'x') << 8 | '0');
     num_digits = count_digits<4>(value);
-    format_uint<4, char>(appender(buffer), value, num_digits, upper);
-    break;
-  }
-  case presentation_type::bin_lower:
-  case presentation_type::bin_upper: {
-    bool upper = specs.type == presentation_type::bin_upper;
-    if (specs.alt)
-      prefix_append(prefix, unsigned(upper ? 'B' : 'b') << 8 | '0');
-    num_digits = count_digits<1>(value);
-    format_uint<1, char>(appender(buffer), value, num_digits);
+    format_base2e<char>(4, appender(buffer), value, num_digits, specs.upper());
     break;
-  }
-  case presentation_type::oct: {
+  case presentation_type::oct:
     num_digits = count_digits<3>(value);
     // Octal prefix '0' is counted as a digit, so only add it if precision
     // is not greater than the number of digits.
-    if (specs.alt && specs.precision <= num_digits && value != 0)
+    if (specs.alt() && specs.precision <= num_digits && value != 0)
       prefix_append(prefix, '0');
-    format_uint<3, char>(appender(buffer), value, num_digits);
+    format_base2e<char>(3, appender(buffer), value, num_digits);
+    break;
+  case presentation_type::bin:
+    if (specs.alt())
+      prefix_append(prefix, unsigned(specs.upper() ? 'B' : 'b') << 8 | '0');
+    num_digits = count_digits<1>(value);
+    format_base2e<char>(1, appender(buffer), value, num_digits);
     break;
-  }
   case presentation_type::chr:
-    return write_char(out, static_cast<Char>(value), specs);
-  default:
-    throw_format_error("invalid format specifier");
+    return write_char<Char>(out, static_cast<Char>(value), specs);
   }
 
   unsigned size = (prefix != 0 ? prefix >> 24 : 0) + to_unsigned(num_digits) +
                   to_unsigned(grouping.count_separators(num_digits));
-  return write_padded<align::right>(
+  return write_padded<Char, align::right>(
       out, specs, size, size, [&](reserve_iterator<OutputIt> it) {
         for (unsigned p = prefix & 0xffffff; p != 0; p >>= 8)
           *it++ = static_cast<Char>(p & 0xff);
@@ -2133,12 +2092,14 @@ auto write_int(OutputIt out, UInt value, unsigned prefix,
       });
 }
 
+#if FMT_USE_LOCALE
 // Writes a localized value.
-FMT_API auto write_loc(appender out, loc_value value,
-                       const format_specs<>& specs, locale_ref loc) -> bool;
-template <typename OutputIt, typename Char>
-inline auto write_loc(OutputIt, loc_value, const format_specs<Char>&,
-                      locale_ref) -> bool {
+FMT_API auto write_loc(appender out, loc_value value, const format_specs& specs,
+                       locale_ref loc) -> bool;
+#endif
+template <typename OutputIt>
+inline auto write_loc(OutputIt, loc_value, const format_specs&, locale_ref)
+    -> bool {
   return false;
 }
 
@@ -2148,7 +2109,7 @@ template <typename UInt> struct write_int_arg {
 };
 
 template <typename T>
-FMT_CONSTEXPR auto make_write_int_arg(T value, sign_t sign)
+FMT_CONSTEXPR auto make_write_int_arg(T value, sign s)
     -> write_int_arg<uint32_or_64_or_128_t<T>> {
   auto prefix = 0u;
   auto abs_value = static_cast<uint32_or_64_or_128_t<T>>(value);
@@ -2158,21 +2119,21 @@ FMT_CONSTEXPR auto make_write_int_arg(T value, sign_t sign)
   } else {
     constexpr const unsigned prefixes[4] = {0, 0, 0x1000000u | '+',
                                             0x1000000u | ' '};
-    prefix = prefixes[sign];
+    prefix = prefixes[static_cast<int>(s)];
   }
   return {abs_value, prefix};
 }
 
 template <typename Char = char> struct loc_writer {
-  buffer_appender<Char> out;
-  const format_specs<Char>& specs;
+  basic_appender<Char> out;
+  const format_specs& specs;
   std::basic_string<Char> sep;
   std::string grouping;
   std::basic_string<Char> decimal_point;
 
   template <typename T, FMT_ENABLE_IF(is_integer<T>::value)>
   auto operator()(T value) -> bool {
-    auto arg = make_write_int_arg(value, specs.sign);
+    auto arg = make_write_int_arg(value, specs.sign());
     write_int(out, static_cast<uint64_or_128_t<T>>(arg.abs_value), arg.prefix,
               specs, digit_grouping<Char>(grouping, sep));
     return true;
@@ -2184,167 +2145,162 @@ template <typename Char = char> struct loc_writer {
   }
 };
 
-template <typename Char, typename OutputIt, typename T>
-FMT_CONSTEXPR FMT_INLINE auto write_int(OutputIt out, write_int_arg<T> arg,
-                                        const format_specs<Char>& specs,
-                                        locale_ref) -> OutputIt {
-  static_assert(std::is_same<T, uint32_or_64_or_128_t<T>>::value, "");
-  auto abs_value = arg.abs_value;
-  auto prefix = arg.prefix;
-  switch (specs.type) {
-  case presentation_type::none:
-  case presentation_type::dec: {
-    auto num_digits = count_digits(abs_value);
-    return write_int(
-        out, num_digits, prefix, specs, [=](reserve_iterator<OutputIt> it) {
-          return format_decimal<Char>(it, abs_value, num_digits).end;
-        });
-  }
-  case presentation_type::hex_lower:
-  case presentation_type::hex_upper: {
-    bool upper = specs.type == presentation_type::hex_upper;
-    if (specs.alt)
-      prefix_append(prefix, unsigned(upper ? 'X' : 'x') << 8 | '0');
-    int num_digits = count_digits<4>(abs_value);
-    return write_int(
-        out, num_digits, prefix, specs, [=](reserve_iterator<OutputIt> it) {
-          return format_uint<4, Char>(it, abs_value, num_digits, upper);
-        });
-  }
-  case presentation_type::bin_lower:
-  case presentation_type::bin_upper: {
-    bool upper = specs.type == presentation_type::bin_upper;
-    if (specs.alt)
-      prefix_append(prefix, unsigned(upper ? 'B' : 'b') << 8 | '0');
-    int num_digits = count_digits<1>(abs_value);
-    return write_int(out, num_digits, prefix, specs,
-                     [=](reserve_iterator<OutputIt> it) {
-                       return format_uint<1, Char>(it, abs_value, num_digits);
-                     });
+// Size and padding computation separate from write_int to avoid template bloat.
+struct size_padding {
+  unsigned size;
+  unsigned padding;
+
+  FMT_CONSTEXPR size_padding(int num_digits, unsigned prefix,
+                             const format_specs& specs)
+      : size((prefix >> 24) + to_unsigned(num_digits)), padding(0) {
+    if (specs.align() == align::numeric) {
+      auto width = to_unsigned(specs.width);
+      if (width > size) {
+        padding = width - size;
+        size = width;
+      }
+    } else if (specs.precision > num_digits) {
+      size = (prefix >> 24) + to_unsigned(specs.precision);
+      padding = to_unsigned(specs.precision - num_digits);
+    }
   }
+};
+
+template <typename Char, typename OutputIt, typename T>
+FMT_CONSTEXPR FMT_INLINE auto write_int(OutputIt out, write_int_arg<T> arg,
+                                        const format_specs& specs) -> OutputIt {
+  static_assert(std::is_same<T, uint32_or_64_or_128_t<T>>::value, "");
+
+  constexpr int buffer_size = num_bits<T>();
+  char buffer[buffer_size];
+  if (is_constant_evaluated()) fill_n(buffer, buffer_size, '\0');
+  const char* begin = nullptr;
+  const char* end = buffer + buffer_size;
+
+  auto abs_value = arg.abs_value;
+  auto prefix = arg.prefix;
+  switch (specs.type()) {
+  default: FMT_ASSERT(false, ""); FMT_FALLTHROUGH;
+  case presentation_type::none:
+  case presentation_type::dec:
+    begin = do_format_decimal(buffer, abs_value, buffer_size);
+    break;
+  case presentation_type::hex:
+    begin = do_format_base2e(4, buffer, abs_value, buffer_size, specs.upper());
+    if (specs.alt())
+      prefix_append(prefix, unsigned(specs.upper() ? 'X' : 'x') << 8 | '0');
+    break;
   case presentation_type::oct: {
-    int num_digits = count_digits<3>(abs_value);
+    begin = do_format_base2e(3, buffer, abs_value, buffer_size);
     // Octal prefix '0' is counted as a digit, so only add it if precision
     // is not greater than the number of digits.
-    if (specs.alt && specs.precision <= num_digits && abs_value != 0)
+    auto num_digits = end - begin;
+    if (specs.alt() && specs.precision <= num_digits && abs_value != 0)
       prefix_append(prefix, '0');
-    return write_int(out, num_digits, prefix, specs,
-                     [=](reserve_iterator<OutputIt> it) {
-                       return format_uint<3, Char>(it, abs_value, num_digits);
-                     });
+    break;
   }
+  case presentation_type::bin:
+    begin = do_format_base2e(1, buffer, abs_value, buffer_size);
+    if (specs.alt())
+      prefix_append(prefix, unsigned(specs.upper() ? 'B' : 'b') << 8 | '0');
+    break;
   case presentation_type::chr:
-    return write_char(out, static_cast<Char>(abs_value), specs);
-  default:
-    throw_format_error("invalid format specifier");
+    return write_char<Char>(out, static_cast<Char>(abs_value), specs);
   }
-  return out;
+
+  // Write an integer in the format
+  //   <left-padding><prefix><numeric-padding><digits><right-padding>
+  // prefix contains chars in three lower bytes and the size in the fourth byte.
+  int num_digits = static_cast<int>(end - begin);
+  // Slightly faster check for specs.width == 0 && specs.precision == -1.
+  if ((specs.width | (specs.precision + 1)) == 0) {
+    auto it = reserve(out, to_unsigned(num_digits) + (prefix >> 24));
+    for (unsigned p = prefix & 0xffffff; p != 0; p >>= 8)
+      *it++ = static_cast<Char>(p & 0xff);
+    return base_iterator(out, copy<Char>(begin, end, it));
+  }
+  auto sp = size_padding(num_digits, prefix, specs);
+  unsigned padding = sp.padding;
+  return write_padded<Char, align::right>(
+      out, specs, sp.size, [=](reserve_iterator<OutputIt> it) {
+        for (unsigned p = prefix & 0xffffff; p != 0; p >>= 8)
+          *it++ = static_cast<Char>(p & 0xff);
+        it = detail::fill_n(it, padding, static_cast<Char>('0'));
+        return copy<Char>(begin, end, it);
+      });
 }
+
 template <typename Char, typename OutputIt, typename T>
-FMT_CONSTEXPR FMT_NOINLINE auto write_int_noinline(
-    OutputIt out, write_int_arg<T> arg, const format_specs<Char>& specs,
-    locale_ref loc) -> OutputIt {
-  return write_int(out, arg, specs, loc);
+FMT_CONSTEXPR FMT_NOINLINE auto write_int_noinline(OutputIt out,
+                                                   write_int_arg<T> arg,
+                                                   const format_specs& specs)
+    -> OutputIt {
+  return write_int<Char>(out, arg, specs);
 }
-template <typename Char, typename OutputIt, typename T,
+
+template <typename Char, typename T,
           FMT_ENABLE_IF(is_integral<T>::value &&
                         !std::is_same<T, bool>::value &&
-                        std::is_same<OutputIt, buffer_appender<Char>>::value)>
-FMT_CONSTEXPR FMT_INLINE auto write(OutputIt out, T value,
-                                    const format_specs<Char>& specs,
-                                    locale_ref loc) -> OutputIt {
-  if (specs.localized && write_loc(out, value, specs, loc)) return out;
-  return write_int_noinline(out, make_write_int_arg(value, specs.sign), specs,
-                            loc);
+                        !std::is_same<T, Char>::value)>
+FMT_CONSTEXPR FMT_INLINE auto write(basic_appender<Char> out, T value,
+                                    const format_specs& specs, locale_ref loc)
+    -> basic_appender<Char> {
+  if (specs.localized() && write_loc(out, value, specs, loc)) return out;
+  return write_int_noinline<Char>(out, make_write_int_arg(value, specs.sign()),
+                                  specs);
 }
+
 // An inlined version of write used in format string compilation.
 template <typename Char, typename OutputIt, typename T,
           FMT_ENABLE_IF(is_integral<T>::value &&
                         !std::is_same<T, bool>::value &&
-                        !std::is_same<OutputIt, buffer_appender<Char>>::value)>
+                        !std::is_same<T, Char>::value &&
+                        !std::is_same<OutputIt, basic_appender<Char>>::value)>
 FMT_CONSTEXPR FMT_INLINE auto write(OutputIt out, T value,
-                                    const format_specs<Char>& specs,
-                                    locale_ref loc) -> OutputIt {
-  if (specs.localized && write_loc(out, value, specs, loc)) return out;
-  return write_int(out, make_write_int_arg(value, specs.sign), specs, loc);
+                                    const format_specs& specs, locale_ref loc)
+    -> OutputIt {
+  if (specs.localized() && write_loc(out, value, specs, loc)) return out;
+  return write_int<Char>(out, make_write_int_arg(value, specs.sign()), specs);
 }
 
-// An output iterator that counts the number of objects written to it and
-// discards them.
-class counting_iterator {
- private:
-  size_t count_;
-
- public:
-  using iterator_category = std::output_iterator_tag;
-  using difference_type = std::ptrdiff_t;
-  using pointer = void;
-  using reference = void;
-  FMT_UNCHECKED_ITERATOR(counting_iterator);
-
-  struct value_type {
-    template <typename T> FMT_CONSTEXPR void operator=(const T&) {}
-  };
-
-  FMT_CONSTEXPR counting_iterator() : count_(0) {}
-
-  FMT_CONSTEXPR auto count() const -> size_t { return count_; }
-
-  FMT_CONSTEXPR auto operator++() -> counting_iterator& {
-    ++count_;
-    return *this;
-  }
-  FMT_CONSTEXPR auto operator++(int) -> counting_iterator {
-    auto it = *this;
-    ++*this;
-    return it;
-  }
-
-  FMT_CONSTEXPR friend auto operator+(counting_iterator it, difference_type n)
-      -> counting_iterator {
-    it.count_ += static_cast<size_t>(n);
-    return it;
-  }
-
-  FMT_CONSTEXPR auto operator*() const -> value_type { return {}; }
-};
-
 template <typename Char, typename OutputIt>
 FMT_CONSTEXPR auto write(OutputIt out, basic_string_view<Char> s,
-                         const format_specs<Char>& specs) -> OutputIt {
+                         const format_specs& specs) -> OutputIt {
   auto data = s.data();
   auto size = s.size();
   if (specs.precision >= 0 && to_unsigned(specs.precision) < size)
     size = code_point_index(s, to_unsigned(specs.precision));
-  bool is_debug = specs.type == presentation_type::debug;
+
+  bool is_debug = specs.type() == presentation_type::debug;
+  if (is_debug) {
+    auto buf = counting_buffer<Char>();
+    write_escaped_string(basic_appender<Char>(buf), s);
+    size = buf.count();
+  }
+
   size_t width = 0;
   if (specs.width != 0) {
-    if (is_debug)
-      width = write_escaped_string(counting_iterator{}, s).count();
-    else
-      width = compute_width(basic_string_view<Char>(data, size));
+    width =
+        is_debug ? size : compute_width(basic_string_view<Char>(data, size));
   }
-  return write_padded(out, specs, size, width,
-                      [=](reserve_iterator<OutputIt> it) {
-                        if (is_debug) return write_escaped_string(it, s);
-                        return copy_str<Char>(data, data + size, it);
-                      });
+  return write_padded<Char>(
+      out, specs, size, width, [=](reserve_iterator<OutputIt> it) {
+        return is_debug ? write_escaped_string(it, s)
+                        : copy<Char>(data, data + size, it);
+      });
 }
 template <typename Char, typename OutputIt>
-FMT_CONSTEXPR auto write(OutputIt out,
-                         basic_string_view<type_identity_t<Char>> s,
-                         const format_specs<Char>& specs, locale_ref)
-    -> OutputIt {
-  return write(out, s, specs);
+FMT_CONSTEXPR auto write(OutputIt out, basic_string_view<Char> s,
+                         const format_specs& specs, locale_ref) -> OutputIt {
+  return write<Char>(out, s, specs);
 }
 template <typename Char, typename OutputIt>
-FMT_CONSTEXPR auto write(OutputIt out, const Char* s,
-                         const format_specs<Char>& specs, locale_ref)
-    -> OutputIt {
-  if (specs.type == presentation_type::pointer)
+FMT_CONSTEXPR auto write(OutputIt out, const Char* s, const format_specs& specs,
+                         locale_ref) -> OutputIt {
+  if (specs.type() == presentation_type::pointer)
     return write_ptr<Char>(out, bit_cast<uintptr_t>(s), &specs);
-  if (!s) throw_format_error("string pointer is null");
-  return write(out, basic_string_view<Char>(s), specs, {});
+  if (!s) report_error("string pointer is null");
+  return write<Char>(out, basic_string_view<Char>(s), specs, {});
 }
 
 template <typename Char, typename OutputIt, typename T,
@@ -2358,46 +2314,37 @@ FMT_CONSTEXPR auto write(OutputIt out, T value) -> OutputIt {
   if (negative) abs_value = ~abs_value + 1;
   int num_digits = count_digits(abs_value);
   auto size = (negative ? 1 : 0) + static_cast<size_t>(num_digits);
-  auto it = reserve(out, size);
-  if (auto ptr = to_pointer<Char>(it, size)) {
+  if (auto ptr = to_pointer<Char>(out, size)) {
     if (negative) *ptr++ = static_cast<Char>('-');
     format_decimal<Char>(ptr, abs_value, num_digits);
     return out;
   }
-  if (negative) *it++ = static_cast<Char>('-');
-  it = format_decimal<Char>(it, abs_value, num_digits).end;
-  return base_iterator(out, it);
+  if (negative) *out++ = static_cast<Char>('-');
+  return format_decimal<Char>(out, abs_value, num_digits);
 }
 
-// DEPRECATED!
 template <typename Char>
 FMT_CONSTEXPR auto parse_align(const Char* begin, const Char* end,
-                               format_specs<Char>& specs) -> const Char* {
+                               format_specs& specs) -> const Char* {
   FMT_ASSERT(begin != end, "");
-  auto align = align::none;
+  auto alignment = align::none;
   auto p = begin + code_point_length(begin);
   if (end - p <= 0) p = begin;
   for (;;) {
     switch (to_ascii(*p)) {
-    case '<':
-      align = align::left;
-      break;
-    case '>':
-      align = align::right;
-      break;
-    case '^':
-      align = align::center;
-      break;
+    case '<': alignment = align::left; break;
+    case '>': alignment = align::right; break;
+    case '^': alignment = align::center; break;
     }
-    if (align != align::none) {
+    if (alignment != align::none) {
       if (p != begin) {
         auto c = *begin;
         if (c == '}') return begin;
         if (c == '{') {
-          throw_format_error("invalid fill character '{'");
+          report_error("invalid fill character '{'");
           return begin;
         }
-        specs.fill = {begin, to_unsigned(p - begin)};
+        specs.set_fill(basic_string_view<Char>(begin, to_unsigned(p - begin)));
         begin = p + 1;
       } else {
         ++begin;
@@ -2408,88 +2355,27 @@ FMT_CONSTEXPR auto parse_align(const Char* begin, const Char* end,
     }
     p = begin;
   }
-  specs.align = align;
+  specs.set_align(alignment);
   return begin;
 }
 
-// A floating-point presentation format.
-enum class float_format : unsigned char {
-  general,  // General: exponent notation or fixed point based on magnitude.
-  exp,      // Exponent notation with the default precision of 6, e.g. 1.2e-3.
-  fixed,    // Fixed point with the default precision of 6, e.g. 0.0012.
-  hex
-};
-
-struct float_specs {
-  int precision;
-  float_format format : 8;
-  sign_t sign : 8;
-  bool upper : 1;
-  bool locale : 1;
-  bool binary32 : 1;
-  bool showpoint : 1;
-};
-
-template <typename Char>
-FMT_CONSTEXPR auto parse_float_type_spec(const format_specs<Char>& specs)
-    -> float_specs {
-  auto result = float_specs();
-  result.showpoint = specs.alt;
-  result.locale = specs.localized;
-  switch (specs.type) {
-  case presentation_type::none:
-    result.format = float_format::general;
-    break;
-  case presentation_type::general_upper:
-    result.upper = true;
-    FMT_FALLTHROUGH;
-  case presentation_type::general_lower:
-    result.format = float_format::general;
-    break;
-  case presentation_type::exp_upper:
-    result.upper = true;
-    FMT_FALLTHROUGH;
-  case presentation_type::exp_lower:
-    result.format = float_format::exp;
-    result.showpoint |= specs.precision != 0;
-    break;
-  case presentation_type::fixed_upper:
-    result.upper = true;
-    FMT_FALLTHROUGH;
-  case presentation_type::fixed_lower:
-    result.format = float_format::fixed;
-    result.showpoint |= specs.precision != 0;
-    break;
-  case presentation_type::hexfloat_upper:
-    result.upper = true;
-    FMT_FALLTHROUGH;
-  case presentation_type::hexfloat_lower:
-    result.format = float_format::hex;
-    break;
-  default:
-    throw_format_error("invalid format specifier");
-    break;
-  }
-  return result;
-}
-
 template <typename Char, typename OutputIt>
 FMT_CONSTEXPR20 auto write_nonfinite(OutputIt out, bool isnan,
-                                     format_specs<Char> specs,
-                                     const float_specs& fspecs) -> OutputIt {
+                                     format_specs specs, sign s) -> OutputIt {
   auto str =
-      isnan ? (fspecs.upper ? "NAN" : "nan") : (fspecs.upper ? "INF" : "inf");
+      isnan ? (specs.upper() ? "NAN" : "nan") : (specs.upper() ? "INF" : "inf");
   constexpr size_t str_size = 3;
-  auto sign = fspecs.sign;
-  auto size = str_size + (sign ? 1 : 0);
+  auto size = str_size + (s != sign::none ? 1 : 0);
   // Replace '0'-padding with space for non-finite values.
   const bool is_zero_fill =
-      specs.fill.size() == 1 && *specs.fill.data() == static_cast<Char>('0');
-  if (is_zero_fill) specs.fill[0] = static_cast<Char>(' ');
-  return write_padded(out, specs, size, [=](reserve_iterator<OutputIt> it) {
-    if (sign) *it++ = detail::sign<Char>(sign);
-    return copy_str<Char>(str, str + str_size, it);
-  });
+      specs.fill_size() == 1 && specs.fill_unit<Char>() == '0';
+  if (is_zero_fill) specs.set_fill(' ');
+  return write_padded<Char>(out, specs, size,
+                            [=](reserve_iterator<OutputIt> it) {
+                              if (s != sign::none)
+                                *it++ = detail::getsign<Char>(s);
+                              return copy<Char>(str, str + str_size, it);
+                            });
 }
 
 // A decimal floating-point number significand * pow(10, exp).
@@ -2510,12 +2396,12 @@ inline auto get_significand_size(const dragonbox::decimal_fp<T>& f) -> int {
 template <typename Char, typename OutputIt>
 constexpr auto write_significand(OutputIt out, const char* significand,
                                  int significand_size) -> OutputIt {
-  return copy_str<Char>(significand, significand + significand_size, out);
+  return copy<Char>(significand, significand + significand_size, out);
 }
 template <typename Char, typename OutputIt, typename UInt>
 inline auto write_significand(OutputIt out, UInt significand,
                               int significand_size) -> OutputIt {
-  return format_decimal<Char>(out, significand, significand_size).end;
+  return format_decimal<Char>(out, significand, significand_size);
 }
 template <typename Char, typename OutputIt, typename T, typename Grouping>
 FMT_CONSTEXPR20 auto write_significand(OutputIt out, T significand,
@@ -2535,14 +2421,13 @@ template <typename Char, typename UInt,
           FMT_ENABLE_IF(std::is_integral<UInt>::value)>
 inline auto write_significand(Char* out, UInt significand, int significand_size,
                               int integral_size, Char decimal_point) -> Char* {
-  if (!decimal_point)
-    return format_decimal(out, significand, significand_size).end;
+  if (!decimal_point) return format_decimal(out, significand, significand_size);
   out += significand_size + 1;
   Char* end = out;
   int floating_size = significand_size - integral_size;
   for (int i = floating_size / 2; i > 0; --i) {
     out -= 2;
-    copy2(out, digits2(static_cast<std::size_t>(significand % 100)));
+    write2digits(out, static_cast<std::size_t>(significand % 100));
     significand /= 100;
   }
   if (floating_size % 2 != 0) {
@@ -2563,19 +2448,19 @@ inline auto write_significand(OutputIt out, UInt significand,
   Char buffer[digits10<UInt>() + 2];
   auto end = write_significand(buffer, significand, significand_size,
                                integral_size, decimal_point);
-  return detail::copy_str_noinline<Char>(buffer, end, out);
+  return detail::copy_noinline<Char>(buffer, end, out);
 }
 
 template <typename OutputIt, typename Char>
 FMT_CONSTEXPR auto write_significand(OutputIt out, const char* significand,
                                      int significand_size, int integral_size,
                                      Char decimal_point) -> OutputIt {
-  out = detail::copy_str_noinline<Char>(significand,
-                                        significand + integral_size, out);
+  out = detail::copy_noinline<Char>(significand, significand + integral_size,
+                                    out);
   if (!decimal_point) return out;
   *out++ = decimal_point;
-  return detail::copy_str_noinline<Char>(significand + integral_size,
-                                         significand + significand_size, out);
+  return detail::copy_noinline<Char>(significand + integral_size,
+                                     significand + significand_size, out);
 }
 
 template <typename OutputIt, typename Char, typename T, typename Grouping>
@@ -2588,44 +2473,42 @@ FMT_CONSTEXPR20 auto write_significand(OutputIt out, T significand,
                              decimal_point);
   }
   auto buffer = basic_memory_buffer<Char>();
-  write_significand(buffer_appender<Char>(buffer), significand,
-                    significand_size, integral_size, decimal_point);
+  write_significand(basic_appender<Char>(buffer), significand, significand_size,
+                    integral_size, decimal_point);
   grouping.apply(
       out, basic_string_view<Char>(buffer.data(), to_unsigned(integral_size)));
-  return detail::copy_str_noinline<Char>(buffer.data() + integral_size,
-                                         buffer.end(), out);
+  return detail::copy_noinline<Char>(buffer.data() + integral_size,
+                                     buffer.end(), out);
 }
 
-template <typename OutputIt, typename DecimalFP, typename Char,
+template <typename Char, typename OutputIt, typename DecimalFP,
           typename Grouping = digit_grouping<Char>>
 FMT_CONSTEXPR20 auto do_write_float(OutputIt out, const DecimalFP& f,
-                                    const format_specs<Char>& specs,
-                                    float_specs fspecs, locale_ref loc)
-    -> OutputIt {
+                                    const format_specs& specs, sign s,
+                                    locale_ref loc) -> OutputIt {
   auto significand = f.significand;
   int significand_size = get_significand_size(f);
   const Char zero = static_cast<Char>('0');
-  auto sign = fspecs.sign;
-  size_t size = to_unsigned(significand_size) + (sign ? 1 : 0);
+  size_t size = to_unsigned(significand_size) + (s != sign::none ? 1 : 0);
   using iterator = reserve_iterator<OutputIt>;
 
-  Char decimal_point =
-      fspecs.locale ? detail::decimal_point<Char>(loc) : static_cast<Char>('.');
+  Char decimal_point = specs.localized() ? detail::decimal_point<Char>(loc)
+                                         : static_cast<Char>('.');
 
   int output_exp = f.exponent + significand_size - 1;
   auto use_exp_format = [=]() {
-    if (fspecs.format == float_format::exp) return true;
-    if (fspecs.format != float_format::general) return false;
+    if (specs.type() == presentation_type::exp) return true;
+    if (specs.type() == presentation_type::fixed) return false;
     // Use the fixed notation if the exponent is in [exp_lower, exp_upper),
     // e.g. 0.0001 instead of 1e-04. Otherwise use the exponent notation.
     const int exp_lower = -4, exp_upper = 16;
     return output_exp < exp_lower ||
-           output_exp >= (fspecs.precision > 0 ? fspecs.precision : exp_upper);
+           output_exp >= (specs.precision > 0 ? specs.precision : exp_upper);
   };
   if (use_exp_format()) {
     int num_zeros = 0;
-    if (fspecs.showpoint) {
-      num_zeros = fspecs.precision - significand_size;
+    if (specs.alt()) {
+      num_zeros = specs.precision - significand_size;
       if (num_zeros < 0) num_zeros = 0;
       size += to_unsigned(num_zeros);
     } else if (significand_size == 1) {
@@ -2636,9 +2519,9 @@ FMT_CONSTEXPR20 auto do_write_float(OutputIt out, const DecimalFP& f,
     if (abs_output_exp >= 100) exp_digits = abs_output_exp >= 1000 ? 4 : 3;
 
     size += to_unsigned((decimal_point ? 1 : 0) + 2 + exp_digits);
-    char exp_char = fspecs.upper ? 'E' : 'e';
+    char exp_char = specs.upper() ? 'E' : 'e';
     auto write = [=](iterator it) {
-      if (sign) *it++ = detail::sign<Char>(sign);
+      if (s != sign::none) *it++ = detail::getsign<Char>(s);
       // Insert a decimal point after the first digit and add an exponent.
       it = write_significand(it, significand, significand_size, 1,
                              decimal_point);
@@ -2646,39 +2529,41 @@ FMT_CONSTEXPR20 auto do_write_float(OutputIt out, const DecimalFP& f,
       *it++ = static_cast<Char>(exp_char);
       return write_exponent<Char>(output_exp, it);
     };
-    return specs.width > 0 ? write_padded<align::right>(out, specs, size, write)
-                           : base_iterator(out, write(reserve(out, size)));
+    return specs.width > 0
+               ? write_padded<Char, align::right>(out, specs, size, write)
+               : base_iterator(out, write(reserve(out, size)));
   }
 
   int exp = f.exponent + significand_size;
   if (f.exponent >= 0) {
     // 1234e5 -> 123400000[.0+]
     size += to_unsigned(f.exponent);
-    int num_zeros = fspecs.precision - exp;
+    int num_zeros = specs.precision - exp;
     abort_fuzzing_if(num_zeros > 5000);
-    if (fspecs.showpoint) {
+    if (specs.alt()) {
       ++size;
-      if (num_zeros <= 0 && fspecs.format != float_format::fixed) num_zeros = 0;
+      if (num_zeros <= 0 && specs.type() != presentation_type::fixed)
+        num_zeros = 0;
       if (num_zeros > 0) size += to_unsigned(num_zeros);
     }
-    auto grouping = Grouping(loc, fspecs.locale);
+    auto grouping = Grouping(loc, specs.localized());
     size += to_unsigned(grouping.count_separators(exp));
-    return write_padded<align::right>(out, specs, size, [&](iterator it) {
-      if (sign) *it++ = detail::sign<Char>(sign);
+    return write_padded<Char, align::right>(out, specs, size, [&](iterator it) {
+      if (s != sign::none) *it++ = detail::getsign<Char>(s);
       it = write_significand<Char>(it, significand, significand_size,
                                    f.exponent, grouping);
-      if (!fspecs.showpoint) return it;
+      if (!specs.alt()) return it;
       *it++ = decimal_point;
       return num_zeros > 0 ? detail::fill_n(it, num_zeros, zero) : it;
     });
   } else if (exp > 0) {
     // 1234e-2 -> 12.34[0+]
-    int num_zeros = fspecs.showpoint ? fspecs.precision - significand_size : 0;
-    size += 1 + to_unsigned(num_zeros > 0 ? num_zeros : 0);
-    auto grouping = Grouping(loc, fspecs.locale);
+    int num_zeros = specs.alt() ? specs.precision - significand_size : 0;
+    size += 1 + static_cast<unsigned>(max_of(num_zeros, 0));
+    auto grouping = Grouping(loc, specs.localized());
     size += to_unsigned(grouping.count_separators(exp));
-    return write_padded<align::right>(out, specs, size, [&](iterator it) {
-      if (sign) *it++ = detail::sign<Char>(sign);
+    return write_padded<Char, align::right>(out, specs, size, [&](iterator it) {
+      if (s != sign::none) *it++ = detail::getsign<Char>(s);
       it = write_significand(it, significand, significand_size, exp,
                              decimal_point, grouping);
       return num_zeros > 0 ? detail::fill_n(it, num_zeros, zero) : it;
@@ -2686,14 +2571,14 @@ FMT_CONSTEXPR20 auto do_write_float(OutputIt out, const DecimalFP& f,
   }
   // 1234e-6 -> 0.001234
   int num_zeros = -exp;
-  if (significand_size == 0 && fspecs.precision >= 0 &&
-      fspecs.precision < num_zeros) {
-    num_zeros = fspecs.precision;
+  if (significand_size == 0 && specs.precision >= 0 &&
+      specs.precision < num_zeros) {
+    num_zeros = specs.precision;
   }
-  bool pointy = num_zeros != 0 || significand_size != 0 || fspecs.showpoint;
+  bool pointy = num_zeros != 0 || significand_size != 0 || specs.alt();
   size += 1 + (pointy ? 1 : 0) + to_unsigned(num_zeros);
-  return write_padded<align::right>(out, specs, size, [&](iterator it) {
-    if (sign) *it++ = detail::sign<Char>(sign);
+  return write_padded<Char, align::right>(out, specs, size, [&](iterator it) {
+    if (s != sign::none) *it++ = detail::getsign<Char>(s);
     *it++ = zero;
     if (!pointy) return it;
     *it++ = decimal_point;
@@ -2716,22 +2601,20 @@ template <typename Char> class fallback_digit_grouping {
   }
 };
 
-template <typename OutputIt, typename DecimalFP, typename Char>
+template <typename Char, typename OutputIt, typename DecimalFP>
 FMT_CONSTEXPR20 auto write_float(OutputIt out, const DecimalFP& f,
-                                 const format_specs<Char>& specs,
-                                 float_specs fspecs, locale_ref loc)
-    -> OutputIt {
+                                 const format_specs& specs, sign s,
+                                 locale_ref loc) -> OutputIt {
   if (is_constant_evaluated()) {
-    return do_write_float<OutputIt, DecimalFP, Char,
-                          fallback_digit_grouping<Char>>(out, f, specs, fspecs,
-                                                         loc);
+    return do_write_float<Char, OutputIt, DecimalFP,
+                          fallback_digit_grouping<Char>>(out, f, specs, s, loc);
   } else {
-    return do_write_float(out, f, specs, fspecs, loc);
+    return do_write_float<Char>(out, f, specs, s, loc);
   }
 }
 
 template <typename T> constexpr auto isnan(T value) -> bool {
-  return !(value >= value);  // std::isnan doesn't support __float128.
+  return value != value;  // std::isnan doesn't support __float128.
 }
 
 template <typename T, typename Enable = void>
@@ -2779,52 +2662,48 @@ inline FMT_CONSTEXPR20 void adjust_precision(int& precision, int exp10) {
 
 class bigint {
  private:
-  // A bigint is stored as an array of bigits (big digits), with bigit at index
-  // 0 being the least significant one.
-  using bigit = uint32_t;
+  // A bigint is a number in the form bigit_[N - 1] ... bigit_[0] * 32^exp_.
+  using bigit = uint32_t;  // A big digit.
   using double_bigit = uint64_t;
+  enum { bigit_bits = num_bits<bigit>() };
   enum { bigits_capacity = 32 };
   basic_memory_buffer<bigit, bigits_capacity> bigits_;
   int exp_;
 
-  FMT_CONSTEXPR20 auto operator[](int index) const -> bigit {
-    return bigits_[to_unsigned(index)];
-  }
-  FMT_CONSTEXPR20 auto operator[](int index) -> bigit& {
-    return bigits_[to_unsigned(index)];
-  }
-
-  static constexpr const int bigit_bits = num_bits<bigit>();
-
   friend struct formatter<bigint>;
 
-  FMT_CONSTEXPR20 void subtract_bigits(int index, bigit other, bigit& borrow) {
-    auto result = static_cast<double_bigit>((*this)[index]) - other - borrow;
-    (*this)[index] = static_cast<bigit>(result);
+  FMT_CONSTEXPR auto get_bigit(int i) const -> bigit {
+    return i >= exp_ && i < num_bigits() ? bigits_[i - exp_] : 0;
+  }
+
+  FMT_CONSTEXPR void subtract_bigits(int index, bigit other, bigit& borrow) {
+    auto result = double_bigit(bigits_[index]) - other - borrow;
+    bigits_[index] = static_cast<bigit>(result);
     borrow = static_cast<bigit>(result >> (bigit_bits * 2 - 1));
   }
 
-  FMT_CONSTEXPR20 void remove_leading_zeros() {
+  FMT_CONSTEXPR void remove_leading_zeros() {
     int num_bigits = static_cast<int>(bigits_.size()) - 1;
-    while (num_bigits > 0 && (*this)[num_bigits] == 0) --num_bigits;
+    while (num_bigits > 0 && bigits_[num_bigits] == 0) --num_bigits;
     bigits_.resize(to_unsigned(num_bigits + 1));
   }
 
   // Computes *this -= other assuming aligned bigints and *this >= other.
-  FMT_CONSTEXPR20 void subtract_aligned(const bigint& other) {
+  FMT_CONSTEXPR void subtract_aligned(const bigint& other) {
     FMT_ASSERT(other.exp_ >= exp_, "unaligned bigints");
     FMT_ASSERT(compare(*this, other) >= 0, "");
     bigit borrow = 0;
     int i = other.exp_ - exp_;
     for (size_t j = 0, n = other.bigits_.size(); j != n; ++i, ++j)
       subtract_bigits(i, other.bigits_[j], borrow);
-    while (borrow > 0) subtract_bigits(i, 0, borrow);
+    if (borrow != 0) subtract_bigits(i, 0, borrow);
+    FMT_ASSERT(borrow == 0, "");
     remove_leading_zeros();
   }
 
-  FMT_CONSTEXPR20 void multiply(uint32_t value) {
-    const double_bigit wide_value = value;
+  FMT_CONSTEXPR void multiply(uint32_t value) {
     bigit carry = 0;
+    const double_bigit wide_value = value;
     for (size_t i = 0, n = bigits_.size(); i < n; ++i) {
       double_bigit result = bigits_[i] * wide_value + carry;
       bigits_[i] = static_cast<bigit>(result);
@@ -2835,7 +2714,7 @@ class bigint {
 
   template <typename UInt, FMT_ENABLE_IF(std::is_same<UInt, uint64_t>::value ||
                                          std::is_same<UInt, uint128_t>::value)>
-  FMT_CONSTEXPR20 void multiply(UInt value) {
+  FMT_CONSTEXPR void multiply(UInt value) {
     using half_uint =
         conditional_t<std::is_same<UInt, uint128_t>::value, uint64_t, uint32_t>;
     const int shift = num_bits<half_uint>() - bigit_bits;
@@ -2856,7 +2735,7 @@ class bigint {
 
   template <typename UInt, FMT_ENABLE_IF(std::is_same<UInt, uint64_t>::value ||
                                          std::is_same<UInt, uint128_t>::value)>
-  FMT_CONSTEXPR20 void assign(UInt n) {
+  FMT_CONSTEXPR void assign(UInt n) {
     size_t num_bigits = 0;
     do {
       bigits_[num_bigits++] = static_cast<bigit>(n);
@@ -2867,30 +2746,30 @@ class bigint {
   }
 
  public:
-  FMT_CONSTEXPR20 bigint() : exp_(0) {}
+  FMT_CONSTEXPR bigint() : exp_(0) {}
   explicit bigint(uint64_t n) { assign(n); }
 
   bigint(const bigint&) = delete;
   void operator=(const bigint&) = delete;
 
-  FMT_CONSTEXPR20 void assign(const bigint& other) {
+  FMT_CONSTEXPR void assign(const bigint& other) {
     auto size = other.bigits_.size();
     bigits_.resize(size);
     auto data = other.bigits_.data();
-    copy_str<bigit>(data, data + size, bigits_.data());
+    copy<bigit>(data, data + size, bigits_.data());
     exp_ = other.exp_;
   }
 
-  template <typename Int> FMT_CONSTEXPR20 void operator=(Int n) {
+  template <typename Int> FMT_CONSTEXPR void operator=(Int n) {
     FMT_ASSERT(n > 0, "");
     assign(uint64_or_128_t<Int>(n));
   }
 
-  FMT_CONSTEXPR20 auto num_bigits() const -> int {
+  FMT_CONSTEXPR auto num_bigits() const -> int {
     return static_cast<int>(bigits_.size()) + exp_;
   }
 
-  FMT_NOINLINE FMT_CONSTEXPR20 auto operator<<=(int shift) -> bigint& {
+  FMT_CONSTEXPR auto operator<<=(int shift) -> bigint& {
     FMT_ASSERT(shift >= 0, "");
     exp_ += shift / bigit_bits;
     shift %= bigit_bits;
@@ -2905,49 +2784,39 @@ class bigint {
     return *this;
   }
 
-  template <typename Int>
-  FMT_CONSTEXPR20 auto operator*=(Int value) -> bigint& {
+  template <typename Int> FMT_CONSTEXPR auto operator*=(Int value) -> bigint& {
     FMT_ASSERT(value > 0, "");
     multiply(uint32_or_64_or_128_t<Int>(value));
     return *this;
   }
 
-  friend FMT_CONSTEXPR20 auto compare(const bigint& lhs, const bigint& rhs)
-      -> int {
-    int num_lhs_bigits = lhs.num_bigits(), num_rhs_bigits = rhs.num_bigits();
-    if (num_lhs_bigits != num_rhs_bigits)
-      return num_lhs_bigits > num_rhs_bigits ? 1 : -1;
-    int i = static_cast<int>(lhs.bigits_.size()) - 1;
-    int j = static_cast<int>(rhs.bigits_.size()) - 1;
+  friend FMT_CONSTEXPR auto compare(const bigint& b1, const bigint& b2) -> int {
+    int num_bigits1 = b1.num_bigits(), num_bigits2 = b2.num_bigits();
+    if (num_bigits1 != num_bigits2) return num_bigits1 > num_bigits2 ? 1 : -1;
+    int i = static_cast<int>(b1.bigits_.size()) - 1;
+    int j = static_cast<int>(b2.bigits_.size()) - 1;
     int end = i - j;
     if (end < 0) end = 0;
     for (; i >= end; --i, --j) {
-      bigit lhs_bigit = lhs[i], rhs_bigit = rhs[j];
-      if (lhs_bigit != rhs_bigit) return lhs_bigit > rhs_bigit ? 1 : -1;
+      bigit b1_bigit = b1.bigits_[i], b2_bigit = b2.bigits_[j];
+      if (b1_bigit != b2_bigit) return b1_bigit > b2_bigit ? 1 : -1;
     }
     if (i != j) return i > j ? 1 : -1;
     return 0;
   }
 
   // Returns compare(lhs1 + lhs2, rhs).
-  friend FMT_CONSTEXPR20 auto add_compare(const bigint& lhs1,
-                                          const bigint& lhs2, const bigint& rhs)
-      -> int {
-    auto minimum = [](int a, int b) { return a < b ? a : b; };
-    auto maximum = [](int a, int b) { return a > b ? a : b; };
-    int max_lhs_bigits = maximum(lhs1.num_bigits(), lhs2.num_bigits());
+  friend FMT_CONSTEXPR auto add_compare(const bigint& lhs1, const bigint& lhs2,
+                                        const bigint& rhs) -> int {
+    int max_lhs_bigits = max_of(lhs1.num_bigits(), lhs2.num_bigits());
     int num_rhs_bigits = rhs.num_bigits();
     if (max_lhs_bigits + 1 < num_rhs_bigits) return -1;
     if (max_lhs_bigits > num_rhs_bigits) return 1;
-    auto get_bigit = [](const bigint& n, int i) -> bigit {
-      return i >= n.exp_ && i < n.num_bigits() ? n[i - n.exp_] : 0;
-    };
     double_bigit borrow = 0;
-    int min_exp = minimum(minimum(lhs1.exp_, lhs2.exp_), rhs.exp_);
+    int min_exp = min_of(min_of(lhs1.exp_, lhs2.exp_), rhs.exp_);
     for (int i = num_rhs_bigits - 1; i >= min_exp; --i) {
-      double_bigit sum =
-          static_cast<double_bigit>(get_bigit(lhs1, i)) + get_bigit(lhs2, i);
-      bigit rhs_bigit = get_bigit(rhs, i);
+      double_bigit sum = double_bigit(lhs1.get_bigit(i)) + lhs2.get_bigit(i);
+      bigit rhs_bigit = rhs.get_bigit(i);
       if (sum > rhs_bigit + borrow) return 1;
       borrow = rhs_bigit + borrow - sum;
       if (borrow > 1) return -1;
@@ -2960,10 +2829,8 @@ class bigint {
   FMT_CONSTEXPR20 void assign_pow10(int exp) {
     FMT_ASSERT(exp >= 0, "");
     if (exp == 0) return *this = 1;
-    // Find the top bit.
-    int bitmask = 1;
-    while (exp >= bitmask) bitmask <<= 1;
-    bitmask >>= 1;
+    int bitmask = 1 << (num_bits<unsigned>() -
+                        countl_zero(static_cast<uint32_t>(exp)) - 1);
     // pow(10, exp) = pow(5, exp) * pow(2, exp). First compute pow(5, exp) by
     // repeated squaring and multiplication.
     *this = 5;
@@ -2987,17 +2854,17 @@ class bigint {
       // cross-product terms n[i] * n[j] such that i + j == bigit_index.
       for (int i = 0, j = bigit_index; j >= 0; ++i, --j) {
         // Most terms are multiplied twice which can be optimized in the future.
-        sum += static_cast<double_bigit>(n[i]) * n[j];
+        sum += double_bigit(n[i]) * n[j];
       }
-      (*this)[bigit_index] = static_cast<bigit>(sum);
+      bigits_[bigit_index] = static_cast<bigit>(sum);
       sum >>= num_bits<bigit>();  // Compute the carry.
     }
     // Do the same for the top half.
     for (int bigit_index = num_bigits; bigit_index < num_result_bigits;
          ++bigit_index) {
       for (int j = num_bigits - 1, i = bigit_index - j; i < num_bigits;)
-        sum += static_cast<double_bigit>(n[i++]) * n[j--];
-      (*this)[bigit_index] = static_cast<bigit>(sum);
+        sum += double_bigit(n[i++]) * n[j--];
+      bigits_[bigit_index] = static_cast<bigit>(sum);
       sum >>= num_bits<bigit>();
     }
     remove_leading_zeros();
@@ -3006,20 +2873,20 @@ class bigint {
 
   // If this bigint has a bigger exponent than other, adds trailing zero to make
   // exponents equal. This simplifies some operations such as subtraction.
-  FMT_CONSTEXPR20 void align(const bigint& other) {
+  FMT_CONSTEXPR void align(const bigint& other) {
     int exp_difference = exp_ - other.exp_;
     if (exp_difference <= 0) return;
     int num_bigits = static_cast<int>(bigits_.size());
     bigits_.resize(to_unsigned(num_bigits + exp_difference));
     for (int i = num_bigits - 1, j = i + exp_difference; i >= 0; --i, --j)
       bigits_[j] = bigits_[i];
-    std::uninitialized_fill_n(bigits_.data(), exp_difference, 0u);
+    memset(bigits_.data(), 0, to_unsigned(exp_difference) * sizeof(bigit));
     exp_ -= exp_difference;
   }
 
   // Divides this bignum by divisor, assigning the remainder to this and
   // returning the quotient.
-  FMT_CONSTEXPR20 auto divmod_assign(const bigint& divisor) -> int {
+  FMT_CONSTEXPR auto divmod_assign(const bigint& divisor) -> int {
     FMT_ASSERT(this != &divisor, "");
     if (compare(*this, divisor) < 0) return 0;
     FMT_ASSERT(divisor.bigits_[divisor.bigits_.size() - 1u] != 0, "");
@@ -3138,8 +3005,11 @@ FMT_CONSTEXPR20 inline void format_dragon(basic_fp<uint128_t> value,
   // Generate the given number of digits.
   exp10 -= num_digits - 1;
   if (num_digits <= 0) {
-    denominator *= 10;
-    auto digit = add_compare(numerator, numerator, denominator) > 0 ? '1' : '0';
+    auto digit = '0';
+    if (num_digits == 0) {
+      denominator *= 10;
+      digit = add_compare(numerator, numerator, denominator) > 0 ? '1' : '0';
+    }
     buf.push_back(digit);
     return;
   }
@@ -3176,8 +3046,8 @@ FMT_CONSTEXPR20 inline void format_dragon(basic_fp<uint128_t> value,
 
 // Formats a floating-point number using the hexfloat format.
 template <typename Float, FMT_ENABLE_IF(!is_double_double<Float>::value)>
-FMT_CONSTEXPR20 void format_hexfloat(Float value, int precision,
-                                     float_specs specs, buffer<char>& buf) {
+FMT_CONSTEXPR20 void format_hexfloat(Float value, format_specs specs,
+                                     buffer<char>& buf) {
   // float is passed as double to reduce the number of instantiations and to
   // simplify implementation.
   static_assert(!std::is_same<Float, float>::value, "");
@@ -3187,26 +3057,25 @@ FMT_CONSTEXPR20 void format_hexfloat(Float value, int precision,
   // Assume Float is in the format [sign][exponent][significand].
   using carrier_uint = typename info::carrier_uint;
 
-  constexpr auto num_float_significand_bits =
-      detail::num_significand_bits<Float>();
+  const auto num_float_significand_bits = detail::num_significand_bits<Float>();
 
   basic_fp<carrier_uint> f(value);
   f.e += num_float_significand_bits;
   if (!has_implicit_bit<Float>()) --f.e;
 
-  constexpr auto num_fraction_bits =
+  const auto num_fraction_bits =
       num_float_significand_bits + (has_implicit_bit<Float>() ? 1 : 0);
-  constexpr auto num_xdigits = (num_fraction_bits + 3) / 4;
+  const auto num_xdigits = (num_fraction_bits + 3) / 4;
 
-  constexpr auto leading_shift = ((num_xdigits - 1) * 4);
+  const auto leading_shift = ((num_xdigits - 1) * 4);
   const auto leading_mask = carrier_uint(0xF) << leading_shift;
   const auto leading_xdigit =
       static_cast<uint32_t>((f.f & leading_mask) >> leading_shift);
   if (leading_xdigit > 1) f.e -= (32 - countl_zero(leading_xdigit) - 1);
 
   int print_xdigits = num_xdigits - 1;
-  if (precision >= 0 && print_xdigits > precision) {
-    const int shift = ((print_xdigits - precision - 1) * 4);
+  if (specs.precision >= 0 && print_xdigits > specs.precision) {
+    const int shift = ((print_xdigits - specs.precision - 1) * 4);
     const auto mask = carrier_uint(0xF) << shift;
     const auto v = static_cast<uint32_t>((f.f & mask) >> shift);
 
@@ -3225,25 +3094,25 @@ FMT_CONSTEXPR20 void format_hexfloat(Float value, int precision,
       }
     }
 
-    print_xdigits = precision;
+    print_xdigits = specs.precision;
   }
 
   char xdigits[num_bits<carrier_uint>() / 4];
   detail::fill_n(xdigits, sizeof(xdigits), '0');
-  format_uint<4>(xdigits, f.f, num_xdigits, specs.upper);
+  format_base2e(4, xdigits, f.f, num_xdigits, specs.upper());
 
   // Remove zero tail
   while (print_xdigits > 0 && xdigits[print_xdigits] == '0') --print_xdigits;
 
   buf.push_back('0');
-  buf.push_back(specs.upper ? 'X' : 'x');
+  buf.push_back(specs.upper() ? 'X' : 'x');
   buf.push_back(xdigits[0]);
-  if (specs.showpoint || print_xdigits > 0 || print_xdigits < precision)
+  if (specs.alt() || print_xdigits > 0 || print_xdigits < specs.precision)
     buf.push_back('.');
   buf.append(xdigits + 1, xdigits + 1 + print_xdigits);
-  for (; print_xdigits < precision; ++print_xdigits) buf.push_back('0');
+  for (; print_xdigits < specs.precision; ++print_xdigits) buf.push_back('0');
 
-  buf.push_back(specs.upper ? 'P' : 'p');
+  buf.push_back(specs.upper() ? 'P' : 'p');
 
   uint32_t abs_e;
   if (f.e < 0) {
@@ -3257,9 +3126,9 @@ FMT_CONSTEXPR20 void format_hexfloat(Float value, int precision,
 }
 
 template <typename Float, FMT_ENABLE_IF(is_double_double<Float>::value)>
-FMT_CONSTEXPR20 void format_hexfloat(Float value, int precision,
-                                     float_specs specs, buffer<char>& buf) {
-  format_hexfloat(static_cast<double>(value), precision, specs, buf);
+FMT_CONSTEXPR20 void format_hexfloat(Float value, format_specs specs,
+                                     buffer<char>& buf) {
+  format_hexfloat(static_cast<double>(value), specs, buf);
 }
 
 constexpr auto fractional_part_rounding_thresholds(int index) -> uint32_t {
@@ -3274,15 +3143,15 @@ constexpr auto fractional_part_rounding_thresholds(int index) -> uint32_t {
 }
 
 template <typename Float>
-FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
+FMT_CONSTEXPR20 auto format_float(Float value, int precision,
+                                  const format_specs& specs, bool binary32,
                                   buffer<char>& buf) -> int {
   // float is passed as double to reduce the number of instantiations.
   static_assert(!std::is_same<Float, float>::value, "");
-  FMT_ASSERT(value >= 0, "value is negative");
   auto converted_value = convert_float(value);
 
-  const bool fixed = specs.format == float_format::fixed;
-  if (value <= 0) {  // <= instead of == to silence a warning.
+  const bool fixed = specs.type() == presentation_type::fixed;
+  if (value == 0) {
     if (precision <= 0 || !fixed) {
       buf.push_back('0');
       return 0;
@@ -3307,16 +3176,6 @@ FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
     exp = static_cast<int>(e);
     if (e > exp) ++exp;  // Compute ceil.
     dragon_flags = dragon::fixup;
-  } else if (precision < 0) {
-    // Use Dragonbox for the shortest format.
-    if (specs.binary32) {
-      auto dec = dragonbox::to_decimal(static_cast<float>(value));
-      write<char>(buffer_appender<char>(buf), dec.significand);
-      return dec.exponent;
-    }
-    auto dec = dragonbox::to_decimal(static_cast<double>(value));
-    write<char>(buffer_appender<char>(buf), dec.significand);
-    return dec.exponent;
   } else {
     // Extract significand bits and exponent bits.
     using info = dragonbox::float_info<double>;
@@ -3415,7 +3274,7 @@ FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
         uint64_t prod;
         uint32_t digits;
         bool should_round_up;
-        int number_of_digits_to_print = precision > 9 ? 9 : precision;
+        int number_of_digits_to_print = min_of(precision, 9);
 
         // Print a 9-digits subsegment, either the first or the second.
         auto print_subsegment = [&](uint32_t subsegment, char* buffer) {
@@ -3443,7 +3302,7 @@ FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
             // for details.
             prod = ((subsegment * static_cast<uint64_t>(450359963)) >> 20) + 1;
             digits = static_cast<uint32_t>(prod >> 32);
-            copy2(buffer, digits2(digits));
+            write2digits(buffer, digits);
             number_of_digits_printed += 2;
           }
 
@@ -3451,7 +3310,7 @@ FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
           while (number_of_digits_printed < number_of_digits_to_print) {
             prod = static_cast<uint32_t>(prod) * static_cast<uint64_t>(100);
             digits = static_cast<uint32_t>(prod >> 32);
-            copy2(buffer + number_of_digits_printed, digits2(digits));
+            write2digits(buffer + number_of_digits_printed, digits);
             number_of_digits_printed += 2;
           }
         };
@@ -3560,9 +3419,8 @@ FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
   }
   if (use_dragon) {
     auto f = basic_fp<uint128_t>();
-    bool is_predecessor_closer = specs.binary32
-                                     ? f.assign(static_cast<float>(value))
-                                     : f.assign(converted_value);
+    bool is_predecessor_closer = binary32 ? f.assign(static_cast<float>(value))
+                                          : f.assign(converted_value);
     if (is_predecessor_closer) dragon_flags |= dragon::predecessor_closer;
     if (fixed) dragon_flags |= dragon::fixed;
     // Limit precision to the maximum possible number of significant digits in
@@ -3571,7 +3429,7 @@ FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
     if (precision > max_double_digits) precision = max_double_digits;
     format_dragon(f, dragon_flags, precision, buf, exp);
   }
-  if (!fixed && !specs.showpoint) {
+  if (!fixed && !specs.alt()) {
     // Remove trailing zeros.
     auto num_digits = buf.size();
     while (num_digits > 0 && buf[num_digits - 1] == '0') {
@@ -3582,97 +3440,97 @@ FMT_CONSTEXPR20 auto format_float(Float value, int precision, float_specs specs,
   }
   return exp;
 }
+
 template <typename Char, typename OutputIt, typename T>
-FMT_CONSTEXPR20 auto write_float(OutputIt out, T value,
-                                 format_specs<Char> specs, locale_ref loc)
-    -> OutputIt {
-  float_specs fspecs = parse_float_type_spec(specs);
-  fspecs.sign = specs.sign;
-  if (detail::signbit(value)) {  // value < 0 is false for NaN so use signbit.
-    fspecs.sign = sign::minus;
-    value = -value;
-  } else if (fspecs.sign == sign::minus) {
-    fspecs.sign = sign::none;
-  }
+FMT_CONSTEXPR20 auto write_float(OutputIt out, T value, format_specs specs,
+                                 locale_ref loc) -> OutputIt {
+  // Use signbit because value < 0 is false for NaN.
+  sign s = detail::signbit(value) ? sign::minus : specs.sign();
 
   if (!detail::isfinite(value))
-    return write_nonfinite(out, detail::isnan(value), specs, fspecs);
+    return write_nonfinite<Char>(out, detail::isnan(value), specs, s);
 
-  if (specs.align == align::numeric && fspecs.sign) {
-    auto it = reserve(out, 1);
-    *it++ = detail::sign<Char>(fspecs.sign);
-    out = base_iterator(out, it);
-    fspecs.sign = sign::none;
+  if (specs.align() == align::numeric && s != sign::none) {
+    *out++ = detail::getsign<Char>(s);
+    s = sign::none;
     if (specs.width != 0) --specs.width;
   }
 
+  int precision = specs.precision;
+  if (precision < 0) {
+    if (specs.type() != presentation_type::none) {
+      precision = 6;
+    } else if (is_fast_float<T>::value && !is_constant_evaluated()) {
+      // Use Dragonbox for the shortest format.
+      using floaty = conditional_t<sizeof(T) >= sizeof(double), double, float>;
+      auto dec = dragonbox::to_decimal(static_cast<floaty>(value));
+      return write_float<Char>(out, dec, specs, s, loc);
+    }
+  }
+
   memory_buffer buffer;
-  if (fspecs.format == float_format::hex) {
-    if (fspecs.sign) buffer.push_back(detail::sign<char>(fspecs.sign));
-    format_hexfloat(convert_float(value), specs.precision, fspecs, buffer);
-    return write_bytes<align::right>(out, {buffer.data(), buffer.size()},
-                                     specs);
-  }
-  int precision = specs.precision >= 0 || specs.type == presentation_type::none
-                      ? specs.precision
-                      : 6;
-  if (fspecs.format == float_format::exp) {
+  if (specs.type() == presentation_type::hexfloat) {
+    if (s != sign::none) buffer.push_back(detail::getsign<char>(s));
+    format_hexfloat(convert_float(value), specs, buffer);
+    return write_bytes<Char, align::right>(out, {buffer.data(), buffer.size()},
+                                           specs);
+  }
+
+  if (specs.type() == presentation_type::exp) {
     if (precision == max_value<int>())
-      throw_format_error("number is too big");
+      report_error("number is too big");
     else
       ++precision;
-  } else if (fspecs.format != float_format::fixed && precision == 0) {
+    if (specs.precision != 0) specs.set_alt();
+  } else if (specs.type() == presentation_type::fixed) {
+    if (specs.precision != 0) specs.set_alt();
+  } else if (precision == 0) {
     precision = 1;
   }
-  if (const_check(std::is_same<T, float>())) fspecs.binary32 = true;
-  int exp = format_float(convert_float(value), precision, fspecs, buffer);
-  fspecs.precision = precision;
+  int exp = format_float(convert_float(value), precision, specs,
+                         std::is_same<T, float>(), buffer);
+
+  specs.precision = precision;
   auto f = big_decimal_fp{buffer.data(), static_cast<int>(buffer.size()), exp};
-  return write_float(out, f, specs, fspecs, loc);
+  return write_float<Char>(out, f, specs, s, loc);
 }
 
 template <typename Char, typename OutputIt, typename T,
           FMT_ENABLE_IF(is_floating_point<T>::value)>
-FMT_CONSTEXPR20 auto write(OutputIt out, T value, format_specs<Char> specs,
+FMT_CONSTEXPR20 auto write(OutputIt out, T value, format_specs specs,
                            locale_ref loc = {}) -> OutputIt {
-  if (const_check(!is_supported_floating_point(value))) return out;
-  return specs.localized && write_loc(out, value, specs, loc)
+  return specs.localized() && write_loc(out, value, specs, loc)
              ? out
-             : write_float(out, value, specs, loc);
+             : write_float<Char>(out, value, specs, loc);
 }
 
 template <typename Char, typename OutputIt, typename T,
           FMT_ENABLE_IF(is_fast_float<T>::value)>
 FMT_CONSTEXPR20 auto write(OutputIt out, T value) -> OutputIt {
-  if (is_constant_evaluated()) return write(out, value, format_specs<Char>());
-  if (const_check(!is_supported_floating_point(value))) return out;
+  if (is_constant_evaluated()) return write<Char>(out, value, format_specs());
 
-  auto fspecs = float_specs();
-  if (detail::signbit(value)) {
-    fspecs.sign = sign::minus;
-    value = -value;
-  }
+  auto s = detail::signbit(value) ? sign::minus : sign::none;
 
-  constexpr auto specs = format_specs<Char>();
-  using floaty = conditional_t<std::is_same<T, long double>::value, double, T>;
+  constexpr auto specs = format_specs();
+  using floaty = conditional_t<sizeof(T) >= sizeof(double), double, float>;
   using floaty_uint = typename dragonbox::float_info<floaty>::carrier_uint;
   floaty_uint mask = exponent_mask<floaty>();
   if ((bit_cast<floaty_uint>(value) & mask) == mask)
-    return write_nonfinite(out, std::isnan(value), specs, fspecs);
+    return write_nonfinite<Char>(out, std::isnan(value), specs, s);
 
   auto dec = dragonbox::to_decimal(static_cast<floaty>(value));
-  return write_float(out, dec, specs, fspecs, {});
+  return write_float<Char>(out, dec, specs, s, {});
 }
 
 template <typename Char, typename OutputIt, typename T,
           FMT_ENABLE_IF(is_floating_point<T>::value &&
                         !is_fast_float<T>::value)>
 inline auto write(OutputIt out, T value) -> OutputIt {
-  return write(out, value, format_specs<Char>());
+  return write<Char>(out, value, format_specs());
 }
 
 template <typename Char, typename OutputIt>
-auto write(OutputIt out, monostate, format_specs<Char> = {}, locale_ref = {})
+auto write(OutputIt out, monostate, format_specs = {}, locale_ref = {})
     -> OutputIt {
   FMT_ASSERT(false, "");
   return out;
@@ -3681,13 +3539,11 @@ auto write(OutputIt out, monostate, format_specs<Char> = {}, locale_ref = {})
 template <typename Char, typename OutputIt>
 FMT_CONSTEXPR auto write(OutputIt out, basic_string_view<Char> value)
     -> OutputIt {
-  auto it = reserve(out, value.size());
-  it = copy_str_noinline<Char>(value.begin(), value.end(), it);
-  return base_iterator(out, it);
+  return copy_noinline<Char>(value.begin(), value.end(), out);
 }
 
 template <typename Char, typename OutputIt, typename T,
-          FMT_ENABLE_IF(is_string<T>::value)>
+          FMT_ENABLE_IF(has_to_string_view<T>::value)>
 constexpr auto write(OutputIt out, const T& value) -> OutputIt {
   return write<Char>(out, to_string_view(value));
 }
@@ -3695,10 +3551,8 @@ constexpr auto write(OutputIt out, const T& value) -> OutputIt {
 // FMT_ENABLE_IF() condition separated to workaround an MSVC bug.
 template <
     typename Char, typename OutputIt, typename T,
-    bool check =
-        std::is_enum<T>::value && !std::is_same<T, Char>::value &&
-        mapped_type_constant<T, basic_format_context<OutputIt, Char>>::value !=
-            type::custom_type,
+    bool check = std::is_enum<T>::value && !std::is_same<T, Char>::value &&
+                 mapped_type_constant<T, Char>::value != type::custom_type,
     FMT_ENABLE_IF(check)>
 FMT_CONSTEXPR auto write(OutputIt out, T value) -> OutputIt {
   return write<Char>(out, static_cast<underlying_t<T>>(value));
@@ -3706,13 +3560,12 @@ FMT_CONSTEXPR auto write(OutputIt out, T value) -> OutputIt {
 
 template <typename Char, typename OutputIt, typename T,
           FMT_ENABLE_IF(std::is_same<T, bool>::value)>
-FMT_CONSTEXPR auto write(OutputIt out, T value,
-                         const format_specs<Char>& specs = {}, locale_ref = {})
-    -> OutputIt {
-  return specs.type != presentation_type::none &&
-                 specs.type != presentation_type::string
-             ? write(out, value ? 1 : 0, specs, {})
-             : write_bytes(out, value ? "true" : "false", specs);
+FMT_CONSTEXPR auto write(OutputIt out, T value, const format_specs& specs = {},
+                         locale_ref = {}) -> OutputIt {
+  return specs.type() != presentation_type::none &&
+                 specs.type() != presentation_type::string
+             ? write<Char>(out, value ? 1 : 0, specs, {})
+             : write_bytes<Char>(out, value ? "true" : "false", specs);
 }
 
 template <typename Char, typename OutputIt>
@@ -3723,171 +3576,150 @@ FMT_CONSTEXPR auto write(OutputIt out, Char value) -> OutputIt {
 }
 
 template <typename Char, typename OutputIt>
-FMT_CONSTEXPR_CHAR_TRAITS auto write(OutputIt out, const Char* value)
-    -> OutputIt {
+FMT_CONSTEXPR20 auto write(OutputIt out, const Char* value) -> OutputIt {
   if (value) return write(out, basic_string_view<Char>(value));
-  throw_format_error("string pointer is null");
+  report_error("string pointer is null");
   return out;
 }
 
 template <typename Char, typename OutputIt, typename T,
           FMT_ENABLE_IF(std::is_same<T, void>::value)>
-auto write(OutputIt out, const T* value, const format_specs<Char>& specs = {},
+auto write(OutputIt out, const T* value, const format_specs& specs = {},
            locale_ref = {}) -> OutputIt {
   return write_ptr<Char>(out, bit_cast<uintptr_t>(value), &specs);
 }
 
-// A write overload that handles implicit conversions.
 template <typename Char, typename OutputIt, typename T,
-          typename Context = basic_format_context<OutputIt, Char>>
-FMT_CONSTEXPR auto write(OutputIt out, const T& value) -> enable_if_t<
-    std::is_class<T>::value && !is_string<T>::value &&
-        !is_floating_point<T>::value && !std::is_same<T, Char>::value &&
-        !std::is_same<T, remove_cvref_t<decltype(arg_mapper<Context>().map(
-                             value))>>::value,
-    OutputIt> {
-  return write<Char>(out, arg_mapper<Context>().map(value));
+          FMT_ENABLE_IF(mapped_type_constant<T, Char>::value ==
+                            type::custom_type &&
+                        !std::is_fundamental<T>::value)>
+FMT_CONSTEXPR auto write(OutputIt out, const T& value) -> OutputIt {
+  auto f = formatter<T, Char>();
+  auto parse_ctx = parse_context<Char>({});
+  f.parse(parse_ctx);
+  auto ctx = basic_format_context<OutputIt, Char>(out, {}, {});
+  return f.format(value, ctx);
 }
 
-template <typename Char, typename OutputIt, typename T,
-          typename Context = basic_format_context<OutputIt, Char>>
-FMT_CONSTEXPR auto write(OutputIt out, const T& value)
-    -> enable_if_t<mapped_type_constant<T, Context>::value == type::custom_type,
-                   OutputIt> {
-  auto formatter = typename Context::template formatter_type<T>();
-  auto parse_ctx = typename Context::parse_context_type({});
-  formatter.parse(parse_ctx);
-  auto ctx = Context(out, {}, {});
-  return formatter.format(value, ctx);
-}
+template <typename T>
+using is_builtin =
+    bool_constant<std::is_same<T, int>::value || FMT_BUILTIN_TYPES>;
 
 // An argument visitor that formats the argument and writes it via the output
 // iterator. It's a class and not a generic lambda for compatibility with C++11.
 template <typename Char> struct default_arg_formatter {
-  using iterator = buffer_appender<Char>;
-  using context = buffer_context<Char>;
+  using context = buffered_context<Char>;
+
+  basic_appender<Char> out;
+
+  void operator()(monostate) { report_error("argument not found"); }
 
-  iterator out;
-  basic_format_args<context> args;
-  locale_ref loc;
+  template <typename T, FMT_ENABLE_IF(is_builtin<T>::value)>
+  void operator()(T value) {
+    write<Char>(out, value);
+  }
 
-  template <typename T> auto operator()(T value) -> iterator {
-    return write<Char>(out, value);
+  template <typename T, FMT_ENABLE_IF(!is_builtin<T>::value)>
+  void operator()(T) {
+    FMT_ASSERT(false, "");
   }
-  auto operator()(typename basic_format_arg<context>::handle h) -> iterator {
-    basic_format_parse_context<Char> parse_ctx({});
-    context format_ctx(out, args, loc);
+
+  void operator()(typename basic_format_arg<context>::handle h) {
+    // Use a null locale since the default format must be unlocalized.
+    auto parse_ctx = parse_context<Char>({});
+    auto format_ctx = context(out, {}, {});
     h.format(parse_ctx, format_ctx);
-    return format_ctx.out();
   }
 };
 
 template <typename Char> struct arg_formatter {
-  using iterator = buffer_appender<Char>;
-  using context = buffer_context<Char>;
+  basic_appender<Char> out;
+  const format_specs& specs;
+  FMT_NO_UNIQUE_ADDRESS locale_ref locale;
 
-  iterator out;
-  const format_specs<Char>& specs;
-  locale_ref locale;
-
-  template <typename T>
-  FMT_CONSTEXPR FMT_INLINE auto operator()(T value) -> iterator {
-    return detail::write(out, value, specs, locale);
+  template <typename T, FMT_ENABLE_IF(is_builtin<T>::value)>
+  FMT_CONSTEXPR FMT_INLINE void operator()(T value) {
+    detail::write<Char>(out, value, specs, locale);
   }
-  auto operator()(typename basic_format_arg<context>::handle) -> iterator {
-    // User-defined types are handled separately because they require access
-    // to the parse context.
-    return out;
-  }
-};
 
-struct width_checker {
-  template <typename T, FMT_ENABLE_IF(is_integer<T>::value)>
-  FMT_CONSTEXPR auto operator()(T value) -> unsigned long long {
-    if (is_negative(value)) throw_format_error("negative width");
-    return static_cast<unsigned long long>(value);
+  template <typename T, FMT_ENABLE_IF(!is_builtin<T>::value)>
+  void operator()(T) {
+    FMT_ASSERT(false, "");
   }
 
-  template <typename T, FMT_ENABLE_IF(!is_integer<T>::value)>
-  FMT_CONSTEXPR auto operator()(T) -> unsigned long long {
-    throw_format_error("width is not integer");
-    return 0;
+  void operator()(typename basic_format_arg<buffered_context<Char>>::handle) {
+    // User-defined types are handled separately because they require access
+    // to the parse context.
   }
 };
 
-struct precision_checker {
+struct dynamic_spec_getter {
   template <typename T, FMT_ENABLE_IF(is_integer<T>::value)>
   FMT_CONSTEXPR auto operator()(T value) -> unsigned long long {
-    if (is_negative(value)) throw_format_error("negative precision");
-    return static_cast<unsigned long long>(value);
+    return is_negative(value) ? ~0ull : static_cast<unsigned long long>(value);
   }
 
   template <typename T, FMT_ENABLE_IF(!is_integer<T>::value)>
   FMT_CONSTEXPR auto operator()(T) -> unsigned long long {
-    throw_format_error("precision is not integer");
+    report_error("width/precision is not integer");
     return 0;
   }
 };
 
-template <typename Handler, typename FormatArg>
-FMT_CONSTEXPR auto get_dynamic_spec(FormatArg arg) -> int {
-  unsigned long long value = visit_format_arg(Handler(), arg);
-  if (value > to_unsigned(max_value<int>()))
-    throw_format_error("number is too big");
-  return static_cast<int>(value);
-}
-
 template <typename Context, typename ID>
-FMT_CONSTEXPR auto get_arg(Context& ctx, ID id) -> decltype(ctx.arg(id)) {
+FMT_CONSTEXPR auto get_arg(Context& ctx, ID id) -> basic_format_arg<Context> {
   auto arg = ctx.arg(id);
-  if (!arg) ctx.on_error("argument not found");
+  if (!arg) report_error("argument not found");
   return arg;
 }
 
-template <typename Handler, typename Context>
-FMT_CONSTEXPR void handle_dynamic_spec(int& value,
-                                       arg_ref<typename Context::char_type> ref,
-                                       Context& ctx) {
-  switch (ref.kind) {
-  case arg_id_kind::none:
-    break;
-  case arg_id_kind::index:
-    value = detail::get_dynamic_spec<Handler>(get_arg(ctx, ref.val.index));
-    break;
-  case arg_id_kind::name:
-    value = detail::get_dynamic_spec<Handler>(get_arg(ctx, ref.val.name));
-    break;
-  }
+template <typename Context>
+FMT_CONSTEXPR int get_dynamic_spec(
+    arg_id_kind kind, const arg_ref<typename Context::char_type>& ref,
+    Context& ctx) {
+  FMT_ASSERT(kind != arg_id_kind::none, "");
+  auto arg =
+      kind == arg_id_kind::index ? ctx.arg(ref.index) : ctx.arg(ref.name);
+  if (!arg) report_error("argument not found");
+  unsigned long long value = arg.visit(dynamic_spec_getter());
+  if (value > to_unsigned(max_value<int>()))
+    report_error("width/precision is out of range");
+  return static_cast<int>(value);
+}
+
+template <typename Context>
+FMT_CONSTEXPR void handle_dynamic_spec(
+    arg_id_kind kind, int& value,
+    const arg_ref<typename Context::char_type>& ref, Context& ctx) {
+  if (kind != arg_id_kind::none) value = get_dynamic_spec(kind, ref, ctx);
 }
 
-#if FMT_USE_USER_DEFINED_LITERALS
-#  if FMT_USE_NONTYPE_TEMPLATE_ARGS
+#if FMT_USE_NONTYPE_TEMPLATE_ARGS
 template <typename T, typename Char, size_t N,
-          fmt::detail_exported::fixed_string<Char, N> Str>
-struct statically_named_arg : view {
+          fmt::detail::fixed_string<Char, N> Str>
+struct static_named_arg : view {
   static constexpr auto name = Str.data;
 
   const T& value;
-  statically_named_arg(const T& v) : value(v) {}
+  static_named_arg(const T& v) : value(v) {}
 };
 
 template <typename T, typename Char, size_t N,
-          fmt::detail_exported::fixed_string<Char, N> Str>
-struct is_named_arg<statically_named_arg<T, Char, N, Str>> : std::true_type {};
+          fmt::detail::fixed_string<Char, N> Str>
+struct is_named_arg<static_named_arg<T, Char, N, Str>> : std::true_type {};
 
 template <typename T, typename Char, size_t N,
-          fmt::detail_exported::fixed_string<Char, N> Str>
-struct is_statically_named_arg<statically_named_arg<T, Char, N, Str>>
-    : std::true_type {};
+          fmt::detail::fixed_string<Char, N> Str>
+struct is_static_named_arg<static_named_arg<T, Char, N, Str>> : std::true_type {
+};
 
-template <typename Char, size_t N,
-          fmt::detail_exported::fixed_string<Char, N> Str>
+template <typename Char, size_t N, fmt::detail::fixed_string<Char, N> Str>
 struct udl_arg {
   template <typename T> auto operator=(T&& value) const {
-    return statically_named_arg<T, Char, N, Str>(std::forward<T>(value));
+    return static_named_arg<T, Char, N, Str>(std::forward<T>(value));
   }
 };
-#  else
+#else
 template <typename Char> struct udl_arg {
   const Char* str;
 
@@ -3895,149 +3727,103 @@ template <typename Char> struct udl_arg {
     return {str, std::forward<T>(value)};
   }
 };
-#  endif
-#endif  // FMT_USE_USER_DEFINED_LITERALS
-
-template <typename Locale, typename Char>
-auto vformat(const Locale& loc, basic_string_view<Char> fmt,
-             basic_format_args<buffer_context<type_identity_t<Char>>> args)
-    -> std::basic_string<Char> {
-  auto buf = basic_memory_buffer<Char>();
-  detail::vformat_to(buf, fmt, args, detail::locale_ref(loc));
-  return {buf.data(), buf.size()};
-}
-
-using format_func = void (*)(detail::buffer<char>&, int, const char*);
-
-FMT_API void format_error_code(buffer<char>& out, int error_code,
-                               string_view message) noexcept;
+#endif  // FMT_USE_NONTYPE_TEMPLATE_ARGS
 
-FMT_API void report_error(format_func func, int error_code,
-                          const char* message) noexcept;
-}  // namespace detail
+template <typename Char> struct format_handler {
+  parse_context<Char> parse_ctx;
+  buffered_context<Char> ctx;
 
-FMT_API auto vsystem_error(int error_code, string_view format_str,
-                           format_args args) -> std::system_error;
+  void on_text(const Char* begin, const Char* end) {
+    copy_noinline<Char>(begin, end, ctx.out());
+  }
 
-/**
-  \rst
-  Constructs :class:`std::system_error` with a message formatted with
-  ``fmt::format(fmt, args...)``.
-  *error_code* is a system error code as given by ``errno``.
-
-  **Example**::
-
-    // This throws std::system_error with the description
-    //   cannot open file 'madeup': No such file or directory
-    // or similar (system message may vary).
-    const char* filename = "madeup";
-    std::FILE* file = std::fopen(filename, "r");
-    if (!file)
-      throw fmt::system_error(errno, "cannot open file '{}'", filename);
-  \endrst
- */
-template <typename... T>
-auto system_error(int error_code, format_string<T...> fmt, T&&... args)
-    -> std::system_error {
-  return vsystem_error(error_code, fmt, fmt::make_format_args(args...));
-}
+  FMT_CONSTEXPR auto on_arg_id() -> int { return parse_ctx.next_arg_id(); }
+  FMT_CONSTEXPR auto on_arg_id(int id) -> int {
+    parse_ctx.check_arg_id(id);
+    return id;
+  }
+  FMT_CONSTEXPR auto on_arg_id(basic_string_view<Char> id) -> int {
+    parse_ctx.check_arg_id(id);
+    int arg_id = ctx.arg_id(id);
+    if (arg_id < 0) report_error("argument not found");
+    return arg_id;
+  }
 
-/**
-  \rst
-  Formats an error message for an error returned by an operating system or a
-  language runtime, for example a file opening error, and writes it to *out*.
-  The format is the same as the one used by ``std::system_error(ec, message)``
-  where ``ec`` is ``std::error_code(error_code, std::generic_category()})``.
-  It is implementation-defined but normally looks like:
-
-  .. parsed-literal::
-     *<message>*: *<system-message>*
-
-  where *<message>* is the passed message and *<system-message>* is the system
-  message corresponding to the error code.
-  *error_code* is a system error code as given by ``errno``.
-  \endrst
- */
-FMT_API void format_system_error(detail::buffer<char>& out, int error_code,
-                                 const char* message) noexcept;
+  FMT_INLINE void on_replacement_field(int id, const Char*) {
+    ctx.arg(id).visit(default_arg_formatter<Char>{ctx.out()});
+  }
 
-// Reports a system error without throwing an exception.
-// Can be used to report errors from destructors.
-FMT_API void report_system_error(int error_code, const char* message) noexcept;
+  auto on_format_specs(int id, const Char* begin, const Char* end)
+      -> const Char* {
+    auto arg = get_arg(ctx, id);
+    // Not using a visitor for custom types gives better codegen.
+    if (arg.format_custom(begin, parse_ctx, ctx)) return parse_ctx.begin();
 
-/** Fast integer formatter. */
-class format_int {
- private:
-  // Buffer should be large enough to hold all digits (digits10 + 1),
-  // a sign and a null character.
-  enum { buffer_size = std::numeric_limits<unsigned long long>::digits10 + 3 };
-  mutable char buffer_[buffer_size];
-  char* str_;
-
-  template <typename UInt> auto format_unsigned(UInt value) -> char* {
-    auto n = static_cast<detail::uint32_or_64_or_128_t<UInt>>(value);
-    return detail::format_decimal(buffer_, n, buffer_size - 1).begin;
-  }
+    auto specs = dynamic_format_specs<Char>();
+    begin = parse_format_specs(begin, end, specs, parse_ctx, arg.type());
+    if (specs.dynamic()) {
+      handle_dynamic_spec(specs.dynamic_width(), specs.width, specs.width_ref,
+                          ctx);
+      handle_dynamic_spec(specs.dynamic_precision(), specs.precision,
+                          specs.precision_ref, ctx);
+    }
 
-  template <typename Int> auto format_signed(Int value) -> char* {
-    auto abs_value = static_cast<detail::uint32_or_64_or_128_t<Int>>(value);
-    bool negative = value < 0;
-    if (negative) abs_value = 0 - abs_value;
-    auto begin = format_unsigned(abs_value);
-    if (negative) *--begin = '-';
+    arg.visit(arg_formatter<Char>{ctx.out(), specs, ctx.locale()});
     return begin;
   }
 
- public:
-  explicit format_int(int value) : str_(format_signed(value)) {}
-  explicit format_int(long value) : str_(format_signed(value)) {}
-  explicit format_int(long long value) : str_(format_signed(value)) {}
-  explicit format_int(unsigned value) : str_(format_unsigned(value)) {}
-  explicit format_int(unsigned long value) : str_(format_unsigned(value)) {}
-  explicit format_int(unsigned long long value)
-      : str_(format_unsigned(value)) {}
+  FMT_NORETURN void on_error(const char* message) { report_error(message); }
+};
 
-  /** Returns the number of characters written to the output buffer. */
-  auto size() const -> size_t {
-    return detail::to_unsigned(buffer_ - str_ + buffer_size - 1);
-  }
+using format_func = void (*)(detail::buffer<char>&, int, const char*);
+FMT_API void do_report_error(format_func func, int error_code,
+                             const char* message) noexcept;
 
-  /**
-    Returns a pointer to the output buffer content. No terminating null
-    character is appended.
-   */
-  auto data() const -> const char* { return str_; }
+FMT_API void format_error_code(buffer<char>& out, int error_code,
+                               string_view message) noexcept;
 
-  /**
-    Returns a pointer to the output buffer content with terminating null
-    character appended.
-   */
-  auto c_str() const -> const char* {
-    buffer_[buffer_size - 1] = '\0';
-    return str_;
-  }
+template <typename T, typename Char, type TYPE>
+template <typename FormatContext>
+FMT_CONSTEXPR auto native_formatter<T, Char, TYPE>::format(
+    const T& val, FormatContext& ctx) const -> decltype(ctx.out()) {
+  if (!specs_.dynamic())
+    return write<Char>(ctx.out(), val, specs_, ctx.locale());
+  auto specs = format_specs(specs_);
+  handle_dynamic_spec(specs.dynamic_width(), specs.width, specs_.width_ref,
+                      ctx);
+  handle_dynamic_spec(specs.dynamic_precision(), specs.precision,
+                      specs_.precision_ref, ctx);
+  return write<Char>(ctx.out(), val, specs, ctx.locale());
+}
 
-  /**
-    \rst
-    Returns the content of the output buffer as an ``std::string``.
-    \endrst
-   */
-  auto str() const -> std::string { return std::string(str_, size()); }
+// DEPRECATED!
+template <typename Char = char> struct vformat_args {
+  using type = basic_format_args<buffered_context<Char>>;
 };
-
-template <typename T, typename Char>
-struct formatter<T, Char, enable_if_t<detail::has_format_as<T>::value>>
-    : formatter<detail::format_as_t<T>, Char> {
-  template <typename FormatContext>
-  auto format(const T& value, FormatContext& ctx) const -> decltype(ctx.out()) {
-    using base = formatter<detail::format_as_t<T>, Char>;
-    return base::format(format_as(value), ctx);
-  }
+template <> struct vformat_args<char> {
+  using type = format_args;
 };
 
-#define FMT_FORMAT_AS(Type, Base) \
-  template <typename Char>        \
-  struct formatter<Type, Char> : formatter<Base, Char> {}
+template <typename Char>
+void vformat_to(buffer<Char>& buf, basic_string_view<Char> fmt,
+                typename vformat_args<Char>::type args, locale_ref loc = {}) {
+  auto out = basic_appender<Char>(buf);
+  parse_format_string(
+      fmt, format_handler<Char>{parse_context<Char>(fmt), {out, args, loc}});
+}
+}  // namespace detail
+
+FMT_BEGIN_EXPORT
+
+#define FMT_FORMAT_AS(Type, Base)                                   \
+  template <typename Char>                                          \
+  struct formatter<Type, Char> : formatter<Base, Char> {            \
+    template <typename FormatContext>                               \
+    FMT_CONSTEXPR auto format(Type value, FormatContext& ctx) const \
+        -> decltype(ctx.out()) {                                    \
+      return formatter<Base, Char>::format(value, ctx);             \
+    }                                                               \
+  }
 
 FMT_FORMAT_AS(signed char, int);
 FMT_FORMAT_AS(unsigned char, unsigned);
@@ -4046,44 +3832,58 @@ FMT_FORMAT_AS(unsigned short, unsigned);
 FMT_FORMAT_AS(long, detail::long_type);
 FMT_FORMAT_AS(unsigned long, detail::ulong_type);
 FMT_FORMAT_AS(Char*, const Char*);
-FMT_FORMAT_AS(std::basic_string<Char>, basic_string_view<Char>);
-FMT_FORMAT_AS(std::nullptr_t, const void*);
 FMT_FORMAT_AS(detail::std_string_view<Char>, basic_string_view<Char>);
+FMT_FORMAT_AS(std::nullptr_t, const void*);
 FMT_FORMAT_AS(void*, const void*);
 
 template <typename Char, size_t N>
 struct formatter<Char[N], Char> : formatter<basic_string_view<Char>, Char> {};
 
-/**
-  \rst
-  Converts ``p`` to ``const void*`` for pointer formatting.
+template <typename Char, typename Traits, typename Allocator>
+class formatter<std::basic_string<Char, Traits, Allocator>, Char>
+    : public formatter<basic_string_view<Char>, Char> {};
+
+template <int N, typename Char>
+struct formatter<detail::bitint<N>, Char> : formatter<long long, Char> {};
+template <int N, typename Char>
+struct formatter<detail::ubitint<N>, Char>
+    : formatter<unsigned long long, Char> {};
+
+template <typename Char>
+struct formatter<detail::float128, Char>
+    : detail::native_formatter<detail::float128, Char,
+                               detail::type::float_type> {};
 
-  **Example**::
+template <typename T, typename Char>
+struct formatter<T, Char, void_t<detail::format_as_result<T>>>
+    : formatter<detail::format_as_result<T>, Char> {
+  template <typename FormatContext>
+  FMT_CONSTEXPR auto format(const T& value, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    auto&& val = format_as(value);  // Make an lvalue reference for format.
+    return formatter<detail::format_as_result<T>, Char>::format(val, ctx);
+  }
+};
 
-    auto s = fmt::format("{}", fmt::ptr(p));
-  \endrst
+/**
+ * Converts `p` to `const void*` for pointer formatting.
+ *
+ * **Example**:
+ *
+ *     auto s = fmt::format("{}", fmt::ptr(p));
  */
 template <typename T> auto ptr(T p) -> const void* {
   static_assert(std::is_pointer<T>::value, "");
   return detail::bit_cast<const void*>(p);
 }
-template <typename T, typename Deleter>
-auto ptr(const std::unique_ptr<T, Deleter>& p) -> const void* {
-  return p.get();
-}
-template <typename T> auto ptr(const std::shared_ptr<T>& p) -> const void* {
-  return p.get();
-}
 
 /**
-  \rst
-  Converts ``e`` to the underlying type.
-
-  **Example**::
-
-    enum class color { red, green, blue };
-    auto s = fmt::format("{}", fmt::underlying(color::red));
-  \endrst
+ * Converts `e` to the underlying type.
+ *
+ * **Example**:
+ *
+ *     enum class color { red, green, blue };
+ *     auto s = fmt::format("{}", fmt::underlying(color::red));
  */
 template <typename Enum>
 constexpr auto underlying(Enum e) noexcept -> underlying_t<Enum> {
@@ -4097,13 +3897,22 @@ constexpr auto format_as(Enum e) noexcept -> underlying_t<Enum> {
 }
 }  // namespace enums
 
-class bytes {
- private:
-  string_view data_;
-  friend struct formatter<bytes>;
+#ifdef __cpp_lib_byte
+template <> struct formatter<std::byte> : formatter<unsigned> {
+  static auto format_as(std::byte b) -> unsigned char {
+    return static_cast<unsigned char>(b);
+  }
+  template <typename Context>
+  auto format(std::byte b, Context& ctx) const -> decltype(ctx.out()) {
+    return formatter<unsigned>::format(format_as(b), ctx);
+  }
+};
+#endif
 
- public:
-  explicit bytes(string_view data) : data_(data) {}
+struct bytes {
+  string_view data;
+
+  inline explicit bytes(string_view s) : data(s) {}
 };
 
 template <> struct formatter<bytes> {
@@ -4111,19 +3920,19 @@ template <> struct formatter<bytes> {
   detail::dynamic_format_specs<> specs_;
 
  public:
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> const char* {
+  FMT_CONSTEXPR auto parse(parse_context<>& ctx) -> const char* {
     return parse_format_specs(ctx.begin(), ctx.end(), specs_, ctx,
                               detail::type::string_type);
   }
 
   template <typename FormatContext>
-  auto format(bytes b, FormatContext& ctx) -> decltype(ctx.out()) {
-    detail::handle_dynamic_spec<detail::width_checker>(specs_.width,
-                                                       specs_.width_ref, ctx);
-    detail::handle_dynamic_spec<detail::precision_checker>(
-        specs_.precision, specs_.precision_ref, ctx);
-    return detail::write_bytes(ctx.out(), b.data_, specs_);
+  auto format(bytes b, FormatContext& ctx) const -> decltype(ctx.out()) {
+    auto specs = specs_;
+    detail::handle_dynamic_spec(specs.dynamic_width(), specs.width,
+                                specs.width_ref, ctx);
+    detail::handle_dynamic_spec(specs.dynamic_precision(), specs.precision,
+                                specs.precision_ref, ctx);
+    return detail::write_bytes<char>(ctx.out(), b.data, specs);
   }
 };
 
@@ -4133,15 +3942,13 @@ template <typename T> struct group_digits_view {
 };
 
 /**
-  \rst
-  Returns a view that formats an integer value using ',' as a locale-independent
-  thousands separator.
-
-  **Example**::
-
-    fmt::print("{}", fmt::group_digits(12345));
-    // Output: "12,345"
-  \endrst
+ * Returns a view that formats an integer value using ',' as a
+ * locale-independent thousands separator.
+ *
+ * **Example**:
+ *
+ *     fmt::print("{}", fmt::group_digits(12345));
+ *     // Output: "12,345"
  */
 template <typename T> auto group_digits(T value) -> group_digits_view<T> {
   return {value};
@@ -4152,383 +3959,332 @@ template <typename T> struct formatter<group_digits_view<T>> : formatter<T> {
   detail::dynamic_format_specs<> specs_;
 
  public:
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> const char* {
+  FMT_CONSTEXPR auto parse(parse_context<>& ctx) -> const char* {
     return parse_format_specs(ctx.begin(), ctx.end(), specs_, ctx,
                               detail::type::int_type);
   }
 
   template <typename FormatContext>
-  auto format(group_digits_view<T> t, FormatContext& ctx)
+  auto format(group_digits_view<T> t, FormatContext& ctx) const
       -> decltype(ctx.out()) {
-    detail::handle_dynamic_spec<detail::width_checker>(specs_.width,
-                                                       specs_.width_ref, ctx);
-    detail::handle_dynamic_spec<detail::precision_checker>(
-        specs_.precision, specs_.precision_ref, ctx);
+    auto specs = specs_;
+    detail::handle_dynamic_spec(specs.dynamic_width(), specs.width,
+                                specs.width_ref, ctx);
+    detail::handle_dynamic_spec(specs.dynamic_precision(), specs.precision,
+                                specs.precision_ref, ctx);
+    auto arg = detail::make_write_int_arg(t.value, specs.sign());
     return detail::write_int(
-        ctx.out(), static_cast<detail::uint64_or_128_t<T>>(t.value), 0, specs_,
-        detail::digit_grouping<char>("\3", ","));
+        ctx.out(), static_cast<detail::uint64_or_128_t<T>>(arg.abs_value),
+        arg.prefix, specs, detail::digit_grouping<char>("\3", ","));
   }
 };
 
-template <typename T> struct nested_view {
-  const formatter<T>* fmt;
+template <typename T, typename Char> struct nested_view {
+  const formatter<T, Char>* fmt;
   const T* value;
 };
 
-template <typename T> struct formatter<nested_view<T>> {
-  FMT_CONSTEXPR auto parse(format_parse_context& ctx) -> const char* {
+template <typename T, typename Char>
+struct formatter<nested_view<T, Char>, Char> {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     return ctx.begin();
   }
-  auto format(nested_view<T> view, format_context& ctx) const
+  template <typename FormatContext>
+  auto format(nested_view<T, Char> view, FormatContext& ctx) const
       -> decltype(ctx.out()) {
     return view.fmt->format(*view.value, ctx);
   }
 };
 
-template <typename T> struct nested_formatter {
+template <typename T, typename Char = char> struct nested_formatter {
  private:
+  basic_specs specs_;
   int width_;
-  detail::fill_t<char> fill_;
-  align_t align_ : 4;
-  formatter<T> formatter_;
+  formatter<T, Char> formatter_;
 
  public:
-  constexpr nested_formatter() : width_(0), align_(align_t::none) {}
-
-  FMT_CONSTEXPR auto parse(format_parse_context& ctx) -> const char* {
-    auto specs = detail::dynamic_format_specs<char>();
-    auto it = parse_format_specs(ctx.begin(), ctx.end(), specs, ctx,
-                                 detail::type::none_type);
-    width_ = specs.width;
-    fill_ = specs.fill;
-    align_ = specs.align;
+  constexpr nested_formatter() : width_(0) {}
+
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    auto it = ctx.begin(), end = ctx.end();
+    if (it == end) return it;
+    auto specs = format_specs();
+    it = detail::parse_align(it, end, specs);
+    specs_ = specs;
+    Char c = *it;
+    auto width_ref = detail::arg_ref<Char>();
+    if ((c >= '0' && c <= '9') || c == '{') {
+      it = detail::parse_width(it, end, specs, width_ref, ctx);
+      width_ = specs.width;
+    }
     ctx.advance_to(it);
     return formatter_.parse(ctx);
   }
 
-  template <typename F>
-  auto write_padded(format_context& ctx, F write) const -> decltype(ctx.out()) {
+  template <typename FormatContext, typename F>
+  auto write_padded(FormatContext& ctx, F write) const -> decltype(ctx.out()) {
     if (width_ == 0) return write(ctx.out());
-    auto buf = memory_buffer();
-    write(std::back_inserter(buf));
-    auto specs = format_specs<>();
+    auto buf = basic_memory_buffer<Char>();
+    write(basic_appender<Char>(buf));
+    auto specs = format_specs();
     specs.width = width_;
-    specs.fill = fill_;
-    specs.align = align_;
-    return detail::write(ctx.out(), string_view(buf.data(), buf.size()), specs);
-  }
-
-  auto nested(const T& value) const -> nested_view<T> {
-    return nested_view<T>{&formatter_, &value};
-  }
-};
-
-// DEPRECATED! join_view will be moved to ranges.h.
-template <typename It, typename Sentinel, typename Char = char>
-struct join_view : detail::view {
-  It begin;
-  Sentinel end;
-  basic_string_view<Char> sep;
-
-  join_view(It b, Sentinel e, basic_string_view<Char> s)
-      : begin(b), end(e), sep(s) {}
-};
-
-template <typename It, typename Sentinel, typename Char>
-struct formatter<join_view<It, Sentinel, Char>, Char> {
- private:
-  using value_type =
-#ifdef __cpp_lib_ranges
-      std::iter_value_t<It>;
-#else
-      typename std::iterator_traits<It>::value_type;
-#endif
-  formatter<remove_cvref_t<value_type>, Char> value_formatter_;
-
- public:
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> const Char* {
-    return value_formatter_.parse(ctx);
+    specs.set_fill(
+        basic_string_view<Char>(specs_.fill<Char>(), specs_.fill_size()));
+    specs.set_align(specs_.align());
+    return detail::write<Char>(
+        ctx.out(), basic_string_view<Char>(buf.data(), buf.size()), specs);
   }
 
-  template <typename FormatContext>
-  auto format(const join_view<It, Sentinel, Char>& value,
-              FormatContext& ctx) const -> decltype(ctx.out()) {
-    auto it = value.begin;
-    auto out = ctx.out();
-    if (it != value.end) {
-      out = value_formatter_.format(*it, ctx);
-      ++it;
-      while (it != value.end) {
-        out = detail::copy_str<Char>(value.sep.begin(), value.sep.end(), out);
-        ctx.advance_to(out);
-        out = value_formatter_.format(*it, ctx);
-        ++it;
-      }
-    }
-    return out;
+  auto nested(const T& value) const -> nested_view<T, Char> {
+    return nested_view<T, Char>{&formatter_, &value};
   }
 };
 
-/**
-  Returns a view that formats the iterator range `[begin, end)` with elements
-  separated by `sep`.
- */
-template <typename It, typename Sentinel>
-auto join(It begin, Sentinel end, string_view sep) -> join_view<It, Sentinel> {
-  return {begin, end, sep};
+inline namespace literals {
+#if FMT_USE_NONTYPE_TEMPLATE_ARGS
+template <detail::fixed_string Str> constexpr auto operator""_a() {
+  using char_t = remove_cvref_t<decltype(Str.data[0])>;
+  return detail::udl_arg<char_t, sizeof(Str.data) / sizeof(char_t), Str>();
 }
-
+#else
 /**
-  \rst
-  Returns a view that formats `range` with elements separated by `sep`.
-
-  **Example**::
-
-    std::vector<int> v = {1, 2, 3};
-    fmt::print("{}", fmt::join(v, ", "));
-    // Output: "1, 2, 3"
-
-  ``fmt::join`` applies passed format specifiers to the range elements::
-
-    fmt::print("{:02}", fmt::join(v, ", "));
-    // Output: "01, 02, 03"
-  \endrst
+ * User-defined literal equivalent of `fmt::arg`.
+ *
+ * **Example**:
+ *
+ *     using namespace fmt::literals;
+ *     fmt::print("The answer is {answer}.", "answer"_a=42);
  */
-template <typename Range>
-auto join(Range&& range, string_view sep)
-    -> join_view<detail::iterator_t<Range>, detail::sentinel_t<Range>> {
-  return join(std::begin(range), std::end(range), sep);
+constexpr auto operator""_a(const char* s, size_t) -> detail::udl_arg<char> {
+  return {s};
 }
+#endif  // FMT_USE_NONTYPE_TEMPLATE_ARGS
+}  // namespace literals
 
-/**
-  \rst
-  Converts *value* to ``std::string`` using the default format for type *T*.
-
-  **Example**::
-
-    #include <fmt/format.h>
-
-    std::string answer = fmt::to_string(42);
-  \endrst
- */
-template <typename T, FMT_ENABLE_IF(!std::is_integral<T>::value &&
-                                    !detail::has_format_as<T>::value)>
-inline auto to_string(const T& value) -> std::string {
-  auto buffer = memory_buffer();
-  detail::write<char>(appender(buffer), value);
-  return {buffer.data(), buffer.size()};
-}
+/// A fast integer formatter.
+class format_int {
+ private:
+  // Buffer should be large enough to hold all digits (digits10 + 1),
+  // a sign and a null character.
+  enum { buffer_size = std::numeric_limits<unsigned long long>::digits10 + 3 };
+  mutable char buffer_[buffer_size];
+  char* str_;
 
-template <typename T, FMT_ENABLE_IF(std::is_integral<T>::value)>
-FMT_NODISCARD inline auto to_string(T value) -> std::string {
-  // The buffer should be large enough to store the number including the sign
-  // or "false" for bool.
-  constexpr int max_size = detail::digits10<T>() + 2;
-  char buffer[max_size > 5 ? static_cast<unsigned>(max_size) : 5];
-  char* begin = buffer;
-  return std::string(begin, detail::write<char>(begin, value));
-}
+  template <typename UInt>
+  FMT_CONSTEXPR20 auto format_unsigned(UInt value) -> char* {
+    auto n = static_cast<detail::uint32_or_64_or_128_t<UInt>>(value);
+    return detail::do_format_decimal(buffer_, n, buffer_size - 1);
+  }
 
-template <typename Char, size_t SIZE>
-FMT_NODISCARD auto to_string(const basic_memory_buffer<Char, SIZE>& buf)
-    -> std::basic_string<Char> {
-  auto size = buf.size();
-  detail::assume(size < std::basic_string<Char>().max_size());
-  return std::basic_string<Char>(buf.data(), size);
-}
+  template <typename Int>
+  FMT_CONSTEXPR20 auto format_signed(Int value) -> char* {
+    auto abs_value = static_cast<detail::uint32_or_64_or_128_t<Int>>(value);
+    bool negative = value < 0;
+    if (negative) abs_value = 0 - abs_value;
+    auto begin = format_unsigned(abs_value);
+    if (negative) *--begin = '-';
+    return begin;
+  }
 
-template <typename T, FMT_ENABLE_IF(!std::is_integral<T>::value &&
-                                    detail::has_format_as<T>::value)>
-inline auto to_string(const T& value) -> std::string {
-  return to_string(format_as(value));
-}
+ public:
+  explicit FMT_CONSTEXPR20 format_int(int value) : str_(format_signed(value)) {}
+  explicit FMT_CONSTEXPR20 format_int(long value)
+      : str_(format_signed(value)) {}
+  explicit FMT_CONSTEXPR20 format_int(long long value)
+      : str_(format_signed(value)) {}
+  explicit FMT_CONSTEXPR20 format_int(unsigned value)
+      : str_(format_unsigned(value)) {}
+  explicit FMT_CONSTEXPR20 format_int(unsigned long value)
+      : str_(format_unsigned(value)) {}
+  explicit FMT_CONSTEXPR20 format_int(unsigned long long value)
+      : str_(format_unsigned(value)) {}
 
-FMT_END_EXPORT
+  /// Returns the number of characters written to the output buffer.
+  FMT_CONSTEXPR20 auto size() const -> size_t {
+    return detail::to_unsigned(buffer_ - str_ + buffer_size - 1);
+  }
 
-namespace detail {
+  /// Returns a pointer to the output buffer content. No terminating null
+  /// character is appended.
+  FMT_CONSTEXPR20 auto data() const -> const char* { return str_; }
 
-template <typename Char>
-void vformat_to(buffer<Char>& buf, basic_string_view<Char> fmt,
-                typename vformat_args<Char>::type args, locale_ref loc) {
-  auto out = buffer_appender<Char>(buf);
-  if (fmt.size() == 2 && equal2(fmt.data(), "{}")) {
-    auto arg = args.get(0);
-    if (!arg) throw_format_error("argument not found");
-    visit_format_arg(default_arg_formatter<Char>{out, args, loc}, arg);
-    return;
+  /// Returns a pointer to the output buffer content with terminating null
+  /// character appended.
+  FMT_CONSTEXPR20 auto c_str() const -> const char* {
+    buffer_[buffer_size - 1] = '\0';
+    return str_;
   }
 
-  struct format_handler : error_handler {
-    basic_format_parse_context<Char> parse_context;
-    buffer_context<Char> context;
-
-    format_handler(buffer_appender<Char> p_out, basic_string_view<Char> str,
-                   basic_format_args<buffer_context<Char>> p_args,
-                   locale_ref p_loc)
-        : parse_context(str), context(p_out, p_args, p_loc) {}
+  /// Returns the content of the output buffer as an `std::string`.
+  inline auto str() const -> std::string { return {str_, size()}; }
+};
 
-    void on_text(const Char* begin, const Char* end) {
-      auto text = basic_string_view<Char>(begin, to_unsigned(end - begin));
-      context.advance_to(write<Char>(context.out(), text));
-    }
+#define FMT_STRING_IMPL(s, base)                                           \
+  [] {                                                                     \
+    /* Use the hidden visibility as a workaround for a GCC bug (#1973). */ \
+    /* Use a macro-like name to avoid shadowing warnings. */               \
+    struct FMT_VISIBILITY("hidden") FMT_COMPILE_STRING : base {            \
+      using char_type = fmt::remove_cvref_t<decltype(s[0])>;               \
+      FMT_CONSTEXPR explicit operator fmt::basic_string_view<char_type>()  \
+          const {                                                          \
+        return fmt::detail::compile_string_to_view<char_type>(s);          \
+      }                                                                    \
+    };                                                                     \
+    using FMT_STRING_VIEW =                                                \
+        fmt::basic_string_view<typename FMT_COMPILE_STRING::char_type>;    \
+    fmt::detail::ignore_unused(FMT_STRING_VIEW(FMT_COMPILE_STRING()));     \
+    return FMT_COMPILE_STRING();                                           \
+  }()
 
-    FMT_CONSTEXPR auto on_arg_id() -> int {
-      return parse_context.next_arg_id();
-    }
-    FMT_CONSTEXPR auto on_arg_id(int id) -> int {
-      return parse_context.check_arg_id(id), id;
-    }
-    FMT_CONSTEXPR auto on_arg_id(basic_string_view<Char> id) -> int {
-      int arg_id = context.arg_id(id);
-      if (arg_id < 0) throw_format_error("argument not found");
-      return arg_id;
-    }
+/**
+ * Constructs a compile-time format string from a string literal `s`.
+ *
+ * **Example**:
+ *
+ *     // A compile-time error because 'd' is an invalid specifier for strings.
+ *     std::string s = fmt::format(FMT_STRING("{:d}"), "foo");
+ */
+#define FMT_STRING(s) FMT_STRING_IMPL(s, fmt::detail::compile_string)
 
-    FMT_INLINE void on_replacement_field(int id, const Char*) {
-      auto arg = get_arg(context, id);
-      context.advance_to(visit_format_arg(
-          default_arg_formatter<Char>{context.out(), context.args(),
-                                      context.locale()},
-          arg));
-    }
+FMT_API auto vsystem_error(int error_code, string_view fmt, format_args args)
+    -> std::system_error;
 
-    auto on_format_specs(int id, const Char* begin, const Char* end)
-        -> const Char* {
-      auto arg = get_arg(context, id);
-      // Not using a visitor for custom types gives better codegen.
-      if (arg.format_custom(begin, parse_context, context))
-        return parse_context.begin();
-      auto specs = detail::dynamic_format_specs<Char>();
-      begin = parse_format_specs(begin, end, specs, parse_context, arg.type());
-      detail::handle_dynamic_spec<detail::width_checker>(
-          specs.width, specs.width_ref, context);
-      detail::handle_dynamic_spec<detail::precision_checker>(
-          specs.precision, specs.precision_ref, context);
-      if (begin == end || *begin != '}')
-        throw_format_error("missing '}' in format string");
-      auto f = arg_formatter<Char>{context.out(), specs, context.locale()};
-      context.advance_to(visit_format_arg(f, arg));
-      return begin;
-    }
-  };
-  detail::parse_format_string<false>(fmt, format_handler(out, fmt, args, loc));
+/**
+ * Constructs `std::system_error` with a message formatted with
+ * `fmt::format(fmt, args...)`.
+ * `error_code` is a system error code as given by `errno`.
+ *
+ * **Example**:
+ *
+ *     // This throws std::system_error with the description
+ *     //   cannot open file 'madeup': No such file or directory
+ *     // or similar (system message may vary).
+ *     const char* filename = "madeup";
+ *     FILE* file = fopen(filename, "r");
+ *     if (!file)
+ *       throw fmt::system_error(errno, "cannot open file '{}'", filename);
+ */
+template <typename... T>
+auto system_error(int error_code, format_string<T...> fmt, T&&... args)
+    -> std::system_error {
+  return vsystem_error(error_code, fmt.str, vargs<T...>{{args...}});
 }
 
-FMT_BEGIN_EXPORT
-
-#ifndef FMT_HEADER_ONLY
-extern template FMT_API void vformat_to(buffer<char>&, string_view,
-                                        typename vformat_args<>::type,
-                                        locale_ref);
-extern template FMT_API auto thousands_sep_impl<char>(locale_ref)
-    -> thousands_sep_result<char>;
-extern template FMT_API auto thousands_sep_impl<wchar_t>(locale_ref)
-    -> thousands_sep_result<wchar_t>;
-extern template FMT_API auto decimal_point_impl(locale_ref) -> char;
-extern template FMT_API auto decimal_point_impl(locale_ref) -> wchar_t;
-#endif  // FMT_HEADER_ONLY
-
-}  // namespace detail
-
-#if FMT_USE_USER_DEFINED_LITERALS
-inline namespace literals {
 /**
-  \rst
-  User-defined literal equivalent of :func:`fmt::arg`.
-
-  **Example**::
-
-    using namespace fmt::literals;
-    fmt::print("Elapsed time: {s:.2f} seconds", "s"_a=1.23);
-  \endrst
+ * Formats an error message for an error returned by an operating system or a
+ * language runtime, for example a file opening error, and writes it to `out`.
+ * The format is the same as the one used by `std::system_error(ec, message)`
+ * where `ec` is `std::error_code(error_code, std::generic_category())`.
+ * It is implementation-defined but normally looks like:
+ *
+ *     <message>: <system-message>
+ *
+ * where `<message>` is the passed message and `<system-message>` is the system
+ * message corresponding to the error code.
+ * `error_code` is a system error code as given by `errno`.
  */
-#  if FMT_USE_NONTYPE_TEMPLATE_ARGS
-template <detail_exported::fixed_string Str> constexpr auto operator""_a() {
-  using char_t = remove_cvref_t<decltype(Str.data[0])>;
-  return detail::udl_arg<char_t, sizeof(Str.data) / sizeof(char_t), Str>();
-}
-#  else
-constexpr auto operator""_a(const char* s, size_t) -> detail::udl_arg<char> {
-  return {s};
-}
-#  endif
-}  // namespace literals
-#endif  // FMT_USE_USER_DEFINED_LITERALS
+FMT_API void format_system_error(detail::buffer<char>& out, int error_code,
+                                 const char* message) noexcept;
 
-template <typename Locale, FMT_ENABLE_IF(detail::is_locale<Locale>::value)>
-inline auto vformat(const Locale& loc, string_view fmt, format_args args)
+// Reports a system error without throwing an exception.
+// Can be used to report errors from destructors.
+FMT_API void report_system_error(int error_code, const char* message) noexcept;
+
+inline auto vformat(detail::locale_ref loc, string_view fmt, format_args args)
     -> std::string {
-  return detail::vformat(loc, fmt, args);
+  auto buf = memory_buffer();
+  detail::vformat_to(buf, fmt, args, loc);
+  return {buf.data(), buf.size()};
 }
 
-template <typename Locale, typename... T,
-          FMT_ENABLE_IF(detail::is_locale<Locale>::value)>
-inline auto format(const Locale& loc, format_string<T...> fmt, T&&... args)
-    -> std::string {
-  return fmt::vformat(loc, string_view(fmt), fmt::make_format_args(args...));
+template <typename... T>
+FMT_INLINE auto format(detail::locale_ref loc, format_string<T...> fmt,
+                       T&&... args) -> std::string {
+  return vformat(loc, fmt.str, vargs<T...>{{args...}});
 }
 
-template <typename OutputIt, typename Locale,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value&&
-                            detail::is_locale<Locale>::value)>
-auto vformat_to(OutputIt out, const Locale& loc, string_view fmt,
+template <typename OutputIt,
+          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
+auto vformat_to(OutputIt out, detail::locale_ref loc, string_view fmt,
                 format_args args) -> OutputIt {
-  using detail::get_buffer;
-  auto&& buf = get_buffer<char>(out);
-  detail::vformat_to(buf, fmt, args, detail::locale_ref(loc));
+  auto&& buf = detail::get_buffer<char>(out);
+  detail::vformat_to(buf, fmt, args, loc);
   return detail::get_iterator(buf, out);
 }
 
-template <typename OutputIt, typename Locale, typename... T,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value&&
-                            detail::is_locale<Locale>::value)>
-FMT_INLINE auto format_to(OutputIt out, const Locale& loc,
+template <typename OutputIt, typename... T,
+          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, char>::value)>
+FMT_INLINE auto format_to(OutputIt out, detail::locale_ref loc,
                           format_string<T...> fmt, T&&... args) -> OutputIt {
-  return vformat_to(out, loc, fmt, fmt::make_format_args(args...));
+  return fmt::vformat_to(out, loc, fmt.str, vargs<T...>{{args...}});
 }
 
-template <typename Locale, typename... T,
-          FMT_ENABLE_IF(detail::is_locale<Locale>::value)>
-FMT_NODISCARD FMT_INLINE auto formatted_size(const Locale& loc,
+template <typename... T>
+FMT_NODISCARD FMT_INLINE auto formatted_size(detail::locale_ref loc,
                                              format_string<T...> fmt,
                                              T&&... args) -> size_t {
   auto buf = detail::counting_buffer<>();
-  detail::vformat_to<char>(buf, fmt, fmt::make_format_args(args...),
-                           detail::locale_ref(loc));
+  detail::vformat_to(buf, fmt.str, vargs<T...>{{args...}}, loc);
   return buf.count();
 }
 
-FMT_END_EXPORT
+FMT_API auto vformat(string_view fmt, format_args args) -> std::string;
 
-template <typename T, typename Char>
-template <typename FormatContext>
-FMT_CONSTEXPR FMT_INLINE auto
-formatter<T, Char,
-          enable_if_t<detail::type_constant<T, Char>::value !=
-                      detail::type::custom_type>>::format(const T& val,
-                                                          FormatContext& ctx)
-    const -> decltype(ctx.out()) {
-  if (specs_.width_ref.kind == detail::arg_id_kind::none &&
-      specs_.precision_ref.kind == detail::arg_id_kind::none) {
-    return detail::write<Char>(ctx.out(), val, specs_, ctx.locale());
-  }
-  auto specs = specs_;
-  detail::handle_dynamic_spec<detail::width_checker>(specs.width,
-                                                     specs.width_ref, ctx);
-  detail::handle_dynamic_spec<detail::precision_checker>(
-      specs.precision, specs.precision_ref, ctx);
-  return detail::write<Char>(ctx.out(), val, specs, ctx.locale());
+/**
+ * Formats `args` according to specifications in `fmt` and returns the result
+ * as a string.
+ *
+ * **Example**:
+ *
+ *     #include <fmt/format.h>
+ *     std::string message = fmt::format("The answer is {}.", 42);
+ */
+template <typename... T>
+FMT_NODISCARD FMT_INLINE auto format(format_string<T...> fmt, T&&... args)
+    -> std::string {
+  return vformat(fmt.str, vargs<T...>{{args...}});
+}
+
+/**
+ * Converts `value` to `std::string` using the default format for type `T`.
+ *
+ * **Example**:
+ *
+ *     std::string answer = fmt::to_string(42);
+ */
+template <typename T, FMT_ENABLE_IF(std::is_integral<T>::value)>
+FMT_NODISCARD auto to_string(T value) -> std::string {
+  // The buffer should be large enough to store the number including the sign
+  // or "false" for bool.
+  char buffer[max_of(detail::digits10<T>() + 2, 5)];
+  char* begin = buffer;
+  return {buffer, detail::write<char>(begin, value)};
 }
 
+template <typename T, FMT_ENABLE_IF(detail::use_format_as<T>::value)>
+FMT_NODISCARD auto to_string(const T& value) -> std::string {
+  return to_string(format_as(value));
+}
+
+template <typename T, FMT_ENABLE_IF(!std::is_integral<T>::value &&
+                                    !detail::use_format_as<T>::value)>
+FMT_NODISCARD auto to_string(const T& value) -> std::string {
+  auto buffer = memory_buffer();
+  detail::write<char>(appender(buffer), value);
+  return {buffer.data(), buffer.size()};
+}
+
+FMT_END_EXPORT
 FMT_END_NAMESPACE
 
 #ifdef FMT_HEADER_ONLY
 #  define FMT_FUNC inline
 #  include "format-inl.h"
-#else
-#  define FMT_FUNC
+#endif
+
+// Restore _LIBCPP_REMOVE_TRANSITIVE_INCLUDES.
+#ifdef FMT_REMOVE_TRANSITIVE_INCLUDES
+#  undef _LIBCPP_REMOVE_TRANSITIVE_INCLUDES
 #endif
 
 #endif  // FMT_FORMAT_H_
diff --git a/include/fmt/os.h b/include/fmt/os.h
index 3c7b3ccb..b2cc5e4b 100644
--- a/include/fmt/os.h
+++ b/include/fmt/os.h
@@ -8,18 +8,18 @@
 #ifndef FMT_OS_H_
 #define FMT_OS_H_
 
-#include <cerrno>
-#include <cstddef>
-#include <cstdio>
-#include <system_error>  // std::system_error
-
 #include "format.h"
 
-#if defined __APPLE__ || defined(__FreeBSD__)
+#ifndef FMT_MODULE
+#  include <cerrno>
+#  include <cstddef>
+#  include <cstdio>
+#  include <system_error>  // std::system_error
+
 #  if FMT_HAS_INCLUDE(<xlocale.h>)
-#    include <xlocale.h>  // for LC_NUMERIC_MASK on OS X
+#    include <xlocale.h>  // LC_NUMERIC_MASK on macOS
 #  endif
-#endif
+#endif  // FMT_MODULE
 
 #ifndef FMT_USE_FCNTL
 // UWP doesn't provide _pipe.
@@ -77,46 +77,33 @@ FMT_BEGIN_NAMESPACE
 FMT_BEGIN_EXPORT
 
 /**
-  \rst
-  A reference to a null-terminated string. It can be constructed from a C
-  string or ``std::string``.
-
-  You can use one of the following type aliases for common character types:
-
-  +---------------+-----------------------------+
-  | Type          | Definition                  |
-  +===============+=============================+
-  | cstring_view  | basic_cstring_view<char>    |
-  +---------------+-----------------------------+
-  | wcstring_view | basic_cstring_view<wchar_t> |
-  +---------------+-----------------------------+
-
-  This class is most useful as a parameter type to allow passing
-  different types of strings to a function, for example::
-
-    template <typename... Args>
-    std::string format(cstring_view format_str, const Args & ... args);
-
-    format("{}", 42);
-    format(std::string("{}"), 42);
-  \endrst
+ * A reference to a null-terminated string. It can be constructed from a C
+ * string or `std::string`.
+ *
+ * You can use one of the following type aliases for common character types:
+ *
+ * +---------------+-----------------------------+
+ * | Type          | Definition                  |
+ * +===============+=============================+
+ * | cstring_view  | basic_cstring_view<char>    |
+ * +---------------+-----------------------------+
+ * | wcstring_view | basic_cstring_view<wchar_t> |
+ * +---------------+-----------------------------+
+ *
+ * This class is most useful as a parameter type for functions that wrap C APIs.
  */
 template <typename Char> class basic_cstring_view {
  private:
   const Char* data_;
 
  public:
-  /** Constructs a string reference object from a C string. */
+  /// Constructs a string reference object from a C string.
   basic_cstring_view(const Char* s) : data_(s) {}
 
-  /**
-    \rst
-    Constructs a string reference from an ``std::string`` object.
-    \endrst
-   */
+  /// Constructs a string reference from an `std::string` object.
   basic_cstring_view(const std::basic_string<Char>& s) : data_(s.c_str()) {}
 
-  /** Returns the pointer to a C string. */
+  /// Returns the pointer to a C string.
   auto c_str() const -> const Char* { return data_; }
 };
 
@@ -131,41 +118,38 @@ FMT_API void format_windows_error(buffer<char>& out, int error_code,
                                   const char* message) noexcept;
 }
 
-FMT_API std::system_error vwindows_error(int error_code, string_view format_str,
+FMT_API std::system_error vwindows_error(int error_code, string_view fmt,
                                          format_args args);
 
 /**
- \rst
- Constructs a :class:`std::system_error` object with the description
- of the form
-
- .. parsed-literal::
-   *<message>*: *<system-message>*
-
- where *<message>* is the formatted message and *<system-message>* is the
- system message corresponding to the error code.
- *error_code* is a Windows error code as given by ``GetLastError``.
- If *error_code* is not a valid error code such as -1, the system message
- will look like "error -1".
-
- **Example**::
-
-   // This throws a system_error with the description
-   //   cannot open file 'madeup': The system cannot find the file specified.
-   // or similar (system message may vary).
-   const char *filename = "madeup";
-   LPOFSTRUCT of = LPOFSTRUCT();
-   HFILE file = OpenFile(filename, &of, OF_READ);
-   if (file == HFILE_ERROR) {
-     throw fmt::windows_error(GetLastError(),
-                              "cannot open file '{}'", filename);
-   }
- \endrst
-*/
-template <typename... Args>
-std::system_error windows_error(int error_code, string_view message,
-                                const Args&... args) {
-  return vwindows_error(error_code, message, fmt::make_format_args(args...));
+ * Constructs a `std::system_error` object with the description of the form
+ *
+ *     <message>: <system-message>
+ *
+ * where `<message>` is the formatted message and `<system-message>` is the
+ * system message corresponding to the error code.
+ * `error_code` is a Windows error code as given by `GetLastError`.
+ * If `error_code` is not a valid error code such as -1, the system message
+ * will look like "error -1".
+ *
+ * **Example**:
+ *
+ *     // This throws a system_error with the description
+ *     //   cannot open file 'madeup': The system cannot find the file
+ * specified.
+ *     // or similar (system message may vary).
+ *     const char *filename = "madeup";
+ *     LPOFSTRUCT of = LPOFSTRUCT();
+ *     HFILE file = OpenFile(filename, &of, OF_READ);
+ *     if (file == HFILE_ERROR) {
+ *       throw fmt::windows_error(GetLastError(),
+ *                                "cannot open file '{}'", filename);
+ *     }
+ */
+template <typename... T>
+auto windows_error(int error_code, string_view message, const T&... args)
+    -> std::system_error {
+  return vwindows_error(error_code, message, vargs<T...>{{args...}});
 }
 
 // Reports a Windows error without throwing an exception.
@@ -180,8 +164,8 @@ inline auto system_category() noexcept -> const std::error_category& {
 // std::system is not available on some platforms such as iOS (#2248).
 #ifdef __OSX__
 template <typename S, typename... Args, typename Char = char_t<S>>
-void say(const S& format_str, Args&&... args) {
-  std::system(format("say \"{}\"", format(format_str, args...)).c_str());
+void say(const S& fmt, Args&&... args) {
+  std::system(format("say \"{}\"", format(fmt, args...)).c_str());
 }
 #endif
 
@@ -192,24 +176,24 @@ class buffered_file {
 
   friend class file;
 
-  explicit buffered_file(FILE* f) : file_(f) {}
+  inline explicit buffered_file(FILE* f) : file_(f) {}
 
  public:
   buffered_file(const buffered_file&) = delete;
   void operator=(const buffered_file&) = delete;
 
   // Constructs a buffered_file object which doesn't represent any file.
-  buffered_file() noexcept : file_(nullptr) {}
+  inline buffered_file() noexcept : file_(nullptr) {}
 
   // Destroys the object closing the file it represents if any.
   FMT_API ~buffered_file() noexcept;
 
  public:
-  buffered_file(buffered_file&& other) noexcept : file_(other.file_) {
+  inline buffered_file(buffered_file&& other) noexcept : file_(other.file_) {
     other.file_ = nullptr;
   }
 
-  auto operator=(buffered_file&& other) -> buffered_file& {
+  inline auto operator=(buffered_file&& other) -> buffered_file& {
     close();
     file_ = other.file_;
     other.file_ = nullptr;
@@ -223,21 +207,20 @@ class buffered_file {
   FMT_API void close();
 
   // Returns the pointer to a FILE object representing this file.
-  auto get() const noexcept -> FILE* { return file_; }
+  inline auto get() const noexcept -> FILE* { return file_; }
 
   FMT_API auto descriptor() const -> int;
 
-  void vprint(string_view format_str, format_args args) {
-    fmt::vprint(file_, format_str, args);
-  }
-
-  template <typename... Args>
-  inline void print(string_view format_str, const Args&... args) {
-    vprint(format_str, fmt::make_format_args(args...));
+  template <typename... T>
+  inline void print(string_view fmt, const T&... args) {
+    fmt::vargs<T...> vargs = {{args...}};
+    detail::is_locking<T...>() ? fmt::vprint_buffered(file_, fmt, vargs)
+                               : fmt::vprint(file_, fmt, vargs);
   }
 };
 
 #if FMT_USE_FCNTL
+
 // A file. Closed file is represented by a file object with descriptor -1.
 // Methods that are not declared with noexcept may throw
 // fmt::system_error in case of failure. Note that some errors such as
@@ -251,6 +234,8 @@ class FMT_API file {
   // Constructs a file object with a given descriptor.
   explicit file(int fd) : fd_(fd) {}
 
+  friend struct pipe;
+
  public:
   // Possible values for the oflag argument to the constructor.
   enum {
@@ -263,7 +248,7 @@ class FMT_API file {
   };
 
   // Constructs a file object which doesn't represent any file.
-  file() noexcept : fd_(-1) {}
+  inline file() noexcept : fd_(-1) {}
 
   // Opens a file and constructs a file object representing this file.
   file(cstring_view path, int oflag);
@@ -272,10 +257,10 @@ class FMT_API file {
   file(const file&) = delete;
   void operator=(const file&) = delete;
 
-  file(file&& other) noexcept : fd_(other.fd_) { other.fd_ = -1; }
+  inline file(file&& other) noexcept : fd_(other.fd_) { other.fd_ = -1; }
 
   // Move assignment is not noexcept because close may throw.
-  auto operator=(file&& other) -> file& {
+  inline auto operator=(file&& other) -> file& {
     close();
     fd_ = other.fd_;
     other.fd_ = -1;
@@ -286,7 +271,7 @@ class FMT_API file {
   ~file() noexcept;
 
   // Returns the file descriptor.
-  auto descriptor() const noexcept -> int { return fd_; }
+  inline auto descriptor() const noexcept -> int { return fd_; }
 
   // Closes the file.
   void close();
@@ -313,11 +298,6 @@ class FMT_API file {
   // necessary.
   void dup2(int fd, std::error_code& ec) noexcept;
 
-  // Creates a pipe setting up read_end and write_end file objects for reading
-  // and writing respectively.
-  // DEPRECATED! Taking files as out parameters is deprecated.
-  static void pipe(file& read_end, file& write_end);
-
   // Creates a buffered_file object associated with this file and detaches
   // this file object from the file.
   auto fdopen(const char* mode) -> buffered_file;
@@ -329,15 +309,24 @@ class FMT_API file {
 #  endif
 };
 
+struct FMT_API pipe {
+  file read_end;
+  file write_end;
+
+  // Creates a pipe setting up read_end and write_end file objects for reading
+  // and writing respectively.
+  pipe();
+};
+
 // Returns the memory page size.
 auto getpagesize() -> long;
 
 namespace detail {
 
 struct buffer_size {
-  buffer_size() = default;
+  constexpr buffer_size() = default;
   size_t value = 0;
-  auto operator=(size_t val) const -> buffer_size {
+  FMT_CONSTEXPR auto operator=(size_t val) const -> buffer_size {
     auto bs = buffer_size();
     bs.value = val;
     return bs;
@@ -348,7 +337,7 @@ struct ostream_params {
   int oflag = file::WRONLY | file::CREATE | file::TRUNC;
   size_t buffer_size = BUFSIZ > 32768 ? BUFSIZ : 32768;
 
-  ostream_params() {}
+  constexpr ostream_params() {}
 
   template <typename... T>
   ostream_params(T... params, int new_oflag) : ostream_params(params...) {
@@ -369,79 +358,62 @@ struct ostream_params {
 #  endif
 };
 
-class file_buffer final : public buffer<char> {
-  file file_;
-
-  FMT_API void grow(size_t) override;
-
- public:
-  FMT_API file_buffer(cstring_view path, const ostream_params& params);
-  FMT_API file_buffer(file_buffer&& other);
-  FMT_API ~file_buffer();
-
-  void flush() {
-    if (size() == 0) return;
-    file_.write(data(), size() * sizeof(data()[0]));
-    clear();
-  }
-
-  void close() {
-    flush();
-    file_.close();
-  }
-};
-
 }  // namespace detail
 
-// Added {} below to work around default constructor error known to
-// occur in Xcode versions 7.2.1 and 8.2.1.
-constexpr detail::buffer_size buffer_size{};
+FMT_INLINE_VARIABLE constexpr auto buffer_size = detail::buffer_size();
 
-/** A fast output stream which is not thread-safe. */
-class FMT_API ostream {
+/// A fast buffered output stream for writing from a single thread. Writing from
+/// multiple threads without external synchronization may result in a data race.
+class FMT_API ostream : private detail::buffer<char> {
  private:
-  FMT_MSC_WARNING(suppress : 4251)
-  detail::file_buffer buffer_;
+  file file_;
 
-  ostream(cstring_view path, const detail::ostream_params& params)
-      : buffer_(path, params) {}
+  ostream(cstring_view path, const detail::ostream_params& params);
 
- public:
-  ostream(ostream&& other) : buffer_(std::move(other.buffer_)) {}
+  static void grow(buffer<char>& buf, size_t);
 
+ public:
+  ostream(ostream&& other) noexcept;
   ~ostream();
 
-  void flush() { buffer_.flush(); }
+  operator writer() {
+    detail::buffer<char>& buf = *this;
+    return buf;
+  }
+
+  inline void flush() {
+    if (size() == 0) return;
+    file_.write(data(), size() * sizeof(data()[0]));
+    clear();
+  }
 
   template <typename... T>
   friend auto output_file(cstring_view path, T... params) -> ostream;
 
-  void close() { buffer_.close(); }
+  inline void close() {
+    flush();
+    file_.close();
+  }
 
-  /**
-    Formats ``args`` according to specifications in ``fmt`` and writes the
-    output to the file.
-   */
+  /// Formats `args` according to specifications in `fmt` and writes the
+  /// output to the file.
   template <typename... T> void print(format_string<T...> fmt, T&&... args) {
-    vformat_to(std::back_inserter(buffer_), fmt,
-               fmt::make_format_args(args...));
+    vformat_to(appender(*this), fmt.str, vargs<T...>{{args...}});
   }
 };
 
 /**
-  \rst
-  Opens a file for writing. Supported parameters passed in *params*:
-
-  * ``<integer>``: Flags passed to `open
-    <https://pubs.opengroup.org/onlinepubs/007904875/functions/open.html>`_
-    (``file::WRONLY | file::CREATE | file::TRUNC`` by default)
-  * ``buffer_size=<integer>``: Output buffer size
-
-  **Example**::
-
-    auto out = fmt::output_file("guide.txt");
-    out.print("Don't {}", "Panic");
-  \endrst
+ * Opens a file for writing. Supported parameters passed in `params`:
+ *
+ * - `<integer>`: Flags passed to [open](
+ *   https://pubs.opengroup.org/onlinepubs/007904875/functions/open.html)
+ *   (`file::WRONLY | file::CREATE | file::TRUNC` by default)
+ * - `buffer_size=<integer>`: Output buffer size
+ *
+ * **Example**:
+ *
+ *     auto out = fmt::output_file("guide.txt");
+ *     out.print("Don't {}", "Panic");
  */
 template <typename... T>
 inline auto output_file(cstring_view path, T... params) -> ostream {
diff --git a/include/fmt/ostream.h b/include/fmt/ostream.h
index 26fb3b5a..114b8c29 100644
--- a/include/fmt/ostream.h
+++ b/include/fmt/ostream.h
@@ -8,7 +8,9 @@
 #ifndef FMT_OSTREAM_H_
 #define FMT_OSTREAM_H_
 
-#include <fstream>  // std::filebuf
+#ifndef FMT_MODULE
+#  include <fstream>  // std::filebuf
+#endif
 
 #ifdef _WIN32
 #  ifdef __GLIBCXX__
@@ -18,42 +20,11 @@
 #  include <io.h>
 #endif
 
-#include "format.h"
+#include "chrono.h"  // formatbuf
 
 FMT_BEGIN_NAMESPACE
 namespace detail {
 
-template <typename Streambuf> class formatbuf : public Streambuf {
- private:
-  using char_type = typename Streambuf::char_type;
-  using streamsize = decltype(std::declval<Streambuf>().sputn(nullptr, 0));
-  using int_type = typename Streambuf::int_type;
-  using traits_type = typename Streambuf::traits_type;
-
-  buffer<char_type>& buffer_;
-
- public:
-  explicit formatbuf(buffer<char_type>& buf) : buffer_(buf) {}
-
- protected:
-  // The put area is always empty. This makes the implementation simpler and has
-  // the advantage that the streambuf and the buffer are always in sync and
-  // sputc never writes into uninitialized memory. A disadvantage is that each
-  // call to sputc always results in a (virtual) call to overflow. There is no
-  // disadvantage here for sputn since this always results in a call to xsputn.
-
-  auto overflow(int_type ch) -> int_type override {
-    if (!traits_type::eq_int_type(ch, traits_type::eof()))
-      buffer_.push_back(static_cast<char_type>(ch));
-    return ch;
-  }
-
-  auto xsputn(const char_type* s, streamsize count) -> streamsize override {
-    buffer_.append(s, s + count);
-    return count;
-  }
-};
-
 // Generate a unique explicit instantion in every translation unit using a tag
 // type in an anonymous namespace.
 namespace {
@@ -70,47 +41,12 @@ template class file_access<file_access_tag, std::filebuf,
 auto get_file(std::filebuf&) -> FILE*;
 #endif
 
-inline auto write_ostream_unicode(std::ostream& os, fmt::string_view data)
-    -> bool {
-  FILE* f = nullptr;
-#if FMT_MSC_VERSION
-  if (auto* buf = dynamic_cast<std::filebuf*>(os.rdbuf()))
-    f = get_file(*buf);
-  else
-    return false;
-#elif defined(_WIN32) && defined(__GLIBCXX__)
-  auto* rdbuf = os.rdbuf();
-  if (auto* sfbuf = dynamic_cast<__gnu_cxx::stdio_sync_filebuf<char>*>(rdbuf))
-    f = sfbuf->file();
-  else if (auto* fbuf = dynamic_cast<__gnu_cxx::stdio_filebuf<char>*>(rdbuf))
-    f = fbuf->file();
-  else
-    return false;
-#else
-  ignore_unused(os, data, f);
-#endif
-#ifdef _WIN32
-  if (f) {
-    int fd = _fileno(f);
-    if (_isatty(fd)) {
-      os.flush();
-      return write_console(fd, data);
-    }
-  }
-#endif
-  return false;
-}
-inline auto write_ostream_unicode(std::wostream&,
-                                  fmt::basic_string_view<wchar_t>) -> bool {
-  return false;
-}
-
 // Write the content of buf to os.
 // It is a separate function rather than a part of vprint to simplify testing.
 template <typename Char>
 void write_buffer(std::basic_ostream<Char>& os, buffer<Char>& buf) {
   const Char* buf_data = buf.data();
-  using unsigned_streamsize = std::make_unsigned<std::streamsize>::type;
+  using unsigned_streamsize = make_unsigned_t<std::streamsize>;
   unsigned_streamsize size = buf.size();
   unsigned_streamsize max_size = to_unsigned(max_value<std::streamsize>());
   do {
@@ -121,21 +57,9 @@ void write_buffer(std::basic_ostream<Char>& os, buffer<Char>& buf) {
   } while (size != 0);
 }
 
-template <typename Char, typename T>
-void format_value(buffer<Char>& buf, const T& value) {
-  auto&& format_buf = formatbuf<std::basic_streambuf<Char>>(buf);
-  auto&& output = std::basic_ostream<Char>(&format_buf);
-#if !defined(FMT_STATIC_THOUSANDS_SEPARATOR)
-  output.imbue(std::locale::classic());  // The default is always unlocalized.
-#endif
-  output << value;
-  output.exceptions(std::ios_base::failbit | std::ios_base::badbit);
-}
-
 template <typename T> struct streamed_view {
   const T& value;
 };
-
 }  // namespace detail
 
 // Formats an object of type T that has an overloaded ostream operator<<.
@@ -143,11 +67,14 @@ template <typename Char>
 struct basic_ostream_formatter : formatter<basic_string_view<Char>, Char> {
   void set_debug_format() = delete;
 
-  template <typename T, typename OutputIt>
-  auto format(const T& value, basic_format_context<OutputIt, Char>& ctx) const
-      -> OutputIt {
+  template <typename T, typename Context>
+  auto format(const T& value, Context& ctx) const -> decltype(ctx.out()) {
     auto buffer = basic_memory_buffer<Char>();
-    detail::format_value(buffer, value);
+    auto&& formatbuf = detail::formatbuf<std::basic_streambuf<Char>>(buffer);
+    auto&& output = std::basic_ostream<Char>(&formatbuf);
+    output.imbue(std::locale::classic());  // The default is always unlocalized.
+    output << value;
+    output.exceptions(std::ios_base::failbit | std::ios_base::badbit);
     return formatter<basic_string_view<Char>, Char>::format(
         {buffer.data(), buffer.size()}, ctx);
   }
@@ -158,73 +85,67 @@ using ostream_formatter = basic_ostream_formatter<char>;
 template <typename T, typename Char>
 struct formatter<detail::streamed_view<T>, Char>
     : basic_ostream_formatter<Char> {
-  template <typename OutputIt>
-  auto format(detail::streamed_view<T> view,
-              basic_format_context<OutputIt, Char>& ctx) const -> OutputIt {
+  template <typename Context>
+  auto format(detail::streamed_view<T> view, Context& ctx) const
+      -> decltype(ctx.out()) {
     return basic_ostream_formatter<Char>::format(view.value, ctx);
   }
 };
 
 /**
-  \rst
-  Returns a view that formats `value` via an ostream ``operator<<``.
-
-  **Example**::
-
-    fmt::print("Current thread id: {}\n",
-               fmt::streamed(std::this_thread::get_id()));
-  \endrst
+ * Returns a view that formats `value` via an ostream `operator<<`.
+ *
+ * **Example**:
+ *
+ *     fmt::print("Current thread id: {}\n",
+ *                fmt::streamed(std::this_thread::get_id()));
  */
 template <typename T>
 constexpr auto streamed(const T& value) -> detail::streamed_view<T> {
   return {value};
 }
 
-namespace detail {
-
-inline void vprint_directly(std::ostream& os, string_view format_str,
-                            format_args args) {
+inline void vprint(std::ostream& os, string_view fmt, format_args args) {
   auto buffer = memory_buffer();
-  detail::vformat_to(buffer, format_str, args);
-  detail::write_buffer(os, buffer);
-}
-
-}  // namespace detail
-
-FMT_EXPORT template <typename Char>
-void vprint(std::basic_ostream<Char>& os,
-            basic_string_view<type_identity_t<Char>> format_str,
-            basic_format_args<buffer_context<type_identity_t<Char>>> args) {
-  auto buffer = basic_memory_buffer<Char>();
-  detail::vformat_to(buffer, format_str, args);
-  if (detail::write_ostream_unicode(os, {buffer.data(), buffer.size()})) return;
+  detail::vformat_to(buffer, fmt, args);
+  FILE* f = nullptr;
+#if FMT_MSC_VERSION && FMT_USE_RTTI
+  if (auto* buf = dynamic_cast<std::filebuf*>(os.rdbuf()))
+    f = detail::get_file(*buf);
+#elif defined(_WIN32) && defined(__GLIBCXX__) && FMT_USE_RTTI
+  auto* rdbuf = os.rdbuf();
+  if (auto* sfbuf = dynamic_cast<__gnu_cxx::stdio_sync_filebuf<char>*>(rdbuf))
+    f = sfbuf->file();
+  else if (auto* fbuf = dynamic_cast<__gnu_cxx::stdio_filebuf<char>*>(rdbuf))
+    f = fbuf->file();
+#endif
+#ifdef _WIN32
+  if (f) {
+    int fd = _fileno(f);
+    if (_isatty(fd)) {
+      os.flush();
+      if (detail::write_console(fd, {buffer.data(), buffer.size()})) return;
+    }
+  }
+#endif
+  detail::ignore_unused(f);
   detail::write_buffer(os, buffer);
 }
 
 /**
-  \rst
-  Prints formatted data to the stream *os*.
-
-  **Example**::
-
-    fmt::print(cerr, "Don't {}!", "panic");
-  \endrst
+ * Prints formatted data to the stream `os`.
+ *
+ * **Example**:
+ *
+ *     fmt::print(cerr, "Don't {}!", "panic");
  */
 FMT_EXPORT template <typename... T>
 void print(std::ostream& os, format_string<T...> fmt, T&&... args) {
-  const auto& vargs = fmt::make_format_args(args...);
-  if (detail::is_utf8())
-    vprint(os, fmt, vargs);
-  else
-    detail::vprint_directly(os, fmt, vargs);
-}
-
-FMT_EXPORT
-template <typename... Args>
-void print(std::wostream& os,
-           basic_format_string<wchar_t, type_identity_t<Args>...> fmt,
-           Args&&... args) {
-  vprint(os, fmt, fmt::make_format_args<buffer_context<wchar_t>>(args...));
+  fmt::vargs<T...> vargs = {{args...}};
+  if (detail::use_utf8) return vprint(os, fmt.str, vargs);
+  auto buffer = memory_buffer();
+  detail::vformat_to(buffer, fmt.str, vargs);
+  detail::write_buffer(os, buffer);
 }
 
 FMT_EXPORT template <typename... T>
@@ -232,14 +153,6 @@ void println(std::ostream& os, format_string<T...> fmt, T&&... args) {
   fmt::print(os, "{}\n", fmt::format(fmt, std::forward<T>(args)...));
 }
 
-FMT_EXPORT
-template <typename... Args>
-void println(std::wostream& os,
-             basic_format_string<wchar_t, type_identity_t<Args>...> fmt,
-             Args&&... args) {
-  print(os, L"{}\n", fmt::format(fmt, std::forward<Args>(args)...));
-}
-
 FMT_END_NAMESPACE
 
 #endif  // FMT_OSTREAM_H_
diff --git a/include/fmt/printf.h b/include/fmt/printf.h
index 07e81577..e7268401 100644
--- a/include/fmt/printf.h
+++ b/include/fmt/printf.h
@@ -8,8 +8,10 @@
 #ifndef FMT_PRINTF_H_
 #define FMT_PRINTF_H_
 
-#include <algorithm>  // std::max
-#include <limits>     // std::numeric_limits
+#ifndef FMT_MODULE
+#  include <algorithm>  // std::max
+#  include <limits>     // std::numeric_limits
+#endif
 
 #include "format.h"
 
@@ -22,7 +24,7 @@ template <typename T> struct printf_formatter {
 
 template <typename Char> class basic_printf_context {
  private:
-  detail::buffer_appender<Char> out_;
+  basic_appender<Char> out_;
   basic_format_args<basic_printf_context> args_;
 
   static_assert(std::is_same<Char, char>::value ||
@@ -31,43 +33,53 @@ template <typename Char> class basic_printf_context {
 
  public:
   using char_type = Char;
-  using parse_context_type = basic_format_parse_context<Char>;
+  using parse_context_type = parse_context<Char>;
   template <typename T> using formatter_type = printf_formatter<T>;
+  enum { builtin_types = 1 };
 
-  /**
-    \rst
-    Constructs a ``printf_context`` object. References to the arguments are
-    stored in the context object so make sure they have appropriate lifetimes.
-    \endrst
-   */
-  basic_printf_context(detail::buffer_appender<Char> out,
+  /// Constructs a `printf_context` object. References to the arguments are
+  /// stored in the context object so make sure they have appropriate lifetimes.
+  basic_printf_context(basic_appender<Char> out,
                        basic_format_args<basic_printf_context> args)
       : out_(out), args_(args) {}
 
-  auto out() -> detail::buffer_appender<Char> { return out_; }
-  void advance_to(detail::buffer_appender<Char>) {}
+  auto out() -> basic_appender<Char> { return out_; }
+  void advance_to(basic_appender<Char>) {}
 
   auto locale() -> detail::locale_ref { return {}; }
 
   auto arg(int id) const -> basic_format_arg<basic_printf_context> {
     return args_.get(id);
   }
-
-  FMT_CONSTEXPR void on_error(const char* message) {
-    detail::error_handler().on_error(message);
-  }
 };
 
 namespace detail {
 
+// Return the result via the out param to workaround gcc bug 77539.
+template <bool IS_CONSTEXPR, typename T, typename Ptr = const T*>
+FMT_CONSTEXPR auto find(Ptr first, Ptr last, T value, Ptr& out) -> bool {
+  for (out = first; out != last; ++out) {
+    if (*out == value) return true;
+  }
+  return false;
+}
+
+template <>
+inline auto find<false, char>(const char* first, const char* last, char value,
+                              const char*& out) -> bool {
+  out =
+      static_cast<const char*>(memchr(first, value, to_unsigned(last - first)));
+  return out != nullptr;
+}
+
 // Checks if a value fits in int - used to avoid warnings about comparing
 // signed and unsigned integers.
 template <bool IsSigned> struct int_checker {
   template <typename T> static auto fits_in_int(T value) -> bool {
-    unsigned max = max_value<int>();
+    unsigned max = to_unsigned(max_value<int>());
     return value <= max;
   }
-  static auto fits_in_int(bool) -> bool { return true; }
+  inline static auto fits_in_int(bool) -> bool { return true; }
 };
 
 template <> struct int_checker<true> {
@@ -75,20 +87,20 @@ template <> struct int_checker<true> {
     return value >= (std::numeric_limits<int>::min)() &&
            value <= max_value<int>();
   }
-  static auto fits_in_int(int) -> bool { return true; }
+  inline static auto fits_in_int(int) -> bool { return true; }
 };
 
 struct printf_precision_handler {
   template <typename T, FMT_ENABLE_IF(std::is_integral<T>::value)>
   auto operator()(T value) -> int {
     if (!int_checker<std::numeric_limits<T>::is_signed>::fits_in_int(value))
-      throw_format_error("number is too big");
+      report_error("number is too big");
     return (std::max)(static_cast<int>(value), 0);
   }
 
   template <typename T, FMT_ENABLE_IF(!std::is_integral<T>::value)>
   auto operator()(T) -> int {
-    throw_format_error("precision is not integer");
+    report_error("precision is not integer");
     return 0;
   }
 };
@@ -133,25 +145,19 @@ template <typename T, typename Context> class arg_converter {
     using target_type = conditional_t<std::is_same<T, void>::value, U, T>;
     if (const_check(sizeof(target_type) <= sizeof(int))) {
       // Extra casts are used to silence warnings.
-      if (is_signed) {
-        auto n = static_cast<int>(static_cast<target_type>(value));
-        arg_ = detail::make_arg<Context>(n);
-      } else {
-        using unsigned_type = typename make_unsigned_or_bool<target_type>::type;
-        auto n = static_cast<unsigned>(static_cast<unsigned_type>(value));
-        arg_ = detail::make_arg<Context>(n);
-      }
+      using unsigned_type = typename make_unsigned_or_bool<target_type>::type;
+      if (is_signed)
+        arg_ = static_cast<int>(static_cast<target_type>(value));
+      else
+        arg_ = static_cast<unsigned>(static_cast<unsigned_type>(value));
     } else {
-      if (is_signed) {
-        // glibc's printf doesn't sign extend arguments of smaller types:
-        //   std::printf("%lld", -42);  // prints "4294967254"
-        // but we don't have to do the same because it's a UB.
-        auto n = static_cast<long long>(value);
-        arg_ = detail::make_arg<Context>(n);
-      } else {
-        auto n = static_cast<typename make_unsigned_or_bool<U>::type>(value);
-        arg_ = detail::make_arg<Context>(n);
-      }
+      // glibc's printf doesn't sign extend arguments of smaller types:
+      //   std::printf("%lld", -42);  // prints "4294967254"
+      // but we don't have to do the same because it's a UB.
+      if (is_signed)
+        arg_ = static_cast<long long>(value);
+      else
+        arg_ = static_cast<typename make_unsigned_or_bool<U>::type>(value);
     }
   }
 
@@ -165,7 +171,7 @@ template <typename T, typename Context> class arg_converter {
 // unsigned).
 template <typename T, typename Context, typename Char>
 void convert_arg(basic_format_arg<Context>& arg, Char type) {
-  visit_format_arg(arg_converter<T, Context>(arg, type), arg);
+  arg.visit(arg_converter<T, Context>(arg, type));
 }
 
 // Converts an integer argument to char for printf.
@@ -178,8 +184,7 @@ template <typename Context> class char_converter {
 
   template <typename T, FMT_ENABLE_IF(std::is_integral<T>::value)>
   void operator()(T value) {
-    auto c = static_cast<typename Context::char_type>(value);
-    arg_ = detail::make_arg<Context>(c);
+    arg_ = static_cast<typename Context::char_type>(value);
   }
 
   template <typename T, FMT_ENABLE_IF(!std::is_integral<T>::value)>
@@ -195,28 +200,28 @@ template <typename Char> struct get_cstring {
 
 // Checks if an argument is a valid printf width specifier and sets
 // left alignment if it is negative.
-template <typename Char> class printf_width_handler {
+class printf_width_handler {
  private:
-  format_specs<Char>& specs_;
+  format_specs& specs_;
 
  public:
-  explicit printf_width_handler(format_specs<Char>& specs) : specs_(specs) {}
+  inline explicit printf_width_handler(format_specs& specs) : specs_(specs) {}
 
   template <typename T, FMT_ENABLE_IF(std::is_integral<T>::value)>
   auto operator()(T value) -> unsigned {
     auto width = static_cast<uint32_or_64_or_128_t<T>>(value);
     if (detail::is_negative(value)) {
-      specs_.align = align::left;
+      specs_.set_align(align::left);
       width = 0 - width;
     }
-    unsigned int_max = max_value<int>();
-    if (width > int_max) throw_format_error("number is too big");
+    unsigned int_max = to_unsigned(max_value<int>());
+    if (width > int_max) report_error("number is too big");
     return static_cast<unsigned>(width);
   }
 
   template <typename T, FMT_ENABLE_IF(!std::is_integral<T>::value)>
   auto operator()(T) -> unsigned {
-    throw_format_error("width is not integer");
+    report_error("width is not integer");
     return 0;
   }
 };
@@ -224,12 +229,12 @@ template <typename Char> class printf_width_handler {
 // Workaround for a bug with the XL compiler when initializing
 // printf_arg_formatter's base class.
 template <typename Char>
-auto make_arg_formatter(buffer_appender<Char> iter, format_specs<Char>& s)
+auto make_arg_formatter(basic_appender<Char> iter, format_specs& s)
     -> arg_formatter<Char> {
   return {iter, s, locale_ref()};
 }
 
-// The ``printf`` argument formatter.
+// The `printf` argument formatter.
 template <typename Char>
 class printf_arg_formatter : public arg_formatter<Char> {
  private:
@@ -240,105 +245,96 @@ class printf_arg_formatter : public arg_formatter<Char> {
 
   void write_null_pointer(bool is_string = false) {
     auto s = this->specs;
-    s.type = presentation_type::none;
-    write_bytes(this->out, is_string ? "(null)" : "(nil)", s);
+    s.set_type(presentation_type::none);
+    write_bytes<Char>(this->out, is_string ? "(null)" : "(nil)", s);
+  }
+
+  template <typename T> void write(T value) {
+    detail::write<Char>(this->out, value, this->specs, this->locale);
   }
 
  public:
-  printf_arg_formatter(buffer_appender<Char> iter, format_specs<Char>& s,
+  printf_arg_formatter(basic_appender<Char> iter, format_specs& s,
                        context_type& ctx)
       : base(make_arg_formatter(iter, s)), context_(ctx) {}
 
-  void operator()(monostate value) { base::operator()(value); }
+  void operator()(monostate value) { write(value); }
 
   template <typename T, FMT_ENABLE_IF(detail::is_integral<T>::value)>
   void operator()(T value) {
     // MSVC2013 fails to compile separate overloads for bool and Char so use
     // std::is_same instead.
     if (!std::is_same<T, Char>::value) {
-      base::operator()(value);
+      write(value);
       return;
     }
-    format_specs<Char> fmt_specs = this->specs;
-    if (fmt_specs.type != presentation_type::none &&
-        fmt_specs.type != presentation_type::chr) {
+    format_specs s = this->specs;
+    if (s.type() != presentation_type::none &&
+        s.type() != presentation_type::chr) {
       return (*this)(static_cast<int>(value));
     }
-    fmt_specs.sign = sign::none;
-    fmt_specs.alt = false;
-    fmt_specs.fill[0] = ' ';  // Ignore '0' flag for char types.
+    s.set_sign(sign::none);
+    s.clear_alt();
+    s.set_fill(' ');  // Ignore '0' flag for char types.
     // align::numeric needs to be overwritten here since the '0' flag is
     // ignored for non-numeric types
-    if (fmt_specs.align == align::none || fmt_specs.align == align::numeric)
-      fmt_specs.align = align::right;
-    write<Char>(this->out, static_cast<Char>(value), fmt_specs);
+    if (s.align() == align::none || s.align() == align::numeric)
+      s.set_align(align::right);
+    detail::write<Char>(this->out, static_cast<Char>(value), s);
   }
 
   template <typename T, FMT_ENABLE_IF(std::is_floating_point<T>::value)>
   void operator()(T value) {
-    base::operator()(value);
+    write(value);
   }
 
-  /** Formats a null-terminated C string. */
   void operator()(const char* value) {
     if (value)
-      base::operator()(value);
+      write(value);
     else
-      write_null_pointer(this->specs.type != presentation_type::pointer);
+      write_null_pointer(this->specs.type() != presentation_type::pointer);
   }
 
-  /** Formats a null-terminated wide C string. */
   void operator()(const wchar_t* value) {
     if (value)
-      base::operator()(value);
+      write(value);
     else
-      write_null_pointer(this->specs.type != presentation_type::pointer);
+      write_null_pointer(this->specs.type() != presentation_type::pointer);
   }
 
-  void operator()(basic_string_view<Char> value) { base::operator()(value); }
+  void operator()(basic_string_view<Char> value) { write(value); }
 
-  /** Formats a pointer. */
   void operator()(const void* value) {
     if (value)
-      base::operator()(value);
+      write(value);
     else
       write_null_pointer();
   }
 
-  /** Formats an argument of a custom (user-defined) type. */
   void operator()(typename basic_format_arg<context_type>::handle handle) {
-    auto parse_ctx = basic_format_parse_context<Char>({});
+    auto parse_ctx = parse_context<Char>({});
     handle.format(parse_ctx, context_);
   }
 };
 
 template <typename Char>
-void parse_flags(format_specs<Char>& specs, const Char*& it, const Char* end) {
+void parse_flags(format_specs& specs, const Char*& it, const Char* end) {
   for (; it != end; ++it) {
     switch (*it) {
-    case '-':
-      specs.align = align::left;
-      break;
-    case '+':
-      specs.sign = sign::plus;
-      break;
-    case '0':
-      specs.fill[0] = '0';
-      break;
+    case '-': specs.set_align(align::left); break;
+    case '+': specs.set_sign(sign::plus); break;
+    case '0': specs.set_fill('0'); break;
     case ' ':
-      if (specs.sign != sign::plus) specs.sign = sign::space;
-      break;
-    case '#':
-      specs.alt = true;
+      if (specs.sign() != sign::plus) specs.set_sign(sign::space);
       break;
-    default:
-      return;
+    case '#': specs.set_alt(); break;
+    default:  return;
     }
   }
 }
 
 template <typename Char, typename GetArg>
-auto parse_header(const Char*& it, const Char* end, format_specs<Char>& specs,
+auto parse_header(const Char*& it, const Char* end, format_specs& specs,
                   GetArg get_arg) -> int {
   int arg_index = -1;
   Char c = *it;
@@ -350,11 +346,11 @@ auto parse_header(const Char*& it, const Char* end, format_specs<Char>& specs,
       ++it;
       arg_index = value != -1 ? value : max_value<int>();
     } else {
-      if (c == '0') specs.fill[0] = '0';
+      if (c == '0') specs.set_fill('0');
       if (value != 0) {
         // Nonzero value means that we parsed width and don't need to
         // parse it or flags again, so return now.
-        if (value == -1) throw_format_error("number is too big");
+        if (value == -1) report_error("number is too big");
         specs.width = value;
         return arg_index;
       }
@@ -365,63 +361,47 @@ auto parse_header(const Char*& it, const Char* end, format_specs<Char>& specs,
   if (it != end) {
     if (*it >= '0' && *it <= '9') {
       specs.width = parse_nonnegative_int(it, end, -1);
-      if (specs.width == -1) throw_format_error("number is too big");
+      if (specs.width == -1) report_error("number is too big");
     } else if (*it == '*') {
       ++it;
-      specs.width = static_cast<int>(visit_format_arg(
-          detail::printf_width_handler<Char>(specs), get_arg(-1)));
+      specs.width = static_cast<int>(
+          get_arg(-1).visit(detail::printf_width_handler(specs)));
     }
   }
   return arg_index;
 }
 
-inline auto parse_printf_presentation_type(char c, type t)
+inline auto parse_printf_presentation_type(char c, type t, bool& upper)
     -> presentation_type {
   using pt = presentation_type;
   constexpr auto integral_set = sint_set | uint_set | bool_set | char_set;
   switch (c) {
-  case 'd':
-    return in(t, integral_set) ? pt::dec : pt::none;
-  case 'o':
-    return in(t, integral_set) ? pt::oct : pt::none;
-  case 'x':
-    return in(t, integral_set) ? pt::hex_lower : pt::none;
-  case 'X':
-    return in(t, integral_set) ? pt::hex_upper : pt::none;
-  case 'a':
-    return in(t, float_set) ? pt::hexfloat_lower : pt::none;
-  case 'A':
-    return in(t, float_set) ? pt::hexfloat_upper : pt::none;
-  case 'e':
-    return in(t, float_set) ? pt::exp_lower : pt::none;
-  case 'E':
-    return in(t, float_set) ? pt::exp_upper : pt::none;
-  case 'f':
-    return in(t, float_set) ? pt::fixed_lower : pt::none;
-  case 'F':
-    return in(t, float_set) ? pt::fixed_upper : pt::none;
-  case 'g':
-    return in(t, float_set) ? pt::general_lower : pt::none;
-  case 'G':
-    return in(t, float_set) ? pt::general_upper : pt::none;
-  case 'c':
-    return in(t, integral_set) ? pt::chr : pt::none;
-  case 's':
-    return in(t, string_set | cstring_set) ? pt::string : pt::none;
-  case 'p':
-    return in(t, pointer_set | cstring_set) ? pt::pointer : pt::none;
-  default:
-    return pt::none;
+  case 'd': return in(t, integral_set) ? pt::dec : pt::none;
+  case 'o': return in(t, integral_set) ? pt::oct : pt::none;
+  case 'X': upper = true; FMT_FALLTHROUGH;
+  case 'x': return in(t, integral_set) ? pt::hex : pt::none;
+  case 'E': upper = true; FMT_FALLTHROUGH;
+  case 'e': return in(t, float_set) ? pt::exp : pt::none;
+  case 'F': upper = true; FMT_FALLTHROUGH;
+  case 'f': return in(t, float_set) ? pt::fixed : pt::none;
+  case 'G': upper = true; FMT_FALLTHROUGH;
+  case 'g': return in(t, float_set) ? pt::general : pt::none;
+  case 'A': upper = true; FMT_FALLTHROUGH;
+  case 'a': return in(t, float_set) ? pt::hexfloat : pt::none;
+  case 'c': return in(t, integral_set) ? pt::chr : pt::none;
+  case 's': return in(t, string_set | cstring_set) ? pt::string : pt::none;
+  case 'p': return in(t, pointer_set | cstring_set) ? pt::pointer : pt::none;
+  default:  return pt::none;
   }
 }
 
 template <typename Char, typename Context>
 void vprintf(buffer<Char>& buf, basic_string_view<Char> format,
              basic_format_args<Context> args) {
-  using iterator = buffer_appender<Char>;
+  using iterator = basic_appender<Char>;
   auto out = iterator(buf);
   auto context = basic_printf_context<Char>(out, args);
-  auto parse_ctx = basic_format_parse_context<Char>(format);
+  auto parse_ctx = parse_context<Char>(format);
 
   // Returns the argument with specified index or, if arg_index is -1, the next
   // argument.
@@ -449,12 +429,12 @@ void vprintf(buffer<Char>& buf, basic_string_view<Char> format,
     }
     write(out, basic_string_view<Char>(start, to_unsigned(it - 1 - start)));
 
-    auto specs = format_specs<Char>();
-    specs.align = align::right;
+    auto specs = format_specs();
+    specs.set_align(align::right);
 
     // Parse argument index, flags and width.
     int arg_index = parse_header(it, end, specs, get_arg);
-    if (arg_index == 0) throw_format_error("argument not found");
+    if (arg_index == 0) report_error("argument not found");
 
     // Parse precision.
     if (it != end && *it == '.') {
@@ -464,8 +444,8 @@ void vprintf(buffer<Char>& buf, basic_string_view<Char> format,
         specs.precision = parse_nonnegative_int(it, end, 0);
       } else if (c == '*') {
         ++it;
-        specs.precision = static_cast<int>(
-            visit_format_arg(printf_precision_handler(), get_arg(-1)));
+        specs.precision =
+            static_cast<int>(get_arg(-1).visit(printf_precision_handler()));
       } else {
         specs.precision = 0;
       }
@@ -474,25 +454,26 @@ void vprintf(buffer<Char>& buf, basic_string_view<Char> format,
     auto arg = get_arg(arg_index);
     // For d, i, o, u, x, and X conversion specifiers, if a precision is
     // specified, the '0' flag is ignored
-    if (specs.precision >= 0 && arg.is_integral()) {
+    if (specs.precision >= 0 && is_integral_type(arg.type())) {
       // Ignore '0' for non-numeric types or if '-' present.
-      specs.fill[0] = ' ';
+      specs.set_fill(' ');
     }
     if (specs.precision >= 0 && arg.type() == type::cstring_type) {
-      auto str = visit_format_arg(get_cstring<Char>(), arg);
+      auto str = arg.visit(get_cstring<Char>());
       auto str_end = str + specs.precision;
       auto nul = std::find(str, str_end, Char());
       auto sv = basic_string_view<Char>(
           str, to_unsigned(nul != str_end ? nul - str : specs.precision));
-      arg = make_arg<basic_printf_context<Char>>(sv);
+      arg = sv;
     }
-    if (specs.alt && visit_format_arg(is_zero_int(), arg)) specs.alt = false;
-    if (specs.fill[0] == '0') {
-      if (arg.is_arithmetic() && specs.align != align::left)
-        specs.align = align::numeric;
-      else
-        specs.fill[0] = ' ';  // Ignore '0' flag for non-numeric types or if '-'
-                              // flag is also present.
+    if (specs.alt() && arg.visit(is_zero_int())) specs.clear_alt();
+    if (specs.fill_unit<Char>() == '0') {
+      if (is_arithmetic_type(arg.type()) && specs.align() != align::left) {
+        specs.set_align(align::numeric);
+      } else {
+        // Ignore '0' flag for non-numeric types or if '-' flag is also present.
+        specs.set_fill(' ');
+      }
     }
 
     // Parse length and convert the argument to the required type.
@@ -517,47 +498,39 @@ void vprintf(buffer<Char>& buf, basic_string_view<Char> format,
         convert_arg<long>(arg, t);
       }
       break;
-    case 'j':
-      convert_arg<intmax_t>(arg, t);
-      break;
-    case 'z':
-      convert_arg<size_t>(arg, t);
-      break;
-    case 't':
-      convert_arg<std::ptrdiff_t>(arg, t);
-      break;
+    case 'j': convert_arg<intmax_t>(arg, t); break;
+    case 'z': convert_arg<size_t>(arg, t); break;
+    case 't': convert_arg<std::ptrdiff_t>(arg, t); break;
     case 'L':
       // printf produces garbage when 'L' is omitted for long double, no
       // need to do the same.
       break;
-    default:
-      --it;
-      convert_arg<void>(arg, c);
+    default: --it; convert_arg<void>(arg, c);
     }
 
     // Parse type.
-    if (it == end) throw_format_error("invalid format string");
+    if (it == end) report_error("invalid format string");
     char type = static_cast<char>(*it++);
-    if (arg.is_integral()) {
+    if (is_integral_type(arg.type())) {
       // Normalize type.
       switch (type) {
       case 'i':
-      case 'u':
-        type = 'd';
-        break;
+      case 'u': type = 'd'; break;
       case 'c':
-        visit_format_arg(char_converter<basic_printf_context<Char>>(arg), arg);
+        arg.visit(char_converter<basic_printf_context<Char>>(arg));
         break;
       }
     }
-    specs.type = parse_printf_presentation_type(type, arg.type());
-    if (specs.type == presentation_type::none)
-      throw_format_error("invalid format specifier");
+    bool upper = false;
+    specs.set_type(parse_printf_presentation_type(type, arg.type(), upper));
+    if (specs.type() == presentation_type::none)
+      report_error("invalid format specifier");
+    if (upper) specs.set_upper();
 
     start = it;
 
     // Format argument.
-    visit_format_arg(printf_arg_formatter<Char>(out, specs, context), arg);
+    arg.visit(printf_arg_formatter<Char>(out, specs, context));
   }
   write(out, basic_string_view<Char>(start, to_unsigned(it - start)));
 }
@@ -569,56 +542,44 @@ using wprintf_context = basic_printf_context<wchar_t>;
 using printf_args = basic_format_args<printf_context>;
 using wprintf_args = basic_format_args<wprintf_context>;
 
-/**
-  \rst
-  Constructs an `~fmt::format_arg_store` object that contains references to
-  arguments and can be implicitly converted to `~fmt::printf_args`.
-  \endrst
- */
-template <typename... T>
-inline auto make_printf_args(const T&... args)
-    -> format_arg_store<printf_context, T...> {
-  return {args...};
+/// Constructs an `format_arg_store` object that contains references to
+/// arguments and can be implicitly converted to `printf_args`.
+template <typename Char = char, typename... T>
+inline auto make_printf_args(T&... args)
+    -> decltype(fmt::make_format_args<basic_printf_context<Char>>(args...)) {
+  return fmt::make_format_args<basic_printf_context<Char>>(args...);
 }
 
-// DEPRECATED!
-template <typename... T>
-inline auto make_wprintf_args(const T&... args)
-    -> format_arg_store<wprintf_context, T...> {
-  return {args...};
-}
+template <typename Char> struct vprintf_args {
+  using type = basic_format_args<basic_printf_context<Char>>;
+};
 
 template <typename Char>
-inline auto vsprintf(
-    basic_string_view<Char> fmt,
-    basic_format_args<basic_printf_context<type_identity_t<Char>>> args)
+inline auto vsprintf(basic_string_view<Char> fmt,
+                     typename vprintf_args<Char>::type args)
     -> std::basic_string<Char> {
   auto buf = basic_memory_buffer<Char>();
   detail::vprintf(buf, fmt, args);
-  return to_string(buf);
+  return {buf.data(), buf.size()};
 }
 
 /**
-  \rst
-  Formats arguments and returns the result as a string.
-
-  **Example**::
-
-    std::string message = fmt::sprintf("The answer is %d", 42);
-  \endrst
-*/
-template <typename S, typename... T,
-          typename Char = enable_if_t<detail::is_string<S>::value, char_t<S>>>
+ * Formats `args` according to specifications in `fmt` and returns the result
+ * as as string.
+ *
+ * **Example**:
+ *
+ *     std::string message = fmt::sprintf("The answer is %d", 42);
+ */
+template <typename S, typename... T, typename Char = detail::char_t<S>>
 inline auto sprintf(const S& fmt, const T&... args) -> std::basic_string<Char> {
   return vsprintf(detail::to_string_view(fmt),
                   fmt::make_format_args<basic_printf_context<Char>>(args...));
 }
 
 template <typename Char>
-inline auto vfprintf(
-    std::FILE* f, basic_string_view<Char> fmt,
-    basic_format_args<basic_printf_context<type_identity_t<Char>>> args)
-    -> int {
+inline auto vfprintf(std::FILE* f, basic_string_view<Char> fmt,
+                     typename vprintf_args<Char>::type args) -> int {
   auto buf = basic_memory_buffer<Char>();
   detail::vprintf(buf, fmt, args);
   size_t size = buf.size();
@@ -628,36 +589,33 @@ inline auto vfprintf(
 }
 
 /**
-  \rst
-  Prints formatted data to the file *f*.
-
-  **Example**::
-
-    fmt::fprintf(stderr, "Don't %s!", "panic");
-  \endrst
+ * Formats `args` according to specifications in `fmt` and writes the output
+ * to `f`.
+ *
+ * **Example**:
+ *
+ *     fmt::fprintf(stderr, "Don't %s!", "panic");
  */
-template <typename S, typename... T, typename Char = char_t<S>>
+template <typename S, typename... T, typename Char = detail::char_t<S>>
 inline auto fprintf(std::FILE* f, const S& fmt, const T&... args) -> int {
   return vfprintf(f, detail::to_string_view(fmt),
-                  fmt::make_format_args<basic_printf_context<Char>>(args...));
+                  make_printf_args<Char>(args...));
 }
 
 template <typename Char>
-FMT_DEPRECATED inline auto vprintf(
-    basic_string_view<Char> fmt,
-    basic_format_args<basic_printf_context<type_identity_t<Char>>> args)
+FMT_DEPRECATED inline auto vprintf(basic_string_view<Char> fmt,
+                                   typename vprintf_args<Char>::type args)
     -> int {
   return vfprintf(stdout, fmt, args);
 }
 
 /**
-  \rst
-  Prints formatted data to ``stdout``.
-
-  **Example**::
-
-    fmt::printf("Elapsed time: %.2f seconds", 1.23);
-  \endrst
+ * Formats `args` according to specifications in `fmt` and writes the output
+ * to `stdout`.
+ *
+ * **Example**:
+ *
+ *   fmt::printf("Elapsed time: %.2f seconds", 1.23);
  */
 template <typename... T>
 inline auto printf(string_view fmt, const T&... args) -> int {
@@ -666,7 +624,7 @@ inline auto printf(string_view fmt, const T&... args) -> int {
 template <typename... T>
 FMT_DEPRECATED inline auto printf(basic_string_view<wchar_t> fmt,
                                   const T&... args) -> int {
-  return vfprintf(stdout, fmt, make_wprintf_args(args...));
+  return vfprintf(stdout, fmt, make_printf_args<wchar_t>(args...));
 }
 
 FMT_END_EXPORT
diff --git a/include/fmt/ranges.h b/include/fmt/ranges.h
index 3638fffb..c6020abe 100644
--- a/include/fmt/ranges.h
+++ b/include/fmt/ranges.h
@@ -8,67 +8,31 @@
 #ifndef FMT_RANGES_H_
 #define FMT_RANGES_H_
 
-#include <initializer_list>
-#include <tuple>
-#include <type_traits>
+#ifndef FMT_MODULE
+#  include <initializer_list>
+#  include <iterator>
+#  include <string>
+#  include <tuple>
+#  include <type_traits>
+#  include <utility>
+#endif
 
 #include "format.h"
 
 FMT_BEGIN_NAMESPACE
 
-namespace detail {
-
-template <typename Range, typename OutputIt>
-auto copy(const Range& range, OutputIt out) -> OutputIt {
-  for (auto it = range.begin(), end = range.end(); it != end; ++it)
-    *out++ = *it;
-  return out;
-}
-
-template <typename OutputIt>
-auto copy(const char* str, OutputIt out) -> OutputIt {
-  while (*str) *out++ = *str++;
-  return out;
-}
-
-template <typename OutputIt> auto copy(char ch, OutputIt out) -> OutputIt {
-  *out++ = ch;
-  return out;
-}
-
-template <typename OutputIt> auto copy(wchar_t ch, OutputIt out) -> OutputIt {
-  *out++ = ch;
-  return out;
-}
-
-// Returns true if T has a std::string-like interface, like std::string_view.
-template <typename T> class is_std_string_like {
-  template <typename U>
-  static auto check(U* p)
-      -> decltype((void)p->find('a'), p->length(), (void)p->data(), int());
-  template <typename> static void check(...);
-
- public:
-  static constexpr const bool value =
-      is_string<T>::value ||
-      std::is_convertible<T, std_string_view<char>>::value ||
-      !std::is_void<decltype(check<T>(nullptr))>::value;
-};
+FMT_EXPORT
+enum class range_format { disabled, map, set, sequence, string, debug_string };
 
-template <typename Char>
-struct is_std_string_like<fmt::basic_string_view<Char>> : std::true_type {};
+namespace detail {
 
 template <typename T> class is_map {
   template <typename U> static auto check(U*) -> typename U::mapped_type;
   template <typename> static void check(...);
 
  public:
-#ifdef FMT_FORMAT_MAP_AS_LIST  // DEPRECATED!
-  static constexpr const bool value = false;
-#else
   static constexpr const bool value =
       !std::is_void<decltype(check<T>(nullptr))>::value;
-#endif
 };
 
 template <typename T> class is_set {
@@ -76,26 +40,10 @@ template <typename T> class is_set {
   template <typename> static void check(...);
 
  public:
-#ifdef FMT_FORMAT_SET_AS_LIST  // DEPRECATED!
-  static constexpr const bool value = false;
-#else
   static constexpr const bool value =
       !std::is_void<decltype(check<T>(nullptr))>::value && !is_map<T>::value;
-#endif
 };
 
-template <typename... Ts> struct conditional_helper {};
-
-template <typename T, typename _ = void> struct is_range_ : std::false_type {};
-
-#if !FMT_MSC_VERSION || FMT_MSC_VERSION > 1800
-
-#  define FMT_DECLTYPE_RETURN(val)  \
-    ->decltype(val) { return val; } \
-    static_assert(                  \
-        true, "")  // This makes it so that a semicolon is required after the
-                   // macro, which helps clang-format handle the formatting.
-
 // C array overload
 template <typename T, std::size_t N>
 auto range_begin(const T (&arr)[N]) -> const T* {
@@ -110,17 +58,21 @@ template <typename T, typename Enable = void>
 struct has_member_fn_begin_end_t : std::false_type {};
 
 template <typename T>
-struct has_member_fn_begin_end_t<T, void_t<decltype(std::declval<T>().begin()),
+struct has_member_fn_begin_end_t<T, void_t<decltype(*std::declval<T>().begin()),
                                            decltype(std::declval<T>().end())>>
     : std::true_type {};
 
-// Member function overload
+// Member function overloads.
 template <typename T>
-auto range_begin(T&& rng) FMT_DECLTYPE_RETURN(static_cast<T&&>(rng).begin());
+auto range_begin(T&& rng) -> decltype(static_cast<T&&>(rng).begin()) {
+  return static_cast<T&&>(rng).begin();
+}
 template <typename T>
-auto range_end(T&& rng) FMT_DECLTYPE_RETURN(static_cast<T&&>(rng).end());
+auto range_end(T&& rng) -> decltype(static_cast<T&&>(rng).end()) {
+  return static_cast<T&&>(rng).end();
+}
 
-// ADL overload. Only participates in overload resolution if member functions
+// ADL overloads. Only participate in overload resolution if member functions
 // are not found.
 template <typename T>
 auto range_begin(T&& rng)
@@ -141,31 +93,30 @@ struct has_mutable_begin_end : std::false_type {};
 
 template <typename T>
 struct has_const_begin_end<
-    T,
-    void_t<
-        decltype(detail::range_begin(std::declval<const remove_cvref_t<T>&>())),
-        decltype(detail::range_end(std::declval<const remove_cvref_t<T>&>()))>>
+    T, void_t<decltype(*detail::range_begin(
+                  std::declval<const remove_cvref_t<T>&>())),
+              decltype(detail::range_end(
+                  std::declval<const remove_cvref_t<T>&>()))>>
     : std::true_type {};
 
 template <typename T>
 struct has_mutable_begin_end<
-    T, void_t<decltype(detail::range_begin(std::declval<T>())),
-              decltype(detail::range_end(std::declval<T>())),
+    T, void_t<decltype(*detail::range_begin(std::declval<T&>())),
+              decltype(detail::range_end(std::declval<T&>())),
               // the extra int here is because older versions of MSVC don't
               // SFINAE properly unless there are distinct types
               int>> : std::true_type {};
 
+template <typename T, typename _ = void> struct is_range_ : std::false_type {};
 template <typename T>
 struct is_range_<T, void>
     : std::integral_constant<bool, (has_const_begin_end<T>::value ||
                                     has_mutable_begin_end<T>::value)> {};
-#  undef FMT_DECLTYPE_RETURN
-#endif
 
 // tuple_size and tuple_element check.
 template <typename T> class is_tuple_like_ {
-  template <typename U>
-  static auto check(U* p) -> decltype(std::tuple_size<U>::value, int());
+  template <typename U, typename V = typename std::remove_cv<U>::type>
+  static auto check(U* p) -> decltype(std::tuple_size<V>::value, 0);
   template <typename> static void check(...);
 
  public:
@@ -206,12 +157,13 @@ class is_tuple_formattable_ {
   static constexpr const bool value = false;
 };
 template <typename T, typename C> class is_tuple_formattable_<T, C, true> {
-  template <std::size_t... Is>
-  static auto check2(index_sequence<Is...>,
-                     integer_sequence<bool, (Is == Is)...>) -> std::true_type;
-  static auto check2(...) -> std::false_type;
-  template <std::size_t... Is>
-  static auto check(index_sequence<Is...>) -> decltype(check2(
+  template <size_t... Is>
+  static auto all_true(index_sequence<Is...>,
+                       integer_sequence<bool, (Is >= 0)...>) -> std::true_type;
+  static auto all_true(...) -> std::false_type;
+
+  template <size_t... Is>
+  static auto check(index_sequence<Is...>) -> decltype(all_true(
       index_sequence<Is...>{},
       integer_sequence<bool,
                        (is_formattable<typename std::tuple_element<Is, T>::type,
@@ -292,21 +244,32 @@ FMT_CONSTEXPR auto maybe_set_debug_format(Formatter& f, bool set)
 template <typename Formatter>
 FMT_CONSTEXPR void maybe_set_debug_format(Formatter&, ...) {}
 
+template <typename T>
+struct range_format_kind_
+    : std::integral_constant<range_format,
+                             std::is_same<uncvref_type<T>, T>::value
+                                 ? range_format::disabled
+                             : is_map<T>::value ? range_format::map
+                             : is_set<T>::value ? range_format::set
+                                                : range_format::sequence> {};
+
+template <range_format K>
+using range_format_constant = std::integral_constant<range_format, K>;
+
 // These are not generic lambdas for compatibility with C++11.
-template <typename ParseContext> struct parse_empty_specs {
+template <typename Char> struct parse_empty_specs {
   template <typename Formatter> FMT_CONSTEXPR void operator()(Formatter& f) {
     f.parse(ctx);
     detail::maybe_set_debug_format(f, true);
   }
-  ParseContext& ctx;
+  parse_context<Char>& ctx;
 };
 template <typename FormatContext> struct format_tuple_element {
   using char_type = typename FormatContext::char_type;
 
   template <typename T>
   void operator()(const formatter<T, char_type>& f, const T& v) {
-    if (i > 0)
-      ctx.advance_to(detail::copy_str<char_type>(separator, ctx.out()));
+    if (i > 0) ctx.advance_to(detail::copy<char_type>(separator, ctx.out()));
     ctx.advance_to(f.format(v, ctx));
     ++i;
   }
@@ -355,55 +318,40 @@ struct formatter<Tuple, Char,
     closing_bracket_ = close;
   }
 
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     auto it = ctx.begin();
-    if (it != ctx.end() && *it != '}')
-      FMT_THROW(format_error("invalid format specifier"));
-    detail::for_each(formatters_, detail::parse_empty_specs<ParseContext>{ctx});
+    auto end = ctx.end();
+    if (it != end && detail::to_ascii(*it) == 'n') {
+      ++it;
+      set_brackets({}, {});
+      set_separator({});
+    }
+    if (it != end && *it != '}') report_error("invalid format specifier");
+    ctx.advance_to(it);
+    detail::for_each(formatters_, detail::parse_empty_specs<Char>{ctx});
     return it;
   }
 
   template <typename FormatContext>
   auto format(const Tuple& value, FormatContext& ctx) const
       -> decltype(ctx.out()) {
-    ctx.advance_to(detail::copy_str<Char>(opening_bracket_, ctx.out()));
+    ctx.advance_to(detail::copy<Char>(opening_bracket_, ctx.out()));
     detail::for_each2(
         formatters_, value,
         detail::format_tuple_element<FormatContext>{0, ctx, separator_});
-    return detail::copy_str<Char>(closing_bracket_, ctx.out());
+    return detail::copy<Char>(closing_bracket_, ctx.out());
   }
 };
 
 template <typename T, typename Char> struct is_range {
   static constexpr const bool value =
-      detail::is_range_<T>::value && !detail::is_std_string_like<T>::value &&
-      !std::is_convertible<T, std::basic_string<Char>>::value &&
-      !std::is_convertible<T, detail::std_string_view<Char>>::value;
+      detail::is_range_<T>::value && !detail::has_to_string_view<T>::value;
 };
 
 namespace detail {
-template <typename Context> struct range_mapper {
-  using mapper = arg_mapper<Context>;
-
-  template <typename T,
-            FMT_ENABLE_IF(has_formatter<remove_cvref_t<T>, Context>::value)>
-  static auto map(T&& value) -> T&& {
-    return static_cast<T&&>(value);
-  }
-  template <typename T,
-            FMT_ENABLE_IF(!has_formatter<remove_cvref_t<T>, Context>::value)>
-  static auto map(T&& value)
-      -> decltype(mapper().map(static_cast<T&&>(value))) {
-    return mapper().map(static_cast<T&&>(value));
-  }
-};
 
 template <typename Char, typename Element>
-using range_formatter_type =
-    formatter<remove_cvref_t<decltype(range_mapper<buffer_context<Char>>{}.map(
-                  std::declval<Element>()))>,
-              Char>;
+using range_formatter_type = formatter<remove_cvref_t<Element>, Char>;
 
 template <typename R>
 using maybe_const_range =
@@ -438,6 +386,24 @@ struct range_formatter<
       detail::string_literal<Char, '['>{};
   basic_string_view<Char> closing_bracket_ =
       detail::string_literal<Char, ']'>{};
+  bool is_debug = false;
+
+  template <typename Output, typename It, typename Sentinel, typename U = T,
+            FMT_ENABLE_IF(std::is_same<U, Char>::value)>
+  auto write_debug_string(Output& out, It it, Sentinel end) const -> Output {
+    auto buf = basic_memory_buffer<Char>();
+    for (; it != end; ++it) buf.push_back(*it);
+    auto specs = format_specs();
+    specs.set_type(presentation_type::debug);
+    return detail::write<Char>(
+        out, basic_string_view<Char>(buf.data(), buf.size()), specs);
+  }
+
+  template <typename Output, typename It, typename Sentinel, typename U = T,
+            FMT_ENABLE_IF(!std::is_same<U, Char>::value)>
+  auto write_debug_string(Output& out, It, Sentinel) const -> Output {
+    return out;
+  }
 
  public:
   FMT_CONSTEXPR range_formatter() {}
@@ -456,21 +422,40 @@ struct range_formatter<
     closing_bracket_ = close;
   }
 
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     auto it = ctx.begin();
     auto end = ctx.end();
+    detail::maybe_set_debug_format(underlying_, true);
+    if (it == end) return underlying_.parse(ctx);
 
-    if (it != end && *it == 'n') {
+    switch (detail::to_ascii(*it)) {
+    case 'n':
+      set_brackets({}, {});
+      ++it;
+      break;
+    case '?':
+      is_debug = true;
       set_brackets({}, {});
       ++it;
+      if (it == end || *it != 's') report_error("invalid format specifier");
+      FMT_FALLTHROUGH;
+    case 's':
+      if (!std::is_same<T, Char>::value)
+        report_error("invalid format specifier");
+      if (!is_debug) {
+        set_brackets(detail::string_literal<Char, '"'>{},
+                     detail::string_literal<Char, '"'>{});
+        set_separator({});
+        detail::maybe_set_debug_format(underlying_, false);
+      }
+      ++it;
+      return it;
     }
 
     if (it != end && *it != '}') {
-      if (*it != ':') FMT_THROW(format_error("invalid format specifier"));
+      if (*it != ':') report_error("invalid format specifier");
+      detail::maybe_set_debug_format(underlying_, false);
       ++it;
-    } else {
-      detail::maybe_set_debug_format(underlying_, true);
     }
 
     ctx.advance_to(it);
@@ -479,101 +464,245 @@ struct range_formatter<
 
   template <typename R, typename FormatContext>
   auto format(R&& range, FormatContext& ctx) const -> decltype(ctx.out()) {
-    detail::range_mapper<buffer_context<Char>> mapper;
     auto out = ctx.out();
-    out = detail::copy_str<Char>(opening_bracket_, out);
-    int i = 0;
     auto it = detail::range_begin(range);
     auto end = detail::range_end(range);
+    if (is_debug) return write_debug_string(out, std::move(it), end);
+
+    out = detail::copy<Char>(opening_bracket_, out);
+    int i = 0;
     for (; it != end; ++it) {
-      if (i > 0) out = detail::copy_str<Char>(separator_, out);
+      if (i > 0) out = detail::copy<Char>(separator_, out);
       ctx.advance_to(out);
-      auto&& item = *it;
-      out = underlying_.format(mapper.map(item), ctx);
+      auto&& item = *it;  // Need an lvalue
+      out = underlying_.format(item, ctx);
       ++i;
     }
-    out = detail::copy_str<Char>(closing_bracket_, out);
+    out = detail::copy<Char>(closing_bracket_, out);
     return out;
   }
 };
 
-enum class range_format { disabled, map, set, sequence, string, debug_string };
+FMT_EXPORT
+template <typename T, typename Char, typename Enable = void>
+struct range_format_kind
+    : conditional_t<
+          is_range<T, Char>::value, detail::range_format_kind_<T>,
+          std::integral_constant<range_format, range_format::disabled>> {};
 
-namespace detail {
-template <typename T>
-struct range_format_kind_
-    : std::integral_constant<range_format,
-                             std::is_same<uncvref_type<T>, T>::value
-                                 ? range_format::disabled
-                             : is_map<T>::value ? range_format::map
-                             : is_set<T>::value ? range_format::set
-                                                : range_format::sequence> {};
+template <typename R, typename Char>
+struct formatter<
+    R, Char,
+    enable_if_t<conjunction<
+        bool_constant<
+            range_format_kind<R, Char>::value != range_format::disabled &&
+            range_format_kind<R, Char>::value != range_format::map &&
+            range_format_kind<R, Char>::value != range_format::string &&
+            range_format_kind<R, Char>::value != range_format::debug_string>
+// Workaround a bug in MSVC 2015 and earlier.
+#if !FMT_MSC_VERSION || FMT_MSC_VERSION >= 1910
+        ,
+        detail::is_formattable_delayed<R, Char>
+#endif
+        >::value>> {
+ private:
+  using range_type = detail::maybe_const_range<R>;
+  range_formatter<detail::uncvref_type<range_type>, Char> range_formatter_;
 
-template <range_format K, typename R, typename Char, typename Enable = void>
-struct range_default_formatter;
+ public:
+  using nonlocking = void;
+
+  FMT_CONSTEXPR formatter() {
+    if (detail::const_check(range_format_kind<R, Char>::value !=
+                            range_format::set))
+      return;
+    range_formatter_.set_brackets(detail::string_literal<Char, '{'>{},
+                                  detail::string_literal<Char, '}'>{});
+  }
 
-template <range_format K>
-using range_format_constant = std::integral_constant<range_format, K>;
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    return range_formatter_.parse(ctx);
+  }
 
-template <range_format K, typename R, typename Char>
-struct range_default_formatter<
-    K, R, Char,
-    enable_if_t<(K == range_format::sequence || K == range_format::map ||
-                 K == range_format::set)>> {
-  using range_type = detail::maybe_const_range<R>;
-  range_formatter<detail::uncvref_type<range_type>, Char> underlying_;
+  template <typename FormatContext>
+  auto format(range_type& range, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    return range_formatter_.format(range, ctx);
+  }
+};
 
-  FMT_CONSTEXPR range_default_formatter() { init(range_format_constant<K>()); }
+// A map formatter.
+template <typename R, typename Char>
+struct formatter<
+    R, Char,
+    enable_if_t<range_format_kind<R, Char>::value == range_format::map>> {
+ private:
+  using map_type = detail::maybe_const_range<R>;
+  using element_type = detail::uncvref_type<map_type>;
+
+  decltype(detail::tuple::get_formatters<element_type, Char>(
+      detail::tuple_index_sequence<element_type>())) formatters_;
+  bool no_delimiters_ = false;
+
+ public:
+  FMT_CONSTEXPR formatter() {}
 
-  FMT_CONSTEXPR void init(range_format_constant<range_format::set>) {
-    underlying_.set_brackets(detail::string_literal<Char, '{'>{},
-                             detail::string_literal<Char, '}'>{});
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    auto it = ctx.begin();
+    auto end = ctx.end();
+    if (it != end) {
+      if (detail::to_ascii(*it) == 'n') {
+        no_delimiters_ = true;
+        ++it;
+      }
+      if (it != end && *it != '}') {
+        if (*it != ':') report_error("invalid format specifier");
+        ++it;
+      }
+      ctx.advance_to(it);
+    }
+    detail::for_each(formatters_, detail::parse_empty_specs<Char>{ctx});
+    return it;
   }
 
-  FMT_CONSTEXPR void init(range_format_constant<range_format::map>) {
-    underlying_.set_brackets(detail::string_literal<Char, '{'>{},
-                             detail::string_literal<Char, '}'>{});
-    underlying_.underlying().set_brackets({}, {});
-    underlying_.underlying().set_separator(
-        detail::string_literal<Char, ':', ' '>{});
+  template <typename FormatContext>
+  auto format(map_type& map, FormatContext& ctx) const -> decltype(ctx.out()) {
+    auto out = ctx.out();
+    basic_string_view<Char> open = detail::string_literal<Char, '{'>{};
+    if (!no_delimiters_) out = detail::copy<Char>(open, out);
+    int i = 0;
+    basic_string_view<Char> sep = detail::string_literal<Char, ',', ' '>{};
+    for (auto&& value : map) {
+      if (i > 0) out = detail::copy<Char>(sep, out);
+      ctx.advance_to(out);
+      detail::for_each2(formatters_, value,
+                        detail::format_tuple_element<FormatContext>{
+                            0, ctx, detail::string_literal<Char, ':', ' '>{}});
+      ++i;
+    }
+    basic_string_view<Char> close = detail::string_literal<Char, '}'>{};
+    if (!no_delimiters_) out = detail::copy<Char>(close, out);
+    return out;
   }
+};
+
+// A (debug_)string formatter.
+template <typename R, typename Char>
+struct formatter<
+    R, Char,
+    enable_if_t<range_format_kind<R, Char>::value == range_format::string ||
+                range_format_kind<R, Char>::value ==
+                    range_format::debug_string>> {
+ private:
+  using range_type = detail::maybe_const_range<R>;
+  using string_type =
+      conditional_t<std::is_constructible<
+                        detail::std_string_view<Char>,
+                        decltype(detail::range_begin(std::declval<R>())),
+                        decltype(detail::range_end(std::declval<R>()))>::value,
+                    detail::std_string_view<Char>, std::basic_string<Char>>;
 
-  FMT_CONSTEXPR void init(range_format_constant<range_format::sequence>) {}
+  formatter<string_type, Char> underlying_;
 
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> decltype(ctx.begin()) {
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     return underlying_.parse(ctx);
   }
 
   template <typename FormatContext>
   auto format(range_type& range, FormatContext& ctx) const
       -> decltype(ctx.out()) {
-    return underlying_.format(range, ctx);
+    auto out = ctx.out();
+    if (detail::const_check(range_format_kind<R, Char>::value ==
+                            range_format::debug_string))
+      *out++ = '"';
+    out = underlying_.format(
+        string_type{detail::range_begin(range), detail::range_end(range)}, ctx);
+    if (detail::const_check(range_format_kind<R, Char>::value ==
+                            range_format::debug_string))
+      *out++ = '"';
+    return out;
   }
 };
-}  // namespace detail
 
-template <typename T, typename Char, typename Enable = void>
-struct range_format_kind
-    : conditional_t<
-          is_range<T, Char>::value, detail::range_format_kind_<T>,
-          std::integral_constant<range_format, range_format::disabled>> {};
+template <typename It, typename Sentinel, typename Char = char>
+struct join_view : detail::view {
+  It begin;
+  Sentinel end;
+  basic_string_view<Char> sep;
 
-template <typename R, typename Char>
-struct formatter<
-    R, Char,
-    enable_if_t<conjunction<bool_constant<range_format_kind<R, Char>::value !=
-                                          range_format::disabled>
-// Workaround a bug in MSVC 2015 and earlier.
-#if !FMT_MSC_VERSION || FMT_MSC_VERSION >= 1910
-                            ,
-                            detail::is_formattable_delayed<R, Char>
+  join_view(It b, Sentinel e, basic_string_view<Char> s)
+      : begin(std::move(b)), end(e), sep(s) {}
+};
+
+template <typename It, typename Sentinel, typename Char>
+struct formatter<join_view<It, Sentinel, Char>, Char> {
+ private:
+  using value_type =
+#ifdef __cpp_lib_ranges
+      std::iter_value_t<It>;
+#else
+      typename std::iterator_traits<It>::value_type;
 #endif
-                            >::value>>
-    : detail::range_default_formatter<range_format_kind<R, Char>::value, R,
-                                      Char> {
+  formatter<remove_cvref_t<value_type>, Char> value_formatter_;
+
+  using view_ref = conditional_t<std::is_copy_constructible<It>::value,
+                                 const join_view<It, Sentinel, Char>&,
+                                 join_view<It, Sentinel, Char>&&>;
+
+ public:
+  using nonlocking = void;
+
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    return value_formatter_.parse(ctx);
+  }
+
+  template <typename FormatContext>
+  auto format(view_ref& value, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    auto it = std::forward<view_ref>(value).begin;
+    auto out = ctx.out();
+    if (it == value.end) return out;
+    out = value_formatter_.format(*it, ctx);
+    ++it;
+    while (it != value.end) {
+      out = detail::copy<Char>(value.sep.begin(), value.sep.end(), out);
+      ctx.advance_to(out);
+      out = value_formatter_.format(*it, ctx);
+      ++it;
+    }
+    return out;
+  }
 };
 
+/// Returns a view that formats the iterator range `[begin, end)` with elements
+/// separated by `sep`.
+template <typename It, typename Sentinel>
+auto join(It begin, Sentinel end, string_view sep) -> join_view<It, Sentinel> {
+  return {std::move(begin), end, sep};
+}
+
+/**
+ * Returns a view that formats `range` with elements separated by `sep`.
+ *
+ * **Example**:
+ *
+ *     auto v = std::vector<int>{1, 2, 3};
+ *     fmt::print("{}", fmt::join(v, ", "));
+ *     // Output: 1, 2, 3
+ *
+ * `fmt::join` applies passed format specifiers to the range elements:
+ *
+ *     fmt::print("{:02}", fmt::join(v, ", "));
+ *     // Output: 01, 02, 03
+ */
+template <typename Range>
+auto join(Range&& r, string_view sep)
+    -> join_view<decltype(detail::range_begin(r)),
+                 decltype(detail::range_end(r))> {
+  return {detail::range_begin(r), detail::range_end(r), sep};
+}
+
 template <typename Char, typename... T> struct tuple_join_view : detail::view {
   const std::tuple<T...>& tuple;
   basic_string_view<Char> sep;
@@ -591,8 +720,7 @@ template <typename Char, typename... T> struct tuple_join_view : detail::view {
 
 template <typename Char, typename... T>
 struct formatter<tuple_join_view<Char, T...>, Char> {
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     return do_parse(ctx, std::integral_constant<size_t, sizeof...(T)>());
   }
 
@@ -606,24 +734,23 @@ struct formatter<tuple_join_view<Char, T...>, Char> {
  private:
   std::tuple<formatter<typename std::decay<T>::type, Char>...> formatters_;
 
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto do_parse(ParseContext& ctx,
+  FMT_CONSTEXPR auto do_parse(parse_context<Char>& ctx,
                               std::integral_constant<size_t, 0>)
-      -> decltype(ctx.begin()) {
+      -> const Char* {
     return ctx.begin();
   }
 
-  template <typename ParseContext, size_t N>
-  FMT_CONSTEXPR auto do_parse(ParseContext& ctx,
+  template <size_t N>
+  FMT_CONSTEXPR auto do_parse(parse_context<Char>& ctx,
                               std::integral_constant<size_t, N>)
-      -> decltype(ctx.begin()) {
+      -> const Char* {
     auto end = ctx.begin();
 #if FMT_TUPLE_JOIN_SPECIFIERS
     end = std::get<sizeof...(T) - N>(formatters_).parse(ctx);
     if (N > 1) {
       auto end1 = do_parse(ctx, std::integral_constant<size_t, N - 1>());
       if (end != end1)
-        FMT_THROW(format_error("incompatible format specs for tuple elements"));
+        report_error("incompatible format specs for tuple elements");
     }
 #endif
     return end;
@@ -642,12 +769,10 @@ struct formatter<tuple_join_view<Char, T...>, Char> {
       typename FormatContext::iterator {
     auto out = std::get<sizeof...(T) - N>(formatters_)
                    .format(std::get<sizeof...(T) - N>(value.tuple), ctx);
-    if (N > 1) {
-      out = std::copy(value.sep.begin(), value.sep.end(), out);
-      ctx.advance_to(out);
-      return do_format(value, ctx, std::integral_constant<size_t, N - 1>());
-    }
-    return out;
+    if (N <= 1) return out;
+    out = detail::copy<Char>(value.sep, out);
+    ctx.advance_to(out);
+    return do_format(value, ctx, std::integral_constant<size_t, N - 1>());
   }
 };
 
@@ -692,15 +817,13 @@ struct formatter<
 FMT_BEGIN_EXPORT
 
 /**
-  \rst
-  Returns an object that formats `tuple` with elements separated by `sep`.
-
-  **Example**::
-
-    std::tuple<int, char> t = {1, 'a'};
-    fmt::print("{}", fmt::join(t, ", "));
-    // Output: "1, a"
-  \endrst
+ * Returns an object that formats `std::tuple` with elements separated by `sep`.
+ *
+ * **Example**:
+ *
+ *     auto t = std::tuple<int, char>{1, 'a'};
+ *     fmt::print("{}", fmt::join(t, ", "));
+ *     // Output: 1, a
  */
 template <typename... T>
 FMT_CONSTEXPR auto join(const std::tuple<T...>& tuple, string_view sep)
@@ -708,23 +831,14 @@ FMT_CONSTEXPR auto join(const std::tuple<T...>& tuple, string_view sep)
   return {tuple, sep};
 }
 
-template <typename... T>
-FMT_CONSTEXPR auto join(const std::tuple<T...>& tuple,
-                        basic_string_view<wchar_t> sep)
-    -> tuple_join_view<wchar_t, T...> {
-  return {tuple, sep};
-}
-
 /**
-  \rst
-  Returns an object that formats `initializer_list` with elements separated by
-  `sep`.
-
-  **Example**::
-
-    fmt::print("{}", fmt::join({1, 2, 3}, ", "));
-    // Output: "1, 2, 3"
-  \endrst
+ * Returns an object that formats `std::initializer_list` with elements
+ * separated by `sep`.
+ *
+ * **Example**:
+ *
+ *     fmt::print("{}", fmt::join({1, 2, 3}, ", "));
+ *     // Output: "1, 2, 3"
  */
 template <typename T>
 auto join(std::initializer_list<T> list, string_view sep)
diff --git a/include/fmt/std.h b/include/fmt/std.h
index 7cff1159..839e1714 100644
--- a/include/fmt/std.h
+++ b/include/fmt/std.h
@@ -8,38 +8,47 @@
 #ifndef FMT_STD_H_
 #define FMT_STD_H_
 
-#include <atomic>
-#include <bitset>
-#include <cstdlib>
-#include <exception>
-#include <memory>
-#include <thread>
-#include <type_traits>
-#include <typeinfo>
-#include <utility>
-#include <vector>
-
 #include "format.h"
 #include "ostream.h"
 
-#if FMT_HAS_INCLUDE(<version>)
-#  include <version>
-#endif
-// Checking FMT_CPLUSPLUS for warning suppression in MSVC.
-#if FMT_CPLUSPLUS >= 201703L
-#  if FMT_HAS_INCLUDE(<filesystem>)
-#    include <filesystem>
+#ifndef FMT_MODULE
+#  include <atomic>
+#  include <bitset>
+#  include <complex>
+#  include <cstdlib>
+#  include <exception>
+#  include <functional>
+#  include <memory>
+#  include <thread>
+#  include <type_traits>
+#  include <typeinfo>
+#  include <utility>
+#  include <vector>
+
+// Check FMT_CPLUSPLUS to suppress a bogus warning in MSVC.
+#  if FMT_CPLUSPLUS >= 201703L
+#    if FMT_HAS_INCLUDE(<filesystem>)
+#      include <filesystem>
+#    endif
+#    if FMT_HAS_INCLUDE(<variant>)
+#      include <variant>
+#    endif
+#    if FMT_HAS_INCLUDE(<optional>)
+#      include <optional>
+#    endif
 #  endif
-#  if FMT_HAS_INCLUDE(<variant>)
-#    include <variant>
+// Use > instead of >= in the version check because <source_location> may be
+// available after C++17 but before C++20 is marked as implemented.
+#  if FMT_CPLUSPLUS > 201703L && FMT_HAS_INCLUDE(<source_location>)
+#    include <source_location>
 #  endif
-#  if FMT_HAS_INCLUDE(<optional>)
-#    include <optional>
+#  if FMT_CPLUSPLUS > 202002L && FMT_HAS_INCLUDE(<expected>)
+#    include <expected>
 #  endif
-#endif
+#endif  // FMT_MODULE
 
-#if FMT_CPLUSPLUS > 201703L && FMT_HAS_INCLUDE(<source_location>)
-#  include <source_location>
+#if FMT_HAS_INCLUDE(<version>)
+#  include <version>
 #endif
 
 // GCC 4 does not support FMT_HAS_INCLUDE.
@@ -52,17 +61,6 @@
 #  endif
 #endif
 
-// Check if typeid is available.
-#ifndef FMT_USE_TYPEID
-// __RTTI is for EDG compilers. In MSVC typeid is available without RTTI.
-#  if defined(__GXX_RTTI) || FMT_HAS_FEATURE(cxx_rtti) || FMT_MSC_VERSION || \
-      defined(__INTEL_RTTI__) || defined(__RTTI)
-#    define FMT_USE_TYPEID 1
-#  else
-#    define FMT_USE_TYPEID 0
-#  endif
-#endif
-
 // For older Xcode versions, __cpp_lib_xxx flags are inaccurately defined.
 #ifndef FMT_CPP_LIB_FILESYSTEM
 #  ifdef __cpp_lib_filesystem
@@ -117,7 +115,7 @@ void write_escaped_path(basic_memory_buffer<Char>& quoted,
 FMT_EXPORT
 template <typename Char> struct formatter<std::filesystem::path, Char> {
  private:
-  format_specs<Char> specs_;
+  format_specs specs_;
   detail::arg_ref<Char> width_ref_;
   bool debug_ = false;
   char path_type_ = 0;
@@ -125,33 +123,33 @@ template <typename Char> struct formatter<std::filesystem::path, Char> {
  public:
   FMT_CONSTEXPR void set_debug_format(bool set = true) { debug_ = set; }
 
-  template <typename ParseContext> FMT_CONSTEXPR auto parse(ParseContext& ctx) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) {
     auto it = ctx.begin(), end = ctx.end();
     if (it == end) return it;
 
     it = detail::parse_align(it, end, specs_);
     if (it == end) return it;
 
-    it = detail::parse_dynamic_spec(it, end, specs_.width, width_ref_, ctx);
+    Char c = *it;
+    if ((c >= '0' && c <= '9') || c == '{')
+      it = detail::parse_width(it, end, specs_, width_ref_, ctx);
     if (it != end && *it == '?') {
       debug_ = true;
       ++it;
     }
-    if (it != end && (*it == 'g')) path_type_ = *it++;
+    if (it != end && (*it == 'g')) path_type_ = detail::to_ascii(*it++);
     return it;
   }
 
   template <typename FormatContext>
   auto format(const std::filesystem::path& p, FormatContext& ctx) const {
     auto specs = specs_;
-#  ifdef _WIN32
-    auto path_string = !path_type_ ? p.native() : p.generic_wstring();
-#  else
-    auto path_string = !path_type_ ? p.native() : p.generic_string();
-#  endif
+    auto path_string =
+        !path_type_ ? p.native()
+                    : p.generic_string<std::filesystem::path::value_type>();
 
-    detail::handle_dynamic_spec<detail::width_checker>(specs.width, width_ref_,
-                                                       ctx);
+    detail::handle_dynamic_spec(specs.dynamic_width(), specs.width, width_ref_,
+                                ctx);
     if (!debug_) {
       auto s = detail::get_path_string<Char>(p, path_string);
       return detail::write(ctx.out(), basic_string_view<Char>(s), specs);
@@ -163,6 +161,22 @@ template <typename Char> struct formatter<std::filesystem::path, Char> {
                          specs);
   }
 };
+
+class path : public std::filesystem::path {
+ public:
+  auto display_string() const -> std::string {
+    const std::filesystem::path& base = *this;
+    return fmt::format(FMT_STRING("{}"), base);
+  }
+  auto system_string() const -> std::string { return string(); }
+
+  auto generic_display_string() const -> std::string {
+    const std::filesystem::path& base = *this;
+    return fmt::format(FMT_STRING("{:g}"), base);
+  }
+  auto generic_system_string() const -> std::string { return generic_string(); }
+};
+
 FMT_END_NAMESPACE
 #endif  // FMT_CPP_LIB_FILESYSTEM
 
@@ -222,7 +236,7 @@ struct formatter<std::optional<T>, Char,
   FMT_CONSTEXPR static void maybe_set_debug_format(U&, ...) {}
 
  public:
-  template <typename ParseContext> FMT_CONSTEXPR auto parse(ParseContext& ctx) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) {
     maybe_set_debug_format(underlying_, true);
     return underlying_.parse(ctx);
   }
@@ -242,14 +256,63 @@ struct formatter<std::optional<T>, Char,
 FMT_END_NAMESPACE
 #endif  // __cpp_lib_optional
 
-#ifdef __cpp_lib_source_location
+#if defined(__cpp_lib_expected) || FMT_CPP_LIB_VARIANT
+
+FMT_BEGIN_NAMESPACE
+namespace detail {
+
+template <typename Char, typename OutputIt, typename T>
+auto write_escaped_alternative(OutputIt out, const T& v) -> OutputIt {
+  if constexpr (has_to_string_view<T>::value)
+    return write_escaped_string<Char>(out, detail::to_string_view(v));
+  if constexpr (std::is_same_v<T, Char>) return write_escaped_char(out, v);
+  return write<Char>(out, v);
+}
+
+}  // namespace detail
+
+FMT_END_NAMESPACE
+#endif
+
+#ifdef __cpp_lib_expected
 FMT_BEGIN_NAMESPACE
+
 FMT_EXPORT
-template <> struct formatter<std::source_location> {
-  template <typename ParseContext> FMT_CONSTEXPR auto parse(ParseContext& ctx) {
+template <typename T, typename E, typename Char>
+struct formatter<std::expected<T, E>, Char,
+                 std::enable_if_t<(std::is_void<T>::value ||
+                                   is_formattable<T, Char>::value) &&
+                                  is_formattable<E, Char>::value>> {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     return ctx.begin();
   }
 
+  template <typename FormatContext>
+  auto format(const std::expected<T, E>& value, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    auto out = ctx.out();
+
+    if (value.has_value()) {
+      out = detail::write<Char>(out, "expected(");
+      if constexpr (!std::is_void<T>::value)
+        out = detail::write_escaped_alternative<Char>(out, *value);
+    } else {
+      out = detail::write<Char>(out, "unexpected(");
+      out = detail::write_escaped_alternative<Char>(out, value.error());
+    }
+    *out++ = ')';
+    return out;
+  }
+};
+FMT_END_NAMESPACE
+#endif  // __cpp_lib_expected
+
+#ifdef __cpp_lib_source_location
+FMT_BEGIN_NAMESPACE
+FMT_EXPORT
+template <> struct formatter<std::source_location> {
+  FMT_CONSTEXPR auto parse(parse_context<>& ctx) { return ctx.begin(); }
+
   template <typename FormatContext>
   auto format(const std::source_location& loc, FormatContext& ctx) const
       -> decltype(ctx.out()) {
@@ -291,16 +354,6 @@ template <typename T, typename C> class is_variant_formattable_ {
       decltype(check(variant_index_sequence<T>{}))::value;
 };
 
-template <typename Char, typename OutputIt, typename T>
-auto write_variant_alternative(OutputIt out, const T& v) -> OutputIt {
-  if constexpr (is_string<T>::value)
-    return write_escaped_string<Char>(out, detail::to_string_view(v));
-  else if constexpr (std::is_same_v<T, Char>)
-    return write_escaped_char(out, v);
-  else
-    return write<Char>(out, v);
-}
-
 }  // namespace detail
 
 template <typename T> struct is_variant_like {
@@ -314,8 +367,7 @@ template <typename T, typename C> struct is_variant_formattable {
 
 FMT_EXPORT
 template <typename Char> struct formatter<std::monostate, Char> {
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     return ctx.begin();
   }
 
@@ -332,8 +384,7 @@ struct formatter<
     Variant, Char,
     std::enable_if_t<std::conjunction_v<
         is_variant_like<Variant>, is_variant_formattable<Variant, Char>>>> {
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     return ctx.begin();
   }
 
@@ -346,7 +397,7 @@ struct formatter<
     FMT_TRY {
       std::visit(
           [&](const auto& v) {
-            out = detail::write_variant_alternative<Char>(out, v);
+            out = detail::write_escaped_alternative<Char>(out, v);
           },
           value);
     }
@@ -362,22 +413,127 @@ FMT_END_NAMESPACE
 
 FMT_BEGIN_NAMESPACE
 FMT_EXPORT
-template <typename Char> struct formatter<std::error_code, Char> {
-  template <typename ParseContext>
-  FMT_CONSTEXPR auto parse(ParseContext& ctx) -> decltype(ctx.begin()) {
-    return ctx.begin();
+template <> struct formatter<std::error_code> {
+ private:
+  format_specs specs_;
+  detail::arg_ref<char> width_ref_;
+
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<>& ctx) -> const char* {
+    auto it = ctx.begin(), end = ctx.end();
+    if (it == end) return it;
+
+    it = detail::parse_align(it, end, specs_);
+    if (it == end) return it;
+
+    char c = *it;
+    if ((c >= '0' && c <= '9') || c == '{')
+      it = detail::parse_width(it, end, specs_, width_ref_, ctx);
+    return it;
   }
 
   template <typename FormatContext>
-  FMT_CONSTEXPR auto format(const std::error_code& ec, FormatContext& ctx) const
+  FMT_CONSTEXPR20 auto format(const std::error_code& ec,
+                              FormatContext& ctx) const -> decltype(ctx.out()) {
+    auto specs = specs_;
+    detail::handle_dynamic_spec(specs.dynamic_width(), specs.width, width_ref_,
+                                ctx);
+    memory_buffer buf;
+    buf.append(string_view(ec.category().name()));
+    buf.push_back(':');
+    detail::write<char>(appender(buf), ec.value());
+    return detail::write<char>(ctx.out(), string_view(buf.data(), buf.size()),
+                               specs);
+  }
+};
+
+#if FMT_USE_RTTI
+namespace detail {
+
+template <typename Char, typename OutputIt>
+auto write_demangled_name(OutputIt out, const std::type_info& ti) -> OutputIt {
+#  ifdef FMT_HAS_ABI_CXA_DEMANGLE
+  int status = 0;
+  std::size_t size = 0;
+  std::unique_ptr<char, void (*)(void*)> demangled_name_ptr(
+      abi::__cxa_demangle(ti.name(), nullptr, &size, &status), &std::free);
+
+  string_view demangled_name_view;
+  if (demangled_name_ptr) {
+    demangled_name_view = demangled_name_ptr.get();
+
+    // Normalization of stdlib inline namespace names.
+    // libc++ inline namespaces.
+    //  std::__1::*       -> std::*
+    //  std::__1::__fs::* -> std::*
+    // libstdc++ inline namespaces.
+    //  std::__cxx11::*             -> std::*
+    //  std::filesystem::__cxx11::* -> std::filesystem::*
+    if (demangled_name_view.starts_with("std::")) {
+      char* begin = demangled_name_ptr.get();
+      char* to = begin + 5;  // std::
+      for (char *from = to, *end = begin + demangled_name_view.size();
+           from < end;) {
+        // This is safe, because demangled_name is NUL-terminated.
+        if (from[0] == '_' && from[1] == '_') {
+          char* next = from + 1;
+          while (next < end && *next != ':') next++;
+          if (next[0] == ':' && next[1] == ':') {
+            from = next + 2;
+            continue;
+          }
+        }
+        *to++ = *from++;
+      }
+      demangled_name_view = {begin, detail::to_unsigned(to - begin)};
+    }
+  } else {
+    demangled_name_view = string_view(ti.name());
+  }
+  return detail::write_bytes<Char>(out, demangled_name_view);
+#  elif FMT_MSC_VERSION
+  const string_view demangled_name(ti.name());
+  for (std::size_t i = 0; i < demangled_name.size(); ++i) {
+    auto sub = demangled_name;
+    sub.remove_prefix(i);
+    if (sub.starts_with("enum ")) {
+      i += 4;
+      continue;
+    }
+    if (sub.starts_with("class ") || sub.starts_with("union ")) {
+      i += 5;
+      continue;
+    }
+    if (sub.starts_with("struct ")) {
+      i += 6;
+      continue;
+    }
+    if (*sub.begin() != ' ') *out++ = *sub.begin();
+  }
+  return out;
+#  else
+  return detail::write_bytes<Char>(out, string_view(ti.name()));
+#  endif
+}
+
+}  // namespace detail
+
+FMT_EXPORT
+template <typename Char>
+struct formatter<std::type_info, Char  // DEPRECATED! Mixing code unit types.
+                 > {
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    return ctx.begin();
+  }
+
+  template <typename Context>
+  auto format(const std::type_info& ti, Context& ctx) const
       -> decltype(ctx.out()) {
-    auto out = ctx.out();
-    out = detail::write_bytes(out, ec.category().name(), format_specs<Char>());
-    out = detail::write<Char>(out, Char(':'));
-    out = detail::write<Char>(out, ec.value());
-    return out;
+    return detail::write_demangled_name<Char>(ctx.out(), ti);
   }
 };
+#endif
 
 FMT_EXPORT
 template <typename T, typename Char>
@@ -388,81 +544,29 @@ struct formatter<
   bool with_typename_ = false;
 
  public:
-  FMT_CONSTEXPR auto parse(basic_format_parse_context<Char>& ctx)
-      -> decltype(ctx.begin()) {
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
     auto it = ctx.begin();
     auto end = ctx.end();
     if (it == end || *it == '}') return it;
     if (*it == 't') {
       ++it;
-      with_typename_ = FMT_USE_TYPEID != 0;
+      with_typename_ = FMT_USE_RTTI != 0;
     }
     return it;
   }
 
-  template <typename OutputIt>
-  auto format(const std::exception& ex,
-              basic_format_context<OutputIt, Char>& ctx) const -> OutputIt {
-    format_specs<Char> spec;
+  template <typename Context>
+  auto format(const std::exception& ex, Context& ctx) const
+      -> decltype(ctx.out()) {
     auto out = ctx.out();
-    if (!with_typename_)
-      return detail::write_bytes(out, string_view(ex.what()), spec);
-
-#if FMT_USE_TYPEID
-    const std::type_info& ti = typeid(ex);
-#  ifdef FMT_HAS_ABI_CXA_DEMANGLE
-    int status = 0;
-    std::size_t size = 0;
-    std::unique_ptr<char, void (*)(void*)> demangled_name_ptr(
-        abi::__cxa_demangle(ti.name(), nullptr, &size, &status), &std::free);
-
-    string_view demangled_name_view;
-    if (demangled_name_ptr) {
-      demangled_name_view = demangled_name_ptr.get();
-
-      // Normalization of stdlib inline namespace names.
-      // libc++ inline namespaces.
-      //  std::__1::*       -> std::*
-      //  std::__1::__fs::* -> std::*
-      // libstdc++ inline namespaces.
-      //  std::__cxx11::*             -> std::*
-      //  std::filesystem::__cxx11::* -> std::filesystem::*
-      if (demangled_name_view.starts_with("std::")) {
-        char* begin = demangled_name_ptr.get();
-        char* to = begin + 5;  // std::
-        for (char *from = to, *end = begin + demangled_name_view.size();
-             from < end;) {
-          // This is safe, because demangled_name is NUL-terminated.
-          if (from[0] == '_' && from[1] == '_') {
-            char* next = from + 1;
-            while (next < end && *next != ':') next++;
-            if (next[0] == ':' && next[1] == ':') {
-              from = next + 2;
-              continue;
-            }
-          }
-          *to++ = *from++;
-        }
-        demangled_name_view = {begin, detail::to_unsigned(to - begin)};
-      }
-    } else {
-      demangled_name_view = string_view(ti.name());
+#if FMT_USE_RTTI
+    if (with_typename_) {
+      out = detail::write_demangled_name<Char>(out, typeid(ex));
+      *out++ = ':';
+      *out++ = ' ';
     }
-    out = detail::write_bytes(out, demangled_name_view, spec);
-#  elif FMT_MSC_VERSION
-    string_view demangled_name_view(ti.name());
-    if (demangled_name_view.starts_with("class "))
-      demangled_name_view.remove_prefix(6);
-    else if (demangled_name_view.starts_with("struct "))
-      demangled_name_view.remove_prefix(7);
-    out = detail::write_bytes(out, demangled_name_view, spec);
-#  else
-    out = detail::write_bytes(out, string_view(ti.name()), spec);
-#  endif
-    *out++ = ':';
-    *out++ = ' ';
-    return detail::write_bytes(out, string_view(ex.what()), spec);
 #endif
+    return detail::write_bytes<Char>(out, string_view(ex.what()));
   }
 };
 
@@ -509,6 +613,14 @@ struct formatter<BitRef, Char,
   }
 };
 
+template <typename T, typename Deleter>
+auto ptr(const std::unique_ptr<T, Deleter>& p) -> const void* {
+  return p.get();
+}
+template <typename T> auto ptr(const std::shared_ptr<T>& p) -> const void* {
+  return p.get();
+}
+
 FMT_EXPORT
 template <typename T, typename Char>
 struct formatter<std::atomic<T>, Char,
@@ -533,5 +645,82 @@ struct formatter<std::atomic_flag, Char> : formatter<bool, Char> {
 };
 #endif  // __cpp_lib_atomic_flag_test
 
+FMT_EXPORT
+template <typename T, typename Char> struct formatter<std::complex<T>, Char> {
+ private:
+  detail::dynamic_format_specs<Char> specs_;
+
+  template <typename FormatContext, typename OutputIt>
+  FMT_CONSTEXPR auto do_format(const std::complex<T>& c,
+                               detail::dynamic_format_specs<Char>& specs,
+                               FormatContext& ctx, OutputIt out) const
+      -> OutputIt {
+    if (c.real() != 0) {
+      *out++ = Char('(');
+      out = detail::write<Char>(out, c.real(), specs, ctx.locale());
+      specs.set_sign(sign::plus);
+      out = detail::write<Char>(out, c.imag(), specs, ctx.locale());
+      if (!detail::isfinite(c.imag())) *out++ = Char(' ');
+      *out++ = Char('i');
+      *out++ = Char(')');
+      return out;
+    }
+    out = detail::write<Char>(out, c.imag(), specs, ctx.locale());
+    if (!detail::isfinite(c.imag())) *out++ = Char(' ');
+    *out++ = Char('i');
+    return out;
+  }
+
+ public:
+  FMT_CONSTEXPR auto parse(parse_context<Char>& ctx) -> const Char* {
+    if (ctx.begin() == ctx.end() || *ctx.begin() == '}') return ctx.begin();
+    return parse_format_specs(ctx.begin(), ctx.end(), specs_, ctx,
+                              detail::type_constant<T, Char>::value);
+  }
+
+  template <typename FormatContext>
+  auto format(const std::complex<T>& c, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    auto specs = specs_;
+    if (specs.dynamic()) {
+      detail::handle_dynamic_spec(specs.dynamic_width(), specs.width,
+                                  specs.width_ref, ctx);
+      detail::handle_dynamic_spec(specs.dynamic_precision(), specs.precision,
+                                  specs.precision_ref, ctx);
+    }
+
+    if (specs.width == 0) return do_format(c, specs, ctx, ctx.out());
+    auto buf = basic_memory_buffer<Char>();
+
+    auto outer_specs = format_specs();
+    outer_specs.width = specs.width;
+    auto fill = specs.template fill<Char>();
+    if (fill)
+      outer_specs.set_fill(basic_string_view<Char>(fill, specs.fill_size()));
+    outer_specs.set_align(specs.align());
+
+    specs.width = 0;
+    specs.set_fill({});
+    specs.set_align(align::none);
+
+    do_format(c, specs, ctx, basic_appender<Char>(buf));
+    return detail::write<Char>(ctx.out(),
+                               basic_string_view<Char>(buf.data(), buf.size()),
+                               outer_specs);
+  }
+};
+
+FMT_EXPORT
+template <typename T, typename Char>
+struct formatter<std::reference_wrapper<T>, Char,
+                 enable_if_t<is_formattable<remove_cvref_t<T>, Char>::value>>
+    : formatter<remove_cvref_t<T>, Char> {
+  template <typename FormatContext>
+  auto format(std::reference_wrapper<T> ref, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
+    return formatter<remove_cvref_t<T>, Char>::format(ref.get(), ctx);
+  }
+};
+
 FMT_END_NAMESPACE
 #endif  // FMT_STD_H_
diff --git a/include/fmt/xchar.h b/include/fmt/xchar.h
index f609c5c4..08f11231 100644
--- a/include/fmt/xchar.h
+++ b/include/fmt/xchar.h
@@ -8,12 +8,16 @@
 #ifndef FMT_XCHAR_H_
 #define FMT_XCHAR_H_
 
-#include <cwchar>
-
+#include "color.h"
 #include "format.h"
-
-#ifndef FMT_STATIC_THOUSANDS_SEPARATOR
-#  include <locale>
+#include "ostream.h"
+#include "ranges.h"
+
+#ifndef FMT_MODULE
+#  include <cwchar>
+#  if FMT_USE_LOCALE
+#    include <locale>
+#  endif
 #endif
 
 FMT_BEGIN_NAMESPACE
@@ -22,10 +26,26 @@ namespace detail {
 template <typename T>
 using is_exotic_char = bool_constant<!std::is_same<T, char>::value>;
 
-inline auto write_loc(std::back_insert_iterator<detail::buffer<wchar_t>> out,
-                      loc_value value, const format_specs<wchar_t>& specs,
-                      locale_ref loc) -> bool {
-#ifndef FMT_STATIC_THOUSANDS_SEPARATOR
+template <typename S, typename = void> struct format_string_char {};
+
+template <typename S>
+struct format_string_char<
+    S, void_t<decltype(sizeof(detail::to_string_view(std::declval<S>())))>> {
+  using type = char_t<S>;
+};
+
+template <typename S>
+struct format_string_char<
+    S, enable_if_t<std::is_base_of<detail::compile_string, S>::value>> {
+  using type = typename S::char_type;
+};
+
+template <typename S>
+using format_string_char_t = typename format_string_char<S>::type;
+
+inline auto write_loc(basic_appender<wchar_t> out, loc_value value,
+                      const format_specs& specs, locale_ref loc) -> bool {
+#if FMT_USE_LOCALE
   auto& numpunct =
       std::use_facet<std::numpunct<wchar_t>>(loc.get<std::locale>());
   auto separator = std::wstring();
@@ -40,42 +60,79 @@ inline auto write_loc(std::back_insert_iterator<detail::buffer<wchar_t>> out,
 FMT_BEGIN_EXPORT
 
 using wstring_view = basic_string_view<wchar_t>;
-using wformat_parse_context = basic_format_parse_context<wchar_t>;
-using wformat_context = buffer_context<wchar_t>;
+using wformat_parse_context = parse_context<wchar_t>;
+using wformat_context = buffered_context<wchar_t>;
 using wformat_args = basic_format_args<wformat_context>;
 using wmemory_buffer = basic_memory_buffer<wchar_t>;
 
-#if FMT_GCC_VERSION && FMT_GCC_VERSION < 409
-// Workaround broken conversion on older gcc.
-template <typename... Args> using wformat_string = wstring_view;
-inline auto runtime(wstring_view s) -> wstring_view { return s; }
-#else
-template <typename... Args>
-using wformat_string = basic_format_string<wchar_t, type_identity_t<Args>...>;
+template <typename Char, typename... T> struct basic_fstring {
+ private:
+  basic_string_view<Char> str_;
+
+  static constexpr int num_static_named_args =
+      detail::count_static_named_args<T...>();
+
+  using checker = detail::format_string_checker<
+      Char, static_cast<int>(sizeof...(T)), num_static_named_args,
+      num_static_named_args != detail::count_named_args<T...>()>;
+
+  using arg_pack = detail::arg_pack<T...>;
+
+ public:
+  using t = basic_fstring;
+
+  template <typename S,
+            FMT_ENABLE_IF(
+                std::is_convertible<const S&, basic_string_view<Char>>::value)>
+  FMT_CONSTEVAL FMT_ALWAYS_INLINE basic_fstring(const S& s) : str_(s) {
+    if (FMT_USE_CONSTEVAL)
+      detail::parse_format_string<Char>(s, checker(s, arg_pack()));
+  }
+  template <typename S,
+            FMT_ENABLE_IF(std::is_base_of<detail::compile_string, S>::value&&
+                              std::is_same<typename S::char_type, Char>::value)>
+  FMT_ALWAYS_INLINE basic_fstring(const S&) : str_(S()) {
+    FMT_CONSTEXPR auto sv = basic_string_view<Char>(S());
+    FMT_CONSTEXPR int ignore =
+        (parse_format_string(sv, checker(sv, arg_pack())), 0);
+    detail::ignore_unused(ignore);
+  }
+  basic_fstring(runtime_format_string<Char> fmt) : str_(fmt.str) {}
+
+  operator basic_string_view<Char>() const { return str_; }
+  auto get() const -> basic_string_view<Char> { return str_; }
+};
+
+template <typename Char, typename... T>
+using basic_format_string = basic_fstring<Char, T...>;
+
+template <typename... T>
+using wformat_string = typename basic_format_string<wchar_t, T...>::t;
 inline auto runtime(wstring_view s) -> runtime_format_string<wchar_t> {
   return {{s}};
 }
-#endif
 
 template <> struct is_char<wchar_t> : std::true_type {};
-template <> struct is_char<detail::char8_type> : std::true_type {};
 template <> struct is_char<char16_t> : std::true_type {};
 template <> struct is_char<char32_t> : std::true_type {};
 
+#ifdef __cpp_char8_t
+template <> struct is_char<char8_t> : bool_constant<detail::is_utf8_enabled> {};
+#endif
+
 template <typename... T>
-constexpr auto make_wformat_args(const T&... args)
-    -> format_arg_store<wformat_context, T...> {
-  return {args...};
+constexpr auto make_wformat_args(T&... args)
+    -> decltype(fmt::make_format_args<wformat_context>(args...)) {
+  return fmt::make_format_args<wformat_context>(args...);
 }
 
+#if !FMT_USE_NONTYPE_TEMPLATE_ARGS
 inline namespace literals {
-#if FMT_USE_USER_DEFINED_LITERALS && !FMT_USE_NONTYPE_TEMPLATE_ARGS
-constexpr auto operator""_a(const wchar_t* s, size_t)
-    -> detail::udl_arg<wchar_t> {
+inline auto operator""_a(const wchar_t* s, size_t) -> detail::udl_arg<wchar_t> {
   return {s};
 }
-#endif
 }  // namespace literals
+#endif
 
 template <typename It, typename Sentinel>
 auto join(It begin, Sentinel end, wstring_view sep)
@@ -85,7 +142,7 @@ auto join(It begin, Sentinel end, wstring_view sep)
 
 template <typename Range>
 auto join(Range&& range, wstring_view sep)
-    -> join_view<detail::iterator_t<Range>, detail::sentinel_t<Range>,
+    -> join_view<decltype(std::begin(range)), decltype(std::end(range)),
                  wchar_t> {
   return join(std::begin(range), std::end(range), sep);
 }
@@ -96,13 +153,19 @@ auto join(std::initializer_list<T> list, wstring_view sep)
   return join(std::begin(list), std::end(list), sep);
 }
 
+template <typename... T>
+auto join(const std::tuple<T...>& tuple, basic_string_view<wchar_t> sep)
+    -> tuple_join_view<wchar_t, T...> {
+  return {tuple, sep};
+}
+
 template <typename Char, FMT_ENABLE_IF(!std::is_same<Char, char>::value)>
-auto vformat(basic_string_view<Char> format_str,
-             basic_format_args<buffer_context<type_identity_t<Char>>> args)
+auto vformat(basic_string_view<Char> fmt,
+             typename detail::vformat_args<Char>::type args)
     -> std::basic_string<Char> {
   auto buf = basic_memory_buffer<Char>();
-  detail::vformat_to(buf, format_str, args);
-  return to_string(buf);
+  detail::vformat_to(buf, fmt, args);
+  return {buf.data(), buf.size()};
 }
 
 template <typename... T>
@@ -110,110 +173,117 @@ auto format(wformat_string<T...> fmt, T&&... args) -> std::wstring {
   return vformat(fmt::wstring_view(fmt), fmt::make_wformat_args(args...));
 }
 
+template <typename OutputIt, typename... T>
+auto format_to(OutputIt out, wformat_string<T...> fmt, T&&... args)
+    -> OutputIt {
+  return vformat_to(out, fmt::wstring_view(fmt),
+                    fmt::make_wformat_args(args...));
+}
+
 // Pass char_t as a default template parameter instead of using
 // std::basic_string<char_t<S>> to reduce the symbol size.
-template <typename S, typename... T, typename Char = char_t<S>,
+template <typename S, typename... T,
+          typename Char = detail::format_string_char_t<S>,
           FMT_ENABLE_IF(!std::is_same<Char, char>::value &&
                         !std::is_same<Char, wchar_t>::value)>
-auto format(const S& format_str, T&&... args) -> std::basic_string<Char> {
-  return vformat(detail::to_string_view(format_str),
-                 fmt::make_format_args<buffer_context<Char>>(args...));
+auto format(const S& fmt, T&&... args) -> std::basic_string<Char> {
+  return vformat(detail::to_string_view(fmt),
+                 fmt::make_format_args<buffered_context<Char>>(args...));
 }
 
-template <typename Locale, typename S, typename Char = char_t<S>,
-          FMT_ENABLE_IF(detail::is_locale<Locale>::value&&
-                            detail::is_exotic_char<Char>::value)>
-inline auto vformat(
-    const Locale& loc, const S& format_str,
-    basic_format_args<buffer_context<type_identity_t<Char>>> args)
+template <typename S, typename Char = detail::format_string_char_t<S>,
+          FMT_ENABLE_IF(detail::is_exotic_char<Char>::value)>
+inline auto vformat(detail::locale_ref loc, const S& fmt,
+                    typename detail::vformat_args<Char>::type args)
     -> std::basic_string<Char> {
-  return detail::vformat(loc, detail::to_string_view(format_str), args);
+  auto buf = basic_memory_buffer<Char>();
+  detail::vformat_to(buf, detail::to_string_view(fmt), args,
+                     detail::locale_ref(loc));
+  return {buf.data(), buf.size()};
 }
 
-template <typename Locale, typename S, typename... T, typename Char = char_t<S>,
-          FMT_ENABLE_IF(detail::is_locale<Locale>::value&&
-                            detail::is_exotic_char<Char>::value)>
-inline auto format(const Locale& loc, const S& format_str, T&&... args)
+template <typename S, typename... T,
+          typename Char = detail::format_string_char_t<S>,
+          FMT_ENABLE_IF(detail::is_exotic_char<Char>::value)>
+inline auto format(detail::locale_ref loc, const S& fmt, T&&... args)
     -> std::basic_string<Char> {
-  return detail::vformat(loc, detail::to_string_view(format_str),
-                         fmt::make_format_args<buffer_context<Char>>(args...));
+  return vformat(loc, detail::to_string_view(fmt),
+                 fmt::make_format_args<buffered_context<Char>>(args...));
 }
 
-template <typename OutputIt, typename S, typename Char = char_t<S>,
+template <typename OutputIt, typename S,
+          typename Char = detail::format_string_char_t<S>,
           FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, Char>::value&&
                             detail::is_exotic_char<Char>::value)>
-auto vformat_to(OutputIt out, const S& format_str,
-                basic_format_args<buffer_context<type_identity_t<Char>>> args)
-    -> OutputIt {
+auto vformat_to(OutputIt out, const S& fmt,
+                typename detail::vformat_args<Char>::type args) -> OutputIt {
   auto&& buf = detail::get_buffer<Char>(out);
-  detail::vformat_to(buf, detail::to_string_view(format_str), args);
+  detail::vformat_to(buf, detail::to_string_view(fmt), args);
   return detail::get_iterator(buf, out);
 }
 
 template <typename OutputIt, typename S, typename... T,
-          typename Char = char_t<S>,
-          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, Char>::value&&
-                            detail::is_exotic_char<Char>::value)>
+          typename Char = detail::format_string_char_t<S>,
+          FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, Char>::value &&
+                        !std::is_same<Char, char>::value &&
+                        !std::is_same<Char, wchar_t>::value)>
 inline auto format_to(OutputIt out, const S& fmt, T&&... args) -> OutputIt {
   return vformat_to(out, detail::to_string_view(fmt),
-                    fmt::make_format_args<buffer_context<Char>>(args...));
+                    fmt::make_format_args<buffered_context<Char>>(args...));
 }
 
-template <typename Locale, typename S, typename OutputIt, typename... Args,
-          typename Char = char_t<S>,
+template <typename S, typename OutputIt, typename... Args,
+          typename Char = detail::format_string_char_t<S>,
           FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, Char>::value&&
-                            detail::is_locale<Locale>::value&&
-                                detail::is_exotic_char<Char>::value)>
-inline auto vformat_to(
-    OutputIt out, const Locale& loc, const S& format_str,
-    basic_format_args<buffer_context<type_identity_t<Char>>> args) -> OutputIt {
+                            detail::is_exotic_char<Char>::value)>
+inline auto vformat_to(OutputIt out, detail::locale_ref loc, const S& fmt,
+                       typename detail::vformat_args<Char>::type args)
+    -> OutputIt {
   auto&& buf = detail::get_buffer<Char>(out);
-  vformat_to(buf, detail::to_string_view(format_str), args,
-             detail::locale_ref(loc));
+  vformat_to(buf, detail::to_string_view(fmt), args, detail::locale_ref(loc));
   return detail::get_iterator(buf, out);
 }
 
-template <typename OutputIt, typename Locale, typename S, typename... T,
-          typename Char = char_t<S>,
+template <typename OutputIt, typename S, typename... T,
+          typename Char = detail::format_string_char_t<S>,
           bool enable = detail::is_output_iterator<OutputIt, Char>::value &&
-                        detail::is_locale<Locale>::value &&
                         detail::is_exotic_char<Char>::value>
-inline auto format_to(OutputIt out, const Locale& loc, const S& format_str,
+inline auto format_to(OutputIt out, detail::locale_ref loc, const S& fmt,
                       T&&... args) ->
     typename std::enable_if<enable, OutputIt>::type {
-  return vformat_to(out, loc, detail::to_string_view(format_str),
-                    fmt::make_format_args<buffer_context<Char>>(args...));
+  return vformat_to(out, loc, detail::to_string_view(fmt),
+                    fmt::make_format_args<buffered_context<Char>>(args...));
 }
 
 template <typename OutputIt, typename Char, typename... Args,
           FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, Char>::value&&
                             detail::is_exotic_char<Char>::value)>
-inline auto vformat_to_n(
-    OutputIt out, size_t n, basic_string_view<Char> format_str,
-    basic_format_args<buffer_context<type_identity_t<Char>>> args)
+inline auto vformat_to_n(OutputIt out, size_t n, basic_string_view<Char> fmt,
+                         typename detail::vformat_args<Char>::type args)
     -> format_to_n_result<OutputIt> {
   using traits = detail::fixed_buffer_traits;
   auto buf = detail::iterator_buffer<OutputIt, Char, traits>(out, n);
-  detail::vformat_to(buf, format_str, args);
+  detail::vformat_to(buf, fmt, args);
   return {buf.out(), buf.count()};
 }
 
 template <typename OutputIt, typename S, typename... T,
-          typename Char = char_t<S>,
+          typename Char = detail::format_string_char_t<S>,
           FMT_ENABLE_IF(detail::is_output_iterator<OutputIt, Char>::value&&
                             detail::is_exotic_char<Char>::value)>
 inline auto format_to_n(OutputIt out, size_t n, const S& fmt, T&&... args)
     -> format_to_n_result<OutputIt> {
-  return vformat_to_n(out, n, detail::to_string_view(fmt),
-                      fmt::make_format_args<buffer_context<Char>>(args...));
+  return vformat_to_n(out, n, fmt::basic_string_view<Char>(fmt),
+                      fmt::make_format_args<buffered_context<Char>>(args...));
 }
 
-template <typename S, typename... T, typename Char = char_t<S>,
+template <typename S, typename... T,
+          typename Char = detail::format_string_char_t<S>,
           FMT_ENABLE_IF(detail::is_exotic_char<Char>::value)>
 inline auto formatted_size(const S& fmt, T&&... args) -> size_t {
   auto buf = detail::counting_buffer<Char>();
   detail::vformat_to(buf, detail::to_string_view(fmt),
-                     fmt::make_format_args<buffer_context<Char>>(args...));
+                     fmt::make_format_args<buffered_context<Char>>(args...));
   return buf.count();
 }
 
@@ -247,9 +317,48 @@ template <typename... T> void println(wformat_string<T...> fmt, T&&... args) {
   return print(L"{}\n", fmt::format(fmt, std::forward<T>(args)...));
 }
 
-/**
-  Converts *value* to ``std::wstring`` using the default format for type *T*.
- */
+inline auto vformat(const text_style& ts, wstring_view fmt, wformat_args args)
+    -> std::wstring {
+  auto buf = wmemory_buffer();
+  detail::vformat_to(buf, ts, fmt, args);
+  return {buf.data(), buf.size()};
+}
+
+template <typename... T>
+inline auto format(const text_style& ts, wformat_string<T...> fmt, T&&... args)
+    -> std::wstring {
+  return fmt::vformat(ts, fmt, fmt::make_wformat_args(args...));
+}
+
+template <typename... T>
+FMT_DEPRECATED void print(std::FILE* f, const text_style& ts,
+                          wformat_string<T...> fmt, const T&... args) {
+  vprint(f, ts, fmt, fmt::make_wformat_args(args...));
+}
+
+template <typename... T>
+FMT_DEPRECATED void print(const text_style& ts, wformat_string<T...> fmt,
+                          const T&... args) {
+  return print(stdout, ts, fmt, args...);
+}
+
+inline void vprint(std::wostream& os, wstring_view fmt, wformat_args args) {
+  auto buffer = basic_memory_buffer<wchar_t>();
+  detail::vformat_to(buffer, fmt, args);
+  detail::write_buffer(os, buffer);
+}
+
+template <typename... T>
+void print(std::wostream& os, wformat_string<T...> fmt, T&&... args) {
+  vprint(os, fmt, fmt::make_format_args<buffered_context<wchar_t>>(args...));
+}
+
+template <typename... T>
+void println(std::wostream& os, wformat_string<T...> fmt, T&&... args) {
+  print(os, L"{}\n", fmt::format(fmt, std::forward<T>(args)...));
+}
+
+/// Converts `value` to `std::wstring` using the default format for type `T`.
 template <typename T> inline auto to_wstring(const T& value) -> std::wstring {
   return format(FMT_STRING(L"{}"), value);
 }
diff --git a/src/fmt.cc b/src/fmt.cc
index 5330463a..2dc4ef2f 100644
--- a/src/fmt.cc
+++ b/src/fmt.cc
@@ -1,38 +1,57 @@
 module;
 
+#ifdef _MSVC_LANG
+#  define FMT_CPLUSPLUS _MSVC_LANG
+#else
+#  define FMT_CPLUSPLUS __cplusplus
+#endif
+
 // Put all implementation-provided headers into the global module fragment
 // to prevent attachment to this module.
-#include <algorithm>
+#ifndef FMT_IMPORT_STD
+#  include <algorithm>
+#  include <bitset>
+#  include <chrono>
+#  include <cmath>
+#  include <complex>
+#  include <cstddef>
+#  include <cstdint>
+#  include <cstdio>
+#  include <cstdlib>
+#  include <cstring>
+#  include <ctime>
+#  include <exception>
+#  if FMT_CPLUSPLUS > 202002L
+#    include <expected>
+#  endif
+#  include <filesystem>
+#  include <fstream>
+#  include <functional>
+#  include <iterator>
+#  include <limits>
+#  include <locale>
+#  include <memory>
+#  include <optional>
+#  include <ostream>
+#  include <source_location>
+#  include <stdexcept>
+#  include <string>
+#  include <string_view>
+#  include <system_error>
+#  include <thread>
+#  include <type_traits>
+#  include <typeinfo>
+#  include <utility>
+#  include <variant>
+#  include <vector>
+#else
+#  include <limits.h>
+#  include <stdint.h>
+#  include <stdio.h>
+#  include <time.h>
+#endif
 #include <cerrno>
-#include <chrono>
 #include <climits>
-#include <cmath>
-#include <cstddef>
-#include <cstdint>
-#include <cstdio>
-#include <cstdlib>
-#include <cstring>
-#include <ctime>
-#include <exception>
-#include <filesystem>
-#include <fstream>
-#include <functional>
-#include <iterator>
-#include <limits>
-#include <locale>
-#include <memory>
-#include <optional>
-#include <ostream>
-#include <stdexcept>
-#include <string>
-#include <string_view>
-#include <system_error>
-#include <thread>
-#include <type_traits>
-#include <typeinfo>
-#include <utility>
-#include <variant>
-#include <vector>
 #include <version>
 
 #if __has_include(<cxxabi.h>)
@@ -70,6 +89,10 @@ module;
 
 export module fmt;
 
+#ifdef FMT_IMPORT_STD
+import std;
+#endif
+
 #define FMT_EXPORT export
 #define FMT_BEGIN_EXPORT export {
 #define FMT_END_EXPORT }
@@ -83,6 +106,10 @@ export module fmt;
 extern "C++" {
 #endif
 
+#ifndef FMT_OS
+#  define FMT_OS 1
+#endif
+
 // All library-provided declarations and definitions must be in the module
 // purview to be exported.
 #include "fmt/args.h"
@@ -90,8 +117,12 @@ extern "C++" {
 #include "fmt/color.h"
 #include "fmt/compile.h"
 #include "fmt/format.h"
-#include "fmt/os.h"
+#if FMT_OS
+#  include "fmt/os.h"
+#endif
+#include "fmt/ostream.h"
 #include "fmt/printf.h"
+#include "fmt/ranges.h"
 #include "fmt/std.h"
 #include "fmt/xchar.h"
 
@@ -104,5 +135,17 @@ extern "C++" {
 module :private;
 #endif
 
-#include "format.cc"
-#include "os.cc"
+#ifdef FMT_ATTACH_TO_GLOBAL_MODULE
+extern "C++" {
+#endif
+
+#if FMT_HAS_INCLUDE("format.cc")
+#  include "format.cc"
+#endif
+#if FMT_OS && FMT_HAS_INCLUDE("os.cc")
+#  include "os.cc"
+#endif
+
+#ifdef FMT_ATTACH_TO_GLOBAL_MODULE
+}
+#endif
diff --git a/src/format.cc b/src/format.cc
index 391d3a24..3ccd8068 100644
--- a/src/format.cc
+++ b/src/format.cc
@@ -15,7 +15,8 @@ template FMT_API auto dragonbox::to_decimal(float x) noexcept
 template FMT_API auto dragonbox::to_decimal(double x) noexcept
     -> dragonbox::decimal_fp<double>;
 
-#ifndef FMT_STATIC_THOUSANDS_SEPARATOR
+#if FMT_USE_LOCALE
+// DEPRECATED! locale_ref in the detail namespace
 template FMT_API locale_ref::locale_ref(const std::locale& loc);
 template FMT_API auto locale_ref::get<std::locale>() const -> std::locale;
 #endif
@@ -26,8 +27,10 @@ template FMT_API auto thousands_sep_impl(locale_ref)
     -> thousands_sep_result<char>;
 template FMT_API auto decimal_point_impl(locale_ref) -> char;
 
+// DEPRECATED!
 template FMT_API void buffer<char>::append(const char*, const char*);
 
+// DEPRECATED!
 template FMT_API void vformat_to(buffer<char>&, string_view,
                                  typename vformat_args<>::type, locale_ref);
 
diff --git a/src/os.cc b/src/os.cc
index a639e78c..c833a051 100644
--- a/src/os.cc
+++ b/src/os.cc
@@ -12,47 +12,51 @@
 
 #include "fmt/os.h"
 
-#include <climits>
+#ifndef FMT_MODULE
+#  include <climits>
 
-#if FMT_USE_FCNTL
-#  include <sys/stat.h>
-#  include <sys/types.h>
-
-#  ifdef _WRS_KERNEL    // VxWorks7 kernel
-#    include <ioLib.h>  // getpagesize
-#  endif
+#  if FMT_USE_FCNTL
+#    include <sys/stat.h>
+#    include <sys/types.h>
 
-#  ifndef _WIN32
-#    include <unistd.h>
-#  else
-#    ifndef WIN32_LEAN_AND_MEAN
-#      define WIN32_LEAN_AND_MEAN
+#    ifdef _WRS_KERNEL    // VxWorks7 kernel
+#      include <ioLib.h>  // getpagesize
 #    endif
-#    include <io.h>
 
-#    ifndef S_IRUSR
-#      define S_IRUSR _S_IREAD
-#    endif
-#    ifndef S_IWUSR
-#      define S_IWUSR _S_IWRITE
-#    endif
-#    ifndef S_IRGRP
-#      define S_IRGRP 0
-#    endif
-#    ifndef S_IWGRP
-#      define S_IWGRP 0
-#    endif
-#    ifndef S_IROTH
-#      define S_IROTH 0
-#    endif
-#    ifndef S_IWOTH
-#      define S_IWOTH 0
-#    endif
-#  endif  // _WIN32
-#endif    // FMT_USE_FCNTL
+#    ifndef _WIN32
+#      include <unistd.h>
+#    else
+#      ifndef WIN32_LEAN_AND_MEAN
+#        define WIN32_LEAN_AND_MEAN
+#      endif
+#      include <io.h>
+#    endif  // _WIN32
+#  endif    // FMT_USE_FCNTL
+
+#  ifdef _WIN32
+#    include <windows.h>
+#  endif
+#endif
 
 #ifdef _WIN32
-#  include <windows.h>
+#  ifndef S_IRUSR
+#    define S_IRUSR _S_IREAD
+#  endif
+#  ifndef S_IWUSR
+#    define S_IWUSR _S_IWRITE
+#  endif
+#  ifndef S_IRGRP
+#    define S_IRGRP 0
+#  endif
+#  ifndef S_IWGRP
+#    define S_IWGRP 0
+#  endif
+#  ifndef S_IROTH
+#    define S_IROTH 0
+#  endif
+#  ifndef S_IWOTH
+#    define S_IWOTH 0
+#  endif
 #endif
 
 namespace {
@@ -156,7 +160,7 @@ void detail::format_windows_error(detail::buffer<char>& out, int error_code,
 }
 
 void report_windows_error(int error_code, const char* message) noexcept {
-  report_error(detail::format_windows_error, error_code, message);
+  do_report_error(detail::format_windows_error, error_code, message);
 }
 #endif  // _WIN32
 
@@ -182,12 +186,14 @@ void buffered_file::close() {
 }
 
 int buffered_file::descriptor() const {
-#if !defined(fileno)
+#ifdef FMT_HAS_SYSTEM
+  // fileno is a macro on OpenBSD.
+#  ifdef fileno
+#    undef fileno
+#  endif
   int fd = FMT_POSIX_CALL(fileno(file_));
-#elif defined(FMT_HAS_SYSTEM)
-  // fileno is a macro on OpenBSD so we cannot use FMT_POSIX_CALL.
-#  define FMT_DISABLE_MACRO
-  int fd = FMT_SYSTEM(fileno FMT_DISABLE_MACRO(file_));
+#elif defined(_WIN32)
+  int fd = _fileno(file_);
 #else
   int fd = fileno(file_);
 #endif
@@ -200,6 +206,7 @@ int buffered_file::descriptor() const {
 #  ifdef _WIN32
 using mode_t = int;
 #  endif
+
 constexpr mode_t default_open_mode =
     S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH | S_IWOTH;
 
@@ -301,29 +308,6 @@ void file::dup2(int fd, std::error_code& ec) noexcept {
   if (result == -1) ec = std::error_code(errno, std::generic_category());
 }
 
-void file::pipe(file& read_end, file& write_end) {
-  // Close the descriptors first to make sure that assignments don't throw
-  // and there are no leaks.
-  read_end.close();
-  write_end.close();
-  int fds[2] = {};
-#  ifdef _WIN32
-  // Make the default pipe capacity same as on Linux 2.6.11+.
-  enum { DEFAULT_CAPACITY = 65536 };
-  int result = FMT_POSIX_CALL(pipe(fds, DEFAULT_CAPACITY, _O_BINARY));
-#  else
-  // Don't retry as the pipe function doesn't return EINTR.
-  // http://pubs.opengroup.org/onlinepubs/009696799/functions/pipe.html
-  int result = FMT_POSIX_CALL(pipe(fds));
-#  endif
-  if (result != 0)
-    FMT_THROW(system_error(errno, FMT_STRING("cannot create pipe")));
-  // The following assignments don't throw because read_fd and write_fd
-  // are closed.
-  read_end = file(fds[0]);
-  write_end = file(fds[1]);
-}
-
 buffered_file file::fdopen(const char* mode) {
 // Don't retry as fdopen doesn't return EINTR.
 #  if defined(__MINGW32__) && defined(_POSIX_)
@@ -352,6 +336,24 @@ file file::open_windows_file(wcstring_view path, int oflag) {
 }
 #  endif
 
+pipe::pipe() {
+  int fds[2] = {};
+#  ifdef _WIN32
+  // Make the default pipe capacity same as on Linux 2.6.11+.
+  enum { DEFAULT_CAPACITY = 65536 };
+  int result = FMT_POSIX_CALL(pipe(fds, DEFAULT_CAPACITY, _O_BINARY));
+#  else
+  // Don't retry as the pipe function doesn't return EINTR.
+  // http://pubs.opengroup.org/onlinepubs/009696799/functions/pipe.html
+  int result = FMT_POSIX_CALL(pipe(fds));
+#  endif
+  if (result != 0)
+    FMT_THROW(system_error(errno, FMT_STRING("cannot create pipe")));
+  // The following assignments don't throw.
+  read_end = file(fds[0]);
+  write_end = file(fds[1]);
+}
+
 #  if !defined(__MSDOS__)
 long getpagesize() {
 #    ifdef _WIN32
@@ -372,31 +374,25 @@ long getpagesize() {
 }
 #  endif
 
-namespace detail {
-
-void file_buffer::grow(size_t) {
-  if (this->size() == this->capacity()) flush();
+void ostream::grow(buffer<char>& buf, size_t) {
+  if (buf.size() == buf.capacity()) static_cast<ostream&>(buf).flush();
 }
 
-file_buffer::file_buffer(cstring_view path,
-                         const detail::ostream_params& params)
-    : file_(path, params.oflag) {
+ostream::ostream(cstring_view path, const detail::ostream_params& params)
+    : buffer<char>(grow), file_(path, params.oflag) {
   set(new char[params.buffer_size], params.buffer_size);
 }
 
-file_buffer::file_buffer(file_buffer&& other)
-    : detail::buffer<char>(other.data(), other.size(), other.capacity()),
+ostream::ostream(ostream&& other) noexcept
+    : buffer<char>(grow, other.data(), other.size(), other.capacity()),
       file_(std::move(other.file_)) {
   other.clear();
   other.set(nullptr, 0);
 }
 
-file_buffer::~file_buffer() {
+ostream::~ostream() {
   flush();
   delete[] data();
 }
-}  // namespace detail
-
-ostream::~ostream() = default;
 #endif  // FMT_USE_FCNTL
 FMT_END_NAMESPACE
diff --git a/support/Vagrantfile b/support/Vagrantfile
index 9680a1a1..9d0ff6a5 100644
--- a/support/Vagrantfile
+++ b/support/Vagrantfile
@@ -3,10 +3,9 @@
 
 # A vagrant config for testing against gcc-4.8.
 Vagrant.configure("2") do |config|
-  config.vm.box = "ubuntu/xenial64"
-  config.disksize.size = '15GB'
+  config.vm.box = "bento/ubuntu-22.04-arm64"
 
-  config.vm.provider "virtualbox" do |vb|
+  config.vm.provider "vmware_desktop" do |vb|
     vb.memory = "4096"
   end
 
diff --git a/support/bazel/.bazelversion b/support/bazel/.bazelversion
index 5e325424..a8a18875 100644
--- a/support/bazel/.bazelversion
+++ b/support/bazel/.bazelversion
@@ -1 +1 @@
-6.1.2
+7.1.2
diff --git a/support/bazel/BUILD.bazel b/support/bazel/BUILD.bazel
index 29f639be..1a06ed52 100644
--- a/support/bazel/BUILD.bazel
+++ b/support/bazel/BUILD.bazel
@@ -1,25 +1,17 @@
 cc_library(
     name = "fmt",
     srcs = [
-        #"src/fmt.cc", # No C++ module support
+        #"src/fmt.cc", # No C++ module support, yet in Bazel (https://github.com/bazelbuild/bazel/pull/19940)
         "src/format.cc",
         "src/os.cc",
     ],
-    hdrs = [
-        "include/fmt/args.h",
-        "include/fmt/chrono.h",
-        "include/fmt/color.h",
-        "include/fmt/compile.h",
-        "include/fmt/core.h",
-        "include/fmt/format.h",
-        "include/fmt/format-inl.h",
-        "include/fmt/os.h",
-        "include/fmt/ostream.h",
-        "include/fmt/printf.h",
-        "include/fmt/ranges.h",
-        "include/fmt/std.h",
-        "include/fmt/xchar.h",
-    ],
+    hdrs = glob([
+        "include/fmt/*.h",
+    ]),
+    copts = select({
+        "@platforms//os:windows": ["-utf-8"],
+        "//conditions:default": [],
+    }),
     includes = [
         "include",
     ],
diff --git a/support/bazel/MODULE.bazel b/support/bazel/MODULE.bazel
new file mode 100644
index 00000000..6023f362
--- /dev/null
+++ b/support/bazel/MODULE.bazel
@@ -0,0 +1,6 @@
+module(
+   name = "fmt",
+   compatibility_level = 10,
+)
+
+bazel_dep(name = "platforms", version = "0.0.10")
diff --git a/support/bazel/README.md b/support/bazel/README.md
index 4c29febb..44508f1c 100644
--- a/support/bazel/README.md
+++ b/support/bazel/README.md
@@ -1,74 +1,28 @@
 # Bazel support
 
-To get [Bazel](https://bazel.build/) working with {fmt} you can copy the files `BUILD.bazel`, `WORKSPACE.bazel`, and `.bazelversion` from this folder (`support/bazel`) to the root folder of this project. This way {fmt} gets bazelized and can be used with Bazel (e.g. doing a `bazel build //...` on {fmt}). 
+To get [Bazel](https://bazel.build/) working with {fmt} you can copy the files `BUILD.bazel`, 
+`MODULE.bazel`, `WORKSPACE.bazel`, and `.bazelversion` from this folder (`support/bazel`) to the root folder of this project. 
+This way {fmt} gets bazelized and can be used with Bazel (e.g. doing a `bazel build //...` on {fmt}). 
 
 ## Using {fmt} as a dependency
 
-The following minimal example shows how to use {fmt} as a dependency within a Bazel project.
+### Using Bzlmod
 
-The following file structure is assumed:
+The [Bazel Central Registry](https://github.com/bazelbuild/bazel-central-registry/tree/main/modules/fmt) provides support for {fmt}.
 
-```
-example
- BUILD.bazel
- main.cpp
- WORKSPACE.bazel
-```
-
-*main.cpp*:
-
-```c++
-#include "fmt/core.h"
+For instance, to use {fmt} add to your `MODULE.bazel` file:
 
-int main() {
-  fmt::print("The answer is {}\n", 42);
-}
 ```
-
-The expected output of this example is `The answer is 42`.
-
-*WORKSPACE.bazel*:
-
-```python
-load("@bazel_tools//tools/build_defs/repo:git.bzl", "git_repository")
-
-git_repository(
-    name = "fmt",
-    branch = "master",
-    remote = "https://github.com/fmtlib/fmt",
-    patch_cmds = [
-        "mv support/bazel/.bazelversion .bazelversion",
-        "mv support/bazel/BUILD.bazel BUILD.bazel",
-        "mv support/bazel/WORKSPACE.bazel WORKSPACE.bazel",
-    ],
-    # Windows-related patch commands are only needed in the case MSYS2 is not installed.
-    # More details about the installation process of MSYS2 on Windows systems can be found here:
-    # https://docs.bazel.build/versions/main/install-windows.html#installing-compilers-and-language-runtimes
-    # Even if MSYS2 is installed the Windows related patch commands can still be used.
-    patch_cmds_win = [
-        "Move-Item -Path support/bazel/.bazelversion -Destination .bazelversion",
-        "Move-Item -Path support/bazel/BUILD.bazel -Destination BUILD.bazel",
-        "Move-Item -Path support/bazel/WORKSPACE.bazel -Destination WORKSPACE.bazel",
-    ],
-)
+bazel_dep(name = "fmt", version = "10.2.1")
 ```
 
-In the *WORKSPACE* file, the {fmt} GitHub repository is fetched. Using the attribute `patch_cmds` the  files `BUILD.bazel`, `WORKSPACE.bazel`, and `.bazelversion` are moved to the root of the {fmt} repository. This way the {fmt} repository is recognized as a bazelized workspace. 
+### Live at head
 
-*BUILD.bazel*:
+For a live-at-head approach, you can copy the contents of this repository and move the Bazel-related build files to the root folder of this project as described above and make use of `local_path_override`, e.g.:
 
-```python
-cc_binary(
-    name = "Demo",
-    srcs = ["main.cpp"],
-    deps = ["@fmt"],
+```
+local_path_override(
+    module_name = "fmt",
+    path = "../third_party/fmt",
 )
 ```
-
-The *BUILD* file defines a binary named `Demo` that has a dependency to {fmt}.
-
-To execute the binary you can run `bazel run //:Demo`.
-
-# Using Bzlmod
-
-The [Bazel Central Registry](https://github.com/bazelbuild/bazel-central-registry/tree/main/modules/fmt) also provides support for {fmt}.
diff --git a/support/bazel/WORKSPACE.bazel b/support/bazel/WORKSPACE.bazel
index 5be77811..b1be18f3 100644
--- a/support/bazel/WORKSPACE.bazel
+++ b/support/bazel/WORKSPACE.bazel
@@ -1 +1,2 @@
-workspace(name = "fmt")
+# WORKSPACE marker file needed by Bazel
+
diff --git a/support/build-docs.py b/support/build-docs.py
deleted file mode 100755
index f1395cd6..00000000
--- a/support/build-docs.py
+++ /dev/null
@@ -1,58 +0,0 @@
-#!/usr/bin/env python
-# Build the documentation in CI.
-
-from __future__ import print_function
-import errno, os, shutil, subprocess, sys, urllib
-from subprocess import call, check_call, Popen, PIPE, STDOUT
-
-def rmtree_if_exists(dir):
-    try:
-        shutil.rmtree(dir)
-    except OSError as e:
-        if e.errno == errno.ENOENT:
-            pass
-
-# Build the docs.
-fmt_dir = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
-sys.path.insert(0, os.path.join(fmt_dir, 'doc'))
-import build
-build.create_build_env()
-html_dir = build.build_docs()
-
-repo = 'fmtlib.github.io'
-branch = os.environ['GITHUB_REF']
-is_ci = 'CI' in os.environ
-if is_ci and branch != 'refs/heads/master':
-    print('Branch: ' + branch)
-    exit(0) # Ignore non-master branches
-if is_ci and 'KEY' not in os.environ:
-    # Don't update the repo if building in CI from an account that doesn't have
-    # push access.
-    print('Skipping update of ' + repo)
-    exit(0)
-
-# Clone the fmtlib.github.io repo.
-rmtree_if_exists(repo)
-git_url = 'https://github.com/' if is_ci else 'git@github.com:'
-check_call(['git', 'clone', git_url + 'fmtlib/{}.git'.format(repo)])
-
-# Copy docs to the repo.
-target_dir = os.path.join(repo, 'dev')
-rmtree_if_exists(target_dir)
-shutil.copytree(html_dir, target_dir, ignore=shutil.ignore_patterns('.*'))
-if is_ci:
-    check_call(['git', 'config', '--global', 'user.name', 'fmtbot'])
-    check_call(['git', 'config', '--global', 'user.email', 'viz@fmt.dev'])
-
-# Push docs to GitHub pages.
-check_call(['git', 'add', '--all'], cwd=repo)
-if call(['git', 'diff-index', '--quiet', 'HEAD'], cwd=repo):
-    check_call(['git', 'commit', '-m', 'Update documentation'], cwd=repo)
-    cmd = 'git push'
-    if is_ci:
-        cmd += ' https://$KEY@github.com/fmtlib/fmtlib.github.io.git master'
-    p = Popen(cmd, shell=True, stdout=PIPE, stderr=STDOUT, cwd=repo)
-    # Print the output without the key.
-    print(p.communicate()[0].decode('utf-8').replace(os.environ['KEY'], '$KEY'))
-    if p.returncode != 0:
-        raise subprocess.CalledProcessError(p.returncode, cmd)
diff --git a/support/check-commits b/support/check-commits
new file mode 100755
index 00000000..11472d41
--- /dev/null
+++ b/support/check-commits
@@ -0,0 +1,43 @@
+#!/usr/bin/env python3
+
+"""Compile source on a range of commits
+
+Usage:
+  check-commits <start> <source>
+"""
+
+import docopt, os, sys, tempfile
+from subprocess import check_call, check_output, run
+
+args = docopt.docopt(__doc__)
+start = args.get('<start>')
+source = args.get('<source>')
+
+cwd = os.getcwd()
+
+with tempfile.TemporaryDirectory() as work_dir:
+  check_call(['git', 'clone', 'https://github.com/fmtlib/fmt.git'],
+             cwd=work_dir)
+  repo_dir = os.path.join(work_dir, 'fmt')
+  commits = check_output(
+    ['git', 'rev-list', f'{start}..HEAD', '--abbrev-commit',
+     '--', 'include', 'src'],
+    text=True, cwd=repo_dir).rstrip().split('\n')
+  commits.reverse()
+  print('Time\tCommit')
+  for commit in commits:
+    check_call(['git', '-c', 'advice.detachedHead=false', 'checkout', commit],
+               cwd=repo_dir)
+    returncode = run(
+      ['c++', '-std=c++11', '-O3', '-DNDEBUG', '-I', 'include',
+       'src/format.cc', os.path.join(cwd, source)], cwd=repo_dir).returncode
+    if returncode != 0:
+      continue
+    times = []
+    for i in range(5):
+      output = check_output([os.path.join(repo_dir, 'a.out')], text=True)
+      times.append(float(output))
+    message = check_output(['git', 'log', '-1', '--pretty=format:%s', commit],
+                           cwd=repo_dir, text=True)
+    print(f'{min(times)}\t{commit} {message[:40]}')
+    sys.stdout.flush()
diff --git a/support/compute-powers.py b/support/compute-powers.py
deleted file mode 100755
index 601063d4..00000000
--- a/support/compute-powers.py
+++ /dev/null
@@ -1,53 +0,0 @@
-#!/usr/bin/env python
-# Compute 10 ** exp with exp in the range [min_exponent, max_exponent] and print
-# normalized (with most-significant bit equal to 1) significands in hexadecimal.
-
-from __future__ import print_function
-
-min_exponent = -348
-max_exponent = 340
-step = 8
-significand_size = 64
-exp_offset = 2000
-
-class fp:
-    pass
-
-powers = []
-for i, exp in enumerate(range(min_exponent, max_exponent + 1, step)):
-    result = fp()
-    n = 10 ** exp if exp >= 0 else 2 ** exp_offset / 10 ** -exp
-    k = significand_size + 1
-    # Convert to binary and round.
-    binary = '{:b}'.format(n)
-    result.f = (int('{:0<{}}'.format(binary[:k], k), 2) + 1) / 2
-    result.e = len(binary) - (exp_offset if exp < 0 else 0) - significand_size
-    powers.append(result)
-    # Sanity check.
-    exp_offset10 = 400
-    actual = result.f * 10 ** exp_offset10
-    if result.e > 0:
-        actual *= 2 ** result.e
-    else:
-        for j in range(-result.e):
-            actual /= 2
-    expected = 10 ** (exp_offset10 + exp)
-    precision = len('{}'.format(expected)) - len('{}'.format(actual - expected))
-    if precision < 19:
-        print('low precision:', precision)
-        exit(1)
-
-print('Significands:', end='')
-for i, fp in enumerate(powers):
-    if i % 3 == 0:
-        print(end='\n ')
-    print(' {:0<#16x}'.format(fp.f, ), end=',')
-
-print('\n\nExponents:', end='')
-for i, fp in enumerate(powers):
-    if i % 11 == 0:
-        print(end='\n ')
-    print(' {:5}'.format(fp.e), end=',')
-
-print('\n\nMax exponent difference:',
-      max([x.e - powers[i - 1].e for i, x in enumerate(powers)][1:]))
diff --git a/support/manage.py b/support/manage.py
index cfb49797..3467afb0 100755
--- a/support/manage.py
+++ b/support/manage.py
@@ -14,7 +14,6 @@ from __future__ import print_function
 import datetime, docopt, errno, fileinput, json, os
 import re, requests, shutil, sys
 from contextlib import contextmanager
-from distutils.version import LooseVersion
 from subprocess import check_call
 
 
@@ -76,147 +75,42 @@ def create_build_env():
     class Env:
         pass
     env = Env()
-
-    # Import the documentation build module.
     env.fmt_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
-    sys.path.insert(0, os.path.join(env.fmt_dir, 'doc'))
-    import build
-
     env.build_dir = 'build'
-    env.versions = build.versions
-
-    # Virtualenv and repos are cached to speed up builds.
-    build.create_build_env(os.path.join(env.build_dir, 'virtualenv'))
-
     env.fmt_repo = Git(os.path.join(env.build_dir, 'fmt'))
     return env
 
 
-@contextmanager
-def rewrite(filename):
-    class Buffer:
-        pass
-    buffer = Buffer()
-    if not os.path.exists(filename):
-        buffer.data = ''
-        yield buffer
-        return
-    with open(filename) as f:
-        buffer.data = f.read()
-    yield buffer
-    with open(filename, 'w') as f:
-        f.write(buffer.data)
-
-
 fmt_repo_url = 'git@github.com:fmtlib/fmt'
 
 
 def update_site(env):
     env.fmt_repo.update(fmt_repo_url)
 
-    doc_repo = Git(os.path.join(env.build_dir, 'fmtlib.github.io'))
-    doc_repo.update('git@github.com:fmtlib/fmtlib.github.io')
-
-    for version in env.versions:
-        clean_checkout(env.fmt_repo, version)
-        target_doc_dir = os.path.join(env.fmt_repo.dir, 'doc')
-        # Remove the old theme.
-        for entry in os.listdir(target_doc_dir):
-            path = os.path.join(target_doc_dir, entry)
-            if os.path.isdir(path):
-                shutil.rmtree(path)
-        # Copy the new theme.
-        for entry in ['_static', '_templates', 'basic-bootstrap', 'bootstrap',
-                      'conf.py', 'fmt.less']:
-            src = os.path.join(env.fmt_dir, 'doc', entry)
-            dst = os.path.join(target_doc_dir, entry)
-            copy = shutil.copytree if os.path.isdir(src) else shutil.copyfile
-            copy(src, dst)
-        # Rename index to contents.
-        contents = os.path.join(target_doc_dir, 'contents.rst')
-        if not os.path.exists(contents):
-            os.rename(os.path.join(target_doc_dir, 'index.rst'), contents)
-        # Fix issues in reference.rst/api.rst.
-        for filename in ['reference.rst', 'api.rst', 'index.rst']:
-            pattern = re.compile('doxygenfunction.. (bin|oct|hexu|hex)$', re.M)
-            with rewrite(os.path.join(target_doc_dir, filename)) as b:
-                b.data = b.data.replace('std::ostream &', 'std::ostream&')
-                b.data = re.sub(pattern, r'doxygenfunction:: \1(int)', b.data)
-                b.data = b.data.replace('std::FILE*', 'std::FILE *')
-                b.data = b.data.replace('unsigned int', 'unsigned')
-                #b.data = b.data.replace('operator""_', 'operator"" _')
-                b.data = b.data.replace(
-                    'format_to_n(OutputIt, size_t, string_view, Args&&',
-                    'format_to_n(OutputIt, size_t, const S&, const Args&')
-                b.data = b.data.replace(
-                    'format_to_n(OutputIt, std::size_t, string_view, Args&&',
-                    'format_to_n(OutputIt, std::size_t, const S&, const Args&')
-                if version == ('3.0.2'):
-                    b.data = b.data.replace(
-                        'fprintf(std::ostream&', 'fprintf(std::ostream &')
-                if version == ('5.3.0'):
-                    b.data = b.data.replace(
-                        'format_to(OutputIt, const S&, const Args&...)',
-                        'format_to(OutputIt, const S &, const Args &...)')
-                if version.startswith('5.') or version.startswith('6.'):
-                    b.data = b.data.replace(', size_t', ', std::size_t')
-                if version.startswith('7.'):
-                    b.data = b.data.replace(', std::size_t', ', size_t')
-                    b.data = b.data.replace('join(It, It', 'join(It, Sentinel')
-                if version.startswith('7.1.'):
-                    b.data = b.data.replace(', std::size_t', ', size_t')
-                    b.data = b.data.replace('join(It, It', 'join(It, Sentinel')
-                    b.data = b.data.replace(
-                        'fmt::format_to(OutputIt, const S&, Args&&...)',
-                        'fmt::format_to(OutputIt, const S&, Args&&...) -> ' +
-                        'typename std::enable_if<enable, OutputIt>::type')
-                b.data = b.data.replace('aa long', 'a long')
-                b.data = b.data.replace('serveral', 'several')
-                if version.startswith('6.2.'):
-                    b.data = b.data.replace(
-                        'vformat(const S&, basic_format_args<' +
-                        'buffer_context<Char>>)',
-                        'vformat(const S&, basic_format_args<' +
-                        'buffer_context<type_identity_t<Char>>>)')
-        # Fix a broken link in index.rst.
-        index = os.path.join(target_doc_dir, 'index.rst')
-        with rewrite(index) as b:
-            b.data = b.data.replace(
-                'doc/latest/index.html#format-string-syntax', 'syntax.html')
-        # Fix issues in syntax.rst.
-        index = os.path.join(target_doc_dir, 'syntax.rst')
-        with rewrite(index) as b:
-            b.data = b.data.replace(
-                '..productionlist:: sf\n', '.. productionlist:: sf\n ')
-            b.data = b.data.replace('Examples:\n', 'Examples::\n')
-        # Build the docs.
-        html_dir = os.path.join(env.build_dir, 'html')
-        if os.path.exists(html_dir):
-            shutil.rmtree(html_dir)
-        include_dir = env.fmt_repo.dir
-        if LooseVersion(version) >= LooseVersion('5.0.0'):
-            include_dir = os.path.join(include_dir, 'include', 'fmt')
-        elif LooseVersion(version) >= LooseVersion('3.0.0'):
-            include_dir = os.path.join(include_dir, 'fmt')
-        import build
-        build.build_docs(version, doc_dir=target_doc_dir,
-                         include_dir=include_dir, work_dir=env.build_dir)
-        shutil.rmtree(os.path.join(html_dir, '.doctrees'))
-        # Create symlinks for older versions.
-        for link, target in {'index': 'contents', 'api': 'reference'}.items():
-            link = os.path.join(html_dir, link) + '.html'
-            target += '.html'
-            if os.path.exists(os.path.join(html_dir, target)) and \
-               not os.path.exists(link):
-                os.symlink(target, link)
-        # Copy docs to the website.
-        version_doc_dir = os.path.join(doc_repo.dir, version)
-        try:
-            shutil.rmtree(version_doc_dir)
-        except OSError as e:
-            if e.errno != errno.ENOENT:
-                raise
-        shutil.move(html_dir, version_doc_dir)
+    doc_repo = Git(os.path.join(env.build_dir, 'fmt.dev'))
+    doc_repo.update('git@github.com:fmtlib/fmt.dev')
+
+    version = '11.0.0'
+    clean_checkout(env.fmt_repo, version)
+    target_doc_dir = os.path.join(env.fmt_repo.dir, 'doc')
+
+    # Build the docs.
+    html_dir = os.path.join(env.build_dir, 'html')
+    if os.path.exists(html_dir):
+        shutil.rmtree(html_dir)
+    include_dir = env.fmt_repo.dir
+    import build
+    build.build_docs(version, doc_dir=target_doc_dir,
+                        include_dir=include_dir, work_dir=env.build_dir)
+    shutil.rmtree(os.path.join(html_dir, '.doctrees'))
+    # Copy docs to the website.
+    version_doc_dir = os.path.join(doc_repo.dir, version)
+    try:
+        shutil.rmtree(version_doc_dir)
+    except OSError as e:
+        if e.errno != errno.ENOENT:
+            raise
+    shutil.move(html_dir, version_doc_dir)
 
 
 def release(args):
@@ -250,6 +144,18 @@ def release(args):
     if first_section[0] == '\n':
         first_section.pop(0)
 
+    ns_version = None
+    base_h_path = os.path.join(fmt_repo.dir, 'include', 'fmt', 'base.h')
+    for line in fileinput.input(base_h_path):
+        m = re.match(r'\s*inline namespace v(.*) .*', line)
+        if m:
+            ns_version = m.group(1)
+            break
+    major_version = version.split('.')[0]
+    if not ns_version or ns_version != major_version:
+        raise Exception(f'Version mismatch {ns_version} != {major_version}')
+
+    # Workaround GitHub-flavored Markdown treating newlines as <br>.
     changes = ''
     code_block = False
     stripped = False
@@ -262,43 +168,25 @@ def release(args):
         if code_block:
             changes += line
             continue
-        if line == '\n':
-            changes += line
+        if line == '\n' or re.match(r'^\s*\|.*', line):
             if stripped:
-                changes += line
+                changes += '\n'
                 stripped = False
+            changes += line
             continue
         if stripped:
             line = ' ' + line.lstrip()
         changes += line.rstrip()
         stripped = True
 
-    cmakelists = 'CMakeLists.txt'
-    for line in fileinput.input(os.path.join(fmt_repo.dir, cmakelists),
-                                inplace=True):
-        prefix = 'set(FMT_VERSION '
-        if line.startswith(prefix):
-            line = prefix + version + ')\n'
-        sys.stdout.write(line)
-
-    # Add the version to the build script.
-    script = os.path.join('doc', 'build.py')
-    script_path = os.path.join(fmt_repo.dir, script)
-    for line in fileinput.input(script_path, inplace=True):
-      m = re.match(r'( *versions \+= )\[(.+)\]', line)
-      if m:
-        line = '{}[{}, \'{}\']\n'.format(m.group(1), m.group(2), version)
-      sys.stdout.write(line)
-
     fmt_repo.checkout('-B', 'release')
-    fmt_repo.add(changelog, cmakelists, script)
+    fmt_repo.add(changelog)
     fmt_repo.commit('-m', 'Update version')
 
     # Build the docs and package.
     run = Runner(fmt_repo.dir)
     run('cmake', '.')
     run('make', 'doc', 'package_source')
-    update_site(env)
 
     # Create a release on GitHub.
     fmt_repo.push('origin', 'release')
@@ -320,6 +208,7 @@ def release(args):
     if r.status_code != 201:
         raise Exception('Failed to upload an asset ' + str(r))
 
+    update_site(env)
 
 if __name__ == '__main__':
     args = docopt.docopt(__doc__)
diff --git a/support/mkdocs b/support/mkdocs
new file mode 100755
index 00000000..e554c1fd
--- /dev/null
+++ b/support/mkdocs
@@ -0,0 +1,76 @@
+#!/usr/bin/env python3
+# A script to invoke mkdocs with the correct environment.
+# Additionally supports deploying via mike:
+#   ./mkdocs deploy [mike-deploy-options]
+
+import errno, os, shutil, sys
+from subprocess import call
+
+support_dir = os.path.dirname(os.path.normpath(__file__))
+build_dir = os.path.join(os.path.dirname(support_dir), 'build')
+
+# Set PYTHONPATH for the mkdocstrings handler.
+env = os.environ.copy()
+path = env.get('PYTHONPATH')
+env['PYTHONPATH'] = \
+  (path + ':' if path else '') + os.path.join(support_dir, 'python')
+
+redirect_page = \
+'''<!DOCTYPE html>
+<html>
+<head>
+  <meta charset="utf-8">
+  <title>Redirecting</title>
+  <noscript>
+    <meta http-equiv="refresh" content="1; url=11.0/" />
+  </noscript>
+  <script>
+    window.location.replace(
+      "api/" + window.location.search + window.location.hash
+    );
+  </script>
+</head>
+<body>
+  Redirecting to <a href="api/">api</a>...
+</body>
+</html>
+'''
+
+config_path = os.path.join(support_dir, 'mkdocs.yml')
+args = sys.argv[1:]
+if len(args) > 0:
+  command = args[0]
+  if command == 'deploy':
+    git_url = 'https://github.com/' if 'CI' in os.environ else 'git@github.com:'
+    site_repo = git_url + 'fmtlib/fmt.dev.git'
+
+    site_dir = os.path.join(build_dir, 'fmt.dev')
+    try:
+      shutil.rmtree(site_dir)
+    except OSError as e:
+      if e.errno == errno.ENOENT:
+        pass
+    ret = call(['git', 'clone', '--depth=1', site_repo, site_dir])
+    if ret != 0:
+      sys.exit(ret)
+
+    # Copy the config to the build dir because the site is built relative to it.
+    config_build_path = os.path.join(build_dir, 'mkdocs.yml')
+    shutil.copyfile(config_path, config_build_path)
+
+    version = args[1]
+    ret = call(['mike'] + args + ['--config-file', config_build_path,
+               '--branch', 'master'], cwd=site_dir, env=env)
+    if ret != 0 or version == 'dev':
+      sys.exit(ret)
+    redirect_page_path = os.path.join(site_dir, version, 'api.html')
+    with open(redirect_page_path, "w") as file:
+      file.write(redirect_page)
+    ret = call(['git', 'add', redirect_page_path], cwd=site_dir)
+    if ret != 0:
+      sys.exit(ret)
+    ret = call(['git', 'commit', '--amend', '--no-edit'], cwd=site_dir)
+    sys.exit(ret)
+  elif not command.startswith('-'):
+    args += ['-f', config_path]
+sys.exit(call(['mkdocs'] + args, env=env))
diff --git a/support/mkdocs.yml b/support/mkdocs.yml
new file mode 100644
index 00000000..17034cd1
--- /dev/null
+++ b/support/mkdocs.yml
@@ -0,0 +1,48 @@
+site_name: '{fmt}'
+
+docs_dir: ../doc
+
+repo_url: https://github.com/fmtlib/fmt
+
+theme:
+  name: material
+  features:
+    - navigation.tabs
+    - navigation.top
+    - toc.integrate
+
+extra_javascript:
+  - https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js
+  - fmt.js
+
+extra_css:
+  - https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css
+  - fmt.css
+
+markdown_extensions:
+  - pymdownx.highlight:
+      # Use JavaScript syntax highlighter instead of Pygments because it
+      # automatically applies to code blocks extracted through Doxygen.
+      use_pygments: false
+      anchor_linenums: true
+      line_spans: __span
+      pygments_lang_class: true
+  - pymdownx.inlinehilite
+  - pymdownx.snippets
+
+plugins:
+  - search
+  - mkdocstrings:
+      default_handler: cxx
+nav:
+  - Home: index.md
+  - Get Started: get-started.md
+  - API: api.md
+  - Syntax: syntax.md
+
+exclude_docs: ChangeLog-old.md
+
+extra:
+  version:
+    provider: mike
+  generator: false
diff --git a/support/python/mkdocstrings_handlers/cxx/__init__.py b/support/python/mkdocstrings_handlers/cxx/__init__.py
new file mode 100644
index 00000000..85d52a58
--- /dev/null
+++ b/support/python/mkdocstrings_handlers/cxx/__init__.py
@@ -0,0 +1,338 @@
+# A basic mkdocstrings handler for {fmt}.
+# Copyright (c) 2012 - present, Victor Zverovich
+# https://github.com/fmtlib/fmt/blob/master/LICENSE
+
+import os
+import xml.etree.ElementTree as ElementTree
+from pathlib import Path
+from subprocess import PIPE, STDOUT, CalledProcessError, Popen
+from typing import Any, List, Mapping, Optional
+
+from mkdocstrings.handlers.base import BaseHandler
+
+
+class Definition:
+    """A definition extracted by Doxygen."""
+
+    def __init__(self, name: str, kind: Optional[str] = None,
+                 node: Optional[ElementTree.Element] = None,
+                 is_member: bool = False):
+        self.name = name
+        self.kind = kind if kind is not None else node.get('kind')
+        self.desc = None
+        self.id = name if not is_member else None
+        self.members = None
+        self.params = None
+        self.template_params = None
+        self.trailing_return_type = None
+        self.type = None
+
+
+# A map from Doxygen to HTML tags.
+tag_map = {
+    'bold': 'b',
+    'emphasis': 'em',
+    'computeroutput': 'code',
+    'para': 'p',
+    'programlisting': 'pre',
+    'verbatim': 'pre'
+}
+
+# A map from Doxygen tags to text.
+tag_text_map = {
+    'codeline': '',
+    'highlight': '',
+    'sp': ' '
+}
+
+
+def escape_html(s: str) -> str:
+    return s.replace("<", "&lt;")
+
+
+def doxyxml2html(nodes: List[ElementTree.Element]):
+    out = ''
+    for n in nodes:
+        tag = tag_map.get(n.tag)
+        if not tag:
+            out += tag_text_map[n.tag]
+        out += '<' + tag + '>' if tag else ''
+        out += '<code class="language-cpp">' if tag == 'pre' else ''
+        if n.text:
+            out += escape_html(n.text)
+        out += doxyxml2html(list(n))
+        out += '</code>' if tag == 'pre' else ''
+        out += '</' + tag + '>' if tag else ''
+        if n.tail:
+            out += n.tail
+    return out
+
+
+def convert_template_params(node: ElementTree.Element) -> Optional[List[Definition]]:
+    template_param_list = node.find('templateparamlist')
+    if template_param_list is None:
+        return None
+    params = []
+    for param_node in template_param_list.findall('param'):
+        name = param_node.find('declname')
+        param = Definition(name.text if name is not None else '', 'param')
+        param.type = param_node.find('type').text
+        params.append(param)
+    return params
+
+
+def get_description(node: ElementTree.Element) -> List[ElementTree.Element]:
+    return node.findall('briefdescription/para') + \
+        node.findall('detaileddescription/para')
+
+
+def normalize_type(type_: str) -> str:
+    type_ = type_.replace('< ', '<').replace(' >', '>')
+    return type_.replace(' &', '&').replace(' *', '*')
+
+
+def convert_type(type_: ElementTree.Element) -> Optional[str]:
+    if type_ is None:
+        return None
+    result = type_.text if type_.text else ''
+    for ref in type_:
+        result += ref.text
+        if ref.tail:
+            result += ref.tail
+    result += type_.tail.strip()
+    return normalize_type(result)
+
+
+def convert_params(func: ElementTree.Element) -> List[Definition]:
+    params = []
+    for p in func.findall('param'):
+        d = Definition(p.find('declname').text, 'param')
+        d.type = convert_type(p.find('type'))
+        params.append(d)
+    return params
+
+
+def convert_return_type(d: Definition, node: ElementTree.Element) -> None:
+    d.trailing_return_type = None
+    if d.type == 'auto' or d.type == 'constexpr auto':
+        parts = node.find('argsstring').text.split(' -> ')
+        if len(parts) > 1:
+            d.trailing_return_type = normalize_type(parts[1])
+
+
+def render_param(param: Definition) -> str:
+    return param.type + (f'&nbsp;{param.name}' if len(param.name) > 0 else '')
+
+
+def render_decl(d: Definition) -> str:
+    text = ''
+    if d.id is not None:
+        text += f'<a id="{d.id}">\n'
+    text += '<pre><code class="language-cpp decl">'
+
+    text += '<div>'
+    if d.template_params is not None:
+        text += 'template &lt;'
+        text += ', '.join([render_param(p) for p in d.template_params])
+        text += '&gt;\n'
+    text += '</div>'
+
+    text += '<div>'
+    end = ';'
+    if d.kind == 'function' or d.kind == 'variable':
+        text += d.type + ' ' if len(d.type) > 0 else ''
+    elif d.kind == 'typedef':
+        text += 'using '
+    elif d.kind == 'define':
+        end = ''
+    else:
+        text += d.kind + ' '
+    text += d.name
+
+    if d.params is not None:
+        params = ', '.join([
+            (p.type + ' ' if p.type else '') + p.name for p in d.params])
+        text += '(' + escape_html(params) + ')'
+        if d.trailing_return_type:
+            text += ' -&NoBreak;>&nbsp;' + escape_html(d.trailing_return_type)
+    elif d.kind == 'typedef':
+        text += ' = ' + escape_html(d.type)
+
+    text += end
+    text += '</div>'
+    text += '</code></pre>\n'
+    if d.id is not None:
+        text += f'</a>\n'
+    return text
+
+
+class CxxHandler(BaseHandler):
+    def __init__(self, **kwargs: Any) -> None:
+        super().__init__(handler='cxx', **kwargs)
+
+        headers = [
+            'args.h', 'base.h', 'chrono.h', 'color.h', 'compile.h', 'format.h',
+            'os.h', 'ostream.h', 'printf.h', 'ranges.h', 'std.h', 'xchar.h'
+        ]
+
+        # Run doxygen.
+        cmd = ['doxygen', '-']
+        support_dir = Path(__file__).parents[3]
+        top_dir = os.path.dirname(support_dir)
+        include_dir = os.path.join(top_dir, 'include', 'fmt')
+        self._ns2doxyxml = {}
+        build_dir = os.path.join(top_dir, 'build')
+        os.makedirs(build_dir, exist_ok=True)
+        self._doxyxml_dir = os.path.join(build_dir, 'doxyxml')
+        p = Popen(cmd, stdin=PIPE, stdout=PIPE, stderr=STDOUT)
+        _, _ = p.communicate(input=r'''
+            PROJECT_NAME     = fmt
+            GENERATE_XML     = YES
+            GENERATE_LATEX   = NO
+            GENERATE_HTML    = NO
+            INPUT            = {0}
+            XML_OUTPUT       = {1}
+            QUIET            = YES
+            AUTOLINK_SUPPORT = NO
+            MACRO_EXPANSION  = YES
+            PREDEFINED       = _WIN32=1 \
+                               __linux__=1 \
+                               FMT_ENABLE_IF(...)= \
+                               FMT_USE_USER_LITERALS=1 \
+                               FMT_USE_ALIAS_TEMPLATES=1 \
+                               FMT_USE_NONTYPE_TEMPLATE_ARGS=1 \
+                               FMT_API= \
+                               "FMT_BEGIN_NAMESPACE=namespace fmt {{" \
+                               "FMT_END_NAMESPACE=}}" \
+                               "FMT_DOC=1"
+            '''.format(
+                ' '.join([os.path.join(include_dir, h) for h in headers]),
+                self._doxyxml_dir).encode('utf-8'))
+        if p.returncode != 0:
+            raise CalledProcessError(p.returncode, cmd)
+
+        # Merge all file-level XMLs into one to simplify search.
+        self._file_doxyxml = None
+        for h in headers:
+            filename = h.replace(".h", "_8h.xml")
+            with open(os.path.join(self._doxyxml_dir, filename)) as f:
+                doxyxml = ElementTree.parse(f)
+                if self._file_doxyxml is None:
+                    self._file_doxyxml = doxyxml
+                    continue
+                root = self._file_doxyxml.getroot()
+                for node in doxyxml.getroot():
+                    root.append(node)
+
+    def collect_compound(self, identifier: str,
+                         cls: List[ElementTree.Element]) -> Definition:
+        """Collect a compound definition such as a struct."""
+        path = os.path.join(self._doxyxml_dir, cls[0].get('refid') + '.xml')
+        with open(path) as f:
+            xml = ElementTree.parse(f)
+            node = xml.find('compounddef')
+            d = Definition(identifier, node=node)
+            d.template_params = convert_template_params(node)
+            d.desc = get_description(node)
+            d.members = []
+            for m in \
+                    node.findall('sectiondef[@kind="public-attrib"]/memberdef') + \
+                    node.findall('sectiondef[@kind="public-func"]/memberdef'):
+                name = m.find('name').text
+                # Doxygen incorrectly classifies members of private unnamed unions as
+                # public members of the containing class.
+                if name.endswith('_'):
+                    continue
+                desc = get_description(m)
+                if len(desc) == 0:
+                    continue
+                kind = m.get('kind')
+                member = Definition(name if name else '', kind=kind, is_member=True)
+                type_text = m.find('type').text
+                member.type = type_text if type_text else ''
+                if kind == 'function':
+                    member.params = convert_params(m)
+                    convert_return_type(member, m)
+                member.template_params = None
+                member.desc = desc
+                d.members.append(member)
+            return d
+
+    def collect(self, identifier: str, _config: Mapping[str, Any]) -> Definition:
+        qual_name = 'fmt::' + identifier
+
+        param_str = None
+        paren = qual_name.find('(')
+        if paren > 0:
+            qual_name, param_str = qual_name[:paren], qual_name[paren + 1:-1]
+
+        colons = qual_name.rfind('::')
+        namespace, name = qual_name[:colons], qual_name[colons + 2:]
+
+        # Load XML.
+        doxyxml = self._ns2doxyxml.get(namespace)
+        if doxyxml is None:
+            path = f'namespace{namespace.replace("::", "_1_1")}.xml'
+            with open(os.path.join(self._doxyxml_dir, path)) as f:
+                doxyxml = ElementTree.parse(f)
+                self._ns2doxyxml[namespace] = doxyxml
+
+        nodes = doxyxml.findall(
+            f"compounddef/sectiondef/memberdef/name[.='{name}']/..")
+        if len(nodes) == 0:
+            nodes = self._file_doxyxml.findall(
+                f"compounddef/sectiondef/memberdef/name[.='{name}']/..")
+        candidates = []
+        for node in nodes:
+            # Process a function or a typedef.
+            params = None
+            d = Definition(name, node=node)
+            if d.kind == 'function':
+                params = convert_params(node)
+                node_param_str = ', '.join([p.type for p in params])
+                if param_str and param_str != node_param_str:
+                    candidates.append(f'{name}({node_param_str})')
+                    continue
+            elif d.kind == 'define':
+                params = []
+                for p in node.findall('param'):
+                    param = Definition(p.find('defname').text, kind='param')
+                    param.type = None
+                    params.append(param)
+            d.type = convert_type(node.find('type'))
+            d.template_params = convert_template_params(node)
+            d.params = params
+            convert_return_type(d, node)
+            d.desc = get_description(node)
+            return d
+
+        cls = doxyxml.findall(f"compounddef/innerclass[.='{qual_name}']")
+        if not cls:
+            raise Exception(f'Cannot find {identifier}. Candidates: {candidates}')
+        return self.collect_compound(identifier, cls)
+
+    def render(self, d: Definition, config: dict) -> str:
+        if d.id is not None:
+            self.do_heading('', 0, id=d.id)
+        text = '<div class="docblock">\n'
+        text += render_decl(d)
+        text += '<div class="docblock-desc">\n'
+        text += doxyxml2html(d.desc)
+        if d.members is not None:
+            for m in d.members:
+                text += self.render(m, config)
+        text += '</div>\n'
+        text += '</div>\n'
+        return text
+
+
+def get_handler(theme: str, custom_templates: Optional[str] = None,
+                **_config: Any) -> CxxHandler:
+    """Return an instance of `CxxHandler`.
+
+    Arguments:
+        theme: The theme to use when rendering contents.
+        custom_templates: Directory containing custom templates.
+        **_config: Configuration passed to the handler.
+    """
+    return CxxHandler(theme=theme, custom_templates=custom_templates)
diff --git a/support/python/mkdocstrings_handlers/cxx/templates/README b/support/python/mkdocstrings_handlers/cxx/templates/README
new file mode 100644
index 00000000..7da18db5
--- /dev/null
+++ b/support/python/mkdocstrings_handlers/cxx/templates/README
@@ -0,0 +1 @@
+mkdocsstrings requires a handler to have a templates directory.
diff --git a/support/rtd/conf.py b/support/rtd/conf.py
deleted file mode 100644
index 124fb9d4..00000000
--- a/support/rtd/conf.py
+++ /dev/null
@@ -1,7 +0,0 @@
-# Sphinx configuration for readthedocs.
-
-import os, sys
-
-master_doc = 'index'
-html_theme = 'theme'
-html_theme_path = ["."]
diff --git a/support/rtd/index.rst b/support/rtd/index.rst
deleted file mode 100644
index 7c88322f..00000000
--- a/support/rtd/index.rst
+++ /dev/null
@@ -1,2 +0,0 @@
-If you are not redirected automatically, follow the
-`link to the fmt documentation <https://fmt.dev/latest/>`_.
diff --git a/support/rtd/theme/layout.html b/support/rtd/theme/layout.html
deleted file mode 100644
index 29ebc55b..00000000
--- a/support/rtd/theme/layout.html
+++ /dev/null
@@ -1,17 +0,0 @@
-{% extends "basic/layout.html" %}
-
-{% block extrahead %}
-<meta charset="UTF-8">
-<meta http-equiv="refresh" content="1;url=https://fmt.dev/latest/">
-<script type="text/javascript">
-    window.location.href = "https://fmt.dev/latest/"
-</script>
-<title>Page Redirection</title>
-{% endblock %}
-
-{% block document %}
-If you are not redirected automatically, follow the <a href='https://fmt.dev/latest/'>link to the fmt documentation</a>.
-{% endblock %}
-
-{% block footer %}
-{% endblock %}
diff --git a/support/rtd/theme/theme.conf b/support/rtd/theme/theme.conf
deleted file mode 100644
index 89e03bbd..00000000
--- a/support/rtd/theme/theme.conf
+++ /dev/null
@@ -1,2 +0,0 @@
-[theme]
-inherit = basic
diff --git a/test/CMakeLists.txt b/test/CMakeLists.txt
index ec97ac29..e1ea260d 100644
--- a/test/CMakeLists.txt
+++ b/test/CMakeLists.txt
@@ -8,22 +8,6 @@ target_include_directories(test-main PUBLIC
   $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include>)
 target_link_libraries(test-main gtest fmt)
 
-function(add_fmt_executable name)
-  add_executable(${name} ${ARGN})
-  # (Wstringop-overflow) - [meta-bug] bogus/missing -Wstringop-overflow warnings
-  #   https://gcc.gnu.org/bugzilla/show_bug.cgi?id=88443
-  # Bogus -Wstringop-overflow warning
-  #   https://gcc.gnu.org/bugzilla/show_bug.cgi?id=100395
-  # [10 Regression] spurious -Wstringop-overflow writing to a trailing array plus offset
-  #   https://gcc.gnu.org/bugzilla/show_bug.cgi?id=95353
-  if (CMAKE_CXX_COMPILER_ID MATCHES "GNU" AND
-      NOT CMAKE_CXX_COMPILER_VERSION VERSION_LESS 7.0)
-    target_compile_options(${name} PRIVATE -Wno-stringop-overflow)
-    # The linker flag is needed for LTO.
-    target_link_libraries(${name} -Wno-stringop-overflow)
-  endif ()
-endfunction()
-
 # Adds a test.
 # Usage: add_fmt_test(name srcs...)
 function(add_fmt_test name)
@@ -42,9 +26,13 @@ function(add_fmt_test name)
   else ()
     set(libs test-main fmt)
   endif ()
-  add_fmt_executable(${name} ${sources})
+  add_executable(${name} ${sources})
   target_link_libraries(${name} ${libs})
 
+  if (ADD_FMT_TEST_HEADER_ONLY AND NOT FMT_UNICODE)
+    target_compile_definitions(${name} PUBLIC FMT_UNICODE=0)
+  endif ()
+
   # Define if certain C++ features can be used.
   if (FMT_PEDANTIC)
     target_compile_options(${name} PRIVATE ${PEDANTIC_COMPILE_FLAGS})
@@ -60,10 +48,10 @@ if (FMT_MODULE)
 endif ()
 
 add_fmt_test(args-test)
+add_fmt_test(base-test)
 add_fmt_test(assert-test)
 add_fmt_test(chrono-test)
 add_fmt_test(color-test)
-add_fmt_test(core-test)
 add_fmt_test(gtest-extra-test)
 add_fmt_test(format-test mock-allocator.h)
 if (MSVC)
@@ -74,15 +62,16 @@ if (NOT (MSVC AND BUILD_SHARED_LIBS))
 endif ()
 add_fmt_test(ostream-test)
 add_fmt_test(compile-test)
-add_fmt_test(compile-fp-test HEADER_ONLY)
+add_fmt_test(compile-fp-test)
 if (MSVC)
   # Without this option, MSVC returns 199711L for the __cplusplus macro.
   target_compile_options(compile-fp-test PRIVATE /Zc:__cplusplus)
 endif()
 add_fmt_test(printf-test)
 add_fmt_test(ranges-test ranges-odr-test.cc)
+add_fmt_test(no-builtin-types-test HEADER_ONLY)
 
-add_fmt_test(scan-test)
+add_fmt_test(scan-test HEADER_ONLY)
 check_symbol_exists(strptime "time.h" HAVE_STRPTIME)
 if (HAVE_STRPTIME)
   target_compile_definitions(scan-test PRIVATE FMT_HAVE_STRPTIME)
@@ -106,6 +95,9 @@ add_fmt_test(enforce-checks-test)
 target_compile_definitions(enforce-checks-test PRIVATE
                            -DFMT_ENFORCE_COMPILE_STRING)
 
+add_executable(perf-sanity perf-sanity.cc)
+target_link_libraries(perf-sanity fmt::fmt)
+
 if (FMT_MODULE)
   # The tests need {fmt} to be compiled as traditional library
   # because of visibility of implementation details.
@@ -138,7 +130,7 @@ if (NOT DEFINED MSVC_STATIC_RUNTIME AND MSVC)
 endif()
 
 if (NOT MSVC_STATIC_RUNTIME)
-  add_fmt_executable(posix-mock-test
+  add_executable(posix-mock-test
     posix-mock-test.cc ../src/format.cc ${TEST_MAIN_SRC})
   target_include_directories(
     posix-mock-test PRIVATE ${PROJECT_SOURCE_DIR}/include)
@@ -146,6 +138,9 @@ if (NOT MSVC_STATIC_RUNTIME)
   if (FMT_PEDANTIC)
     target_compile_options(posix-mock-test PRIVATE ${PEDANTIC_COMPILE_FLAGS})
   endif ()
+  if (MSVC)
+    target_compile_options(posix-mock-test PRIVATE /utf-8)
+  endif ()
   add_test(NAME posix-mock-test COMMAND posix-mock-test)
   add_fmt_test(os-test)
 endif ()
@@ -226,7 +221,7 @@ if (FMT_PEDANTIC AND NOT WIN32 AND NOT (
     "-DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE}")
 endif ()
 
-# This test are disabled on Windows because it is only *NIX issue.
+# This test is disabled on Windows because it is POSIX-specific.
 if (FMT_PEDANTIC AND NOT WIN32)
   add_test(static-export-test ${CMAKE_CTEST_COMMAND}
     -C ${CMAKE_BUILD_TYPE}
diff --git a/test/add-subdirectory-test/main.cc b/test/add-subdirectory-test/main.cc
index fcdf232e..1d31cb90 100644
--- a/test/add-subdirectory-test/main.cc
+++ b/test/add-subdirectory-test/main.cc
@@ -1,4 +1,4 @@
-#include "fmt/core.h"
+#include "fmt/base.h"
 
 int main(int argc, char** argv) {
   for (int i = 0; i < argc; ++i) fmt::print("{}: {}\n", i, argv[i]);
diff --git a/test/args-test.cc b/test/args-test.cc
index 3ab31335..f99ff74e 100644
--- a/test/args-test.cc
+++ b/test/args-test.cc
@@ -38,12 +38,13 @@ struct custom_type {
 
 FMT_BEGIN_NAMESPACE
 template <> struct formatter<custom_type> {
-  auto parse(format_parse_context& ctx) const -> decltype(ctx.begin()) {
+  auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
     return ctx.begin();
   }
 
   template <typename FormatContext>
-  auto format(const custom_type& p, FormatContext& ctx) -> decltype(ctx.out()) {
+  auto format(const custom_type& p, FormatContext& ctx) const
+      -> decltype(ctx.out()) {
     return fmt::format_to(ctx.out(), "cust={}", p.i);
   }
 };
@@ -68,11 +69,11 @@ struct to_stringable {
 
 FMT_BEGIN_NAMESPACE
 template <> struct formatter<to_stringable> {
-  auto parse(format_parse_context& ctx) const -> decltype(ctx.begin()) {
+  auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
     return ctx.begin();
   }
 
-  auto format(to_stringable, format_context& ctx) -> decltype(ctx.out()) {
+  auto format(to_stringable, format_context& ctx) const -> decltype(ctx.out()) {
     return ctx.out();
   }
 };
@@ -143,9 +144,9 @@ TEST(args_test, reserve) {
   fmt::dynamic_format_arg_store<fmt::format_context> store;
   store.reserve(2, 1);
   store.push_back(1.5f);
-  store.push_back(fmt::arg("a1", 42));
-  auto result = fmt::vformat("{a1} and {}", store);
-  EXPECT_EQ("42 and 1.5", result);
+  store.push_back(fmt::arg("a", 42));
+  auto result = fmt::vformat("{} and {a}", store);
+  EXPECT_EQ("1.5 and 42", result);
 }
 
 struct copy_throwable {
@@ -155,10 +156,11 @@ struct copy_throwable {
 
 FMT_BEGIN_NAMESPACE
 template <> struct formatter<copy_throwable> {
-  auto parse(format_parse_context& ctx) const -> decltype(ctx.begin()) {
+  auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
     return ctx.begin();
   }
-  auto format(copy_throwable, format_context& ctx) -> decltype(ctx.out()) {
+  auto format(copy_throwable, format_context& ctx) const
+      -> decltype(ctx.out()) {
     return ctx.out();
   }
 };
diff --git a/test/assert-test.cc b/test/assert-test.cc
index c74e617e..368fb587 100644
--- a/test/assert-test.cc
+++ b/test/assert-test.cc
@@ -9,7 +9,7 @@
 //
 // For the license information refer to format.h.
 
-#include "fmt/core.h"
+#include "fmt/base.h"
 #include "gtest/gtest.h"
 
 TEST(assert_test, fail) {
diff --git a/test/core-test.cc b/test/base-test.cc
similarity index 62%
rename from test/core-test.cc
rename to test/base-test.cc
index 1d84ffd7..1ee0c657 100644
--- a/test/core-test.cc
+++ b/test/base-test.cc
@@ -9,13 +9,12 @@
 #include "test-assert.h"
 // clang-format on
 
-#include "fmt/core.h"
+#include "fmt/base.h"
 
-#include <algorithm>    // std::copy_n
 #include <climits>      // INT_MAX
 #include <cstring>      // std::strlen
 #include <functional>   // std::equal_to
-#include <iterator>     // std::back_insert_iterator
+#include <iterator>     // std::back_insert_iterator, std::distance
 #include <limits>       // std::numeric_limits
 #include <string>       // std::string
 #include <type_traits>  // std::is_same
@@ -33,6 +32,11 @@ using testing::Return;
 #  error core-test includes format.h
 #endif
 
+fmt::appender copy(fmt::string_view s, fmt::appender out) {
+  for (char c : s) *out++ = c;
+  return out;
+}
+
 TEST(string_view_test, value_type) {
   static_assert(std::is_same<string_view::value_type, char>::value, "");
 }
@@ -88,7 +92,11 @@ TEST(string_view_test, compare) {
   check_op<std::greater_equal>();
 }
 
-TEST(core_test, is_output_iterator) {
+TEST(base_test, is_locking) {
+  EXPECT_FALSE(fmt::detail::is_locking<const char(&)[3]>());
+}
+
+TEST(base_test, is_output_iterator) {
   EXPECT_TRUE((fmt::detail::is_output_iterator<char*, char>::value));
   EXPECT_FALSE((fmt::detail::is_output_iterator<const char*, char>::value));
   EXPECT_FALSE((fmt::detail::is_output_iterator<std::string, char>::value));
@@ -101,20 +109,11 @@ TEST(core_test, is_output_iterator) {
                                                 char>::value));
 }
 
-TEST(core_test, buffer_appender) {
-  // back_insert_iterator is not default-constructible before C++20, so
-  // buffer_appender can only be default-constructible when back_insert_iterator
-  // is.
-  static_assert(
-      std::is_default_constructible<
-          std::back_insert_iterator<fmt::detail::buffer<char>>>::value ==
-          std::is_default_constructible<
-              fmt::detail::buffer_appender<char>>::value,
-      "");
-
-#ifdef __cpp_lib_ranges
-  static_assert(std::output_iterator<fmt::detail::buffer_appender<char>, char>);
-#endif
+TEST(base_test, is_back_insert_iterator) {
+  EXPECT_TRUE(fmt::detail::is_back_insert_iterator<
+              std::back_insert_iterator<std::string>>::value);
+  EXPECT_FALSE(fmt::detail::is_back_insert_iterator<
+               std::front_insert_iterator<std::string>>::value);
 }
 
 #if !FMT_GCC_VERSION || FMT_GCC_VERSION >= 470
@@ -143,11 +142,12 @@ TEST(buffer_test, indestructible) {
 template <typename T> struct mock_buffer final : buffer<T> {
   MOCK_METHOD(size_t, do_grow, (size_t));
 
-  void grow(size_t capacity) override {
-    this->set(this->data(), do_grow(capacity));
+  static void grow(buffer<T>& buf, size_t capacity) {
+    auto& self = static_cast<mock_buffer&>(buf);
+    self.set(buf.data(), self.do_grow(capacity));
   }
 
-  mock_buffer(T* data = nullptr, size_t buf_capacity = 0) {
+  mock_buffer(T* data = nullptr, size_t buf_capacity = 0) : buffer<T>(grow) {
     this->set(data, buf_capacity);
     ON_CALL(*this, do_grow(_)).WillByDefault(Invoke([](size_t capacity) {
       return capacity;
@@ -266,25 +266,15 @@ TEST(buffer_test, append_allocates_enough_storage) {
   buffer.append(test, test + 9);
 }
 
-struct custom_context {
-  using char_type = char;
-  using parse_context_type = fmt::format_parse_context;
-
-  bool called = false;
-
-  template <typename T> struct formatter_type {
-    FMT_CONSTEXPR auto parse(fmt::format_parse_context& ctx) -> decltype(ctx.begin()) {
-      return ctx.begin();
-    }
-
-    const char* format(const T&, custom_context& ctx) {
-      ctx.called = true;
-      return nullptr;
-    }
-  };
-
-  void advance_to(const char*) {}
-};
+TEST(base_test, get_buffer) {
+  mock_buffer<char> buffer;
+  void* buffer_ptr = &buffer;
+  auto&& appender_result = fmt::detail::get_buffer<char>(fmt::appender(buffer));
+  EXPECT_EQ(&appender_result, buffer_ptr);
+  auto&& back_inserter_result =
+      fmt::detail::get_buffer<char>(std::back_inserter(buffer));
+  EXPECT_EQ(&back_inserter_result, buffer_ptr);
+}
 
 struct test_struct {};
 
@@ -295,8 +285,7 @@ template <typename Char> struct formatter<test_struct, Char> {
   }
 
   auto format(test_struct, format_context& ctx) const -> decltype(ctx.out()) {
-    auto test = string_view("test");
-    return std::copy_n(test.data(), test.size(), ctx.out());
+    return copy("test", ctx.out());
   }
 };
 FMT_END_NAMESPACE
@@ -306,22 +295,14 @@ TEST(arg_test, format_args) {
   EXPECT_FALSE(args.get(1));
 }
 
-TEST(arg_test, make_value_with_custom_context) {
-  auto t = test_struct();
-  auto arg = fmt::detail::value<custom_context>(
-      fmt::detail::arg_mapper<custom_context>().map(t));
-  auto ctx = custom_context();
-  auto parse_ctx = fmt::format_parse_context("");
-  arg.custom.format(&t, parse_ctx, ctx);
-  EXPECT_TRUE(ctx.called);
-}
-
 // Use a unique result type to make sure that there are no undesirable
 // conversions.
 struct test_result {};
 
 template <typename T> struct mock_visitor {
-  template <typename U> struct result { using type = test_result; };
+  template <typename U> struct result {
+    using type = test_result;
+  };
 
   mock_visitor() {
     ON_CALL(*this, visit(_)).WillByDefault(Return(test_result()));
@@ -338,10 +319,14 @@ template <typename T> struct mock_visitor {
   }
 };
 
-template <typename T> struct visit_type { using type = T; };
+template <typename T> struct visit_type {
+  using type = T;
+};
 
-#define VISIT_TYPE(type_, visit_type_) \
-  template <> struct visit_type<type_> { using type = visit_type_; }
+#define VISIT_TYPE(type_, visit_type_)   \
+  template <> struct visit_type<type_> { \
+    using type = visit_type_;            \
+  }
 
 VISIT_TYPE(signed char, int);
 VISIT_TYPE(unsigned char, unsigned);
@@ -356,32 +341,35 @@ VISIT_TYPE(long, long long);
 VISIT_TYPE(unsigned long, unsigned long long);
 #endif
 
-#define CHECK_ARG(Char, expected, value)                                  \
-  {                                                                       \
-    testing::StrictMock<mock_visitor<decltype(expected)>> visitor;        \
-    EXPECT_CALL(visitor, visit(expected));                                \
-    using iterator = std::back_insert_iterator<buffer<Char>>;             \
-    auto var = value;                                                     \
-    fmt::visit_format_arg(                                                \
-        visitor,                                                          \
-        fmt::detail::make_arg<fmt::basic_format_context<iterator, Char>>( \
-            var));                                                        \
-  }
+#if FMT_BUILTIN_TYPES
+#  define CHECK_ARG(expected, value)                                  \
+    {                                                                 \
+      testing::StrictMock<mock_visitor<decltype(expected)>> visitor;  \
+      EXPECT_CALL(visitor, visit(expected));                          \
+      auto var = value;                                               \
+      fmt::basic_format_arg<fmt::format_context>(var).visit(visitor); \
+    }
+#else
+#  define CHECK_ARG(expected, value)
+#endif
 
 #define CHECK_ARG_SIMPLE(value)                             \
   {                                                         \
     using value_type = decltype(value);                     \
     typename visit_type<value_type>::type expected = value; \
-    CHECK_ARG(char, expected, value)                        \
-    CHECK_ARG(wchar_t, expected, value)                     \
+    CHECK_ARG(expected, value)                              \
   }
 
 template <typename T> class numeric_arg_test : public testing::Test {};
 
+#if FMT_BUILTIN_TYPES
 using test_types =
     testing::Types<bool, signed char, unsigned char, short, unsigned short, int,
                    unsigned, long, unsigned long, long long, unsigned long long,
                    float, double, long double>;
+#else
+using test_types = testing::Types<int>;
+#endif
 TYPED_TEST_SUITE(numeric_arg_test, test_types);
 
 template <typename T, fmt::enable_if_t<std::is_integral<T>::value, int> = 0>
@@ -401,49 +389,44 @@ TYPED_TEST(numeric_arg_test, make_and_visit) {
   CHECK_ARG_SIMPLE(std::numeric_limits<TypeParam>::max());
 }
 
-TEST(arg_test, char_arg) { CHECK_ARG(char, 'a', 'a'); }
+TEST(arg_test, char_arg) { CHECK_ARG('a', 'a'); }
 
 TEST(arg_test, string_arg) {
   char str_data[] = "test";
   char* str = str_data;
   const char* cstr = str;
-  CHECK_ARG(char, cstr, str);
+  CHECK_ARG(cstr, str);
 
   auto sv = fmt::string_view(str);
-  CHECK_ARG(char, sv, std::string(str));
-}
-
-TEST(arg_test, wstring_arg) {
-  wchar_t str_data[] = L"test";
-  wchar_t* str = str_data;
-  const wchar_t* cstr = str;
-
-  auto sv = fmt::basic_string_view<wchar_t>(str);
-  CHECK_ARG(wchar_t, cstr, str);
-  CHECK_ARG(wchar_t, cstr, cstr);
-  CHECK_ARG(wchar_t, sv, std::wstring(str));
-  CHECK_ARG(wchar_t, sv, fmt::basic_string_view<wchar_t>(str));
+  CHECK_ARG(sv, std::string(str));
 }
 
 TEST(arg_test, pointer_arg) {
   void* p = nullptr;
   const void* cp = nullptr;
-  CHECK_ARG(char, cp, p);
-  CHECK_ARG(wchar_t, cp, p);
+  CHECK_ARG(cp, p);
   CHECK_ARG_SIMPLE(cp);
 }
 
+TEST(arg_test, volatile_pointer_arg) {
+  const void* p = nullptr;
+  volatile int* vip = nullptr;
+  const volatile int* cvip = nullptr;
+  CHECK_ARG(p, static_cast<volatile void*>(vip));
+  CHECK_ARG(p, static_cast<const volatile void*>(cvip));
+}
+
 struct check_custom {
   auto operator()(fmt::basic_format_arg<fmt::format_context>::handle h) const
       -> test_result {
     struct test_buffer final : fmt::detail::buffer<char> {
       char data[10];
-      test_buffer() : fmt::detail::buffer<char>(data, 0, 10) {}
-      void grow(size_t) override {}
+      test_buffer()
+          : fmt::detail::buffer<char>([](buffer<char>&, size_t) {}, data, 0,
+                                      10) {}
     } buffer;
     auto parse_ctx = fmt::format_parse_context("");
-    auto ctx = fmt::format_context(fmt::detail::buffer_appender<char>(buffer),
-                                   fmt::format_args());
+    auto ctx = fmt::format_context(fmt::appender(buffer), fmt::format_args());
     h.format(parse_ctx, ctx);
     EXPECT_EQ("test", std::string(buffer.data, buffer.size()));
     return test_result();
@@ -456,26 +439,23 @@ TEST(arg_test, custom_arg) {
       mock_visitor<fmt::basic_format_arg<fmt::format_context>::handle>;
   auto&& v = testing::StrictMock<visitor>();
   EXPECT_CALL(v, visit(_)).WillOnce(Invoke(check_custom()));
-  fmt::visit_format_arg(v, fmt::detail::make_arg<fmt::format_context>(test));
+  fmt::basic_format_arg<fmt::format_context>(test).visit(v);
 }
 
 TEST(arg_test, visit_invalid_arg) {
   auto&& visitor = testing::StrictMock<mock_visitor<fmt::monostate>>();
   EXPECT_CALL(visitor, visit(_));
-  auto arg = fmt::basic_format_arg<fmt::format_context>();
-  fmt::visit_format_arg(visitor, arg);
+  fmt::basic_format_arg<fmt::format_context>().visit(visitor);
 }
 
 #if FMT_USE_CONSTEXPR
 
-enum class arg_id_result { none, empty, index, name };
+enum class arg_id_result { none, index, name };
 struct test_arg_id_handler {
   arg_id_result res = arg_id_result::none;
   int index = 0;
   string_view name;
 
-  constexpr void on_auto() { res = arg_id_result::empty; }
-
   constexpr void on_index(int i) {
     res = arg_id_result::index;
     index = i;
@@ -494,9 +474,7 @@ constexpr test_arg_id_handler parse_arg_id(const char (&s)[N]) {
   return h;
 }
 
-TEST(core_test, constexpr_parse_arg_id) {
-  static_assert(parse_arg_id(":").res == arg_id_result::empty, "");
-  static_assert(parse_arg_id("}").res == arg_id_result::empty, "");
+TEST(base_test, constexpr_parse_arg_id) {
   static_assert(parse_arg_id("42:").res == arg_id_result::index, "");
   static_assert(parse_arg_id("42:").index == 42, "");
   static_assert(parse_arg_id("foo:").res == arg_id_result::name, "");
@@ -512,21 +490,21 @@ template <size_t N> constexpr auto parse_test_specs(const char (&s)[N]) {
   return specs;
 }
 
-TEST(core_test, constexpr_parse_format_specs) {
-  static_assert(parse_test_specs("<").align == fmt::align::left, "");
-  static_assert(parse_test_specs("*^").fill[0] == '*', "");
-  static_assert(parse_test_specs("+").sign == fmt::sign::plus, "");
-  static_assert(parse_test_specs("-").sign == fmt::sign::minus, "");
-  static_assert(parse_test_specs(" ").sign == fmt::sign::space, "");
-  static_assert(parse_test_specs("#").alt, "");
-  static_assert(parse_test_specs("0").align == fmt::align::numeric, "");
-  static_assert(parse_test_specs("L").localized, "");
+TEST(base_test, constexpr_parse_format_specs) {
+  static_assert(parse_test_specs("<").align() == fmt::align::left, "");
+  static_assert(parse_test_specs("*^").fill_unit<char>() == '*', "");
+  static_assert(parse_test_specs("+").sign() == fmt::sign::plus, "");
+  static_assert(parse_test_specs("-").sign() == fmt::sign::none, "");
+  static_assert(parse_test_specs(" ").sign() == fmt::sign::space, "");
+  static_assert(parse_test_specs("#").alt(), "");
+  static_assert(parse_test_specs("0").align() == fmt::align::numeric, "");
+  static_assert(parse_test_specs("L").localized(), "");
   static_assert(parse_test_specs("42").width == 42, "");
-  static_assert(parse_test_specs("{42}").width_ref.val.index == 42, "");
+  static_assert(parse_test_specs("{42}").width_ref.index == 42, "");
   static_assert(parse_test_specs(".42").precision == 42, "");
-  static_assert(parse_test_specs(".{42}").precision_ref.val.index == 42, "");
-  static_assert(
-      parse_test_specs("f").type == fmt::presentation_type::fixed_lower, "");
+  static_assert(parse_test_specs(".{42}").precision_ref.index == 42, "");
+  static_assert(parse_test_specs("f").type() == fmt::presentation_type::fixed,
+                "");
 }
 
 struct test_format_string_handler {
@@ -550,11 +528,11 @@ struct test_format_string_handler {
 
 template <size_t N> constexpr bool parse_string(const char (&s)[N]) {
   auto h = test_format_string_handler();
-  fmt::detail::parse_format_string<true>(fmt::string_view(s, N - 1), h);
+  fmt::detail::parse_format_string(fmt::string_view(s, N - 1), h);
   return !h.error;
 }
 
-TEST(core_test, constexpr_parse_format_string) {
+TEST(base_test, constexpr_parse_format_string) {
   static_assert(parse_string("foo"), "");
   static_assert(!parse_string("}"), "");
   static_assert(parse_string("{}"), "");
@@ -593,15 +571,6 @@ template <> struct formatter<enabled_ptr_formatter*> {
 };
 FMT_END_NAMESPACE
 
-TEST(core_test, has_formatter) {
-  using fmt::has_formatter;
-  using context = fmt::format_context;
-  static_assert(has_formatter<enabled_formatter, context>::value, "");
-  static_assert(!has_formatter<disabled_formatter, context>::value, "");
-  static_assert(!has_formatter<disabled_formatter_convertible, context>::value,
-                "");
-}
-
 struct const_formattable {};
 struct nonconst_formattable {};
 
@@ -611,10 +580,9 @@ template <> struct formatter<const_formattable> {
     return ctx.begin();
   }
 
-  auto format(const const_formattable&, format_context& ctx)
+  auto format(const const_formattable&, format_context& ctx) const
       -> decltype(ctx.out()) {
-    auto test = string_view("test");
-    return std::copy_n(test.data(), test.size(), ctx.out());
+    return copy("test", ctx.out());
   }
 };
 
@@ -623,10 +591,9 @@ template <> struct formatter<nonconst_formattable> {
     return ctx.begin();
   }
 
-  auto format(nonconst_formattable&, format_context& ctx)
+  auto format(nonconst_formattable&, format_context& ctx) const
       -> decltype(ctx.out()) {
-    auto test = string_view("test");
-    return std::copy_n(test.data(), test.size(), ctx.out());
+    return copy("test", ctx.out());
   }
 };
 FMT_END_NAMESPACE
@@ -647,116 +614,133 @@ template <> struct formatter<convertible_to_pointer_formattable> {
 
   auto format(convertible_to_pointer_formattable, format_context& ctx) const
       -> decltype(ctx.out()) {
-    auto test = string_view("test");
-    return std::copy_n(test.data(), test.size(), ctx.out());
+    return copy("test", ctx.out());
   }
 };
 FMT_END_NAMESPACE
 
 enum class unformattable_scoped_enum {};
 
-TEST(core_test, is_formattable) {
-  static_assert(!fmt::is_formattable<wchar_t>::value, "");
+TEST(base_test, is_formattable) {
+  EXPECT_FALSE(fmt::is_formattable<void>::value);
+  EXPECT_FALSE(fmt::is_formattable<wchar_t>::value);
 #ifdef __cpp_char8_t
-  static_assert(!fmt::is_formattable<char8_t>::value, "");
+  EXPECT_FALSE(fmt::is_formattable<char8_t>::value);
 #endif
-  static_assert(!fmt::is_formattable<char16_t>::value, "");
-  static_assert(!fmt::is_formattable<char32_t>::value, "");
-  static_assert(!fmt::is_formattable<signed char*>::value, "");
-  static_assert(!fmt::is_formattable<unsigned char*>::value, "");
-  static_assert(!fmt::is_formattable<const signed char*>::value, "");
-  static_assert(!fmt::is_formattable<const unsigned char*>::value, "");
-  static_assert(!fmt::is_formattable<const wchar_t*>::value, "");
-  static_assert(!fmt::is_formattable<const wchar_t[3]>::value, "");
-  static_assert(!fmt::is_formattable<fmt::basic_string_view<wchar_t>>::value,
-                "");
-  static_assert(fmt::is_formattable<enabled_formatter>::value, "");
-  static_assert(!fmt::is_formattable<enabled_ptr_formatter*>::value, "");
-  static_assert(!fmt::is_formattable<disabled_formatter>::value, "");
-  static_assert(!fmt::is_formattable<disabled_formatter_convertible>::value,
-                "");
-
-  static_assert(fmt::is_formattable<const_formattable&>::value, "");
-  static_assert(fmt::is_formattable<const const_formattable&>::value, "");
-
-  static_assert(fmt::is_formattable<nonconst_formattable&>::value, "");
+  EXPECT_FALSE(fmt::is_formattable<char16_t>::value);
+  EXPECT_FALSE(fmt::is_formattable<char32_t>::value);
+  EXPECT_FALSE(fmt::is_formattable<signed char*>::value);
+  EXPECT_FALSE(fmt::is_formattable<unsigned char*>::value);
+  EXPECT_FALSE(fmt::is_formattable<const signed char*>::value);
+  EXPECT_FALSE(fmt::is_formattable<const unsigned char*>::value);
+  EXPECT_FALSE(fmt::is_formattable<const wchar_t*>::value);
+  EXPECT_FALSE(fmt::is_formattable<const wchar_t[3]>::value);
+  EXPECT_FALSE(fmt::is_formattable<fmt::basic_string_view<wchar_t>>::value);
+  EXPECT_FALSE(fmt::is_formattable<enabled_ptr_formatter*>::value);
+  EXPECT_FALSE(fmt::is_formattable<disabled_formatter>::value);
+  EXPECT_FALSE(fmt::is_formattable<disabled_formatter_convertible>::value);
+
+  EXPECT_TRUE(fmt::is_formattable<enabled_formatter>::value);
+  EXPECT_TRUE(fmt::is_formattable<const_formattable&>::value);
+  EXPECT_TRUE(fmt::is_formattable<const const_formattable&>::value);
+
+  EXPECT_TRUE(fmt::is_formattable<nonconst_formattable&>::value);
 #if !FMT_MSC_VERSION || FMT_MSC_VERSION >= 1910
-  static_assert(!fmt::is_formattable<const nonconst_formattable&>::value, "");
+  EXPECT_FALSE(fmt::is_formattable<const nonconst_formattable&>::value);
 #endif
 
-  static_assert(!fmt::is_formattable<convertible_to_pointer>::value, "");
+  EXPECT_FALSE(fmt::is_formattable<convertible_to_pointer>::value);
   const auto f = convertible_to_pointer_formattable();
-  EXPECT_EQ(fmt::format("{}", f), "test");
+  auto str = std::string();
+  fmt::format_to(std::back_inserter(str), "{}", f);
+  EXPECT_EQ(str, "test");
 
-  static_assert(!fmt::is_formattable<void (*)()>::value, "");
+  EXPECT_FALSE(fmt::is_formattable<void (*)()>::value);
 
   struct s;
-  static_assert(!fmt::is_formattable<int(s::*)>::value, "");
-  static_assert(!fmt::is_formattable<int (s::*)()>::value, "");
-  static_assert(!fmt::is_formattable<unformattable_scoped_enum>::value, "");
-  static_assert(!fmt::is_formattable<unformattable_scoped_enum>::value, "");
+  EXPECT_FALSE(fmt::is_formattable<int(s::*)>::value);
+  EXPECT_FALSE(fmt::is_formattable<int (s::*)()>::value);
+  EXPECT_FALSE(fmt::is_formattable<unformattable_scoped_enum>::value);
+  EXPECT_FALSE(fmt::is_formattable<unformattable_scoped_enum>::value);
+}
+
+#ifdef __cpp_concepts
+TEST(base_test, formattable_concept) {
+  static_assert(fmt::formattable<char>);
+  static_assert(fmt::formattable<char&>);
+  static_assert(fmt::formattable<char&&>);
+  static_assert(fmt::formattable<const char>);
+  static_assert(fmt::formattable<const char&>);
+  static_assert(fmt::formattable<const char&&>);
+  static_assert(fmt::formattable<int>);
+  static_assert(!fmt::formattable<wchar_t>);
 }
+#endif
 
-TEST(core_test, format) { EXPECT_EQ(fmt::format("{}", 42), "42"); }
-
-TEST(core_test, format_to) {
+TEST(base_test, format_to) {
   auto s = std::string();
   fmt::format_to(std::back_inserter(s), "{}", 42);
   EXPECT_EQ(s, "42");
 }
 
-#ifdef __cpp_lib_byte
-TEST(core_test, format_byte) {
-  EXPECT_EQ(fmt::format("{}", std::byte(42)), "42");
-}
-#endif
-
-struct convertible_to_int {
-  operator int() const { return 42; }
-};
-
-struct convertible_to_cstring {
-  operator const char*() const { return "foo"; }
-};
-
-FMT_BEGIN_NAMESPACE
-template <> struct formatter<convertible_to_int> {
-  FMT_CONSTEXPR auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
-    return ctx.begin();
-  }
-  auto format(convertible_to_int, format_context& ctx) const
-      -> decltype(ctx.out()) {
-    return std::copy_n("foo", 3, ctx.out());
-  }
-};
-
-template <> struct formatter<convertible_to_cstring> {
-  FMT_CONSTEXPR auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
-    return ctx.begin();
-  }
-  auto format(convertible_to_cstring, format_context& ctx) const
-      -> decltype(ctx.out()) {
-    return std::copy_n("bar", 3, ctx.out());
-  }
-};
-FMT_END_NAMESPACE
-
-TEST(core_test, formatter_overrides_implicit_conversion) {
-  EXPECT_EQ(fmt::format("{}", convertible_to_int()), "foo");
-  EXPECT_EQ(fmt::format("{}", convertible_to_cstring()), "bar");
+TEST(base_test, format_to_array) {
+  char buffer[4];
+  auto result = fmt::format_to(buffer, "{}", 12345);
+  EXPECT_EQ(4, std::distance(&buffer[0], result.out));
+  EXPECT_TRUE(result.truncated);
+  EXPECT_EQ(buffer + 4, result.out);
+  EXPECT_EQ("1234", fmt::string_view(buffer, 4));
+
+  char* out = nullptr;
+  EXPECT_THROW(out = result, std::runtime_error);
+  (void)out;
+
+  result = fmt::format_to(buffer, "{:s}", "foobar");
+  EXPECT_EQ(4, std::distance(&buffer[0], result.out));
+  EXPECT_TRUE(result.truncated);
+  EXPECT_EQ(buffer + 4, result.out);
+  EXPECT_EQ("foob", fmt::string_view(buffer, 4));
+
+  buffer[0] = 'x';
+  buffer[1] = 'x';
+  buffer[2] = 'x';
+  buffer[3] = 'x';
+  result = fmt::format_to(buffer, "{}", 'A');
+  EXPECT_EQ(1, std::distance(&buffer[0], result.out));
+  EXPECT_FALSE(result.truncated);
+  EXPECT_EQ(buffer + 1, result.out);
+  EXPECT_EQ("Axxx", fmt::string_view(buffer, 4));
+
+  result = fmt::format_to(buffer, "{}{} ", 'B', 'C');
+  EXPECT_EQ(3, std::distance(&buffer[0], result.out));
+  EXPECT_FALSE(result.truncated);
+  EXPECT_EQ(buffer + 3, result.out);
+  EXPECT_EQ("BC x", fmt::string_view(buffer, 4));
+
+  result = fmt::format_to(buffer, "{}", "ABCDE");
+  EXPECT_EQ(4, std::distance(&buffer[0], result.out));
+  EXPECT_TRUE(result.truncated);
+  EXPECT_EQ("ABCD", fmt::string_view(buffer, 4));
+
+  result = fmt::format_to(buffer, "{}", std::string(1000, '*').c_str());
+  EXPECT_EQ(4, std::distance(&buffer[0], result.out));
+  EXPECT_TRUE(result.truncated);
+  EXPECT_EQ("****", fmt::string_view(buffer, 4));
 }
 
 // Test that check is not found by ADL.
 template <typename T> void check(T);
-TEST(core_test, adl_check) {
-  EXPECT_EQ(fmt::format("{}", test_struct()), "test");
+TEST(base_test, adl_check) {
+  auto s = std::string();
+  fmt::format_to(std::back_inserter(s), "{}", test_struct());
+  EXPECT_EQ(s, "test");
 }
 
 struct implicitly_convertible_to_string_view {
   operator fmt::string_view() const { return "foo"; }
 };
 
-TEST(core_test, no_implicit_conversion_to_string_view) {
+TEST(base_test, no_implicit_conversion_to_string_view) {
   EXPECT_FALSE(
       fmt::is_formattable<implicitly_convertible_to_string_view>::value);
 }
@@ -766,7 +750,7 @@ struct implicitly_convertible_to_std_string_view {
   operator std::string_view() const { return "foo"; }
 };
 
-TEST(core_test, no_implicit_conversion_to_std_string_view) {
+TEST(base_test, no_implicit_conversion_to_std_string_view) {
   EXPECT_FALSE(
       fmt::is_formattable<implicitly_convertible_to_std_string_view>::value);
 }
@@ -778,7 +762,7 @@ struct explicitly_convertible_to_string_view {
   explicit operator fmt::string_view() const { return "foo"; }
 };
 
-TEST(core_test, format_explicitly_convertible_to_string_view) {
+TEST(base_test, format_explicitly_convertible_to_string_view) {
   // Types explicitly convertible to string_view are not formattable by
   // default because it may introduce ODR violations.
   static_assert(
@@ -790,7 +774,7 @@ struct explicitly_convertible_to_std_string_view {
   explicit operator std::string_view() const { return "foo"; }
 };
 
-TEST(core_test, format_explicitly_convertible_to_std_string_view) {
+TEST(base_test, format_explicitly_convertible_to_std_string_view) {
   // Types explicitly convertible to string_view are not formattable by
   // default because it may introduce ODR violations.
   static_assert(
@@ -800,36 +784,39 @@ TEST(core_test, format_explicitly_convertible_to_std_string_view) {
 #  endif
 #endif
 
-namespace adl_test {
-template <typename... T> void make_format_args(const T&...) = delete;
-
-struct string : std::string {};
-}  // namespace adl_test
-
-// Test that formatting functions compile when make_format_args is found by ADL.
-TEST(core_test, adl) {
-  // Only check compilation and don't run the code to avoid polluting the output
-  // and since the output is tested elsewhere.
-  if (fmt::detail::const_check(true)) return;
-  auto s = adl_test::string();
-  char buf[10];
-  (void)fmt::format("{}", s);
-  fmt::format_to(buf, "{}", s);
-  fmt::format_to_n(buf, 10, "{}", s);
-  (void)fmt::formatted_size("{}", s);
-  fmt::print("{}", s);
-  fmt::print(stdout, "{}", s);
+TEST(base_test, has_formatter) {
+  EXPECT_TRUE((fmt::detail::has_formatter<const const_formattable, char>()));
+  EXPECT_FALSE(
+      (fmt::detail::has_formatter<const nonconst_formattable, char>()));
 }
 
-TEST(core_test, has_const_formatter) {
-  EXPECT_TRUE((fmt::detail::has_const_formatter<const_formattable,
-                                                fmt::format_context>()));
-  EXPECT_FALSE((fmt::detail::has_const_formatter<nonconst_formattable,
-                                                 fmt::format_context>()));
+TEST(base_test, format_nonconst) {
+  auto s = std::string();
+  fmt::format_to(std::back_inserter(s), "{}", nonconst_formattable());
+  EXPECT_EQ(s, "test");
 }
 
-TEST(core_test, format_nonconst) {
-  EXPECT_EQ(fmt::format("{}", nonconst_formattable()), "test");
+TEST(base_test, throw_in_buffer_dtor) {
+  enum { buffer_size = 256 };
+
+  struct throwing_iterator {
+    int& count;
+
+    auto operator=(char) -> throwing_iterator& {
+      if (++count > buffer_size) throw std::exception();
+      return *this;
+    }
+    auto operator*() -> throwing_iterator& { return *this; }
+    auto operator++() -> throwing_iterator& { return *this; }
+    auto operator++(int) -> throwing_iterator { return *this; }
+  };
+
+  try {
+    int count = 0;
+    fmt::format_to(throwing_iterator{count}, fmt::runtime("{:{}}{"), "",
+                   buffer_size + 1);
+  } catch (const std::exception&) {
+  }
 }
 
 struct its_a_trap {
@@ -846,13 +833,52 @@ template <> struct formatter<its_a_trap> {
     return ctx.begin();
   }
 
-  auto format(its_a_trap, format_context& ctx) const -> decltype(ctx.out()) {
-    auto s = string_view("42");
-    return std::copy(s.begin(), s.end(), ctx.out());
+  auto format(its_a_trap, format_context& ctx) const
+      -> decltype(ctx.out()) const {
+    auto out = ctx.out();
+    *out++ = 'x';
+    return out;
   }
 };
 FMT_END_NAMESPACE
 
-TEST(core_test, trappy_conversion) {
-  EXPECT_EQ(fmt::format("{}", its_a_trap()), "42");
+TEST(base_test, trappy_conversion) {
+  auto s = std::string();
+  fmt::format_to(std::back_inserter(s), "{}", its_a_trap());
+  EXPECT_EQ(s, "x");
+}
+
+struct custom_container {
+  char data;
+
+  using value_type = char;
+
+  size_t size() const { return 0; }
+  void resize(size_t) {}
+
+  void push_back(char) {}
+  char& operator[](size_t) { return data; }
+};
+
+FMT_BEGIN_NAMESPACE
+template <> struct is_contiguous<custom_container> : std::true_type {};
+FMT_END_NAMESPACE
+
+TEST(base_test, format_to_custom_container) {
+  auto c = custom_container();
+  fmt::format_to(std::back_inserter(c), "");
+}
+
+struct nondeterministic_format_string {
+  mutable int i = 0;
+  FMT_CONSTEXPR operator string_view() const {
+    return string_view("{}", i++ != 0 ? 2 : 0);
+  }
+};
+
+TEST(base_test, no_repeated_format_string_conversions) {
+#if !FMT_GCC_VERSION
+  char buf[10];
+  fmt::format_to(buf, nondeterministic_format_string());
+#endif
 }
diff --git a/test/chrono-test.cc b/test/chrono-test.cc
index b2d03f97..33eeb184 100644
--- a/test/chrono-test.cc
+++ b/test/chrono-test.cc
@@ -539,6 +539,7 @@ TEST(chrono_test, format_specs) {
   EXPECT_EQ(fmt::format("{:%I}", std::chrono::hours(24)), "12");
   EXPECT_EQ(fmt::format("{:%I}", std::chrono::hours(4)), "04");
   EXPECT_EQ(fmt::format("{:%I}", std::chrono::hours(14)), "02");
+  EXPECT_EQ(fmt::format("{:%j}", days(12)), "12");
   EXPECT_EQ(fmt::format("{:%j}", days(12345)), "12345");
   EXPECT_EQ(fmt::format("{:%j}", std::chrono::hours(12345 * 24 + 12)), "12345");
   EXPECT_EQ(fmt::format("{:%H:%M:%S}", std::chrono::seconds(12345)),
@@ -751,17 +752,21 @@ TEST(chrono_test, unsigned_duration) {
 TEST(chrono_test, weekday) {
   auto loc = get_locale("es_ES.UTF-8");
   std::locale::global(loc);
+
   auto sat = fmt::weekday(6);
 
   auto tm = std::tm();
   tm.tm_wday = static_cast<int>(sat.c_encoding());
 
   EXPECT_EQ(fmt::format("{}", sat), "Sat");
+  EXPECT_EQ(fmt::format("{:%a}", sat), "Sat");
+  EXPECT_EQ(fmt::format("{:%A}", sat), "Saturday");
   EXPECT_EQ(fmt::format("{:%a}", tm), "Sat");
 
   if (loc != std::locale::classic()) {
-    auto saturdays = std::vector<std::string>{"sb", "s."};
+    auto saturdays = std::vector<std::string>{"sb", "s.", "sb."};
     EXPECT_THAT(saturdays, Contains(fmt::format(loc, "{:L}", sat)));
+    EXPECT_THAT(saturdays, Contains(fmt::format(loc, "{:%a}", sat)));
     EXPECT_THAT(saturdays, Contains(fmt::format(loc, "{:%a}", tm)));
   }
 }
@@ -791,6 +796,14 @@ TEST(chrono_test, cpp20_duration_subsecond_support) {
             "01.234000");
   EXPECT_EQ(fmt::format("{:.6%S}", std::chrono::milliseconds{-1234}),
             "-01.234000");
+  EXPECT_EQ(fmt::format("{:.2%S}", std::chrono::milliseconds{12345}), "12.34");
+  EXPECT_EQ(fmt::format("{:.2%S}", std::chrono::milliseconds{12375}), "12.37");
+  EXPECT_EQ(fmt::format("{:.2%S}", std::chrono::milliseconds{-12375}),
+            "-12.37");
+  EXPECT_EQ(fmt::format("{:.0%S}", std::chrono::milliseconds{12054}), "12");
+  EXPECT_EQ(fmt::format("{:.2%S}", std::chrono::milliseconds{99999}), "39.99");
+  EXPECT_EQ(fmt::format("{:.2%S}", std::chrono::milliseconds{1000}), "01.00");
+  EXPECT_EQ(fmt::format("{:.3%S}", std::chrono::milliseconds{1}), "00.001");
   EXPECT_EQ(fmt::format("{:.3%S}", std::chrono::seconds{1234}), "34.000");
   EXPECT_EQ(fmt::format("{:.3%S}", std::chrono::hours{1234}), "00.000");
   EXPECT_EQ(fmt::format("{:.5%S}", dms(1.234)), "00.00123");
@@ -953,12 +966,11 @@ TEST(chrono_test, glibc_extensions) {
                    std::chrono::seconds(3);
 
     EXPECT_EQ(fmt::format("{:%I,%H,%M,%S}", d), "01,01,02,03");
-    EXPECT_EQ(fmt::format("{:%0I,%0H,%0M,%0S}", d), "01,01,02,03");
     EXPECT_EQ(fmt::format("{:%_I,%_H,%_M,%_S}", d), " 1, 1, 2, 3");
     EXPECT_EQ(fmt::format("{:%-I,%-H,%-M,%-S}", d), "1,1,2,3");
+    EXPECT_EQ(fmt::format("{:%-I,%H,%M,%S}", d), "1,01,02,03");
 
     EXPECT_EQ(fmt::format("{:%OI,%OH,%OM,%OS}", d), "01,01,02,03");
-    EXPECT_EQ(fmt::format("{:%0OI,%0OH,%0OM,%0OS}", d), "01,01,02,03");
     EXPECT_EQ(fmt::format("{:%_OI,%_OH,%_OM,%_OS}", d), " 1, 1, 2, 3");
     EXPECT_EQ(fmt::format("{:%-OI,%-OH,%-OM,%-OS}", d), "1,1,2,3");
   }
@@ -966,12 +978,10 @@ TEST(chrono_test, glibc_extensions) {
   {
     const auto tm = make_tm(1970, 1, 1, 1, 2, 3);
     EXPECT_EQ(fmt::format("{:%I,%H,%M,%S}", tm), "01,01,02,03");
-    EXPECT_EQ(fmt::format("{:%0I,%0H,%0M,%0S}", tm), "01,01,02,03");
     EXPECT_EQ(fmt::format("{:%_I,%_H,%_M,%_S}", tm), " 1, 1, 2, 3");
     EXPECT_EQ(fmt::format("{:%-I,%-H,%-M,%-S}", tm), "1,1,2,3");
 
     EXPECT_EQ(fmt::format("{:%OI,%OH,%OM,%OS}", tm), "01,01,02,03");
-    EXPECT_EQ(fmt::format("{:%0OI,%0OH,%0OM,%0OS}", tm), "01,01,02,03");
     EXPECT_EQ(fmt::format("{:%_OI,%_OH,%_OM,%_OS}", tm), " 1, 1, 2, 3");
     EXPECT_EQ(fmt::format("{:%-OI,%-OH,%-OM,%-OS}", tm), "1,1,2,3");
   }
@@ -979,21 +989,100 @@ TEST(chrono_test, glibc_extensions) {
   {
     const auto d = std::chrono::seconds(3) + std::chrono::milliseconds(140);
     EXPECT_EQ(fmt::format("{:%S}", d), "03.140");
-    EXPECT_EQ(fmt::format("{:%0S}", d), "03.140");
     EXPECT_EQ(fmt::format("{:%_S}", d), " 3.140");
     EXPECT_EQ(fmt::format("{:%-S}", d), "3.140");
   }
 
   {
-    const auto d = std::chrono::duration<double>(3.14);
+    auto d = std::chrono::duration<double>(3.14);
     EXPECT_EQ(fmt::format("{:%S}", d), "03.140000");
-    EXPECT_EQ(fmt::format("{:%0S}", d), "03.140000");
     EXPECT_EQ(fmt::format("{:%_S}", d), " 3.140000");
     EXPECT_EQ(fmt::format("{:%-S}", d), "3.140000");
   }
+
+  {
+    auto t = std::tm();
+    t.tm_yday = 7;
+    EXPECT_EQ(fmt::format("{:%U,%W,%V}", t), "02,01,01");
+    EXPECT_EQ(fmt::format("{:%_U,%_W,%_V}", t), " 2, 1, 1");
+    EXPECT_EQ(fmt::format("{:%-U,%-W,%-V}", t), "2,1,1");
+
+    EXPECT_EQ(fmt::format("{:%j}", t), "008");
+    EXPECT_EQ(fmt::format("{:%_j}", t), "  8");
+    EXPECT_EQ(fmt::format("{:%-j}", t), "8");
+  }
+
+  {
+    auto t = std::tm();
+    t.tm_mday = 7;
+    EXPECT_EQ(fmt::format("{:%d}", t), "07");
+    EXPECT_EQ(fmt::format("{:%_d}", t), " 7");
+    EXPECT_EQ(fmt::format("{:%-d}", t), "7");
+
+    EXPECT_EQ(fmt::format("{:%e}", t), " 7");
+  }
+
+  {
+    auto t = std::tm();
+    t.tm_year = 7 - 1900;
+    EXPECT_EQ(fmt::format("{:%Y}", t), "0007");
+    EXPECT_EQ(fmt::format("{:%_Y}", t), "   7");
+    EXPECT_EQ(fmt::format("{:%-Y}", t), "7");
+  }
+
+  {
+    auto t = std::tm();
+    t.tm_year = -5 - 1900;
+    EXPECT_EQ(fmt::format( "{:%Y}", t), "-005");
+    EXPECT_EQ(fmt::format("{:%_Y}", t), "  -5");
+    EXPECT_EQ(fmt::format("{:%-Y}", t), "-5");
+  }
+
+  {
+    auto t = std::tm();
+    t.tm_mon = 7 - 1;
+    EXPECT_EQ(fmt::format("{:%m}", t), "07");
+    EXPECT_EQ(fmt::format("{:%_m}", t), " 7");
+    EXPECT_EQ(fmt::format("{:%-m}", t), "7");
+  }
+
+
 }
 
 TEST(chrono_test, out_of_range) {
   auto d = std::chrono::duration<unsigned long, std::giga>(538976288);
   EXPECT_THROW((void)fmt::format("{:%j}", d), fmt::format_error);
-}
\ No newline at end of file
+}
+
+TEST(chrono_test, year_month_day) {
+  auto loc = get_locale("es_ES.UTF-8");
+  std::locale::global(loc);
+
+  auto year = fmt::year(2024);
+  auto month = fmt::month(1);
+  auto day = fmt::day(1);
+  auto ymd = fmt::year_month_day(year, month, day);
+
+  EXPECT_EQ(fmt::format("{}", year), "2024");
+  EXPECT_EQ(fmt::format("{:%Y}", year), "2024");
+  EXPECT_EQ(fmt::format("{:%y}", year), "24");
+
+  EXPECT_EQ(fmt::format("{}", month), "Jan");
+  EXPECT_EQ(fmt::format("{:%m}", month), "01");
+  EXPECT_EQ(fmt::format("{:%b}", month), "Jan");
+  EXPECT_EQ(fmt::format("{:%B}", month), "January");
+
+  EXPECT_EQ(fmt::format("{}", day), "01");
+  EXPECT_EQ(fmt::format("{:%d}", day), "01");
+
+  EXPECT_EQ(fmt::format("{}", ymd), "2024-01-01");
+  EXPECT_EQ(fmt::format("{:%Y-%m-%d}", ymd), "2024-01-01");
+  EXPECT_EQ(fmt::format("{:%Y-%b-%d}", ymd), "2024-Jan-01");
+  EXPECT_EQ(fmt::format("{:%Y-%B-%d}", ymd), "2024-January-01");
+
+  if (loc != std::locale::classic()) {
+    auto months = std::vector<std::string>{"ene.", "ene"};
+    EXPECT_THAT(months, Contains(fmt::format(loc, "{:L}", month)));
+    EXPECT_THAT(months, Contains(fmt::format(loc, "{:%b}", month)));
+  }
+}
diff --git a/test/compile-error-test/CMakeLists.txt b/test/compile-error-test/CMakeLists.txt
index c4a16068..a86996e2 100644
--- a/test/compile-error-test/CMakeLists.txt
+++ b/test/compile-error-test/CMakeLists.txt
@@ -115,8 +115,7 @@ function (run_tests)
   endif ()
 endfunction ()
 
-
-# check if the source file skeleton compiles
+# Check if the source file skeleton compiles.
 expect_compile(check "")
 expect_compile(check-error "compilation_error" ERROR)
 
@@ -166,31 +165,6 @@ expect_compile(format-lots-of-arguments-with-function "
   fmt::format(\"\", 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, f);
 " ERROR)
 
-# Check if user-defined literals are available
-include(CheckCXXSourceCompiles)
-set(CMAKE_REQUIRED_FLAGS ${CXX_STANDARD_FLAG})
-check_cxx_source_compiles("
-  void operator\"\" _udl(long double);
-  int main() {}"
-  SUPPORTS_USER_DEFINED_LITERALS)
-set(CMAKE_REQUIRED_FLAGS )
-if (NOT SUPPORTS_USER_DEFINED_LITERALS)
-  set (SUPPORTS_USER_DEFINED_LITERALS OFF)
-endif ()
-
-# Make sure that compiler features detected in the header
-# match the features detected in CMake.
-if (SUPPORTS_USER_DEFINED_LITERALS)
-  set(supports_udl 1)
-else ()
-  set(supports_udl 0)
-endif ()
-expect_compile(udl-check "
-  #if FMT_USE_USER_DEFINED_LITERALS != ${supports_udl}
-  # error
-  #endif
-")
-
 if (CMAKE_CXX_STANDARD GREATER_EQUAL 20)
   # Compile-time argument type check
   expect_compile(format-string-number-spec "
diff --git a/test/compile-fp-test.cc b/test/compile-fp-test.cc
index 5b46d74b..3afb7690 100644
--- a/test/compile-fp-test.cc
+++ b/test/compile-fp-test.cc
@@ -8,10 +8,7 @@
 #include "fmt/compile.h"
 #include "gmock/gmock.h"
 
-#if defined(__cpp_lib_bit_cast) && __cpp_lib_bit_cast >= 201806 && \
-    defined(__cpp_constexpr) && __cpp_constexpr >= 201907 &&       \
-    defined(__cpp_constexpr_dynamic_alloc) &&                      \
-    __cpp_constexpr_dynamic_alloc >= 201907 && FMT_CPLUSPLUS >= 202002L
+#if FMT_USE_CONSTEVAL
 
 template <size_t max_string_length, typename Char = char> struct test_string {
   template <typename T> constexpr bool operator==(const T& rhs) const noexcept {
@@ -60,4 +57,5 @@ TEST(compile_time_formatting_test, floating_point) {
   EXPECT_EQ("+inf", test_format<5>(FMT_COMPILE("{:+}"), inf));
   EXPECT_EQ("-inf", test_format<5>(FMT_COMPILE("{}"), -inf));
 }
-#endif
+
+#endif  // FMT_USE_CONSTEVAL
diff --git a/test/compile-test.cc b/test/compile-test.cc
index 8551303e..9e7d3c6d 100644
--- a/test/compile-test.cc
+++ b/test/compile-test.cc
@@ -10,17 +10,10 @@
 #include <type_traits>
 
 #include "fmt/chrono.h"
+#include "fmt/ranges.h"
 #include "gmock/gmock.h"
 #include "gtest-extra.h"
 
-TEST(iterator_test, counting_iterator) {
-  auto it = fmt::detail::counting_iterator();
-  auto prev = it++;
-  EXPECT_EQ(prev.count(), 0);
-  EXPECT_EQ(it.count(), 1);
-  EXPECT_EQ((it + 41).count(), 42);
-}
-
 TEST(compile_test, compile_fallback) {
   // FMT_COMPILE should fallback on runtime formatting when `if constexpr` is
   // not available.
@@ -34,7 +27,7 @@ struct type_with_get {
 FMT_BEGIN_NAMESPACE
 template <> struct formatter<type_with_get> : formatter<int> {
   template <typename FormatContext>
-  auto format(type_with_get, FormatContext& ctx) -> decltype(ctx.out()) {
+  auto format(type_with_get, FormatContext& ctx) const -> decltype(ctx.out()) {
     return formatter<int>::format(42, ctx);
   }
 };
@@ -84,6 +77,16 @@ TEST(compile_test, format_default) {
 #  endif
 }
 
+TEST(compile_test, format_escape) {
+  EXPECT_EQ("\"string\"", fmt::format(FMT_COMPILE("{:?}"), "string"));
+  EXPECT_EQ("prefix \"string\"",
+            fmt::format(FMT_COMPILE("prefix {:?}"), "string"));
+  EXPECT_EQ("\"string\" suffix",
+            fmt::format(FMT_COMPILE("{:?} suffix"), "string"));
+  EXPECT_EQ("\"abc\"", fmt::format(FMT_COMPILE("{0:<5?}"), "abc"));
+  EXPECT_EQ("\"abc\"  ", fmt::format(FMT_COMPILE("{0:<7?}"), "abc"));
+}
+
 TEST(compile_test, format_wide_string) {
   EXPECT_EQ(L"42", fmt::format(FMT_COMPILE(L"{}"), 42));
 }
@@ -195,7 +198,7 @@ TEST(compile_test, format_to_n) {
   EXPECT_STREQ("2a", buffer);
 }
 
-#  ifdef __cpp_lib_bit_cast
+#  if FMT_USE_CONSTEVAL && (!FMT_MSC_VERSION || FMT_MSC_VERSION >= 1940)
 TEST(compile_test, constexpr_formatted_size) {
   FMT_CONSTEXPR20 size_t size = fmt::formatted_size(FMT_COMPILE("{}"), 42);
   EXPECT_EQ(size, 2);
@@ -279,18 +282,15 @@ TEST(compile_test, compile_format_string_literal) {
 }
 #endif
 
-// MSVS 2019 19.29.30145.0 - Support C++20 and OK.
+// MSVS 2019 19.29.30145.0 - OK
 // MSVS 2022 19.32.31332.0, 19.37.32826.1 - compile-test.cc(362,3): fatal error
 // C1001: Internal compiler error.
 //  (compiler file
 //  'D:\a\_work\1\s\src\vctools\Compiler\CxxFE\sl\p1\c\constexpr\constexpr.cpp',
 //  line 8635)
-#if (FMT_CPLUSPLUS >= 202002L ||                                \
-     (FMT_CPLUSPLUS >= 201709L && FMT_GCC_VERSION >= 1002)) &&  \
-    ((!defined(_GLIBCXX_RELEASE) || _GLIBCXX_RELEASE >= 10) &&  \
-     (!defined(_LIBCPP_VERSION) || _LIBCPP_VERSION >= 10000) && \
-     (!FMT_MSC_VERSION ||                                       \
-      (FMT_MSC_VERSION >= 1928 && FMT_MSC_VERSION < 1930))) &&  \
+#if FMT_USE_CONSTEVAL &&                                     \
+    (!FMT_MSC_VERSION ||                                     \
+     (FMT_MSC_VERSION >= 1928 && FMT_MSC_VERSION < 1930)) && \
     defined(__cpp_lib_is_constant_evaluated)
 template <size_t max_string_length, typename Char = char> struct test_string {
   template <typename T> constexpr bool operator==(const T& rhs) const noexcept {
@@ -334,6 +334,7 @@ TEST(compile_time_formatting_test, integer) {
   EXPECT_EQ("0X4A", test_format<5>(FMT_COMPILE("{:#X}"), 0x4a));
 
   EXPECT_EQ("   42", test_format<6>(FMT_COMPILE("{:5}"), 42));
+  EXPECT_EQ("   42", test_format<6>(FMT_COMPILE("{:5}"), 42l));
   EXPECT_EQ("   42", test_format<6>(FMT_COMPILE("{:5}"), 42ll));
   EXPECT_EQ("   42", test_format<6>(FMT_COMPILE("{:5}"), 42ull));
 
diff --git a/test/cuda-test/cpp14.cc b/test/cuda-test/cpp14.cc
index ad846396..59db442e 100644
--- a/test/cuda-test/cpp14.cc
+++ b/test/cuda-test/cpp14.cc
@@ -1,4 +1,4 @@
-#include <fmt/core.h>
+#include <fmt/base.h>
 
 // The purpose of this part is to ensure NVCC's host compiler also supports
 // the standard version. See 'cuda-cpp14.cu'.
diff --git a/test/cuda-test/cuda-cpp14.cu b/test/cuda-test/cuda-cpp14.cu
index 76a9d088..9fc36c93 100644
--- a/test/cuda-test/cuda-cpp14.cu
+++ b/test/cuda-test/cuda-cpp14.cu
@@ -10,7 +10,7 @@
 // https://en.cppreference.com/w/cpp/preprocessor/replace#Predefined_macros
 static_assert(__cplusplus >= 201402L, "expect C++ 2014 for nvcc");
 
-#include <fmt/core.h>
+#include <fmt/base.h>
 
 #include <cuda.h>
 #include <iostream>
diff --git a/test/format-impl-test.cc b/test/format-impl-test.cc
index eda1f239..9645f832 100644
--- a/test/format-impl-test.cc
+++ b/test/format-impl-test.cc
@@ -344,7 +344,7 @@ TEST(format_impl_test, write_dragon_even) {
   if (!FMT_MSC_VERSION) EXPECT_EQ(s, "33554450");
 }
 
-#if defined(_WIN32) && !defined(FMT_WINDOWS_NO_WCHAR)
+#if defined(_WIN32) && !defined(FMT_USE_WRITE_CONSOLE)
 #  include <windows.h>
 
 TEST(format_impl_test, write_console_signature) {
diff --git a/test/format-test.cc b/test/format-test.cc
index 325bef99..1c907c87 100644
--- a/test/format-test.cc
+++ b/test/format-test.cc
@@ -15,18 +15,28 @@
 
 #include <stdint.h>  // uint32_t
 
-#include <climits>      // INT_MAX
-#include <cmath>        // std::signbit
-#include <cstring>      // std::strlen
-#include <iterator>     // std::back_inserter
-#include <list>         // std::list
-#include <memory>       // std::unique_ptr
-#include <type_traits>  // std::is_default_constructible
+#include <cfenv>               // fegetexceptflag and FE_ALL_EXCEPT
+#include <climits>             // INT_MAX
+#include <cmath>               // std::signbit
+#include <condition_variable>  // std::condition_variable
+#include <cstring>             // std::strlen
+#include <iterator>            // std::back_inserter
+#include <list>                // std::list
+#include <mutex>               // std::mutex
+#include <string>              // std::string
+#include <thread>              // std::thread
+#include <type_traits>         // std::is_default_constructible
+#if FMT_CPLUSPLUS > 201703L && FMT_HAS_INCLUDE(<version>)
+#  include <version>
+#endif
+
+#include <limits.h>
+
+#include <limits>
 
 #include "gtest-extra.h"
 #include "mock-allocator.h"
 #include "util.h"
-
 using fmt::basic_memory_buffer;
 using fmt::format_error;
 using fmt::memory_buffer;
@@ -38,6 +48,10 @@ using fmt::detail::uint128_fallback;
 using testing::Return;
 using testing::StrictMock;
 
+#ifdef __cpp_lib_concepts
+static_assert(std::output_iterator<fmt::appender, char>);
+#endif
+
 enum { buffer_size = 256 };
 
 TEST(uint128_test, ctor) {
@@ -106,6 +120,14 @@ TEST(float_test, isfinite) {
 #endif
 }
 
+void check_no_fp_exception() {
+  fexcept_t fe;
+  fegetexceptflag(&fe, FE_ALL_EXCEPT);
+
+  // No exception flags should have been set
+  EXPECT_TRUE(fe == 0);
+}
+
 template <typename Float> void check_isnan() {
   using fmt::detail::isnan;
   EXPECT_FALSE(isnan(Float(0.0)));
@@ -118,6 +140,17 @@ template <typename Float> void check_isnan() {
   EXPECT_FALSE(isnan(Float(-limits::infinity())));
   EXPECT_TRUE(isnan(Float(limits::quiet_NaN())));
   EXPECT_TRUE(isnan(Float(-limits::quiet_NaN())));
+
+  // Sanity check: make sure no error has occurred before we start
+  check_no_fp_exception();
+
+  // Check that no exception is raised for the non-NaN case
+  isnan(Float(42.0));
+  check_no_fp_exception();
+
+  // Check that no exception is raised for the NaN case
+  isnan(Float(limits::quiet_NaN()));
+  check_no_fp_exception();
 }
 
 TEST(float_test, isnan) {
@@ -240,7 +273,8 @@ TEST(util_test, format_system_error) {
     throws_on_alloc = true;
   }
   if (!throws_on_alloc) {
-    fmt::print("warning: std::allocator allocates {} chars\n", max_size);
+    fmt::print(stderr, "warning: std::allocator allocates {} chars\n",
+               max_size);
     return;
   }
 }
@@ -447,8 +481,14 @@ TEST(memory_buffer_test, max_size_allocator_overflow) {
   EXPECT_THROW(buffer.resize(161), std::exception);
 }
 
+TEST(format_test, digits2_alignment) {
+  auto p =
+      fmt::detail::bit_cast<fmt::detail::uintptr_t>(fmt::detail::digits2(0));
+  EXPECT_EQ(p % 2, 0);
+}
+
 TEST(format_test, exception_from_lib) {
-  EXPECT_THROW_MSG(fmt::throw_format_error("test"), format_error, "test");
+  EXPECT_THROW_MSG(fmt::report_error("test"), format_error, "test");
 }
 
 TEST(format_test, escape) {
@@ -556,6 +596,9 @@ TEST(format_test, named_arg) {
                    "argument not found");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{a}"), 42), format_error,
                    "argument not found");
+  EXPECT_THROW_MSG((void)fmt::format(runtime("{a} {}"), fmt::arg("a", 2), 42),
+                   format_error,
+                   "cannot switch from manual to automatic argument indexing");
 }
 
 TEST(format_test, auto_arg_index) {
@@ -767,7 +810,7 @@ TEST(format_test, hash_flag) {
   EXPECT_EQ(fmt::format("{:#.2g}", 0.5), "0.50");
   EXPECT_EQ(fmt::format("{:#.0f}", 0.5), "0.");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:#"), 'c'), format_error,
-                   "missing '}' in format string");
+                   "invalid format specifier for char");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:#}"), 'c'), format_error,
                    "invalid format specifier for char");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:#}"), "abc"), format_error,
@@ -788,7 +831,7 @@ TEST(format_test, zero_flag) {
   EXPECT_EQ(fmt::format("{0:07}", -42.0), "-000042");
   EXPECT_EQ(fmt::format("{0:07}", -42.0l), "-000042");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:0"), 'c'), format_error,
-                   "missing '}' in format string");
+                   "invalid format specifier for char");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:05}"), 'c'), format_error,
                    "invalid format specifier for char");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:05}"), "abc"), format_error,
@@ -835,6 +878,10 @@ TEST(format_test, width) {
   EXPECT_EQ(fmt::format("{:>06.0f}", 0.00884311), "     0");
 }
 
+auto bad_dynamic_spec_msg = FMT_BUILTIN_TYPES
+                                ? "width/precision is out of range"
+                                : "width/precision is not integer";
+
 TEST(format_test, runtime_width) {
   auto int_maxer = std::to_string(INT_MAX + 1u);
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{" + int_maxer), 0),
@@ -857,23 +904,23 @@ TEST(format_test, runtime_width) {
                    "invalid format string");
 
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{1}}"), 0, -1), format_error,
-                   "negative width");
+                   "width/precision is out of range");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{1}}"), 0, (INT_MAX + 1u)),
-                   format_error, "number is too big");
+                   format_error, bad_dynamic_spec_msg);
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{1}}"), 0, -1l), format_error,
-                   "negative width");
+                   bad_dynamic_spec_msg);
   if (fmt::detail::const_check(sizeof(long) > sizeof(int))) {
     long value = INT_MAX;
     EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{1}}"), 0, (value + 1)),
-                     format_error, "number is too big");
+                     format_error, bad_dynamic_spec_msg);
   }
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{1}}"), 0, (INT_MAX + 1ul)),
-                   format_error, "number is too big");
+                   format_error, bad_dynamic_spec_msg);
 
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{1}}"), 0, '0'), format_error,
-                   "width is not integer");
+                   "width/precision is not integer");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:{1}}"), 0, 0.0), format_error,
-                   "width is not integer");
+                   "width/precision is not integer");
 
   EXPECT_EQ(fmt::format("{0:{1}}", -42, 4), " -42");
   EXPECT_EQ(fmt::format("{0:{1}}", 42u, 5), "   42");
@@ -890,6 +937,10 @@ TEST(format_test, runtime_width) {
   EXPECT_EQ(fmt::format("{:{}}", 42, short(4)), "  42");
 }
 
+TEST(format_test, exponent_range) {
+  for (int e = -1074; e <= 1023; ++e) (void)fmt::format("{}", std::ldexp(1, e));
+}
+
 TEST(format_test, precision) {
   char format_str[buffer_size];
   safe_sprintf(format_str, "{0:.%u", UINT_MAX);
@@ -912,7 +963,7 @@ TEST(format_test, precision) {
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:."), 0.0), format_error,
                    "invalid precision");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.}"), 0.0), format_error,
-                   "invalid precision");
+                   "invalid format string");
 
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.2"), 0), format_error,
                    "invalid format specifier");
@@ -948,6 +999,9 @@ TEST(format_test, precision) {
   EXPECT_EQ(fmt::format("{0:.3}", 1.1), "1.1");
   EXPECT_EQ(fmt::format("{:.0e}", 1.0L), "1e+00");
   EXPECT_EQ(fmt::format("{:9.1e}", 0.0), "  0.0e+00");
+  EXPECT_EQ(fmt::format("{:.7f}", 0.0000000000000071054273576010018587L),
+            "0.0000000");
+
   EXPECT_EQ(
       fmt::format("{:.494}", 4.9406564584124654E-324),
       "4.9406564584124654417656879286822137236505980261432476442558568250067550"
@@ -1030,13 +1084,15 @@ TEST(format_test, precision) {
   EXPECT_THROW_MSG(
       (void)fmt::format("{:.2147483646f}", -2.2121295195081227E+304),
       format_error, "number is too big");
+  EXPECT_THROW_MSG((void)fmt::format(runtime("{:.f}"), 42.0), format_error,
+                   "invalid format string");
 
   EXPECT_EQ(fmt::format("{0:.2}", "str"), "st");
   EXPECT_EQ(fmt::format("{0:.5}", ""), "");
   EXPECT_EQ(fmt::format("{0:.6}", "123456\xad"), "123456");
 }
 
-TEST(xchar_test, utf8_precision) {
+TEST(format_test, utf8_precision) {
   auto result = fmt::format("{:.4}", "caf\u00e9s");  // cafs
   EXPECT_EQ(fmt::detail::compute_width(result), 4);
   EXPECT_EQ(result, "caf\u00e9");
@@ -1073,23 +1129,23 @@ TEST(format_test, runtime_precision) {
                    "invalid format string");
 
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 0.0, -1),
-                   format_error, "negative precision");
+                   format_error, "width/precision is out of range");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 0.0, (INT_MAX + 1u)),
-                   format_error, "number is too big");
+                   format_error, bad_dynamic_spec_msg);
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 0.0, -1l),
-                   format_error, "negative precision");
+                   format_error, bad_dynamic_spec_msg);
   if (fmt::detail::const_check(sizeof(long) > sizeof(int))) {
     long value = INT_MAX;
     EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 0.0, (value + 1)),
-                     format_error, "number is too big");
+                     format_error, bad_dynamic_spec_msg);
   }
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 0.0, (INT_MAX + 1ul)),
-                   format_error, "number is too big");
+                   format_error, bad_dynamic_spec_msg);
 
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 0.0, '0'),
-                   format_error, "precision is not integer");
+                   format_error, "width/precision is not integer");
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 0.0, 0.0),
-                   format_error, "precision is not integer");
+                   format_error, "width/precision is not integer");
 
   EXPECT_THROW_MSG((void)fmt::format(runtime("{0:.{1}}"), 42, 2), format_error,
                    "invalid format specifier");
@@ -1540,18 +1596,6 @@ TEST(format_test, format_pointer) {
             fmt::format("{0}", reinterpret_cast<void*>(~uintptr_t())));
   EXPECT_EQ("0x1234",
             fmt::format("{}", fmt::ptr(reinterpret_cast<int*>(0x1234))));
-  std::unique_ptr<int> up(new int(1));
-  EXPECT_EQ(fmt::format("{}", fmt::ptr(up.get())),
-            fmt::format("{}", fmt::ptr(up)));
-  struct custom_deleter {
-    void operator()(int* p) const { delete p; }
-  };
-  std::unique_ptr<int, custom_deleter> upcd(new int(1));
-  EXPECT_EQ(fmt::format("{}", fmt::ptr(upcd.get())),
-            fmt::format("{}", fmt::ptr(upcd)));
-  std::shared_ptr<int> sp(new int(1));
-  EXPECT_EQ(fmt::format("{}", fmt::ptr(sp.get())),
-            fmt::format("{}", fmt::ptr(sp)));
   EXPECT_EQ(fmt::format("{}", fmt::detail::bit_cast<const void*>(
                                   &function_pointer_test)),
             fmt::format("{}", fmt::ptr(function_pointer_test)));
@@ -1603,7 +1647,8 @@ struct string_viewable {};
 
 FMT_BEGIN_NAMESPACE
 template <> struct formatter<string_viewable> : formatter<std::string_view> {
-  auto format(string_viewable, format_context& ctx) -> decltype(ctx.out()) {
+  auto format(string_viewable, format_context& ctx) const
+      -> decltype(ctx.out()) {
     return formatter<std::string_view>::format("foo", ctx);
   }
 };
@@ -1621,8 +1666,8 @@ struct explicitly_convertible_to_std_string_view {
 template <>
 struct fmt::formatter<explicitly_convertible_to_std_string_view>
     : formatter<std::string_view> {
-  auto format(explicitly_convertible_to_std_string_view v, format_context& ctx)
-      -> decltype(ctx.out()) {
+  auto format(explicitly_convertible_to_std_string_view v,
+              format_context& ctx) const -> decltype(ctx.out()) {
     return fmt::format_to(ctx.out(), "'{}'", std::string_view(v));
   }
 };
@@ -1631,6 +1676,20 @@ TEST(format_test, format_explicitly_convertible_to_std_string_view) {
   EXPECT_EQ("'foo'",
             fmt::format("{}", explicitly_convertible_to_std_string_view()));
 }
+
+struct convertible_to_std_string_view {
+  operator std::string_view() const noexcept { return "Hi there"; }
+};
+FMT_BEGIN_NAMESPACE
+template <>
+class formatter<convertible_to_std_string_view>
+    : public formatter<std::string_view> {};
+FMT_END_NAMESPACE
+
+TEST(format_test, format_implicitly_convertible_and_inherits_string_view) {
+  static_assert(fmt::is_formattable<convertible_to_std_string_view>{}, "");
+  EXPECT_EQ("Hi there", fmt::format("{}", convertible_to_std_string_view{}));
+}
 #endif
 
 class Answer {};
@@ -1644,7 +1703,7 @@ template <> struct formatter<date> {
     return it;
   }
 
-  auto format(const date& d, format_context& ctx) -> decltype(ctx.out()) {
+  auto format(const date& d, format_context& ctx) const -> decltype(ctx.out()) {
     // Namespace-qualify to avoid ambiguity with std::format_to.
     fmt::format_to(ctx.out(), "{}-{}-{}", d.year(), d.month(), d.day());
     return ctx.out();
@@ -1653,7 +1712,7 @@ template <> struct formatter<date> {
 
 template <> struct formatter<Answer> : formatter<int> {
   template <typename FormatContext>
-  auto format(Answer, FormatContext& ctx) -> decltype(ctx.out()) {
+  auto format(Answer, FormatContext& ctx) const -> decltype(ctx.out()) {
     return formatter<int>::format(42, ctx);
   }
 };
@@ -1753,6 +1812,79 @@ TEST(format_test, print) {
                "Don't panic!\n");
 }
 
+TEST(format_test, big_print) {
+  enum { count = 5000 };
+  auto big_print = []() {
+    for (int i = 0; i < count / 5; ++i) fmt::print("xxxxx");
+  };
+  EXPECT_WRITE(stdout, big_print(), std::string(count, 'x'));
+}
+
+// Windows CRT implements _IOLBF incorrectly (full buffering).
+#if FMT_USE_FCNTL && !defined(_WIN32)
+TEST(format_test, line_buffering) {
+  auto pipe = fmt::pipe();
+
+  int write_fd = pipe.write_end.descriptor();
+  auto write_end = pipe.write_end.fdopen("w");
+  setvbuf(write_end.get(), nullptr, _IOLBF, 4096);
+  write_end.print("42\n");
+  close(write_fd);
+  try {
+    write_end.close();
+  } catch (const std::system_error&) {
+  }
+
+  auto read_end = pipe.read_end.fdopen("r");
+  std::thread reader([&]() {
+    int n = 0;
+    int result = fscanf(read_end.get(), "%d", &n);
+    (void)result;
+    EXPECT_EQ(n, 42);
+  });
+
+  reader.join();
+}
+#endif
+
+struct deadlockable {
+  int value = 0;
+  mutable std::mutex mutex;
+};
+
+FMT_BEGIN_NAMESPACE
+template <> struct formatter<deadlockable> {
+  FMT_CONSTEXPR auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
+    return ctx.begin();
+  }
+
+  auto format(const deadlockable& d, format_context& ctx) const
+      -> decltype(ctx.out()) {
+    std::lock_guard<std::mutex> lock(d.mutex);
+    return format_to(ctx.out(), "{}", d.value);
+  }
+};
+FMT_END_NAMESPACE
+
+TEST(format_test, locking_formatter) {
+  auto f = fmt::buffered_file();
+  try {
+    f = fmt::buffered_file("/dev/null", "w");
+  } catch (const std::system_error&) {
+    fmt::print(stderr, "warning: /dev/null is not supported\n");
+    return;
+  }
+  deadlockable d;
+  auto t = std::thread([&]() {
+    fmt::print(f.get(), "start t\n");
+    std::lock_guard<std::mutex> lock(d.mutex);
+    for (int i = 0; i < 1000000; ++i) d.value += 10;
+    fmt::print(f.get(), "done\n");
+  });
+  for (int i = 0; i < 100; ++i) fmt::print(f.get(), "{}", d);
+  t.join();
+}
+
 TEST(format_test, variadic) {
   EXPECT_EQ(fmt::format("{}c{}", "ab", 1), "abc1");
 }
@@ -1766,6 +1898,9 @@ TEST(format_test, bytes) {
 TEST(format_test, group_digits_view) {
   EXPECT_EQ(fmt::format("{}", fmt::group_digits(10000000)), "10,000,000");
   EXPECT_EQ(fmt::format("{:8}", fmt::group_digits(1000)), "   1,000");
+  EXPECT_EQ(fmt::format("{}", fmt::group_digits(-10000000)), "-10,000,000");
+  EXPECT_EQ(fmt::format("{:8}", fmt::group_digits(-1000)), "  -1,000");
+  EXPECT_EQ(fmt::format("{:8}", fmt::group_digits(-100)), "    -100");
 }
 
 #ifdef __cpp_generic_lambdas
@@ -1777,7 +1912,8 @@ FMT_BEGIN_NAMESPACE
 template <> struct formatter<point> : nested_formatter<double> {
   auto format(point p, format_context& ctx) const -> decltype(ctx.out()) {
     return write_padded(ctx, [this, p](auto out) -> decltype(out) {
-      return fmt::format_to(out, "({}, {})", nested(p.x), nested(p.y));
+      return fmt::format_to(out, "({}, {})", this->nested(p.x),
+                            this->nested(p.y));
     });
   }
 };
@@ -1791,40 +1927,6 @@ TEST(format_test, nested_formatter) {
 enum test_enum { foo, bar };
 auto format_as(test_enum e) -> int { return e; }
 
-TEST(format_test, join) {
-  using fmt::join;
-  int v1[3] = {1, 2, 3};
-  auto v2 = std::vector<float>();
-  v2.push_back(1.2f);
-  v2.push_back(3.4f);
-  void* v3[2] = {&v1[0], &v1[1]};
-
-  EXPECT_EQ(fmt::format("({})", join(v1, v1 + 3, ", ")), "(1, 2, 3)");
-  EXPECT_EQ(fmt::format("({})", join(v1, v1 + 1, ", ")), "(1)");
-  EXPECT_EQ(fmt::format("({})", join(v1, v1, ", ")), "()");
-  EXPECT_EQ(fmt::format("({:03})", join(v1, v1 + 3, ", ")), "(001, 002, 003)");
-  EXPECT_EQ("(+01.20, +03.40)",
-            fmt::format("({:+06.2f})", join(v2.begin(), v2.end(), ", ")));
-
-  EXPECT_EQ(fmt::format("{0:{1}}", join(v1, v1 + 3, ", "), 1), "1, 2, 3");
-
-  EXPECT_EQ(fmt::format("{}, {}", v3[0], v3[1]),
-            fmt::format("{}", join(v3, v3 + 2, ", ")));
-
-  EXPECT_EQ(fmt::format("({})", join(v1, ", ")), "(1, 2, 3)");
-  EXPECT_EQ(fmt::format("({:+06.2f})", join(v2, ", ")), "(+01.20, +03.40)");
-
-  auto v4 = std::vector<test_enum>{foo, bar, foo};
-  EXPECT_EQ(fmt::format("{}", join(v4, " ")), "0 1 0");
-}
-
-#ifdef __cpp_lib_byte
-TEST(format_test, join_bytes) {
-  auto v = std::vector<std::byte>{std::byte(1), std::byte(2), std::byte(3)};
-  EXPECT_EQ(fmt::format("{}", fmt::join(v, ", ")), "1, 2, 3");
-}
-#endif
-
 std::string vformat_message(int id, const char* format, fmt::format_args args) {
   auto buffer = fmt::memory_buffer();
   fmt::format_to(fmt::appender(buffer), "[{}] ", id);
@@ -1903,7 +2005,6 @@ TEST(format_test, custom_format_compile_time_string) {
   EXPECT_EQ(fmt::format(FMT_STRING("{}"), const_answer), "42");
 }
 
-#if FMT_USE_USER_DEFINED_LITERALS
 TEST(format_test, named_arg_udl) {
   using namespace fmt::literals;
   auto udl_a = fmt::format("{first}{second}{first}{third}", "first"_a = "abra",
@@ -1915,13 +2016,12 @@ TEST(format_test, named_arg_udl) {
 
   EXPECT_EQ(fmt::format("{answer}", "answer"_a = Answer()), "42");
 }
-#endif  // FMT_USE_USER_DEFINED_LITERALS
 
 TEST(format_test, enum) { EXPECT_EQ(fmt::format("{}", foo), "0"); }
 
 TEST(format_test, formatter_not_specialized) {
-  static_assert(!fmt::has_formatter<fmt::formatter<test_enum>,
-                                    fmt::format_context>::value,
+  static_assert(!fmt::is_formattable<fmt::formatter<test_enum>,
+                                     fmt::format_context>::value,
                 "");
 }
 
@@ -1930,6 +2030,8 @@ enum big_enum : unsigned long long { big_enum_value = 5000000000ULL };
 auto format_as(big_enum e) -> unsigned long long { return e; }
 
 TEST(format_test, strong_enum) {
+  auto arg = fmt::basic_format_arg<fmt::context>(big_enum_value);
+  EXPECT_EQ(arg.type(), fmt::detail::type::ulong_long_type);
   EXPECT_EQ(fmt::format("{}", big_enum_value), "5000000000");
 }
 #endif
@@ -1950,7 +2052,7 @@ template <typename, typename OutputIt> void write(OutputIt, foo) = delete;
 FMT_BEGIN_NAMESPACE
 template <>
 struct formatter<adl_test::fmt::detail::foo> : formatter<std::string> {
-  auto format(adl_test::fmt::detail::foo, format_context& ctx)
+  auto format(adl_test::fmt::detail::foo, format_context& ctx) const
       -> decltype(ctx.out()) {
     return formatter<std::string>::format("foo", ctx);
   }
@@ -1981,6 +2083,13 @@ TEST(format_test, output_iterators) {
   EXPECT_EQ("42", s.str());
 }
 
+TEST(format_test, fill_via_appender) {
+  fmt::memory_buffer buf;
+  auto it = fmt::appender(buf);
+  std::fill_n(it, 3, '~');
+  EXPECT_EQ(fmt::to_string(buf), "~~~");
+}
+
 TEST(format_test, formatted_size) {
   EXPECT_EQ(2u, fmt::formatted_size("{}", 42));
   EXPECT_EQ(2u, fmt::formatted_size(std::locale(), "{}", 42));
@@ -2094,7 +2203,7 @@ TEST(format_test, vformat_to) {
   fmt::vformat_to(std::back_inserter(s), "{}", args);
   EXPECT_EQ(s, "42");
   s.clear();
-  fmt::vformat_to(std::back_inserter(s), FMT_STRING("{}"), args);
+  fmt::vformat_to(std::back_inserter(s), "{}", args);
   EXPECT_EQ(s, "42");
 }
 
@@ -2119,7 +2228,7 @@ template <> struct formatter<check_back_appender> {
   }
 
   template <typename Context>
-  auto format(check_back_appender, Context& ctx) -> decltype(ctx.out()) {
+  auto format(check_back_appender, Context& ctx) const -> decltype(ctx.out()) {
     auto out = ctx.out();
     static_assert(std::is_same<decltype(++out), decltype(out)&>::value,
                   "needs to satisfy weakly_incrementable");
@@ -2181,16 +2290,21 @@ template <typename Char, typename... T> void check_enabled_formatters() {
 }
 
 TEST(format_test, test_formatters_enabled) {
+  using custom_string =
+      std::basic_string<char, std::char_traits<char>, mock_allocator<char>>;
+  using custom_wstring = std::basic_string<wchar_t, std::char_traits<wchar_t>,
+                                           mock_allocator<wchar_t>>;
+
   check_enabled_formatters<char, bool, char, signed char, unsigned char, short,
                            unsigned short, int, unsigned, long, unsigned long,
                            long long, unsigned long long, float, double,
                            long double, void*, const void*, char*, const char*,
-                           std::string, std::nullptr_t>();
-  check_enabled_formatters<wchar_t, bool, wchar_t, signed char, unsigned char,
-                           short, unsigned short, int, unsigned, long,
-                           unsigned long, long long, unsigned long long, float,
-                           double, long double, void*, const void*, wchar_t*,
-                           const wchar_t*, std::wstring, std::nullptr_t>();
+                           std::string, custom_string, std::nullptr_t>();
+  check_enabled_formatters<
+      wchar_t, bool, wchar_t, signed char, unsigned char, short, unsigned short,
+      int, unsigned, long, unsigned long, long long, unsigned long long, float,
+      double, long double, void*, const void*, wchar_t*, const wchar_t*,
+      std::wstring, custom_wstring, std::nullptr_t>();
 }
 
 TEST(format_int_test, data) {
@@ -2206,7 +2320,7 @@ TEST(format_int_test, format_int) {
   EXPECT_EQ(fmt::format_int(42ul).str(), "42");
   EXPECT_EQ(fmt::format_int(-42l).str(), "-42");
   EXPECT_EQ(fmt::format_int(42ull).str(), "42");
-  EXPECT_EQ(fmt::format_int(-42ll).str(), "-42");\
+  EXPECT_EQ(fmt::format_int(-42ll).str(), "-42");
   EXPECT_EQ(fmt::format_int(max_value<int64_t>()).str(),
             std::to_string(max_value<int64_t>()));
 }
@@ -2233,11 +2347,11 @@ class format_facet : public fmt::format_facet<std::locale> {
   };
 
   auto do_put(fmt::appender out, fmt::loc_value val,
-              const fmt::format_specs<>&) const -> bool override;
+              const fmt::format_specs&) const -> bool override;
 };
 
 auto format_facet::do_put(fmt::appender out, fmt::loc_value val,
-                          const fmt::format_specs<>&) const -> bool {
+                          const fmt::format_specs&) const -> bool {
   return val.visit(int_formatter{out});
 }
 
@@ -2293,3 +2407,154 @@ FMT_END_NAMESPACE
 TEST(format_test, formatter_nonconst_char) {
   EXPECT_EQ(fmt::format("{}", convertible_to_nonconst_cstring()), "bar");
 }
+
+namespace adl_test {
+template <typename... T> void make_format_args(const T&...) = delete;
+
+struct string : std::string {};
+auto format_as(const string& s) -> std::string { return s; }
+}  // namespace adl_test
+
+// Test that formatting functions compile when make_format_args is found by ADL.
+TEST(format_test, adl) {
+  // Only check compilation and don't run the code to avoid polluting the output
+  // and since the output is tested elsewhere.
+  if (fmt::detail::const_check(true)) return;
+  auto s = adl_test::string();
+  char buf[10];
+  (void)fmt::format("{}", s);
+  fmt::format_to(buf, "{}", s);
+  fmt::format_to_n(buf, 10, "{}", s);
+  (void)fmt::formatted_size("{}", s);
+  fmt::print("{}", s);
+  fmt::print(stdout, "{}", s);
+}
+
+struct convertible_to_int {
+  operator int() const { return 42; }
+};
+
+struct convertible_to_cstring {
+  operator const char*() const { return "foo"; }
+};
+
+FMT_BEGIN_NAMESPACE
+template <> struct formatter<convertible_to_int> {
+  FMT_CONSTEXPR auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
+    return ctx.begin();
+  }
+  auto format(convertible_to_int, format_context& ctx) const
+      -> decltype(ctx.out()) {
+    auto out = ctx.out();
+    *out++ = 'x';
+    return out;
+  }
+};
+
+template <> struct formatter<convertible_to_cstring> {
+  FMT_CONSTEXPR auto parse(format_parse_context& ctx) -> decltype(ctx.begin()) {
+    return ctx.begin();
+  }
+  auto format(convertible_to_cstring, format_context& ctx) const
+      -> decltype(ctx.out()) {
+    auto out = ctx.out();
+    *out++ = 'y';
+    return out;
+  }
+};
+FMT_END_NAMESPACE
+
+TEST(format_test, formatter_overrides_implicit_conversion) {
+  EXPECT_EQ(fmt::format("{}", convertible_to_int()), "x");
+  EXPECT_EQ(fmt::format("{}", convertible_to_cstring()), "y");
+}
+
+struct ustring {
+  using value_type = unsigned;
+
+  auto find_first_of(value_type, size_t) const -> size_t;
+
+  auto data() const -> const char*;
+  auto size() const -> size_t;
+};
+
+FMT_BEGIN_NAMESPACE
+template <> struct formatter<ustring> : formatter<std::string> {
+  auto format(const ustring&, format_context& ctx) const
+      -> decltype(ctx.out()) {
+    return formatter<std::string>::format("ustring", ctx);
+  }
+};
+FMT_END_NAMESPACE
+
+TEST(format_test, ustring) {
+  EXPECT_EQ(fmt::format("{}", ustring()), "ustring");
+}
+
+TEST(format_test, writer) {
+  auto write_to_stdout = []() {
+    auto w = fmt::writer(stdout);
+    w.print("{}", 42);
+  };
+  EXPECT_WRITE(stdout, write_to_stdout(), "42");
+
+#if FMT_USE_FCNTL
+  auto pipe = fmt::pipe();
+  auto write_end = pipe.write_end.fdopen("w");
+  fmt::writer(write_end.get()).print("42");
+  write_end.close();
+  auto read_end = pipe.read_end.fdopen("r");
+  int n = 0;
+  int result = fscanf(read_end.get(), "%d", &n);
+  (void)result;
+  EXPECT_EQ(n, 42);
+#endif
+
+  auto s = fmt::string_buffer();
+  fmt::writer(s).print("foo");
+  EXPECT_EQ(s.str(), "foo");
+}
+
+#if FMT_USE_BITINT
+FMT_PRAGMA_CLANG(diagnostic ignored "-Wbit-int-extension")
+
+TEST(format_test, bitint) {
+  using fmt::detail::bitint;
+  using fmt::detail::ubitint;
+
+  EXPECT_EQ(fmt::format("{}", ubitint<3>(7)), "7");
+  EXPECT_EQ(fmt::format("{}", bitint<7>()), "0");
+
+  EXPECT_EQ(fmt::format("{}", ubitint<15>(31000)), "31000");
+  EXPECT_EQ(fmt::format("{}", bitint<16>(INT16_MIN)), "-32768");
+  EXPECT_EQ(fmt::format("{}", bitint<16>(INT16_MAX)), "32767");
+
+  EXPECT_EQ(fmt::format("{}", ubitint<32>(4294967295)), "4294967295");
+
+  EXPECT_EQ(fmt::format("{}", ubitint<47>(140737488355327ULL)),
+            "140737488355327");
+  EXPECT_EQ(fmt::format("{}", bitint<47>(-40737488355327LL)),
+            "-40737488355327");
+
+  // Check lvalues and const
+  auto a = bitint<8>(0);
+  auto b = ubitint<32>(4294967295);
+  const auto c = bitint<7>(0);
+  const auto d = ubitint<32>(4294967295);
+  EXPECT_EQ(fmt::format("{}", a), "0");
+  EXPECT_EQ(fmt::format("{}", b), "4294967295");
+  EXPECT_EQ(fmt::format("{}", c), "0");
+  EXPECT_EQ(fmt::format("{}", d), "4294967295");
+
+  static_assert(fmt::is_formattable<bitint<64>, char>{}, "");
+  static_assert(fmt::is_formattable<ubitint<64>, char>{}, "");
+}
+#endif
+
+#ifdef __cpp_lib_byte
+TEST(base_test, format_byte) {
+  auto s = std::string();
+  fmt::format_to(std::back_inserter(s), "{}", std::byte(42));
+  EXPECT_EQ(s, "42");
+}
+#endif
diff --git a/test/fuzzing/fuzzer-common.h b/test/fuzzing/fuzzer-common.h
index c0a24672..eaae5a6e 100644
--- a/test/fuzzing/fuzzer-common.h
+++ b/test/fuzzing/fuzzer-common.h
@@ -4,7 +4,7 @@
 #ifndef FUZZER_COMMON_H
 #define FUZZER_COMMON_H
 
-#include <fmt/core.h>
+#include <fmt/base.h>
 
 #include <cstdint>  // std::uint8_t
 #include <cstring>  // memcpy
diff --git a/test/gtest-extra-test.cc b/test/gtest-extra-test.cc
index 34054b68..5c860400 100644
--- a/test/gtest-extra-test.cc
+++ b/test/gtest-extra-test.cc
@@ -316,10 +316,9 @@ using fmt::buffered_file;
 using fmt::file;
 
 TEST(output_redirect_test, scoped_redirect) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
   {
-    buffered_file file(write_end.fdopen("w"));
+    buffered_file file(pipe.write_end.fdopen("w"));
     std::fprintf(file.get(), "[[[");
     {
       output_redirect redir(file.get());
@@ -327,16 +326,15 @@ TEST(output_redirect_test, scoped_redirect) {
     }
     std::fprintf(file.get(), "]]]");
   }
-  EXPECT_READ(read_end, "[[[]]]");
+  EXPECT_READ(pipe.read_end, "[[[]]]");
 }
 
 // Test that output_redirect handles errors in flush correctly.
 TEST(output_redirect_test, flush_error_in_ctor) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  int write_fd = write_end.descriptor();
-  file write_copy = write_end.dup(write_fd);
-  buffered_file f = write_end.fdopen("w");
+  auto pipe = fmt::pipe();
+  int write_fd = pipe.write_end.descriptor();
+  file write_copy = pipe.write_end.dup(write_fd);
+  buffered_file f = pipe.write_end.fdopen("w");
   // Put a character in a file buffer.
   EXPECT_EQ('x', fputc('x', f.get()));
   FMT_POSIX(close(write_fd));
@@ -360,9 +358,8 @@ TEST(output_redirect_test, dup_error_in_ctor) {
 }
 
 TEST(output_redirect_test, restore_and_read) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  buffered_file file(write_end.fdopen("w"));
+  auto pipe = fmt::pipe();
+  buffered_file file(pipe.write_end.fdopen("w"));
   std::fprintf(file.get(), "[[[");
   output_redirect redir(file.get());
   std::fprintf(file.get(), "censored");
@@ -370,16 +367,15 @@ TEST(output_redirect_test, restore_and_read) {
   EXPECT_EQ("", redir.restore_and_read());
   std::fprintf(file.get(), "]]]");
   file = buffered_file();
-  EXPECT_READ(read_end, "[[[]]]");
+  EXPECT_READ(pipe.read_end, "[[[]]]");
 }
 
 // Test that OutputRedirect handles errors in flush correctly.
 TEST(output_redirect_test, flush_error_in_restore_and_read) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  int write_fd = write_end.descriptor();
-  file write_copy = write_end.dup(write_fd);
-  buffered_file f = write_end.fdopen("w");
+  auto pipe = fmt::pipe();
+  int write_fd = pipe.write_end.descriptor();
+  file write_copy = pipe.write_end.dup(write_fd);
+  buffered_file f = pipe.write_end.fdopen("w");
   output_redirect redir(f.get());
   // Put a character in a file buffer.
   EXPECT_EQ('x', fputc('x', f.get()));
@@ -390,11 +386,10 @@ TEST(output_redirect_test, flush_error_in_restore_and_read) {
 }
 
 TEST(output_redirect_test, error_in_dtor) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  int write_fd = write_end.descriptor();
-  file write_copy = write_end.dup(write_fd);
-  buffered_file f = write_end.fdopen("w");
+  auto pipe = fmt::pipe();
+  int write_fd = pipe.write_end.descriptor();
+  file write_copy = pipe.write_end.dup(write_fd);
+  buffered_file f = pipe.write_end.fdopen("w");
   std::unique_ptr<output_redirect> redir(new output_redirect(f.get()));
   // Put a character in a file buffer.
   EXPECT_EQ('x', fputc('x', f.get()));
diff --git a/test/gtest-extra.cc b/test/gtest-extra.cc
index 3d27cf96..0f9fff5e 100644
--- a/test/gtest-extra.cc
+++ b/test/gtest-extra.cc
@@ -17,10 +17,10 @@ output_redirect::output_redirect(FILE* f, bool flush) : file_(f) {
   // Create a file object referring to the original file.
   original_ = file::dup(fd);
   // Create a pipe.
-  file write_end;
-  file::pipe(read_end_, write_end);
+  auto pipe = fmt::pipe();
+  read_end_ = std::move(pipe.read_end);
   // Connect the passed FILE object to the write end of the pipe.
-  write_end.dup2(fd);
+  pipe.write_end.dup2(fd);
 }
 
 output_redirect::~output_redirect() noexcept {
diff --git a/test/gtest/gmock-gtest-all.cc b/test/gtest/gmock-gtest-all.cc
index 9d3b9bc1..6642abef 100644
--- a/test/gtest/gmock-gtest-all.cc
+++ b/test/gtest/gmock-gtest-all.cc
@@ -13360,6 +13360,7 @@ bool UnorderedElementsAreMatcherImplBase::FindPairing(
 #include <memory>
 #include <set>
 #include <string>
+#include <unordered_map>
 #include <vector>
 
 
@@ -13983,46 +13984,50 @@ MockObjectRegistry g_mock_object_registry;
 
 // Maps a mock object to the reaction Google Mock should have when an
 // uninteresting method is called.  Protected by g_gmock_mutex.
-std::map<const void*, internal::CallReaction> g_uninteresting_call_reaction;
+std::unordered_map<uintptr_t, internal::CallReaction>&
+UninterestingCallReactionMap() {
+  static auto* map = new std::unordered_map<uintptr_t, internal::CallReaction>;
+  return *map;
+}
 
 // Sets the reaction Google Mock should have when an uninteresting
 // method of the given mock object is called.
-void SetReactionOnUninterestingCalls(const void* mock_obj,
+void SetReactionOnUninterestingCalls(uintptr_t mock_obj,
                                      internal::CallReaction reaction)
     GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex) {
   internal::MutexLock l(&internal::g_gmock_mutex);
-  g_uninteresting_call_reaction[mock_obj] = reaction;
+  UninterestingCallReactionMap()[mock_obj] = reaction;
 }
 
 }  // namespace
 
 // Tells Google Mock to allow uninteresting calls on the given mock
 // object.
-void Mock::AllowUninterestingCalls(const void* mock_obj)
+void Mock::AllowUninterestingCalls(uintptr_t mock_obj)
     GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex) {
   SetReactionOnUninterestingCalls(mock_obj, internal::kAllow);
 }
 
 // Tells Google Mock to warn the user about uninteresting calls on the
 // given mock object.
-void Mock::WarnUninterestingCalls(const void* mock_obj)
+void Mock::WarnUninterestingCalls(uintptr_t mock_obj)
     GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex) {
   SetReactionOnUninterestingCalls(mock_obj, internal::kWarn);
 }
 
 // Tells Google Mock to fail uninteresting calls on the given mock
 // object.
-void Mock::FailUninterestingCalls(const void* mock_obj)
+void Mock::FailUninterestingCalls(uintptr_t mock_obj)
     GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex) {
   SetReactionOnUninterestingCalls(mock_obj, internal::kFail);
 }
 
 // Tells Google Mock the given mock object is being destroyed and its
 // entry in the call-reaction table should be removed.
-void Mock::UnregisterCallReaction(const void* mock_obj)
+void Mock::UnregisterCallReaction(uintptr_t mock_obj)
     GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex) {
   internal::MutexLock l(&internal::g_gmock_mutex);
-  g_uninteresting_call_reaction.erase(mock_obj);
+  UninterestingCallReactionMap().erase(static_cast<uintptr_t>(mock_obj));
 }
 
 // Returns the reaction Google Mock will have on uninteresting calls
@@ -14031,9 +14036,12 @@ internal::CallReaction Mock::GetReactionOnUninterestingCalls(
     const void* mock_obj)
         GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex) {
   internal::MutexLock l(&internal::g_gmock_mutex);
-  return (g_uninteresting_call_reaction.count(mock_obj) == 0) ?
-      internal::intToCallReaction(GMOCK_FLAG(default_mock_behavior)) :
-      g_uninteresting_call_reaction[mock_obj];
+  return (UninterestingCallReactionMap().count(
+              reinterpret_cast<uintptr_t>(mock_obj)) == 0)
+             ? internal::intToCallReaction(
+                   GMOCK_FLAG(default_mock_behavior))
+             : UninterestingCallReactionMap()[reinterpret_cast<uintptr_t>(
+                   mock_obj)];
 }
 
 // Tells Google Mock to ignore mock_obj when checking for leaked mock
diff --git a/test/gtest/gmock/gmock.h b/test/gtest/gmock/gmock.h
index d121f7df..c6eef531 100644
--- a/test/gtest/gmock/gmock.h
+++ b/test/gtest/gmock/gmock.h
@@ -2860,6 +2860,7 @@ GTEST_DISABLE_MSC_WARNINGS_POP_()  //  4251
 #ifndef GOOGLEMOCK_INCLUDE_GMOCK_GMOCK_SPEC_BUILDERS_H_
 #define GOOGLEMOCK_INCLUDE_GMOCK_GMOCK_SPEC_BUILDERS_H_
 
+#include <cstdint>
 #include <functional>
 #include <map>
 #include <memory>
@@ -8646,22 +8647,22 @@ class GTEST_API_ Mock {
 
   // Tells Google Mock to allow uninteresting calls on the given mock
   // object.
-  static void AllowUninterestingCalls(const void* mock_obj)
+  static void AllowUninterestingCalls(uintptr_t mock_obj)
       GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex);
 
   // Tells Google Mock to warn the user about uninteresting calls on
   // the given mock object.
-  static void WarnUninterestingCalls(const void* mock_obj)
+  static void WarnUninterestingCalls(uintptr_t mock_obj)
       GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex);
 
   // Tells Google Mock to fail uninteresting calls on the given mock
   // object.
-  static void FailUninterestingCalls(const void* mock_obj)
+  static void FailUninterestingCalls(uintptr_t mock_obj)
       GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex);
 
   // Tells Google Mock the given mock object is being destroyed and
   // its entry in the call-reaction table should be removed.
-  static void UnregisterCallReaction(const void* mock_obj)
+  static void UnregisterCallReaction(uintptr_t mock_obj)
       GTEST_LOCK_EXCLUDED_(internal::g_gmock_mutex);
 
   // Returns the reaction Google Mock will have on uninteresting calls
@@ -11417,6 +11418,7 @@ MATCHER(IsFalse, negation ? "is true" : "is false") {
 #ifndef GOOGLEMOCK_INCLUDE_GMOCK_GMOCK_NICE_STRICT_H_
 #define GOOGLEMOCK_INCLUDE_GMOCK_GMOCK_NICE_STRICT_H_
 
+#include <cstdint>
 #include <type_traits>
 
 
@@ -11461,25 +11463,37 @@ constexpr bool HasStrictnessModifier() {
 template <typename Base>
 class NiceMockImpl {
  public:
-  NiceMockImpl() { ::testing::Mock::AllowUninterestingCalls(this); }
+  NiceMockImpl() {
+    ::testing::Mock::AllowUninterestingCalls(reinterpret_cast<uintptr_t>(this));
+  }
 
-  ~NiceMockImpl() { ::testing::Mock::UnregisterCallReaction(this); }
+  ~NiceMockImpl() {
+    ::testing::Mock::UnregisterCallReaction(reinterpret_cast<uintptr_t>(this));
+  }
 };
 
 template <typename Base>
 class NaggyMockImpl {
  public:
-  NaggyMockImpl() { ::testing::Mock::WarnUninterestingCalls(this); }
+  NaggyMockImpl() {
+    ::testing::Mock::WarnUninterestingCalls(reinterpret_cast<uintptr_t>(this));
+  }
 
-  ~NaggyMockImpl() { ::testing::Mock::UnregisterCallReaction(this); }
+  ~NaggyMockImpl() {
+    ::testing::Mock::UnregisterCallReaction(reinterpret_cast<uintptr_t>(this));
+  }
 };
 
 template <typename Base>
 class StrictMockImpl {
  public:
-  StrictMockImpl() { ::testing::Mock::FailUninterestingCalls(this); }
+  StrictMockImpl() {
+    ::testing::Mock::FailUninterestingCalls(reinterpret_cast<uintptr_t>(this));
+  }
 
-  ~StrictMockImpl() { ::testing::Mock::UnregisterCallReaction(this); }
+  ~StrictMockImpl() {
+    ::testing::Mock::UnregisterCallReaction(reinterpret_cast<uintptr_t>(this));
+  }
 };
 
 }  // namespace internal
diff --git a/test/gtest/gtest/gtest.h b/test/gtest/gtest/gtest.h
index 55a31d0a..cb994607 100644
--- a/test/gtest/gtest/gtest.h
+++ b/test/gtest/gtest/gtest.h
@@ -6390,17 +6390,18 @@ class MatcherBase : private MatcherDescriberInterface {
   }
 
  protected:
-  MatcherBase() : vtable_(nullptr) {}
+  MatcherBase() : vtable_(nullptr), buffer_() {}
 
   // Constructs a matcher from its implementation.
   template <typename U>
-  explicit MatcherBase(const MatcherInterface<U>* impl) {
+  explicit MatcherBase(const MatcherInterface<U>* impl)
+      : vtable_(nullptr), buffer_() {
     Init(impl);
   }
 
   template <typename M, typename = typename std::remove_reference<
                             M>::type::is_gtest_matcher>
-  MatcherBase(M&& m) {  // NOLINT
+  MatcherBase(M&& m) : vtable_(nullptr), buffer_() {  // NOLINT
     Init(std::forward<M>(m));
   }
 
diff --git a/test/header-only-test.cc b/test/header-only-test.cc
index 570f09a5..8c99f857 100644
--- a/test/header-only-test.cc
+++ b/test/header-only-test.cc
@@ -1,6 +1,6 @@
 // Header-only configuration test
 
-#include "fmt/core.h"
+#include "fmt/base.h"
 #include "fmt/ostream.h"
 #include "gtest/gtest.h"
 
diff --git a/test/mock-allocator.h b/test/mock-allocator.h
index dc4942f1..32c4caae 100644
--- a/test/mock-allocator.h
+++ b/test/mock-allocator.h
@@ -17,9 +17,22 @@
 
 template <typename T> class mock_allocator {
  public:
+  using value_type = T;
+  using size_type = size_t;
+
+  using pointer = T*;
+  using const_pointer = const T*;
+  using reference = T&;
+  using const_reference = const T&;
+  using difference_type = ptrdiff_t;
+
+  template <typename U> struct rebind {
+    using other = mock_allocator<U>;
+  };
+
   mock_allocator() {}
   mock_allocator(const mock_allocator&) {}
-  using value_type = T;
+
   MOCK_METHOD(T*, allocate, (size_t));
   MOCK_METHOD(void, deallocate, (T*, size_t));
 };
diff --git a/test/no-builtin-types-test.cc b/test/no-builtin-types-test.cc
new file mode 100644
index 00000000..fd15d002
--- /dev/null
+++ b/test/no-builtin-types-test.cc
@@ -0,0 +1,24 @@
+// Formatting library for C++ - formatting library tests
+//
+// Copyright (c) 2012 - present, Victor Zverovich
+// All rights reserved.
+//
+// For the license information refer to format.h.
+
+#include "gtest/gtest.h"
+
+#if !defined(__GNUC__) || __GNUC__ >= 5
+#define FMT_BUILTIN_TYPES 0
+#include "fmt/format.h"
+
+TEST(no_builtin_types_test, format) {
+  EXPECT_EQ(fmt::format("{}", 42), "42");
+}
+
+TEST(no_builtin_types_test, double_is_custom_type) {
+  double d = 42;
+  auto args = fmt::make_format_args(d);
+  EXPECT_EQ(fmt::format_args(args).get(0).type(),
+            fmt::detail::type::custom_type);
+}
+#endif
diff --git a/test/noexception-test.cc b/test/noexception-test.cc
index bf3472fd..0e44e13b 100644
--- a/test/noexception-test.cc
+++ b/test/noexception-test.cc
@@ -6,10 +6,10 @@
 // For the license information refer to format.h.
 
 #include "fmt/args.h"
+#include "fmt/base.h"
 #include "fmt/chrono.h"
 #include "fmt/color.h"
 #include "fmt/compile.h"
-#include "fmt/core.h"
 #include "fmt/format.h"
 #include "fmt/os.h"
 #include "fmt/ostream.h"
diff --git a/test/os-test.cc b/test/os-test.cc
index 1e6c7c4b..8f73935c 100644
--- a/test/os-test.cc
+++ b/test/os-test.cc
@@ -18,6 +18,10 @@ using fmt::buffered_file;
 using testing::HasSubstr;
 using wstring_view = fmt::basic_string_view<wchar_t>;
 
+static std::string uniq_file_name(unsigned line_number) {
+  return "test-file" + std::to_string(line_number);
+}
+
 #ifdef _WIN32
 
 #  include <windows.h>
@@ -104,7 +108,7 @@ TEST(file_test, open_windows_file) {
 
 using fmt::file;
 
-bool isclosed(int fd) {
+auto isclosed(int fd) -> bool {
   char buffer;
   auto result = std::streamsize();
   SUPPRESS_ASSERT(result = FMT_POSIX(read(fd, &buffer, 1)));
@@ -112,12 +116,11 @@ bool isclosed(int fd) {
 }
 
 // Opens a file for reading.
-file open_file() {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  write_end.write(file_content, std::strlen(file_content));
-  write_end.close();
-  return read_end;
+auto open_file() -> file {
+  auto pipe = fmt::pipe();
+  pipe.write_end.write(file_content, std::strlen(file_content));
+  pipe.write_end.close();
+  return std::move(pipe.read_end);
 }
 
 // Attempts to write a string to a file.
@@ -233,69 +236,75 @@ TEST(buffered_file_test, descriptor) {
 }
 
 TEST(ostream_test, move) {
-  fmt::ostream out = fmt::output_file("test-file");
+  auto test_file = uniq_file_name(__LINE__);
+  fmt::ostream out = fmt::output_file(test_file);
   fmt::ostream moved(std::move(out));
   moved.print("hello");
 }
 
 TEST(ostream_test, move_while_holding_data) {
+  auto test_file = uniq_file_name(__LINE__);
   {
-    fmt::ostream out = fmt::output_file("test-file");
+    fmt::ostream out = fmt::output_file(test_file);
     out.print("Hello, ");
     fmt::ostream moved(std::move(out));
     moved.print("world!\n");
   }
   {
-    file in("test-file", file::RDONLY);
+    file in(test_file, file::RDONLY);
     EXPECT_READ(in, "Hello, world!\n");
   }
 }
 
 TEST(ostream_test, print) {
-  fmt::ostream out = fmt::output_file("test-file");
-  out.print("The answer is {}.\n",
-            fmt::join(std::initializer_list<int>{42}, ", "));
+  auto test_file = uniq_file_name(__LINE__);
+  fmt::ostream out = fmt::output_file(test_file);
+  out.print("The answer is {}.\n", 42);
   out.close();
-  file in("test-file", file::RDONLY);
+  file in(test_file, file::RDONLY);
   EXPECT_READ(in, "The answer is 42.\n");
 }
 
 TEST(ostream_test, buffer_boundary) {
   auto str = std::string(4096, 'x');
-  fmt::ostream out = fmt::output_file("test-file");
+  auto test_file = uniq_file_name(__LINE__);
+  fmt::ostream out = fmt::output_file(test_file);
   out.print("{}", str);
   out.print("{}", str);
   out.close();
-  file in("test-file", file::RDONLY);
+  file in(test_file, file::RDONLY);
   EXPECT_READ(in, str + str);
 }
 
 TEST(ostream_test, buffer_size) {
-  fmt::ostream out = fmt::output_file("test-file", fmt::buffer_size = 1);
+  auto test_file = uniq_file_name(__LINE__);
+  fmt::ostream out = fmt::output_file(test_file, fmt::buffer_size = 1);
   out.print("{}", "foo");
   out.close();
-  file in("test-file", file::RDONLY);
+  file in(test_file, file::RDONLY);
   EXPECT_READ(in, "foo");
 }
 
 TEST(ostream_test, truncate) {
+  auto test_file = uniq_file_name(__LINE__);
   {
-    fmt::ostream out = fmt::output_file("test-file");
+    fmt::ostream out = fmt::output_file(test_file);
     out.print("0123456789");
   }
   {
-    fmt::ostream out = fmt::output_file("test-file");
+    fmt::ostream out = fmt::output_file(test_file);
     out.print("foo");
   }
-  file in("test-file", file::RDONLY);
+  file in(test_file, file::RDONLY);
   EXPECT_EQ("foo", read(in, 4));
 }
 
 TEST(ostream_test, flush) {
-  auto out = fmt::output_file("test-file");
+  auto test_file = uniq_file_name(__LINE__);
+  auto out = fmt::output_file(test_file);
   out.print("x");
   out.flush();
-  auto in = fmt::file("test-file", file::RDONLY);
+  auto in = fmt::file(test_file, file::RDONLY);
   EXPECT_READ(in, "x");
 }
 
@@ -305,10 +314,11 @@ TEST(file_test, default_ctor) {
 }
 
 TEST(file_test, open_buffered_file_in_ctor) {
-  FILE* fp = safe_fopen("test-file", "w");
+  auto test_file = uniq_file_name(__LINE__);
+  FILE* fp = safe_fopen(test_file.c_str(), "w");
   std::fputs(file_content, fp);
   std::fclose(fp);
-  file f("test-file", file::RDONLY);
+  file f(test_file.c_str(), file::RDONLY);
   // Check if the file is open by reading one character from it.
   char buffer;
   bool isopen = FMT_POSIX(read(f.descriptor(), &buffer, 1)) == 1;
@@ -419,7 +429,8 @@ TEST(file_test, read) {
 }
 
 TEST(file_test, read_error) {
-  file f("test-file", file::WRONLY);
+  auto test_file = uniq_file_name(__LINE__);
+  file f(test_file, file::WRONLY | file::CREATE);
   char buf;
   // We intentionally read from a file opened in the write-only mode to
   // cause error.
@@ -427,15 +438,16 @@ TEST(file_test, read_error) {
 }
 
 TEST(file_test, write) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  write(write_end, "test");
-  write_end.close();
-  EXPECT_READ(read_end, "test");
+  auto pipe = fmt::pipe();
+  auto test_file = uniq_file_name(__LINE__);
+  write(pipe.write_end, test_file);
+  pipe.write_end.close();
+  EXPECT_READ(pipe.read_end, test_file);
 }
 
 TEST(file_test, write_error) {
-  file f("test-file", file::RDONLY);
+  auto test_file = uniq_file_name(__LINE__);
+  file f(test_file, file::RDONLY | file::CREATE);
   // We intentionally write to a file opened in the read-only mode to
   // cause error.
   EXPECT_SYSTEM_ERROR(f.write(" ", 1), EBADF, "cannot write to file");
@@ -489,18 +501,16 @@ TEST(file_test, dup2_noexcept_error) {
 }
 
 TEST(file_test, pipe) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  EXPECT_NE(-1, read_end.descriptor());
-  EXPECT_NE(-1, write_end.descriptor());
-  write(write_end, "test");
-  EXPECT_READ(read_end, "test");
+  auto pipe = fmt::pipe();
+  EXPECT_NE(-1, pipe.read_end.descriptor());
+  EXPECT_NE(-1, pipe.write_end.descriptor());
+  write(pipe.write_end, "test");
+  EXPECT_READ(pipe.read_end, "test");
 }
 
 TEST(file_test, fdopen) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  int read_fd = read_end.descriptor();
-  EXPECT_EQ(read_fd, FMT_POSIX(fileno(read_end.fdopen("r").get())));
+  auto pipe = fmt::pipe();
+  int read_fd = pipe.read_end.descriptor();
+  EXPECT_EQ(read_fd, FMT_POSIX(fileno(pipe.read_end.fdopen("r").get())));
 }
 #endif  // FMT_USE_FCNTL
diff --git a/test/ostream-test.cc b/test/ostream-test.cc
index 98ee0757..cc28885a 100644
--- a/test/ostream-test.cc
+++ b/test/ostream-test.cc
@@ -135,8 +135,8 @@ TEST(ostream_test, write_to_ostream_max_size) {
 
   struct test_buffer final : fmt::detail::buffer<char> {
     explicit test_buffer(size_t size)
-        : fmt::detail::buffer<char>(nullptr, size, size) {}
-    void grow(size_t) override {}
+        : fmt::detail::buffer<char>([](buffer<char>&, size_t) {}, nullptr, size,
+                                    size) {}
   } buffer(max_size);
 
   struct mock_streambuf : std::streambuf {
@@ -201,7 +201,8 @@ auto operator<<(std::ostream& os, test_template<T>) -> std::ostream& {
 
 namespace fmt {
 template <typename T> struct formatter<test_template<T>> : formatter<int> {
-  auto format(test_template<T>, format_context& ctx) -> decltype(ctx.out()) {
+  auto format(test_template<T>, format_context& ctx) const
+      -> decltype(ctx.out()) {
     return formatter<int>::format(2, ctx);
   }
 };
@@ -292,8 +293,7 @@ TEST(ostream_test, closed_ofstream) {
 
 struct unlocalized {};
 
-auto operator<<(std::ostream& os, unlocalized)
-    -> std::ostream& {
+auto operator<<(std::ostream& os, unlocalized) -> std::ostream& {
   return os << 12345;
 }
 
diff --git a/test/perf-sanity.cc b/test/perf-sanity.cc
new file mode 100644
index 00000000..aa0c0cae
--- /dev/null
+++ b/test/perf-sanity.cc
@@ -0,0 +1,25 @@
+// A quick and dirty performance test.
+// For actual benchmarks see https://github.com/fmtlib/format-benchmark.
+
+#include <atomic>
+#include <chrono>
+#include <iterator>
+
+#include "fmt/format.h"
+
+int main() {
+  const int n = 10000000;
+
+  auto start = std::chrono::steady_clock::now();
+  for (int iteration = 0; iteration < n; ++iteration) {
+    auto buf = fmt::memory_buffer();
+    fmt::format_to(std::back_inserter(buf),
+                   "Hello, {}. The answer is {} and {}.", 1, 2345, 6789);
+  }
+  std::atomic_signal_fence(std::memory_order_acq_rel);  // Clobber memory.
+  auto end = std::chrono::steady_clock::now();
+
+  // Print time in milliseconds.
+  std::chrono::duration<double> duration = end - start;
+  fmt::print("{:.1f}\n", duration.count() * 1000);
+}
diff --git a/test/posix-mock-test.cc b/test/posix-mock-test.cc
index 32078bf8..bcd330d4 100644
--- a/test/posix-mock-test.cc
+++ b/test/posix-mock-test.cc
@@ -225,9 +225,8 @@ TEST(file_test, open_retry) {
 }
 
 TEST(file_test, close_no_retry_in_dtor) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  std::unique_ptr<file> f(new file(std::move(read_end)));
+  auto pipe = fmt::pipe();
+  std::unique_ptr<file> f(new file(std::move(pipe.read_end)));
   int saved_close_count = 0;
   EXPECT_WRITE(
       stderr,
@@ -242,10 +241,9 @@ TEST(file_test, close_no_retry_in_dtor) {
 }
 
 TEST(file_test, close_no_retry) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
   close_count = 1;
-  EXPECT_SYSTEM_ERROR(read_end.close(), EINTR, "cannot close file");
+  EXPECT_SYSTEM_ERROR(pipe.read_end.close(), EINTR, "cannot close file");
   EXPECT_EQ(2, close_count);
   close_count = 0;
 }
@@ -283,30 +281,28 @@ TEST(file_test, max_size) {
 }
 
 TEST(file_test, read_retry) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
   enum { SIZE = 4 };
-  write_end.write("test", SIZE);
-  write_end.close();
+  pipe.write_end.write("test", SIZE);
+  pipe.write_end.close();
   char buffer[SIZE];
   size_t count = 0;
-  EXPECT_RETRY(count = read_end.read(buffer, SIZE), read,
+  EXPECT_RETRY(count = pipe.read_end.read(buffer, SIZE), read,
                "cannot read from file");
   EXPECT_EQ_POSIX(static_cast<std::streamsize>(SIZE), count);
 }
 
 TEST(file_test, write_retry) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
   enum { SIZE = 4 };
   size_t count = 0;
-  EXPECT_RETRY(count = write_end.write("test", SIZE), write,
+  EXPECT_RETRY(count = pipe.write_end.write("test", SIZE), write,
                "cannot write to file");
-  write_end.close();
+  pipe.write_end.close();
 #  ifndef _WIN32
   EXPECT_EQ(static_cast<std::streamsize>(SIZE), count);
   char buffer[SIZE + 1];
-  read_end.read(buffer, SIZE);
+  pipe.read_end.read(buffer, SIZE);
   buffer[SIZE] = '\0';
   EXPECT_STREQ("test", buffer);
 #  endif
@@ -314,27 +310,25 @@ TEST(file_test, write_retry) {
 
 #  ifdef _WIN32
 TEST(file_test, convert_read_count) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
   char c;
   size_t size = UINT_MAX;
   if (sizeof(unsigned) != sizeof(size_t)) ++size;
   read_count = 1;
   read_nbyte = 0;
-  EXPECT_THROW(read_end.read(&c, size), std::system_error);
+  EXPECT_THROW(pipe.read_end.read(&c, size), std::system_error);
   read_count = 0;
   EXPECT_EQ(UINT_MAX, read_nbyte);
 }
 
 TEST(file_test, convert_write_count) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
   char c;
   size_t size = UINT_MAX;
   if (sizeof(unsigned) != sizeof(size_t)) ++size;
   write_count = 1;
   write_nbyte = 0;
-  EXPECT_THROW(write_end.write(&c, size), std::system_error);
+  EXPECT_THROW(pipe.write_end.write(&c, size), std::system_error);
   write_count = 0;
   EXPECT_EQ(UINT_MAX, write_nbyte);
 }
@@ -372,18 +366,15 @@ TEST(file_test, dup2_no_except_retry) {
 }
 
 TEST(file_test, pipe_no_retry) {
-  file read_end, write_end;
   pipe_count = 1;
-  EXPECT_SYSTEM_ERROR(file::pipe(read_end, write_end), EINTR,
-                      "cannot create pipe");
+  EXPECT_SYSTEM_ERROR(fmt::pipe(), EINTR, "cannot create pipe");
   pipe_count = 0;
 }
 
 TEST(file_test, fdopen_no_retry) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
   fdopen_count = 1;
-  EXPECT_SYSTEM_ERROR(read_end.fdopen("r"), EINTR,
+  EXPECT_SYSTEM_ERROR(pipe.read_end.fdopen("r"), EINTR,
                       "cannot associate stream with file descriptor");
   fdopen_count = 0;
 }
@@ -401,9 +392,9 @@ TEST(buffered_file_test, open_retry) {
 }
 
 TEST(buffered_file_test, close_no_retry_in_dtor) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  std::unique_ptr<buffered_file> f(new buffered_file(read_end.fdopen("r")));
+  auto pipe = fmt::pipe();
+  std::unique_ptr<buffered_file> f(
+      new buffered_file(pipe.read_end.fdopen("r")));
   int saved_fclose_count = 0;
   EXPECT_WRITE(
       stderr,
@@ -418,9 +409,8 @@ TEST(buffered_file_test, close_no_retry_in_dtor) {
 }
 
 TEST(buffered_file_test, close_no_retry) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  buffered_file f = read_end.fdopen("r");
+  auto pipe = fmt::pipe();
+  buffered_file f = pipe.read_end.fdopen("r");
   fclose_count = 1;
   EXPECT_SYSTEM_ERROR(f.close(), EINTR, "cannot close file");
   EXPECT_EQ(2, fclose_count);
@@ -428,9 +418,8 @@ TEST(buffered_file_test, close_no_retry) {
 }
 
 TEST(buffered_file_test, fileno_no_retry) {
-  file read_end, write_end;
-  file::pipe(read_end, write_end);
-  buffered_file f = read_end.fdopen("r");
+  auto pipe = fmt::pipe();
+  buffered_file f = pipe.read_end.fdopen("r");
   fileno_count = 1;
   EXPECT_SYSTEM_ERROR((f.descriptor)(), EINTR, "cannot get file descriptor");
   EXPECT_EQ(2, fileno_count);
@@ -440,7 +429,7 @@ TEST(buffered_file_test, fileno_no_retry) {
 
 struct test_mock {
   static test_mock* instance;
-} * test_mock::instance;
+}* test_mock::instance;
 
 TEST(scoped_mock, scope) {
   {
diff --git a/test/printf-test.cc b/test/printf-test.cc
index 7e09ecca..ee5cf0b0 100644
--- a/test/printf-test.cc
+++ b/test/printf-test.cc
@@ -6,6 +6,10 @@
 // For the license information refer to format.h.
 
 #include "fmt/printf.h"
+// include <format> if possible for https://github.com/fmtlib/fmt/pull/4042
+#if FMT_HAS_INCLUDE(<format>) && FMT_CPLUSPLUS > 201703L
+#  include <format>
+#endif
 
 #include <cctype>
 #include <climits>
@@ -310,10 +314,14 @@ TEST(printf_test, dynamic_precision) {
   }
 }
 
-template <typename T> struct make_signed { using type = T; };
+template <typename T> struct make_signed {
+  using type = T;
+};
 
-#define SPECIALIZE_MAKE_SIGNED(T, S) \
-  template <> struct make_signed<T> { using type = S; }
+#define SPECIALIZE_MAKE_SIGNED(T, S)  \
+  template <> struct make_signed<T> { \
+    using type = S;                   \
+  }
 
 SPECIALIZE_MAKE_SIGNED(char, signed char);
 SPECIALIZE_MAKE_SIGNED(unsigned char, signed char);
@@ -517,9 +525,8 @@ TEST(printf_test, examples) {
 }
 
 TEST(printf_test, printf_error) {
-  fmt::file read_end, write_end;
-  fmt::file::pipe(read_end, write_end);
-  int result = fmt::fprintf(read_end.fdopen("r").get(), "test");
+  auto pipe = fmt::pipe();
+  int result = fmt::fprintf(pipe.read_end.fdopen("r").get(), "test");
   EXPECT_LT(result, 0);
 }
 #endif
@@ -530,7 +537,7 @@ TEST(printf_test, wide_string) {
 
 TEST(printf_test, vprintf) {
   int n = 42;
-  auto store = fmt::format_arg_store<fmt::printf_context, int>(n);
+  auto store = fmt::make_format_args<fmt::printf_context>(n);
   auto args = fmt::basic_format_args<fmt::printf_context>(store);
   EXPECT_EQ(fmt::vsprintf(fmt::string_view("%d"), args), "42");
   EXPECT_WRITE(stdout, fmt::vfprintf(stdout, fmt::string_view("%d"), args),
@@ -551,10 +558,11 @@ TEST(printf_test, fixed_large_exponent) {
 }
 
 TEST(printf_test, make_printf_args) {
+  int n = 42;
   EXPECT_EQ("[42] something happened",
             fmt::vsprintf(fmt::string_view("[%d] %s happened"),
-                          {fmt::make_printf_args(42, "something")}));
+                          {fmt::make_printf_args(n, "something")}));
   EXPECT_EQ(L"[42] something happened",
             fmt::vsprintf(fmt::basic_string_view<wchar_t>(L"[%d] %s happened"),
-                          {fmt::make_wprintf_args(42, L"something")}));
+                          {fmt::make_printf_args<wchar_t>(n, L"something")}));
 }
diff --git a/test/ranges-odr-test.cc b/test/ranges-odr-test.cc
index 031354d3..6115dcb7 100644
--- a/test/ranges-odr-test.cc
+++ b/test/ranges-odr-test.cc
@@ -7,6 +7,7 @@
 
 #include <vector>
 
+#include "fmt/format.h"
 #include "fmt/ranges.h"
 #include "gtest/gtest.h"
 
diff --git a/test/ranges-test.cc b/test/ranges-test.cc
index 8ab66b33..a3b659db 100644
--- a/test/ranges-test.cc
+++ b/test/ranges-test.cc
@@ -7,6 +7,7 @@
 
 #include "fmt/ranges.h"
 
+#include <array>
 #include <list>
 #include <map>
 #include <numeric>
@@ -16,10 +17,11 @@
 #include <utility>
 #include <vector>
 
-#if FMT_HAS_INCLUDE(<ranges>)
+#if FMT_CPLUSPLUS > 201703L && FMT_HAS_INCLUDE(<ranges>)
 #  include <ranges>
 #endif
 
+#include "fmt/format.h"
 #include "gtest/gtest.h"
 
 #if !FMT_GCC_VERSION || FMT_GCC_VERSION >= 601
@@ -57,8 +59,13 @@ TEST(ranges_test, format_vector) {
   EXPECT_EQ(fmt::format("{:n:#x}", v), "0x1, 0x2, 0x3, 0x5, 0x7, 0xb");
 
   auto vc = std::vector<char>{'a', 'b', 'c'};
+  auto vec = std::vector<char>{'a', '\n', '\t'};
   auto vvc = std::vector<std::vector<char>>{vc, vc};
   EXPECT_EQ(fmt::format("{}", vc), "['a', 'b', 'c']");
+  EXPECT_EQ(fmt::format("{:s}", vc), "\"abc\"");
+  EXPECT_EQ(fmt::format("{:?s}", vec), "\"a\\n\\t\"");
+  EXPECT_EQ(fmt::format("{:s}", vec), "\"a\n\t\"");
+  EXPECT_EQ(fmt::format("{::s}", vvc), "[\"abc\", \"abc\"]");
   EXPECT_EQ(fmt::format("{}", vvc), "[['a', 'b', 'c'], ['a', 'b', 'c']]");
   EXPECT_EQ(fmt::format("{:n}", vvc), "['a', 'b', 'c'], ['a', 'b', 'c']");
   EXPECT_EQ(fmt::format("{:n:n}", vvc), "'a', 'b', 'c', 'a', 'b', 'c'");
@@ -83,6 +90,35 @@ TEST(ranges_test, format_map) {
   EXPECT_EQ(fmt::format("{:n}", m), "\"one\": 1, \"two\": 2");
 }
 
+struct test_map_value {};
+
+FMT_BEGIN_NAMESPACE
+template <> struct formatter<test_map_value> : formatter<string_view> {
+  auto format(test_map_value, format_context& ctx) const
+      -> format_context::iterator {
+    return formatter<string_view>::format("foo", ctx);
+  }
+};
+
+template <typename K>
+struct formatter<std::pair<K, test_map_value>> : formatter<string_view> {
+  auto format(std::pair<K, test_map_value>, format_context& ctx) const
+      -> format_context::iterator {
+    return ctx.out();
+  }
+};
+
+template <typename K>
+struct is_tuple_formattable<std::pair<K, test_map_value>, char>
+    : std::false_type {};
+
+FMT_END_NAMESPACE
+
+TEST(ranges_test, format_map_custom_pair) {
+  EXPECT_EQ(fmt::format("{}", std::map<int, test_map_value>{{42, {}}}),
+            "{42: \"foo\"}");
+}
+
 TEST(ranges_test, format_set) {
   EXPECT_EQ(fmt::format("{}", std::set<std::string>{"one", "two"}),
             "{\"one\", \"two\"}");
@@ -134,6 +170,8 @@ TEST(ranges_test, format_adl_begin_end) {
 TEST(ranges_test, format_pair) {
   auto p = std::pair<int, float>(42, 1.5f);
   EXPECT_EQ(fmt::format("{}", p), "(42, 1.5)");
+  EXPECT_EQ(fmt::format("{:}", p), "(42, 1.5)");
+  EXPECT_EQ(fmt::format("{:n}", p), "421.5");
 }
 
 struct unformattable {};
@@ -142,6 +180,7 @@ TEST(ranges_test, format_tuple) {
   auto t =
       std::tuple<int, float, std::string, char>(42, 1.5f, "this is tuple", 'i');
   EXPECT_EQ(fmt::format("{}", t), "(42, 1.5, \"this is tuple\", 'i')");
+  EXPECT_EQ(fmt::format("{:n}", t), "421.5\"this is tuple\"'i'");
 
   EXPECT_EQ(fmt::format("{}", std::tuple<>()), "()");
 
@@ -232,6 +271,33 @@ TEST(ranges_test, disabled_range_formatting_of_path) {
             fmt::range_format::disabled);
 }
 
+struct vector_string : std::vector<char> {
+  using base = std::vector<char>;
+  using base::base;
+};
+struct vector_debug_string : std::vector<char> {
+  using base = std::vector<char>;
+  using base::base;
+};
+FMT_BEGIN_NAMESPACE
+template <>
+struct range_format_kind<vector_string, char>
+    : std::integral_constant<range_format, range_format::string> {};
+template <>
+struct range_format_kind<vector_debug_string, char>
+    : std::integral_constant<range_format, range_format::debug_string> {};
+FMT_END_NAMESPACE
+
+TEST(ranges_test, range_format_string) {
+  const vector_string v{'f', 'o', 'o'};
+  EXPECT_EQ(fmt::format("{}", v), "foo");
+}
+
+TEST(ranges_test, range_format_debug_string) {
+  const vector_debug_string v{'f', 'o', 'o'};
+  EXPECT_EQ(fmt::format("{}", v), "\"foo\"");
+}
+
 // A range that provides non-const only begin()/end() to test fmt::join
 // handles that.
 //
@@ -287,7 +353,7 @@ TEST(ranges_test, range) {
   EXPECT_EQ(fmt::format("{}", z), "[0, 0, 0]");
 }
 
-enum test_enum { foo };
+enum test_enum { foo, bar };
 auto format_as(test_enum e) -> int { return e; }
 
 TEST(ranges_test, enum_range) {
@@ -297,8 +363,41 @@ TEST(ranges_test, enum_range) {
 
 #if !FMT_MSC_VERSION
 TEST(ranges_test, unformattable_range) {
-  EXPECT_FALSE((fmt::has_formatter<std::vector<unformattable>,
-                                   fmt::format_context>::value));
+  EXPECT_FALSE((fmt::is_formattable<std::vector<unformattable>, char>::value));
+}
+#endif
+
+TEST(ranges_test, join) {
+  using fmt::join;
+  int v1[3] = {1, 2, 3};
+  auto v2 = std::vector<float>();
+  v2.push_back(1.2f);
+  v2.push_back(3.4f);
+  void* v3[2] = {&v1[0], &v1[1]};
+
+  EXPECT_EQ(fmt::format("({})", join(v1, v1 + 3, ", ")), "(1, 2, 3)");
+  EXPECT_EQ(fmt::format("({})", join(v1, v1 + 1, ", ")), "(1)");
+  EXPECT_EQ(fmt::format("({})", join(v1, v1, ", ")), "()");
+  EXPECT_EQ(fmt::format("({:03})", join(v1, v1 + 3, ", ")), "(001, 002, 003)");
+  EXPECT_EQ("(+01.20, +03.40)",
+            fmt::format("({:+06.2f})", join(v2.begin(), v2.end(), ", ")));
+
+  EXPECT_EQ(fmt::format("{0:{1}}", join(v1, v1 + 3, ", "), 1), "1, 2, 3");
+
+  EXPECT_EQ(fmt::format("{}, {}", v3[0], v3[1]),
+            fmt::format("{}", join(v3, v3 + 2, ", ")));
+
+  EXPECT_EQ(fmt::format("({})", join(v1, ", ")), "(1, 2, 3)");
+  EXPECT_EQ(fmt::format("({:+06.2f})", join(v2, ", ")), "(+01.20, +03.40)");
+
+  auto v4 = std::vector<test_enum>{foo, bar, foo};
+  EXPECT_EQ(fmt::format("{}", join(v4, " ")), "0 1 0");
+}
+
+#ifdef __cpp_lib_byte
+TEST(ranges_test, join_bytes) {
+  auto v = std::vector<std::byte>{std::byte(1), std::byte(2), std::byte(3)};
+  EXPECT_EQ(fmt::format("{}", fmt::join(v, ", ")), "1, 2, 3");
 }
 #endif
 
@@ -420,9 +519,23 @@ TEST(ranges_test, join_range) {
       "0,1,2,3,4");
 #  endif
 }
+
+namespace adl {
+struct vec {
+  int n[2] = {42, 43};
+};
+
+auto begin(const vec& v) -> const int* { return v.n; }
+auto end(const vec& v) -> const int* { return v.n + 2; }
+}  // namespace adl
+
+TEST(ranges_test, format_join_adl_begin_end) {
+  EXPECT_EQ(fmt::format("{}", fmt::join(adl::vec(), "/")), "42/43");
+}
+
 #endif  // FMT_RANGES_TEST_ENABLE_JOIN
 
-#if defined(__cpp_lib_ranges) && __cpp_lib_ranges >= 202302L
+#if defined(__cpp_lib_ranges) && __cpp_lib_ranges >= 202207L
 TEST(ranges_test, nested_ranges) {
   auto l = std::list{1, 2, 3};
   auto r = std::views::iota(0, 3) | std::views::transform([&l](auto i) {
@@ -447,7 +560,7 @@ TEST(ranges_test, escape) {
   EXPECT_EQ(fmt::format("{}", vec{"\x7f"}), "[\"\\x7f\"]");
   EXPECT_EQ(fmt::format("{}", vec{"n\xcc\x83"}), "[\"n\xcc\x83\"]");
 
-  if (fmt::detail::is_utf8()) {
+  if (fmt::detail::use_utf8) {
     EXPECT_EQ(fmt::format("{}", vec{"\xcd\xb8"}), "[\"\\u0378\"]");
     // Unassigned Unicode code points.
     EXPECT_EQ(fmt::format("{}", vec{"\xf0\xaa\x9b\x9e"}), "[\"\\U0002a6de\"]");
@@ -465,7 +578,11 @@ TEST(ranges_test, escape) {
 
   EXPECT_EQ(fmt::format("{}", std::vector<std::vector<char>>{{'x'}}),
             "[['x']]");
+
+// Disabled due to a clang 17 bug: https://github.com/fmtlib/fmt/issues/4144.
+#if FMT_CLANG_VERSION >= 1800
   EXPECT_EQ(fmt::format("{}", std::tuple<std::vector<char>>{{'x'}}), "(['x'])");
+#endif
 }
 
 template <typename R> struct fmt_ref_view {
@@ -558,3 +675,121 @@ auto format_as(const tieable& t) -> std::tuple<int, double> {
 TEST(ranges_test, format_as_tie) {
   EXPECT_EQ(fmt::format("{}", tieable()), "(3, 0.42)");
 }
+
+struct lvalue_qualified_begin_end {
+  int arr[5] = {1, 2, 3, 4, 5};
+
+  auto begin() & -> const int* { return arr; }
+  auto end() & -> const int* { return arr + 5; }
+};
+
+TEST(ranges_test, lvalue_qualified_begin_end) {
+  EXPECT_EQ(fmt::format("{}", lvalue_qualified_begin_end{}), "[1, 2, 3, 4, 5]");
+}
+
+#if !defined(__cpp_lib_ranges) || __cpp_lib_ranges <= 202106L
+#  define ENABLE_STD_VIEWS_TESTS 0
+#elif FMT_CLANG_VERSION
+#  if FMT_CLANG_VERSION > 1500
+#    define ENABLE_STD_VIEWS_TESTS 1
+#  else
+#    define ENABLE_STD_VIEWS_TESTS 0
+#  endif
+#else
+#  define ENABLE_STD_VIEWS_TESTS 1
+#endif
+
+#if ENABLE_STD_VIEWS_TESTS
+TEST(ranges_test, input_range_join) {
+  auto iss = std::istringstream("1 2 3 4 5");
+  auto view = std::views::istream<std::string>(iss);
+  EXPECT_EQ("1, 2, 3, 4, 5",
+            fmt::format("{}", fmt::join(view.begin(), view.end(), ", ")));
+}
+
+TEST(ranges_test, input_range_join_overload) {
+  auto iss = std::istringstream("1 2 3 4 5");
+  EXPECT_EQ(
+      "1.2.3.4.5",
+      fmt::format("{}", fmt::join(std::views::istream<std::string>(iss), ".")));
+}
+
+namespace views_filter_view_test {
+struct codec_mask {
+  static constexpr auto codecs = std::array{0, 1, 2, 3};
+  int except = 0;
+};
+
+auto format_as(codec_mask mask) {
+  // Careful not to capture param by reference here, it will dangle.
+  return codec_mask::codecs |
+         std::views::filter([mask](auto c) { return c != mask.except; });
+}
+}  // namespace views_filter_view_test
+
+TEST(ranges_test, format_as_with_ranges_mutable_begin_end) {
+  using namespace views_filter_view_test;
+  {
+    auto make_filter_view = []() {
+      return codec_mask::codecs |
+             std::views::filter([](auto c) { return c != 2; });
+    };
+    auto r = make_filter_view();
+    EXPECT_EQ("[0, 1, 3]", fmt::format("{}", r));
+    EXPECT_EQ("[0, 1, 3]", fmt::format("{}", make_filter_view()));
+  }
+
+  {
+    auto mask = codec_mask{2};
+    const auto const_mask = codec_mask{2};
+
+    EXPECT_EQ("[0, 1, 3]", fmt::format("{}", mask));
+    EXPECT_EQ("[0, 1, 3]", fmt::format("{}", const_mask));
+    EXPECT_EQ("[0, 1, 3]", fmt::format("{}", codec_mask{2}));
+  }
+}
+
+#endif
+
+TEST(ranges_test, std_istream_iterator_join) {
+  auto&& iss = std::istringstream("1 2 3 4 5");
+  auto first = std::istream_iterator<int>(iss);
+  auto last = std::istream_iterator<int>();
+  EXPECT_EQ("1, 2, 3, 4, 5", fmt::format("{}", fmt::join(first, last, ", ")));
+}
+
+// Mirrors C++20 std::ranges::basic_istream_view::iterator.
+struct noncopyable_istream_iterator : std::istream_iterator<int> {
+  using base = std::istream_iterator<int>;
+  explicit noncopyable_istream_iterator(std::istringstream& iss) : base{iss} {}
+  noncopyable_istream_iterator(const noncopyable_istream_iterator&) = delete;
+  noncopyable_istream_iterator(noncopyable_istream_iterator&&) = default;
+};
+static_assert(!std::is_copy_constructible<noncopyable_istream_iterator>::value,
+              "");
+
+TEST(ranges_test, movable_only_istream_iter_join) {
+  auto&& iss = std::istringstream("1 2 3 4 5");
+  auto first = noncopyable_istream_iterator(iss);
+  auto last = std::istream_iterator<int>();
+  EXPECT_EQ("1, 2, 3, 4, 5",
+            fmt::format("{}", fmt::join(std::move(first), last, ", ")));
+}
+
+struct movable_iter_range {
+  std::istringstream iss{"1 2 3 4 5"};
+  noncopyable_istream_iterator begin() {
+    return noncopyable_istream_iterator{iss};
+  }
+  std::istream_iterator<int> end() { return {}; }
+};
+
+TEST(ranges_test, movable_only_istream_iter_join2) {
+  EXPECT_EQ("[1, 2, 3, 4, 5]", fmt::format("{}", movable_iter_range{}));
+}
+
+struct not_range {
+  void begin() const {}
+  void end() const {}
+};
+static_assert(!fmt::is_formattable<not_range>{}, "");
diff --git a/test/scan-test.cc b/test/scan-test.cc
index f0ede192..03b26e5d 100644
--- a/test/scan-test.cc
+++ b/test/scan-test.cc
@@ -18,71 +18,57 @@
 
 TEST(scan_test, read_text) {
   fmt::string_view s = "foo";
-  auto end = fmt::scan(s, "foo");
+  auto end = fmt::scan_to(s, "foo");
   EXPECT_EQ(end, s.end());
-  EXPECT_THROW_MSG(fmt::scan("fob", "foo"), fmt::format_error, "invalid input");
+  EXPECT_THROW_MSG(fmt::scan<int>("fob", "foo"), fmt::format_error,
+                   "invalid input");
 }
 
 TEST(scan_test, read_int) {
-  int n = 0;
-  fmt::scan("42", "{}", n);
-  EXPECT_EQ(n, 42);
-  fmt::scan("-42", "{}", n);
-  EXPECT_EQ(n, -42);
-  fmt::scan("42", "{:}", n);
-  EXPECT_EQ(n, 42);
-  EXPECT_THROW_MSG(fmt::scan(std::to_string(INT_MAX + 1u), "{}", n),
+  EXPECT_EQ(fmt::scan<int>("42", "{}")->value(), 42);
+  EXPECT_EQ(fmt::scan<int>("-42", "{}")->value(), -42);
+  EXPECT_EQ(fmt::scan<int>("42", "{:}")->value(), 42);
+  EXPECT_THROW_MSG(fmt::scan<int>(std::to_string(INT_MAX + 1u), "{}"),
                    fmt::format_error, "number is too big");
 }
 
-TEST(scan_test, read_longlong) {
-  long long n = 0;
-  fmt::scan("42", "{}", n);
-  EXPECT_EQ(n, 42);
-  fmt::scan("-42", "{}", n);
-  EXPECT_EQ(n, -42);
+TEST(scan_test, read_long_long) {
+  EXPECT_EQ(fmt::scan<long long>("42", "{}")->value(), 42);
+  EXPECT_EQ(fmt::scan<long long>("-42", "{}")->value(), -42);
 }
 
 TEST(scan_test, read_uint) {
-  unsigned n = 0;
-  fmt::scan("42", "{}", n);
-  EXPECT_EQ(n, 42);
-  EXPECT_THROW_MSG(fmt::scan("-42", "{}", n), fmt::format_error,
+  EXPECT_EQ(fmt::scan<unsigned>("42", "{}")->value(), 42);
+  EXPECT_THROW_MSG(fmt::scan<unsigned>("-42", "{}"), fmt::format_error,
                    "invalid input");
 }
 
-TEST(scan_test, read_ulonglong) {
-  unsigned long long n = 0;
-  fmt::scan("42", "{}", n);
-  EXPECT_EQ(n, 42);
-  EXPECT_THROW_MSG(fmt::scan("-42", "{}", n), fmt::format_error,
-                   "invalid input");
+TEST(scan_test, read_ulong_long) {
+  EXPECT_EQ(fmt::scan<unsigned long long>("42", "{}")->value(), 42);
+  EXPECT_THROW_MSG(fmt::scan<unsigned long long>("-42", "{}")->value(),
+                   fmt::format_error, "invalid input");
 }
 
 TEST(scan_test, read_hex) {
-  unsigned n = 0;
-  fmt::scan("2a", "{:x}", n);
-  EXPECT_EQ(n, 42);
+  EXPECT_EQ(fmt::scan<unsigned>("2a", "{:x}")->value(), 42);
   auto num_digits = std::numeric_limits<unsigned>::digits / 4;
-  EXPECT_THROW_MSG(fmt::scan(fmt::format("1{:0{}}", 0, num_digits), "{:x}", n),
-                   fmt::format_error, "number is too big");
+  EXPECT_THROW_MSG(
+      fmt::scan<unsigned>(fmt::format("1{:0{}}", 0, num_digits), "{:x}")
+          ->value(),
+      fmt::format_error, "number is too big");
 }
 
 TEST(scan_test, read_string) {
-  std::string s;
-  fmt::scan("foo", "{}", s);
-  EXPECT_EQ(s, "foo");
+  EXPECT_EQ(fmt::scan<std::string>("foo", "{}")->value(), "foo");
 }
 
 TEST(scan_test, read_string_view) {
-  fmt::string_view s;
-  fmt::scan("foo", "{}", s);
-  EXPECT_EQ(s, "foo");
+  EXPECT_EQ(fmt::scan<fmt::string_view>("foo", "{}")->value(), "foo");
 }
 
 TEST(scan_test, separator) {
   int n1 = 0, n2 = 0;
-  fmt::scan("10 20", "{} {}", n1, n2);
+  fmt::scan_to("10 20", "{} {}", n1, n2);
   EXPECT_EQ(n1, 10);
   EXPECT_EQ(n2, 20);
 }
@@ -97,79 +83,90 @@ template <> struct scanner<num> {
 
   auto parse(scan_parse_context& ctx) -> scan_parse_context::iterator {
     auto it = ctx.begin(), end = ctx.end();
-    if (it != end && *it == 'x') hex = true;
-    if (it != end && *it != '}') throw_format_error("invalid format");
+    if (it != end && *it == 'x') {
+      hex = true;
+      ++it;
+    }
+    if (it != end && *it != '}') report_error("invalid format");
     return it;
   }
 
   template <class ScanContext>
   auto scan(num& n, ScanContext& ctx) const -> typename ScanContext::iterator {
-    // TODO: handle specifier
-    return fmt::scan(ctx, "{}", n.value);
+    return hex ? scan_to(ctx, "{:x}", n.value) : scan_to(ctx, "{}", n.value);
   }
 };
 }  // namespace fmt
 
 TEST(scan_test, read_custom) {
-  auto input = "42";
-  auto n = num();
-  fmt::scan(input, "{:}", n);
-  EXPECT_EQ(n.value, 42);
+  EXPECT_EQ(fmt::scan<num>("42", "{}")->value().value, 42);
+  EXPECT_EQ(fmt::scan<num>("2a", "{:x}")->value().value, 42);
 }
 
 TEST(scan_test, invalid_format) {
-  EXPECT_THROW_MSG(fmt::scan("", "{}"), fmt::format_error,
+  EXPECT_THROW_MSG(fmt::scan_to("", "{}"), fmt::format_error,
                    "argument index out of range");
-  EXPECT_THROW_MSG(fmt::scan("", "{"), fmt::format_error,
+  EXPECT_THROW_MSG(fmt::scan_to("", "{"), fmt::format_error,
                    "invalid format string");
 }
 
+namespace std {
+using fmt::scan;
+using fmt::scan_error;
+}  // namespace std
+
 TEST(scan_test, example) {
-  std::string key;
-  int value = 0;
-  fmt::scan("answer = 42", "{} = {}", key, value);
-  EXPECT_EQ(key, "answer");
-  EXPECT_EQ(value, 42);
+  // Example from https://wg21.link/p1729r3.
+  if (auto result = std::scan<std::string, int>("answer = 42", "{} = {}")) {
+    auto range = result->range();
+    EXPECT_EQ(range.begin(), range.end());
+    EXPECT_EQ(result->begin(), result->end());
+#ifdef __cpp_structured_bindings
+    const auto& [key, value] = result->values();
+    EXPECT_EQ(key, "answer");
+    EXPECT_EQ(value, 42);
+#endif
+  } else {
+    std::scan_error error = result.error();
+    (void)error;
+    FAIL();
+  }
 }
 
-TEST(scan_test, end_of_input) {
-  int value = 0;
-  fmt::scan("", "{}", value);
-}
+TEST(scan_test, end_of_input) { fmt::scan<int>("", "{}"); }
 
 #if FMT_USE_FCNTL
 TEST(scan_test, file) {
-  fmt::file read_end, write_end;
-  fmt::file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
 
   fmt::string_view input = "10 20";
-  write_end.write(input.data(), input.size());
-  write_end.close();
+  pipe.write_end.write(input.data(), input.size());
+  pipe.write_end.close();
 
   int n1 = 0, n2 = 0;
-  fmt::buffered_file f = read_end.fdopen("r");
-  fmt::scan(f.get(), "{} {}", n1, n2);
+  fmt::buffered_file f = pipe.read_end.fdopen("r");
+  fmt::scan_to(f.get(), "{} {}", n1, n2);
   EXPECT_EQ(n1, 10);
   EXPECT_EQ(n2, 20);
 }
 
 TEST(scan_test, lock) {
-  fmt::file read_end, write_end;
-  fmt::file::pipe(read_end, write_end);
+  auto pipe = fmt::pipe();
 
   std::thread producer([&]() {
     fmt::string_view input = "42 ";
-    for (int i = 0; i < 1000; ++i) write_end.write(input.data(), input.size());
-    write_end.close();
+    for (int i = 0; i < 1000; ++i)
+      pipe.write_end.write(input.data(), input.size());
+    pipe.write_end.close();
   });
 
   std::atomic<int> count(0);
-  fmt::buffered_file f = read_end.fdopen("r");
+  fmt::buffered_file f = pipe.read_end.fdopen("r");
   auto fun = [&]() {
     int value = 0;
-    while (fmt::scan(f.get(), "{}", value)) {
+    while (fmt::scan_to(f.get(), "{}", value)) {
       if (value != 42) {
-        read_end.close();
+        pipe.read_end.close();
         EXPECT_EQ(value, 42);
         break;
       }
@@ -178,11 +175,10 @@ TEST(scan_test, lock) {
   };
   std::thread consumer1(fun);
   std::thread consumer2(fun);
-  
+
   producer.join();
   consumer1.join();
   consumer2.join();
   EXPECT_EQ(count, 1000);
-
 }
 #endif  // FMT_USE_FCNTL
diff --git a/test/scan.h b/test/scan.h
index a68c77c3..f6aaf4e3 100644
--- a/test/scan.h
+++ b/test/scan.h
@@ -8,15 +8,16 @@
 #include <array>
 #include <cassert>
 #include <climits>
+#include <tuple>
 
-#include "fmt/format.h"
+#include "fmt/format-inl.h"
 
 FMT_BEGIN_NAMESPACE
 namespace detail {
 
 inline auto is_whitespace(char c) -> bool { return c == ' ' || c == '\n'; }
 
-// If c is a hex digit returns its numeric value, othewise -1.
+// If c is a hex digit returns its numeric value, otherwise -1.
 inline auto to_hex_digit(char c) -> int {
   if (c >= '0' && c <= '9') return c - '0';
   if (c >= 'a' && c <= 'f') return c - 'a' + 10;
@@ -42,9 +43,9 @@ class scan_buffer {
       : ptr_(ptr), end_(end), contiguous_(contiguous) {}
   ~scan_buffer() = default;
 
-  void set(string_view buf) {
-    ptr_ = buf.begin();
-    end_ = buf.end();
+  void set(span<const char> buf) {
+    ptr_ = buf.data;
+    end_ = buf.data + buf.size;
   }
 
   auto ptr() const -> const char* { return ptr_; }
@@ -141,7 +142,7 @@ class scan_buffer {
 using scan_iterator = scan_buffer::iterator;
 using scan_sentinel = scan_buffer::sentinel;
 
-class string_scan_buffer : public scan_buffer {
+class string_scan_buffer final : public scan_buffer {
  private:
   void consume() override {}
 
@@ -150,90 +151,15 @@ class string_scan_buffer : public scan_buffer {
       : scan_buffer(s.begin(), s.end(), true) {}
 };
 
-#ifdef _WIN32
-void flockfile(FILE* f) { _lock_file(f); }
-void funlockfile(FILE* f) { _unlock_file(f); }
-int getc_unlocked(FILE* f) { return _fgetc_nolock(f); }
-#endif
-
-// A FILE wrapper. F is FILE defined as a template parameter to make
-// system-specific API detection work.
-template <typename F> class file_base {
- protected:
-  F* file_;
-
- public:
-  file_base(F* file) : file_(file) {}
-  operator F*() const { return file_; }
-
-  // Reads a code unit from the stream.
-  auto get() -> int {
-    int result = getc_unlocked(file_);
-    if (result == EOF && ferror(file_) != 0)
-      FMT_THROW(system_error(errno, FMT_STRING("getc failed")));
-    return result;
-  }
-
-  // Puts the code unit back into the stream buffer.
-  void unget(char c) {
-    if (ungetc(c, file_) == EOF)
-      FMT_THROW(system_error(errno, FMT_STRING("ungetc failed")));
-  }
-};
-
-// A FILE wrapper for glibc.
-template <typename F> class glibc_file : public file_base<F> {
- public:
-  using file_base<F>::file_base;
-
-  // Returns the file's read buffer as a string_view.
-  auto buffer() const -> string_view {
-    return {this->file_->_IO_read_ptr,
-            to_unsigned(this->file_->_IO_read_end - this->file_->_IO_read_ptr)};
-  }
-};
-
-// A FILE wrapper for Apple's libc.
-template <typename F> class apple_file : public file_base<F> {
- public:
-  using file_base<F>::file_base;
-
-  auto buffer() const -> string_view {
-    return {reinterpret_cast<char*>(this->file_->_p),
-            to_unsigned(this->file_->_r)};
-  }
-};
-
-// A fallback FILE wrapper.
-template <typename F> class fallback_file : public file_base<F> {
- private:
-  char next_;  // The next unconsumed character in the buffer.
-  bool has_next_ = false;
-
- public:
-  using file_base<F>::file_base;
-
-  auto buffer() const -> string_view { return {&next_, has_next_ ? 1u : 0u}; }
-
-  auto get() -> int {
-    has_next_ = false;
-    return file_base<F>::get();
-  }
-
-  void unget(char c) {
-    file_base<F>::unget(c);
-    next_ = c;
-    has_next_ = true;
-  }
-};
-
-class file_scan_buffer : public scan_buffer {
+class file_scan_buffer final : public scan_buffer {
  private:
-  template <typename F, FMT_ENABLE_IF(sizeof(F::_IO_read_ptr) != 0)>
+  template <typename F, FMT_ENABLE_IF(sizeof(F::_IO_read_ptr) != 0 &&
+                                      !FMT_USE_FALLBACK_FILE)>
   static auto get_file(F* f, int) -> glibc_file<F> {
     return f;
   }
-  template <typename F, FMT_ENABLE_IF(sizeof(F::_p) != 0)>
+  template <typename F,
+            FMT_ENABLE_IF(sizeof(F::_p) != 0 && !FMT_USE_FALLBACK_FILE)>
   static auto get_file(F* f, int) -> apple_file<F> {
     return f;
   }
@@ -243,19 +169,19 @@ class file_scan_buffer : public scan_buffer {
 
   // Fills the buffer if it is empty.
   void fill() {
-    string_view buf = file_.buffer();
-    if (buf.size() == 0) {
+    span<const char> buf = file_.get_read_buffer();
+    if (buf.size == 0) {
       int c = file_.get();
       // Put the character back since we are only filling the buffer.
       if (c != EOF) file_.unget(static_cast<char>(c));
-      buf = file_.buffer();
+      buf = file_.get_read_buffer();
     }
     set(buf);
   }
 
   void consume() override {
     // Consume the current buffer content.
-    size_t n = to_unsigned(ptr() - file_.buffer().begin());
+    size_t n = to_unsigned(ptr() - file_.get_read_buffer().data);
     for (size_t i = 0; i != n; ++i) file_.get();
     fill();
   }
@@ -266,7 +192,10 @@ class file_scan_buffer : public scan_buffer {
     flockfile(f);
     fill();
   }
-  ~file_scan_buffer() { funlockfile(file_); }
+  ~file_scan_buffer() {
+    FILE* f = file_;
+    funlockfile(f);
+  }
 };
 }  // namespace detail
 
@@ -434,12 +363,12 @@ class scan_context {
 namespace detail {
 
 const char* parse_scan_specs(const char* begin, const char* end,
-                             format_specs<>& specs, scan_type) {
+                             format_specs& specs, scan_type) {
   while (begin != end) {
     switch (to_ascii(*begin)) {
     // TODO: parse more scan format specifiers
     case 'x':
-      specs.type = presentation_type::hex_lower;
+      specs.set_type(presentation_type::hex);
       ++begin;
       break;
     case '}':
@@ -450,11 +379,10 @@ const char* parse_scan_specs(const char* begin, const char* end,
 }
 
 template <typename T, FMT_ENABLE_IF(std::is_unsigned<T>::value)>
-auto read(scan_iterator it, T& value)
-    -> scan_iterator {
+auto read(scan_iterator it, T& value) -> scan_iterator {
   if (it == scan_sentinel()) return it;
   char c = *it;
-  if (c < '0' || c > '9') throw_format_error("invalid input");
+  if (c < '0' || c > '9') report_error("invalid input");
 
   int num_digits = 0;
   T n = 0, prev = 0;
@@ -478,17 +406,16 @@ auto read(scan_iterator it, T& value)
       prev * 10ull + unsigned(prev_digit - '0') <= max) {
     value = n;
   } else {
-    throw_format_error("number is too big");
+    report_error("number is too big");
   }
   return it;
 }
 
 template <typename T, FMT_ENABLE_IF(std::is_unsigned<T>::value)>
-auto read_hex(scan_iterator it, T& value)
-    -> scan_iterator {
+auto read_hex(scan_iterator it, T& value) -> scan_iterator {
   if (it == scan_sentinel()) return it;
   int digit = to_hex_digit(*it);
-  if (digit < 0) throw_format_error("invalid input");
+  if (digit < 0) report_error("invalid input");
 
   int num_digits = 0;
   T n = 0;
@@ -503,45 +430,44 @@ auto read_hex(scan_iterator it, T& value)
   if (num_digits <= (std::numeric_limits<T>::digits >> 2))
     value = n;
   else
-    throw_format_error("number is too big");
+    report_error("number is too big");
   return it;
 }
 
 template <typename T, FMT_ENABLE_IF(std::is_unsigned<T>::value)>
-auto read(scan_iterator it, T& value, const format_specs<>& specs)
+auto read(scan_iterator it, T& value, const format_specs& specs)
     -> scan_iterator {
-  if (specs.type == presentation_type::hex_lower)
-    return read_hex(it, value);
+  if (specs.type() == presentation_type::hex) return read_hex(it, value);
   return read(it, value);
 }
 
 template <typename T, FMT_ENABLE_IF(std::is_signed<T>::value)>
-auto read(scan_iterator it, T& value, const format_specs<>& = {})
+auto read(scan_iterator it, T& value, const format_specs& specs = {})
     -> scan_iterator {
   bool negative = it != scan_sentinel() && *it == '-';
   if (negative) {
     ++it;
-    if (it == scan_sentinel()) throw_format_error("invalid input");
+    if (it == scan_sentinel()) report_error("invalid input");
   }
   using unsigned_type = typename std::make_unsigned<T>::type;
   unsigned_type abs_value = 0;
-  it = read(it, abs_value);
+  it = read(it, abs_value, specs);
   auto n = static_cast<T>(abs_value);
   value = negative ? -n : n;
   return it;
 }
 
-auto read(scan_iterator it, std::string& value, const format_specs<>& = {})
+auto read(scan_iterator it, std::string& value, const format_specs& = {})
     -> scan_iterator {
   while (it != scan_sentinel() && *it != ' ') value.push_back(*it++);
   return it;
 }
 
-auto read(scan_iterator it, string_view& value, const format_specs<>& = {})
+auto read(scan_iterator it, string_view& value, const format_specs& = {})
     -> scan_iterator {
   auto range = to_contiguous(it);
   // This could also be checked at compile time in scan.
-  if (!range) throw_format_error("string_view requires contiguous input");
+  if (!range) report_error("string_view requires contiguous input");
   auto p = range.begin;
   while (p != range.end && *p != ' ') ++p;
   size_t size = to_unsigned(p - range.begin);
@@ -549,7 +475,7 @@ auto read(scan_iterator it, string_view& value, const format_specs<>& = {})
   return advance(it, size);
 }
 
-auto read(scan_iterator it, monostate, const format_specs<>& = {})
+auto read(scan_iterator it, monostate, const format_specs& = {})
     -> scan_iterator {
   return it;
 }
@@ -566,14 +492,14 @@ struct default_arg_scanner {
 // An argument scanner with format specifiers.
 struct arg_scanner {
   scan_iterator it;
-  const format_specs<>& specs;
+  const format_specs& specs;
 
   template <typename T> auto operator()(T&& value) -> scan_iterator {
     return read(it, value, specs);
   }
 };
 
-struct scan_handler : error_handler {
+struct scan_handler {
  private:
   scan_parse_context parse_ctx_;
   scan_context scan_ctx_;
@@ -607,8 +533,9 @@ struct scan_handler : error_handler {
     return 0;
   }
 
-  void on_replacement_field(int arg_id, const char*) {
+  void on_replacement_field(int arg_id, const char* begin) {
     scan_arg arg = scan_ctx_.arg(arg_id);
+    if (arg.scan_custom(begin, parse_ctx_, scan_ctx_)) return;
     auto it = scan_ctx_.begin();
     while (it != sentinel() && is_whitespace(*it)) ++it;
     scan_ctx_.advance_to(arg.visit(default_arg_scanner{it}));
@@ -619,47 +546,123 @@ struct scan_handler : error_handler {
     scan_arg arg = scan_ctx_.arg(arg_id);
     if (arg.scan_custom(begin, parse_ctx_, scan_ctx_))
       return parse_ctx_.begin();
-    auto specs = format_specs<>();
+    auto specs = format_specs();
     begin = parse_scan_specs(begin, end, specs, arg.type());
     if (begin == end || *begin != '}') on_error("missing '}' in format string");
     scan_ctx_.advance_to(arg.visit(arg_scanner{scan_ctx_.begin(), specs}));
     return begin;
   }
 
-  void on_error(const char* message) { error_handler::on_error(message); }
+  FMT_NORETURN void on_error(const char* message) { report_error(message); }
 };
+
+void vscan(detail::scan_buffer& buf, string_view fmt, scan_args args) {
+  auto h = detail::scan_handler(fmt, buf, args);
+  detail::parse_format_string(fmt, h);
+}
+
+template <size_t I, typename... T, FMT_ENABLE_IF(I == sizeof...(T))>
+void make_args(std::array<scan_arg, sizeof...(T)>&, std::tuple<T...>&) {}
+
+template <size_t I, typename... T, FMT_ENABLE_IF(I < sizeof...(T))>
+void make_args(std::array<scan_arg, sizeof...(T)>& args,
+               std::tuple<T...>& values) {
+  using element_type = typename std::tuple_element<I, std::tuple<T...>>::type;
+  static_assert(std::is_same<remove_cvref_t<element_type>, element_type>::value,
+                "");
+  args[I] = std::get<I>(values);
+  make_args<I + 1>(args, values);
+}
 }  // namespace detail
 
+template <typename Range, typename... T> class scan_data {
+ private:
+  std::tuple<T...> values_;
+  Range range_;
+
+ public:
+  scan_data() = default;
+  scan_data(T... values) : values_(std::move(values)...) {}
+
+  auto value() const -> decltype(std::get<0>(values_)) {
+    return std::get<0>(values_);
+  }
+
+  auto values() const -> const std::tuple<T...>& { return values_; }
+
+  auto make_args() -> std::array<scan_arg, sizeof...(T)> {
+    auto args = std::array<scan_arg, sizeof...(T)>();
+    detail::make_args<0>(args, values_);
+    return args;
+  }
+
+  auto range() const -> Range { return range_; }
+
+  auto begin() const -> decltype(range_.begin()) { return range_.begin(); }
+  auto end() const -> decltype(range_.end()) { return range_.end(); }
+};
+
 template <typename... T>
 auto make_scan_args(T&... args) -> std::array<scan_arg, sizeof...(T)> {
   return {{args...}};
 }
 
-void vscan(detail::scan_buffer& buf, string_view fmt, scan_args args) {
-  auto h = detail::scan_handler(fmt, buf, args);
-  detail::parse_format_string<false>(fmt, h);
-}
+class scan_error {};
 
-template <typename... T>
-auto scan(string_view input, string_view fmt, T&... args)
+// A rudimentary version of std::expected for testing the API shape.
+template <typename T, typename E> class expected {
+ private:
+  T value_;
+  bool has_value_ = true;
+
+ public:
+  expected(T value) : value_(std::move(value)) {}
+
+  explicit operator bool() const { return has_value_; }
+
+  auto operator->() const -> const T* { return &value_; }
+
+  auto error() -> E const { return E(); }
+};
+
+template <typename Range, typename... T>
+using scan_result = expected<scan_data<Range, T...>, scan_error>;
+
+auto vscan(string_view input, string_view fmt, scan_args args)
     -> string_view::iterator {
   auto&& buf = detail::string_scan_buffer(input);
-  vscan(buf, fmt, make_scan_args(args...));
+  detail::vscan(buf, fmt, args);
   return input.begin() + (buf.begin().base() - input.data());
 }
 
-template <typename InputRange, typename... T,
-          FMT_ENABLE_IF(!std::is_convertible<InputRange, string_view>::value)>
-auto scan(InputRange&& input, string_view fmt, T&... args)
+// Scans the input and stores the results (in)to args.
+template <typename... T>
+auto scan_to(string_view input, string_view fmt, T&... args)
+    -> string_view::iterator {
+  return vscan(input, fmt, make_scan_args(args...));
+}
+
+template <typename... T>
+auto scan(string_view input, string_view fmt)
+    -> scan_result<string_view, T...> {
+  auto data = scan_data<string_view, T...>();
+  vscan(input, fmt, data.make_args());
+  return data;
+}
+
+template <typename Range, typename... T,
+          FMT_ENABLE_IF(!std::is_convertible<Range, string_view>::value)>
+auto scan_to(Range&& input, string_view fmt, T&... args)
     -> decltype(std::begin(input)) {
   auto it = std::begin(input);
-  vscan(get_buffer(it), fmt, make_scan_args(args...));
+  detail::vscan(get_buffer(it), fmt, make_scan_args(args...));
   return it;
 }
 
-template <typename... T> bool scan(std::FILE* f, string_view fmt, T&... args) {
+template <typename... T>
+auto scan_to(FILE* f, string_view fmt, T&... args) -> bool {
   auto&& buf = detail::file_scan_buffer(f);
-  vscan(buf, fmt, make_scan_args(args...));
+  detail::vscan(buf, fmt, make_scan_args(args...));
   return buf.begin() != buf.end();
 }
 
diff --git a/test/std-test.cc b/test/std-test.cc
index de3feaa0..ab458ae8 100644
--- a/test/std-test.cc
+++ b/test/std-test.cc
@@ -35,6 +35,11 @@ TEST(std_test, path) {
                                    L"\x0447\x044B\x043D\x0430")),
             "");
   EXPECT_EQ(fmt::format("{}", path(L"\xd800")), "");
+  EXPECT_EQ(fmt::format("{}", path(L"HEAD \xd800 TAIL")), "HEAD  TAIL");
+  EXPECT_EQ(fmt::format("{}", path(L"HEAD \xD83D\xDE00 TAIL")),
+            "HEAD \xF0\x9F\x98\x80 TAIL");
+  EXPECT_EQ(fmt::format("{}", path(L"HEAD \xD83D\xD83D\xDE00 TAIL")),
+            "HEAD \xF0\x9F\x98\x80 TAIL");
   EXPECT_EQ(fmt::format("{:?}", path(L"\xd800")), "\"\\ud800\"");
 #  endif
 }
@@ -65,6 +70,37 @@ TEST(std_test, thread_id) {
   EXPECT_FALSE(fmt::format("{}", std::this_thread::get_id()).empty());
 }
 
+TEST(std_test, complex) {
+  using limits = std::numeric_limits<double>;
+  EXPECT_EQ(fmt::format("{}", std::complex<double>(1, limits::quiet_NaN())),
+            "(1+nan i)");
+  EXPECT_EQ(fmt::format("{}", std::complex<double>(1, -limits::infinity())),
+            "(1-inf i)");
+
+  EXPECT_EQ(fmt::format("{}", std::complex<int>(1, 2)), "(1+2i)");
+
+  EXPECT_EQ(fmt::format("{}", std::complex<double>(1, 2.2)), "(1+2.2i)");
+  EXPECT_EQ(fmt::format("{}", std::complex<double>(1, -2.2)), "(1-2.2i)");
+  EXPECT_EQ(fmt::format("{}", std::complex<double>(0, 2.2)), "2.2i");
+  EXPECT_EQ(fmt::format("{}", std::complex<double>(0, -2.2)), "-2.2i");
+
+  EXPECT_EQ(fmt::format("{:+}", std::complex<double>(0, 2.2)), "+2.2i");
+  EXPECT_EQ(fmt::format("{:+}", std::complex<double>(0, -2.2)), "-2.2i");
+  EXPECT_EQ(fmt::format("{:+}", std::complex<double>(1, -2.2)), "(+1-2.2i)");
+  EXPECT_EQ(fmt::format("{:+}", std::complex<double>(1, 2.2)), "(+1+2.2i)");
+  EXPECT_EQ(fmt::format("{: }", std::complex<double>(1, 2.2)), "( 1+2.2i)");
+  EXPECT_EQ(fmt::format("{: }", std::complex<double>(1, -2.2)), "( 1-2.2i)");
+
+  EXPECT_EQ(fmt::format("{:>20.2f}", std::complex<double>(1, 2.2)),
+            "        (1.00+2.20i)");
+  EXPECT_EQ(fmt::format("{:<20.2f}", std::complex<double>(1, 2.2)),
+            "(1.00+2.20i)        ");
+  EXPECT_EQ(fmt::format("{:<20.2f}", std::complex<double>(1, -2.2)),
+            "(1.00-2.20i)        ");
+  EXPECT_EQ(fmt::format("{:<{}.{}f}", std::complex<double>(1, -2.2), 20, 2),
+            "(1.00-2.20i)        ");
+}
+
 #ifdef __cpp_lib_source_location
 TEST(std_test, source_location) {
   std::source_location loc = std::source_location::current();
@@ -102,6 +138,36 @@ TEST(std_test, optional) {
 #endif
 }
 
+TEST(std_test, expected) {
+#ifdef __cpp_lib_expected
+  EXPECT_EQ(fmt::format("{}", std::expected<void, int>{}), "expected()");
+  EXPECT_EQ(fmt::format("{}", std::expected<int, int>{1}), "expected(1)");
+  EXPECT_EQ(fmt::format("{}", std::expected<int, int>{std::unexpected(1)}),
+            "unexpected(1)");
+  EXPECT_EQ(fmt::format("{}", std::expected<std::string, int>{"test"}),
+            "expected(\"test\")");
+  EXPECT_EQ(fmt::format(
+                "{}", std::expected<int, std::string>{std::unexpected("test")}),
+            "unexpected(\"test\")");
+  EXPECT_EQ(fmt::format("{}", std::expected<char, int>{'a'}), "expected('a')");
+  EXPECT_EQ(fmt::format("{}", std::expected<int, char>{std::unexpected('a')}),
+            "unexpected('a')");
+
+  struct unformattable1 {};
+  struct unformattable2 {};
+  EXPECT_FALSE((fmt::is_formattable<unformattable1>::value));
+  EXPECT_FALSE((fmt::is_formattable<unformattable2>::value));
+  EXPECT_FALSE((fmt::is_formattable<
+                std::expected<unformattable1, unformattable2>>::value));
+  EXPECT_FALSE(
+      (fmt::is_formattable<std::expected<unformattable1, int>>::value));
+  EXPECT_FALSE(
+      (fmt::is_formattable<std::expected<int, unformattable2>>::value));
+  EXPECT_TRUE((fmt::is_formattable<std::expected<int, int>>::value));
+  EXPECT_TRUE((fmt::is_formattable<std::expected<void, int>>::value));
+#endif
+}
+
 namespace my_nso {
 enum class my_number {
   one,
@@ -199,9 +265,13 @@ TEST(std_test, variant) {
 }
 
 TEST(std_test, error_code) {
+  auto& generic = std::generic_category();
   EXPECT_EQ("generic:42",
-            fmt::format(FMT_STRING("{0}"),
-                        std::error_code(42, std::generic_category())));
+            fmt::format(FMT_STRING("{0}"), std::error_code(42, generic)));
+  EXPECT_EQ("  generic:42",
+            fmt::format(FMT_STRING("{:>12}"), std::error_code(42, generic)));
+  EXPECT_EQ("generic:42  ",
+            fmt::format(FMT_STRING("{:12}"), std::error_code(42, generic)));
   EXPECT_EQ("system:42",
             fmt::format(FMT_STRING("{0}"),
                         std::error_code(42, fmt::system_category())));
@@ -265,6 +335,13 @@ TEST(std_test, exception) {
 #endif
 }
 
+#if FMT_USE_RTTI
+TEST(std_test, type_info) {
+  EXPECT_EQ(fmt::format("{}", typeid(std::runtime_error)),
+            "std::runtime_error");
+}
+#endif
+
 TEST(std_test, format_bit_reference) {
   std::bitset<2> bs(1);
   EXPECT_EQ(fmt::format("{} {}", bs[0], bs[1]), "true false");
@@ -304,3 +381,26 @@ TEST(std_test, format_atomic_flag) {
   EXPECT_EQ(fmt::format("{}", cf), "false");
 }
 #endif  // __cpp_lib_atomic_flag_test
+
+TEST(std_test, format_unique_ptr) {
+  std::unique_ptr<int> up(new int(1));
+  EXPECT_EQ(fmt::format("{}", fmt::ptr(up.get())),
+            fmt::format("{}", fmt::ptr(up)));
+  struct custom_deleter {
+    void operator()(int* p) const { delete p; }
+  };
+  std::unique_ptr<int, custom_deleter> upcd(new int(1));
+  EXPECT_EQ(fmt::format("{}", fmt::ptr(upcd.get())),
+            fmt::format("{}", fmt::ptr(upcd)));
+}
+
+TEST(std_test, format_shared_ptr) {
+  std::shared_ptr<int> sp(new int(1));
+  EXPECT_EQ(fmt::format("{}", fmt::ptr(sp.get())),
+            fmt::format("{}", fmt::ptr(sp)));
+}
+
+TEST(std_test, format_reference_wrapper) {
+  int num = 35;
+  EXPECT_EQ("35", fmt::to_string(std::cref(num)));
+}
diff --git a/test/test-assert.h b/test/test-assert.h
index ab7b2bf7..bec3dfc3 100644
--- a/test/test-assert.h
+++ b/test/test-assert.h
@@ -12,7 +12,7 @@
 
 void throw_assertion_failure(const char* message);
 #define FMT_ASSERT(condition, message) \
-  if (!(condition)) throw_assertion_failure(message);
+  ((condition) ? (void)0 : throw_assertion_failure(message))
 
 #include "gtest/gtest.h"
 
diff --git a/test/unicode-test.cc b/test/unicode-test.cc
index e9ea5e5e..2b59cff9 100644
--- a/test/unicode-test.cc
+++ b/test/unicode-test.cc
@@ -15,7 +15,7 @@
 
 using testing::Contains;
 
-TEST(unicode_test, is_utf8) { EXPECT_TRUE(fmt::detail::is_utf8()); }
+TEST(unicode_test, use_utf8) { EXPECT_TRUE(fmt::detail::use_utf8); }
 
 TEST(unicode_test, legacy_locale) {
   auto loc = get_locale("be_BY.CP1251", "Belarusian_Belarus.1251");
diff --git a/test/util.cc b/test/util.cc
index d3f2dc73..8ea26610 100644
--- a/test/util.cc
+++ b/test/util.cc
@@ -13,11 +13,10 @@ const char* const file_content = "Don't panic!";
 
 fmt::buffered_file open_buffered_file(FILE** fp) {
 #if FMT_USE_FCNTL
-  fmt::file read_end, write_end;
-  fmt::file::pipe(read_end, write_end);
-  write_end.write(file_content, std::strlen(file_content));
-  write_end.close();
-  fmt::buffered_file f = read_end.fdopen("r");
+  auto pipe = fmt::pipe();
+  pipe.write_end.write(file_content, std::strlen(file_content));
+  pipe.write_end.close();
+  fmt::buffered_file f = pipe.read_end.fdopen("r");
   if (fp) *fp = f.get();
 #else
   fmt::buffered_file f("test-file", "w");
@@ -37,12 +36,11 @@ std::locale do_get_locale(const char* name) {
 
 std::locale get_locale(const char* name, const char* alt_name) {
   auto loc = do_get_locale(name);
-  if (loc == std::locale::classic() && alt_name)
-    loc = do_get_locale(alt_name);
+  if (loc == std::locale::classic() && alt_name) loc = do_get_locale(alt_name);
 #ifdef __OpenBSD__
-    // Locales are not working in OpenBSD:
-    // https://github.com/fmtlib/fmt/issues/3670.
-    loc = std::locale::classic();
+  // Locales are not working in OpenBSD:
+  // https://github.com/fmtlib/fmt/issues/3670.
+  loc = std::locale::classic();
 #endif
   if (loc == std::locale::classic())
     fmt::print(stderr, "{} locale is missing.\n", name);
diff --git a/test/xchar-test.cc b/test/xchar-test.cc
index 7f33fb27..215b659f 100644
--- a/test/xchar-test.cc
+++ b/test/xchar-test.cc
@@ -32,27 +32,29 @@ using testing::Contains;
 
 struct non_string {};
 
-template <typename T> class is_string_test : public testing::Test {};
+template <typename T> class has_to_string_view_test : public testing::Test {};
 
 using string_char_types = testing::Types<char, wchar_t, char16_t, char32_t>;
-TYPED_TEST_SUITE(is_string_test, string_char_types);
+TYPED_TEST_SUITE(has_to_string_view_test, string_char_types);
 
 template <typename Char>
 struct derived_from_string_view : fmt::basic_string_view<Char> {};
 
-TYPED_TEST(is_string_test, is_string) {
-  EXPECT_TRUE(fmt::detail::is_string<TypeParam*>::value);
-  EXPECT_TRUE(fmt::detail::is_string<const TypeParam*>::value);
-  EXPECT_TRUE(fmt::detail::is_string<TypeParam[2]>::value);
-  EXPECT_TRUE(fmt::detail::is_string<const TypeParam[2]>::value);
-  EXPECT_TRUE(fmt::detail::is_string<std::basic_string<TypeParam>>::value);
-  EXPECT_TRUE(fmt::detail::is_string<fmt::basic_string_view<TypeParam>>::value);
+TYPED_TEST(has_to_string_view_test, has_to_string_view) {
+  EXPECT_TRUE(fmt::detail::has_to_string_view<TypeParam*>::value);
+  EXPECT_TRUE(fmt::detail::has_to_string_view<const TypeParam*>::value);
+  EXPECT_TRUE(fmt::detail::has_to_string_view<TypeParam[2]>::value);
+  EXPECT_TRUE(fmt::detail::has_to_string_view<const TypeParam[2]>::value);
   EXPECT_TRUE(
-      fmt::detail::is_string<derived_from_string_view<TypeParam>>::value);
+      fmt::detail::has_to_string_view<std::basic_string<TypeParam>>::value);
+  EXPECT_TRUE(fmt::detail::has_to_string_view<
+              fmt::basic_string_view<TypeParam>>::value);
+  EXPECT_TRUE(fmt::detail::has_to_string_view<
+              derived_from_string_view<TypeParam>>::value);
   using fmt_string_view = fmt::detail::std_string_view<TypeParam>;
   EXPECT_TRUE(std::is_empty<fmt_string_view>::value !=
-              fmt::detail::is_string<fmt_string_view>::value);
-  EXPECT_FALSE(fmt::detail::is_string<non_string>::value);
+              fmt::detail::has_to_string_view<fmt_string_view>::value);
+  EXPECT_FALSE(fmt::detail::has_to_string_view<non_string>::value);
 }
 
 // std::is_constructible is broken in MSVC until version 2015.
@@ -76,7 +78,6 @@ TEST(xchar_test, format) {
   EXPECT_EQ(L"z", fmt::format(L"{}", L'z'));
   EXPECT_THROW(fmt::format(fmt::runtime(L"{:*\x343E}"), 42), fmt::format_error);
   EXPECT_EQ(L"true", fmt::format(L"{}", true));
-  EXPECT_EQ(L"a", fmt::format(L"{0}", 'a'));
   EXPECT_EQ(L"a", fmt::format(L"{0}", L'a'));
   EXPECT_EQ(L"Cyrillic letter \x42e",
             fmt::format(L"Cyrillic letter {}", L'\x42e'));
@@ -94,107 +95,21 @@ TEST(xchar_test, compile_time_string) {
 #endif
 }
 
-#if FMT_CPLUSPLUS > 201103L
-struct custom_char {
-  int value;
-  custom_char() = default;
-
-  template <typename T>
-  constexpr custom_char(T val) : value(static_cast<int>(val)) {}
-
-  constexpr operator char() const {
-    return value <= 0xff ? static_cast<char>(value) : '\0';
-  }
-  constexpr bool operator<(custom_char c) const { return value < c.value; }
-};
-
-namespace std {
-
-template <> struct char_traits<custom_char> {
-  using char_type = custom_char;
-  using int_type = int;
-  using off_type = streamoff;
-  using pos_type = streampos;
-  using state_type = mbstate_t;
-
-  static constexpr void assign(char_type& r, const char_type& a) { r = a; }
-  static constexpr bool eq(char_type a, char_type b) { return a == b; }
-  static constexpr bool lt(char_type a, char_type b) { return a < b; }
-  static FMT_CONSTEXPR int compare(const char_type* s1, const char_type* s2,
-                                   size_t count) {
-    for (; count; count--, s1++, s2++) {
-      if (lt(*s1, *s2)) return -1;
-      if (lt(*s2, *s1)) return 1;
-    }
-    return 0;
-  }
-  static FMT_CONSTEXPR size_t length(const char_type* s) {
-    size_t count = 0;
-    while (!eq(*s++, custom_char(0))) count++;
-    return count;
-  }
-  static const char_type* find(const char_type*, size_t, const char_type&);
-  static FMT_CONSTEXPR char_type* move(char_type* dest, const char_type* src,
-                                       size_t count) {
-    if (count == 0) return dest;
-    char_type* ret = dest;
-    if (src < dest) {
-      dest += count;
-      src += count;
-      for (; count; count--) assign(*--dest, *--src);
-    } else if (src > dest)
-      copy(dest, src, count);
-    return ret;
-  }
-  static FMT_CONSTEXPR char_type* copy(char_type* dest, const char_type* src,
-                                       size_t count) {
-    char_type* ret = dest;
-    for (; count; count--) assign(*dest++, *src++);
-    return ret;
-  }
-  static FMT_CONSTEXPR char_type* assign(char_type* dest, std::size_t count,
-                                         char_type a) {
-    char_type* ret = dest;
-    for (; count; count--) assign(*dest++, a);
-    return ret;
-  }
-  static int_type not_eof(int_type);
-  static char_type to_char_type(int_type);
-  static int_type to_int_type(char_type);
-  static bool eq_int_type(int_type, int_type);
-  static int_type eof();
-};
-
-}  // namespace std
-
-auto to_ascii(custom_char c) -> char { return c; }
-
-FMT_BEGIN_NAMESPACE
-template <> struct is_char<custom_char> : std::true_type {};
-FMT_END_NAMESPACE
-
-TEST(xchar_test, format_custom_char) {
-  const custom_char format[] = {'{', '}', 0};
-  auto result = fmt::format(format, custom_char('x'));
-  EXPECT_EQ(result.size(), 1);
-  EXPECT_EQ(result[0], custom_char('x'));
-}
-#endif
-
-// Convert a char8_t string to std::string. Otherwise GTest will insist on
-// inserting `char8_t` NTBS into a `char` stream which is disabled by P1423.
-template <typename S> std::string from_u8str(const S& str) {
-  return std::string(str.begin(), str.end());
-}
-
 TEST(xchar_test, format_to) {
   auto buf = std::vector<wchar_t>();
   fmt::format_to(std::back_inserter(buf), L"{}{}", 42, L'\0');
   EXPECT_STREQ(buf.data(), L"42");
 }
 
+TEST(xchar_test, compile_time_string_format_to) {
+  std::wstring ws;
+  fmt::format_to(std::back_inserter(ws), FMT_STRING(L"{}"), 42);
+  EXPECT_EQ(L"42", ws);
+}
+
 TEST(xchar_test, vformat_to) {
-  auto args = fmt::make_wformat_args(42);
+  int n = 42;
+  auto args = fmt::make_wformat_args(n);
   auto w = std::wstring();
   fmt::vformat_to(std::back_inserter(w), L"{}", args);
   EXPECT_EQ(L"42", w);
@@ -229,7 +144,6 @@ TEST(format_test, wide_format_to_n) {
   EXPECT_EQ(L"BC x", fmt::wstring_view(buffer, 4));
 }
 
-#if FMT_USE_USER_DEFINED_LITERALS
 TEST(xchar_test, named_arg_udl) {
   using namespace fmt::literals;
   auto udl_a =
@@ -240,7 +154,6 @@ TEST(xchar_test, named_arg_udl) {
                   fmt::arg(L"second", L"cad"), fmt::arg(L"third", 99)),
       udl_a);
 }
-#endif  // FMT_USE_USER_DEFINED_LITERALS
 
 TEST(xchar_test, print) {
   // Check that the wide print overload compiles.
@@ -514,7 +427,7 @@ TEST(locale_test, format) {
             fmt::format(small_grouping_loc, "{:L}", max_value<uint32_t>()));
 }
 
-TEST(locale_test, format_detault_align) {
+TEST(locale_test, format_default_align) {
   auto loc = std::locale({}, new special_grouping<char>());
   EXPECT_EQ("  12,345", fmt::format(loc, "{:8L}", 12345));
 }
@@ -559,56 +472,15 @@ TEST(locale_test, int_formatter) {
   EXPECT_EQ(fmt::to_string(buf), "12,345");
 }
 
-FMT_BEGIN_NAMESPACE
-template <class charT> struct formatter<std::complex<double>, charT> {
- private:
-  detail::dynamic_format_specs<char> specs_;
-
- public:
-  FMT_CONSTEXPR typename basic_format_parse_context<charT>::iterator parse(
-      basic_format_parse_context<charT>& ctx) {
-    auto end = parse_format_specs(ctx.begin(), ctx.end(), specs_, ctx,
-                                  detail::type::float_type);
-    detail::parse_float_type_spec(specs_);
-    return end;
-  }
-
-  template <class FormatContext>
-  typename FormatContext::iterator format(const std::complex<double>& c,
-                                          FormatContext& ctx) {
-    detail::handle_dynamic_spec<detail::precision_checker>(
-        specs_.precision, specs_.precision_ref, ctx);
-    auto specs = std::string();
-    if (specs_.precision > 0) specs = fmt::format(".{}", specs_.precision);
-    if (specs_.type == presentation_type::fixed_lower) specs += 'f';
-    auto real = fmt::format(ctx.locale().template get<std::locale>(),
-                            fmt::runtime("{:" + specs + "}"), c.real());
-    auto imag = fmt::format(ctx.locale().template get<std::locale>(),
-                            fmt::runtime("{:" + specs + "}"), c.imag());
-    auto fill_align_width = std::string();
-    if (specs_.width > 0) fill_align_width = fmt::format(">{}", specs_.width);
-    return fmt::format_to(ctx.out(), runtime("{:" + fill_align_width + "}"),
-                          c.real() != 0 ? fmt::format("({}+{}i)", real, imag)
-                                        : fmt::format("{}i", imag));
-  }
-};
-FMT_END_NAMESPACE
-
-TEST(locale_test, complex) {
-  std::string s = fmt::format("{}", std::complex<double>(1, 2));
-  EXPECT_EQ(s, "(1+2i)");
-  EXPECT_EQ(fmt::format("{:.2f}", std::complex<double>(1, 2)), "(1.00+2.00i)");
-  EXPECT_EQ(fmt::format("{:8}", std::complex<double>(1, 2)), "  (1+2i)");
-}
-
 TEST(locale_test, chrono_weekday) {
   auto loc = get_locale("es_ES.UTF-8", "Spanish_Spain.1252");
   auto loc_old = std::locale::global(loc);
   auto sat = fmt::weekday(6);
   EXPECT_EQ(fmt::format(L"{}", sat), L"Sat");
   if (loc != std::locale::classic()) {
-    // L'\xE1' is ''.
-    auto saturdays = std::vector<std::wstring>{L"s\xE1""b", L"s\xE1."};
+    // L'\341' is ''.
+    auto saturdays =
+        std::vector<std::wstring>{L"s\341b", L"s\341.", L"s\341b."};
     EXPECT_THAT(saturdays, Contains(fmt::format(loc, L"{:L}", sat)));
   }
   std::locale::global(loc_old);
@@ -618,6 +490,14 @@ TEST(locale_test, sign) {
   EXPECT_EQ(fmt::format(std::locale(), L"{:L}", -50), L"-50");
 }
 
+TEST(std_test_xchar, complex) {
+  auto s = fmt::format(L"{}", std::complex<double>(1, 2));
+  EXPECT_EQ(s, L"(1+2i)");
+  EXPECT_EQ(fmt::format(L"{:.2f}", std::complex<double>(1, 2)),
+            L"(1.00+2.00i)");
+  EXPECT_EQ(fmt::format(L"{:8}", std::complex<double>(1, 2)), L"(1+2i)  ");
+}
+
 TEST(std_test_xchar, optional) {
 #  ifdef __cpp_lib_optional
   EXPECT_EQ(fmt::format(L"{}", std::optional{L'C'}), L"optional(\'C\')");
```

